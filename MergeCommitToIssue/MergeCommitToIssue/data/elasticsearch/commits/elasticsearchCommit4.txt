time:
2016-11-21T11:51:06Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java
core/src/main/java/org/elasticsearch/env/ShardLockObtainFailedException.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
core/src/test/java/org/elasticsearch/VersionTests.java
comments:
Add BWC layer for Exceptions (#21694)

Today it's not possible to add exceptions to the serialization layer
without breaking BWC. This commit adds the ability to specify the Version
an exception was added that allows to fall back not NotSerializableExceptionWrapper
if the exception is not present in the streams version.

Relates to #21656

time:
2016-11-21T11:36:44Z
class:
core/src/test/java/org/elasticsearch/search/nested/SimpleNestedIT.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ESClientYamlSuiteTestCase.java
comments:
Add checkstyle rule to forbid empty javadoc comments (#20881)

This commit adds a RegexpMultiline check to checkstyle that yells when an empty Javadoc comment is found in Java files.

Related #20871

time:
2016-11-21T10:47:48Z
class:
comments:
Docs: Added offline install link for discovery-file plugin

Closes #21696

time:
2016-11-21T10:46:26Z
class:
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
comments:
remove pointless catch exception in TransportSearchAction (#21689)

TransportSearchAction optimizes the search_type in certain cases, when for instance we are searching against a single shard, or when there is only a suggest section in the request. That optimization is wrapped in a try catch, and when an exception happens we log it and ignore it. This may be a leftover from the past though, as no exception is expected to be thrown in that code block, hence if there is any exception we are probably better off bubbling it up rather than ignoring it.

time:
2016-11-21T10:36:56Z
class:
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
comments:
Rename ClusterState#lookupPrototypeSafe to `lookupPrototype` and remove previous "unsafe" unused variant (#21686)

The `lookupPrototype` method is not used anywhere. Seems like we rather use its `lookupProrotypeSafe` variant (which also throws exception if the prototype is not found) is always. This commit makes the safer variant the default one, by renaming it to  "lookupPrototype" and removes the previous "unsafe" variant.

time:
2016-11-21T09:47:50Z
class:
core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java
core/src/test/java/org/elasticsearch/common/io/stream/BytesStreamsTests.java
comments:
Use a buffer to do character to byte conversion in StreamOutput#writeString (#21680)

Today we call `writeByte` up to 3x per character in each string written via
`StreamOutput#writeString` this can have quite some overhead when strings
are long or many strings are written. This change adds a local buffer to
convert chars to bytes into the local buffer. Converted bytes are then
written via `writeBytes` instead reducing the overhead of this opertion.

Closes #21660

time:
2016-11-21T09:41:08Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/common/Numbers.java
core/src/main/java/org/elasticsearch/common/xcontent/support/XContentMapValues.java
core/src/test/java/org/elasticsearch/common/NumbersTests.java
comments:
Fix integer overflows when dealing with templates. (#21628)

The overflows were happening in two places, the parsing of the template that
implicitly truncates the `order` when its value does not fall into the `integer`
range, and the comparator that sorts templates in ascending order, since it
returns `order2-order1`, which might overflow.

Closes #21622

time:
2016-11-21T09:29:30Z
class:
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/PlainHighlighter.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java
comments:
Fix highlighting on a stored keyword field (#21645)

* Fix highlighting on a stored keyword field

The highlighter converts stored keyword fields using toString().
Since the keyword fields are stored as utf8 bytes the conversion is broken.
This change uses BytesRef.utf8toString() to convert the field value in a valid string.

Fixes #21636

* Replace BytesRef#utf8ToString with MappedFieldType#valueForDisplay

time:
2016-11-21T09:20:09Z
class:
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java
comments:
Set execute permissions for native plugin programs (#21657)

time:
2016-11-21T09:17:05Z
class:
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodes.java
comments:
adjust visibility of DiscoveryNodes.Delta constructor

It can be private as it gets called by DiscoveryNodes#delta method, which is supposed to be the only way to create a Delta

time:
2016-11-21T09:17:05Z
class:
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodes.java
comments:
Remove unused DiscoveryNodes.Delta constructor

time:
2016-11-21T09:17:05Z
class:
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodes.java
comments:
Remove unused DiscoveryNode#removeDeadMembers public method

time:
2016-11-21T09:17:05Z
class:
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodes.java
comments:
Remove minNodeVersion and corresponding public `getSmallestVersion` getter method from DiscoveryNodes

time:
2016-11-19T15:51:05Z
class:
comments:
Adding XWiki Elasticsearch Macro (#21505)

Added link to Elasticsearch Macro with description

time:
2016-11-19T15:47:39Z
class:
comments:
The alias is switched to point to the new index (#21512)

If the index satisfies the specified conditions then a new index is created and the alias is switched to point to the new index.

time:
2016-11-19T12:11:13Z
class:
modules/lang-groovy/src/main/java/org/elasticsearch/script/groovy/GroovyScriptEngineService.java
modules/lang-groovy/src/test/java/org/elasticsearch/script/groovy/GroovySecurityTests.java
comments:
Wrap GroovyBugErrors in ScriptExceptions

When Groovy detects a bug in its runtime because an internal assertion
was violated, it throws an GroovyBugError. This descends from
AssertionError and if it goes uncaught will land in the uncaught
exception handler and will not deliver any useful information to the
user. This commit wraps GroovyBugErrors in ScriptExceptions so that
useful information is returned to the user.

time:
2016-11-19T11:45:28Z
class:
comments:
Update getting-started.asciidoc (#21677)

time:
2016-11-19T11:27:25Z
class:
core/src/main/java/org/elasticsearch/node/Node.java
comments:
Log node ID on startup

If the node name is explicitly set it's not derived from the node ID
meaning that it doesn't immediately appear in the logs. While it can be
tracked down in other places, it would be easier for info purposes if it
just showed up explicitly. This commit adds the node ID to the logs,
whether or not the node name is set.

Relates #21673

time:
2016-11-18T18:54:26Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/PainlessLexer.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/PainlessParser.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/PainlessParserBaseVisitor.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/PainlessParserVisitor.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/Walker.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EElvis.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PSubNullSafeCallInvoke.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PSubNullSafeField.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/BasicExpressionTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ElvisTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/WhenThingsGoWrongTests.java
comments:
Implement the ?: operator in painless (#21506)

Implements a null coalescing operator in painless that looks like `?:`. This form was chosen to emulate Groovy's `?:` operator. It is different in that it only coalesces null values, instead of Groovy's `?:` operator which coalesces all falsy values. I believe that makes it the same as Kotlin's `?:` operator. In other languages this operator looks like `??` (C#) and `COALESCE` (SQL) and `:-` (bash).

This operator is lazy, meaning the right hand side is only evaluated at all if the left hand side is null.

time:
2016-11-18T18:04:28Z
class:
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/Plugin.java
comments:
Clarify that plugins can be closed

Plugins are closed if they implement java.io.Closeable but this is not
clear from the plugin interface. This commit clarifies this by declaring
that Plugins implement java.io.Closeable and adding an empty
implementation to the base Plugin class.

Relates #21669

time:
2016-11-18T15:55:04Z
class:
comments:
minor grammatical improvements (#21640)

time:
2016-11-18T15:52:46Z
class:
comments:
Update BulkProcessor size in the example

By default, it is recommended to start bulk with a size of 10-15MB, and increase it gradually to get the right size for the environment. The example shows originally 1GB, which can lead to some users to just copy-paste the code snippet and start with excessively big sizes.

Backport of #21664 in master branch.

time:
2016-11-18T15:40:18Z
class:
core/src/main/java/org/elasticsearch/common/settings/AbstractScopedSettings.java
core/src/test/java/org/elasticsearch/common/settings/ScopedSettingsTests.java
comments:
Don't reset non-dynamic settings unless explicitly requested (#21646)

AbstractScopedSettings has the ability to only apply updates/deletes
to dynamic settings. The flag is currently not respected when a setting
is reset/deleted which causes static node settings to be reset if a non-dynamic
key is reset via `null` value.

Closes #21593

time:
2016-11-18T15:19:27Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocateUnassignedDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/MoveDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/NodeAllocationResult.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/NodeRebalanceResult.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RebalanceDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RelocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java
core/src/main/java/org/elasticsearch/gateway/BaseGatewayShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/ReplicaShardAllocator.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AllocateUnassignedDecisionTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/BalancedSingleShardTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/MoveDecisionTests.java
comments:
 Makes allocator decision classes top-level classes (#21662)

This commit moves several allocation decider related inner classes
into their own top-level class, in order to use more easily in
the allocation explain API. This commit also renames some of those
decision related classes to more suitable names.

This is simply a cosmetic change - no functionality changes with this
commit whatsoever.

To summarize the changes:
 1. ShardAllocationDecision renamed to AllocateUnassignedDecision
 2. RelocationDecision moved to a top-level class
 3. MoveDecision moved to a top-level class
 4. RebalanceDecision moved to a top-level class
 5. ShardAllocationDecisionTests renamed to AllocateUnassignedDecisionTests
 6. NodeRebalanceResult moved to a top-level class
 7. ShardAllocationDecision#WeightedDecision moved to a top-level class and renamed to NodeAllocationResult.

time:
2016-11-18T12:13:13Z
class:
comments:
Merge pull request #21651 from elastic/suggester-docs-example-fix

fix two errors in suggester docs

time:
2016-11-18T11:56:23Z
class:
comments:
Remove stale mention of minimum master nodes check

This commit removes a stale mention of the minimum master nodes boostrap
check from the docs.

Relates #21653

time:
2016-11-18T11:49:03Z
class:
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
comments:
Merge remote-tracking branch 'origin/master'

time:
2016-11-18T11:34:50Z
class:
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
comments:
[TEST] Fix testTimedOutUpdateTaskCleanedUp to wait for blocking task to be completed

The "test" task can complete its execution with a timeout exception before the "block-task" actually starts executing. The test thus has to wait for both to be
completed before checking that the updateTasksPerExecutor map has been properly cleaned up.

time:
2016-11-18T11:33:45Z
class:
comments:
Merge branch 'pr/update-tika-1.14'

time:
2016-11-18T11:05:49Z
class:
comments:
fix two errors in suggester docs

The first changed referred to an example of the 2.4 documentation. I removed the no longer relevant parts. We should consider adding a little more here. 

The second change was just then->than in the suggest_mode popular section

time:
2016-11-18T10:54:22Z
class:
comments:
Remove transport-netty3-client mention (#21650)

Now netty3 is gone, this mention must also be removed.

time:
2016-11-18T09:51:42Z
class:
qa/no-bootstrap-tests/src/test/java/org/elasticsearch/bootstrap/SpawnerNoBootstrapTests.java
comments:
Fix Windows test failure (#21647)

time:
2016-11-17T21:39:08Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/Locals.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SFunction.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SSource.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/LambdaTests.java
comments:
Fix reserved variable availability in lambdas in Painless

time:
2016-11-17T19:22:48Z
class:
core/src/main/java/org/elasticsearch/index/query/AbstractQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/IdsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryBuilders.java
core/src/test/java/org/elasticsearch/index/query/IdsQueryBuilderTests.java
comments:
Don't require `types` parameter in IdsQueryBuilder constructor

According to the docs and our own tests we accept an ids query without specified
types and default to all types in the index mapping in this case. This changes
the builder to reflect this by making the types no longer a required constructor
argument and changes the parser to reflect that.

time:
2016-11-17T19:22:48Z
class:
core/src/main/java/org/elasticsearch/index/query/AbstractQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/IdsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchAllQueryBuilder.java
core/src/test/java/org/elasticsearch/index/query/IdsQueryBuilderTests.java
comments:
Using ObjectParser in MatchAllQueryBuilder and IdsQueryBuilder

A first step moving away from the current parsing to use the generalized
Objectparser and ConstructingObjectParser. This PR start by making use of it in
MatchAllQueryBuilder and IdsQueryBuilder.

time:
2016-11-17T17:54:57Z
class:
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
comments:
Fix compilation in Eclipse (#21606)

* Fix compilation in Eclipse

I'm not sure what the bug is, but ecj doesn't like this expression
unless the type is set explicitly.

* Add comment explaining why no diamond operator

time:
2016-11-17T17:45:34Z
class:
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
core/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java
comments:
Fix match_phrase_prefix on boosted fields (#21623)

This change fixes the match_phrase_prefix on fields that define a boost in their mapping.

Fixes #21613

time:
2016-11-17T16:22:15Z
class:
comments:
Fix leftover reference to ScriptModule in native script docs

time:
2016-11-17T15:07:42Z
class:
comments:
Mark snippet in docker docs NOTCONSOLE

That keeps us from failing the build because it is "unconverted".

Relates to #21497

time:
2016-11-17T14:49:10Z
class:
comments:
Add comment to explain flexible assertion in indices rollover IT

time:
2016-11-17T14:30:21Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/ResourceAlreadyExistsException.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/main/java/org/elasticsearch/tasks/TaskResultsService.java
core/src/test/java/org/elasticsearch/ESExceptionTests.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/rollover/RolloverIT.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexServiceTests.java
comments:
Replace IndexAlreadyExistsException with ResourceAlreadyExistsException (#21494)

time:
2016-11-17T14:18:49Z
class:
core/src/main/java/org/elasticsearch/common/util/concurrent/EsExecutors.java
core/src/main/java/org/elasticsearch/threadpool/FixedExecutorBuilder.java
core/src/main/java/org/elasticsearch/threadpool/ScalingExecutorBuilder.java
core/src/main/java/org/elasticsearch/threadpool/ThreadPool.java
core/src/test/java/org/elasticsearch/action/ingest/IngestActionFilterTests.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
core/src/test/java/org/elasticsearch/ingest/PipelineExecutionServiceTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
comments:
Expose executor service interface from thread pool

This commit exposes the executor service interface from thread
pool. This will enable some high-level concurrency primitives that will
make some code cleaner and simpler.

Relates #21608

time:
2016-11-17T13:06:32Z
class:
comments:
[docs] Document Docker installation method

Initial commit of the Docker installation method for Elasticsearch.

Relates #21497

time:
2016-11-17T11:44:42Z
class:
client/transport/src/main/java/org/elasticsearch/transport/client/PreBuiltTransportClient.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RetryTests.java
modules/transport-netty3/src/main/java/org/elasticsearch/http/netty3/ESNetty3HttpResponseEncoder.java
modules/transport-netty3/src/main/java/org/elasticsearch/http/netty3/Netty3HttpChannel.java
modules/transport-netty3/src/main/java/org/elasticsearch/http/netty3/Netty3HttpRequest.java
modules/transport-netty3/src/main/java/org/elasticsearch/http/netty3/Netty3HttpRequestHandler.java
modules/transport-netty3/src/main/java/org/elasticsearch/http/netty3/Netty3HttpServerTransport.java
modules/transport-netty3/src/main/java/org/elasticsearch/http/netty3/cors/Netty3CorsConfig.java
modules/transport-netty3/src/main/java/org/elasticsearch/http/netty3/cors/Netty3CorsConfigBuilder.java
modules/transport-netty3/src/main/java/org/elasticsearch/http/netty3/cors/Netty3CorsHandler.java
modules/transport-netty3/src/main/java/org/elasticsearch/http/netty3/pipelining/HttpPipeliningHandler.java
modules/transport-netty3/src/main/java/org/elasticsearch/http/netty3/pipelining/OrderedDownstreamChannelEvent.java
modules/transport-netty3/src/main/java/org/elasticsearch/http/netty3/pipelining/OrderedUpstreamMessageEvent.java
modules/transport-netty3/src/main/java/org/elasticsearch/transport/Netty3Plugin.java
modules/transport-netty3/src/main/java/org/elasticsearch/transport/netty3/ChannelBufferBytesReference.java
modules/transport-netty3/src/main/java/org/elasticsearch/transport/netty3/ChannelBufferStreamInput.java
modules/transport-netty3/src/main/java/org/elasticsearch/transport/netty3/Netty3InternalESLogger.java
modules/transport-netty3/src/main/java/org/elasticsearch/transport/netty3/Netty3MessageChannelHandler.java
modules/transport-netty3/src/main/java/org/elasticsearch/transport/netty3/Netty3OpenChannelsHandler.java
modules/transport-netty3/src/main/java/org/elasticsearch/transport/netty3/Netty3SizeHeaderFrameDecoder.java
modules/transport-netty3/src/main/java/org/elasticsearch/transport/netty3/Netty3Transport.java
modules/transport-netty3/src/main/java/org/elasticsearch/transport/netty3/Netty3Utils.java
modules/transport-netty3/src/test/java/org/elasticsearch/ESNetty3IntegTestCase.java
modules/transport-netty3/src/test/java/org/elasticsearch/http/netty3/Netty3ClientYamlTestSuiteIT.java
modules/transport-netty3/src/test/java/org/elasticsearch/http/netty3/Netty3HttpChannelTests.java
modules/transport-netty3/src/test/java/org/elasticsearch/http/netty3/Netty3HttpClient.java
modules/transport-netty3/src/test/java/org/elasticsearch/http/netty3/Netty3HttpPublishPortTests.java
modules/transport-netty3/src/test/java/org/elasticsearch/http/netty3/Netty3HttpRequestSizeLimitIT.java
modules/transport-netty3/src/test/java/org/elasticsearch/http/netty3/Netty3HttpServerPipeliningTests.java
modules/transport-netty3/src/test/java/org/elasticsearch/http/netty3/Netty3HttpServerTransportTests.java
modules/transport-netty3/src/test/java/org/elasticsearch/http/netty3/Netty3PipeliningDisabledIT.java
modules/transport-netty3/src/test/java/org/elasticsearch/http/netty3/Netty3PipeliningEnabledIT.java
modules/transport-netty3/src/test/java/org/elasticsearch/http/netty3/pipelining/HttpPipeliningHandlerTests.java
modules/transport-netty3/src/test/java/org/elasticsearch/rest/Netty3HeadBodyIsEmptyIT.java
modules/transport-netty3/src/test/java/org/elasticsearch/transport/Netty3SizeHeaderFrameDecoderTests.java
modules/transport-netty3/src/test/java/org/elasticsearch/transport/netty3/ChannelBufferBytesReferenceTests.java
modules/transport-netty3/src/test/java/org/elasticsearch/transport/netty3/Netty3ScheduledPingTests.java
modules/transport-netty3/src/test/java/org/elasticsearch/transport/netty3/Netty3TransportIT.java
modules/transport-netty3/src/test/java/org/elasticsearch/transport/netty3/Netty3TransportMultiPortIntegrationIT.java
modules/transport-netty3/src/test/java/org/elasticsearch/transport/netty3/Netty3TransportMultiPortTests.java
modules/transport-netty3/src/test/java/org/elasticsearch/transport/netty3/Netty3TransportPublishAddressIT.java
modules/transport-netty3/src/test/java/org/elasticsearch/transport/netty3/Netty3UtilsTests.java
modules/transport-netty3/src/test/java/org/elasticsearch/transport/netty3/SimpleNetty3TransportTests.java
qa/smoke-test-client/src/test/java/org/elasticsearch/smoketest/ESSmokeClientTestCase.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/CorsRegexIT.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/HttpSmokeTestCase.java
comments:
Remove `modules/transport_netty_3` in favor of `netty_4` (#21590)

We kept `netty_3` as a fallback in the 5.x series but now that master
is 6.0 we don't need this or in other words all issues coming up with
netty 4 will be blockers for 6.0.

time:
2016-11-17T09:58:09Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/bootstrap/Spawner.java
core/src/test/java/org/elasticsearch/bootstrap/SpawnerTests.java
qa/no-bootstrap-tests/src/test/java/org/elasticsearch/bootstrap/SpawnerNoBootstrapTests.java
comments:
Adjust bootstrap sequence (#21543)

Added the ability for plugins to spawn a controller process at startup

time:
2016-11-17T09:21:23Z
class:
comments:
Merge branch 'doc/lenient-multi-match'

time:
2016-11-17T08:33:32Z
class:
core/src/main/java/org/apache/lucene/store/RateLimitedFSDirectory.java
core/src/main/java/org/apache/lucene/store/StoreRateLimiting.java
core/src/main/java/org/apache/lucene/store/StoreUtils.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/main/java/org/elasticsearch/index/IndexModule.java
core/src/main/java/org/elasticsearch/index/store/DirectoryService.java
core/src/main/java/org/elasticsearch/index/store/FsDirectoryService.java
core/src/main/java/org/elasticsearch/index/store/IndexStore.java
core/src/main/java/org/elasticsearch/index/store/IndexStoreConfig.java
core/src/main/java/org/elasticsearch/index/store/Store.java
core/src/main/java/org/elasticsearch/index/store/StoreStats.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/test/java/org/elasticsearch/cluster/DiskUsageTests.java
core/src/test/java/org/elasticsearch/cluster/settings/ClusterSettingsIT.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/engine/ShadowEngineTests.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
core/src/test/java/org/elasticsearch/index/store/FsDirectoryServiceTests.java
core/src/test/java/org/elasticsearch/index/store/IndexStoreTests.java
core/src/test/java/org/elasticsearch/index/store/StoreTests.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySourceHandlerTests.java
core/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsIT.java
core/src/test/java/org/elasticsearch/indices/stats/IndexStatsIT.java
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
plugins/store-smb/src/main/java/org/elasticsearch/index/store/smbmmapfs/SmbMmapFsIndexStore.java
plugins/store-smb/src/main/java/org/elasticsearch/index/store/smbsimplefs/SmbSimpleFsIndexStore.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
test/framework/src/main/java/org/elasticsearch/test/store/MockFSDirectoryService.java
test/framework/src/main/java/org/elasticsearch/test/store/MockFSIndexStore.java
comments:
Remove store throttling. (#21573)

Store throttling has been disabled by default since Lucene added automatic
throttling of merge operations based on the indexing rate.

time:
2016-11-17T07:35:20Z
class:
comments:
Add documentation for lenient in multimatch

`lenient` option is documented for `match` query but not for `multi_match` query.

time:
2016-11-17T02:45:14Z
class:
comments:
Truncate log messages from the end

Our default pattern layout truncates log messages. This is to avoid
blowing disk space from excessively log messages, which can happen if a
message contains a mapping or an large query. Yet, we trunacte from the
beginning which is probably where the most germane information is. This
commit modifies the default pattern layout to trunacte from the end.

Relates #21609

time:
2016-11-17T00:22:01Z
class:
plugins/delete-by-query/src/test/java/org/elasticsearch/action/deletebyquery/TransportDeleteByQueryActionTests.java
comments:
Remove rogue file from the by-gone days of 2.x.

time:
2016-11-16T19:46:52Z
class:
comments:
Fix shrink tests on disks w/<15% free

The tests rely on the allocation decider allowing allocation and
the disk threshold decider wasn't allowing it. This came up from
time to in CI but *all* the time on my local machine because it is
a small ssd.

time:
2016-11-16T17:43:47Z
class:
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/test/java/org/elasticsearch/search/SearchServiceTests.java
comments:
Respect default search timeout

The default search timeout is not respected because the timeout is
unconditionally set from the query. This commit fixes this issue, and
adds a test that the default search timeout is correctly attached to the
search context.

Relates #21599

time:
2016-11-16T15:15:28Z
class:
comments:
Add documentation for lenient in multimatch

`lenient` option is documented for `match` query but not for `multi_match` query.

time:
2016-11-16T14:10:35Z
class:
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsResponse.java
core/src/main/java/org/elasticsearch/action/get/GetResponse.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/common/rounding/Rounding.java
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/main/java/org/elasticsearch/index/IndexModule.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/ShadowEngine.java
core/src/main/java/org/elasticsearch/index/mapper/BooleanFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/shard/ElasticsearchQueryCachingPolicy.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/ingest/IngestDocument.java
core/src/main/java/org/elasticsearch/rest/BaseRestHandler.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesInfoAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesStatsAction.java
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsResponseTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
core/src/test/java/org/elasticsearch/common/rounding/TimeZoneRoundingTests.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalValuesMapperIntegrationIT.java
core/src/test/java/org/elasticsearch/index/shard/ElasticsearchQueryCachingPolicyTests.java
core/src/test/java/org/elasticsearch/rest/action/admin/cluster/RestNodesStatsActionTests.java
core/src/test/java/org/elasticsearch/rest/action/admin/indices/RestIndicesStatsActionTests.java
core/src/test/java/org/elasticsearch/search/query/QueryStringIT.java
core/src/test/java/org/elasticsearch/search/query/SearchQueryIT.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/AbstractStringProcessor.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ConvertProcessor.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/GrokProcessor.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/SplitProcessor.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/GrokProcessorTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/SplitProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/SplitProcessorTests.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
comments:
Merge branch 'master' into feature/seq_no

* master: (22 commits)
  Add proper toString() method to UpdateTask (#21582)
  Fix `InternalEngine#isThrottled` to not always return `false`. (#21592)
  add `ignore_missing` option to SplitProcessor (#20982)
  fix trace_match behavior for when there is only one grok pattern (#21413)
  Remove dead code from GetResponse.java
  Fixes date range query using epoch with timezone (#21542)
  Do not cache term queries. (#21566)
  Updated dynamic mapper section
  Docs: Clarify date_histogram bucket sizes for DST time zones
  Handle release of 5.0.1
  Fix skip reason for stats API parameters test
  Reduce skip version for stats API parameter tests
  Strict level parsing for indices stats
  Remove cluster update task when task times out (#21578)
  [DOCS] Mention "all-fields" mode doesn't search across nested documents
  InternalTestCluster: when restarting a node we should validate the cluster is formed via the node we just restarted
  Fixed bad asciidoc in boolean mapping docs
  Fixed bad asciidoc ID in node stats
  Be strict when parsing values searching for booleans (#21555)
  Fix time zone rounding edge case for DST overlaps
  ...

time:
2016-11-16T14:09:38Z
class:
comments:
Temporarily set BWC version to 6.0.0 for seq. no

There is not yet a BWC layer in sequence numbers. This commit sets the
BWC version to 6.0.0 for the BWC and rolling upgrade tests until this
BWC layer is built.

time:
2016-11-16T14:09:35Z
class:
comments:
Revert "disable backwards-5.0 tests as there is no BWC layer in the seq# related components"

This reverts commit db87837c72a2659cd739eca88a0314c9342338fa.

time:
2016-11-16T14:07:26Z
class:
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
comments:
Add proper toString() method to UpdateTask (#21582)

Adds a proper toString() method to ClusterService.UpdateTask

time:
2016-11-16T14:01:05Z
class:
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/ShadowEngine.java
comments:
Fix `InternalEngine#isThrottled` to not always return `false`. (#21592)

Currently it inherits from the default implementation which always returns
`false`, even if indexing is being throttled.

time:
2016-11-16T13:46:09Z
class:
core/src/main/java/org/elasticsearch/ingest/IngestDocument.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/AbstractStringProcessor.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ConvertProcessor.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/GrokProcessor.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/SplitProcessor.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/SplitProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/SplitProcessorTests.java
comments:
add `ignore_missing` option to SplitProcessor (#20982)

Closes #20840.

time:
2016-11-16T13:41:54Z
class:
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/GrokProcessor.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/GrokProcessorTests.java
comments:
fix trace_match behavior for when there is only one grok pattern (#21413)

There is an issue in the Grok Processor, where trace_match: true does not inject the _ingest._grok_match_index into the ingest-document when there is just one pattern provided. This is due to an optimization in the regex construction. This commit adds a check for when this is the case, and injects a static index value of "0", since there is only one pattern matched (at the first index into the patterns).

To make this clearer, more documentation was added to the grok-processor docs.

Fixes #21371.

time:
2016-11-16T10:29:14Z
class:
comments:
Update to Tika 1.14

Closes #20390.

time:
2016-11-16T09:48:15Z
class:
core/src/main/java/org/elasticsearch/action/get/GetResponse.java
comments:
Remove dead code from GetResponse.java

time:
2016-11-16T09:11:04Z
class:
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldTypeTests.java
core/src/test/java/org/elasticsearch/search/query/SearchQueryIT.java
comments:
Fixes date range query using epoch with timezone (#21542)

This change fixes the rnage query so that an exception is always thrown if the range query uses epoch time together with a time zone. Since epoch time is always UTC it should not be used with a time zone.

Closes #21501

time:
2016-11-16T09:02:24Z
class:
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/main/java/org/elasticsearch/index/IndexModule.java
core/src/main/java/org/elasticsearch/index/shard/ElasticsearchQueryCachingPolicy.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/test/java/org/elasticsearch/index/shard/ElasticsearchQueryCachingPolicyTests.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
comments:
Do not cache term queries. (#21566)

There have been reports that the query cache did not manage to speed up search
requests when the query includes a large number of different sub queries since
a single request may manage to exhaust the whole history (256 queries) while
the query cache only starts caching queries once they appear multiple times in
the history (#16031). On the other hand, increasing the size of the query cache
is a bit controversial (#20116) so this pull request proposes a different
approach that consists of never caching term queries, and not adding them to the
history of queries either. The reasoning is that these queries should be fast
anyway, regardless of caching, so taking them out of the equation should not
cause any slow down. On the other hand, the fact that they are not added to the
cache history anymore means that other queries have greater chances of being
cached.

time:
2016-11-16T08:52:08Z
class:
comments:
Updated dynamic mapper section

Backport of #21574 in master (6.0)

time:
2016-11-16T08:40:07Z
class:
comments:
Docs: Clarify date_histogram bucket sizes for DST time zones

Added a warning note that clarifies bucket sizes diverging from the intended
`interval` size when using a time zone that has DST changes.

Closes #18805

time:
2016-11-16T08:04:08Z
class:
comments:
disable backwards-5.0 tests as there is no BWC layer in the seq# related components

time:
2016-11-16T00:31:28Z
class:
core/src/main/java/org/elasticsearch/Version.java
core/src/test/java/org/elasticsearch/VersionTests.java
comments:
Handle release of 5.0.1

Adds a version constant for it, bwc indices, and a vagrant upgrade-from
version. Also bumps the "upgrade from" version for the backwards-5.0
test and adds `skip`s for tests that don't fail against 5.0 so we skip
them during the backwards testing.

Finally, this skips the "Shrink index via API" test because it fails
consistently for me. Inconsistently for CI, but consistently for me.
I'll work on making it consistent tomorrow.

time:
2016-11-15T22:52:45Z
class:
comments:
Fix skip reason for stats API parameters test

This commit corrects the reasons that the stats API parameters tests are
skipped against 5.0 nodes.

time:
2016-11-15T22:43:19Z
class:
comments:
Reduce skip version for stats API parameter tests

This commit reduces the skip version for the stats API unrecognized
parameter tests now that the logic for unrecognized parameters has been
backported to 5.x.

time:
2016-11-15T21:26:37Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsResponse.java
core/src/test/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsResponseTests.java
comments:
Strict level parsing for indices stats

A previous commit added strict level parsing for the node stats API, but
that commit missed adding the same for the indices stats API. This
commit rectifies this miss.

Relates #21577

time:
2016-11-15T20:38:58Z
class:
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
comments:
Remove cluster update task when task times out (#21578)

Fixes an issue where the cluster service does not remove an update task from its internal data structures that are used for batching cluster state updates.

* review comments

* checkstyle

time:
2016-11-15T18:02:43Z
class:
comments:
[DOCS] Mention "all-fields" mode doesn't search across nested documents

time:
2016-11-15T17:58:08Z
class:
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
comments:
InternalTestCluster: when restarting a node we should validate the cluster is formed via the node we just restarted

This is to deal with potential delays in processing the fact that node was node is restarted.

time:
2016-11-15T17:50:23Z
class:
comments:
Fixed bad asciidoc in boolean mapping docs

time:
2016-11-15T17:39:15Z
class:
comments:
Fixed bad asciidoc ID in node stats

time:
2016-11-15T17:36:57Z
class:
core/src/main/java/org/elasticsearch/index/mapper/BooleanFieldMapper.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalValuesMapperIntegrationIT.java
core/src/test/java/org/elasticsearch/search/query/QueryStringIT.java
comments:
Be strict when parsing values searching for booleans (#21555)

This changes only the query parsing behavior to be strict when searching on
boolean values. We continue to accept the variety of values during index time,
but searches will only be parsed using `"true"` or `"false"`.

Resolves #21545

time:
2016-11-15T17:36:06Z
class:
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
comments:
remove an unneeded assert busy

time:
2016-11-15T17:23:47Z
class:
core/src/main/java/org/elasticsearch/common/rounding/Rounding.java
core/src/test/java/org/elasticsearch/common/rounding/TimeZoneRoundingTests.java
comments:
Fix time zone rounding edge case for DST overlaps

When using TimeUnitRounding with a DAY_OF_MONTH unit, failing tests in #20833
uncovered an issue when the DST shift happenes just one hour after midnight
local time and sets back the clock to midnight, leading to an overlap.
Previously this would lead to two different rounding values, depending on
whether a date before or after the transition was rounded. This change detects
this special case and correct for it by using the previous rounding date for
both cases.

Closes #20833

time:
2016-11-15T17:18:49Z
class:
comments:
Minor style change to getting-started.asciidoc (#21571)

* In line 525, change the phrase "... with as little network roundtrips as possible." to "... with as few network roundtrips as possible."

time:
2016-11-15T17:17:26Z
class:
core/src/main/java/org/elasticsearch/rest/BaseRestHandler.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesInfoAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesStatsAction.java
core/src/test/java/org/elasticsearch/rest/action/admin/cluster/RestNodesStatsActionTests.java
core/src/test/java/org/elasticsearch/rest/action/admin/indices/RestIndicesStatsActionTests.java
comments:
Remove lenient stats parsing

Today when parsing a stats request, Elasticsearch silently ignores
incorrect metrics. This commit removes lenient parsing of stats requests
for the nodes stats and indices stats APIs.

Relates #21417

time:
2016-11-15T17:09:08Z
class:
core/src/main/java/org/elasticsearch/common/util/concurrent/EsThreadPoolExecutor.java
core/src/main/java/org/elasticsearch/common/util/concurrent/ThreadContext.java
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenPing.java
core/src/main/java/org/elasticsearch/index/mapper/Mapper.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/test/java/org/elasticsearch/action/admin/indices/exists/IndicesExistsIT.java
core/src/test/java/org/elasticsearch/action/support/master/IndexingMasterFailoverIT.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/NoMasterNodeIT.java
core/src/test/java/org/elasticsearch/cluster/ack/AckClusterUpdateSettingsIT.java
core/src/test/java/org/elasticsearch/cluster/ack/AckIT.java
core/src/test/java/org/elasticsearch/cluster/allocation/AwarenessAllocationIT.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceIT.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/discovery/ZenUnicastDiscoveryIT.java
core/src/test/java/org/elasticsearch/gateway/QuorumGatewayIT.java
core/src/test/java/org/elasticsearch/gateway/RecoverAfterNodesIT.java
core/src/test/java/org/elasticsearch/gateway/RecoveryFromGatewayIT.java
core/src/test/java/org/elasticsearch/indices/recovery/IndexRecoveryIT.java
core/src/test/java/org/elasticsearch/indices/state/RareClusterStateIT.java
core/src/test/java/org/elasticsearch/recovery/FullRollingRestartIT.java
core/src/test/java/org/elasticsearch/recovery/RelocationIT.java
core/src/test/java/org/elasticsearch/tribe/TribeIT.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolatorFieldMapper.java
plugins/discovery-azure-classic/src/test/java/org/elasticsearch/discovery/azure/classic/AzureMinimumMasterNodesTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryUpdateSettingsTests.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
test/framework/src/main/java/org/elasticsearch/test/discovery/MockZenPing.java
test/framework/src/main/java/org/elasticsearch/test/hamcrest/ElasticsearchAssertions.java
test/framework/src/test/java/org/elasticsearch/test/test/InternalTestClusterTests.java
comments:
Merge remote-tracking branch 'upstream/master' into feature/seq_no

time:
2016-11-15T16:57:26Z
class:
comments:
Fix incorrect instructions for disabling deprecation logging (#21569)

We log deprecation events at "WARN", so setting it to `info` means the events
are still logged. It must be set to `error` in order to disable the logging.

time:
2016-11-15T16:47:17Z
class:
comments:
Update docs for scripted metric agg

Now that the default language is painless the examples didn't work at
all. This fixes them.

Closes #21536

time:
2016-11-15T16:42:57Z
class:
comments:
[TEST] Ensure file permission for /etc/sudoers.d/elasticsearch_vars

Ubuntu 12.04 checks the file permission for /etc/sudoers.d/elasticsearch_vars is mode 0440. This commit adds a `chmod` before the file is used by the `sudo` command.

time:
2016-11-15T15:00:44Z
class:
comments:
Fix recurring doc test failures with the cat API. (#21561)

This failure is due to the fact that we sort on store size, which is cached. So
it might happen that the store size that is taken into account is not the right
one, which makes the indices sorted in the wrong order. This changes the doc
example to sort on the number of docs instead.

Closes #21062

time:
2016-11-15T14:45:18Z
class:
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolatorFieldMapper.java
comments:
Do not cache the QueryShardContext in PercolatorFieldMapper: it is cheap to create.

time:
2016-11-15T14:19:34Z
class:
comments:
[Tests] Do not pass all env vars to sudo (#21562)

In #21348 the command executed to run the packaging tests has been changed to "sudo -E bats ...", forcing all environment variables from the vagrant user to be passed to the `sudo` command. This breaks a test on opensuse-13 (the one where it checks that elasticsearch cannot be started when `java` is not found) because all the PATH from the user is passed to the sudo command.

This commit restores the previous behavior while allowing only necessary testing environment variables to be passed using a /etc/sudoers.d file.

time:
2016-11-15T13:42:26Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenPing.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/test/java/org/elasticsearch/action/admin/indices/exists/IndicesExistsIT.java
core/src/test/java/org/elasticsearch/action/support/master/IndexingMasterFailoverIT.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/NoMasterNodeIT.java
core/src/test/java/org/elasticsearch/cluster/ack/AckClusterUpdateSettingsIT.java
core/src/test/java/org/elasticsearch/cluster/ack/AckIT.java
core/src/test/java/org/elasticsearch/cluster/allocation/AwarenessAllocationIT.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceIT.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/discovery/ZenUnicastDiscoveryIT.java
core/src/test/java/org/elasticsearch/gateway/QuorumGatewayIT.java
core/src/test/java/org/elasticsearch/gateway/RecoverAfterNodesIT.java
core/src/test/java/org/elasticsearch/gateway/RecoveryFromGatewayIT.java
core/src/test/java/org/elasticsearch/indices/recovery/IndexRecoveryIT.java
core/src/test/java/org/elasticsearch/indices/state/RareClusterStateIT.java
core/src/test/java/org/elasticsearch/recovery/FullRollingRestartIT.java
core/src/test/java/org/elasticsearch/recovery/RelocationIT.java
core/src/test/java/org/elasticsearch/tribe/TribeIT.java
plugins/discovery-azure-classic/src/test/java/org/elasticsearch/discovery/azure/classic/AzureMinimumMasterNodesTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryUpdateSettingsTests.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
test/framework/src/main/java/org/elasticsearch/test/discovery/MockZenPing.java
test/framework/src/main/java/org/elasticsearch/test/hamcrest/ElasticsearchAssertions.java
test/framework/src/test/java/org/elasticsearch/test/test/InternalTestClusterTests.java
comments:
Adapt InternalTestCluster to auto adjust `minimum_master_nodes` (#21458)

#20960 removed `LocalDiscovery` and we now use `ZenDiscovery` in all our tests. To keep cluster forming fast, we are using a `MockZenPing` implementation which uses static maps to return instant results making master election fast. Currently, we don't set `minimum_master_nodes` causing the occasional split brain when starting multiple nodes concurrently and their pinging is so fast that it misses the fact that one of the node has elected it self master. To solve this, `InternalTestCluster` is modified to behave like a true cluster and manage and set `minimum_master_nodes` correctly with every change to the number of nodes.

Tests that want to manage the settings themselves can opt out using a new `autoMinMasterNodes` parameter to the `ClusterScope` annotation. 

Having `min_master_nodes` set means the started node may need to wait for other nodes to be started as well. To combat this, we set `discovery.initial_state_timeout` to `0` and wait for the cluster to form once all node have been started. Also, because a node may wait and ping while other nodes are started, `MockZenPing` is adapted to wait rather than busy-ping.

time:
2016-11-15T13:34:54Z
class:
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
Fix internal engine sequence number test bug

This commit fixes a test bug in internal engine tests, and adds some
additional assertions.

time:
2016-11-15T12:55:50Z
class:
core/src/main/java/org/elasticsearch/common/util/concurrent/EsThreadPoolExecutor.java
core/src/main/java/org/elasticsearch/common/util/concurrent/ThreadContext.java
comments:
Don't fail in `afterExecute` if context is already closed (#21563)

We run an assert on an potentially closed thread context. this should
not bubble up the `IllegalStateException`.

time:
2016-11-15T11:02:40Z
class:
core/src/main/java/org/elasticsearch/index/mapper/Mapper.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolatorFieldMapper.java
comments:
Make PercolatorFieldMapper get a QueryShardContext lazily.
I wonder if we can skip the volatile read here for the cost of potentially creating the object more than once? I think that is the better tradeoff - not big deal though
you are right. I just checked and the supplier is always cheap to call anyway, so no need for caching at all. I'll simplify.

time:
2016-11-15T10:14:47Z
class:
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/NoopPlugin.java
core/src/main/java/org/apache/lucene/index/XPointValues.java
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/action/ActionRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/liveness/LivenessRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/GetTaskRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetFieldMappingsRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingClusterStateUpdateRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestBuilder.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequest.java
core/src/main/java/org/elasticsearch/action/ingest/IngestActionFilter.java
core/src/main/java/org/elasticsearch/action/ingest/IngestProxyActionFilter.java
core/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java
core/src/main/java/org/elasticsearch/action/main/MainRequest.java
core/src/main/java/org/elasticsearch/action/search/ClearScrollRequest.java
core/src/main/java/org/elasticsearch/action/search/MultiSearchRequest.java
core/src/main/java/org/elasticsearch/action/search/SearchRequest.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollRequest.java
core/src/main/java/org/elasticsearch/action/support/ActionFilter.java
core/src/main/java/org/elasticsearch/action/support/ActionFilterChain.java
core/src/main/java/org/elasticsearch/action/support/HandledTransportAction.java
core/src/main/java/org/elasticsearch/action/support/TransportAction.java
core/src/main/java/org/elasticsearch/action/support/broadcast/BroadcastRequest.java
core/src/main/java/org/elasticsearch/action/support/master/MasterNodeRequest.java
core/src/main/java/org/elasticsearch/action/support/nodes/BaseNodesRequest.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationRequest.java
core/src/main/java/org/elasticsearch/action/support/single/instance/InstanceShardOperationRequest.java
core/src/main/java/org/elasticsearch/action/support/single/shard/SingleShardRequest.java
core/src/main/java/org/elasticsearch/action/support/tasks/BaseTasksRequest.java
core/src/main/java/org/elasticsearch/action/termvectors/MultiTermVectorsRequest.java
core/src/main/java/org/elasticsearch/bootstrap/Security.java
core/src/main/java/org/elasticsearch/client/ElasticsearchClient.java
core/src/main/java/org/elasticsearch/client/FilterClient.java
core/src/main/java/org/elasticsearch/client/ParentTaskAssigningClient.java
core/src/main/java/org/elasticsearch/client/node/NodeClient.java
core/src/main/java/org/elasticsearch/client/support/AbstractClient.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java
core/src/main/java/org/elasticsearch/cluster/routing/IndexShardRoutingTable.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/common/transport/TransportAddress.java
core/src/main/java/org/elasticsearch/common/util/concurrent/BaseFuture.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/index/IndexModule.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/IndexShardAlreadyExistsException.java
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IpFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/index/mapper/NumberFieldMapper.java
core/src/main/java/org/elasticsearch/indices/IndexTemplateAlreadyExistsException.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/ActionPlugin.java
core/src/main/java/org/elasticsearch/plugins/DiscoveryPlugin.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/ParentFieldSubFetchPhase.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/action/ActionModuleTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TestTaskPlugin.java
core/src/test/java/org/elasticsearch/action/support/TransportActionFilterChainTests.java
core/src/test/java/org/elasticsearch/action/support/master/IndexingMasterFailoverIT.java
core/src/test/java/org/elasticsearch/client/ParentTaskAssigningClientTests.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientIT.java
core/src/test/java/org/elasticsearch/cluster/ClusterInfoServiceIT.java
core/src/test/java/org/elasticsearch/cluster/ClusterStateDiffIT.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/health/ClusterStateHealthTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataMappingServiceTests.java
core/src/test/java/org/elasticsearch/cluster/routing/PrimaryAllocationIT.java
core/src/test/java/org/elasticsearch/cluster/routing/RandomShardRoutingMutator.java
core/src/test/java/org/elasticsearch/cluster/routing/RoutingTableTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryModuleTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/indices/IndicesServiceTests.java
core/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsIT.java
core/src/test/java/org/elasticsearch/indices/state/RareClusterStateIT.java
core/src/test/java/org/elasticsearch/indices/store/IndicesStoreTests.java
core/src/test/java/org/elasticsearch/indices/template/SimpleIndexTemplateIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/InnerHitsIT.java
core/src/test/java/org/elasticsearch/transport/TCPTransportTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequest.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MustachePlugin.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/SearchTemplateRequest.java
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateRequest.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateRequest.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolatorPlugin.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByScrollRequest.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexPlugin.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AbstractAsyncBulkIndexByScrollActionScriptTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AsyncBulkByScrollActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteWithAuthTests.java
plugins/discovery-azure-classic/src/main/java/org/elasticsearch/plugin/discovery/azure/classic/AzureDiscoveryPlugin.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/plugin/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/discovery-gce/src/main/java/org/elasticsearch/plugin/discovery/gce/GceDiscoveryPlugin.java
qa/evil-tests/src/test/java/org/elasticsearch/tribe/TribeUnitTests.java
qa/smoke-test-tribe-node/src/test/java/org/elasticsearch/tribe/TribeClientYamlTestSuiteIT.java
test/framework/src/main/java/org/elasticsearch/node/MockNode.java
test/framework/src/main/java/org/elasticsearch/test/ESBackcompatTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java
test/framework/src/main/java/org/elasticsearch/test/client/NoOpClient.java
test/framework/src/main/java/org/elasticsearch/test/discovery/MockZenPing.java
test/framework/src/main/java/org/elasticsearch/test/discovery/TestZenDiscovery.java
test/framework/src/main/java/org/elasticsearch/test/hamcrest/ElasticsearchAssertions.java
test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java
test/framework/src/test/java/org/elasticsearch/test/test/InternalTestClusterTests.java
comments:
Merge remote-tracking branch 'upstream/master' into feature/seq_no

time:
2016-11-15T09:59:59Z
class:
comments:
[TEST] Add master_timeout to shrink call to fail faster

time:
2016-11-15T09:49:02Z
class:
comments:
Update geohashgrid-aggregation.asciidoc (#21530)

time:
2016-11-15T09:48:39Z
class:
core/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsIT.java
comments:
[TEST] Don't stop MockAppender some nodes might concurrently use it

time:
2016-11-15T09:47:34Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingClusterStateUpdateRequest.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java
core/src/main/java/org/elasticsearch/index/IndexModule.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataMappingServiceTests.java
core/src/test/java/org/elasticsearch/indices/IndicesServiceTests.java
core/src/test/java/org/elasticsearch/indices/state/RareClusterStateIT.java
comments:
Uncommitted mapping updates should not efect existing indices (#21306)

When processing a mapping updates, the master current creates an `IndexService` and uses its mapper service to do the hard work. However, if the master is also a data node and it already has an instance of `IndexService`, we currently reuse the the `MapperService` of that instance. Sadly, since mapping updates are change the in memory objects, this means that a mapping change that can rejected later on during cluster state publishing will leave a side effect on the index in question, bypassing the cluster state safety mechanism.

This commit removes this optimization and replaces the `IndexService` creation with a direct creation of a `MapperService`. 

Also, this fixes an issue multiple from multiple shards for the same field caused unneeded cluster state publishing as the current code always created a new cluster state.

This were discovered while researching #21189

time:
2016-11-15T09:11:41Z
class:
core/src/main/java/org/apache/lucene/index/XPointValues.java
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IpFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/NumberFieldMapper.java
comments:
Remove XPointValues. (#21541)

This class had been added to address a bug in PointValues, which has been fixed
since then.

time:
2016-11-15T08:31:32Z
class:
comments:
Use pre-JDK9 style FilePermissions on JDK9 (#21540)

JDK9 removed pathname canonicalization when constructing FilePermission objects, which breaks some of the FilePermissions added by Elasticsearch. This commit adds the system property jdk.io.permissionsUseCanonicalPath which makes JDK9 behave like JDK8 w.r.t. FilePermission objects (see #21534).

time:
2016-11-15T06:32:28Z
class:
core/src/main/java/org/elasticsearch/search/fetch/subphase/ParentFieldSubFetchPhase.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/InnerHitsIT.java
comments:
inner_hits: Skip adding a parent field to nested documents.

Otherwise an empty string get added as _parent field.

Closes #21503

time:
2016-11-15T05:46:10Z
class:
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/DiscoveryPlugin.java
core/src/test/java/org/elasticsearch/action/support/master/IndexingMasterFailoverIT.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientIT.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/routing/PrimaryAllocationIT.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryModuleTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/indices/state/RareClusterStateIT.java
plugins/discovery-azure-classic/src/main/java/org/elasticsearch/plugin/discovery/azure/classic/AzureDiscoveryPlugin.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/plugin/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/discovery-gce/src/main/java/org/elasticsearch/plugin/discovery/gce/GceDiscoveryPlugin.java
qa/evil-tests/src/test/java/org/elasticsearch/tribe/TribeUnitTests.java
test/framework/src/main/java/org/elasticsearch/node/MockNode.java
test/framework/src/main/java/org/elasticsearch/test/ESBackcompatTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java
test/framework/src/main/java/org/elasticsearch/test/discovery/MockZenPing.java
test/framework/src/main/java/org/elasticsearch/test/discovery/TestZenDiscovery.java
test/framework/src/test/java/org/elasticsearch/test/test/InternalTestClusterTests.java
comments:
Tests: Add TestZenDiscovery and replace uses of MockZenPing with it (#21488)


This changes adds a test discovery (which internally uses the existing
mock zenping by default). Having the mock the test framework selects be a discovery
greatly simplifies discovery setup (no more weird callback to a Node
method).

time:
2016-11-15T00:31:17Z
class:
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/NoopPlugin.java
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/action/ActionRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/liveness/LivenessRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/GetTaskRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetFieldMappingsRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequest.java
core/src/main/java/org/elasticsearch/action/ingest/IngestActionFilter.java
core/src/main/java/org/elasticsearch/action/ingest/IngestProxyActionFilter.java
core/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java
core/src/main/java/org/elasticsearch/action/main/MainRequest.java
core/src/main/java/org/elasticsearch/action/search/ClearScrollRequest.java
core/src/main/java/org/elasticsearch/action/search/MultiSearchRequest.java
core/src/main/java/org/elasticsearch/action/search/SearchRequest.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollRequest.java
core/src/main/java/org/elasticsearch/action/support/ActionFilter.java
core/src/main/java/org/elasticsearch/action/support/ActionFilterChain.java
core/src/main/java/org/elasticsearch/action/support/HandledTransportAction.java
core/src/main/java/org/elasticsearch/action/support/TransportAction.java
core/src/main/java/org/elasticsearch/action/support/broadcast/BroadcastRequest.java
core/src/main/java/org/elasticsearch/action/support/master/MasterNodeRequest.java
core/src/main/java/org/elasticsearch/action/support/nodes/BaseNodesRequest.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationRequest.java
core/src/main/java/org/elasticsearch/action/support/single/instance/InstanceShardOperationRequest.java
core/src/main/java/org/elasticsearch/action/support/single/shard/SingleShardRequest.java
core/src/main/java/org/elasticsearch/action/support/tasks/BaseTasksRequest.java
core/src/main/java/org/elasticsearch/action/termvectors/MultiTermVectorsRequest.java
core/src/main/java/org/elasticsearch/client/ElasticsearchClient.java
core/src/main/java/org/elasticsearch/client/FilterClient.java
core/src/main/java/org/elasticsearch/client/ParentTaskAssigningClient.java
core/src/main/java/org/elasticsearch/client/node/NodeClient.java
core/src/main/java/org/elasticsearch/client/support/AbstractClient.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/plugins/ActionPlugin.java
core/src/test/java/org/elasticsearch/action/ActionModuleTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TestTaskPlugin.java
core/src/test/java/org/elasticsearch/action/support/TransportActionFilterChainTests.java
core/src/test/java/org/elasticsearch/client/ParentTaskAssigningClientTests.java
core/src/test/java/org/elasticsearch/cluster/ClusterInfoServiceIT.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequest.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MustachePlugin.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/SearchTemplateRequest.java
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateRequest.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateRequest.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolatorPlugin.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByScrollRequest.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexPlugin.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AbstractAsyncBulkIndexByScrollActionScriptTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AsyncBulkByScrollActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteWithAuthTests.java
test/framework/src/main/java/org/elasticsearch/test/client/NoOpClient.java
test/framework/src/main/java/org/elasticsearch/test/hamcrest/ElasticsearchAssertions.java
comments:
Remove generics from ActionRequest (#21556)

closes #21368

time:
2016-11-14T23:32:01Z
class:
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/NoopPlugin.java
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/action/ActionRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/liveness/LivenessRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/GetTaskRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetFieldMappingsRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequest.java
core/src/main/java/org/elasticsearch/action/ingest/IngestActionFilter.java
core/src/main/java/org/elasticsearch/action/ingest/IngestProxyActionFilter.java
core/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java
core/src/main/java/org/elasticsearch/action/main/MainRequest.java
core/src/main/java/org/elasticsearch/action/search/ClearScrollRequest.java
core/src/main/java/org/elasticsearch/action/search/MultiSearchRequest.java
core/src/main/java/org/elasticsearch/action/search/SearchRequest.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollRequest.java
core/src/main/java/org/elasticsearch/action/support/ActionFilter.java
core/src/main/java/org/elasticsearch/action/support/ActionFilterChain.java
core/src/main/java/org/elasticsearch/action/support/HandledTransportAction.java
core/src/main/java/org/elasticsearch/action/support/TransportAction.java
core/src/main/java/org/elasticsearch/action/support/broadcast/BroadcastRequest.java
core/src/main/java/org/elasticsearch/action/support/master/MasterNodeRequest.java
core/src/main/java/org/elasticsearch/action/support/nodes/BaseNodesRequest.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationRequest.java
core/src/main/java/org/elasticsearch/action/support/single/instance/InstanceShardOperationRequest.java
core/src/main/java/org/elasticsearch/action/support/single/shard/SingleShardRequest.java
core/src/main/java/org/elasticsearch/action/support/tasks/BaseTasksRequest.java
core/src/main/java/org/elasticsearch/action/termvectors/MultiTermVectorsRequest.java
core/src/main/java/org/elasticsearch/client/ElasticsearchClient.java
core/src/main/java/org/elasticsearch/client/FilterClient.java
core/src/main/java/org/elasticsearch/client/ParentTaskAssigningClient.java
core/src/main/java/org/elasticsearch/client/node/NodeClient.java
core/src/main/java/org/elasticsearch/client/support/AbstractClient.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/plugins/ActionPlugin.java
core/src/test/java/org/elasticsearch/action/ActionModuleTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TestTaskPlugin.java
core/src/test/java/org/elasticsearch/action/support/TransportActionFilterChainTests.java
core/src/test/java/org/elasticsearch/client/ParentTaskAssigningClientTests.java
core/src/test/java/org/elasticsearch/cluster/ClusterInfoServiceIT.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequest.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MustachePlugin.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/SearchTemplateRequest.java
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateRequest.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateRequest.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolatorPlugin.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByScrollRequest.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexPlugin.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AbstractAsyncBulkIndexByScrollActionScriptTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AsyncBulkByScrollActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteWithAuthTests.java
test/framework/src/main/java/org/elasticsearch/test/client/NoOpClient.java
test/framework/src/main/java/org/elasticsearch/test/hamcrest/ElasticsearchAssertions.java
comments:
Remove generics from ActionRequest

closes #21368

time:
2016-11-14T20:09:45Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Security.java
qa/smoke-test-tribe-node/src/test/java/org/elasticsearch/tribe/TribeClientYamlTestSuiteIT.java
test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java
comments:
Add socket permissions for tribe nodes

Today when a node starts, we create dynamic socket permissions based on
the configured HTTP ports and transport ports. If no ports are
configured, we use the default port ranges. When a tribe node starts, a
tribe node creates an internal node client for connecting to each remote
cluster. If neither an explicit HTTP port nor transport ports were
specified, the default port ranges are large enough for the tribe node
and its internal node clients. If an explicit HTTP port or transport
port was specified for the tribe node, then socket permissions for those
ports will be created, but not for the internal node clients. Whether
the internal node clients have explicit ports specified, or attempt to
bind within the default range, socket permissions for these will not
have been created and the internal node clients will hit a permissions
issue when attempting to bind. This commit addresses this issue by also
accounting for tribe nodes when creating the dynamic socket
permissions. Additionally, we add our first real integration test for
tribe nodes.

Relates #21546

time:
2016-11-14T19:30:01Z
class:
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/common/util/concurrent/BaseFuture.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
comments:
assert blocking calls are not made on the cluster state update thread

This commit adds an assertion to ensure that we do not introduce blocking calls in code
that is called in a ClusterStateListener or another part of the cluster state update process.

time:
2016-11-14T18:52:57Z
class:
comments:
Remove explicit task paths in tribe node test

This commit removes some explicit paths in the tribe node smoke test so
that these are easier to maintain (in the case of reorganization).

time:
2016-11-14T18:52:35Z
class:
comments:
Use pre-JDK9 style FilePermissions on JDK9 when running from start scripts

time:
2016-11-14T18:49:16Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Security.java
comments:
Remove unnecessary hash map copy in o.e.b.Security

This commit removes an unnecessary copying of the tribe node group
settings in o.e.b.Security.

time:
2016-11-14T18:48:12Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Security.java
comments:
Fallback to settings if transport profile is empty

If the transport profile does not contain a TCP port range, we fallback
to the top-level settings.

time:
2016-11-14T16:58:44Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Security.java
qa/smoke-test-tribe-node/src/test/java/org/elasticsearch/tribe/TribeClientYamlTestSuiteIT.java
test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java
comments:
Add socket permissions for tribe nodes

Today when a node starts, we create dynamic socket permissions based on
the configured HTTP ports and transport ports. If no ports are
configured, we use the default port ranges. When a tribe node starts, a
tribe node creates an internal node client for connecting to each remote
cluster. If neither an explicit HTTP port nor transport ports were
specified, the default port ranges are large enough for the tribe node
and its internal node clients. If an explicit HTTP port or transport
port was specified for the tribe node, then socket permissions for those
ports will be created, but not for the internal node clients. Whether
the internal node clients have explicit ports specified, or attempt to
bind within the default range, socket permissions for these will not
have been created and the internal node clients will hit a permissions
issue when attempting to bind. This commit addresses this issue by also
accounting for tribe nodes when creating the dynamic socket
permissions. Additionally, we add our first real integration test for
tribe nodes.

time:
2016-11-14T16:09:57Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestBuilder.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/IndexShardAlreadyExistsException.java
core/src/main/java/org/elasticsearch/indices/IndexTemplateAlreadyExistsException.java
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
core/src/test/java/org/elasticsearch/indices/template/SimpleIndexTemplateIT.java
comments:
Remove `IndexTemplateAlreadyExistsException` and `IndexShardAlreadyExistsException` (#21539)

Both exception can be replaced with java built-in exception, IAE and ISE respectively.
This should be back ported partially to 5.x which the transport layer code should be preserved.

Relates to #21494

time:
2016-11-14T16:03:57Z
class:
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java
core/src/main/java/org/elasticsearch/common/transport/TransportAddress.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/VersionTests.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java
comments:
Enable 5.x to 6.x BWC tests (#21537)

This commit enables real BWC testing against a 5.1 snapshot. All
REST tests plus rolling upgrade test now run against a mixed version
cross major version cluster.

time:
2016-11-14T15:55:14Z
class:
core/src/test/java/org/elasticsearch/transport/TCPTransportTests.java
comments:
Fix line length in TCPTransportTests

Makes checkstyle happy

time:
2016-11-14T15:49:25Z
class:
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
comments:
Check valid cluster service state transitions (#21538)

This commit adds assertions to check whether the cluster service state transitions in a way that we expect it to.

Relates to #21379.

time:
2016-11-14T15:13:44Z
class:
core/src/test/java/org/elasticsearch/transport/TCPTransportTests.java
comments:
[TEST] Add test to ensure `transport.tcp.compress` works

This adds a basic unittest to ensure `transport.tcp.compress` has effect
on all basic TcpTransport implementations.

Relates to #21526

time:
2016-11-14T14:30:07Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
remove forbidden API

time:
2016-11-14T14:14:14Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/IndexShardRoutingTable.java
core/src/test/java/org/elasticsearch/cluster/ClusterStateDiffIT.java
core/src/test/java/org/elasticsearch/cluster/health/ClusterStateHealthTests.java
core/src/test/java/org/elasticsearch/cluster/routing/RandomShardRoutingMutator.java
core/src/test/java/org/elasticsearch/cluster/routing/RoutingTableTests.java
core/src/test/java/org/elasticsearch/indices/store/IndicesStoreTests.java
comments:
Add assertion that checks that the same shard with same id is not added to same node (#21498)

Adds an assertion that checks that the same shard with same id is not added to same node. Previously we would just silently ignore the second shard being added.

time:
2016-11-14T13:26:49Z
class:
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java
core/src/main/java/org/elasticsearch/common/transport/TransportAddress.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/VersionTests.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java
comments:
Enable 5.x to 6.x BWC tests

This commit enables real BWC testing against a 5.1 snapshot. All
REST tests plus rolling upgrade test now run against a mixed version
cross major version cluster.

time:
2016-11-14T13:13:23Z
class:
comments:
Use pre-JDK9 style FilePermissions on JDK9

JDK9 removed pathname canonicalization when constructing FilePermission objects, which breaks some of the FilePermissions added by
Elasticsearch. This commit adds the system property jdk.io.permissionsUseCanonicalPath which makes JDK9 behave like JDK8 w.r.t. FilePermissions (see
https://github.com/elastic/elasticsearch/issues/21534).

time:
2016-11-14T12:57:52Z
class:
comments:
Add Vagrant Gradle plugin (#21348)

This commit changes the current :elactisearch:qa:vagrant build file and transforms it into a Gradle plugin in order to reuse it in other projects.

Most of the code from the build.gradle file has been moved into the VagrantTestPlugin class. To avoid duplicated VMs when running vagrant tests, the Gradle plugin sets the following environment variables before running vagrant commands:
VAGRANT_CWD: absolute path to the folder that contains the Vagrantfile
VAGRANT_PROJECT_DIR: absolute path to the Gradle project that use the VagrantTestPlugin

The VAGRANT_PROJECT_DIR is used to share project folders and files with the vagrant VM. These folders and files are exported when running the task `gradle vagrantSetUp` which:
- collects all project archives dependencies and copies them into `${project.buildDir}/bats/archives`
- copy all project bats testing files from 'src/test/resources/packaging/tests' into `${project.buildDir}/bats/tests`
- copy all project bats utils files from 'src/test/resources/packaging/utils' into `${project.buildDir}/bats/utils`

It is also possible to inherit and grab the archives/tests/utils files from project dependencies using the plugin configuration:

apply plugin: 'elasticsearch.vagrant'
esvagrant {
    inheritTestUtils true|false
    inheritTestArchives true|false
    inheritTests true|false
}
dependencies {
    // Inherit Bats test utils from :qa:vagrant project
    bats project(path: ':qa:vagrant', configuration: 'bats')
}

The folders `${project.buildDir}/bats/archives`, `${project.buildDir}/bats/tests` and `${project.buildDir}/bats/utils` are then exported to the vagrant VMs and mapped to the BATS_ARCHIVES, BATS_TESTS and BATS_UTILS environnement variables.

The following Gradle tasks have also be renamed:

* gradle vagrantSetUp
This task copies all the necessary files to the project build directory (was `prepareTestRoot`)

* gradle vagrantSmokeTest
This task starts the VMs and echoes a "Hello world" within each VM (was: `smokeTest`)

time:
2016-11-14T11:11:53Z
class:
comments:
Set LoggedExec back

time:
2016-11-14T09:44:06Z
class:
comments:
Rebasing master

time:
2016-11-14T09:33:05Z
class:
comments:
Add Vagrant Gradle plugin

This commit changes the current :elactisearch:qa:vagrant build file and transforms it into a Gradle plugin in order to reuse it in other projects.

Most of the code from the build.gradle file has been moved into the VagrantTestPlugin class. To avoid duplicated VMs when running vagrant tests, the Gradle plugin sets the following environment variables before running vagrant commands:
VAGRANT_CWD: absolute path to the folder that contains the Vagrantfile
VAGRANT_PROJECT_DIR: absolute path to the Gradle project that use the VagrantTestPlugin

The VAGRANT_PROJECT_DIR is used to share project folders and files with the vagrant VM. These folders and files are exported when running the task `gradle vagrantSetUp` which:
- collects all project archives dependencies and copies them into `${project.buildDir}/bats/archives`
- copy all project bats testing files from 'src/test/resources/packaging/tests' into `${project.buildDir}/bats/tests`
- copy all project bats utils files from 'src/test/resources/packaging/utils' into `${project.buildDir}/bats/utils`

It is also possible to inherit and grab the archives/tests/utils files from project dependencies using the plugin configuration:

apply plugin: 'elasticsearch.vagrant'
esvagrant {
    inheritTestUtils true|false
    inheritTestArchives true|false
    inheritTests true|false
}
dependencies {
    // Inherit Bats test utils from :qa:vagrant project
    bats project(path: ':qa:vagrant', configuration: 'bats')
}

The folders `${project.buildDir}/bats/archives`, `${project.buildDir}/bats/tests` and `${project.buildDir}/bats/utils` are then exported to the vagrant VMs and mapped to the BATS_ARCHIVES, BATS_TESTS and BATS_UTILS environnement variables.

The following Gradle tasks have also be renamed:

* gradle vagrantSetUp
This task copies all the necessary files to the project build directory (was `prepareTestRoot`)

* gradle vagrantSmokeTest
This task starts the VMs and echoes a "Hello world" within each VM (was: `smokeTest`)

time:
2016-11-14T09:07:07Z
class:
comments:
[docs] clients need to add jackson-databind (#21527)

With ES 5.0 we do not include Jackson
Databind anymore with ES core. This commit
updates our docs to state that users need
to add this artifact now in their projects.

time:
2016-11-14T08:40:04Z
class:
comments:
Update significantterms-aggregation.asciidoc

Fix scripted significant terms example to use `params.` prefix for painless

time:
2016-11-14T08:36:45Z
class:
comments:
Upgrade to lucene-6.3.0. (#21464)

time:
2016-11-14T01:01:44Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/BalancedSingleShardTests.java
core/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsIT.java
core/src/test/java/org/elasticsearch/search/SearchCancellationIT.java
core/src/test/java/org/elasticsearch/search/SearchCancellationTests.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/PainlessLexer.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/StashingTokenFactory.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EDecimal.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ENumeric.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/BasicExpressionTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/WhenThingsGoWrongTests.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
Merge branch 'master' into feature/seq_no

* master:
  Hack around cluster service and logging race
  Do not prematurely shutdown Log4j
  Support decimal constants with trailing [dD] in painless (#21412)
  In painless suggest a long constant if int won't do (#21415)
  Account for different paths for sysctl utilities
  [TEST] testRebalancePossible() may not have an assigned node id
  Tests: Disable merge in SearchCancellationTests
  Tests: clean search scroll at the end of SearchCancellationIT

time:
2016-11-13T23:06:12Z
class:
core/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsIT.java
comments:
Hack around cluster service and logging race

When a cluster update task executes, there can be log messages after the
update task has finished processing and the new cluster state becomes
visible. The visibility of the cluster state allows the test thread in
UpdateSettingsIT#testUpdateAutoThrottleSettings and
UpdateSettingsiT#testUpdateMergeMaxThreadCount to proceed. The test
thread will remove and stop a mock appender setup at the beginning of
the test. The log messages in the cluster state update task that occur
after processing has finished can race with the removal of the
appender. Log4j will grab a reference to the appenders when processing
these log messages, and this races with the removal and stopping of the
appenders. If Log4j grabs a reference to the appenders before the mock
appender has been removed, and the test thread subsequently removes and
stops the appender before Log4j has appended the log message, Log4j will
get angry that we are appending to a stopped appender, causing the test
to fail. This commit addresses this race by waiting for the cluster
state update task to have finished processing before freeing the test
thread to make its assertions and finally remove and stop the
appender. Yes, this is a hack.

Relates #21518

time:
2016-11-13T22:27:30Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/node/Node.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
Do not prematurely shutdown Log4j

When a node closes, we shutdown logging as the last statement. This
statement must be last lest any subsequent attempts to log will blow up
by running into security permissions. Yet, in the case of a tribe node
this isn't enough. The first internal tribe node to close will shutdown
logging, and subsequent node closes will blow up with the aforementioned
problem. This commit migrate the Log4j shutdown to occur as part of the
shutdown hook that closes the node, after all nodes have
closed. Consequently, we can remove a hack in the test infrastructure to
prevent Log4j shutdowns when internal test nodes close and instead just
register a single shutdown hook that runs when the test JVM exits.

Relates #21519

time:
2016-11-12T16:08:39Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/PainlessLexer.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/StashingTokenFactory.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EDecimal.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/BasicExpressionTests.java
comments:
Support decimal constants with trailing [dD] in painless (#21412)

This adds support to painless for decimal constants with trailing `d` or
`D` to make it compatible with Java. It already supported integer
constants with a trailing `d` or `D` but this adds tests for it.

Closes #21116

time:
2016-11-12T16:08:18Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ENumeric.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/WhenThingsGoWrongTests.java
comments:
In painless suggest a long constant if int won't do (#21415)

In painless we prefer explicit types over implicit ones whereas
groovy is the other way around. Take this groovy code:

```
> 86400000.class
java.lang.Integer
> 864000000000.class
java.lang.Long
```

Painless accepts `86400000` just fine because that is a valid `int`
in the jvm. It rejects `864000000000` as an invlid `int` constant
because, in painless as in java, `long` constants always end in `L`
or `l`.

To ease the transition from groovy to painless, this changes the
compilation error returned from these invalid constants from:

```
Invalid int constant [864000000000].
```

to

```
Invalid int constant [864000000000]. If you want a long constant then change it to [864000000000L].
```

Inspired by #21313

time:
2016-11-12T12:54:17Z
class:
comments:
Account for different paths for sysctl utilities

On some systems these utilities are in /usr/lib/systemd/systemd-sysctl
and /usr/sbin/sysctl, and on others the /usr is dropped. This commit
accounts for that fact.

time:
2016-11-12T10:42:02Z
class:
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
testUpgradeOldIndex should properly set index setting. They are needed for assertions

time:
2016-11-12T04:10:34Z
class:
core/src/test/java/org/elasticsearch/cluster/routing/allocation/BalancedSingleShardTests.java
comments:
[TEST] testRebalancePossible() may not have an assigned node id

time:
2016-11-11T23:22:28Z
class:
core/src/test/java/org/elasticsearch/search/SearchCancellationTests.java
comments:
Tests: Disable merge in SearchCancellationTests

We have to have at least 2 segments for the test to work and sometimes random merge policy merges them into one.

time:
2016-11-11T23:22:15Z
class:
core/src/test/java/org/elasticsearch/search/SearchCancellationIT.java
comments:
Tests: clean search scroll at the end of SearchCancellationIT

Under some rare conditions search cancellation response might not fully clean scroll context. For now this commit adds the cleaning operation to the test, and we will address the root cause in https://github.com/elastic/elasticsearch/issues/21511

time:
2016-11-11T22:03:01Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/cancel/TransportCancelTasksAction.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/store/IndicesStore.java
core/src/test/java/org/elasticsearch/indices/IndicesServiceTests.java
core/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsIT.java
core/src/test/java/org/elasticsearch/indices/store/IndicesStoreTests.java
core/src/test/java/org/elasticsearch/search/SearchCancellationIT.java
core/src/test/java/org/elasticsearch/search/query/SearchQueryIT.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/mockstore/MockRepository.java
comments:
Merge branch 'master' into feature/seq_no

* master:
  Set vm.max_map_count on systemd package install
  [TEST] reduce the number of snapshotted shards to 1 in testSnapshotSucceedsAfterSnapshotFailure() so that we are more likely to trigger I/O exceptions on writing the control files during the finalize phase of snapshotting (with the aim of triggering an I/O failure when writing pending-index-*).
  Add documentation for Logger with Transport Client
  Enable appender exceptions in UpdateSettingsIT
  [TEST] remove AwaitsFix from testSnapshotSucceedsAfterSnapshotFailure, turns out the issue is specific to Java 9 v143
  Cleanup formatting in UpdateSettingsIT.java
  [TEST] mute the testSnapshotSucceedsAfterSnapshotFailure() test until its clear what is going wrong.
  Mark SearchQueryIT test as awaits fix
  Makes snapshot throttling test go much faster (#21485)
  Breaking changes docs for template index_patterns
  [TEST] adds randomness between atomic and non-atomic move operations in MockRepository
  Cache successful shard deletion checks (#21438)
  Task cancellation command should wait for all child nodes to receive cancellation request before returning

time:
2016-11-11T21:49:13Z
class:
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
Tighten sequence number assertion

We have an assertion in the engine regarding the initial state of a
sequence number before an indexing operation. This assertion is too
loose, it catches operations during recovery from old indices where
sequence numbers do not even exist. This commit tightens these
assertions to not catch such operations and enables us to reenable some
tests.

Relates #21509

time:
2016-11-11T21:41:54Z
class:
comments:
Set vm.max_map_count on systemd package install

Our docs claim that we set vm.max_map_count automatically. This is not
quite the case. The story is that on SysV init we set vm.max_map_count
each time the service starts, which is good. On systemd, we create a
sysctl.d conf file that sets vm.map_max_count, but this is only
meaningful if the system is rebooted after package install. This commit
modifies the post-install script so that we run systemd-sysctl so that
the vm.max_map_count change occurs after package install without a
reboot.

Relates #21507

time:
2016-11-11T21:22:11Z
class:
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
comments:
[TEST] reduce the number of snapshotted shards to 1 in testSnapshotSucceedsAfterSnapshotFailure()
so that we are more likely to trigger I/O exceptions on writing the control files during the
finalize phase of snapshotting (with the aim of triggering an I/O failure when writing pending-index-*).

time:
2016-11-11T21:11:41Z
class:
core/src/main/java/org/elasticsearch/index/mapper/internal/SeqNoFieldMapper.java
comments:
Convert nocommit to TODO in SeqNoFieldMapper

This commit converts a nocommit to a TODO in SeqNoFieldMapper that will
be dealt with in a follow-up.

time:
2016-11-11T21:10:22Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
comments:
Remove nocommit in TransportShardBulkAction

This commit removes a nocommit in TransportShardBulkAction that deserves
a larger issue.

time:
2016-11-11T20:23:23Z
class:
comments:
Add documentation for Logger with Transport Client

Backport of #21477 in master branch

time:
2016-11-11T20:18:25Z
class:
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
comments:
Remove shard ID from doc write response

This commit removes the shard ID from doc write response; this was
useful for debugging but its time has passed.

Relates #21508

time:
2016-11-11T17:41:20Z
class:
core/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsIT.java
comments:
Enable appender exceptions in UpdateSettingsIT

This commit sets the mock appender in UpdateSettingsIT to not ignore
exceptions. This means that when an exception is hit, we will see an
actual stack trace that could be useful in debugging a non-reproducible
test failure.

Relates #21461

time:
2016-11-11T17:37:04Z
class:
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
comments:
[TEST] remove AwaitsFix from testSnapshotSucceedsAfterSnapshotFailure,
turns out the issue is specific to Java 9 v143

time:
2016-11-11T17:10:32Z
class:
core/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsIT.java
comments:
Cleanup formatting in UpdateSettingsIT.java

This commit cleans up some code formatting in UpdateSettingsIT.java and
removes this from from the checkstyle line-length supressions.

time:
2016-11-11T16:50:23Z
class:
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
comments:
[TEST] mute the testSnapshotSucceedsAfterSnapshotFailure() test
until its clear what is going wrong.

Relates #21496

time:
2016-11-11T16:33:17Z
class:
core/src/test/java/org/elasticsearch/search/query/SearchQueryIT.java
comments:
Mark SearchQueryIT test as awaits fix

This commit marks the test SearchQueryIT#testRangeQueryWithTimeZone as
awaits fix.

Relates #21501

time:
2016-11-11T16:29:51Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/IndexShardRoutingTable.java
core/src/test/java/org/elasticsearch/cluster/routing/RoutingTableTests.java
comments:
Test distinctNodes

time:
2016-11-11T16:25:27Z
class:
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/TransportPutIndexTemplateAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/cluster/ClusterModule.java
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/InternalClusterInfoService.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/main/java/org/elasticsearch/common/blobstore/BlobContainer.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointService.java
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointSyncAction.java
core/src/main/java/org/elasticsearch/index/shard/IndexShardOperationsLock.java
core/src/main/java/org/elasticsearch/index/shard/ShadowIndexShard.java
core/src/main/java/org/elasticsearch/index/translog/Checkpoint.java
core/src/main/java/org/elasticsearch/indices/store/IndicesStore.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/Plugin.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestPutIndexTemplateAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTemplatesAction.java
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/template/put/MetaDataIndexTemplateServiceTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestTests.java
core/src/test/java/org/elasticsearch/bwcompat/RestoreBackwardsCompatIT.java
core/src/test/java/org/elasticsearch/cluster/ClusterStateDiffIT.java
core/src/test/java/org/elasticsearch/cluster/SimpleClusterStateIT.java
core/src/test/java/org/elasticsearch/cluster/metadata/IndexMetaDataTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaDataTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/ToAndFromJsonMetaDataTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/BalancedSingleShardTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/gateway/RecoveryFromGatewayIT.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingIT.java
core/src/test/java/org/elasticsearch/index/replication/IndexLevelReplicationTests.java
core/src/test/java/org/elasticsearch/indices/memory/breaker/RandomExceptionCircuitBreakerIT.java
core/src/test/java/org/elasticsearch/indices/template/IndexTemplateBlocksIT.java
core/src/test/java/org/elasticsearch/indices/template/SimpleIndexTemplateIT.java
core/src/test/java/org/elasticsearch/search/basic/SearchWithRandomExceptionsIT.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/mockstore/MockRepository.java
plugins/ingest-geoip/src/main/java/org/elasticsearch/ingest/geoip/IngestGeoIpPlugin.java
plugins/jvm-example/src/main/java/org/elasticsearch/plugin/example/JvmExamplePlugin.java
test/framework/src/main/java/org/elasticsearch/cluster/MockInternalClusterInfoService.java
test/framework/src/main/java/org/elasticsearch/index/MockEngineFactoryPlugin.java
test/framework/src/main/java/org/elasticsearch/node/MockNode.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
test/framework/src/main/java/org/elasticsearch/test/TestCluster.java
comments:
Merge branch 'master' into feature/seq_no

* master:
  ShardActiveResponseHandler shouldn't hold to an entire cluster state
  Ensures cleanup of temporary index-* generational blobs during snapshotting (#21469)
  Remove (again) test uses of onModule (#21414)
  [TEST] Add assertBusy when checking for pending operation counter after tests
  Revert "Add trace logging when aquiring and releasing operation locks for replication requests"
  Allows multiple patterns to be specified for index templates (#21009)
  [TEST] fixes rebalance single shard check as it isn't guaranteed that a rebalance makes sense and the method only tests if rebalance is allowed
  Document _reindex with random_score

time:
2016-11-11T15:52:26Z
class:
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
comments:
Makes snapshot throttling test go much faster (#21485)

[TEST] Makes the snapshot throttling test go much faster.  Before, 
the snapshot throttling test would throttle at a rate of 0.5 kb per
second, even though it would snapshot/restore about 25 kb of data.
This commit increases the throttling rate to 10kb per second, so
we still test the throttling mechanism while speeding up the test from
taking 30 plus seconds down to 2 seconds or less.

time:
2016-11-11T15:13:19Z
class:
comments:
Breaking changes docs for template index_patterns

0219a211d3539781ad4bc59bbb68ab9dd5633090 added support for templates
to have multiple patterns and renamed `template` to `index_patterns`.
This adds the breaking changes docs for that.

time:
2016-11-11T15:09:34Z
class:
core/src/test/java/org/elasticsearch/indices/store/IndicesStoreTests.java
comments:
test fix

time:
2016-11-11T14:28:40Z
class:
core/src/test/java/org/elasticsearch/cluster/ClusterStateDiffIT.java
core/src/test/java/org/elasticsearch/cluster/health/ClusterStateHealthTests.java
core/src/test/java/org/elasticsearch/cluster/routing/RandomShardRoutingMutator.java
core/src/test/java/org/elasticsearch/indices/store/IndicesStoreTests.java
comments:
fix tests that add duplicate shards

time:
2016-11-11T14:28:40Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/IndexShardRoutingTable.java
comments:
Add assertion that checks that the same shard with same id is not added to same node

time:
2016-11-11T14:07:28Z
class:
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/mockstore/MockRepository.java
comments:
[TEST] adds randomness between atomic and non-atomic move
operations in MockRepository

time:
2016-11-11T09:06:15Z
class:
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/store/IndicesStore.java
core/src/test/java/org/elasticsearch/indices/IndicesServiceTests.java
core/src/test/java/org/elasticsearch/indices/store/IndicesStoreTests.java
comments:
Cache successful shard deletion checks (#21438)

Each node checks on every cluster state update if there are shards that it can possibly delete from its disk. It decides this by doing a file-system lookup for each shard id that is fully allocated in the cluster. With lots of shards, this amounts to lots of Files.exists() checks, considerably slowing down cluster state updates. This commit adds a caching layer so that the Files.exists() checks can be skipped if not needed.

time:
2016-11-11T04:40:33Z
class:
benchmarks/src/main/java/org/elasticsearch/benchmark/routing/allocation/AllocationBenchmark.java
benchmarks/src/main/java/org/elasticsearch/benchmark/routing/allocation/Allocators.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/transport/TransportClientBenchmark.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/RestNoopBulkAction.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/TransportNoopBulkAction.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/search/RestNoopSearchAction.java
client/rest/src/main/java/org/elasticsearch/client/HeapBufferedAsyncResponseConsumer.java
client/rest/src/main/java/org/elasticsearch/client/HttpAsyncResponseConsumerFactory.java
client/rest/src/main/java/org/elasticsearch/client/RestClient.java
client/rest/src/test/java/org/elasticsearch/client/HeapBufferedAsyncResponseConsumerTests.java
client/rest/src/test/java/org/elasticsearch/client/RequestLoggerTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientMultipleHostsIntegTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientMultipleHostsTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostIntegTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostTests.java
client/sniffer/src/test/java/org/elasticsearch/client/sniff/ElasticsearchHostsSnifferTests.java
client/sniffer/src/test/java/org/elasticsearch/client/sniff/SnifferBuilderTests.java
core/src/main/java/org/apache/logging/log4j/core/impl/ThrowableProxy.java
core/src/main/java/org/apache/logging/log4j/core/jmx/Server.java
core/src/main/java/org/apache/lucene/queryparser/classic/ExistsFieldQueryExtension.java
core/src/main/java/org/apache/lucene/queryparser/classic/FieldQueryExtension.java
core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
core/src/main/java/org/apache/lucene/queryparser/classic/QueryParserSettings.java
core/src/main/java/org/apache/lucene/search/vectorhighlight/CustomFieldQuery.java
core/src/main/java/org/apache/lucene/store/StoreRateLimiting.java
core/src/main/java/org/apache/lucene/store/StoreUtils.java
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/ElasticsearchParseException.java
core/src/main/java/org/elasticsearch/ElasticsearchWrapperException.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/ActionRequest.java
core/src/main/java/org/elasticsearch/action/ActionRequestBuilder.java
core/src/main/java/org/elasticsearch/action/CompositeIndicesRequest.java
core/src/main/java/org/elasticsearch/action/DocWriteRequest.java
core/src/main/java/org/elasticsearch/action/DocumentRequest.java
core/src/main/java/org/elasticsearch/action/FailedNodeException.java
core/src/main/java/org/elasticsearch/action/NoShardAvailableActionException.java
core/src/main/java/org/elasticsearch/action/NoSuchNodeException.java
core/src/main/java/org/elasticsearch/action/PrimaryMissingActionException.java
core/src/main/java/org/elasticsearch/action/RoutingMissingException.java
core/src/main/java/org/elasticsearch/action/ThreadingModel.java
core/src/main/java/org/elasticsearch/action/TimestampParsingException.java
core/src/main/java/org/elasticsearch/action/UnavailableShardsException.java
core/src/main/java/org/elasticsearch/action/ValidateActions.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/TransportClusterAllocationExplainAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/hotthreads/NodeHotThreads.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/hotthreads/NodesHotThreadsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/hotthreads/NodesHotThreadsRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/hotthreads/NodesHotThreadsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/hotthreads/NodesHotThreadsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/hotthreads/TransportNodesHotThreadsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/info/TransportNodesInfoAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStats.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodesStatsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodesStatsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodesStatsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/TransportNodesStatsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/cancel/TransportCancelTasksAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/TransportGetTaskAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/list/TransportListTasksAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/reroute/TransportClusterRerouteAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/settings/ClusterUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/settings/TransportClusterUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsGroup.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/TransportClusterSearchShardsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/TransportGetSnapshotsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/TransportRestoreSnapshotAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/SnapshotIndexShardStage.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/SnapshotIndexShardStatus.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/SnapshotStats.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/TransportSnapshotsStatusAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/state/TransportClusterStateAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/TransportClusterStatsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/DeleteStoredScriptAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/GetStoredScriptAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/PutStoredScriptAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/tasks/PendingClusterTasksAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/tasks/PendingClusterTasksRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/tasks/PendingClusterTasksRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/tasks/PendingClusterTasksResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/tasks/TransportPendingClusterTasksAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/IndicesAliasesAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/IndicesAliasesRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/exists/AliasesExistAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/exists/AliasesExistRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/exists/AliasesExistResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/exists/TransportAliasesExistAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/get/BaseAliasesRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/get/TransportGetAliasesAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/ClearIndicesCacheAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/ClearIndicesCacheRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/ClearIndicesCacheRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/close/CloseIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexClusterStateUpdateRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/create/TransportCreateIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/delete/DeleteIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/delete/DeleteIndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/exists/indices/IndicesExistsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/exists/indices/IndicesExistsRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/exists/indices/IndicesExistsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/exists/types/TypesExistsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/exists/types/TypesExistsRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/flush/FlushAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/flush/FlushRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportShardFlushAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/forcemerge/ForceMergeAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetFieldMappingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetMappingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetMappingsRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetMappingsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetMappingsResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/TransportGetFieldMappingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/TransportGetMappingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/open/OpenIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportShardRefreshAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/segments/IndicesSegmentsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/segments/IndicesSegmentsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/segments/TransportIndicesSegmentsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/get/GetSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/get/GetSettingsRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/get/GetSettingsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/get/GetSettingsResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/get/TransportGetSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/put/TransportUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/put/UpdateSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/shrink/ShrinkAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/shrink/TransportShrinkAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndexStats.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/ShardStats.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/TransportIndicesStatsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/delete/DeleteIndexTemplateAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/delete/DeleteIndexTemplateRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/get/GetIndexTemplatesAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/get/GetIndexTemplatesRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/get/TransportGetIndexTemplatesAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/get/TransportUpgradeStatusAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/get/UpgradeStatusAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/get/UpgradeStatusRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/post/ShardUpgradeRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/post/ShardUpgradeResult.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/post/TransportUpgradeSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/post/UpgradeSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/QueryExplanation.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/ShardValidateQueryRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/TransportValidateQueryAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/ValidateQueryAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/ValidateQueryRequestBuilder.java
core/src/main/java/org/elasticsearch/action/bulk/BulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkShardRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkShardResponse.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/DeleteAction.java
core/src/main/java/org/elasticsearch/action/delete/DeleteRequest.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/explain/ExplainRequest.java
core/src/main/java/org/elasticsearch/action/explain/ExplainRequestBuilder.java
core/src/main/java/org/elasticsearch/action/explain/TransportExplainAction.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsAction.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsRequest.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsResponse.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsShardRequest.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsShardResponse.java
core/src/main/java/org/elasticsearch/action/get/GetAction.java
core/src/main/java/org/elasticsearch/action/get/GetRequest.java
core/src/main/java/org/elasticsearch/action/get/GetRequestBuilder.java
core/src/main/java/org/elasticsearch/action/get/MultiGetAction.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequest.java
core/src/main/java/org/elasticsearch/action/get/TransportMultiGetAction.java
core/src/main/java/org/elasticsearch/action/index/IndexAction.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/index/IndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/ingest/DeletePipelineRequestBuilder.java
core/src/main/java/org/elasticsearch/action/ingest/IngestActionFilter.java
core/src/main/java/org/elasticsearch/action/search/AbstractAsyncAction.java
comments:
Merge branch 'master' into feature/seq_no

* master: (516 commits)
  Avoid angering Log4j in TransportNodesActionTests
  Add trace logging when aquiring and releasing operation locks for replication requests
  Fix handler name on message not fully read
  Remove accidental import.
  Improve log message in TransportNodesAction
  Clean up of Script.
  Update Joda Time to version 2.9.5 (#21468)
  Remove unused ClusterService dependency from SearchPhaseController (#21421)
  Remove max_local_storage_nodes from elasticsearch.yml (#21467)
  Wait for all reindex subtasks before rethrottling
  Correcting a typo-Maan to Man-in README.textile (#21466)
  Fix InternalSearchHit#hasSource to return the proper boolean value (#21441)
  Replace all index date-math examples with the URI encoded form
  Fix typos (#21456)
  Adapt ES_JVM_OPTIONS packaging test to ubuntu-1204
  Add null check in InternalSearchHit#sourceRef to prevent NPE (#21431)
  Add VirtualBox version check (#21370)
  Export ES_JVM_OPTIONS for SysV init
  Skip reindex rethrottle tests with workers
  Make forbidden APIs be quieter about classpath warnings (#21443)
  ...

time:
2016-11-11T03:43:43Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/cancel/TransportCancelTasksAction.java
core/src/test/java/org/elasticsearch/search/SearchCancellationIT.java
comments:
Task cancellation command should wait for all child nodes to receive cancellation request before returning

Currently the task cancellation command returns as soon as the top-level parent child is marked as cancelled. This create race conditions in tests where child tasks on other nodes may continue to run for some time after the main task is cancelled. This commit fixes this situation making task cancellation command to wait until it got propagated to all nodes that have child tasks.

Closes #21126

time:
2016-11-11T03:28:49Z
class:
core/src/main/java/org/elasticsearch/indices/store/IndicesStore.java
comments:
ShardActiveResponseHandler shouldn't hold to an entire cluster state

ShardActiveResponseHandler doesn't need to hold to an entire cluster state since it only needs to know the cluster state version. It seems that on overloaded systems where nodes are unresponsive holding onto a lot of different cluster states can make the situation worse.

Closes #21394

time:
2016-11-11T02:45:02Z
class:
core/src/main/java/org/elasticsearch/common/blobstore/BlobContainer.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/mockstore/MockRepository.java
comments:
Ensures cleanup of temporary index-* generational blobs during snapshotting (#21469)

Ensures pending index-* blobs are deleted when snapshotting.  The
index-* blobs are generational files that maintain the snapshots
in the repository.  To write these atomically, we first write a
`pending-index-*` blob, then move it to `index-*`, which also deletes
`pending-index-*` in case its not a file-system level move (e.g.
S3 repositories) .  For example, to write the 5th generation of the
index blob for the repository, we would first write the bytes to
`pending-index-5` and then move `pending-index-5` to `index-5`.  It is
possible that we fail after writing `pending-index-5`, but before
moving it to `index-5` or deleting `pending-index-5`.  In this case,
we will have a dangling `pending-index-5` blob laying around.  Since
snapshot #5 would have failed, the next snapshot assumes a generation
number of 5, so it tries to write to `index-5`, which first tries to
write to `pending-index-5` before moving the blob to `index-5`.  Since
`pending-index-5` is leftover from the previous failure, the snapshot
fails as it cannot overwrite this blob.

This commit solves the problem by first, adding a UUID to the
`pending-index-*` blobs, and secondly, strengthen the logic around
failure to write the `index-*` generational blob to ensure pending
files are deleted on cleanup.

Closes #21462

time:
2016-11-11T00:06:14Z
class:
core/src/main/java/org/elasticsearch/cluster/ClusterModule.java
core/src/main/java/org/elasticsearch/cluster/InternalClusterInfoService.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/Plugin.java
core/src/test/java/org/elasticsearch/indices/memory/breaker/RandomExceptionCircuitBreakerIT.java
core/src/test/java/org/elasticsearch/search/basic/SearchWithRandomExceptionsIT.java
plugins/ingest-geoip/src/main/java/org/elasticsearch/ingest/geoip/IngestGeoIpPlugin.java
plugins/jvm-example/src/main/java/org/elasticsearch/plugin/example/JvmExamplePlugin.java
test/framework/src/main/java/org/elasticsearch/cluster/MockInternalClusterInfoService.java
test/framework/src/main/java/org/elasticsearch/index/MockEngineFactoryPlugin.java
test/framework/src/main/java/org/elasticsearch/node/MockNode.java
comments:
Remove (again) test uses of onModule (#21414)

This change was reverted after it caused random test failures. This was
due to a copy/paste error in the original PR which caused the mock
version of ClusterInfoService to be used whenever the mock *ZenPing* was
used, and the real ClusterInfoService to be used when MockZenPing was
not used.

time:
2016-11-10T23:35:52Z
class:
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
test/framework/src/main/java/org/elasticsearch/test/TestCluster.java
comments:
[TEST] Add assertBusy when checking for pending operation counter after tests

Currently, pending operations can complete after tests with disruption scheme
completes. This commit waits for the pending operation counter to complete
after the tests are run

time:
2016-11-10T23:35:25Z
class:
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationOperation.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/index/shard/IndexShardOperationsLock.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
comments:
Revert "Add trace logging when aquiring and releasing operation locks for replication requests"

This reverts commit 4e996ca9f5ae6d47f6039b1d75fd3d10a6286d64.

time:
2016-11-10T23:00:30Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/TransportPutIndexTemplateAction.java
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestPutIndexTemplateAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTemplatesAction.java
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/template/put/MetaDataIndexTemplateServiceTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestTests.java
core/src/test/java/org/elasticsearch/bwcompat/RestoreBackwardsCompatIT.java
core/src/test/java/org/elasticsearch/cluster/ClusterStateDiffIT.java
core/src/test/java/org/elasticsearch/cluster/SimpleClusterStateIT.java
core/src/test/java/org/elasticsearch/cluster/metadata/IndexMetaDataTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaDataTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/ToAndFromJsonMetaDataTests.java
core/src/test/java/org/elasticsearch/gateway/RecoveryFromGatewayIT.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingIT.java
core/src/test/java/org/elasticsearch/indices/template/IndexTemplateBlocksIT.java
core/src/test/java/org/elasticsearch/indices/template/SimpleIndexTemplateIT.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java
comments:
Allows multiple patterns to be specified for index templates (#21009)

* Allows for an array of index template patterns to be provided to an
index template, and rename the field from 'template' to 'index_pattern'.

Closes #20690

time:
2016-11-10T22:13:39Z
class:
core/src/test/java/org/elasticsearch/cluster/routing/allocation/BalancedSingleShardTests.java
comments:
[TEST] fixes rebalance single shard check as it isn't guaranteed that a
rebalance makes sense and the method only tests if rebalance is allowed

time:
2016-11-10T21:14:30Z
class:
comments:
Document _reindex with random_score

You can use `_reindex` and `random_score` to extract a random
subset of an index but you have to be careful to sort by `_score`
or it won't work.

Closes #21432

time:
2016-11-10T21:08:08Z
class:
core/src/test/java/org/elasticsearch/action/support/nodes/TransportNodesActionTests.java
comments:
Avoid angering Log4j in TransportNodesActionTests

When logging a mock exception, Log4j attempts to render the stack
trace. On a mock exception, this will be null and Log4j will hit a
NullPointerException. This NullPointerException will get recorded in the
status logger buffer that we use to ensure that we do not having any
misuses of Log4j in production code. This commit replaces the use of a
mock exception with an actual exception to avoid angering the Log4j
assertions in ESTestCase.

time:
2016-11-10T20:13:42Z
class:
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationOperation.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/index/shard/IndexShardOperationsLock.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
comments:
Add trace logging when aquiring and releasing operation locks for replication requests

time:
2016-11-10T19:56:48Z
class:
core/src/main/java/org/elasticsearch/transport/TransportService.java
comments:
Fix handler name on message not fully read

Today when a message is not fully read on a response, we log (among
other details) the handler name. Unfortunately, if the handler is a
wrapper, all that we see is

o.e.t.TransportService$ContextRestoreResponseHandler@7446ba18

completely losing the offending handler. This commit adds an override
for TransportService$ContextRestoreResponseHandler#toString so that the
underlying offender can be discovered.

Relates #21478

time:
2016-11-10T19:46:14Z
class:
core/src/test/java/org/elasticsearch/script/ScriptServiceTests.java
comments:
Remove accidental import.

time:
2016-11-10T19:32:14Z
class:
core/src/main/java/org/elasticsearch/action/support/nodes/TransportNodesAction.java
comments:
Improve log message in TransportNodesAction

Today when handling responses from nodes in TransportNodesAction, if a
node timeouts or some other failure occurs and the action is not
accumulating exceptions, we log a confusing message:

org.elasticsearch.action.admin.cluster.stats.TransportClusterStatsAction]
ignoring unexpected response [null] of type [null], expected
[ClusterStatsNodeResponse] or [FailedNodeException]

Moreover, the original exception is completely lost. Since this log
message is confusing and unhelpful, we can drop it. Instead, we hold
onto the exception and log it at the warn level before dropping it from
the response.

Relates #21476

time:
2016-11-10T17:59:13Z
class:
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/common/xcontent/ConstructingObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentType.java
core/src/main/java/org/elasticsearch/common/xcontent/support/AbstractXContentParser.java
core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java
core/src/main/java/org/elasticsearch/ingest/InternalTemplateService.java
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketscript/BucketScriptPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketselector/BucketSelectorPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/support/AbstractValuesSourceParser.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/sort/ScriptSortBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionBuilder.java
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/action/bulk/BulkRequestTests.java
core/src/test/java/org/elasticsearch/action/bulk/BulkWithUpdatesIT.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/cluster/NoMasterNodeIT.java
core/src/test/java/org/elasticsearch/common/xcontent/XContentParserTests.java
core/src/test/java/org/elasticsearch/index/WaitUntilRefreshIT.java
core/src/test/java/org/elasticsearch/index/query/InnerHitBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryDSLDocumentationTests.java
core/src/test/java/org/elasticsearch/index/query/ScriptQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/script/FileScriptTests.java
core/src/test/java/org/elasticsearch/script/IndexLookupIT.java
core/src/test/java/org/elasticsearch/script/NativeScriptTests.java
core/src/test/java/org/elasticsearch/script/ScriptContextTests.java
core/src/test/java/org/elasticsearch/script/ScriptFieldIT.java
core/src/test/java/org/elasticsearch/script/ScriptServiceTests.java
core/src/test/java/org/elasticsearch/script/ScriptTests.java
core/src/test/java/org/elasticsearch/search/SearchCancellationIT.java
core/src/test/java/org/elasticsearch/search/SearchTimeoutIT.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregationTestScriptsPlugin.java
core/src/test/java/org/elasticsearch/search/aggregations/EquivalenceIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateRangeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DoubleTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/HistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/IpRangeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/LongTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/MinDocCountIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/RangeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsSignificanceScoreIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/StringTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/AvgIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/CardinalityIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ExtendedStatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MaxIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MinIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ScriptedMetricIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ScriptedMetricTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/StatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/SumIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ValueCountIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketScriptIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketScriptTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketSelectorIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketSelectorTests.java
core/src/test/java/org/elasticsearch/search/basic/TransportTwoNodesSearchIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/InnerHitsIT.java
core/src/test/java/org/elasticsearch/search/fields/SearchFieldsIT.java
core/src/test/java/org/elasticsearch/search/functionscore/ExplainableScriptIT.java
core/src/test/java/org/elasticsearch/search/functionscore/FunctionScoreIT.java
core/src/test/java/org/elasticsearch/search/functionscore/RandomScoreFunctionIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoDistanceIT.java
core/src/test/java/org/elasticsearch/search/scriptfilter/ScriptQuerySearchIT.java
core/src/test/java/org/elasticsearch/search/sort/ScriptSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/SimpleSortIT.java
core/src/test/java/org/elasticsearch/search/stats/SearchStatsIT.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionBuilderTests.java
core/src/test/java/org/elasticsearch/update/TimestampTTLBWIT.java
core/src/test/java/org/elasticsearch/update/UpdateByNativeScriptIT.java
core/src/test/java/org/elasticsearch/update/UpdateIT.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/support/MultiValuesSourceParser.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ScriptProcessor.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorTests.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/IndexedExpressionTests.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/MoreExpressionTests.java
modules/lang-groovy/src/main/java/org/elasticsearch/script/groovy/GroovyScriptEngineService.java
modules/lang-groovy/src/test/java/org/elasticsearch/script/groovy/GroovyIndexedScriptTests.java
modules/lang-groovy/src/test/java/org/elasticsearch/script/groovy/GroovyScriptTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/CustomMustacheFactory.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MustacheScriptEngineService.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TemplateQueryBuilder.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/CustomMustacheFactoryTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MustacheScriptEngineTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/TemplateQueryBuilderTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorQuerySearchIT.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestUpdateByQueryAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RoundTripTests.java
plugins/lang-javascript/src/main/java/org/elasticsearch/script/javascript/JavaScriptScriptEngineService.java
comments:
Clean up of Script.

Closes #21321

time:
2016-11-10T16:32:46Z
class:
core/src/test/java/org/elasticsearch/common/rounding/TimeZoneRoundingTests.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldMapperTests.java
comments:
Update Joda Time to version 2.9.5 (#21468)

This commit updates JodaTime to version 2.9.5 that contain a fix for a bug when parsing time zones (see https://github.com/JodaOrg/joda-time/pull/332, https://github.com/JodaOrg/joda-time/issues/386 and https://github.com/JodaOrg/joda-time/issues/373).

It also remove the joda-convert dependency that seems to be unused.
    
closes #20911

Here is the changelog for 2.9.5:
```
Changes in 2.9.5
----------------
 - Add Norwegian period translations [#378]

 - Add Duration.dividedBy(long,RoundingMode) [#69, #379]

 - DateTimeZone data updated to version 2016i

 - Fixed bug where clock read twice when comparing two nulls in DateTimeComparator [#404]

 - Fixed minor issues with historic time-zone data [#373]

 - Fix bug in time-zone binary search [#332, #386]
  The fix in v2.9.2 caused problems when the time-zone being parsed
  was not the last element in the input string. New approach uses a
  different approach to the problem.

 - Update tests for JDK 9 [#394]

 - Close buffered reader correctly in zone info compiler [#396]

 - Handle locale correctly zone info compiler [#397]
```

time:
2016-11-10T16:32:19Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java
core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregation.java
core/src/test/java/org/elasticsearch/action/search/SearchPhaseControllerTests.java
comments:
Remove unused ClusterService dependency from SearchPhaseController (#21421)

time:
2016-11-10T15:52:38Z
class:
comments:
Remove max_local_storage_nodes from elasticsearch.yml (#21467)

Given that the default is now 1, the comment in the config file was outdated. Also considering that the default value is production ready, we shouldn't list it among the values that need attention when going to production.

Relates to #19964

time:
2016-11-10T15:49:25Z
class:
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RethrottleTests.java
comments:
Wait for all reindex subtasks before rethrottling

In the test for reindex and friend's rethrottling feature we were waiting
only for a single reindex sub task to start before rethrottling. This
mostly worked because starting tasks is fast. But it didn't *always work
and CI found that for us. This fixes the test to wait for all subtasks
to start before rethrottling.

I reproduced this locally semi-consistently with some fairly creative
`Thread.sleep` calls and this test fix fixes the issue even with the
sleeps so I'm fairly sure this will work consistently.

Closes #21446

time:
2016-11-10T15:17:19Z
class:
comments:
Correcting a typo-Maan to Man-in README.textile (#21466)

time:
2016-11-10T12:13:38Z
class:
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java
core/src/test/java/org/elasticsearch/search/fields/SearchFieldsIT.java
core/src/test/java/org/elasticsearch/search/internal/InternalSearchHitTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ClientScrollableHitSource.java
comments:
Fix InternalSearchHit#hasSource to return the proper boolean value (#21441)

The method used to be called `isSourceEmpty`, and was renamed to `hasSource`, but the return value never changed. Updated tests and users accordingly.

Closes #21419

time:
2016-11-10T11:23:19Z
class:
comments:
Replace all index date-math examples with the URI encoded form

Closes #21454

time:
2016-11-10T10:55:04Z
class:
comments:
Fix typos (#21456)

Delete repeated words " between nodes and".

time:
2016-11-10T10:11:47Z
class:
comments:
Adapt ES_JVM_OPTIONS packaging test to ubuntu-1204

This commit adapts the "[INIT.D] start Elasticsearch with custom JVM options" packaging test so that it works on ubuntu-1204.

Related to #21445

time:
2016-11-10T09:54:43Z
class:
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java
core/src/test/java/org/elasticsearch/search/internal/InternalSearchHitTests.java
comments:
Add null check in InternalSearchHit#sourceRef to prevent NPE (#21431)

Add null check in InternalSearchHit#sourceRef to prevent NPE

Closes #19279

time:
2016-11-10T08:00:13Z
class:
comments:
Add VirtualBox version check (#21370)

This commit ensure that VirtualBox is available in version 5.1+ in the system before running packaging tests. It also check for Vagrant version is now greater than 1.8.6.

time:
2016-11-09T22:52:37Z
class:
comments:
Export ES_JVM_OPTIONS for SysV init

The environment variable ES_JVM_OPTIONS allows end-users to specify a
custom location for the jvm.options file. Unfortunately, this
environment variable is not exported from the SysV init scripts. This
commit addresses this issue, and includes a test that ES_JVM_OPTIONS and
ES_JAVA_OPTS work for the SysV init packages.

Relates #21445

time:
2016-11-09T22:50:09Z
class:
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RethrottleTests.java
comments:
Skip reindex rethrottle tests with workers

They are flakey and spuriously fail the build. I'll hunt down
the cause soon and reenabled but for now they should stop.

Relates #21446

time:
2016-11-09T21:50:06Z
class:
comments:
Make forbidden APIs be quieter about classpath warnings (#21443)

We currently have a lot of log messages in our CI output like

```
[thirdPartyAudit] WARNING: The referenced class 'org.noggit.JSONParser' cannot be loaded. Please fix the classpath!
[thirdPartyAudit] WARNING: The referenced class 'org.noggit.JSONParser' cannot be loaded. Please fix the classpath!
[thirdPartyAudit] WARNING: The referenced class 'org.noggit.JSONParser' cannot be loaded. Please fix the classpath!
[thirdPartyAudit] WARNING: The referenced class 'org.noggit.JSONParser' cannot be loaded. Please fix the classpath!
[thirdPartyAudit] WARNING: The referenced class 'org.noggit.JSONParser' cannot be loaded. Please fix the classpath!
[thirdPartyAudit] WARNING: The referenced class 'org.noggit.JSONParser' cannot be loaded. Please fix the classpath!
[thirdPartyAudit] WARNING: The referenced class 'org.noggit.JSONParser' cannot be loaded. Please fix the classpath!
[thirdPartyAudit] WARNING: The referenced class 'org.noggit.JSONParser' cannot be loaded. Please fix the classpath!
[thirdPartyAudit] WARNING: The referenced class 'org.noggit.JSONParser' cannot be loaded. Please fix the classpath!
... repeated 1827281 times ...
```

This changes these messages to be logged at the DEBUG level, so they
will not show up by default.

time:
2016-11-09T20:59:45Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
comments:
Ensure write operation execution does not have side-effects (#21430)

Currently, `executeIndexRequestOnPrimary` and `executeDeleteRequestOnPrimary`
methods used to prepare and execute write operations, modifies the provided
request, updating the version and versionType. This commit makes it the
callers responsibility to update request version and versionType and avoids
mutating the provided request in the execute methods.

time:
2016-11-09T20:13:41Z
class:
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryParser.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryStringBuilderTests.java
core/src/test/java/org/elasticsearch/search/query/QueryStringIT.java
core/src/test/java/org/elasticsearch/search/query/SimpleQueryStringIT.java
comments:
Merge remote-tracking branch 'dakrone/sqs-all-field-mode'

time:
2016-11-09T17:38:51Z
class:
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryParser.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryStringBuilderTests.java
core/src/test/java/org/elasticsearch/search/query/QueryStringIT.java
core/src/test/java/org/elasticsearch/search/query/SimpleQueryStringIT.java
comments:
Add "all fields" execution mode to simple_query_string query

This commit introduces a new execution mode for the
`simple_query_string` query, which is intended down the road to be a
replacement for the current _all field.

It now does auto-field-expansion and auto-leniency when the following criteria
are ALL met:

    The _all field is disabled
    No default_field has been set in the index settings
    No fields are specified in the request

Additionally, a user can force the "all-like" execution by setting the
all_fields parameter to true.

When executing in all field mode, the `simple_query_string` query will
look at all the fields in the mapping that are not metafields and can be
searched, and automatically expand the list of fields that are going to
be queried.

Relates to #20925, which is the `query_string` version of this work.
This is basically the same behavior, but for the `simple_query_string`
query.

Relates to #19784

time:
2016-11-09T17:28:51Z
class:
core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java
comments:
Clearer log messages in bootstrap checks

This commit clarifies some log messages for the bootstrap checks. The
message is that the user has limits set that are below the minimums that
Elasticsearch requires.

Relates #21423

time:
2016-11-09T14:20:15Z
class:
comments:
Added note to ICU docs about the possible need to reindex (#21426)

when upgrading from a previous major version.

Relates #21352

time:
2016-11-09T12:20:11Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/AnalyzerCaster.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/PainlessParser.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/Walker.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EConditional.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PCallInvoke.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PField.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PSubNullSafeCallInvoke.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PSubNullSafeField.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/BasicExpressionTests.java
comments:
Implement reading from null safe dereferences

Null safe dereferences make handling null or missing values shorter.
Compare without:
```
if (ctx._source.missing != null && ctx._source.missing.foo != null) {
  ctx._source.foo_length = ctx.source.missing.foo.length()
}
```

To with:
```
Integer length = ctx._source.missing?.foo?.length();
if (length != null) {
  ctx._source.foo_length = length
}
```

Combining this with the as of yet unimplemented elvis operator allows
for very concise defaults for nulls:
```
ctx._source.foo_length = ctx._source.missing?.foo?.length() ?: 0;
```

Since you have to start somewhere, we started with null safe dereferenes.

Anyway, this is a feature borrowed from groovy. Groovy allows writing to
null values like:
```
def v = null
v?.field = 'cat'
```
And the writes are simply ignored. Painless doesn't support this at this
point because it'd be complex to implement and maybe not all that useful.

There is no runtime cost for this feature if it is not used. When it is
used we implement it fairly efficiently, adding a jump rather than a
temporary variable.

This should also work fairly well with doc values.

time:
2016-11-09T12:09:59Z
class:
comments:
Remove 5.x references from cat API migration doc

This commit removes some references to 5.x that were picked up when the
migration docs for the cat API were migrated from 5.x to master.

Relates #21342

time:
2016-11-09T12:07:52Z
class:
comments:
Add migration docs for cat API

This commit adds migration docs for the cat API, including a note
regarding the change in response in the cat thread pool API for
unbounded queue sizes.

Relates #21342

time:
2016-11-09T11:18:39Z
class:
core/src/test/java/org/elasticsearch/indices/memory/breaker/RandomExceptionCircuitBreakerIT.java
core/src/test/java/org/elasticsearch/search/basic/SearchWithRandomExceptionsIT.java
comments:
Revert "Fix tests overriding mock engine to avoid builtin mock"

This reverts commit 05e96089e192af421b055cdef1fe5e185989557c.

time:
2016-11-09T10:54:56Z
class:
comments:
Updated install docs to add missing empty cell in directory layout

time:
2016-11-09T10:53:16Z
class:
comments:
Update zip-targz.asciidoc

Added missing empty cell in directory layout table

time:
2016-11-09T10:32:16Z
class:
core/src/main/java/org/elasticsearch/cluster/ClusterModule.java
core/src/main/java/org/elasticsearch/cluster/InternalClusterInfoService.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/Plugin.java
core/src/test/java/org/elasticsearch/indices/memory/breaker/RandomExceptionCircuitBreakerIT.java
core/src/test/java/org/elasticsearch/search/basic/SearchWithRandomExceptionsIT.java
plugins/ingest-geoip/src/main/java/org/elasticsearch/ingest/geoip/IngestGeoIpPlugin.java
plugins/jvm-example/src/main/java/org/elasticsearch/plugin/example/JvmExamplePlugin.java
test/framework/src/main/java/org/elasticsearch/cluster/MockInternalClusterInfoService.java
test/framework/src/main/java/org/elasticsearch/index/MockEngineFactoryPlugin.java
test/framework/src/main/java/org/elasticsearch/node/MockNode.java
comments:
Revert "Tests: Remove a couple test uses of onModule (#21414)"

This reverts commit b326f0bc513f5a0c4d13e51387b2b580dd8accf3.

time:
2016-11-09T00:49:48Z
class:
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/node/Node.java
comments:
Add back guice binding for ZenPing

This should be removed, but some tests still rely on it being availale
from the injector in order to mess with it.
this is used to clear the "memory" of those pings so we can create a certain scenario and not have to wait 3s for the ZenPings to forget on their own. If we move towards a MockZenDiscovery this can be put there.

time:
2016-11-09T00:13:16Z
class:
core/src/test/java/org/elasticsearch/indices/memory/breaker/RandomExceptionCircuitBreakerIT.java
core/src/test/java/org/elasticsearch/search/basic/SearchWithRandomExceptionsIT.java
comments:
Fix tests overriding mock engine to avoid builtin mock

time:
2016-11-08T22:51:31Z
class:
core/src/main/java/org/elasticsearch/common/util/concurrent/EsThreadPoolExecutor.java
core/src/main/java/org/elasticsearch/common/util/concurrent/PrioritizedEsThreadPoolExecutor.java
core/src/main/java/org/elasticsearch/common/util/concurrent/ThreadContext.java
core/src/test/java/org/elasticsearch/common/util/concurrent/ThreadContextTests.java
comments:
Restore thread's original context before returning to the ThreadPool

This commit ensures that we always restore the thread's original context after execution of
a context preserving runnable. We always wrap runnables in a wrapper that restores the context
at the time it was submitted to the execute method. The ContextPreservingAbstractRunnable
would restore the calling context in the doRun method and then in a try with resources
block would restore the thread's original context. However, the onFailure and onAfter methods
of a AbstractRunnable could modify the thread context and this modified thread context would
continue on as the thread's context after it was returned to the pool and potentially used
for a different purpose.

time:
2016-11-08T21:50:13Z
class:
core/src/main/java/org/elasticsearch/cluster/ClusterModule.java
core/src/main/java/org/elasticsearch/cluster/InternalClusterInfoService.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/Plugin.java
core/src/test/java/org/elasticsearch/indices/memory/breaker/RandomExceptionCircuitBreakerIT.java
core/src/test/java/org/elasticsearch/search/basic/SearchWithRandomExceptionsIT.java
plugins/ingest-geoip/src/main/java/org/elasticsearch/ingest/geoip/IngestGeoIpPlugin.java
plugins/jvm-example/src/main/java/org/elasticsearch/plugin/example/JvmExamplePlugin.java
test/framework/src/main/java/org/elasticsearch/cluster/MockInternalClusterInfoService.java
test/framework/src/main/java/org/elasticsearch/index/MockEngineFactoryPlugin.java
test/framework/src/main/java/org/elasticsearch/node/MockNode.java
comments:
Tests: Remove a couple test uses of onModule (#21414)

There were still a couple test use cases and examples that were using
onModule. This change cleans those cases up.

time:
2016-11-08T21:21:57Z
class:
comments:
Test: Make ant log for wait condition quieter by default (#21385)

This change simply makes the level of the ant timestamp for waiting on
the integ test cluster echo at the info level instead of warn (the
default) so that it is only output when running with gradle --info, or
when the wait condition fails.

time:
2016-11-08T20:52:10Z
class:
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/DiscoveryPlugin.java
core/src/main/java/org/elasticsearch/plugins/Plugin.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryModuleTests.java
plugins/discovery-azure-classic/src/main/java/org/elasticsearch/cloud/azure/classic/management/AzureComputeServiceImpl.java
plugins/discovery-azure-classic/src/main/java/org/elasticsearch/plugin/discovery/azure/classic/AzureDiscoveryPlugin.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/plugin/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedDiscoveryPlugin.java
plugins/discovery-gce/src/main/java/org/elasticsearch/plugin/discovery/gce/GceDiscoveryPlugin.java
comments:
Plugins: Convert custom discovery to pull based plugin (#21398)

* Plugins: Convert custom discovery to pull based plugin

This change primarily moves registering custom Discovery implementations
to the pull based DiscoveryPlugin interface. It also keeps the cloud
based discovery plugins re-registering ZenDiscovery under their own name
in order to maintain backwards compatibility. However,
discovery.zen.hosts_provider is changed here to no longer fallback to
discovery.type. Instead, each plugin which previously relied on the
value of discovery.type now sets the hosts_provider to itself if
discovery.type is set to itself, along with a deprecation warning.

time:
2016-11-08T18:47:15Z
class:
comments:
Clarify requesting all stats in node stats docs

This commit clarifies how to explicitly obtain all stats from the node
stats API.

time:
2016-11-08T16:42:07Z
class:
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByScrollRequest.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RoundTripTests.java
comments:
Switch reindex with slices error to IAE

If you try to reindex with multiple slices against a node that
doesn't support it we throw an `IllegalArgumentException` so
`assertVersionSerializable` is ok with it and so if this happens
in REST it comes back as a 400 error.

time:
2016-11-08T16:36:12Z
class:
test/framework/src/main/java/org/elasticsearch/test/hamcrest/ElasticsearchAssertions.java
test/framework/src/test/java/org/elasticsearch/test/hamcrest/ElasticsearchAssertionsTests.java
comments:
Ignore IAE when checking for version serialization

This allows us to throw IllegalArgumentException from serialization code
when the destination node can't support the request.

time:
2016-11-08T15:42:42Z
class:
client/rest/src/main/java/org/elasticsearch/client/HeapBufferedAsyncResponseConsumer.java
client/rest/src/main/java/org/elasticsearch/client/HttpAsyncResponseConsumerFactory.java
client/rest/src/main/java/org/elasticsearch/client/RestClient.java
client/rest/src/test/java/org/elasticsearch/client/HeapBufferedAsyncResponseConsumerTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientMultipleHostsIntegTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostIntegTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
comments:
Rest client: don't reuse that same HttpAsyncResponseConsumer across multiple retries (#21378)

* Rest client: don't reuse that same HttpAsyncResponseConsumer across multiple retries

Turns out that AbstractAsyncResponseConsumer from apache async http client is stateful and cannot be reused across multiple requests. The failover mechanism was mistakenly reusing that same instance, which can be provided by users, across retries in case nodes are down or return 5xx errors. The downside is that we have to change the signature of two public methods, as HttpAsyncResponseConsumer cannot be provided directly anymore, rather its factory needs to be provided which is going to be used to create one instance of the consumer per request attempt.

Up until now we tested our RestClient against multiple nodes only in a mock environment, where we don't really send http requests. In that scenario we can verify that retries etc. work properly but the interaction with the http client library in a real scenario is different and can catch other problems. With this commit we also add an integration test that sends requests to multiple hosts, and some of them may also get stopped meanwhile. The specific test for pathPrefix was also removed as pathPrefix is now randomly applied by default, hence implicitly tested. Moved also a small test method that checked the validity of the path argument to the unit test RestClientSingleHostTests.

Also increase default buffer limit to 100MB and make it required in default consumer

The default buffer limit used to be 10MB but that proved not to be high enough for scroll requests (see reindex from remote). With this commit we increase the limit to 100MB and make it a bit more visibile in the consumer factory.

time:
2016-11-08T15:32:10Z
class:
core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java
comments:
Remove redundant Javadocs from G1GC check

This commit removes some unnecessary Javadocs from the G1GC bootstrap
check. The code here is self-explanatory.

time:
2016-11-08T15:16:06Z
class:
core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapCheckTests.java
comments:
Cleanup Javadocs in BootstrapCheck.java

This commit cleans up the formatting of some Javadocs in
BootstrapCheck.java, and corrects some docs that had become stale as the
bootstrap checks evolved.

time:
2016-11-08T15:09:06Z
class:
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointSyncAction.java
core/src/main/java/org/elasticsearch/index/seqno/SeqNoStats.java
core/src/main/java/org/elasticsearch/index/seqno/SequenceNumbersService.java
core/src/main/java/org/elasticsearch/index/translog/Checkpoint.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/index/translog/TranslogConfig.java
core/src/main/java/org/elasticsearch/index/translog/TranslogReader.java
core/src/main/java/org/elasticsearch/index/translog/TranslogWriter.java
core/src/main/java/org/elasticsearch/index/translog/TruncateTranslogCommand.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/seqno/GlobalCheckpointSyncActionTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogVersionTests.java
comments:
Add global checkpoint to translog checkpoints

This commit adds the sequence number global checkpoint to translog
checkpoints, and removes them from Lucene commits.

Relates #21254

time:
2016-11-08T14:36:47Z
class:
comments:
Skip alias name validation rest test on 5.0 cluster

Alias name validation was introduced in 5.1.

time:
2016-11-08T13:37:09Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java
core/src/main/java/org/elasticsearch/action/support/ActiveShardsObserver.java
core/src/main/java/org/elasticsearch/action/support/master/TransportMasterNodeAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationAction.java
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateObserver.java
core/src/main/java/org/elasticsearch/cluster/MasterNodeChangePredicate.java
core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterServiceState.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterStateStatus.java
core/src/main/java/org/elasticsearch/discovery/zen/PublishClusterStateAction.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/store/IndicesStore.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/test/java/org/elasticsearch/bwcompat/ClusterStateBackwardsCompatIT.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceIT.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
comments:
Remove mutable status field from cluster state (#21379)

The ClusterState class currently has a mutable volatile field "status" that is only used by the ClusterStateObserver to differentiate between a cluster state that is being applied or one that has already been applied. This commit removes the field from cluster state, making it a truly immutable class. This information is stored instead by ClusterService, which is the only place that should update this field (PublishClusterStateAction was also updating it, but that information was never used anywhere). A new class is introduced (ClusterServiceState) which emcompasses the current cluster state as well as the current status, which is only used by the ClusterStateObserver mechanism.

time:
2016-11-08T13:33:45Z
class:
comments:
Fix markup in sysconfig-file docs

This commit fixes a markup issue in the sysconfig-file docs, adding a
missing backtick.

time:
2016-11-08T13:23:12Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/AliasValidator.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/indices/InvalidAliasNameException.java
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/cluster/metadata/AliasValidatorTests.java
comments:
Validate alias names the same as index names

Applied (almost) the same rules we use to validate index names
to new alias names. The only rule not applies it "must be lowercase".
We have tests that don't follow that rule and I except there are lots
of examples of camelCase alias names in the wild. We can add that
validation but I'm not sure it is worth it.

Closes #20748

Adds an alias that starts with `#` to the BWC index and validates
that you can read from it and remove it. Starting with `#` isn't
allowed after 5.1.0/6.0.0 so we don't create the alias or check it
after those versions.

time:
2016-11-08T13:08:45Z
class:
comments:
Fix version constant in Groovy API docs

This commit fixes the version constant in the Groovy API docs from
5.0.0-alpha5 to 6.0.0-alpha1.

time:
2016-11-08T10:52:52Z
class:
comments:
minor grammatical fix (#21384)

time:
2016-11-08T10:26:55Z
class:
core/src/test/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteRequestTests.java
comments:
Fixes compile error in Eclipse in ClusterRerouteRequestTests (#21400)

Before this change Eclipse (4.6.1) would show compile errors in `ClusterRerouteRequestTests` for the elements in `RANDOM_COMMAND_GENERATORS`. This seems to be because the eclipse compiler does not recognised that the elements in the list are all `Supplier`s of bjects that are subclasses of `AllocationCommand`.

This change fixes the problem by adding a generics hint to the `Arrays.toList()` call.

time:
2016-11-08T10:07:54Z
class:
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
comments:
Make ensureGreen and ensureYellow wait for cluster size consistency (#21344)

We currently often use ensureGreen or ensureYellow to check whether the cluster is in a good state again after shutting down a node. With the change in #21092, however, it can happen that if the node that is stopped is the master node, another node will become master and publish a cluster state where it is master but where the node that was stopped hasn't been removed yet from the cluster state. It will only publish a second state thereafter where the old master is removed. If the ensureGreen/ensureYellow is timed just right, it will get to execute before the second cluster state update removing the old master and the condition ensureGreen / ensureYellow might not hold at that point anymore.

time:
2016-11-08T01:04:41Z
class:
core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapCheckTests.java
comments:
Better fix for java8 restriction of g1gc check

This makes the fix actually testable.

time:
2016-11-07T23:29:35Z
class:
comments:
Move licenses for core jar to core directory (#21383)

All plugins currently have their own licenses dir for the
dependencyLicenses task, but core disables this and has the check inside
distribution. This may have been better for maven, but for
gradle it makes more sense to just use the dependencyLicenses task that
automatically exists inside :core, and remove the hacked up version that
is inside distribution.

time:
2016-11-07T23:07:34Z
class:
distribution/deb/src/test/java/org/elasticsearch/test/rest/DebClientYamlTestSuiteIT.java
distribution/integ-test-zip/src/test/java/org/elasticsearch/test/rest/IntegTestZipClientYamlTestSuiteIT.java
distribution/rpm/src/test/java/org/elasticsearch/test/rest/RpmClientYamlTestSuiteIT.java
distribution/tar/src/test/java/org/elasticsearch/test/rest/TarClientYamlTestSuiteIT.java
distribution/zip/src/test/java/org/elasticsearch/test/rest/ZipClientYamlTestSuiteIT.java
docs/src/test/java/org/elasticsearch/smoketest/DocsClientYamlTestSuiteIT.java
modules/aggs-matrix-stats/src/test/java/org/elasticsearch/search/aggregations/matrix/MatrixStatsClientYamlTestSuiteIT.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/IngestCommonClientYamlTestSuiteIT.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/LangExpressionClientYamlTestSuiteIT.java
modules/lang-groovy/src/test/java/org/elasticsearch/script/groovy/LangGroovyClientYamlTestSuiteIT.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/LangMustacheClientYamlTestSuiteIT.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/LangPainlessClientYamlTestSuiteIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorClientYamlTestSuiteIT.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexClientYamlTestSuiteIT.java
modules/transport-netty3/src/test/java/org/elasticsearch/http/netty3/Netty3ClientYamlTestSuiteIT.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4ClientYamlTestSuiteIT.java
plugins/analysis-icu/src/test/java/org/elasticsearch/index/analysis/IcuClientYamlTestSuiteIT.java
plugins/analysis-kuromoji/src/test/java/org/elasticsearch/index/analysis/KuromojiClientYamlTestSuiteIT.java
plugins/analysis-phonetic/src/test/java/org/elasticsearch/index/analysis/PhoneticClientYamlTestSuiteIT.java
plugins/analysis-smartcn/src/test/java/org/elasticsearch/index/analysis/SmartCNClientYamlTestSuiteIT.java
plugins/analysis-stempel/src/test/java/org/elasticsearch/index/analysis/StempelClientYamlTestSuiteIT.java
plugins/analysis-ukrainian/src/test/java/org/elasticsearch/index/analysis/UkrainianClientYamlTestSuiteIT.java
plugins/discovery-azure-classic/src/test/java/org/elasticsearch/discovery/azure/classic/DiscoveryAzureClassicClientYamlTestSuiteIT.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/cloud/aws/CloudAwsClientYamlTestSuiteIT.java
plugins/discovery-file/src/test/java/org/elasticsearch/discovery/file/FileBasedDiscoveryClientYamlTestSuiteIT.java
plugins/discovery-gce/src/test/java/org/elasticsearch/discovery/gce/DiscoveryGceClientYamlTestSuiteIT.java
plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/IngestAttachmentClientYamlTestSuiteIT.java
plugins/ingest-geoip/src/test/java/org/elasticsearch/ingest/geoip/IngestGeoIpClientYamlTestSuiteIT.java
plugins/ingest-user-agent/src/test/java/org/elasticsearch/ingest/useragent/IngestUserAgentClientYamlTestSuiteIT.java
plugins/jvm-example/src/test/java/org/elasticsearch/plugin/example/JvmExampleClientYamlTestSuiteIT.java
plugins/lang-javascript/src/test/java/org/elasticsearch/script/javascript/LangJavascriptClientYamlTestSuiteIT.java
plugins/lang-python/src/test/java/org/elasticsearch/script/python/LangPythonClientYamlTestSuiteIT.java
plugins/mapper-murmur3/src/test/java/org/elasticsearch/index/mapper/murmur3/MapperMurmur3ClientYamlTestSuiteIT.java
plugins/mapper-size/src/test/java/org/elasticsearch/index/mapper/size/MapperSizeClientYamlTestSuiteIT.java
plugins/repository-azure/src/test/java/org/elasticsearch/repositories/azure/RepositoryAzureClientYamlTestSuiteIT.java
plugins/repository-gcs/src/test/java/org/elasticsearch/repositories/gcs/RepositoryGcsClientYamlTestSuiteIT.java
plugins/repository-hdfs/src/test/java/org/elasticsearch/repositories/hdfs/RepositoryHdfsClientYamlTestSuiteIT.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/RepositoryS3ClientYamlTestSuiteIT.java
plugins/store-smb/src/test/java/org/elasticsearch/index/store/StoreSmbClientYamlTestSuiteIT.java
qa/backwards-5.0/src/test/java/org/elasticsearch/backwards/Backwards50ClientYamlTestSuiteIT.java
qa/rolling-upgrade/src/test/java/org/elasticsearch/upgrades/UpgradeClusterClientYamlTestSuiteIT.java
qa/smoke-test-ingest-disabled/src/test/java/org/elasticsearch/smoketest/SmokeTestIngestDisabledClientYamlTestSuiteIT.java
qa/smoke-test-ingest-with-all-dependencies/src/test/java/org/elasticsearch/smoketest/SmokeTestIngestWithAllDepsClientYamlTestSuiteIT.java
qa/smoke-test-multinode/src/test/java/org/elasticsearch/smoketest/SmokeTestMultiNodeClientYamlTestSuiteIT.java
qa/smoke-test-plugins/src/test/java/org/elasticsearch/smoketest/SmokeTestPluginsClientYamlTestSuiteIT.java
qa/smoke-test-reindex-with-painless/src/test/java/org/elasticsearch/smoketest/SmokeTestReindexWithPainlessClientYamlTestSuiteIT.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ESClientYamlSuiteTestCase.java
comments:
Test: Remove multi process support from rest test runner (#21391)

At one point in the past when moving out the rest tests from core to
their own subproject, we had multiple test classes which evenly split up
the tests to run. However, we simplified this and went back to a single
test runner to have better reproduceability in tests. This change
removes the remnants of that multiplexing support.

time:
2016-11-07T23:05:18Z
class:
core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java
comments:
Fix g1gc bootstrap check to only try parsing java version for java 8

time:
2016-11-07T22:26:28Z
class:
core/src/main/java/org/elasticsearch/monitor/os/OsProbe.java
comments:
Modify Javadoc line length in OsProbe.java

This commit changes the Javadocs in OsProbe.java to take advantage of
the fact that the line-length limit is 140 characters. This change makes
these Javadocs easier to read and easier to maintain.

time:
2016-11-07T21:35:39Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/bootstrap/JVMCheck.java
comments:
Remove JVMCheck

This commit removes JVMCheck. Previously there were three checks in this
class:
 - check for super word bug in JDK 7
 - check for G1GC bugs in JDK 8
 - check for broken IBM JDKs

The first check is obsolete since we require JDK 8 now. The second check
is refactored into a bootstrap check. The third check is removed since
we do not even support the IBM JDK.

Relates #21389

time:
2016-11-07T21:33:08Z
class:
comments:
Docs: Update discovery plugins example configuration with discovery.zen.hosts_provider (#21390)


This new setting was added with deguicing unicast hosts providers, but
the docs were not updated.

time:
2016-11-07T21:28:04Z
class:
comments:
Remove double space in bootstrap checks docs

This commit removes a double space in the G1GC check section of the
bootstrap check docs.

time:
2016-11-07T21:21:47Z
class:
comments:
increase logging level to DEBUG in backwards-5.0 tests

time:
2016-11-07T21:19:05Z
class:
core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java
core/src/main/java/org/elasticsearch/bootstrap/JVMCheck.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapCheckTests.java
comments:
Migrate G1GC JVM check to bootstrap check

This commit fixes an assertion in G1GCCheck#jvmVersion that was
mistakenly asserting on itself.

Relates #21388

time:
2016-11-07T20:50:06Z
class:
core/src/main/java/org/elasticsearch/bootstrap/JVMCheck.java
comments:
Remove JDK 7 checks from JVMCheck

This commit removes checks for buggy JDK 7 JVMs from the JVM check as
Elasticsearch does not support JDK 7.

Relates #21381

time:
2016-11-07T19:21:12Z
class:
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/common/util/concurrent/BaseFuture.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
comments:
assert blocking calls are not made on the cluster state update thread

This commit adds an assertion to ensure that we do not introduce blocking calls in code
that is called in a ClusterStateListener or another part of the cluster state update process.

time:
2016-11-07T19:20:28Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/TransportGetSnapshotsAction.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
comments:
Fixes get snapshot duplicates when asking for _all (#21340)

Before, when requesting to get the snapshots in a repository, if `_all` was
specified for the set of snapshots to get, any in-progress snapshots would
be returned twice.  This commit fixes the issue ensuring that each snapshot,
whether in-progress or completed, is only returned once when making a call to
get snapshots (GET /_snapshot/{repository_name}/_all).

This commit also enables `_current` to appear anywhere in 
the get snapshots list, and will be used as a pseudo regex to
mean "match any currently running snapshots".

Closes #21335

time:
2016-11-07T19:04:04Z
class:
core/src/main/java/org/elasticsearch/monitor/os/OsProbe.java
comments:
Remove load average leniency

Today when acquiring load average stats, this method is rather lenient
when reading /proc/loadavg. This commit removes this leniency so that
any such issues are more likely to be exposed to the end-user.

Relates #21380

time:
2016-11-07T18:20:22Z
class:
modules/transport-netty3/src/test/java/org/elasticsearch/http/netty3/Netty3HttpServerPipeliningTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerPipeliningTests.java
comments:
Address race condition in HTTP pipeline tests

This commit adapts a previous fix to the HTTP pipeline tests for Netty 4
to Netty 3.

Relates #19845

time:
2016-11-07T13:57:20Z
class:
comments:
Fix docs example after #21218.

time:
2016-11-07T13:48:50Z
class:
comments:
Removed left over ID and [float] from the setup docs

time:
2016-11-07T13:14:52Z
class:
comments:
The routing query string param is supported by mget but was missing from the rest spec (#21357)

time:
2016-11-07T12:59:11Z
class:
comments:
Packaging Deb: configure start-stop-daemon to not go into background (#21343)

On ubuntu 14.04, which uses upstart, where as our debian package uses
sysvinit, there is no stdout/stderr message printed when starting up,
because the start-stop-daemon swallows it.

As Elasticsearch is started to daemonize, we can remove the background
flag from the start-stop-daemon and thus see, if the system does not have
enough memory for starting up - something that happens often on VMs, since
Elasticsearch 5.0 uses 2gb by default instead of one.

Relates #21300
Relates #12716

time:
2016-11-07T12:48:04Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/PercentilesBucketIT.java
comments:
Fix PercentilesBucketIT expectations.

time:
2016-11-07T12:02:09Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/percentile/PercentilesBucketPipelineAggregator.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/PercentilesBucketIT.java
comments:
Percentiles bucket fails for 100th percentile (#21218)

It mistakenly multiplies the quantile by the array `length` instead of `length-1`.

time:
2016-11-07T10:46:22Z
class:
comments:
Docs fix - Diversified sampler agg had incorrect title and example
Closes #21347

time:
2016-11-07T01:15:45Z
class:
comments:
Make it clear _suggest doesn't support source filtering (#21268)

We plan to deprecate `_suggest` during 5.0 so it isn't worth fixing
it to support the `_source` parameter for `_source` filtering. But we
should fix the docs so they are accurate.

Since this removes the last non-`// CONSOLE` line in
`completion-suggest.asciidoc` this also removes it from the list of
files that have non-`// CONSOLE` docs.

Closes #20482

time:
2016-11-05T15:31:34Z
class:
comments:
Groovy is no longer the default scripting language

Closes #21208

time:
2016-11-05T13:58:16Z
class:
comments:
Update store.asciidoc (#21353)

* Update store.asciidoc

* Update store.asciidoc

* Update store.asciidoc

time:
2016-11-05T13:24:57Z
class:
comments:
Add remote debugger instructions to TESTING.asciidoc

time:
2016-11-05T01:59:19Z
class:
comments:
Fix asciidoc structure for sliced reindex

Asciidoc likes headings just so and will complain and fail the
docs build without it.

Related to #20767

time:
2016-11-05T00:59:15Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/cancel/TransportCancelTasksAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/TransportGetTaskAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/list/TransportListTasksAction.java
core/src/main/java/org/elasticsearch/action/support/tasks/BaseTasksResponse.java
core/src/main/java/org/elasticsearch/action/support/tasks/TasksRequestBuilder.java
core/src/main/java/org/elasticsearch/action/support/tasks/TransportTasksAction.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/main/java/org/elasticsearch/tasks/Task.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/RecordingTaskManagerListener.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TaskManagerTestCase.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TasksIT.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TestTaskPlugin.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TransportTasksActionTests.java
core/src/test/java/org/elasticsearch/search/AbstractSearchTestCase.java
core/src/test/java/org/elasticsearch/search/SearchRequestTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractAsyncBulkIndexByScrollAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBaseReindexRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByScrollRequest.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByScrollRequestBuilder.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkIndexByScrollRequest.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/BulkByScrollTask.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/BulkIndexByScrollResponse.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/DeleteByQueryRequest.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ParentBulkByScrollTask.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexParallelizationHelper.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestUpdateByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/SuccessfullyProcessed.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportRethrottleAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportUpdateByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/UpdateByQueryRequest.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/WorkingBulkByScrollTask.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AbstractAsyncBulkIndexByScrollActionTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AbstractBulkByScrollRequestTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AsyncBulkByScrollActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/BulkByScrollTaskTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/BulkIndexByScrollResponseMatcher.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/BulkIndexByScrollResponseTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/CancelTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/DeleteByQueryBasicTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/DeleteByQueryRequestTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ParentBulkByScrollTaskTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexBasicTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexParallelizationHelperTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexRequestTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RethrottleTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RoundTripTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/TransportRethrottleActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryBasicTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryRequestTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/WorkingBulkByScrollTaskTests.java
test/framework/src/main/java/org/elasticsearch/search/RandomSearchRequestGenerator.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
comments:
Add automatic parallelization support to reindex and friends (#20767)

Adds support for `?slices=N` to reindex which automatically
parallelizes the process using parallel scrolls on `_uid`. Performance
testing sees a 3x performance improvement for simple docs
on decent hardware, maybe 30% performance improvement
for more complex docs. Still compelling, especially because
clusters should be able to get closer to the 3x than the 30%
number.

Closes #20624

time:
2016-11-04T19:17:55Z
class:
core/src/main/java/org/elasticsearch/rest/action/cat/RestThreadPoolAction.java
comments:
Write -1 on unbounded queue in cat thread pool

Today when writing an unbounded queue_size in the cat thread pool API,
we write null. This commit modifies this so that the output is -1 so
that the output is always present, and always a numeric value.

Relates #21342

time:
2016-11-04T18:26:37Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/exists/indices/IndicesExistsRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/exists/indices/IndicesExistsRequestBuilder.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesExistsAction.java
core/src/test/java/org/elasticsearch/indices/exists/indices/IndicesExistsIT.java
comments:
Remove support for controversial ignore_unavailable and allow_no_indices from indices exists api (#20712)

Exist requests are supposed to never throw an exception, but rather return true or false depending on whether some resource exists or not. Indices exists does that for indices and accepts wildcard expressions too. The way the api works internally is by resolving indices and catching IndexNotFoundException: if an exception is thrown the index does not exist hence it returns false, otherwise it returns true. That works ok only if ignore_unavailable and allow_no_indices indices options are both set to false, meaning that they are strict and any missing index or wildcard expressions that resolves to no indices will lead to an exception that can be thrown and cause false to be returned.

Unfortunately the indices options have  been configurable up until now for this request, meaning that one can set ignore_unavailable or allow_no_indices to true and have the indices exist request return true for indices that really don't exist, which makes very little sense in the context of this api.

This commit removes the indicesOptions setter from the IndicesExistsRequest and makes settable only expandWildcardsOpen and expandWildcardsClosed, hence a subset of the available indices options. This way we can guarantee more consistent behaviour of the indices exists api. We can then remove the ignore_unavailable and allow_no_indices option from indices exists api spec

time:
2016-11-04T18:19:59Z
class:
core/src/main/java/org/elasticsearch/common/logging/DeprecationLogger.java
core/src/test/java/org/elasticsearch/bootstrap/MaxMapCountCheckTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsIT.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
Assert status logger does not warn on Log4j usage

Today if you start Elasticsearch with the status logger configured to
the warn level, or use a transport client with the default status logger
level, you will see warn messages about deprecation loggers being
created with different message factories and that formatting might be
broken. This happens because the deprecation logger is constructed using
the message factory from its parent, an artifact leftover from the first
Log4j 2 implementation that used a custom message factory. When that
custom message factory was removed, this constructor invocation should
have been changed to not explicitly use the message factory from the
parent. This commit fixes this invocation. However, we also had some
status checking to all tests to ensure that there are no warn status log
messages that might indicate a configuration problem with Log4j 2. These
assertions blow up badly without the fix for the deprecation logger
construction, and also caught a misconfiguration in one of the logging
tests.

Relates #21339

time:
2016-11-04T16:27:31Z
class:
comments:
Add elasticsearcher for PHP (#21143)

Disclaimer: it is a library written by one of the engineers in my company.

time:
2016-11-04T16:25:11Z
class:
comments:
Fix cat thread pool API spec

This commit fixes an issue with the cat thread pool API spec. Namely,
the name of the variable for the thread pool patterns parameter was
misnamed in the spec.

Relates #21332

time:
2016-11-04T15:00:53Z
class:
core/src/test/java/org/elasticsearch/index/query/SpanMultiTermQueryBuilderTests.java
comments:
Fix SpanMultiTermQueryBuilderTest by using a mock query

time:
2016-11-04T14:32:07Z
class:
comments:
Move flush in _cat/indices docs tests (#21117)

Moves the `_flush` in the `_cat/indices` snippets testing framework
to the very first test. We need to flush super early because index
size is cached for a few seconds so we really need to read a
consistent size on the first read so we can sort by it properly.

Closes #21062

time:
2016-11-04T12:53:28Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverAction.java
comments:
Validate the `_rollover` target index name early to also fail if dry_run=true (#21330)

Today we validate the target index name late and therefore don't fail for instance
if the target index already exists and `dry_run=true` was specified. This change
validates the index name before we early terminate if dry_run is set.

Closes #21149

time:
2016-11-04T12:53:03Z
class:
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyDateFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/RangeQueryBuilder.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyDateFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/query/RangeQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java
comments:
Remove LateParsingQuery to prevent timestamp access after context is frozen (#21328)

Today we still have a leftover from older percolators where lucene
query instances where created ahead of time and rewritten later.
This `LateParsingQuery` was resolving `now()` when it's really used which we
don't need anymore. As a side-effect this failed to execute some highlighting
queries when they get rewritten since at that point `now` access it not permitted
anymore to prevent bugs when queries get cached.

Closes #21295

time:
2016-11-04T11:46:18Z
class:
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/search/MultiMatchQuery.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/query/QueryStringIT.java
comments:
Add "all field" execution mode to query_string query

This commit introduces a new execution mode for the query_string query, which
is intended down the road to be a replacement for the current _all field.

It now does auto-field-expansion and auto-leniency when the following criteria
are ALL met:

    The _all field is disabled
    No default_field has been set in the index settings
    No default_field has been set in the request
    No fields are specified in the request

Additionally, a user can force the "all-like" execution by setting the
all_fields parameter to true.

When executing in all field mode, the query_string query will look at all the
fields in the mapping that are not metafields and can be searched, and
automatically expand the list of fields that are going to be queried.

Relates to #19784

time:
2016-11-04T11:24:40Z
class:
core/src/test/java/org/elasticsearch/common/joda/DateMathParserTests.java
comments:
Add tests for alternative ways of writing zero offset timezones

According to ISO 8601, a time zone offset of zero, can be stated numerically as
"+00:00", "+0000", or "00". The Joda library also seems to allow for "-00:00",
"-00" and "-0000". This adds some test to the DateMathParserTests that check
that we also conform to this.

Closes #21320

time:
2016-11-04T10:46:20Z
class:
core/src/main/java/org/elasticsearch/plugins/RemovePluginCommand.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/RemovePluginCommandTests.java
comments:
Removing plugin that isn't installed shouldn't trigger usage information

The usage information for `elasticsearch-plugin` is quiet verbose and makes the
actual error message that is shown when trying to remove an non-existing plugin
hard to spot. This changes the error code to not trigger printing the usage
information.

Closes #21250

time:
2016-11-04T09:36:38Z
class:
comments:
Generate POM files with non-wildcard excludes (#21234)

Dependencies are currently marked as non-transitive in generated POM files by adding a wildcard (*) exclusion. This breaks compatibility with the dependency manager Apache Ivy as it incorrectly translates POMs with * excludes to Ivy XML with * excludes which results in the main artifact being excluded as well (see https://issues.apache.org/jira/browse/IVY-1531). To stay compatible with the current release of Ivy this commit uses explicit excludes for each transitive artifact instead to ensure that the main artifact is not excluded. This should be revisited when we upgrade Gradle to a higher version as the current one (2.13) as Gradle automatically translates non-transitive dependencies to * excludes in 2.14+.

time:
2016-11-04T09:34:04Z
class:
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
Upgrade to lucene-6.3.0-snapshot-a66a445. (#21309)

This addresses a bug that was introduced with https://issues.apache.org/jira/browse/LUCENE-7501.

time:
2016-11-04T01:47:11Z
class:
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java
comments:
Only log rest connection setup once per suite (#21280)

This is a bit funky to do with junit because we need per test state
but we only want to log it per suite. So we use a static flag that
we test per test and reset before every suite.

time:
2016-11-04T00:40:39Z
class:
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationResponse.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationResponseTests.java
comments:
Fix ShardInfo#toString

ShardInfo#toString resorts to calling ShardInfo#toXContent via
Strings#toString. However, the resulting XContent object will not start
with an object, and this is a violation of the generator state
machine. This commit fixes this issue by replacing the override of
toString to provide simple non-toXContent output of the ShardInfo
instance. Without this fix, ShardInfo#toString will instead produce
"Error building toString out of XContent:
com.fasterxml.jackson.core.JsonGenerationException: Can not write a
field name, expecting a value"

Relates #21319

time:
2016-11-03T20:47:32Z
class:
comments:
[TEST] Skip new tests using ingnore_unavailable in BWC tests against 5.0.0

5.0.0 nodes don't understand these parameters and will throw an exception
if a 5.0.0 node will receive the request.

Relates to #21281

time:
2016-11-03T19:37:37Z
class:
comments:
[DOCS] "service" should be "elasticsearch-service" (#21311)

The Windows `service.bat` script was renamed to `elasticsearch-service.bat` in ES 5.0+.

time:
2016-11-03T17:36:07Z
class:
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
test/framework/src/main/java/org/elasticsearch/test/TestCluster.java
comments:
Add information about in-flight requests when checking IndexShard operation counter (#21308)

Our test infrastructure checks after running each test that there are no more in-flight requests on the shard level. Whenever the check fails, we only know that there were in-flight requests but don't know what requests were causing this issue. This commit adds the replication tasks that are still active at that moment to the assertion error.

time:
2016-11-03T17:05:18Z
class:
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestUpgradeAction.java
comments:
Read indices options in indices upgrade API (#21281)

With #21099 we removed support for the ignored allow_no_indices parameter in indices upgrade API. Truth is that ignore_unavailable and expand_wildcards were also ignored, in indices upgrade as well as upgrade status API. Those parameters are though supported internally and settable through java API, hence they should be all supported on the REST layer too.

time:
2016-11-03T15:48:55Z
class:
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/FilterAggregationBuilder.java
core/src/test/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/TermsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/indices/IndicesRequestCacheIT.java
comments:
Rewrite Queries/Filter in FilterAggregationBuilder and ensure client usage marks query as non-cachable (#21303)

`FilterAggregationBuilder` today misses to rewrite queries which causes failures
if a query that uses a client for instance to lookup terms since it must be rewritten first.
This change also ensures that if a client is used from the rewrite context we mark the query as
non-cacheable.

Closes #21301

time:
2016-11-03T15:20:20Z
class:
core/src/main/java/org/elasticsearch/common/component/AbstractLifecycleComponent.java
core/src/main/java/org/elasticsearch/common/util/ExtensionPoint.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/zen/FaultDetection.java
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenPingService.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/tribe/TribeClientNode.java
core/src/main/java/org/elasticsearch/tribe/TribeService.java
core/src/test/java/org/elasticsearch/common/util/ExtensionPointTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryModuleTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/tribe/TribeIT.java
qa/evil-tests/src/test/java/org/elasticsearch/tribe/TribeUnitTests.java
test/framework/src/main/java/org/elasticsearch/node/MockNode.java
test/framework/src/main/java/org/elasticsearch/test/discovery/MockZenPing.java
comments:
Remove pluggability of ZenPing (#21049)

Plugins: Remove pluggability of ZenPing

ZenPing is the part of zen discovery which knows how to ping nodes.
There is only one alternative implementation, which is just for testing.
This change removes the ability to add custom zen pings, and instead
hooks in the MockZenPing for tests through an overridden method in
MockNode. This also folds in the ZenPingService (which was really just a
single method) into ZenDiscovery, and removes the idea of having
multiple ZenPing instances. Finally, this was the last usage of the
ExtensionPoint classes, so that is also removed here.

time:
2016-11-03T15:07:52Z
class:
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3RepositoryTests.java
comments:
Make the default S3 buffer size depend on the available memory. (#21299)

Currently the default S3 buffer size is 100MB, which can be a lot for small
heaps. This pull request updates the default to be 100MB for heaps that are
greater than 2GB and 5% of the heap size otherwise.

time:
2016-11-03T14:14:46Z
class:
comments:
Remove broken docs link

The important settings docs previously referred to a section regarding
the node.max_local_storage_nodes setting. This section was removed, but
the link was not. This commit removes that link.

time:
2016-11-03T13:03:42Z
class:
comments:
Remove node.max_local_storage_nodes from setup doc

Previously node.max_local_storage_nodes defaulted to fifty, and this
permitted users to start multiple instances of Elasticsearch sharing the
same data folder. This can be dangerous, and usually it does not make
sense to run more than one instance of Elasticsearch on a single
server. Because of this, we had a note in the important settings docs
advising users to set this setting to one. However, we have since
changed the default value of this setting to one so this advise is no
longer needed.

Relates #21305

time:
2016-11-03T12:48:34Z
class:
comments:
Fixed rollover docs test for date math indices

time:
2016-11-03T10:23:38Z
class:
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java
comments:
[TEST] Add tests that combines highlighting and NOW parsing

Relates to #21295

time:
2016-11-03T09:48:50Z
class:
comments:
Specify date math with URI encoding in rollover API docs

Closes #21181

time:
2016-11-03T09:31:35Z
class:
core/src/main/java/org/elasticsearch/rest/action/cat/RestNodesAction.java
comments:
Consume `full_id` request parameter early (#21270)

Since we now validate all consumed request parameter, users can't specify
`_cat/nodes?full_id=true|false` anymore since this parameter is consumed late.
This commit adds a test for this parameter and consumes it before request is processed.

Closes #21266

time:
2016-11-03T08:02:29Z
class:
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
comments:
 pending states assertion should dump states

 This was removed in a cleanup assuming that Hamcrest will dump the array content. Sadly it only dumps the size.

time:
2016-11-03T07:58:53Z
class:
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java
core/src/main/java/org/elasticsearch/index/mapper/Mapper.java
comments:
Create the QueryShardContext lazily in DocumentMapperParser. (#21287)

This would allow MapperService to still be usable in contexts when a
QueryShardContext cannot be obtained, for instance in the case that a
MapperService needs to be created only to merge mappings.

time:
2016-11-03T07:58:15Z
class:
core/src/main/java/org/elasticsearch/common/io/stream/BytesStreamOutput.java
core/src/main/java/org/elasticsearch/indices/AbstractIndexShardCacheEntity.java
core/src/main/java/org/elasticsearch/indices/IndicesRequestCache.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/test/java/org/elasticsearch/indices/IndicesRequestCacheTests.java
comments:
Fix the request cache keys to not hold references to the SearchContext. (#21284)

Currently the request cache adds a `CacheEntity` object. It looks quite innocent
but in practice it has a reference to a lambda that knows how to create a value.
The issue is that this lambda has implicit references to the SearchContext
object, which can be quite heavy since it holds a structured representation of
aggregations for instance.

This pull request splits the `CacheEntity` object from the object that generates
cache values.

time:
2016-11-03T00:19:19Z
class:
core/src/main/java/org/elasticsearch/action/ingest/DeletePipelineRequestBuilder.java
core/src/main/java/org/elasticsearch/client/ClusterAdminClient.java
core/src/main/java/org/elasticsearch/client/support/AbstractClient.java
comments:
ClusterAdminClient.prepareDeletePipeline method should accept pipeline id to delete

Currently there is no way to specify the pipeline id when using client().prepareDeletePipeline() method

time:
2016-11-03T00:18:31Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
comments:
add EngineClosed and IndexShardClosed exceptions to assertions on executing bulk shard operation on replica

time:
2016-11-02T23:21:12Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java
core/src/main/java/org/elasticsearch/ingest/IngestMetadata.java
core/src/main/java/org/elasticsearch/script/ScriptMetaData.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
comments:
Stored scripts and ingest node configurations should be included into a snapshot

Stored scripts and ingest node configuration are important parts of the overall cluster state and should be included into a snapshot together with index templates and persistent settings if the includeGlobalState is set to true.

Closes #21184

time:
2016-11-02T19:02:48Z
class:
core/src/test/java/org/elasticsearch/indices/state/CloseIndexDisableCloseAllIT.java
core/src/test/java/org/elasticsearch/operateAllIndices/DestructiveOperationsIT.java
core/src/test/java/org/elasticsearch/operateAllIndices/DestructiveOperationsIntegrationIT.java
comments:
[TEST] Update destructive operations and disable close IT tests (#21274)

These tests had a single method due to the fact that es didn't support resetting settings when they were first written. They can now be rewritten to have separate methods and an after method that resets the setting that is left behind.

time:
2016-11-02T18:18:33Z
class:
comments:
Merge pull request #21267 from eskibars/master

Updates plugin documentation for 5.0

time:
2016-11-02T17:07:26Z
class:
comments:
Remove stale install plugins assertion

When installing a plugin when the plugins directory does not exist, the
install plugin command outputs a line saying that it is creating this
directory. The packaging tests for the archive distributions accounted
for this including an assertion that this line was output. The packages
have since been updated to include an empty plugins folder, so this line
will no longer be output. This commit removes this stale assertion from
the packaging tests.

Relates #21275

time:
2016-11-02T16:38:51Z
class:
modules/lang-painless/src/test/java/org/elasticsearch/painless/ListTests.java
comments:
Make painless's assertion about out of bound less brittle

Instead of asserting that the message is shaped a certain way we
cause the exception and catch it and assert that the messages are
the same. This is the way to go because the exception message from
the jvm is both local and jvm dependent.

This is the CI failure that found this:
https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+5.x+java9-periodic/515/consoleFull

time:
2016-11-02T16:14:47Z
class:
comments:
Fix distribution build ordering issue

Today when running gradle clean
:distribution:(integ-test-zip|tar|zip):assemble, the created archive
distribution will be missing the empty plugins directory. This is
because the empty plugins folder created in the build folder for the
copy spec task is created during configuration and then is later wiped
away by the clean task. This commit addresses this issue, by pushing
creation of the directory out of the configuration phase.

Relates #21271

time:
2016-11-02T16:09:30Z
class:
comments:
Fix `_shrink` test to work under a mixed version cluster (#21262)

today the `_shrink` tests do relocate all shards to a single node in
the cluster. Yet, that is not always possible since the only node we can
safely identify in the cluster is the master and if the master is a BWC
node in such a cluster we won't be able to relocate shards that have a
primary on the newer version nodes since allocation deciders forbid this.

This change restricts allocation for that index when the index is created
to restrict allocation to the master that guarantees that all primaries
are on the same node which is sufficient for the `_shrink` API to run.

time:
2016-11-02T14:45:33Z
class:
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/BoostingQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/ConstantScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/DisMaxQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/FuzzyQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/HasChildQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/HasParentQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/IdsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/IndicesQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryParseContextTests.java
core/src/test/java/org/elasticsearch/index/query/RandomQueryBuilder.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/TemplateQueryBuilderTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
comments:
Tests: Add warning header checks to QueryBuilder tests and QueryParseContextTests

This adds checks for expected warning headers to the query builder test
infrastructure. Tests that are adding deprecation warnings to the response
headers need to check those, otherwise the abstract base class for the test
class will complain at teardown.

time:
2016-11-02T14:45:33Z
class:
core/src/main/java/org/elasticsearch/index/query/FuzzyQueryBuilder.java
comments:
Add deprecation logging message for 'fuzzy' query

This query is deprecated from 5.0 on. Similar to IndicesQueryBuilder we should
log a deprecation warning whenever this query is used.

Relates to #15760

time:
2016-11-02T14:01:21Z
class:
comments:
Fix commit message that got into ingegrations doc

time:
2016-11-02T14:00:16Z
class:
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
[TEST] Check static test state after suite scoped cluster is shut down (#21256)

Checks on static test state are run by an @After method in ESTestCase. Suite-scoped tests in ESIntegTestCase only shut down in an @AfterClass method, which executes after the @After method in ESTestCase. The suite-scoped cluster can thus still execute actions that will violate the checks in @After without those being caught. A subsequent test executing within the same JVM will fail these checks however when @After gets called for that test.

This commit adds an explicit call to check the static test state after the suite-scoped cluster has been shut down.

time:
2016-11-02T13:58:15Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
comments:
Publishing a cluster state should clear the pending states queue (#21259)

The pending cluster state queue is used to hold incoming cluster states from the master. Currently the elected master doesn't publish to itself as thus the queue is not used. Sometimes, depending on the timing of disruptions, a pending cluster state can be put on the queue (but not committed) but another master before being isolated. If this happens concurrently with a master election the elected master can have a pending cluster state in its queue. This is not really a problem but it does confuse our assertions during tests as we check to see everything was processed correctly.

This commit takes a temporary step to clear (and fail) any pending cluster state on the master after it has successfully published a CS. Most notably this will happen when the master publishes the cluster state indicating it has just become the master.

Long term we are working to change the publishing mechanism to make the master use the pending queue just like other nodes, which will make this a non issue.

See https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+5.x+java9-periodic/509 for example.

time:
2016-11-02T13:53:53Z
class:
comments:
Remove extra file

Pushed by mistake....

time:
2016-11-02T13:51:55Z
class:
comments:
Update docs after test-framework moved

Closes #21263

time:
2016-11-02T13:38:50Z
class:
comments:
Drops any plugins that haven't been updated since 2.0.  Updates 5.0 links/verbiage

time:
2016-11-02T13:25:08Z
class:
core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
core/src/main/java/org/apache/lucene/queryparser/classic/QueryParserSettings.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryParser.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/main/java/org/elasticsearch/rest/action/RestActions.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryStringBuilderTests.java
core/src/test/java/org/elasticsearch/search/child/ChildQuerySearchIT.java
core/src/test/java/org/elasticsearch/search/query/SearchQueryIT.java
core/src/test/java/org/elasticsearch/search/query/SimpleQueryStringIT.java
comments:
Remove `lowercase_expanded_terms` and `locale` from query-parser options. (#20208)

Lucene 6.2 introduces the new `Analyzer.normalize` API, which allows to apply
only character-level normalization such as lowercasing or accent folding, which
is exactly what is needed to process queries that operate on partial terms such
as `prefix`, `wildcard` or `fuzzy` queries. As a consequence, the
`lowercase_expanded_terms` option is not necessary anymore. Furthermore, the
`locale` option was only needed in order to know how to perform the lowercasing,
so this one can be removed as well.

Closes #9978

time:
2016-11-02T12:56:53Z
class:
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
comments:
`query_string` can now automatically generate phrase queries.

time:
2016-11-02T12:43:39Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/tasks/PendingClusterTasksResponse.java
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java
core/src/main/java/org/elasticsearch/cluster/block/ClusterBlocks.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodes.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingService.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/IndexMetaDataUpdater.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/discovery/zen/NodeJoinController.java
core/src/test/java/org/elasticsearch/action/support/replication/BroadcastReplicationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationOperationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/cluster/NoMasterNodeIT.java
core/src/test/java/org/elasticsearch/cluster/health/ClusterStateHealthTests.java
core/src/test/java/org/elasticsearch/cluster/node/DiscoveryNodesTests.java
core/src/test/java/org/elasticsearch/cluster/routing/PrimaryAllocationIT.java
core/src/test/java/org/elasticsearch/cluster/routing/UnassignedInfoTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AddIncrementallyTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/NodeVersionAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/RandomAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/StartedShardsRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/serialization/ClusterSerializationTests.java
core/src/test/java/org/elasticsearch/cluster/serialization/ClusterStateToStringTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/discovery/ZenUnicastDiscoveryIT.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeJoinControllerTests.java
core/src/test/java/org/elasticsearch/discovery/zen/PublishClusterStateActionTests.java
core/src/test/java/org/elasticsearch/index/store/CorruptedFileIT.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
core/src/test/java/org/elasticsearch/recovery/FullRollingRestartIT.java
test/framework/src/main/java/org/elasticsearch/cluster/ESAllocationTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java
comments:
Change ClusterState and PendingClusterTasksResponse's toString() to their prettyPrint format (#21245)

The current XContent output is much harder to read than the prettyPrint format. This commit folds prettyPrint into toString and removes it.

time:
2016-11-02T12:38:21Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
comments:
TransportShardBulkAction: add the exception to  the message of an assertion about it's type

time:
2016-11-02T11:24:20Z
class:
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ESClientYamlSuiteTestCase.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/SkipSectionParser.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/SkipSection.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/parser/SkipSectionParserTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/SkipSectionTests.java
comments:
Allow skip test by version OR feature (#21240)

Today these two are considered mutual exclusive but they are not in
practice. For instance a mixed version cluster might not return a
given warning depending on which node we talk to but on the other hand
some runners might not even support warnings at all so the test might be
skipped either by version or by feature.

time:
2016-11-02T09:50:38Z
class:
comments:
Add recommendations about getting consistent scores despite shards and replicas. (#21167)

This is a topic that has triggered many questions recently so it would be good
to have these recommendations documented.

time:
2016-11-02T09:38:25Z
class:
core/src/main/java/org/elasticsearch/action/support/TransportAction.java
comments:
Remove special case in case no action filters are registered (#21251)

Since we have the ingest node type, there is either IngestActionFilter or IngestProxyActionFilter registered, depending on whether the node is an ingest node or not. The special case that shortcuts the execution in case there are no filters is never exercised.

time:
2016-11-02T09:11:14Z
class:
core/src/main/java/org/elasticsearch/common/io/stream/BytesStreamOutput.java
core/src/test/java/org/elasticsearch/common/io/stream/BytesStreamsTests.java
comments:
Protect BytesStreamOutput against overflows of the current number of written bytes. (#21174)

Closes #21159

time:
2016-11-02T09:00:40Z
class:
core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
core/src/main/java/org/apache/lucene/queryparser/classic/QueryParserSettings.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
comments:
Expose splitOnWhitespace in `Query String Query` (#20965)

This change adds an option called `split_on_whitespace` which prevents the query parser to split free text part on whitespace prior to analysis. Instead the queryparser would parse around only real 'operators'. Default to true.
For instance the query `"foo bar"` would let the analyzer of the targeted field decide how the tokens should be splitted.
Some options are missing in this change but I'd like to add them in a follow up PR in order to be able to simplify the backport in 5.x. The missing options (changes) are:
* A `type` option which similarly to the `multi_match` query defines how the free text should be parsed when multi fields are defined.
* Simple range query with additional tokens like ">100 50" are broken when `split_on_whitespace` is set to false. It should be possible to preserve this syntax and make the parser aware of this special syntax even when `split_on_whitespace` is set to false.
* Since all this options would make the `query_string_query` very similar to a match (multi_match) query we should be able to share the code that produce the final Lucene query.

time:
2016-11-02T08:48:49Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesService.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/test/java/org/elasticsearch/index/mapper/CustomBoostMappingTests.java
core/src/test/java/org/elasticsearch/index/mapper/DoubleIndexingDocTests.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/FieldNamesFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/query/plugin/CustomQueryParserIT.java
core/src/test/java/org/elasticsearch/index/search/MultiMatchQueryTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorFieldMapperTests.java
plugins/mapper-murmur3/src/test/java/org/elasticsearch/index/mapper/murmur3/Murmur3FieldMapperTests.java
test/framework/src/main/java/org/elasticsearch/test/TestSearchContext.java
comments:
Require arguments for QueryShardContext creation. (#21196)

The `IndexService#newQueryShardContext()` method creates a QueryShardContext on
shard `0`, with a `null` reader and that uses `System.currentTimeMillis()` to
resolve `now`. This may hide bugs, since the shard id is sometimes used for
query parsing (it is used to salt random score generation in `function_score`),
passing a `null` reader disables query rewriting and for some use-cases, it is
simply not ok to rely on the current timestamp (eg. percolation). So this pull
request removes this method and instead requires that all call sites provide
these parameters explicitly.

time:
2016-11-02T08:38:59Z
class:
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
[TEST] add back AwaitsFix until we get a new Lucene 6.3.0 snapshot

time:
2016-11-02T08:38:51Z
class:
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
test/framework/src/main/java/org/elasticsearch/test/OldIndexUtils.java
comments:
[TEST] fix extrasFS file filtering in OldIndexUtils

time:
2016-11-02T08:38:44Z
class:
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
test/framework/src/main/java/org/elasticsearch/test/OldIndexUtils.java
comments:
Fix InternalEngineTests#testUpgradeOldIndex for 5.0.0 BWC indices

Relates to #21147

time:
2016-11-02T08:32:15Z
class:
client/rest/src/main/java/org/elasticsearch/client/RestClient.java
client/rest/src/test/java/org/elasticsearch/client/RestClientIntegTests.java
comments:
Provide error message when request path is null

time:
2016-11-02T01:29:37Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/Decision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/EnableAllocationDecider.java
core/src/test/java/org/elasticsearch/action/support/replication/ClusterStateCreationUtils.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/BalancedSingleShardTests.java
comments:
Balance step in BalancedShardsAllocator for a single shard (#21103)

This commit introduces a single-shard balance step for deciding on
rebalancing a single shard (without taking any other shards in the
cluster into account).  This method will be used by the cluster
allocation explain API to explain in detail the decision process for
finding a more optimal location for a started shard, if one exists.

time:
2016-11-01T22:10:16Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationOperation.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/main/java/org/elasticsearch/index/IndexingSlowLog.java
core/src/main/java/org/elasticsearch/index/engine/DeleteFailedEngineException.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/IndexFailedEngineException.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/ShadowEngine.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/IndexingOperationListener.java
core/src/main/java/org/elasticsearch/index/shard/InternalIndexingStats.java
core/src/main/java/org/elasticsearch/index/shard/TranslogRecoveryPerformer.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/indices/IndexingMemoryController.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/engine/ShadowEngineTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexingOperationListenerTests.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
core/src/test/java/org/elasticsearch/indices/stats/IndexStatsIT.java
comments:
Merge pull request #19105 from areek/enhancement/replicate_primary_write_failures

Simplify write failure handling

time:
2016-11-01T21:52:09Z
class:
comments:
Add extra note about Java8 requirement to sub-install docs (#21190)

Closes #20005

time:
2016-11-01T20:27:46Z
class:
comments:
Fix get-bwc-version for 5.0.0 (#21249)

5.0.0 is at artifacts.elastic.co.

time:
2016-11-01T20:21:43Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/index/engine/DeleteFailedEngineException.java
core/src/main/java/org/elasticsearch/index/engine/IndexFailedEngineException.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
comments:
add back index and delete engine failure exceptions as deprecated for bwc with 5.x

time:
2016-11-01T20:14:20Z
class:
comments:
Add docs with up to date instructions on updating default similarity (#21242)

* Add docs with up to date instructions on updating default similarity

The default similarity can no longer be set in the configuration file
(you will get an error on startup). Update the docs with the method
that works.

* Add instructions for changing similarity on index creation

time:
2016-11-01T19:55:09Z
class:
comments:
Documentation updates for scroll API size parameter (#21229)

* Document size parameter for scroll API

* Fix size parameter behavior description for scroll

time:
2016-11-01T19:31:28Z
class:
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/shard/IndexingOperationListener.java
comments:
documentation and minor fixes for engine level index/delete operations

time:
2016-11-01T19:14:24Z
class:
comments:
Add empty plugins dir for archive distributions

Today when installing Elasticsearch from an archive distribution (tar.gz
or zip), an empty plugins folder is not included. This means that if you
install Elasticsearch and immediately run elasticsearch-plugin list, you
will receive an error message about the plugins directory missing. While
the plugins directory would be created when starting Elasticsearch for
the first time, it would be better to just include an empty plugins
directory in the archive distributions. This commit makes this the
case. Note that the package distributions already include an empty
plugins folder.

Relates #21204

time:
2016-11-01T18:15:56Z
class:
core/src/main/java/org/elasticsearch/action/get/GetRequest.java
comments:
Disallow VersionType.FORCE for GetRequest (#21079)

This doesn't make much sense to have at all, since a user can do a `GET`
request without a version of they want to get it unconditionally.

Relates to #20995

time:
2016-11-01T18:09:00Z
class:
core/src/main/java/org/elasticsearch/Version.java
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/action/ExplainRequestTests.java
core/src/test/java/org/elasticsearch/action/ShardValidateQueryRequestTests.java
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/bwcompat/RepositoryUpgradabilityIT.java
core/src/test/java/org/elasticsearch/common/util/IndexFolderUpgraderTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/search/internal/ShardSearchTransportRequestTests.java
test/framework/src/main/java/org/elasticsearch/test/OldIndexUtils.java
comments:
Add version for 5.0.0

This commit adds the version constant for 5.0.0.

Relates #21244

time:
2016-11-01T17:37:50Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/XContentGenerator.java
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContentGenerator.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/rest/action/RestBuilderListener.java
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/script/ScriptModes.java
core/src/main/java/org/elasticsearch/script/ScriptSettings.java
core/src/main/java/org/elasticsearch/script/ScriptType.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/rest/action/RestBuilderListenerTests.java
core/src/test/java/org/elasticsearch/script/NativeScriptTests.java
core/src/test/java/org/elasticsearch/script/ScriptModesTests.java
core/src/test/java/org/elasticsearch/script/ScriptServiceTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/SearchTemplateRequest.java
modules/transport-netty3/src/main/java/org/elasticsearch/transport/netty3/Netty3Utils.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Utils.java
plugins/analysis-ukrainian/src/main/java/org/elasticsearch/index/analysis/UkrainianAnalyzerProvider.java
plugins/analysis-ukrainian/src/main/java/org/elasticsearch/plugin/analysis/ukrainian/AnalysisUkrainianPlugin.java
plugins/analysis-ukrainian/src/test/java/org/elasticsearch/index/analysis/SimpleUkrainianAnalyzerTests.java
plugins/analysis-ukrainian/src/test/java/org/elasticsearch/index/analysis/UkrainianAnalysisTests.java
plugins/analysis-ukrainian/src/test/java/org/elasticsearch/index/analysis/UkrainianClientYamlTestSuiteIT.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
comments:
Merge branch 'master' into enhancement/replicate_primary_write_failures

time:
2016-11-01T17:19:28Z
class:
client/rest/src/main/java/org/elasticsearch/client/HeapBufferedAsyncResponseConsumer.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
comments:
Bump reindex-from-remote's buffer to 200mb

It was 10mb and that was causing trouble when folks reindex-from-remoted
with large documents.

We also improve the error reporting so it tells folks to use a smaller
batch size if they hit a buffer size exception. Finally, adds some docs
to reindex-from-remote mentioning the buffer and giving an example of
lowering the size.

Closes #21185

time:
2016-11-01T14:15:12Z
class:
comments:
Fix typo in keyword.asciidoc (#21237)

time:
2016-11-01T13:08:18Z
class:
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
comments:
Fix a racing condition in MockTransportService#addUnresponsiveRule where a request can be delayed even if the rule was removed.

Relates to #21129

Also properly reset DiscoveryWithServiceDisruptionsIT#disableBeforeIndexDeletion

time:
2016-11-01T13:02:05Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/XContentGenerator.java
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContentGenerator.java
core/src/main/java/org/elasticsearch/rest/action/RestBuilderListener.java
core/src/test/java/org/elasticsearch/rest/action/RestBuilderListenerTests.java
comments:
ensure the XContentBuilder is always closed in RestBuilderListener

There may be cases where the XContentBuilder is not used and therefore it never gets
closed, which can cause a leak of bytes. This change moves the creation of the builder
into a try with resources block and adds an assertion to verify that we always consume
the bytes in our code; the try-with resources provides protections against memory leaks
caused by plugins, which do not test this.

time:
2016-11-01T11:54:20Z
class:
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
comments:
ESIntegTestCase.jav: use ClusterState.prettyPrint for pending ClusterState assertions

time:
2016-11-01T03:50:09Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/shard/IndexingOperationListener.java
core/src/main/java/org/elasticsearch/indices/IndexingMemoryController.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
comments:
incorporate feedback

time:
2016-11-01T00:48:55Z
class:
comments:
Fix transport host setting

This commit fixes a reference to the transport.host setting which was
mistakenly identified as transport.tcp.host.

time:
2016-10-31T21:33:15Z
class:
comments:
Fix markup for bootstrap checks docs

This commit adds a missing backtick to the bootstrap check docs.

time:
2016-10-31T21:23:21Z
class:
modules/transport-netty3/src/main/java/org/elasticsearch/transport/netty3/Netty3Utils.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Utils.java
comments:
Fix logger names for Netty

Previously Elasticsearch would only use the package name for logging
levels, truncating the package prefix and the class name. This meant
that logger names for Netty were just prefixed by netty3 and netty. We
changed this for Elasticsearch so that it's the fully-qualified class
name now, but never corrected this for Netty. This commit fixes the
logger names for the Netty modules so that their levels are controlled
by the fully-qualified class name.

Relates #21223

time:
2016-10-31T20:48:51Z
class:
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/script/ScriptModes.java
core/src/main/java/org/elasticsearch/script/ScriptSettings.java
core/src/main/java/org/elasticsearch/script/ScriptType.java
core/src/test/java/org/elasticsearch/script/NativeScriptTests.java
core/src/test/java/org/elasticsearch/script/ScriptModesTests.java
core/src/test/java/org/elasticsearch/script/ScriptServiceTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/SearchTemplateRequest.java
comments:
Cleanup ScriptType (#21179)

Refactored ScriptType to clean up some of the variable and method names. Added more documentation. Deprecated the 'in' ParseField in favor of 'stored' to match the indexed scripts being replaced by stored scripts.

time:
2016-10-31T20:38:33Z
class:
comments:
Add analysis-ukrainian plugin to packaging tests

This commit adds the analysis-ukrainian plugin to the packaging tests.

Relates #21219

time:
2016-10-31T20:34:21Z
class:
comments:
Clarify production mode for bootstrap checks

This commit clarifies that production mode for the bootstrap checks is
only tripped if transport is bound to an external interface.

Relates #21220

time:
2016-10-31T19:04:33Z
class:
core/src/main/java/org/elasticsearch/index/IndexService.java
comments:
IndexService#maybeRefresh should catch `IndexShardClosedException` (#21205)

We throw this exception in some cases that the shard is closed, so we have to be consistent here. Otherwise we get logs like:

```
 1> [2016-10-30T21:06:22,529][WARN ][o.e.i.IndexService       ] [node_s_0] [test] failed to run task refresh - suppressing re-occurring exceptions unless the exception changes
 1> org.elasticsearch.index.shard.IndexShardClosedException: CurrentState[CLOSED] operation only allowed when not closed
 1> 	at org.elasticsearch.index.shard.IndexShard.verifyNotClosed(IndexShard.java:1147) ~[main/:?]
 1> 	at org.elasticsearch.index.shard.IndexShard.verifyNotClosed(IndexShard.java:1141) ~[main/:?]
```

time:
2016-10-31T17:20:39Z
class:
comments:
Docs: Adding Ukrainian analyzer

time:
2016-10-31T17:20:39Z
class:
plugins/analysis-ukrainian/src/main/java/org/elasticsearch/index/analysis/UkrainianAnalyzerProvider.java
plugins/analysis-ukrainian/src/main/java/org/elasticsearch/plugin/analysis/ukrainian/AnalysisUkrainianPlugin.java
plugins/analysis-ukrainian/src/test/java/org/elasticsearch/index/analysis/SimpleUkrainianAnalyzerTests.java
plugins/analysis-ukrainian/src/test/java/org/elasticsearch/index/analysis/UkrainianAnalysisTests.java
plugins/analysis-ukrainian/src/test/java/org/elasticsearch/index/analysis/UkrainianClientYamlTestSuiteIT.java
comments:
Expose Lucenes Ukrainian analyzer

Since Lucene 6.2. the UkrainianMorfologikAnalyzer is available through the
lucene-analyzers-morfologik jar. This change exposes it to be used as an
elasticsearch plugin.

time:
2016-10-31T17:06:21Z
class:
client/rest/src/test/java/org/elasticsearch/client/RequestLoggerTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientMultipleHostsTests.java
client/sniffer/src/test/java/org/elasticsearch/client/sniff/ElasticsearchHostsSnifferTests.java
client/sniffer/src/test/java/org/elasticsearch/client/sniff/SnifferBuilderTests.java
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/TransportClusterAllocationExplainAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverAction.java
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchRequest.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollRequest.java
core/src/main/java/org/elasticsearch/action/search/SearchTask.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/cluster/NodeConnectionsService.java
core/src/main/java/org/elasticsearch/cluster/SnapshotsInProgress.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodes.java
core/src/main/java/org/elasticsearch/cluster/routing/UnassignedInfo.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/ShardAllocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/Decision.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/common/network/NetworkModule.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/common/xcontent/support/XContentMapValues.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/env/NodeEnvironment.java
core/src/main/java/org/elasticsearch/gateway/ReplicaShardAllocator.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/engine/DeleteVersionValue.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/VersionValue.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryParser.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/main/java/org/elasticsearch/index/snapshots/IndexShardSnapshotStatus.java
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/main/java/org/elasticsearch/ingest/InternalTemplateService.java
core/src/main/java/org/elasticsearch/monitor/os/OsProbe.java
core/src/main/java/org/elasticsearch/monitor/os/OsStats.java
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
core/src/main/java/org/elasticsearch/rest/action/RestMainAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestGetAction.java
core/src/main/java/org/elasticsearch/script/CompiledScript.java
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/script/ScriptContextRegistry.java
core/src/main/java/org/elasticsearch/script/ScriptModes.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/main/java/org/elasticsearch/script/ScriptSettings.java
core/src/main/java/org/elasticsearch/script/ScriptType.java
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/ip/IpRangeParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/InternalSignificantTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/SignificanceHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregator.java
core/src/main/java/org/elasticsearch/search/dfs/DfsPhase.java
core/src/main/java/org/elasticsearch/search/dfs/DfsPhaseExecutionException.java
core/src/main/java/org/elasticsearch/search/fetch/FetchPhase.java
core/src/main/java/org/elasticsearch/search/fetch/FetchPhaseExecutionException.java
core/src/main/java/org/elasticsearch/search/fetch/ShardFetchRequest.java
core/src/main/java/org/elasticsearch/search/internal/FilteredSearchContext.java
core/src/main/java/org/elasticsearch/search/internal/InternalScrollSearchRequest.java
core/src/main/java/org/elasticsearch/search/internal/SearchContext.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchTransportRequest.java
core/src/main/java/org/elasticsearch/search/profile/query/CollectorResult.java
core/src/main/java/org/elasticsearch/search/query/CancellableCollector.java
core/src/main/java/org/elasticsearch/search/query/QueryPhase.java
core/src/main/java/org/elasticsearch/search/query/QuerySearchRequest.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGeneratorBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionBuilder.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotShardsService.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java
core/src/main/java/org/elasticsearch/tasks/TaskCancelledException.java
core/src/main/java/org/elasticsearch/tasks/TaskManager.java
core/src/main/java/org/elasticsearch/transport/TaskAwareTransportRequestHandler.java
core/src/main/java/org/elasticsearch/transport/TransportInterceptor.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainIT.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStatsTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/CancellableTasksTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/rollover/RolloverIT.java
core/src/test/java/org/elasticsearch/action/bulk/BulkWithUpdatesIT.java
core/src/test/java/org/elasticsearch/action/ingest/IngestProxyActionFilterTests.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
core/src/test/java/org/elasticsearch/action/search/SearchScrollRequestTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/client/transport/FailAndRetryMockTransport.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientHeadersTests.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/NoMasterNodeIT.java
core/src/test/java/org/elasticsearch/cluster/NodeConnectionsServiceTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/MoveDecisionTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/ShardAllocationDecisionTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/DecisionTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
core/src/test/java/org/elasticsearch/common/geo/builders/AbstractShapeBuilderTestCase.java
core/src/test/java/org/elasticsearch/common/geo/builders/CircleBuilderTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java
core/src/test/java/org/elasticsearch/index/WaitUntilRefreshIT.java
core/src/test/java/org/elasticsearch/index/query/InnerHitBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryDSLDocumentationTests.java
core/src/test/java/org/elasticsearch/index/query/RandomQueryBuilder.java
core/src/test/java/org/elasticsearch/index/query/ScriptQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryParserTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryStringBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/snapshots/blobstore/SlicedInputStreamTests.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
core/src/test/java/org/elasticsearch/monitor/os/OsProbeTests.java
core/src/test/java/org/elasticsearch/monitor/os/OsStatsTests.java
core/src/test/java/org/elasticsearch/rest/action/RestMainActionTests.java
core/src/test/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeActionTests.java
core/src/test/java/org/elasticsearch/script/FileScriptTests.java
core/src/test/java/org/elasticsearch/script/IndexLookupIT.java
core/src/test/java/org/elasticsearch/script/NativeScriptTests.java
core/src/test/java/org/elasticsearch/script/ScriptContextTests.java
core/src/test/java/org/elasticsearch/script/ScriptFieldIT.java
core/src/test/java/org/elasticsearch/script/ScriptModesTests.java
core/src/test/java/org/elasticsearch/script/ScriptServiceTests.java
core/src/test/java/org/elasticsearch/script/ScriptTests.java
core/src/test/java/org/elasticsearch/search/SearchCancellationIT.java
core/src/test/java/org/elasticsearch/search/SearchCancellationTests.java
core/src/test/java/org/elasticsearch/search/SearchRequestTests.java
core/src/test/java/org/elasticsearch/search/SearchServiceTests.java
core/src/test/java/org/elasticsearch/search/SearchTimeoutIT.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregationTestScriptsPlugin.java
core/src/test/java/org/elasticsearch/search/aggregations/BaseAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/BasePipelineAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/EquivalenceIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateRangeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DoubleTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/HistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/IpRangeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/LongTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/MinDocCountIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/RangeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsSignificanceScoreIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/StringTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/AvgIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/CardinalityIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ExtendedStatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MaxIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MinIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ScriptedMetricIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ScriptedMetricTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/StatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/SumIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ValueCountIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketScriptIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketScriptTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketSelectorIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketSelectorTests.java
core/src/test/java/org/elasticsearch/search/basic/TransportTwoNodesSearchIT.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
core/src/test/java/org/elasticsearch/search/child/ChildQuerySearchIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/InnerHitsIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilderTests.java
core/src/test/java/org/elasticsearch/search/fields/SearchFieldsIT.java
core/src/test/java/org/elasticsearch/search/functionscore/ExplainableScriptIT.java
core/src/test/java/org/elasticsearch/search/functionscore/FunctionScoreIT.java
core/src/test/java/org/elasticsearch/search/functionscore/RandomScoreFunctionIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoDistanceIT.java
core/src/test/java/org/elasticsearch/search/query/QueryPhaseTests.java
core/src/test/java/org/elasticsearch/search/rescore/QueryRescoreBuilderTests.java
core/src/test/java/org/elasticsearch/search/scriptfilter/ScriptQuerySearchIT.java
core/src/test/java/org/elasticsearch/search/searchafter/SearchAfterBuilderTests.java
core/src/test/java/org/elasticsearch/search/slice/SliceBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
core/src/test/java/org/elasticsearch/search/sort/ScriptSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/SimpleSortIT.java
core/src/test/java/org/elasticsearch/search/stats/SearchStatsIT.java
core/src/test/java/org/elasticsearch/search/suggest/AbstractSuggestionBuilderTestCase.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestBuilderTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/FuzzyOptionsTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/RegexOptionsTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/WritableTestCase.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGeneratorTests.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/SmoothingModelTestCase.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/test/geo/RandomShapeGenerator.java
core/src/test/java/org/elasticsearch/update/TimestampTTLBWIT.java
core/src/test/java/org/elasticsearch/update/UpdateByNativeScriptIT.java
core/src/test/java/org/elasticsearch/update/UpdateIT.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ScriptProcessor.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/ExpressionTests.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/IndexedExpressionTests.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/MoreExpressionTests.java
modules/lang-groovy/src/test/java/org/elasticsearch/script/groovy/GroovyIndexedScriptTests.java
modules/lang-groovy/src/test/java/org/elasticsearch/script/groovy/GroovyScriptTests.java
modules/lang-groovy/src/test/java/org/elasticsearch/script/groovy/GroovySecurityTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestRenderSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/SearchTemplateRequest.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/SearchTemplateRequestBuilder.java
comments:
Merge branch 'master' into enhancement/replicate_primary_write_failures

time:
2016-10-31T15:21:07Z
class:
plugins/repository-azure/src/test/java/org/elasticsearch/cloud/azure/storage/AzureStorageServiceMock.java
comments:
[TEST] Fix NullPointerException in AzureStorageServiceMock

Makes the code safe against concurrent modifications of the underlying hashmap.

time:
2016-10-31T15:15:36Z
class:
comments:
[DOCS] Document all date formats (#21164)

Resolves #21046

time:
2016-10-31T15:13:46Z
class:
comments:
Fix malformed JSON in Delete API example (#21168)

Obviously, there should be

    "result": "deleted"

instead of

    "result: deleted"

time:
2016-10-31T14:27:22Z
class:
comments:
Add a flag to use minimim_master_nodes on the integ test cluster (#21173)

Setting `discovery.initial_state_timeout: 0s` to make `discovery.zen.minimum_master_nodes: N`
work reliably can cause issues in clusters that rely on state recovery once the cluster is available.
This change makes the use or `discovery.zen.minimum_master_nodes` optional for clusters where this behavior is desirable.

time:
2016-10-31T14:10:37Z
class:
comments:
Make explicit missing settings for Windows service

When installing the Windows service, certain settings like the minimum
heap, maximum heap and thread stack size setting must be set. While
there is an error message making mention of this fact, the error message
is not explicit exactly what setting needs to be set. This commit makes
these settings explicit.

Relates #21200

time:
2016-10-31T14:09:43Z
class:
core/src/main/java/org/elasticsearch/cluster/NodeConnectionsService.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/test/java/org/elasticsearch/cluster/NodeConnectionsServiceTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
test/framework/src/main/java/org/elasticsearch/test/ClusterServiceUtils.java
comments:
Disconnect from newly added nodes if cluster state publishing fails (#21197)

Before publishing a cluster state the master connects to the nodes that are added in the cluster state. When publishing fails, however, it does not disconnect from these nodes, leaving NodeConnectionsService out of sync with the currently applied cluster state.

time:
2016-10-31T13:04:18Z
class:
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
comments:
[TEST] Use assertBusy to check assertMaster property in presence of a low publish timeout

The assertion assertMaster checks if all nodes have each other in the cluster state and the correct master set.
It is usually called after a disruption has been healed and ensureStableCluster been called. In presence of a low
publish timeout of 1s in this test class, publishing might not be fully done even after ensureStableCluster returns.
This commit adds an assertBusy to assertMaster so that the node has a bit more time to apply the cluster state from
the master, even if it's a bit slow.

time:
2016-10-31T12:43:55Z
class:
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/index/engine/DeleteVersionValue.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/VersionValue.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
comments:
Retrying replication requests on replica doesn't call `onRetry` (#21189)

Replication request may arrive at a replica before the replica's node has processed a required mapping update. In these cases the TransportReplicationAction will retry the request once a new cluster state arrives. Sadly that retry logic failed to call `ReplicationRequest#onRetry`, causing duplicates in the append only use case.

This commit fixes this and also the test which missed the check. I also added an assertion which would have helped finding the source of the duplicates.

This was discovered by https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=opensuse/174/

Relates #20211

time:
2016-10-30T04:09:09Z
class:
comments:
Add note to getting-started doc about CONSOLE

Link to the documentation for CONSOLE in getting-started so the
layout of the snippet makes some sense.

Relates to #21158

time:
2016-10-30T02:21:57Z
class:
modules/lang-painless/src/test/java/org/elasticsearch/painless/ArrayLikeObjectTestCase.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ArrayTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ListTests.java
comments:
Fix painless's out of bounds assertions in java 9

Java 9's exception message when lists have an out of bounds index
is much better than java 8 but the painless code asserted on the
java 8 message. Now it'll accept either.

I'm tempted to weaken the assertion but I like asserting that the
message is readable.

time:
2016-10-29T20:12:40Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/Def.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/DefBootstrap.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/MethodWriter.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/WriterConstants.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/AStoreable.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PSubBrace.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PSubDefArray.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PSubListShortcut.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ArrayLikeObjectTestCase.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ArrayTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ListTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/MapTests.java
comments:
Support negative array ofsets in painless

Adds support for indexing into lists and arrays with negative
indexes meaning "counting from the back". So for if
`x = ["cat", "dog", "chicken"]` then `x[-1] == "chicken"`.

This adds an extra branch to every array and list access but
some performance testing makes it look like the branch predictor
successfully predicts the branch every time so there isn't a
in execution time for this feature when the index is positive.
When the index is negative performance testing showed the runtime
is the same as writing `x[x.length - 1]`, again, presumably thanks
to the branch predictor.

Those performance metrics were calculated for lists and arrays but
`def`s get roughly the same treatment though instead of inlining
the test they need to make a invoke dynamic so we don't screw up
maps.

Closes #20870

time:
2016-10-28T21:29:49Z
class:
core/src/test/java/org/elasticsearch/search/SearchCancellationIT.java
comments:
Tests: Add addtional logging to SearchCancellationIT tests

time:
2016-10-28T21:02:24Z
class:
comments:
Rewrite vagrant upgrade test's dependency resolution

This is cleaner and it doesn't fail in Jenkins. I'm not sure
why the old way failed in jenkins but not locally, but computers
are basically magic so I take what I can get. Here is a jenkins
failure:
https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+packaging-tests/238/consoleFull

time:
2016-10-28T18:22:24Z
class:
core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java
comments:
IndexWithShadowReplicasIT.testReplicaToPrimaryPromotion should wait for node leave to be processed

time:
2016-10-28T18:00:43Z
class:
comments:
Fix the package upgrade tests for 5.0.0 (#21178)

5.0+'s deb and rpm packages aren't pushed to maven cnertral so
instead we have to download them from artifacts.elastic.org.

time:
2016-10-28T16:46:54Z
class:
comments:
Update resiliency page for the release of v5 (#21177)

time:
2016-10-28T14:45:36Z
class:
comments:
Fix generation of versions to upgrade from

Vagrant tests use a static list of dependencies to upgrade from
and we weren't including 5.0.0 deps in that list. Also when the
list was incorrect we weren't sorting the "current" list so it
was difficult to read.

Also adds 2.4.1 to the list but *doesn't* add 5.0.0 because we
still can't resolve it yet. We still only print an error when
the list is wrong but don't abort the build. We'll abort the build
once we've fixed resolution for 5.0.0 and we can re-add it.

time:
2016-10-28T14:22:53Z
class:
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java
comments:
Fallback to '/' info call to fetch cluster version

The `_cat/nodes` API might not be available in all clusters for instance
if they have authorization enabled. This change falls back to the previously
used method of using the '/' endpoint to fetch the nodes version, this is best
effort and will emit a warning.

time:
2016-10-28T14:04:33Z
class:
comments:
Fix `_cat/store` sort test to use a reliable sort value

using the store size is not reliable since it's cached and might
be stale depending on the timing when the cache entry was generated.

time:
2016-10-28T13:47:47Z
class:
comments:
Disable out of date versions exception

We are upgrading from out of date versions in our tests right now and we
can't fix that because the current versions to upgrade from aren't in
maven central. We'll resolve the resolution issue soon, but for now
let's get the build green.

time:
2016-10-28T13:40:04Z
class:
comments:
Revert "Updates vagrant tests upgrade version number" (#21171)

time:
2016-10-28T13:22:02Z
class:
comments:
[TEST] Only set 0s state timeout if we have more than one node

time:
2016-10-28T12:50:46Z
class:
comments:
Fix Lucene version in the docs.

time:
2016-10-28T12:47:15Z
class:
client/rest/src/test/java/org/elasticsearch/client/RequestLoggerTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientMultipleHostsTests.java
client/sniffer/src/test/java/org/elasticsearch/client/sniff/ElasticsearchHostsSnifferTests.java
client/sniffer/src/test/java/org/elasticsearch/client/sniff/SnifferBuilderTests.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/common/xcontent/support/XContentMapValues.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/CancellableTasksTests.java
core/src/test/java/org/elasticsearch/client/transport/FailAndRetryMockTransport.java
core/src/test/java/org/elasticsearch/index/query/RandomQueryBuilder.java
core/src/test/java/org/elasticsearch/index/snapshots/blobstore/SlicedInputStreamTests.java
core/src/test/java/org/elasticsearch/test/geo/RandomShapeGenerator.java
test/framework/src/main/java/org/elasticsearch/ingest/RandomDocumentPicks.java
test/framework/src/main/java/org/elasticsearch/test/BackgroundIndexer.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
comments:
Upgrade to lucene-6.3.0-snapshot-ed102d6 (#21150)

Lucene 6.3 is expected to be released in the next weeks so it'd be good to give
it some integration testing. I had to upgrade randomized-testing too so that
both Lucene and Elasticsearch are on the same version.

time:
2016-10-28T10:18:47Z
class:
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java
comments:
Use all available hosts in REST tests and allow for real master election (#21161)

Today we only use a single node to send requests to when we run REST tests.
In some cases we have more than one node (ie. in the BWC case) where we should
send requests to all nodes in a round-robin fashion. This change passes all
available node endpoints to the rest test.

Additionally, this change adds the setting of `discovery.zen.minimum_master_nodes`
to the cluster formation forcing the nodes to wait for all other nodes until the cluster
is formed. This allows for a more realistic master election and allows all master eligable
nodes to become master while before always the first node in the cluster became the master.

This also adds logging to each test run to log the master nodes version and the minimum node
version in the cluster to help debugging BWC test failures.

time:
2016-10-28T07:11:57Z
class:
core/src/main/java/org/elasticsearch/index/query/SimpleQueryParser.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryParserTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryStringBuilderTests.java
comments:
Add support for `quote_field_suffix` to `simple_query_string`. (#21060)

Closes #18641

time:
2016-10-27T20:44:04Z
class:
comments:
Updates the versions the vagrant tests can upgrade from to 5.0.0 (#21151)

time:
2016-10-27T20:38:15Z
class:
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
Rethrow original exception when it fails the engine during write operations

time:
2016-10-27T15:03:53Z
class:
core/src/main/java/org/elasticsearch/monitor/os/OsStats.java
core/src/test/java/org/elasticsearch/VersionTests.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/ClientYamlTestSectionParser.java
comments:
Fix bwc cluster formation in order to run BWC tests against a mixed version cluster (#21145)

This fixes our cluster formation task to run REST tests against a mixed version cluster.
Yet, due to some limitations in our test framework `indices.rollover` tests are currently
disabled for the BWC case since they select the current master as the merge node which
happens to be a BWC node and we can't relocate all shards to it since the primaries are on
a higher version node. This will be fixed in a followup.

Closes #21142

Note: This has been cherry-picked from 5.0 and fixes several rest tests
as well as a BWC break in `OsStats.java`

time:
2016-10-27T12:56:48Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/InternalSignificantTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/SignificanceHeuristic.java
comments:
Aggregations fix: scripted heuristics for scoring significant_terms aggs were not thread safe when running local to the coordinating node. New code spawns an object for each shard search execution rather than sharing a common instance which is not thread safe.
Closes #18120

time:
2016-10-27T11:48:17Z
class:
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
test/framework/src/main/java/org/elasticsearch/test/disruption/NetworkDisruption.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
comments:
Stop delaying existing requests after network delay rule is cleared (#21129)

The network disruption type "network delay" continues delaying existing requests even after the disruption has been cleared. This commit ensures that the requests get to execute right after the delay rule is cleared.

time:
2016-10-27T10:02:00Z
class:
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainIT.java
comments:
[TEST] Fix testDelayShards to wait for master to remove stopped node

This test failed when the node that was shutting down was not yet removed from the cluster state on the master.
The cluster allocation explain API will not see any unassigned shards until the node shutting down is removed from the
cluster state.

time:
2016-10-27T09:00:44Z
class:
core/src/test/java/org/elasticsearch/action/admin/indices/rollover/RolloverIT.java
comments:
[TEST] Fix testRolloverConditionsNotMet to expect correct rollover index name

PR #21138 changed the target index name even if _rollover conditions are not met but missed to adapt this test.

time:
2016-10-27T08:43:18Z
class:
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeAction.java
core/src/test/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeActionTests.java
comments:
Merge pull request #20704 from johtani/remove_request_params_in_analyze_api

Removing request parameters in _analyze API

time:
2016-10-27T08:33:21Z
class:
comments:
Correct similarity default for 5.0 (#21144)

time:
2016-10-27T07:20:46Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverAction.java
comments:
Return target index name even if _rollover conditions are not met (#21138)

Today we return the old index name as the target / new index name.
This change passes the correct rollover index name to the response.

time:
2016-10-27T04:26:01Z
class:
core/src/main/java/org/elasticsearch/index/IndexingSlowLog.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/InternalIndexingStats.java
core/src/main/java/org/elasticsearch/indices/IndexingMemoryController.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexingOperationListenerTests.java
comments:
cleanup operation listener handling of failure in results

time:
2016-10-27T04:26:01Z
class:
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
comments:
add tests

time:
2016-10-27T04:25:55Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/OperationFailedEngineException.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/indices/IndexingMemoryController.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexingOperationListenerTests.java
comments:
Incorporate feedback

time:
2016-10-26T19:45:50Z
class:
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/ingest/InternalTemplateService.java
core/src/main/java/org/elasticsearch/script/CompiledScript.java
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/script/ScriptContextRegistry.java
core/src/main/java/org/elasticsearch/script/ScriptModes.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/main/java/org/elasticsearch/script/ScriptSettings.java
core/src/main/java/org/elasticsearch/script/ScriptType.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionBuilder.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/action/bulk/BulkWithUpdatesIT.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/cluster/NoMasterNodeIT.java
core/src/test/java/org/elasticsearch/index/WaitUntilRefreshIT.java
core/src/test/java/org/elasticsearch/index/query/InnerHitBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryDSLDocumentationTests.java
core/src/test/java/org/elasticsearch/index/query/ScriptQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/script/FileScriptTests.java
core/src/test/java/org/elasticsearch/script/IndexLookupIT.java
core/src/test/java/org/elasticsearch/script/NativeScriptTests.java
core/src/test/java/org/elasticsearch/script/ScriptContextTests.java
core/src/test/java/org/elasticsearch/script/ScriptFieldIT.java
core/src/test/java/org/elasticsearch/script/ScriptModesTests.java
core/src/test/java/org/elasticsearch/script/ScriptServiceTests.java
core/src/test/java/org/elasticsearch/script/ScriptTests.java
core/src/test/java/org/elasticsearch/search/SearchCancellationIT.java
core/src/test/java/org/elasticsearch/search/SearchTimeoutIT.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregationTestScriptsPlugin.java
core/src/test/java/org/elasticsearch/search/aggregations/EquivalenceIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateRangeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DoubleTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/HistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/IpRangeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/LongTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/MinDocCountIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/RangeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsSignificanceScoreIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/StringTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/AvgIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/CardinalityIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ExtendedStatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MaxIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MinIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ScriptedMetricIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ScriptedMetricTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/StatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/SumIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ValueCountIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketScriptIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketScriptTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketSelectorIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketSelectorTests.java
core/src/test/java/org/elasticsearch/search/basic/TransportTwoNodesSearchIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/InnerHitsIT.java
core/src/test/java/org/elasticsearch/search/fields/SearchFieldsIT.java
core/src/test/java/org/elasticsearch/search/functionscore/ExplainableScriptIT.java
core/src/test/java/org/elasticsearch/search/functionscore/FunctionScoreIT.java
core/src/test/java/org/elasticsearch/search/functionscore/RandomScoreFunctionIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoDistanceIT.java
core/src/test/java/org/elasticsearch/search/scriptfilter/ScriptQuerySearchIT.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
core/src/test/java/org/elasticsearch/search/sort/ScriptSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/SimpleSortIT.java
core/src/test/java/org/elasticsearch/search/stats/SearchStatsIT.java
core/src/test/java/org/elasticsearch/update/TimestampTTLBWIT.java
core/src/test/java/org/elasticsearch/update/UpdateByNativeScriptIT.java
core/src/test/java/org/elasticsearch/update/UpdateIT.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ScriptProcessor.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/ExpressionTests.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/IndexedExpressionTests.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/MoreExpressionTests.java
modules/lang-groovy/src/test/java/org/elasticsearch/script/groovy/GroovyIndexedScriptTests.java
modules/lang-groovy/src/test/java/org/elasticsearch/script/groovy/GroovyScriptTests.java
modules/lang-groovy/src/test/java/org/elasticsearch/script/groovy/GroovySecurityTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestRenderSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/SearchTemplateRequest.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/SearchTemplateRequestBuilder.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TemplateQueryBuilder.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/CustomMustacheFactoryTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MultiSearchTemplateIT.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequestTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MustacheScriptEngineTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MustacheTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateIT.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateRequestTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/TemplateQueryBuilderTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/NeedsScoreTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ScriptEngineTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ScriptTestCase.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorQuerySearchIT.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestUpdateByQueryAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RoundTripTests.java
plugins/lang-javascript/src/test/java/org/elasticsearch/script/javascript/JavaScriptScriptEngineTests.java
plugins/lang-javascript/src/test/java/org/elasticsearch/script/javascript/JavaScriptScriptMultiThreadedTests.java
plugins/lang-javascript/src/test/java/org/elasticsearch/script/javascript/JavaScriptSecurityTests.java
plugins/lang-python/src/test/java/org/elasticsearch/script/python/PythonScriptEngineTests.java
plugins/lang-python/src/test/java/org/elasticsearch/script/python/PythonScriptMultiThreadedTests.java
plugins/lang-python/src/test/java/org/elasticsearch/script/python/PythonSecurityTests.java
comments:
Merge pull request #21136 from jdconrad/stype

Refactor ScriptType to be a top-level class.

time:
2016-10-26T17:21:22Z
class:
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/ingest/InternalTemplateService.java
core/src/main/java/org/elasticsearch/script/CompiledScript.java
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/script/ScriptContextRegistry.java
core/src/main/java/org/elasticsearch/script/ScriptModes.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/main/java/org/elasticsearch/script/ScriptSettings.java
core/src/main/java/org/elasticsearch/script/ScriptType.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionBuilder.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/action/bulk/BulkWithUpdatesIT.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/cluster/NoMasterNodeIT.java
core/src/test/java/org/elasticsearch/index/WaitUntilRefreshIT.java
core/src/test/java/org/elasticsearch/index/query/InnerHitBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryDSLDocumentationTests.java
core/src/test/java/org/elasticsearch/index/query/ScriptQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/script/FileScriptTests.java
core/src/test/java/org/elasticsearch/script/IndexLookupIT.java
core/src/test/java/org/elasticsearch/script/NativeScriptTests.java
core/src/test/java/org/elasticsearch/script/ScriptContextTests.java
core/src/test/java/org/elasticsearch/script/ScriptFieldIT.java
core/src/test/java/org/elasticsearch/script/ScriptModesTests.java
core/src/test/java/org/elasticsearch/script/ScriptServiceTests.java
core/src/test/java/org/elasticsearch/script/ScriptTests.java
core/src/test/java/org/elasticsearch/search/SearchCancellationIT.java
core/src/test/java/org/elasticsearch/search/SearchTimeoutIT.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregationTestScriptsPlugin.java
core/src/test/java/org/elasticsearch/search/aggregations/EquivalenceIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateRangeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DoubleTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/HistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/IpRangeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/LongTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/MinDocCountIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/RangeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsSignificanceScoreIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/StringTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/AvgIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/CardinalityIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ExtendedStatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MaxIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MinIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ScriptedMetricIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ScriptedMetricTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/StatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/SumIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ValueCountIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketScriptIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketScriptTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketSelectorIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketSelectorTests.java
core/src/test/java/org/elasticsearch/search/basic/TransportTwoNodesSearchIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/InnerHitsIT.java
core/src/test/java/org/elasticsearch/search/fields/SearchFieldsIT.java
core/src/test/java/org/elasticsearch/search/functionscore/ExplainableScriptIT.java
core/src/test/java/org/elasticsearch/search/functionscore/FunctionScoreIT.java
core/src/test/java/org/elasticsearch/search/functionscore/RandomScoreFunctionIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoDistanceIT.java
core/src/test/java/org/elasticsearch/search/scriptfilter/ScriptQuerySearchIT.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
core/src/test/java/org/elasticsearch/search/sort/ScriptSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/SimpleSortIT.java
core/src/test/java/org/elasticsearch/search/stats/SearchStatsIT.java
core/src/test/java/org/elasticsearch/update/TimestampTTLBWIT.java
core/src/test/java/org/elasticsearch/update/UpdateByNativeScriptIT.java
core/src/test/java/org/elasticsearch/update/UpdateIT.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ScriptProcessor.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/ExpressionTests.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/IndexedExpressionTests.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/MoreExpressionTests.java
modules/lang-groovy/src/test/java/org/elasticsearch/script/groovy/GroovyIndexedScriptTests.java
modules/lang-groovy/src/test/java/org/elasticsearch/script/groovy/GroovyScriptTests.java
modules/lang-groovy/src/test/java/org/elasticsearch/script/groovy/GroovySecurityTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestRenderSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/SearchTemplateRequest.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/SearchTemplateRequestBuilder.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TemplateQueryBuilder.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/CustomMustacheFactoryTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MultiSearchTemplateIT.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequestTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MustacheScriptEngineTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MustacheTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateIT.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateRequestTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/TemplateQueryBuilderTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/NeedsScoreTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ScriptEngineTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ScriptTestCase.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorQuerySearchIT.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestUpdateByQueryAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RoundTripTests.java
plugins/lang-javascript/src/test/java/org/elasticsearch/script/javascript/JavaScriptScriptEngineTests.java
plugins/lang-javascript/src/test/java/org/elasticsearch/script/javascript/JavaScriptScriptMultiThreadedTests.java
plugins/lang-javascript/src/test/java/org/elasticsearch/script/javascript/JavaScriptSecurityTests.java
plugins/lang-python/src/test/java/org/elasticsearch/script/python/PythonScriptEngineTests.java
plugins/lang-python/src/test/java/org/elasticsearch/script/python/PythonScriptMultiThreadedTests.java
plugins/lang-python/src/test/java/org/elasticsearch/script/python/PythonSecurityTests.java
comments:
Refactor ScriptType to be a top-level class.

time:
2016-10-26T16:07:32Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportShardFlushAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportShardRefreshAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
comments:
add constructor overloads for primary result

time:
2016-10-26T15:23:09Z
class:
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/IndexingOperationListener.java
core/src/main/java/org/elasticsearch/index/shard/InternalIndexingStats.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexingOperationListenerTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/CancelTests.java
comments:
Revert "cleanup indexing operation listener"

This reverts commit bb785483ae41e30a756a17f3fb6cdb5d06a1ad6c.

time:
2016-10-26T14:04:50Z
class:
core/src/main/java/org/elasticsearch/cluster/SnapshotsInProgress.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodes.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/snapshots/IndexShardSnapshotStatus.java
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotShardsService.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
comments:
Abort snapshots on a node that leaves the cluster (#21084)

Previously, if a node left the cluster (for example, due to a long GC),
during a snapshot, the master node would mark the snapshot as failed, but
the node itself could continue snapshotting the data on its shards to the
repository. If the node rejoins the cluster, the master may assign it to
hold the replica shard (where it held the primary before getting kicked off
the cluster). The initialization of the replica shard would repeatedly fail
with a ShardLockObtainFailedException until the snapshot thread finally
finishes and relinquishes the lock on the Store.

This commit resolves the situation by ensuring that when a shard is removed
from a node (such as when a node rejoins the cluster and realizes it no longer
holds the active shard copy), any snapshotting of the removed shards is aborted.
In the scenario above, when the node rejoins the cluster, it will see in the cluster 
state that the node no longer holds the primary shard, so IndicesClusterStateService
will remove the shard, thereby causing any snapshots of that shard to be aborted.

Closes #20876

time:
2016-10-26T13:24:21Z
class:
comments:
Remove checkstyle LineLenght check suppression from 23 more classes

time:
2016-10-26T07:24:03Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
comments:
Only allow the master to update the list of nodes in the cluster state (#21092)

The cluster state on a node is updated either
- by incoming cluster states that are received from the active master or
- by the node itself when it notices that the master has gone.

In the second case, the node adds the NO_MASTER_BLOCK and removes the current master as active master from its cluster state. In one particular case, it would also update the list of nodes, removing the master node that just failed. In the future, we want a clear separation between actions that can be executed by a master publishing a cluster state and a node locally updating its cluster state when no active master is around.

time:
2016-10-26T06:06:05Z
class:
core/src/test/java/org/elasticsearch/search/SearchCancellationIT.java
comments:
Tests: silence cancelling scroll search tests

Investigating it locally

time:
2016-10-26T06:05:49Z
class:
core/src/test/java/org/elasticsearch/search/SearchCancellationTests.java
comments:
Tests: make sure that 2 segments are created in SearchCancellationTests

Otherwise, the test fails if forced merge kicks in.

time:
2016-10-26T03:08:19Z
class:
core/src/main/java/org/elasticsearch/rest/action/RestMainAction.java
core/src/test/java/org/elasticsearch/rest/action/RestMainActionTests.java
modules/transport-netty3/src/main/java/org/elasticsearch/http/netty3/Netty3HttpChannel.java
modules/transport-netty3/src/test/java/org/elasticsearch/rest/Netty3HeadBodyIsEmptyIT.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpChannel.java
modules/transport-netty4/src/test/java/org/elasticsearch/rest/Netty4HeadBodyIsEmptyIT.java
test/framework/src/main/java/org/elasticsearch/rest/HeadBodyIsEmptyIntegTestCase.java
comments:
Add correct Content-Length on HEAD requests

This commit fixes responses to HEAD requests so that the value of the
Content-Length is correct per the HTTP spec. Namely, the value of this
header should be equal to the Content-Length if the request were not a
HEAD request.

This commit also fixes a memory leak on HEAD requests to the main action
that arose from the bytes on a builder not being released due to them
being dropped on the floor to ensure that the response to the main
action did not have a body.

Relates #21123

time:
2016-10-25T22:27:34Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchRequest.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollRequest.java
core/src/main/java/org/elasticsearch/action/search/SearchTask.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/dfs/DfsPhase.java
core/src/main/java/org/elasticsearch/search/dfs/DfsPhaseExecutionException.java
core/src/main/java/org/elasticsearch/search/fetch/FetchPhase.java
core/src/main/java/org/elasticsearch/search/fetch/FetchPhaseExecutionException.java
core/src/main/java/org/elasticsearch/search/fetch/ShardFetchRequest.java
core/src/main/java/org/elasticsearch/search/internal/FilteredSearchContext.java
core/src/main/java/org/elasticsearch/search/internal/InternalScrollSearchRequest.java
core/src/main/java/org/elasticsearch/search/internal/SearchContext.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchTransportRequest.java
core/src/main/java/org/elasticsearch/search/profile/query/CollectorResult.java
core/src/main/java/org/elasticsearch/search/query/CancellableCollector.java
core/src/main/java/org/elasticsearch/search/query/QueryPhase.java
core/src/main/java/org/elasticsearch/search/query/QuerySearchRequest.java
core/src/main/java/org/elasticsearch/tasks/TaskCancelledException.java
core/src/main/java/org/elasticsearch/tasks/TaskManager.java
core/src/main/java/org/elasticsearch/transport/TaskAwareTransportRequestHandler.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/CancellableTasksTests.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
core/src/test/java/org/elasticsearch/search/SearchCancellationIT.java
core/src/test/java/org/elasticsearch/search/SearchCancellationTests.java
core/src/test/java/org/elasticsearch/search/SearchServiceTests.java
core/src/test/java/org/elasticsearch/search/query/QueryPhaseTests.java
test/framework/src/main/java/org/elasticsearch/test/TestSearchContext.java
comments:
Makes search action cancelable by task management API

Long running searches now can be cancelled using standard task cancellation mechanism.

time:
2016-10-25T16:31:09Z
class:
comments:
Merge pull request #21099 from gmarz/rest-allow-no-indices

Remove allow_no_indices from indices.upgrade

time:
2016-10-25T16:29:23Z
class:
core/src/main/java/org/elasticsearch/discovery/InitialStateDiscoveryListener.java
comments:
Remove unused interface InitialStateDiscoveryListener (#21115)

time:
2016-10-25T15:17:24Z
class:
comments:
Convert more docs to // CONSOLE

Converts docs for `_cat/segments`, `_cat/plugins` and `_cat/repositories`
from `curl` to `// CONSOLE` so they are tested as part of the build and
are cleaner to use in Console. They should work fine with `curl` with
the `COPY AS CURL` link.

Also swaps the `source` type of the response from `js` to `txt` because
that is more correct. The syntax highlighter doesn't care. It looks at
the text to figure out the language. So it looks a little funny for `_cat`
responses regardless.

Relates to #18160

time:
2016-10-25T14:42:09Z
class:
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
comments:
fix computing took for write operation result

time:
2016-10-25T14:22:32Z
class:
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/engine/ShadowEngineTests.java
comments:
fix tests

time:
2016-10-25T14:00:44Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
comments:
fix wildcard import

time:
2016-10-25T13:58:14Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/test/java/org/elasticsearch/index/shard/IndexingOperationListenerTests.java
comments:
add setters for translog location and took in engine operation result

time:
2016-10-25T13:33:04Z
class:
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/IndexingOperationListener.java
core/src/main/java/org/elasticsearch/index/shard/InternalIndexingStats.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexingOperationListenerTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/CancelTests.java
comments:
cleanup indexing operation listener

time:
2016-10-25T13:22:49Z
class:
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
comments:
Improve documentation for handling write operation failure

time:
2016-10-25T13:12:39Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/index/IndexingSlowLog.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/shard/IndexingOperationListener.java
core/src/main/java/org/elasticsearch/index/shard/InternalIndexingStats.java
core/src/main/java/org/elasticsearch/indices/IndexingMemoryController.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexingOperationListenerTests.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
comments:
add operation result as a parameter to postIndex/delete in indexing operation listener

time:
2016-10-25T13:11:16Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/index/IndexingSlowLog.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/ShadowEngine.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/IndexingOperationListener.java
core/src/main/java/org/elasticsearch/index/shard/InternalIndexingStats.java
core/src/main/java/org/elasticsearch/index/shard/TranslogRecoveryPerformer.java
core/src/main/java/org/elasticsearch/indices/IndexingMemoryController.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/mapper/TextFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexingOperationListenerTests.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/CancelTests.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
comments:
Revert "Generify index shard method to execute engine write operation"

This reverts commit 1bdeada8aa9e699d5c864d7257fea926426ce474.

time:
2016-10-25T12:33:15Z
class:
core/src/main/java/org/elasticsearch/monitor/os/OsProbe.java
comments:
Fix empty <p> tag warning in o/e/m/o/OsProbe.java

This commit fixes an empty <p> tag warning in o/e/m/o/OsProbe.java.

time:
2016-10-25T12:19:10Z
class:
core/src/main/java/org/elasticsearch/monitor/os/OsProbe.java
comments:
Add preformatted tags to Javadoc in OsProbe

This commit adds preformatted tags to the Javadoc for
OsProbe#readSysFsCgroupCpuAcctCpuStat to render the form of the cpu.stat
file in a fixed-width font.

time:
2016-10-24T23:59:48Z
class:
core/src/main/java/org/elasticsearch/monitor/os/OsProbe.java
core/src/test/java/org/elasticsearch/monitor/os/OsProbeTests.java
comments:
Mock areCgroupStatsAvailable in OsProbeTests

When acquiring cgroup stats, we check if such stats are available by
invoking a method areCgroupStatsAvailable. This method checks
availability by looking for existence of some virtual files in
/proc/self/cgroup and /sys/fs/cgroups. If these stats are not available,
the getCgroup method returns null. The OsProbeTests#testCgroupProbe did
not account for this. On some systems where tests run, the cgroup stats
might not be available yet this test method was expecting them to be (we
mock the relevant virtual file reads). This commit handles the execution
of this test on such systems by overriding the behavior of
OsProbe#areCgroupStatsAvailable. We test both the possibility of this
method returning true as well as false.

time:
2016-10-24T20:40:41Z
class:
core/src/main/java/org/elasticsearch/monitor/os/OsProbe.java
comments:
Remove unused import from o/e/m/o/OsProbe.java

This commit removes an unused import from o/e/m/o/OsProbe.java.

time:
2016-10-24T20:36:51Z
class:
core/src/main/java/org/elasticsearch/monitor/os/OsProbe.java
core/src/main/java/org/elasticsearch/monitor/os/OsStats.java
comments:
Strengthen handling of unavailable cgroup stats

On some systems, cgroups will be available but not configured. And in
some cases, cgroups will be configured, but not for the subsystems that
we are expecting (e.g., cpu and cpuacct). This commit strengthens the
handling of cgroup stats on such systems.

Relates #21094

time:
2016-10-24T19:06:17Z
class:
comments:
Remove allow_no_indices from indices.upgrade

time:
2016-10-24T17:59:08Z
class:
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
core/src/test/java/org/elasticsearch/search/suggest/AbstractSuggestionBuilderTestCase.java
comments:
Tests: Fix compile issue with type inference on java 9 build

time:
2016-10-24T16:48:18Z
class:
core/src/test/java/org/elasticsearch/search/slice/SliceBuilderTests.java
comments:
Tests: fix issue with SliceBuilderTests creation of mutated test objects

time:
2016-10-24T14:41:36Z
class:
core/src/main/java/org/elasticsearch/env/NodeEnvironment.java
comments:
.es_temp_file remains after system crash, causing it not to start again #21007

When system starts, it creates a temporary file named .es_temp_file to ensure the data directories are writable.

If system crashes after creating the .es_temp_file but before deleting this file, next time the system will not be able to start because the Files.createFile(resolve) will throw an exception if the file already exists.

time:
2016-10-24T13:50:40Z
class:
core/src/main/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGeneratorBuilder.java
core/src/test/java/org/elasticsearch/action/search/SearchScrollRequestTests.java
core/src/test/java/org/elasticsearch/common/geo/builders/AbstractShapeBuilderTestCase.java
core/src/test/java/org/elasticsearch/common/geo/builders/CircleBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/InnerHitBuilderTests.java
core/src/test/java/org/elasticsearch/search/SearchRequestTests.java
core/src/test/java/org/elasticsearch/search/aggregations/BaseAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/BasePipelineAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilderTests.java
core/src/test/java/org/elasticsearch/search/rescore/QueryRescoreBuilderTests.java
core/src/test/java/org/elasticsearch/search/searchafter/SearchAfterBuilderTests.java
core/src/test/java/org/elasticsearch/search/slice/SliceBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
core/src/test/java/org/elasticsearch/search/suggest/AbstractSuggestionBuilderTestCase.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestBuilderTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/FuzzyOptionsTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/RegexOptionsTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/WritableTestCase.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGeneratorTests.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/SmoothingModelTestCase.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/main/java/org/elasticsearch/test/EqualsHashCodeTestUtils.java
comments:
Consolidate code for equals/hashCode testing in central utility class

Currently test that check that equals() and hashCode() are working as expected
for classes implementing them are quiet similar. This change moves common
assertions in this method to a common utility class. In addition, another common
utility function in most of these test classes that creates copies of input
object by running them through a StreamOutput and reading them back in, is moved
to ESTestCase so it can be shared across all these classes.

Closes #20629

time:
2016-10-24T12:58:44Z
class:
comments:
[DOCS] clarifies master nodes to be master eligible nodes

time:
2016-10-24T12:26:56Z
class:
core/src/main/java/org/elasticsearch/monitor/os/OsProbe.java
core/src/main/java/org/elasticsearch/monitor/os/OsStats.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStatsTests.java
core/src/test/java/org/elasticsearch/monitor/os/OsProbeTests.java
core/src/test/java/org/elasticsearch/monitor/os/OsStatsTests.java
comments:
Add basic cgroup CPU metrics

This commit adds basic cgroup CPU metrics to the node stats API.

Relates #21029

time:
2016-10-24T11:57:07Z
class:
core/src/main/java/org/elasticsearch/common/network/NetworkModule.java
core/src/main/java/org/elasticsearch/transport/TransportInterceptor.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/action/ingest/IngestProxyActionFilterTests.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientHeadersTests.java
test/framework/src/main/java/org/elasticsearch/transport/AssertingTransportInterceptor.java
comments:
Pass executor name to request interceptor to support async intercept calls (#21089)

Today the request interceptor can't support async calls since the response
of the async call would execute on a different thread ie. a client or listener
thread. This means in-turn that the intercepted handler is not executed with the
thread it was supposed to run and therefor can, if it's executing blocking
operations, potentially deadlock an entire server.

time:
2016-10-24T07:42:03Z
class:
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java
comments:
Change permissions on config files (#20966)

This commit changes some default file permissions on configuration files.

time:
2016-10-24T07:30:55Z
class:
comments:
Add JVM option "-XX:-AssumeMP" in SystemD tests (#21063)

Since with j`ava-1.8.0-openjdk-1.8.0.111-1.b15.el7_2.x86_64`, the OpenJDK packaged for CentOS and OEL override the default value (`false`) for the JVM option `AssumeMP` and force it to `true` (see [this patch](https://git.centos.org/blob/rpms!!java-1.8.0-openjdk.git/ab03fcc7a277355a837dd4c8500f8f90201ea353/SOURCES!always_assumemp.patch))

Because it is forced to true by default for these packages, the following warning message is printed to the standard output when the Vagrant box has only 1 CPU:
> OpenJDK 64-Bit Server VM warning: If the number of processors is expected to increase from one, then you should configure the number of parallel GC threads appropriately using -XX:ParallelGCThreads=N

This message will then fail the test introduced in #20422  where we check if no entries have been added to the journal after the service has been started.

This commit restore the default value for the `AssumeMP` option for CentOS and OracleServer.

time:
2016-10-21T22:49:46Z
class:
core/src/main/java/org/elasticsearch/search/internal/SearchContext.java
comments:
Fix NPE in SearchContext.toString()

Fixes NPE in SearchContext.toString() for user requests that contain scroll id but not scroll timeout.

time:
2016-10-21T20:44:50Z
class:
core/src/main/java/org/elasticsearch/rest/action/RestMainAction.java
distribution/integ-test-zip/src/test/java/org/elasticsearch/test/rest/HeadBodyIsEmptyIT.java
comments:
Make sure HEAD / has 0 Content-Length (#21077)

Before this commit `curl -XHEAD localhost:9200?pretty` would return
`Content-Length: 1` and a body which is fairly upsetting to standards
compliant tools. Now it'll return `Content-Length: 0` with an empty
body like every other `HEAD` request.

Relates to #21075

time:
2016-10-21T19:33:27Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/TransportClusterAllocationExplainAction.java
core/src/main/java/org/elasticsearch/cluster/routing/UnassignedInfo.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/ShardAllocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/Decision.java
core/src/main/java/org/elasticsearch/gateway/ReplicaShardAllocator.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/MoveDecisionTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/ShardAllocationDecisionTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/DecisionTests.java
comments:
Separates decision making from decision application in BalancedShardsAllocator  (#20634)

Refactors the BalancedShardsAllocator to create a method that
provides an allocation decision for allocating a single
unassigned shard or a single started shard that can no longer
remain on its current node.  Having a separate method that
provides a detailed decision on the allocation of a single shard
will enable the cluster allocation explain API to directly
invoke these methods to provide allocation explanations.

time:
2016-10-21T18:50:20Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
comments:
cleanup and improve documentation for TWA

time:
2016-10-21T18:44:24Z
class:
core/src/test/java/org/elasticsearch/search/child/ChildQuerySearchIT.java
comments:
Tests: Add test for parsing InnerHits with highlight query

This adds a test from #21065 that checks correct highlighting of inner hits of a
has-child query when using a nested highlight query.

time:
2016-10-21T17:14:33Z
class:
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuilders.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteResponseParsers.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuildersTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
comments:
Fix reindex-from-remote for parent/child from <2.0

Versions before 2.0 needed to be told to return interesting fields
like `_parent`, `_routing`, `_ttl`, and `_timestamp`. And they come
back inside a `fields` block which we need to parse.

Closes #21044

time:
2016-10-21T14:56:46Z
class:
comments:
Remove timeout parameter from plugin script docs

Support for this parameter was removed but the docs were not
updated. This commit removes this stale parameter from the docs.

Relates #21068

time:
2016-10-21T14:45:11Z
class:
plugins/repository-s3/src/main/java/org/elasticsearch/plugin/repository/s3/S3RepositoryPlugin.java
comments:
Fix s3 repository when used with IAM profiles

Applying same patch we did in #21048 but for `repository-s3` plugin.

Backport of #21058 in master branch

time:
2016-10-21T12:39:00Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/ip/IpRangeParser.java
comments:
`ip_range` aggregation should accept null bounds. (#21043)

* `ip_range` aggregation should accept null bounds.

Closes #21006

* test

* iter

time:
2016-10-21T11:45:33Z
class:
core/src/main/java/org/elasticsearch/rest/action/document/RestGetAction.java
comments:
Fix typo in exception message in RestGetAction

This commit fixes a duplicated word in an exception message in
RestGetAction.

time:
2016-10-21T09:01:17Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregator.java
comments:
Set subSearchContext.topDocs after the rescoring in TopDocsAggs

This change fixes a bug introduced in https://github.com/elastic/elasticsearch/pull/20978
The top docs should be set in the subSearchContext after the rescoring

time:
2016-10-21T08:52:11Z
class:
comments:
Mute journalctl output check in packaging tests

This commit mutes a check on the output of journalctl after the Elasticsearch's systemd service has been started. It expected no entries in the journal but since OpenJDK build 1.8.0_111-b15 the following warning message is printed:
OpenJDK 64-Bit Server VM warning: If the number of processors is expected to increase from one, then you should configure the number of parallel GC threads appropriately using -XX:ParallelGCThreads=N

time:
2016-10-21T07:53:08Z
class:
comments:
[DOC] Fix HttpHost constructor arguments (#21056)

Protocol is the last argument.
Oficial API doc: https://hc.apache.org/httpcomponents-core-ga/httpcore/apidocs/org/apache/http/HttpHost.html
Your own use here: https://github.com/elastic/elasticsearch/blob/7560101ec73331acb39a042bde6130e59e4bb630/client/rest/src/test/java/org/elasticsearch/client/RequestLoggerTests.java#L54

time:
2016-10-21T05:07:50Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
fix internal engine unit tests

time:
2016-10-21T01:49:52Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStats.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/TransportClusterStatsAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/DeleteRequest.java
core/src/main/java/org/elasticsearch/action/get/TransportMultiGetAction.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java
core/src/main/java/org/elasticsearch/client/node/NodeClient.java
core/src/main/java/org/elasticsearch/cluster/ClusterModule.java
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/NodeConnectionsService.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolver.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/MaxRetryAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/SnapshotInProgressAllocationDecider.java
core/src/main/java/org/elasticsearch/common/settings/AbstractScopedSettings.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/common/util/ExtensionPoint.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryStats.java
core/src/main/java/org/elasticsearch/discovery/NoneDiscovery.java
core/src/main/java/org/elasticsearch/discovery/local/LocalDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/ElectMasterService.java
core/src/main/java/org/elasticsearch/discovery/zen/FaultDetection.java
core/src/main/java/org/elasticsearch/discovery/zen/MasterFaultDetection.java
core/src/main/java/org/elasticsearch/discovery/zen/MembershipAction.java
core/src/main/java/org/elasticsearch/discovery/zen/NodeJoinController.java
core/src/main/java/org/elasticsearch/discovery/zen/NodesFaultDetection.java
core/src/main/java/org/elasticsearch/discovery/zen/PendingClusterStateStats.java
core/src/main/java/org/elasticsearch/discovery/zen/PendingClusterStatesQueue.java
core/src/main/java/org/elasticsearch/discovery/zen/PingContextProvider.java
core/src/main/java/org/elasticsearch/discovery/zen/PublishClusterStateAction.java
core/src/main/java/org/elasticsearch/discovery/zen/UnicastHostsProvider.java
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenPingService.java
core/src/main/java/org/elasticsearch/gateway/Gateway.java
core/src/main/java/org/elasticsearch/index/VersionType.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/fielddata/ScriptDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AtomicLongFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/SortedNumericDVIndexFieldData.java
core/src/main/java/org/elasticsearch/index/mapper/TypeFieldMapper.java
core/src/main/java/org/elasticsearch/indices/NodeIndicesStats.java
core/src/main/java/org/elasticsearch/monitor/os/OsProbe.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/DiscoveryPlugin.java
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesStatsAction.java
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/rescore/QueryRescorer.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/main/java/org/elasticsearch/tribe/TribeService.java
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStatsTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/template/BWCTemplateTests.java
core/src/test/java/org/elasticsearch/action/support/master/IndexingMasterFailoverIT.java
core/src/test/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationActionTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/client/node/NodeClientHeadersTests.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientIT.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/SpecificMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/metadata/DateMathExpressionResolverTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolverTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/WildcardExpressionResolverTests.java
core/src/test/java/org/elasticsearch/cluster/routing/PrimaryAllocationIT.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceIT.java
core/src/test/java/org/elasticsearch/common/TableTests.java
core/src/test/java/org/elasticsearch/common/geo/ShapeBuilderTests.java
core/src/test/java/org/elasticsearch/common/io/stream/BytesStreamsTests.java
core/src/test/java/org/elasticsearch/common/unit/ByteSizeValueTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryModuleTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/discovery/ZenFaultDetectionTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ElectMasterServiceTests.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeJoinControllerTests.java
core/src/test/java/org/elasticsearch/discovery/zen/PendingClusterStatesQueueTests.java
core/src/test/java/org/elasticsearch/discovery/zen/PublishClusterStateActionTests.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryIT.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenPingTests.java
core/src/test/java/org/elasticsearch/index/IndexSettingsTests.java
core/src/test/java/org/elasticsearch/index/TransportIndexFailuresIT.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/mapper/GeoPointFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/NestedObjectMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/TimestampFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/TypeFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/query/HasChildQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/TypeQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/search/geo/GeoPointParsingTests.java
core/src/test/java/org/elasticsearch/index/search/geo/GeoUtilsTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/ShardPathTests.java
core/src/test/java/org/elasticsearch/indices/DateMathIndexExpressionsIntegrationIT.java
core/src/test/java/org/elasticsearch/indices/IndicesOptionsIntegrationIT.java
core/src/test/java/org/elasticsearch/indices/NodeIndicesStatsTests.java
core/src/test/java/org/elasticsearch/indices/state/OpenCloseIndexIT.java
core/src/test/java/org/elasticsearch/indices/state/RareClusterStateIT.java
core/src/test/java/org/elasticsearch/ingest/IngestClientIT.java
core/src/test/java/org/elasticsearch/ingest/IngestProcessorNotInstalledOnAllNodesIT.java
core/src/test/java/org/elasticsearch/mget/SimpleMgetIT.java
core/src/test/java/org/elasticsearch/monitor/os/OsProbeTests.java
core/src/test/java/org/elasticsearch/search/DefaultSearchContextTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java
core/src/test/java/org/elasticsearch/search/fields/SearchFieldsIT.java
core/src/test/java/org/elasticsearch/search/functionscore/QueryRescorerIT.java
core/src/test/java/org/elasticsearch/search/query/SearchQueryIT.java
core/src/test/java/org/elasticsearch/search/sort/ScoreSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/SortModeTests.java
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/tribe/TribeIT.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ScriptProcessor.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorFactoryTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportReindexAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteWhitelistTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteWithAuthTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RetryTests.java
modules/transport-netty3/src/main/java/org/elasticsearch/http/netty3/Netty3HttpRequestHandler.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpChannel.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpChannelTests.java
plugins/discovery-azure-classic/src/main/java/org/elasticsearch/cloud/azure/classic/AzureDiscoveryModule.java
plugins/discovery-azure-classic/src/main/java/org/elasticsearch/cloud/azure/classic/management/AzureComputeServiceImpl.java
plugins/discovery-azure-classic/src/main/java/org/elasticsearch/discovery/azure/classic/AzureUnicastHostsProvider.java
plugins/discovery-azure-classic/src/main/java/org/elasticsearch/plugin/discovery/azure/classic/AzureDiscoveryPlugin.java
plugins/discovery-azure-classic/src/test/java/org/elasticsearch/cloud/azure/classic/AbstractAzureComputeServiceTestCase.java
plugins/discovery-azure-classic/src/test/java/org/elasticsearch/cloud/azure/classic/AzureComputeServiceSimpleMock.java
plugins/discovery-azure-classic/src/test/java/org/elasticsearch/cloud/azure/classic/AzureComputeServiceTwoNodesMock.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImpl.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/Ec2Module.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/plugin/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedDiscoveryPlugin.java
plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedUnicastHostsProvider.java
plugins/discovery-file/src/test/java/org/elasticsearch/discovery/file/FileBasedDiscoveryPluginTests.java
plugins/discovery-gce/src/main/java/org/elasticsearch/cloud/gce/GceInstancesService.java
plugins/discovery-gce/src/main/java/org/elasticsearch/cloud/gce/GceInstancesServiceImpl.java
plugins/discovery-gce/src/main/java/org/elasticsearch/cloud/gce/GceMetadataService.java
plugins/discovery-gce/src/main/java/org/elasticsearch/discovery/gce/GceUnicastHostsProvider.java
plugins/discovery-gce/src/main/java/org/elasticsearch/plugin/discovery/gce/GceDiscoveryPlugin.java
plugins/discovery-gce/src/test/java/org/elasticsearch/discovery/gce/GceDiscoveryTests.java
plugins/repository-azure/src/test/java/org/elasticsearch/repositories/azure/AzureSnapshotRestoreTests.java
qa/evil-tests/src/test/java/org/elasticsearch/tribe/TribeUnitTests.java
test/framework/src/main/java/org/elasticsearch/node/NodeTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESBackcompatTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java
test/framework/src/main/java/org/elasticsearch/test/discovery/ClusterDiscoveryConfiguration.java
test/framework/src/main/java/org/elasticsearch/test/discovery/MockZenPing.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/restspec/ClientYamlSuiteRestApiParser.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/restspec/ClientYamlSuiteRestApiParserFailingTests.java
test/framework/src/test/java/org/elasticsearch/test/test/InternalTestClusterTests.java
comments:
Merge branch 'master' into enhancement/replicate_primary_write_failures

time:
2016-10-21T01:22:21Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportShardFlushAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportShardRefreshAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/indices/stats/IndexStatsIT.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
comments:
Simplify TransportWriteAction request handling

This commit reduces classes to handle write
operation results in TransportWriteAction, this
comes at the cost of handling write operations in
TransportShardBulkAction.
Now parsing, mapping failures (which happen before
executing engine write operation) are communicated
via a failure operation type while transient operation
failures are set on the index/delete operations.

time:
2016-10-21T00:19:12Z
class:
comments:
Docs: add documentation about removal of cluster.routing.allocation.snapshot.relocation_enabled

time:
2016-10-21T00:19:12Z
class:
core/src/main/java/org/elasticsearch/cluster/ClusterModule.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/SnapshotInProgressAllocationDecider.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
comments:
Remove cluster.routing.allocation.snapshot.relocation_enabled setting

This experimental setting enables relocation of shards that are being snapshotted, which can cause the shard allocation failures. This setting is undocumented and there is no good reason to set it in production.

time:
2016-10-21T00:13:29Z
class:
comments:
Upgrade to Netty 4.1.6

This commit upgrades the transport-netty4 module dependency from Netty
version 4.1.5 to version 4.1.6. This is a bug fix release of Netty.

Relates #21051

time:
2016-10-20T19:39:46Z
class:
core/src/main/java/org/elasticsearch/monitor/os/OsProbe.java
core/src/test/java/org/elasticsearch/monitor/os/OsProbeTests.java
comments:
Cleanup load average handling

This commit cleans up the code handling load averages in OsProbe:
 - remove support for BSD; we do not support this OS
 - add Javadocs
 - strengthen assertions and testing
 - add debug logging for exceptional situation

Relates #21037

time:
2016-10-20T18:19:47Z
class:
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/plugin/discovery/ec2/Ec2DiscoveryPlugin.java
comments:
Fix ec2 discovery when used with IAM profiles.

Follow up for #21039.

We can revert the previous change and do that a bit smarter than it was.

Patch tested successfully manually on ec2 with 2 nodes with a configuration like:

```yml
discovery.type: ec2
network.host: ["_local_", "_site_", "_ec2_"]
cloud.aws.region: us-west-2
```

(cherry picked from commit fbbeded)

Backport of #21048 in master branch

time:
2016-10-20T17:35:26Z
class:
comments:
Remove more equivalents of the now method from the Painless whitelist.

time:
2016-10-20T16:51:10Z
class:
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportReindexAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteWhitelistTests.java
comments:
Remove publishAddress from reindex whitelist

Removes the `publishAddress` parameter from the reindex-from-remote
whitelist checking because it isn't in use after #21004.

time:
2016-10-20T16:13:59Z
class:
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/DiscoveryPlugin.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryModuleTests.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
plugins/discovery-azure-classic/src/main/java/org/elasticsearch/cloud/azure/classic/AzureDiscoveryModule.java
plugins/discovery-azure-classic/src/main/java/org/elasticsearch/cloud/azure/classic/management/AzureComputeServiceImpl.java
plugins/discovery-azure-classic/src/main/java/org/elasticsearch/discovery/azure/classic/AzureUnicastHostsProvider.java
plugins/discovery-azure-classic/src/main/java/org/elasticsearch/plugin/discovery/azure/classic/AzureDiscoveryPlugin.java
plugins/discovery-azure-classic/src/test/java/org/elasticsearch/cloud/azure/classic/AbstractAzureComputeServiceTestCase.java
plugins/discovery-azure-classic/src/test/java/org/elasticsearch/cloud/azure/classic/AzureComputeServiceSimpleMock.java
plugins/discovery-azure-classic/src/test/java/org/elasticsearch/cloud/azure/classic/AzureComputeServiceTwoNodesMock.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImpl.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/Ec2Module.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/plugin/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedDiscoveryPlugin.java
plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedUnicastHostsProvider.java
plugins/discovery-file/src/test/java/org/elasticsearch/discovery/file/FileBasedDiscoveryPluginTests.java
plugins/discovery-gce/src/main/java/org/elasticsearch/cloud/gce/GceInstancesService.java
plugins/discovery-gce/src/main/java/org/elasticsearch/cloud/gce/GceInstancesServiceImpl.java
plugins/discovery-gce/src/main/java/org/elasticsearch/cloud/gce/GceMetadataService.java
plugins/discovery-gce/src/main/java/org/elasticsearch/discovery/gce/GceUnicastHostsProvider.java
plugins/discovery-gce/src/main/java/org/elasticsearch/plugin/discovery/gce/GceDiscoveryPlugin.java
plugins/discovery-gce/src/test/java/org/elasticsearch/discovery/gce/GceDiscoveryTests.java
comments:
Plugins: Make UnicastHostsProvider extension pull based (#21036)

This change moves providing UnicastHostsProvider for zen discovery to be
pull based, adding a getter in DiscoveryPlugin. A new setting is added,
discovery.zen.hosts_provider, to separate the discovery type from the
hosts provider for zen when it is selected. Unfortunately existing
plugins added ZenDiscovery with their own name in order to just provide
a hosts provider, so there are already many users setting the hosts
provider through discovery.type. This change also includes backcompat,
falling back to discovery.type when discovery.zen.hosts_provider is not
set.

time:
2016-10-20T15:19:22Z
class:
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java
comments:
Fix ec2 discovery when used with IAM profiles.

Here is what is happening without this fix when you try to connect to ec2 APIs:

```
[2016-10-20T12:41:49,925][DEBUG][c.a.a.AWSCredentialsProviderChain] Unable to load credentials from EnvironmentVariableCredentialsProvider: Unable to load AWS credentials from environment variables (AWS_ACCESS_KEY_ID (or AWS_ACCESS_KEY) and AWS_SECRET_KEY (or AWS_SECRET_ACCESS_KEY))
[2016-10-20T12:41:49,926][DEBUG][c.a.a.AWSCredentialsProviderChain] Unable to load credentials from SystemPropertiesCredentialsProvider: Unable to load AWS credentials from Java system properties (aws.accessKeyId and aws.secretKey)
[2016-10-20T12:41:49,926][DEBUG][c.a.a.AWSCredentialsProviderChain] Unable to load credentials from com.amazonaws.auth.profile.ProfileCredentialsProvider@1ad14091: access denied ("java.io.FilePermission" "/home/ubuntu/.aws/credentials" "read")
[2016-10-20T12:41:49,927][DEBUG][c.a.i.EC2MetadataClient  ] Connecting to EC2 instance metadata service at URL: http://169.254.169.254/latest/meta-data/iam/security-credentials/
[2016-10-20T12:41:49,951][DEBUG][c.a.i.EC2MetadataClient  ] Connecting to EC2 instance metadata service at URL: http://169.254.169.254/latest/meta-data/iam/security-credentials/discovery-tests
[2016-10-20T12:41:49,965][DEBUG][c.a.a.AWSCredentialsProviderChain] Unable to load credentials from InstanceProfileCredentialsProvider: Unable to parse Json String.
[2016-10-20T12:41:49,966][INFO ][o.e.d.e.AwsEc2UnicastHostsProvider] [dJfktmE] Exception while retrieving instance list from AWS API: Unable to load AWS credentials from any provider in the chain
[2016-10-20T12:41:49,967][DEBUG][o.e.d.e.AwsEc2UnicastHostsProvider] [dJfktmE] Full exception:
com.amazonaws.AmazonClientException: Unable to load AWS credentials from any provider in the chain
	at com.amazonaws.auth.AWSCredentialsProviderChain.getCredentials(AWSCredentialsProviderChain.java:131) ~[aws-java-sdk-core-1.10.69.jar:?]
	at com.amazonaws.services.ec2.AmazonEC2Client.invoke(AmazonEC2Client.java:11117) ~[aws-java-sdk-ec2-1.10.69.jar:?]
	at com.amazonaws.services.ec2.AmazonEC2Client.describeInstances(AmazonEC2Client.java:5403) ~[aws-java-sdk-ec2-1.10.69.jar:?]
	at org.elasticsearch.discovery.ec2.AwsEc2UnicastHostsProvider.fetchDynamicNodes(AwsEc2UnicastHostsProvider.java:116) [discovery-ec2-5.0.0.jar:5.0.0]
	at org.elasticsearch.discovery.ec2.AwsEc2UnicastHostsProvider$DiscoNodesCache.refresh(AwsEc2UnicastHostsProvider.java:234) [discovery-ec2-5.0.0.jar:5.0.0]
	at org.elasticsearch.discovery.ec2.AwsEc2UnicastHostsProvider$DiscoNodesCache.refresh(AwsEc2UnicastHostsProvider.java:219) [discovery-ec2-5.0.0.jar:5.0.0]
	at org.elasticsearch.common.util.SingleObjectCache.getOrRefresh(SingleObjectCache.java:54) [elasticsearch-5.0.0.jar:5.0.0]
	at org.elasticsearch.discovery.ec2.AwsEc2UnicastHostsProvider.buildDynamicNodes(AwsEc2UnicastHostsProvider.java:102) [discovery-ec2-5.0.0.jar:5.0.0]
	at org.elasticsearch.discovery.zen.ping.unicast.UnicastZenPing.sendPings(UnicastZenPing.java:358) [elasticsearch-5.0.0.jar:5.0.0]
	at org.elasticsearch.discovery.zen.ping.unicast.UnicastZenPing$1.doRun(UnicastZenPing.java:272) [elasticsearch-5.0.0.jar:5.0.0]
	at org.elasticsearch.common.util.concurrent.ThreadContext$ContextPreservingAbstractRunnable.doRun(ThreadContext.java:504) [elasticsearch-5.0.0.jar:5.0.0]
	at org.elasticsearch.common.util.concurrent.AbstractRunnable.run(AbstractRunnable.java:37) [elasticsearch-5.0.0.jar:5.0.0]
	at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) [?:1.8.0_91]
	at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) [?:1.8.0_91]
	at java.lang.Thread.run(Thread.java:745) [?:1.8.0_91]
```

For whatever reason, it can not parse what is coming back from http://169.254.169.254/latest/meta-data/iam/security-credentials/discovery-tests.

But, if you wrap the code within an `AccessController.doPrivileged()` call, then it works perfectly.

Closes #21039.

(cherry picked from commit abfdc70)

time:
2016-10-20T13:27:52Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
comments:
Test fix - configure script object fully before making available. Hopefully a fix for issue 18120 but have been unable to reproduce so cannot confirm.

time:
2016-10-20T13:10:45Z
class:
core/src/main/java/org/elasticsearch/index/mapper/TypeFieldMapper.java
core/src/test/java/org/elasticsearch/index/mapper/TypeFieldTypeTests.java
comments:
Add specialization of TermsQuery for _type disjunctions
The commit message is not accurate. It should be:

**Fix TypesQuery when same types is present multiple times**

This change fixes the case where having the same type repeated multiple times can lead to a MatchAllDocsQuery.


time:
2016-10-20T10:50:49Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregator.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java
comments:
Rescorer should be applied in the TopHits aggregation (#20978)

When using a top hits aggregation the rescorer are ignored.
This change applies the rescorer to the top hits of each bucket.

Fixes #19317

time:
2016-10-20T10:38:28Z
class:
core/src/main/java/org/elasticsearch/search/rescore/QueryRescorer.java
core/src/test/java/org/elasticsearch/search/functionscore/QueryRescorerIT.java
comments:
Max score should be updated when a rescorer is used (#20977)

The max score returned in the response of a query does not take rescorer into account.
This change updates the max_score when a rescorer is used in a query.
Fixes #20651

time:
2016-10-20T10:33:32Z
class:
core/src/main/java/org/elasticsearch/index/mapper/TypeFieldMapper.java
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/test/java/org/elasticsearch/index/mapper/TypeFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/query/HasChildQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/TypeQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/DefaultSearchContextTests.java
comments:
Optimize query with types filter in the URL (t/t/_search) (#20979)

This change adds a TypesQuery that checks if the disjunction of types should be rewritten to a MatchAllDocs query. The check is done only if the number of terms is below a threshold (16 by default and configurable via max_boolean_clause).

time:
2016-10-20T09:32:12Z
class:
comments:
[TEST] fix multi_get REST test

After #20659 it's concreteSingleIndex that throws exception rather than resolvIndexRouting. The error message is slightly different.

time:
2016-10-20T07:44:48Z
class:
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/NodeConnectionsService.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryStats.java
core/src/main/java/org/elasticsearch/discovery/zen/FaultDetection.java
core/src/main/java/org/elasticsearch/discovery/zen/MasterFaultDetection.java
core/src/main/java/org/elasticsearch/discovery/zen/MembershipAction.java
core/src/main/java/org/elasticsearch/discovery/zen/NodeJoinController.java
core/src/main/java/org/elasticsearch/discovery/zen/NodesFaultDetection.java
core/src/main/java/org/elasticsearch/discovery/zen/PendingClusterStateStats.java
core/src/main/java/org/elasticsearch/discovery/zen/PendingClusterStatesQueue.java
core/src/main/java/org/elasticsearch/discovery/zen/PingContextProvider.java
core/src/main/java/org/elasticsearch/discovery/zen/PublishClusterStateAction.java
core/src/main/java/org/elasticsearch/discovery/zen/UnicastHostsProvider.java
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenPingService.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStatsTests.java
core/src/test/java/org/elasticsearch/action/support/master/IndexingMasterFailoverIT.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/discovery/ZenFaultDetectionTests.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeJoinControllerTests.java
core/src/test/java/org/elasticsearch/discovery/zen/PendingClusterStatesQueueTests.java
core/src/test/java/org/elasticsearch/discovery/zen/PublishClusterStateActionTests.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryIT.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenPingTests.java
plugins/discovery-azure-classic/src/main/java/org/elasticsearch/discovery/azure/classic/AzureUnicastHostsProvider.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java
plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedUnicastHostsProvider.java
plugins/discovery-gce/src/main/java/org/elasticsearch/discovery/gce/GceUnicastHostsProvider.java
test/framework/src/main/java/org/elasticsearch/test/discovery/MockZenPing.java
comments:
Move all zen discovery classes into o.e.discovery.zen (#21032)

* Move all zen discovery classes into o.e.discovery.zen

This collapses sub packages of zen into zen. These all had just a couple
classes each, and there is really no reason to have the subpackages.

* fix checkstyle

time:
2016-10-20T07:26:55Z
class:
core/src/main/java/org/elasticsearch/action/get/TransportMultiGetAction.java
core/src/test/java/org/elasticsearch/indices/DateMathIndexExpressionsIntegrationIT.java
core/src/test/java/org/elasticsearch/mget/SimpleMgetIT.java
comments:
Fixed date math expression support in multi get requests. (#20659)

Date math index/alias expressions in mget will now be resolved to a concrete single index instead of failing the mget item with an `IndexNotFoundException`.

Added also an integration test to verify multi index aliases do not fail the entire mget request.

Closes #17957

time:
2016-10-20T06:48:15Z
class:
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java
comments:
[TEST] Remove create special case in yaml test client

Now that the create api has its own spec, we can remove the special case in the yaml test client for it

Relates to #20924

time:
2016-10-20T02:04:35Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStats.java
comments:
Remove node_info_format parameter from node stats

This commit removes an undocumented output parameter node_info_format
from the cluster stats and node stats APIs. Currently the parameter does
not even work as it is not whitelisted as an output parameter. Since
this parameter is not documented, we opt to just remove it.

Relates #21021

time:
2016-10-20T02:01:17Z
class:
core/src/main/java/org/elasticsearch/indices/NodeIndicesStats.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesStatsAction.java
core/src/test/java/org/elasticsearch/indices/NodeIndicesStatsTests.java
comments:
Whitelist node stats indices level parameter

When indices stats are requested via the node stats API, there is a
level parameter to request stats at the index, node, or shards
level. This parameter was not whitelisted when URL parsing was made
strict. This commit whitelists this parameter.

Additionally, there was some leniency in the parsing of this parameter
that has been removed.

Relates #21024

time:
2016-10-19T22:04:58Z
class:
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/zen/ElectMasterService.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/ping/unicast/UnicastZenPing.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryModuleTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ElectMasterServiceTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ping/unicast/UnicastZenPingTests.java
comments:
Remove pluggability of ElectMasterService (#21031)

This change makes the ElectMasterService local to ZenDiscovery, no
longer created by guice, and thus also removes the ability for plugins
to customize. This extension point is no longer used by anything.

time:
2016-10-19T17:42:08Z
class:
core/src/main/java/org/elasticsearch/action/delete/DeleteRequest.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java
core/src/main/java/org/elasticsearch/index/VersionType.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
Merge remote-tracking branch 'dakrone/readd-force-versioning'

time:
2016-10-19T17:41:52Z
class:
core/src/main/java/org/elasticsearch/action/delete/DeleteRequest.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/index/VersionType.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/test/java/org/elasticsearch/action/bulk/BulkWithUpdatesIT.java
core/src/test/java/org/elasticsearch/index/VersionTypeTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/update/UpdateIT.java
core/src/test/java/org/elasticsearch/versioning/SimpleVersioningIT.java
comments:
Disallow VersionType.FORCE for 6.0+ indices

This was an error-prone version type that allowed overriding previous
version semantics. It could cause primaries and replicas to be out of
sync however, so it has been removed.

This is related to #20377, which removed the feature entirely. This
allows operations to continue to use the `force` version type if the
index was created before 6.0, in the event a document using it exists in
a translog being replayed.

time:
2016-10-19T16:51:10Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java
comments:
Fixes bug preventing script sort working on top_hits aggregation (#21023)

Previous to this change any request using a script sort in a top_hits
aggregation would fail because the compilation of the script happened
after the QueryShardContext was frozen (after we had worked out if the
request is cachable).

This change moves the calling of build() on the SortBuilder to the
TopHitsAggregationBuilder which means that the script in the script_sort
will be compiled before we decide whether to cache the request and freeze
the context.

Closes #21022

time:
2016-10-19T15:42:38Z
class:
core/src/main/java/org/elasticsearch/client/node/NodeClient.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/client/node/NodeClientHeadersTests.java
modules/transport-netty3/src/main/java/org/elasticsearch/http/netty3/Netty3HttpRequestHandler.java
comments:
some misspelled words in code (#21012)

as the title mentioned, misspelling as follows, "construct" to "constrcut", "cumulation" to "cumalation", "initialize" to "intialize".

time:
2016-10-19T14:25:13Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/TransportClusterStatsAction.java
comments:
Remove output_uuid parameter from cluster stats

This commit removes an undocumented output parameter output_uuid from
the cluster stats API. Currently the parameter does not even work as it
is not whitelisted as an output parameter. Since the cluster UUID is
available from the main action, and this parameter is not documented, we
opt to just remove it.

Relates #21020

time:
2016-10-19T13:43:52Z
class:
comments:
[test] Required parameters are checked client-side

time:
2016-10-19T13:27:42Z
class:
comments:
Testing: Fix smoke tester (#21018)

Fixes two minor issues

* An import from an already removed file was used.
* The strict URL & parameter parsing hit one of the API calls

time:
2016-10-19T09:59:23Z
class:
core/src/test/java/org/elasticsearch/ingest/IngestClientIT.java
core/src/test/java/org/elasticsearch/ingest/IngestProcessorNotInstalledOnAllNodesIT.java
comments:
remove `getMockPlugins` override from IngestProcessorNotInstalledOnAllNodesIT & IngestClientIT

they didn't call the base class and it doesn't seem like they add something/the wrong way to solve a problem.

time:
2016-10-19T01:47:21Z
class:
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportReindexAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteWhitelistTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteWithAuthTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RetryTests.java
comments:
Add "simple match" support for reindex-from-remote whitelist

This allows you to whitelist `localhost:*` or `127.0.10.*:9200`.
It explicitly checks for patterns like `*` in the whitelist and
refuses to start if the whitelist would match everything. Beyond
that the user is on their own designing a secure whitelist.

time:
2016-10-19T01:36:16Z
class:
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
comments:
Plugins: Add back user agent when downloading plugins (#20872)

This adds back a User-Agent header, which we had before large plugin
script refactorings for 5.0. The value is now
`elasticsearch-plugin-installer`.

time:
2016-10-18T23:22:01Z
class:
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ScriptProcessor.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorFactoryTests.java
comments:
make painless the default scripting language for ScriptProcessor (#20981)

- fixes a bug in the docs that mentions `lang` as optional
- now `lang` defaults to "painless"

time:
2016-10-18T21:57:02Z
class:
comments:
Remove old release scripts (#21005)

These scripts are no longer used now that we have the unified release
process.

time:
2016-10-18T19:12:15Z
class:
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/MaxRetryAllocationDecider.java
core/src/main/java/org/elasticsearch/common/util/ExtensionPoint.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/NoneDiscovery.java
core/src/main/java/org/elasticsearch/discovery/local/LocalDiscovery.java
core/src/main/java/org/elasticsearch/tribe/TribeService.java
core/src/test/java/org/elasticsearch/action/support/master/IndexingMasterFailoverIT.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientIT.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/SpecificMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/routing/PrimaryAllocationIT.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceIT.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryIT.java
core/src/test/java/org/elasticsearch/index/TransportIndexFailuresIT.java
core/src/test/java/org/elasticsearch/indices/state/RareClusterStateIT.java
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/tribe/TribeIT.java
plugins/repository-azure/src/test/java/org/elasticsearch/repositories/azure/AzureSnapshotRestoreTests.java
qa/evil-tests/src/test/java/org/elasticsearch/tribe/TribeUnitTests.java
test/framework/src/main/java/org/elasticsearch/node/NodeTests.java
test/framework/src/main/java/org/elasticsearch/test/ESBackcompatTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java
test/framework/src/main/java/org/elasticsearch/test/discovery/ClusterDiscoveryConfiguration.java
test/framework/src/main/java/org/elasticsearch/test/discovery/MockZenPing.java
test/framework/src/test/java/org/elasticsearch/test/test/InternalTestClusterTests.java
comments:
Remove local discovery in favor of a simpler `MockZenPings` (#20960)

`LocalDiscovery` is a discovery implementation that uses static in memory maps to keep track of current live nodes. This is used extensively in our tests in order to speed up cluster formation (i.e., shortcut the 3 second ping period used by `ZenDiscovery` by default). This is sad as that mean that most of the test run using a different discovery semantics than what is used in production. Instead of replacing the entire discovery logic, we can use a similar approach to only shortcut the pinging components.

time:
2016-10-18T18:48:58Z
class:
comments:
Build: Change `gradle run` to use zip distribution (#21001)

When running `gradle run`, a developer usually intends to get a running
instance as if they had run elasticsearch from the command line. This is
different than the isolated environment we use for integration testing
plugins. This change switches the run task to use the zip distribution,
so that all modules included in the normal distribution are included.

time:
2016-10-18T16:57:03Z
class:
comments:
Add missing '// CONSOLE' to code snippet

time:
2016-10-18T15:56:18Z
class:
comments:
[DOCS] Add "version" to template and pipeline docs (#20407)

* [DOCS] Add "version" to template and pipeline docs

This adds details about the "version" to both the template and pipeline pages.

time:
2016-10-18T15:49:09Z
class:
core/src/test/java/org/elasticsearch/action/admin/indices/template/BWCTemplateTests.java
comments:
Add rudimentary logstash and beats template BWC tests (#20588)

This tests that the templates shipped with 5.0 versions of Logstash and
Beats still work on an Elasticsearch 6.0+ node, so that we ensure that
ES can be upgraded prior to upgrading tools dependent on it.

Related to #20491
Resolves #17275

time:
2016-10-18T15:24:22Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolver.java
core/src/test/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolverTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/WildcardExpressionResolverTests.java
comments:
Only negate index expression on all indices with preceding wildcard (#20898)

* Only negate index expression on all indices with preceding wildcard

There is currently a very confusing behavior in Elasticsearch for the
following:

Given the indices: `[test1, test2, -foo1, -foo2]`

```
DELETE /-foo*
```

Will cause the `test1` and `test2` indices to be deleted, when what is
usually intended is to delete the `-foo1` and `-foo2` indices.

Previously we added a change in #20033 to disallow creating indices
starting with `-` or `+`, which will help with this situation. However,
users may have existing indices starting with these characters.

This changes the negation to only take effect in a wildcard (`*`) has
been seen somewhere in the expression, so in order to delete `-foo1` and
`-foo2` the following now works:

```
DELETE /-foo*
```

As well as:

```
DELETE /-foo1,-foo2
```

so in order to actually delete everything except for the "foo" indices
(ie, `test1` and `test2`) a user would now issue:

```
DELETE /*,--foo*
```

Relates to #19800

time:
2016-10-18T14:07:57Z
class:
core/src/main/java/org/elasticsearch/transport/TransportService.java
comments:
Fix typo in param. name in TransportService method

This commit fixes a typo in a parameter name for the
TransportService#setTracerLogExclude method.

Relates #20970

time:
2016-10-18T12:22:41Z
class:
core/src/main/java/org/elasticsearch/transport/TransportService.java
comments:
tracelLogExclude to tracerLogExclude (#20970)

fix a variable name for misspelling "tracerLogExclude" to "tracelLogExclude"

time:
2016-10-18T10:57:07Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/publish/PublishClusterStateAction.java
comments:
ClusterState publishing shouldn't trigger circuit breakers (#20986)

Updating the circuit breaker settings (and other settings) should always be possible, even if the cluster is under stress. With #20827 we updated the cluster settings request to not trigger circuit breakers. However that change is not complete since the resulting cluster state can potentially not be published. This change makes sure cluster state publishing to not trigger circuit breakers as well.

Relates to #20960 where this was discovered.

time:
2016-10-18T09:13:09Z
class:
comments:
Remove org.junit.rules.ExpectedException from forbidden-apis again

time:
2016-10-18T08:34:48Z
class:
core/src/test/java/org/elasticsearch/search/sort/ScoreSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/SortModeTests.java
comments:
Use Lucenes expectThrows() when testing exceptions

Cleaning up a few remaining occurences of using junits ExpectedException rule in
favor of using LuceneTestCase#expectThrows() which is more concise and versatile.

time:
2016-10-18T03:24:41Z
class:
comments:
Merge pull request #20958 from joshuar/joshuar-docs/clearer-shard-allocation-filtering

Docs: Cluster Allocation Filtering

time:
2016-10-18T03:23:27Z
class:
comments:
Merge pull request #20794 from joshuar/doc/fix_highlighter_ambiguities

[DOCS] Use a better name for fields in examples to avoid ambiguity

time:
2016-10-17T20:42:11Z
class:
core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/index/VersionType.java
core/src/test/java/org/elasticsearch/action/bulk/BulkWithUpdatesIT.java
core/src/test/java/org/elasticsearch/index/VersionTypeTests.java
core/src/test/java/org/elasticsearch/update/UpdateIT.java
core/src/test/java/org/elasticsearch/versioning/SimpleVersioningIT.java
comments:
Revert "Remove FORCE version_type"

This reverts commit b4cc3cd35dea2e3059142c6bd7e2eb13ca8944ac.

time:
2016-10-17T19:31:54Z
class:
core/src/test/java/org/elasticsearch/search/fields/SearchFieldsIT.java
comments:
Fix test to check for boolean instead of integer for boolean field

time:
2016-10-17T19:06:29Z
class:
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationActionTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/DateMathExpressionResolverTests.java
core/src/test/java/org/elasticsearch/common/TableTests.java
core/src/test/java/org/elasticsearch/common/geo/ShapeBuilderTests.java
core/src/test/java/org/elasticsearch/common/io/stream/BytesStreamsTests.java
core/src/test/java/org/elasticsearch/common/unit/ByteSizeValueTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/index/mapper/GeoPointFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/NestedObjectMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/TimestampFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/search/geo/GeoPointParsingTests.java
core/src/test/java/org/elasticsearch/index/search/geo/GeoUtilsTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/ShardPathTests.java
core/src/test/java/org/elasticsearch/indices/IndicesOptionsIntegrationIT.java
core/src/test/java/org/elasticsearch/indices/state/OpenCloseIndexIT.java
core/src/test/java/org/elasticsearch/search/query/SearchQueryIT.java
comments:
Use expectThrows() instead of try-catch blocks for testing expected exceptions

time:
2016-10-17T18:11:42Z
class:
core/src/main/java/org/elasticsearch/index/fielddata/ScriptDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AtomicLongFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/SortedNumericDVIndexFieldData.java
comments:
Add support for booleans in scripts (#20950)

* Scripting: Add support for booleans in scripts

Since 2.0, booleans have been represented as numeric fields (longs).
However, in scripts, this is odd, since you expect doing a comparison
against a boolean to work. While languages like groovy will auto convert
between booleans and longs, painless does not.

This changes the doc values accessor for boolean fields in scripts to
return Boolean objects instead of Long objects.

closes #20949

* Make Booleans final and remove wrapping of `this` for getValues()

time:
2016-10-17T17:31:30Z
class:
comments:
Update scripted-metric-aggregation.asciidoc

Removed docs for `reduce_params`

Closes #20917

time:
2016-10-17T16:28:57Z
class:
comments:
Merge pull request #20975 from zhenxing914/2.3

node.client() should not be used in the documentation

time:
2016-10-17T15:58:31Z
class:
comments:
Added missing POST method to create.json REST spec

Relates to #20924

time:
2016-10-17T15:57:25Z
class:
comments:
Add a REST spec for the create API (#20924)

The create request now requires that an ID be present.
Currently the clients hard code a create method, but
we should just add a create REST spec so this method
can be autogenerated.

time:
2016-10-17T15:56:54Z
class:
comments:
Fixed typo in index rollover docs

Closes #20935

time:
2016-10-17T14:50:32Z
class:
comments:
Fix slowlog docs

This commit fixes two issues with the slow log docs:
 - clarifies that these settings are per index
 - updates index slow log configuration for Log4j 2

Relates #20976

time:
2016-10-17T14:33:03Z
class:
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointService.java
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointSyncAction.java
core/src/main/java/org/elasticsearch/index/seqno/SeqNoStats.java
core/src/main/java/org/elasticsearch/index/seqno/SequenceNumbersService.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoverySourceService.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTargetHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RemoteRecoveryTargetHandler.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/replication/IndexLevelReplicationTests.java
core/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java
core/src/test/java/org/elasticsearch/index/seqno/CheckpointsIT.java
core/src/test/java/org/elasticsearch/index/seqno/GlobalCheckpointTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/indices/cluster/AbstractIndicesClusterStateServiceTestCase.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySourceHandlerTests.java
core/src/test/java/org/elasticsearch/recovery/RelocationIT.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
Simplify GlobalCheckpointService and properly hook it for cluster state updates (#20720)

During a recent merge from master, we lost the bridge from IndicesClusterStateService to the GlobalCheckpointService of primary shards, notifying them of changes to the current set of active/initializing shards. This commits add the bridge back (with unit tests). It also simplifies the GlobalCheckpoint tracking to use a simpler model (which makes use the fact that the global check point sync is done periodically).

The old integration CheckpointIT test is moved to IndexLevelReplicationTests. I also added similar assertions to RelocationsIT, which surfaced a bug in the primary relocation logic and how it plays with global checkpoint updates. The test is currently await-fixed and will be fixed in a follow up issue.

time:
2016-10-17T14:32:17Z
class:
comments:
Update regexp-syntax.asciidoc (#20973)

time:
2016-10-17T14:27:01Z
class:
comments:
Deprecate EOL'ed Ubuntu 15.04 from Vagrantfile

* Deprecate EOL'ed Ubuntu 15.04 from Vagrantfile

Relates pr #20921

time:
2016-10-17T07:19:07Z
class:
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/restspec/ClientYamlSuiteRestApiParser.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/restspec/ClientYamlSuiteRestApiParserFailingTests.java
comments:
REST API parser should fail on duplicate params/paths/methods/parts (#20940)

This commit changes the current REST API parser to make it fail and throw an exception when a REST specification file contains a duplicated parameters, or path, or method, or path part.

time:
2016-10-17T00:02:33Z
class:
comments:
Docs: Cluster Allocation Filtering

Put more emphasis on the fact that multiple values can be specified
and move examples after explanation of settings.

time:
2016-10-16T23:51:00Z
class:
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpChannel.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpChannelTests.java
comments:
Fix connection keep-alive header handling

This commit fixes an issue with the handling of the value "keep-alive"
on the Connection header in the Netty 4 HTTP implementation while
handling an HTTP 1.0 request. The issue was using the wrong equals
method to compare an AsciiString instance and a String instance (they
could never be equal). This commit fixes this to use the correct equals
method to compare for content equality.

time:
2016-10-16T17:18:09Z
class:
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpChannel.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpChannelTests.java
comments:
Fix connection close header handling

This commit fixes an issue with the handling of the value "close" on the
Connection header in the Netty 4 HTTP implementation. The issue was
using the wrong equals method to compare an AsciiString instance and a
String instance (they could never be equal). This commit fixes this to
use the correct equals method to compare for content equality.

Relates #20956

time:
2016-10-16T11:25:25Z
class:
comments:
Updated REST test README to include required params when running tests

time:
2016-10-15T19:20:38Z
class:
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
comments:
Documentation for handling engine write failures

time:
2016-10-15T17:31:15Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/ShadowEngine.java
comments:
remove declaring unchecked exception due to engine write operations

time:
2016-10-15T12:46:54Z
class:
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
comments:
[TEST] return empty array if AbstractQueryTestCase#currentTypes is null

This is important to allow any test to use RandomQueryBuilder#createQuery()
since some of the query builders that are used in this test test the length
of the types array and otherwise will thow NPE if the test is not a subclass
of AbstractQueryTestCase.

time:
2016-10-15T03:55:15Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/main/java/org/elasticsearch/common/settings/AbstractScopedSettings.java
core/src/main/java/org/elasticsearch/gateway/Gateway.java
core/src/test/java/org/elasticsearch/index/IndexSettingsTests.java
comments:
Add precise logging on unknown or invalid settings

Today when logging an unknown or invalid setting, the log message does
not contain the source. This means that if we are archiving such a
setting, we do not specify where the setting is from (an index, and
which index, or a persistent or transient cluster setting). This commit
provides such logging for the end user can better understand the
consequences of the unknown or invalid setting.

Relates #20951

time:
2016-10-15T03:44:39Z
class:
comments:
Fix logging configuration for AwsSdkMetrics logger

This commit fixes an issue with the configuration for the AwsSdkMetrics
logger; the issue is that the logging configuration had used underscores
instead of periods for the settings key (the perils of lenient settings
parsing).

Relates #20313

time:
2016-10-14T23:07:35Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/index/IndexingSlowLog.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/IndexingOperationListener.java
core/src/main/java/org/elasticsearch/index/shard/InternalIndexingStats.java
core/src/main/java/org/elasticsearch/indices/IndexingMemoryController.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/mapper/TextFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexingOperationListenerTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/CancelTests.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
comments:
Generify index shard method to execute engine write operation

Now index and delete methods in index shard share code for
indexing stats. This commit collapses seperate methods for
index and delete operations into a generic execute method
for performing engine write operations. As an added benefit,
this commit cleans up the interface for indexing operation
listener making it more simple and concise to use.

time:
2016-10-14T22:22:10Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationOperation.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
comments:
Handle transient write failure in transport replication action

time:
2016-10-14T20:10:26Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/index/engine/DeleteFailedEngineException.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/OperationFailedEngineException.java
core/src/main/java/org/elasticsearch/index/engine/ShadowEngine.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/indices/stats/IndexStatsIT.java
comments:
Distinguish environment failures from transient operation failures for write operations

Currently, we treat all write operation exceptions as equals, but in reality
every write operation can cause either an environment failure (i.e. a failure
that should fail the engine e.g. data corruption, lucene tragic events) or
operation failure (i.e. a failure that is transient w.r.t the operation e.g.
parsing exception).

This change bubbles up enironment failures from the engine, after failing the
engine but captures transient operation failures as part of the operation
to be processed appopriately at the transport level.

time:
2016-10-14T20:10:26Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
comments:
Distinguish primary and replica request types in TransportWriteAction

time:
2016-10-14T18:19:21Z
class:
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/search/sort/FieldSortBuilder.java
core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java
core/src/main/java/org/elasticsearch/search/sort/ScoreSortBuilder.java
core/src/main/java/org/elasticsearch/search/sort/ScriptSortBuilder.java
core/src/main/java/org/elasticsearch/search/sort/SortBuilder.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
core/src/test/java/org/elasticsearch/search/sort/ScriptSortBuilderTests.java
comments:
Use ObjectParser in ScriptSortBuilder

time:
2016-10-14T18:19:21Z
class:
core/src/main/java/org/elasticsearch/search/sort/FieldSortBuilder.java
core/src/main/java/org/elasticsearch/search/sort/ScoreSortBuilder.java
core/src/test/java/org/elasticsearch/search/sort/FieldSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/ScoreSortBuilderTests.java
comments:
Use ObjectParser in ScoreSortBuilder and FieldSortBuilder

time:
2016-10-14T18:12:35Z
class:
comments:
CONSOLEify _cat/pending_tasks docs

Relates to #18160

time:
2016-10-14T14:51:20Z
class:
core/src/main/java/org/elasticsearch/index/mapper/Mapper.java
core/src/test/java/org/elasticsearch/index/mapper/MapperTests.java
comments:
Merge pull request #20904 from johtani/remove_nullable_in_mapper_builder_context

IndexSettings should not be Null in Mapper.BuildContext

time:
2016-10-14T14:32:31Z
class:
comments:
Add doc note regarding processors bound

This commit expands the thread pool docs regarding the processor
setting.

Relates #20895

time:
2016-10-14T14:26:09Z
class:
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/ShardValidateQueryRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/TransportValidateQueryAction.java
core/src/main/java/org/elasticsearch/action/explain/ExplainRequest.java
core/src/main/java/org/elasticsearch/action/explain/TransportExplainAction.java
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchHelper.java
core/src/main/java/org/elasticsearch/action/support/broadcast/TransportBroadcastAction.java
core/src/main/java/org/elasticsearch/action/support/single/shard/TransportSingleShardAction.java
core/src/main/java/org/elasticsearch/common/bytes/BytesArray.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/internal/AliasFilter.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchLocalRequest.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchRequest.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchTransportRequest.java
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/action/ExplainRequestTests.java
core/src/test/java/org/elasticsearch/action/ShardValidateQueryRequestTests.java
core/src/test/java/org/elasticsearch/index/IndexServiceTests.java
core/src/test/java/org/elasticsearch/index/SearchSlowLogTests.java
core/src/test/java/org/elasticsearch/indices/IndicesRequestCacheIT.java
core/src/test/java/org/elasticsearch/search/AbstractSearchTestCase.java
core/src/test/java/org/elasticsearch/search/SearchServiceTests.java
core/src/test/java/org/elasticsearch/search/internal/ShardSearchTransportRequestTests.java
comments:
Parse alias filters on the coordinating node (#20916)

Today we don't parse alias filters on the coordinating node, we only forward
the alias patters to executing node and resolve it late. This has several problems
like requests that go through filtered aliases are never cached if they use date math,
since the parsing happens very late in the process even without rewriting. It also used
to be processed on every shard while we can only do it once per index on the coordinating node.
Another nice side-effect is that we are never prone to cluster-state updates that change an alias,
all nodes will execute the exact same alias filter since they are process based on the same
cluster state.

time:
2016-10-14T13:01:31Z
class:
core/src/main/java/org/elasticsearch/index/mapper/Mapper.java
core/src/test/java/org/elasticsearch/index/mapper/MapperTests.java
comments:
IndexSettings should not be Null in Mapper.BuildContext

Rename method name
Change validation

Closes #20174

time:
2016-10-14T11:21:39Z
class:
comments:
Remove duplicate timeout parameter in Delete/Update-By-Query REST Specs (#20934)

This commit removes the duplicated "timeout" parameter introduced in #20915

time:
2016-10-14T09:47:26Z
class:
core/src/main/java/org/elasticsearch/action/search/TransportMultiSearchAction.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java
core/src/main/java/org/elasticsearch/common/util/PageCacheRecycler.java
core/src/main/java/org/elasticsearch/common/util/concurrent/EsExecutors.java
core/src/main/java/org/elasticsearch/index/MergeSchedulerConfig.java
core/src/main/java/org/elasticsearch/monitor/os/OsService.java
core/src/main/java/org/elasticsearch/threadpool/FixedExecutorBuilder.java
core/src/main/java/org/elasticsearch/threadpool/ThreadPool.java
core/src/test/java/org/elasticsearch/threadpool/FixedThreadPoolTests.java
core/src/test/java/org/elasticsearch/threadpool/UpdateThreadPoolSettingsTests.java
modules/transport-netty3/src/main/java/org/elasticsearch/http/netty3/Netty3HttpServerTransport.java
modules/transport-netty3/src/main/java/org/elasticsearch/transport/netty3/Netty3Transport.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
comments:
Remove artificial default processors limit

Today Elasticsearch limits the number of processors used in computing
thread counts to 32. This was from a time when Elasticsearch created
more threads than it does now and users would run into out of memory
errors. It appears the real cause of these out of memory errors was not
well understood (it's often due to ulimit settings) and so users were
left hitting these out of memory errors on boxes with high core
counts. Today Elasticsearch creates less threads (but still a lot) and
we have a bootstrap check in place to ensure that the relevant ulimit is
not too low.

There are some caveats still to having too many concurrent indexing
threads as it can lead to too many little segments, and it's not a
magical go faster knob if indexing is already bottlenecked by disk, but
this limitation is artificial and surprising to users and so it should
be removed.

This commit also increases the lower bound of the max processes ulimit,
to prepare for a world where Elasticsearch instances might be running
with more the previous cap of 32 processors. With the current settings,
Elasticsearch wants to create roughly 576 + 25 * p / 2 threads, where p
is the number of processors. Add in roughly 7 * p / 8 threads for the GC
threads and a fudge factor, and 4096 should cover us pretty well up to
256 cores.

Relates #20874

time:
2016-10-14T08:06:38Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/ShardValidateQueryRequest.java
core/src/test/java/org/elasticsearch/action/ExplainRequestTests.java
core/src/test/java/org/elasticsearch/action/ShardValidateQueryRequestTests.java
comments:
[TEST] Add basic tests for ExplainRequest and ShardValidationQueryRequest

time:
2016-10-14T07:26:33Z
class:
comments:
Update Delete/Update-By-Query REST Specs (#20915)

This commit removes unused parameters from the Update-By-Query and Delete-By-Query REST specification files.

time:
2016-10-13T20:43:06Z
class:
comments:
CONSOLEify a few more _cat docs

`_cat/master`, `_cat/nodeattrs`, `_cat/nodes`.

time:
2016-10-13T20:13:18Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
Remove unreleased version constant

Some people apparently never run tests when they change this file.
Neither do they read comments right below the line they change that
they should do the change after all.

time:
2016-10-13T18:42:43Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
Fix version constant for 5.0.0

time:
2016-10-13T18:21:49Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
Renamed v5.0.0-rc2 to 5.0.0

time:
2016-10-13T17:21:57Z
class:
comments:
Add a flush to test in _cat/indices.asciidoc

We test that sorting by `store.size` works but sometimes the
sizes aren't what we expect. At least in CI:
https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=opensuse/101/console
https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+5.x+multijob-unix-compatibility/os=centos/100/console

I haven't been able to reproduce it locally but adding a `_flush`
won't hurt and might make the inconsistency vanish.

time:
2016-10-13T16:12:57Z
class:
core/src/main/java/org/elasticsearch/action/termvectors/TermVectorsFields.java
core/src/main/java/org/elasticsearch/common/util/BigArrays.java
core/src/main/java/org/elasticsearch/gateway/AsyncShardFetch.java
core/src/main/java/org/elasticsearch/gateway/DanglingIndicesState.java
core/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java
core/src/main/java/org/elasticsearch/gateway/GatewayMetaState.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/ReplicaShardAllocator.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/GeoPointArrayIndexFieldData.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyGeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceRangeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/shard/ShadowIndexShard.java
core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java
core/src/test/java/org/elasticsearch/index/mapper/GeoPointFieldMapperTests.java
core/src/test/java/org/elasticsearch/test/geo/RandomShapeGenerator.java
comments:
Removed unnecessary assertion on boolean values (#20910)

* Removed unnecessary assertion on boolean values

* Reversed changes for false assertion

* corrected formatting

* reverted changes for SettingsUpdater

time:
2016-10-13T15:39:19Z
class:
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
comments:
[TEST] use a different node ID for the test nodes

time:
2016-10-13T14:49:32Z
class:
comments:
Docs: note about snapshot version compatibility (#20896)

It is important that folks understand that snapshot/restore isn't
for archiving. It is appropriate for backup and disaster recovery
but not for archival over long periods of time because of version
incompatibility.

Closes #20866

time:
2016-10-13T14:17:28Z
class:
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/CustomMustacheFactory.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MustacheScriptEngineService.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/CustomMustacheFactoryTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MustacheScriptEngineTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MustacheTests.java
comments:
Mustache: Add {{#url}}{{/url}} function to URL encode strings (#20838)

This commit adds a new Mustache function (codename: url) and a new URLEncoder that can be used to URL encode strings in mustache templates.

time:
2016-10-13T14:07:31Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/cluster/routing/OperationRouting.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
comments:
Make AbstractSearchAsyncAction more testable and add a basic test case (#20890)

`AbstractSearchAsyncAction` has only been tested in integration tests.
The infrastructure is rather critical and should be tested on a unit-test
level. This change takes the first step.

time:
2016-10-13T13:27:31Z
class:
core/src/main/java/org/elasticsearch/common/cache/Cache.java
core/src/main/java/org/elasticsearch/common/cache/CacheBuilder.java
core/src/main/java/org/elasticsearch/indices/IndicesRequestCache.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/test/java/org/elasticsearch/common/cache/CacheBuilderTests.java
core/src/test/java/org/elasticsearch/common/cache/CacheTests.java
comments:
Use TimveValue instead of long for CacheBuilder methods

This changes the CacheBuilder methods that are used to set expiration times to accept a
TimeValue instead of long. Accepting a long can lead to issues where the incorrect value is
passed in as the time unit is not clearly identified. By using TimeValue the caller no longer
needs to worry about the time unit used by the cache or builder.

time:
2016-10-13T11:06:53Z
class:
comments:
Fix wrong heading

Relates #20906

time:
2016-10-13T10:13:55Z
class:
comments:
Add note about retention periods to reindex-upgrade docs

time:
2016-10-13T09:47:17Z
class:
core/src/test/java/org/elasticsearch/common/xcontent/ObjectParserTests.java
comments:
[TEST] Add test that shows how to use a classic pull-parser with the object parser

time:
2016-10-13T09:11:08Z
class:
core/src/main/java/org/elasticsearch/index/mapper/Mapper.java
core/src/test/java/org/elasticsearch/index/mapper/MapperTests.java
comments:
IndexSettings should not be Null in Mapper.BuildContext

Remove Nullable notation
Add unit test

Closes #20174

time:
2016-10-13T08:18:40Z
class:
core/src/test/java/org/elasticsearch/indices/IndicesRequestCacheIT.java
comments:
[TEST] Add test that filtered alias with date math isn't cached by the request cache

time:
2016-10-13T07:58:25Z
class:
comments:
Fix YAML formatting in several REST tests

time:
2016-10-13T07:44:41Z
class:
core/src/main/java/org/elasticsearch/index/search/MultiMatchQuery.java
core/src/test/java/org/elasticsearch/index/search/MultiMatchQueryTests.java
core/src/test/java/org/elasticsearch/search/query/MultiMatchQueryIT.java
comments:
Fixes MultiMatchQuery so that it doesn't provide a null context (#20882)

Before this change the `MultiMatchQuery` called the field types
`termQuery()` with a null context. This is not correct so this change
fixes this so the `MultiMatchQuery` now uses the `ShardQueryContext` it
stores as a field.

Relates to https://github.com/elastic/elasticsearch/pull/20796#pullrequestreview-3606305

time:
2016-10-13T06:53:30Z
class:
comments:
[DOCS] Fix typo in "Wait For Active Shards" part (#20900)

Add missing closing backtick

time:
2016-10-12T20:33:47Z
class:
core/src/main/java/org/elasticsearch/common/transport/PortsRange.java
modules/transport-netty3/src/main/java/org/elasticsearch/http/netty3/Netty3HttpServerTransport.java
modules/transport-netty3/src/test/java/org/elasticsearch/http/netty3/Netty3HttpServerTransportTests.java
modules/transport-netty3/src/test/java/org/elasticsearch/transport/netty3/SimpleNetty3TransportTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerTransportTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/transport/netty4/SimpleNetty4TransportTests.java
comments:
Ensure port range is readable in the exception message (#20893)

Both netty3 and netty4 http implementation printed the default
toString representation of PortRange if ports couldn't be bound.
This commit adds a better default toString method to PortRange and
uses the string representation for the error message in the http
implementations.

time:
2016-10-12T20:13:13Z
class:
core/src/main/java/org/elasticsearch/index/IndexService.java
comments:
Never use ThreadPool#estimatedTimeInMillis as wall-clock time replacement

time:
2016-10-12T17:09:29Z
class:
core/src/main/java/org/apache/lucene/queryparser/classic/ExistsFieldQueryExtension.java
core/src/main/java/org/apache/lucene/queryparser/classic/FieldQueryExtension.java
core/src/main/java/org/apache/lucene/search/vectorhighlight/CustomFieldQuery.java
core/src/main/java/org/apache/lucene/store/StoreRateLimiting.java
core/src/main/java/org/apache/lucene/store/StoreUtils.java
core/src/main/java/org/elasticsearch/ElasticsearchParseException.java
core/src/main/java/org/elasticsearch/ElasticsearchWrapperException.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/ActionRequest.java
core/src/main/java/org/elasticsearch/action/ActionRequestBuilder.java
core/src/main/java/org/elasticsearch/action/FailedNodeException.java
core/src/main/java/org/elasticsearch/action/NoShardAvailableActionException.java
core/src/main/java/org/elasticsearch/action/NoSuchNodeException.java
core/src/main/java/org/elasticsearch/action/PrimaryMissingActionException.java
core/src/main/java/org/elasticsearch/action/RoutingMissingException.java
core/src/main/java/org/elasticsearch/action/ThreadingModel.java
core/src/main/java/org/elasticsearch/action/TimestampParsingException.java
core/src/main/java/org/elasticsearch/action/UnavailableShardsException.java
core/src/main/java/org/elasticsearch/action/ValidateActions.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/hotthreads/NodeHotThreads.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/hotthreads/NodesHotThreadsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/hotthreads/NodesHotThreadsRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/hotthreads/NodesHotThreadsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/hotthreads/NodesHotThreadsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/hotthreads/TransportNodesHotThreadsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/info/TransportNodesInfoAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodesStatsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodesStatsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodesStatsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/TransportNodesStatsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/list/TransportListTasksAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/reroute/TransportClusterRerouteAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/settings/ClusterUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsGroup.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/TransportClusterSearchShardsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/TransportRestoreSnapshotAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/SnapshotIndexShardStage.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/SnapshotIndexShardStatus.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/SnapshotStats.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/TransportSnapshotsStatusAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/state/TransportClusterStateAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/TransportClusterStatsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/DeleteStoredScriptAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/GetStoredScriptAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/PutStoredScriptAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/tasks/PendingClusterTasksAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/tasks/PendingClusterTasksRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/tasks/PendingClusterTasksRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/tasks/PendingClusterTasksResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/tasks/TransportPendingClusterTasksAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/IndicesAliasesAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/exists/AliasesExistAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/exists/AliasesExistRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/exists/AliasesExistResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/exists/TransportAliasesExistAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/get/BaseAliasesRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/get/TransportGetAliasesAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/ClearIndicesCacheAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/ClearIndicesCacheRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/ClearIndicesCacheRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/close/CloseIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/delete/DeleteIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/delete/DeleteIndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/exists/indices/IndicesExistsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/exists/indices/IndicesExistsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/exists/types/TypesExistsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/exists/types/TypesExistsRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/flush/FlushAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/flush/FlushRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportShardFlushAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/forcemerge/ForceMergeAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetFieldMappingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetMappingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetMappingsRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetMappingsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetMappingsResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/TransportGetFieldMappingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/TransportGetMappingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/open/OpenIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/segments/IndicesSegmentsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/segments/IndicesSegmentsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/segments/TransportIndicesSegmentsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/get/GetSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/get/GetSettingsRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/get/GetSettingsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/get/GetSettingsResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/get/TransportGetSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/put/TransportUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/put/UpdateSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/shrink/ShrinkAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndexShardStats.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndexStats.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/ShardStats.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/TransportIndicesStatsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/delete/DeleteIndexTemplateAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/delete/DeleteIndexTemplateRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/get/GetIndexTemplatesAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/get/GetIndexTemplatesRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/get/TransportGetIndexTemplatesAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/get/TransportUpgradeStatusAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/get/UpgradeStatusAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/get/UpgradeStatusRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/post/ShardUpgradeRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/post/ShardUpgradeResult.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/post/TransportUpgradeSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/post/UpgradeSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/QueryExplanation.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/TransportValidateQueryAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/ValidateQueryAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/ValidateQueryRequestBuilder.java
core/src/main/java/org/elasticsearch/action/bulk/BulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkShardRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkShardResponse.java
core/src/main/java/org/elasticsearch/action/delete/DeleteAction.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsAction.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsRequest.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsResponse.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsShardRequest.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsShardResponse.java
core/src/main/java/org/elasticsearch/action/get/GetAction.java
core/src/main/java/org/elasticsearch/action/get/MultiGetAction.java
core/src/main/java/org/elasticsearch/action/index/IndexAction.java
core/src/main/java/org/elasticsearch/action/search/ClearScrollAction.java
core/src/main/java/org/elasticsearch/action/search/ClearScrollRequest.java
core/src/main/java/org/elasticsearch/action/search/ClearScrollRequestBuilder.java
core/src/main/java/org/elasticsearch/action/search/ClearScrollResponse.java
core/src/main/java/org/elasticsearch/action/search/MultiSearchAction.java
core/src/main/java/org/elasticsearch/action/search/ParsedScrollId.java
core/src/main/java/org/elasticsearch/action/search/SearchAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollRequest.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchHelper.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java
core/src/main/java/org/elasticsearch/action/support/AbstractListenableActionFuture.java
core/src/main/java/org/elasticsearch/action/support/AdapterActionFuture.java
core/src/main/java/org/elasticsearch/action/support/DefaultShardOperationFailedException.java
core/src/main/java/org/elasticsearch/action/support/PlainActionFuture.java
core/src/main/java/org/elasticsearch/action/support/TransportAction.java
core/src/main/java/org/elasticsearch/action/support/broadcast/BroadcastOperationRequestBuilder.java
core/src/main/java/org/elasticsearch/action/support/broadcast/BroadcastRequest.java
core/src/main/java/org/elasticsearch/action/support/broadcast/BroadcastShardRequest.java
core/src/main/java/org/elasticsearch/action/support/broadcast/BroadcastShardResponse.java
core/src/main/java/org/elasticsearch/action/support/broadcast/TransportBroadcastAction.java
core/src/main/java/org/elasticsearch/action/support/master/info/ClusterInfoRequest.java
core/src/main/java/org/elasticsearch/action/support/master/info/ClusterInfoRequestBuilder.java
core/src/main/java/org/elasticsearch/action/support/master/info/TransportClusterInfoAction.java
core/src/main/java/org/elasticsearch/action/support/nodes/BaseNodeRequest.java
core/src/main/java/org/elasticsearch/action/support/nodes/BaseNodesRequest.java
core/src/main/java/org/elasticsearch/action/support/nodes/BaseNodesResponse.java
core/src/main/java/org/elasticsearch/action/support/nodes/NodesOperationRequestBuilder.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationRequestBuilder.java
core/src/main/java/org/elasticsearch/action/support/single/instance/InstanceShardOperationRequest.java
core/src/main/java/org/elasticsearch/action/support/single/instance/InstanceShardOperationRequestBuilder.java
core/src/main/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationAction.java
core/src/main/java/org/elasticsearch/action/support/single/shard/SingleShardOperationRequestBuilder.java
core/src/main/java/org/elasticsearch/action/support/single/shard/SingleShardRequest.java
core/src/main/java/org/elasticsearch/action/termvectors/MultiTermVectorsAction.java
core/src/main/java/org/elasticsearch/action/termvectors/TermVectorsAction.java
core/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/client/support/AbstractClient.java
core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java
core/src/main/java/org/elasticsearch/client/transport/support/TransportProxyClient.java
core/src/main/java/org/elasticsearch/cluster/action/index/NodeMappingRefreshAction.java
core/src/main/java/org/elasticsearch/cluster/block/ClusterBlock.java
core/src/main/java/org/elasticsearch/cluster/block/ClusterBlockException.java
core/src/main/java/org/elasticsearch/cluster/block/ClusterBlockLevel.java
core/src/main/java/org/elasticsearch/cluster/health/ClusterHealthStatus.java
core/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataDeleteIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/ProcessClusterEventTimeoutException.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodeFilters.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationService.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RoutingAllocation.java
core/src/main/java/org/elasticsearch/cluster/service/PendingClusterTask.java
core/src/main/java/org/elasticsearch/common/Booleans.java
core/src/main/java/org/elasticsearch/common/Classes.java
core/src/main/java/org/elasticsearch/common/Strings.java
core/src/main/java/org/elasticsearch/common/blobstore/BlobStoreException.java
core/src/main/java/org/elasticsearch/common/blobstore/fs/FsBlobStore.java
core/src/main/java/org/elasticsearch/common/blobstore/support/PlainBlobMetaData.java
core/src/main/java/org/elasticsearch/common/collect/HppcMaps.java
core/src/main/java/org/elasticsearch/common/collect/MapBuilder.java
core/src/main/java/org/elasticsearch/common/collect/Tuple.java
core/src/main/java/org/elasticsearch/common/component/AbstractLifecycleComponent.java
core/src/main/java/org/elasticsearch/common/component/LifecycleComponent.java
core/src/main/java/org/elasticsearch/common/component/LifecycleListener.java
core/src/main/java/org/elasticsearch/common/compress/Compressor.java
core/src/main/java/org/elasticsearch/common/compress/CompressorFactory.java
core/src/main/java/org/elasticsearch/common/geo/GeoPoint.java
core/src/main/java/org/elasticsearch/common/geo/GeoUtils.java
core/src/main/java/org/elasticsearch/common/geo/ShapesAvailability.java
core/src/main/java/org/elasticsearch/common/geo/SpatialStrategy.java
core/src/main/java/org/elasticsearch/common/io/FastCharArrayReader.java
core/src/main/java/org/elasticsearch/common/io/UTF8StreamWriter.java
core/src/main/java/org/elasticsearch/common/io/stream/ByteBufferStreamInput.java
core/src/main/java/org/elasticsearch/common/io/stream/DataOutputStreamOutput.java
core/src/main/java/org/elasticsearch/common/io/stream/InputStreamStreamInput.java
core/src/main/java/org/elasticsearch/common/io/stream/OutputStreamStreamOutput.java
core/src/main/java/org/elasticsearch/common/joda/Joda.java
core/src/main/java/org/elasticsearch/common/lease/Releasables.java
core/src/main/java/org/elasticsearch/common/lucene/BytesRefs.java
core/src/main/java/org/elasticsearch/common/lucene/Lucene.java
core/src/main/java/org/elasticsearch/common/lucene/MinimumScoreCollector.java
core/src/main/java/org/elasticsearch/common/lucene/ScorerAware.java
core/src/main/java/org/elasticsearch/common/lucene/all/AllEntries.java
core/src/main/java/org/elasticsearch/common/lucene/all/AllTokenStream.java
core/src/main/java/org/elasticsearch/common/lucene/search/FilteredCollector.java
core/src/main/java/org/elasticsearch/common/lucene/search/MoreLikeThisQuery.java
core/src/main/java/org/elasticsearch/common/lucene/search/Queries.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/ScoreFunction.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/WeightFactorFunction.java
core/src/main/java/org/elasticsearch/common/lucene/store/InputStreamIndexInput.java
core/src/main/java/org/elasticsearch/common/metrics/CounterMetric.java
core/src/main/java/org/elasticsearch/common/metrics/MeanMetric.java
core/src/main/java/org/elasticsearch/common/metrics/Metric.java
core/src/main/java/org/elasticsearch/common/network/NetworkService.java
core/src/main/java/org/elasticsearch/common/recycler/NoneRecycler.java
core/src/main/java/org/elasticsearch/common/regex/Regex.java
core/src/main/java/org/elasticsearch/common/rounding/DateTimeUnit.java
core/src/main/java/org/elasticsearch/common/transport/NetworkExceptionHelper.java
core/src/main/java/org/elasticsearch/common/transport/PortsRange.java
core/src/main/java/org/elasticsearch/common/unit/SizeUnit.java
core/src/main/java/org/elasticsearch/common/util/ArrayUtils.java
core/src/main/java/org/elasticsearch/common/util/Callback.java
core/src/main/java/org/elasticsearch/common/util/concurrent/ConcurrentCollections.java
core/src/main/java/org/elasticsearch/common/util/concurrent/ConcurrentHashMapLong.java
core/src/main/java/org/elasticsearch/common/util/concurrent/ConcurrentMapLong.java
core/src/main/java/org/elasticsearch/common/util/concurrent/EsAbortPolicy.java
core/src/main/java/org/elasticsearch/common/util/concurrent/EsRejectedExecutionException.java
core/src/main/java/org/elasticsearch/common/util/concurrent/FutureUtils.java
core/src/main/java/org/elasticsearch/common/util/concurrent/PrioritizedCallable.java
core/src/main/java/org/elasticsearch/common/util/concurrent/PrioritizedRunnable.java
core/src/main/java/org/elasticsearch/common/util/concurrent/UncategorizedExecutionException.java
core/src/main/java/org/elasticsearch/common/util/concurrent/XRejectedExecutionHandler.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentHelper.java
core/src/main/java/org/elasticsearch/common/xcontent/cbor/CborXContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/smile/SmileXContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/support/AbstractXContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/support/XContentMapValues.java
core/src/main/java/org/elasticsearch/common/xcontent/yaml/YamlXContentParser.java
core/src/main/java/org/elasticsearch/discovery/MasterNotDiscoveredException.java
core/src/main/java/org/elasticsearch/discovery/local/LocalDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/DiscoveryNodesProvider.java
core/src/main/java/org/elasticsearch/discovery/zen/ElectMasterService.java
core/src/main/java/org/elasticsearch/discovery/zen/membership/MembershipAction.java
core/src/main/java/org/elasticsearch/discovery/zen/ping/PingContextProvider.java
core/src/main/java/org/elasticsearch/discovery/zen/ping/unicast/UnicastZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/publish/PublishClusterStateAction.java
core/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java
core/src/main/java/org/elasticsearch/gateway/GatewayException.java
core/src/main/java/org/elasticsearch/gateway/GatewayModule.java
core/src/main/java/org/elasticsearch/gateway/GatewayService.java
core/src/main/java/org/elasticsearch/gateway/LocalAllocateDangledIndices.java
core/src/main/java/org/elasticsearch/gateway/ReplicaShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/TransportNodesListGatewayMetaState.java
core/src/main/java/org/elasticsearch/http/BindHttpException.java
comments:
Merge branch 'master' into cleanup/transport_bulk

time:
2016-10-12T17:03:49Z
class:
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
comments:
Increase number of allowed failures in MockRepository for snapshot restore test

The test testDataFileCorruptionDuringRestore expects failures to happen when accessing snapshot data. It would sometimes
fail however as MockRepository (by default) only simulates 100 failures.

time:
2016-10-12T16:38:26Z
class:
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/seqno/SequenceNumbersService.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
Sequence numbers commit data in Lucene uses Iterable interface (#20793)

Sequence number related data (maximum sequence number, local checkpoint,
and global checkpoint) gets stored in Lucene on each commit. The logical
place to store this data is on each Lucene commit's user commit data
structure (see IndexWriter#setCommitData and the new version
IndexWriter#setLiveCommitData). However, previously we did not store the
maximum sequence number in the commit data because the commit data got
copied over before the Lucene IndexWriter flushed the documents to segments
in the commit.  This means that between the time that the commit data was
set on the IndexWriter and the time that the IndexWriter completes the commit,
documents with higher sequence numbers could have entered the commit.
Hence, we would use FieldStats on the _seq_no field in the documents to get
the maximum sequence number value, but this suffers the drawback that if the
last sequence number in the commit corresponded to a delete document action,
that sequence number would not show up in FieldStats as there would be no
corresponding document in Lucene.

In Lucene 6.2, the commit data was changed to take an Iterable interface, so
that the commit data can be calculated and retrieved *after* all documents
have been flushed, while the commit data itself is being set on the Lucene commit.
This commit changes max_seq_no so it is stored in the commit data instead of
being calculated from FieldStats, taking advantage of the deferred calculation
of the max_seq_no through passing an Iterable that dynamically sets the iterator
data.

* improvements to iterating over commit data (and better safety guarantees)

* Adds sequence number and checkpoint testing for document deletion
intertwined with document indexing.

* improve test code slightly

* Remove caching of max_seq_no in commit data iterator and inline logging

* Adds a test for concurrently indexing and committing segments
to Lucene, ensuring the sequence number related commit data
in each Lucene commit point matches the invariants of
localCheckpoint <= highest sequence number in commit <= maxSeqNo

* fix comments

* addresses code review

* adds clarification on checking commit data on recovery from translog

* remove unneeded method

time:
2016-10-12T15:49:24Z
class:
core/src/main/java/org/elasticsearch/Version.java
core/src/test/java/org/elasticsearch/VersionTests.java
comments:
Explain how unreleased versions should be added to the codebase without adding it to Version.java (#20892)

Sometimes it's useful / needed to use unreleased Version constants but we should not add those to the Version.java class for several reasons ie. BWC tests and assertions along those lines. Yet, it's not really obvious how to do that so I added some comments and a simple test for this.

time:
2016-10-12T15:09:34Z
class:
comments:
Docs: your -> you're (#20883)

time:
2016-10-12T14:57:11Z
class:
core/src/test/java/org/elasticsearch/search/query/MultiMatchQueryIT.java
comments:
Merge pull request #20673

Add test for using fuzziness parameter in multi_match query

time:
2016-10-12T13:55:30Z
class:
core/src/test/java/org/elasticsearch/search/query/MultiMatchQueryIT.java
comments:
Add test for using fuzziness parameter in multi_match query

There was an issue with using fuzziness parameter in multi_match query that has
been reported in #18710 and was fixed in Lucene 6.2 that is now used on master.
In order to verify that fix and close the original issue this PR adds the test
from that issue as an integration test.

time:
2016-10-12T13:38:29Z
class:
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
comments:
Fix typos in Javadoc in IndexShard.java

This commit fixes two typos on the Javadoc for
IndexShard#updateGlobalCheckpointOnPrimary.

time:
2016-10-12T13:31:00Z
class:
core/src/test/java/org/elasticsearch/indexing/IndexActionIT.java
comments:
improve testAutoGenerateIdNoDuplicates logging on failure

Add unique doc content and log the results of the search results on failure, so we can better see what went wrong

time:
2016-10-12T12:49:01Z
class:
comments:
Made REST query param types consistent

text -> string

time:
2016-10-12T12:42:19Z
class:
comments:
Made REST query param types consistent

duration -> time
integer,float -> number

time:
2016-10-12T12:20:41Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataDeleteIndexService.java
comments:
Use Arrays.toString to stringify a String[]

time:
2016-10-12T11:03:40Z
class:
test/framework/src/main/java/org/elasticsearch/common/util/MockBigArrays.java
comments:
MockBigArrays should tell you who originally released them

time:
2016-10-12T10:53:15Z
class:
core/src/main/java/org/elasticsearch/common/lease/Releasables.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/test/java/org/elasticsearch/common/ReleasablesTests.java
comments:
Prevent double release in TcpTransport if send listener throws an exception (#20880)

today we might release a bytes array more than once if the send listener
throws an exception but already has released the array. Yet, this is already fixed
in the BytesArray class we use in production to ensure 3rd party users don't release
twice but our mocks still enforce it.

time:
2016-10-12T08:28:33Z
class:
core/src/main/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGeneratorBuilder.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGeneratorTests.java
comments:
Merge pull request #20873: Use ConstructingObjectParser with DirectCandidateGeneratorBuilder

Use ConstructingObjectParser for parsing DirectCandidateGenerator

time:
2016-10-12T08:27:09Z
class:
core/src/main/java/org/apache/lucene/queryparser/classic/ExistsFieldQueryExtension.java
core/src/main/java/org/apache/lucene/queryparser/classic/FieldQueryExtension.java
core/src/main/java/org/apache/lucene/search/vectorhighlight/CustomFieldQuery.java
core/src/main/java/org/apache/lucene/store/StoreRateLimiting.java
core/src/main/java/org/apache/lucene/store/StoreUtils.java
core/src/main/java/org/elasticsearch/ElasticsearchParseException.java
core/src/main/java/org/elasticsearch/ElasticsearchWrapperException.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/ActionRequest.java
core/src/main/java/org/elasticsearch/action/ActionRequestBuilder.java
core/src/main/java/org/elasticsearch/action/FailedNodeException.java
core/src/main/java/org/elasticsearch/action/NoShardAvailableActionException.java
core/src/main/java/org/elasticsearch/action/NoSuchNodeException.java
core/src/main/java/org/elasticsearch/action/PrimaryMissingActionException.java
core/src/main/java/org/elasticsearch/action/RoutingMissingException.java
core/src/main/java/org/elasticsearch/action/ThreadingModel.java
core/src/main/java/org/elasticsearch/action/TimestampParsingException.java
core/src/main/java/org/elasticsearch/action/UnavailableShardsException.java
core/src/main/java/org/elasticsearch/action/ValidateActions.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/hotthreads/NodeHotThreads.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/hotthreads/NodesHotThreadsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/hotthreads/NodesHotThreadsRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/hotthreads/NodesHotThreadsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/hotthreads/NodesHotThreadsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/hotthreads/TransportNodesHotThreadsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/info/TransportNodesInfoAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodesStatsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodesStatsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodesStatsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/TransportNodesStatsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/list/TransportListTasksAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/reroute/TransportClusterRerouteAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/settings/ClusterUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsGroup.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/TransportClusterSearchShardsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/SnapshotIndexShardStage.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/SnapshotIndexShardStatus.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/SnapshotStats.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/TransportSnapshotsStatusAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/state/TransportClusterStateAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/TransportClusterStatsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/DeleteStoredScriptAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/GetStoredScriptAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/PutStoredScriptAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/tasks/PendingClusterTasksAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/tasks/PendingClusterTasksRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/tasks/PendingClusterTasksRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/tasks/PendingClusterTasksResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/tasks/TransportPendingClusterTasksAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/IndicesAliasesAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/exists/AliasesExistAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/exists/AliasesExistRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/exists/AliasesExistResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/exists/TransportAliasesExistAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/get/BaseAliasesRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/get/TransportGetAliasesAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/ClearIndicesCacheAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/ClearIndicesCacheRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/cache/clear/ClearIndicesCacheRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/close/CloseIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/delete/DeleteIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/delete/DeleteIndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/exists/indices/IndicesExistsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/exists/indices/IndicesExistsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/exists/types/TypesExistsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/exists/types/TypesExistsRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/flush/FlushAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/flush/FlushRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportShardFlushAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/forcemerge/ForceMergeAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetFieldMappingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetMappingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetMappingsRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetMappingsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetMappingsResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/TransportGetFieldMappingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/TransportGetMappingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/open/OpenIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/segments/IndicesSegmentsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/segments/IndicesSegmentsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/segments/TransportIndicesSegmentsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/get/GetSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/get/GetSettingsRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/get/GetSettingsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/get/GetSettingsResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/get/TransportGetSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/put/TransportUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/put/UpdateSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/shrink/ShrinkAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndexShardStats.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndexStats.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/ShardStats.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/TransportIndicesStatsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/delete/DeleteIndexTemplateAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/delete/DeleteIndexTemplateRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/get/GetIndexTemplatesAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/get/GetIndexTemplatesRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/get/TransportGetIndexTemplatesAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/get/TransportUpgradeStatusAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/get/UpgradeStatusAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/get/UpgradeStatusRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/post/ShardUpgradeRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/post/ShardUpgradeResult.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/post/TransportUpgradeSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/post/UpgradeSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/QueryExplanation.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/TransportValidateQueryAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/ValidateQueryAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/ValidateQueryRequestBuilder.java
core/src/main/java/org/elasticsearch/action/bulk/BulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkShardRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkShardResponse.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/DeleteAction.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsAction.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsRequest.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsResponse.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsShardRequest.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsShardResponse.java
core/src/main/java/org/elasticsearch/action/get/GetAction.java
core/src/main/java/org/elasticsearch/action/get/MultiGetAction.java
core/src/main/java/org/elasticsearch/action/index/IndexAction.java
core/src/main/java/org/elasticsearch/action/search/ClearScrollAction.java
core/src/main/java/org/elasticsearch/action/search/ClearScrollRequest.java
core/src/main/java/org/elasticsearch/action/search/ClearScrollRequestBuilder.java
core/src/main/java/org/elasticsearch/action/search/ClearScrollResponse.java
core/src/main/java/org/elasticsearch/action/search/MultiSearchAction.java
core/src/main/java/org/elasticsearch/action/search/ParsedScrollId.java
core/src/main/java/org/elasticsearch/action/search/SearchAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollRequest.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchHelper.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java
core/src/main/java/org/elasticsearch/action/support/AbstractListenableActionFuture.java
core/src/main/java/org/elasticsearch/action/support/AdapterActionFuture.java
core/src/main/java/org/elasticsearch/action/support/DefaultShardOperationFailedException.java
core/src/main/java/org/elasticsearch/action/support/PlainActionFuture.java
core/src/main/java/org/elasticsearch/action/support/TransportAction.java
core/src/main/java/org/elasticsearch/action/support/broadcast/BroadcastOperationRequestBuilder.java
core/src/main/java/org/elasticsearch/action/support/broadcast/BroadcastRequest.java
core/src/main/java/org/elasticsearch/action/support/broadcast/BroadcastShardRequest.java
core/src/main/java/org/elasticsearch/action/support/broadcast/BroadcastShardResponse.java
core/src/main/java/org/elasticsearch/action/support/broadcast/TransportBroadcastAction.java
core/src/main/java/org/elasticsearch/action/support/master/info/ClusterInfoRequest.java
core/src/main/java/org/elasticsearch/action/support/master/info/ClusterInfoRequestBuilder.java
core/src/main/java/org/elasticsearch/action/support/master/info/TransportClusterInfoAction.java
core/src/main/java/org/elasticsearch/action/support/nodes/BaseNodeRequest.java
core/src/main/java/org/elasticsearch/action/support/nodes/BaseNodesRequest.java
core/src/main/java/org/elasticsearch/action/support/nodes/BaseNodesResponse.java
core/src/main/java/org/elasticsearch/action/support/nodes/NodesOperationRequestBuilder.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationRequestBuilder.java
core/src/main/java/org/elasticsearch/action/support/single/instance/InstanceShardOperationRequest.java
core/src/main/java/org/elasticsearch/action/support/single/instance/InstanceShardOperationRequestBuilder.java
core/src/main/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationAction.java
core/src/main/java/org/elasticsearch/action/support/single/shard/SingleShardOperationRequestBuilder.java
core/src/main/java/org/elasticsearch/action/support/single/shard/SingleShardRequest.java
core/src/main/java/org/elasticsearch/action/termvectors/MultiTermVectorsAction.java
core/src/main/java/org/elasticsearch/action/termvectors/TermVectorsAction.java
core/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/client/support/AbstractClient.java
core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java
core/src/main/java/org/elasticsearch/client/transport/support/TransportProxyClient.java
core/src/main/java/org/elasticsearch/cluster/action/index/NodeMappingRefreshAction.java
core/src/main/java/org/elasticsearch/cluster/block/ClusterBlock.java
core/src/main/java/org/elasticsearch/cluster/block/ClusterBlockException.java
core/src/main/java/org/elasticsearch/cluster/block/ClusterBlockLevel.java
core/src/main/java/org/elasticsearch/cluster/health/ClusterHealthStatus.java
core/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/ProcessClusterEventTimeoutException.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodeFilters.java
core/src/main/java/org/elasticsearch/cluster/service/PendingClusterTask.java
core/src/main/java/org/elasticsearch/common/Booleans.java
core/src/main/java/org/elasticsearch/common/Classes.java
core/src/main/java/org/elasticsearch/common/Strings.java
core/src/main/java/org/elasticsearch/common/blobstore/BlobStoreException.java
core/src/main/java/org/elasticsearch/common/blobstore/fs/FsBlobStore.java
core/src/main/java/org/elasticsearch/common/blobstore/support/PlainBlobMetaData.java
core/src/main/java/org/elasticsearch/common/collect/HppcMaps.java
core/src/main/java/org/elasticsearch/common/collect/MapBuilder.java
core/src/main/java/org/elasticsearch/common/collect/Tuple.java
core/src/main/java/org/elasticsearch/common/component/AbstractLifecycleComponent.java
core/src/main/java/org/elasticsearch/common/component/LifecycleComponent.java
core/src/main/java/org/elasticsearch/common/component/LifecycleListener.java
core/src/main/java/org/elasticsearch/common/compress/Compressor.java
core/src/main/java/org/elasticsearch/common/compress/CompressorFactory.java
core/src/main/java/org/elasticsearch/common/geo/GeoPoint.java
core/src/main/java/org/elasticsearch/common/geo/GeoUtils.java
core/src/main/java/org/elasticsearch/common/geo/ShapesAvailability.java
core/src/main/java/org/elasticsearch/common/geo/SpatialStrategy.java
core/src/main/java/org/elasticsearch/common/io/FastCharArrayReader.java
core/src/main/java/org/elasticsearch/common/io/UTF8StreamWriter.java
core/src/main/java/org/elasticsearch/common/io/stream/ByteBufferStreamInput.java
core/src/main/java/org/elasticsearch/common/io/stream/DataOutputStreamOutput.java
core/src/main/java/org/elasticsearch/common/io/stream/InputStreamStreamInput.java
core/src/main/java/org/elasticsearch/common/io/stream/OutputStreamStreamOutput.java
core/src/main/java/org/elasticsearch/common/joda/Joda.java
core/src/main/java/org/elasticsearch/common/lucene/BytesRefs.java
core/src/main/java/org/elasticsearch/common/lucene/Lucene.java
core/src/main/java/org/elasticsearch/common/lucene/MinimumScoreCollector.java
core/src/main/java/org/elasticsearch/common/lucene/ScorerAware.java
core/src/main/java/org/elasticsearch/common/lucene/all/AllEntries.java
core/src/main/java/org/elasticsearch/common/lucene/all/AllTokenStream.java
core/src/main/java/org/elasticsearch/common/lucene/search/FilteredCollector.java
core/src/main/java/org/elasticsearch/common/lucene/search/MoreLikeThisQuery.java
core/src/main/java/org/elasticsearch/common/lucene/search/Queries.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/ScoreFunction.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/WeightFactorFunction.java
core/src/main/java/org/elasticsearch/common/lucene/store/InputStreamIndexInput.java
core/src/main/java/org/elasticsearch/common/metrics/CounterMetric.java
core/src/main/java/org/elasticsearch/common/metrics/MeanMetric.java
core/src/main/java/org/elasticsearch/common/metrics/Metric.java
core/src/main/java/org/elasticsearch/common/network/NetworkService.java
core/src/main/java/org/elasticsearch/common/recycler/NoneRecycler.java
core/src/main/java/org/elasticsearch/common/regex/Regex.java
core/src/main/java/org/elasticsearch/common/rounding/DateTimeUnit.java
core/src/main/java/org/elasticsearch/common/transport/NetworkExceptionHelper.java
core/src/main/java/org/elasticsearch/common/transport/PortsRange.java
core/src/main/java/org/elasticsearch/common/unit/SizeUnit.java
core/src/main/java/org/elasticsearch/common/util/ArrayUtils.java
core/src/main/java/org/elasticsearch/common/util/Callback.java
core/src/main/java/org/elasticsearch/common/util/concurrent/ConcurrentCollections.java
core/src/main/java/org/elasticsearch/common/util/concurrent/ConcurrentHashMapLong.java
core/src/main/java/org/elasticsearch/common/util/concurrent/ConcurrentMapLong.java
core/src/main/java/org/elasticsearch/common/util/concurrent/EsAbortPolicy.java
core/src/main/java/org/elasticsearch/common/util/concurrent/EsRejectedExecutionException.java
core/src/main/java/org/elasticsearch/common/util/concurrent/FutureUtils.java
core/src/main/java/org/elasticsearch/common/util/concurrent/PrioritizedCallable.java
core/src/main/java/org/elasticsearch/common/util/concurrent/PrioritizedRunnable.java
core/src/main/java/org/elasticsearch/common/util/concurrent/UncategorizedExecutionException.java
core/src/main/java/org/elasticsearch/common/util/concurrent/XRejectedExecutionHandler.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentHelper.java
core/src/main/java/org/elasticsearch/common/xcontent/cbor/CborXContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/smile/SmileXContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/support/AbstractXContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/support/XContentMapValues.java
core/src/main/java/org/elasticsearch/common/xcontent/yaml/YamlXContentParser.java
core/src/main/java/org/elasticsearch/discovery/MasterNotDiscoveredException.java
core/src/main/java/org/elasticsearch/discovery/local/LocalDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/DiscoveryNodesProvider.java
core/src/main/java/org/elasticsearch/discovery/zen/ElectMasterService.java
core/src/main/java/org/elasticsearch/discovery/zen/membership/MembershipAction.java
core/src/main/java/org/elasticsearch/discovery/zen/ping/PingContextProvider.java
core/src/main/java/org/elasticsearch/discovery/zen/ping/unicast/UnicastZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/publish/PublishClusterStateAction.java
core/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java
core/src/main/java/org/elasticsearch/gateway/GatewayException.java
core/src/main/java/org/elasticsearch/gateway/GatewayModule.java
core/src/main/java/org/elasticsearch/gateway/GatewayService.java
core/src/main/java/org/elasticsearch/gateway/LocalAllocateDangledIndices.java
core/src/main/java/org/elasticsearch/gateway/ReplicaShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/TransportNodesListGatewayMetaState.java
core/src/main/java/org/elasticsearch/http/BindHttpException.java
core/src/main/java/org/elasticsearch/http/HttpException.java
core/src/main/java/org/elasticsearch/http/HttpServerAdapter.java
core/src/main/java/org/elasticsearch/index/IndexComponent.java
core/src/main/java/org/elasticsearch/index/IndexShardAlreadyExistsException.java
comments:
Remove empty javadoc (#20871)

This commit removes as many as empty javadocs comments my regexp has found

time:
2016-10-12T07:06:37Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/TransportRestoreSnapshotAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataDeleteIndexService.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationService.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RoutingAllocation.java
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/main/java/org/elasticsearch/snapshots/RestoreService.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesServiceTests.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/mockstore/MockRepository.java
comments:
Keep snapshot restore state and routing table in sync (#20836)

The snapshot restore state tracks information about shards being restored from a snapshot in the cluster state. For example it records if a shard has been successfully restored or if restoring it was not possible due to a corruption of the snapshot. Recording these events is usually based on changes to the shard routing table, i.e., when a shard is started after a successful restore or failed after an unsuccessful one. As of now, there were two communication channels to transmit recovery failure / success to update the routing table and the restore state. This lead to issues where a shard was failed but the restore state was not updated due to connection issues between data and master node. In some rare situations, this lead to an issue where the restore state could not be properly cleaned up anymore by the master, making it impossible to start new restore operations. The following change updates routing table and restore state in the same cluster state update so that both always stay in sync. It also eliminates the extra communication channel for restore operations and uses standard cluster state listener mechanism to update restore listener upon successful
completion of a snapshot.

time:
2016-10-11T21:44:50Z
class:
comments:
Don't mind pending cluster tasks in docs build

This removes an assertion that the cluster doesn't have any
pending cluster state tasks from the `_cat/health` docs.

Relates to #18160

time:
2016-10-11T20:59:04Z
class:
core/src/test/java/org/elasticsearch/search/geo/GeoDistanceIT.java
comments:
Fix imports in GeoDistanceIT

Wildcard imports are not allowed.

Relates to #20860

time:
2016-10-11T20:56:56Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/InternalGeoDistance.java
core/src/test/java/org/elasticsearch/search/geo/GeoDistanceIT.java
comments:
Fixed writeable name from range to geo_distance (#20860)

* Fixed writeable name from range to geo_distance

* Added testGeoDistanceAggregation

* Added asserts for correct result in testGeoDistanceAggregation

* Setup mapping on test index.

time:
2016-10-11T20:04:47Z
class:
benchmarks/src/main/java/org/elasticsearch/benchmark/routing/allocation/AllocationBenchmark.java
benchmarks/src/main/java/org/elasticsearch/benchmark/routing/allocation/Allocators.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/transport/TransportClientBenchmark.java
core/src/main/java/org/apache/logging/log4j/core/impl/ThrowableProxy.java
core/src/main/java/org/apache/logging/log4j/core/jmx/Server.java
core/src/main/java/org/apache/lucene/search/vectorhighlight/CustomFieldQuery.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/admin/cluster/settings/TransportClusterUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/explain/ExplainRequestBuilder.java
core/src/main/java/org/elasticsearch/action/get/GetRequestBuilder.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequest.java
core/src/main/java/org/elasticsearch/action/get/TransportMultiGetAction.java
core/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java
core/src/main/java/org/elasticsearch/bootstrap/JarHell.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolver.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexStateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodeFilters.java
core/src/main/java/org/elasticsearch/cluster/routing/OperationRouting.java
core/src/main/java/org/elasticsearch/cluster/routing/ShardRouting.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/IndexMetaDataUpdater.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/ShardAllocationDecision.java
core/src/main/java/org/elasticsearch/common/Table.java
core/src/main/java/org/elasticsearch/common/joda/DateMathParser.java
core/src/main/java/org/elasticsearch/common/logging/LogConfigurator.java
core/src/main/java/org/elasticsearch/common/lucene/all/AllTermQuery.java
core/src/main/java/org/elasticsearch/common/lucene/search/MatchNoDocsQuery.java
core/src/main/java/org/elasticsearch/common/lucene/search/Queries.java
core/src/main/java/org/elasticsearch/common/network/NetworkModule.java
core/src/main/java/org/elasticsearch/common/regex/Regex.java
core/src/main/java/org/elasticsearch/common/transport/BoundTransportAddress.java
core/src/main/java/org/elasticsearch/common/transport/InetSocketTransportAddress.java
core/src/main/java/org/elasticsearch/common/transport/LocalTransportAddress.java
core/src/main/java/org/elasticsearch/common/transport/TransportAddress.java
core/src/main/java/org/elasticsearch/common/transport/TransportAddressSerializers.java
core/src/main/java/org/elasticsearch/common/unit/ByteSizeUnit.java
core/src/main/java/org/elasticsearch/common/unit/ByteSizeValue.java
core/src/main/java/org/elasticsearch/common/unit/SizeValue.java
core/src/main/java/org/elasticsearch/common/unit/TimeValue.java
core/src/main/java/org/elasticsearch/common/util/AbstractArray.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentBuilder.java
core/src/main/java/org/elasticsearch/common/xcontent/support/XContentMapValues.java
core/src/main/java/org/elasticsearch/discovery/zen/NodeJoinController.java
core/src/main/java/org/elasticsearch/gateway/BaseGatewayShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/Gateway.java
core/src/main/java/org/elasticsearch/gateway/GatewayService.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/ReplicaShardAllocator.java
core/src/main/java/org/elasticsearch/index/IndexModule.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/NodeServicesProvider.java
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyDateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/MatchNoneQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
core/src/main/java/org/elasticsearch/index/search/MultiMatchQuery.java
core/src/main/java/org/elasticsearch/index/store/Store.java
core/src/main/java/org/elasticsearch/indices/IndicesModule.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySettings.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/ListPluginsCommand.java
core/src/main/java/org/elasticsearch/plugins/NetworkPlugin.java
core/src/main/java/org/elasticsearch/rest/action/cat/AbstractCatAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestNodeAttrsAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestNodesAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTable.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTasksAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestThreadPoolAction.java
core/src/main/java/org/elasticsearch/search/DocValueFormat.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/main/java/org/elasticsearch/search/fetch/FetchPhase.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/FetchSourceContext.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/FetchSourceSubPhase.java
core/src/main/java/org/elasticsearch/search/lookup/SourceLookup.java
core/src/main/java/org/elasticsearch/search/slice/SliceBuilder.java
core/src/main/java/org/elasticsearch/transport/ActionTransportException.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/main/java/org/elasticsearch/transport/TcpTransportChannel.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/main/java/org/elasticsearch/transport/Transports.java
core/src/main/java/org/elasticsearch/transport/local/LocalTransport.java
core/src/main/java/org/elasticsearch/transport/local/LocalTransportChannel.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplanationTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStatsTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TaskManagerTestCase.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TasksIT.java
core/src/test/java/org/elasticsearch/action/admin/indices/shards/IndicesShardStoreResponseTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/shrink/TransportShrinkActionTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/template/put/MetaDataIndexTemplateServiceTests.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionTookTests.java
core/src/test/java/org/elasticsearch/action/ingest/IngestProxyActionFilterTests.java
core/src/test/java/org/elasticsearch/action/main/MainActionTests.java
core/src/test/java/org/elasticsearch/action/search/TransportMultiSearchActionTests.java
core/src/test/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeActionTests.java
core/src/test/java/org/elasticsearch/action/support/master/IndexingMasterFailoverIT.java
core/src/test/java/org/elasticsearch/action/support/master/TransportMasterNodeActionTests.java
core/src/test/java/org/elasticsearch/action/support/nodes/TransportNodesActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/BroadcastReplicationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/ClusterStateCreationUtils.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationActionTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapCheckTests.java
core/src/test/java/org/elasticsearch/bootstrap/JarHellTests.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientHeadersTests.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientIT.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientNodesServiceTests.java
core/src/test/java/org/elasticsearch/cluster/ClusterChangedEventTests.java
core/src/test/java/org/elasticsearch/cluster/ClusterStateDiffIT.java
core/src/test/java/org/elasticsearch/cluster/ClusterStateTests.java
core/src/test/java/org/elasticsearch/cluster/DiskUsageTests.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/NoMasterNodeIT.java
core/src/test/java/org/elasticsearch/cluster/NodeConnectionsServiceTests.java
core/src/test/java/org/elasticsearch/cluster/SpecificMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/action/shard/ShardStateActionTests.java
core/src/test/java/org/elasticsearch/cluster/health/ClusterStateHealthTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexServiceTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesServiceTests.java
core/src/test/java/org/elasticsearch/cluster/node/DiscoveryNodeFiltersTests.java
core/src/test/java/org/elasticsearch/cluster/node/DiscoveryNodesTests.java
core/src/test/java/org/elasticsearch/cluster/routing/AllocationIdTests.java
core/src/test/java/org/elasticsearch/cluster/routing/PrimaryAllocationIT.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/NodeVersionAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/SameShardRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/ShardAllocationDecisionTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDeciderUnitTests.java
core/src/test/java/org/elasticsearch/cluster/serialization/ClusterSerializationTests.java
core/src/test/java/org/elasticsearch/cluster/serialization/ClusterStateToStringTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceIT.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
core/src/test/java/org/elasticsearch/cluster/structure/RoutingIteratorTests.java
core/src/test/java/org/elasticsearch/common/TableTests.java
core/src/test/java/org/elasticsearch/common/joda/DateMathParserTests.java
core/src/test/java/org/elasticsearch/common/lucene/search/MatchNoDocsQueryTests.java
core/src/test/java/org/elasticsearch/common/network/NetworkModuleTests.java
core/src/test/java/org/elasticsearch/common/transport/BoundTransportAddressTests.java
core/src/test/java/org/elasticsearch/common/unit/ByteSizeValueTests.java
core/src/test/java/org/elasticsearch/common/unit/SizeValueTests.java
core/src/test/java/org/elasticsearch/common/unit/TimeValueTests.java
core/src/test/java/org/elasticsearch/common/util/BigArraysTests.java
core/src/test/java/org/elasticsearch/common/xcontent/BaseXContentTestCase.java
core/src/test/java/org/elasticsearch/common/xcontent/support/XContentMapValuesTests.java
core/src/test/java/org/elasticsearch/discovery/BlockingClusterStatePublishResponseHandlerTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/discovery/ZenFaultDetectionTests.java
core/src/test/java/org/elasticsearch/discovery/ZenUnicastDiscoveryIT.java
core/src/test/java/org/elasticsearch/discovery/zen/ElectMasterServiceTests.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeJoinControllerTests.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeRemovalClusterStateTaskExecutorTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryIT.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenPingTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ping/unicast/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/discovery/zen/publish/PendingClusterStatesQueueTests.java
core/src/test/java/org/elasticsearch/discovery/zen/publish/PublishClusterStateActionTests.java
core/src/test/java/org/elasticsearch/gateway/AsyncShardFetchTests.java
core/src/test/java/org/elasticsearch/gateway/GatewayServiceTests.java
core/src/test/java/org/elasticsearch/http/HttpServerTests.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java
core/src/test/java/org/elasticsearch/index/TransportIndexFailuresIT.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/DoubleIndexingDocTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingDisabledTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyDateFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyDateFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/query/DisMaxQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/ExistsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/IdsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/InnerHitBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchNoneQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchPhrasePrefixQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchPhraseQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MultiMatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/RangeQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/ScriptQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/TermsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/search/MultiMatchQueryTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/indices/IndexingMemoryControllerTests.java
core/src/test/java/org/elasticsearch/indices/IndicesLifecycleListenerSingleNodeTests.java
core/src/test/java/org/elasticsearch/indices/cluster/AbstractIndicesClusterStateServiceTestCase.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
core/src/test/java/org/elasticsearch/indices/memory/breaker/CircuitBreakerServiceIT.java
core/src/test/java/org/elasticsearch/indices/recovery/IndexRecoveryIT.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySettingsDynamicUpdateTests.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySourceHandlerTests.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoveryStatusTests.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoveryTargetTests.java
core/src/test/java/org/elasticsearch/indices/recovery/StartRecoveryRequestTests.java
core/src/test/java/org/elasticsearch/indices/state/RareClusterStateIT.java
core/src/test/java/org/elasticsearch/indices/store/IndicesStoreTests.java
core/src/test/java/org/elasticsearch/ingest/PipelineStoreTests.java
core/src/test/java/org/elasticsearch/mget/SimpleMgetIT.java
core/src/test/java/org/elasticsearch/nodesinfo/NodeInfoStreamingTests.java
core/src/test/java/org/elasticsearch/recovery/RecoverySettingsTests.java
core/src/test/java/org/elasticsearch/recovery/TruncatedRecoveryIT.java
core/src/test/java/org/elasticsearch/rest/action/cat/RestTableTests.java
core/src/test/java/org/elasticsearch/search/AbstractSearchTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramOffsetIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/ExtendedBoundsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/InnerHitsIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java
core/src/test/java/org/elasticsearch/search/slice/SliceBuilderTests.java
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/transport/TransportServiceHandshakeTests.java
core/src/test/java/org/elasticsearch/transport/local/SimpleLocalTransportTests.java
core/src/test/java/org/elasticsearch/tribe/TribeIT.java
comments:
Merge branch 'master' into cleanup/transport_bulk

time:
2016-10-11T20:00:10Z
class:
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/RestNoopBulkAction.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/TransportNoopBulkAction.java
core/src/main/java/org/elasticsearch/action/DocWriteRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/DeleteRequest.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/index/IndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/ingest/IngestActionFilter.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/index/mapper/Uid.java
core/src/main/java/org/elasticsearch/ingest/PipelineExecutionService.java
core/src/test/java/org/elasticsearch/action/bulk/BulkRequestTests.java
core/src/test/java/org/elasticsearch/action/bulk/BulkWithUpdatesIT.java
core/src/test/java/org/elasticsearch/action/bulk/RetryTests.java
core/src/test/java/org/elasticsearch/action/index/IndexRequestTests.java
core/src/test/java/org/elasticsearch/action/ingest/BulkRequestModifierTests.java
core/src/test/java/org/elasticsearch/action/ingest/IngestActionFilterTests.java
core/src/test/java/org/elasticsearch/document/DocumentActionsIT.java
core/src/test/java/org/elasticsearch/ingest/PipelineExecutionServiceTests.java
core/src/test/java/org/elasticsearch/routing/SimpleRoutingIT.java
core/src/test/java/org/elasticsearch/versioning/SimpleVersioningIT.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractAsyncBulkIndexByScrollAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AsyncBulkByScrollActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFailureTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexVersioningTests.java
comments:
rename DocumentRequest to DocWriteRequest

time:
2016-10-11T19:58:36Z
class:
core/src/main/java/org/elasticsearch/action/bulk/BulkItemRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/ingest/IngestActionFilter.java
core/src/main/java/org/elasticsearch/ingest/PipelineExecutionService.java
core/src/test/java/org/elasticsearch/action/bulk/BulkRequestTests.java
comments:
change DocumentRequest<?> to DocumentRequest for readibility

time:
2016-10-11T19:17:47Z
class:
core/src/main/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGeneratorBuilder.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGeneratorTests.java
comments:
Use ConstructingObjectParser for parsing DirectCandidateGenerator

When refactoring DirectCandidateGeneratorBuilder recently, the
ConstructingObjectParser that we have today was not available. Instead we used
some workaround, but it is better to remove this now and use
ConstructingObjectParser instead.

time:
2016-10-11T18:55:37Z
class:
comments:
CONSOLEify _cat/indices docs

Relates to #18160
Uses the new sorting (#20658) in the `_cat` API to support all use
cases natively. We can still resort to piping things through `sort`
if we need to, but we don't have to for basic stuff like sorting!

time:
2016-10-11T18:21:09Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
comments:
fix update operation in bulk execution

time:
2016-10-11T17:53:11Z
class:
comments:
[DOCS] Fix typo in "Cluster Health" part (#20864)

Replace "we can see and total of ..." by "we can see a total of ..."

time:
2016-10-11T17:21:32Z
class:
comments:
[DOCS] Remove documentation for `force` version-type

This option should not be recommended to anyone, and should never be
used, upon chance of primary/replica divergence.

Relates to #19769

time:
2016-10-11T16:29:55Z
class:
core/src/main/java/org/elasticsearch/rest/action/cat/AbstractCatAction.java
comments:
Add `s` to _cat response parameters

`s` is used for sorting!

Relates to #20658

time:
2016-10-11T16:29:22Z
class:
core/src/main/java/org/elasticsearch/common/Table.java
core/src/main/java/org/elasticsearch/common/unit/ByteSizeUnit.java
core/src/main/java/org/elasticsearch/common/unit/ByteSizeValue.java
core/src/main/java/org/elasticsearch/common/unit/SizeValue.java
core/src/main/java/org/elasticsearch/common/unit/TimeValue.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTable.java
core/src/test/java/org/elasticsearch/common/TableTests.java
core/src/test/java/org/elasticsearch/common/unit/ByteSizeValueTests.java
core/src/test/java/org/elasticsearch/common/unit/SizeValueTests.java
core/src/test/java/org/elasticsearch/common/unit/TimeValueTests.java
core/src/test/java/org/elasticsearch/rest/action/cat/RestTableTests.java
comments:
Adding built-in sorting capability to _cat apis. (#20658)

* Adding built-in sorting capability to _cat apis.

Closes #16975

* addressing pr comments

* changing value types back to original implementation and fixing cosmetic issues

* Changing compareTo, hashCode of value types to a better implementation

* Changed value compareTos to use Double.compare instead of if statements + fixed some failed unit tests

time:
2016-10-11T16:07:39Z
class:
core/src/main/java/org/elasticsearch/action/get/TransportMultiGetAction.java
comments:
MultiGet should not fail entirely if alias resolves to many indices (#20858)

MultiGet should not fail entirely when one of the items of a multi get request refers to an alias that points to multiple indices.

closes #20845

time:
2016-10-11T15:59:06Z
class:
core/src/main/java/org/elasticsearch/plugins/ListPluginsCommand.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/ListPluginsCommandTests.java
comments:
Revert "Display plugins versions"

This reverts commit 9411f18f27a023b28f28aaa6af904bc519cca8fa.

Relates #20807

time:
2016-10-11T15:57:15Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/ShardRouting.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/IndexMetaDataUpdater.java
core/src/test/java/org/elasticsearch/cluster/routing/AllocationIdTests.java
comments:
Keep a shadow replicas' allocation id when it is promoted to primary (#20863)

Shadow replicas can not be simply promoted to primary by updating boolean like normal shards. Instead the are reinitialized and shut down and rebuilt as primaries. Currently we also given them new allocation ids but that throws off the in-sync allocation ids management. This commit changes this behavior to keep the allocation id of the shard.

Closes #20650

time:
2016-10-11T15:18:52Z
class:
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3RepositoryTests.java
comments:
Fixes leading forward slash in S3 repository base_path (#20861)

In 2.x, the S3 repository accepted a `/` (forward slash) to start
the repositories.s3.base_path, and it used a different string splitting
method that removed the forward slash from the base path, so there
were no issues.

In 5.x, we removed this custom string splitting method in favor of
the JDK's string splitting method, which preserved the leading `/`.
The AWS SDK does not like the leading `/` in the key path after the
bucket name, and so it could not find any objects in the S3 repository.

This commit fixes the issue by removing the leading `/` if it exists
and adding a deprecation notice that leading `/` will not be supported
in the future in S3 repository's base_path.

time:
2016-10-11T13:30:38Z
class:
core/src/main/java/org/elasticsearch/action/explain/ExplainRequestBuilder.java
core/src/main/java/org/elasticsearch/action/get/GetRequestBuilder.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/common/xcontent/support/XContentMapValues.java
core/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/main/java/org/elasticsearch/search/fetch/FetchPhase.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/FetchSourceContext.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/FetchSourceSubPhase.java
core/src/main/java/org/elasticsearch/search/lookup/SourceLookup.java
core/src/test/java/org/elasticsearch/index/query/InnerHitBuilderTests.java
core/src/test/java/org/elasticsearch/mget/SimpleMgetIT.java
core/src/test/java/org/elasticsearch/search/AbstractSearchTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/InnerHitsIT.java
comments:
Ensure source filtering automatons are only compiled once (#20857)

This change adds a overloaded `XContentMapValues#filter` method that returns
a function enclosing the compiled automatons that can be reused across filter
calls. This for instance prevents compiling automatons over and over again when
hits are filtered or in the SourceFieldMapper for each document.

Closes #20839

time:
2016-10-11T12:58:51Z
class:
comments:
Fix docs build

Removes a non-existant file from the non-`// CONSOLE` list. If you
remove all the non-`// CONSOLE` snippets from a file it must be
removed from the whitelist for the build to pass. Removing the file
entirely counts as removing the snippets.

Related to #18160

time:
2016-10-11T11:13:03Z
class:
comments:
Document the ctx._now variable in the update API

Relates to #20835

time:
2016-10-11T10:39:02Z
class:
comments:
Add an indices-upgrade section to the docs redirects.

time:
2016-10-11T10:21:46Z
class:
comments:
Removed the upgrade API docs

Relates to #20675

time:
2016-10-11T10:14:35Z
class:
comments:
Added upgrade docs explaining how to reindex in place or reindex from remote

Closes #20675

time:
2016-10-11T09:41:54Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/XContentBuilder.java
core/src/test/java/org/elasticsearch/common/xcontent/BaseXContentTestCase.java
comments:
XContentBuilder: Avoid building self-referencing objects (#20550)

Some objects like maps, iterables or arrays of objects can self-reference themselves. This is mostly due to a bug in code but the XContentBuilder should be able to detect such situations and throws an IllegalArgumentException instead of building objects over and over until a stackoverflow occurs.

closes #20540
closes #19475

time:
2016-10-11T08:44:16Z
class:
core/src/test/java/org/elasticsearch/indices/memory/breaker/CircuitBreakerServiceIT.java
comments:
add promised comment to testCanResetUnreasonableSettings

it got lost in a broken git song and dance.

time:
2016-10-11T08:36:55Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/settings/TransportClusterUpdateSettingsAction.java
core/src/test/java/org/elasticsearch/indices/memory/breaker/CircuitBreakerServiceIT.java
comments:
Cluster Settings Updates should not trigger circuit breakers. (#20827)

Settings updates are important to be able to help and administer a cluster in distress. We shouldn't block it due to circuit breakers. An extreme example is where we are actually trying to increase and unreasonable low setting for the circuit breaker itself.

See https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+g1gc/242/

time:
2016-10-11T08:35:47Z
class:
core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java
comments:
log debug in testShadowReplicaNaturalRelocation

time:
2016-10-11T07:17:21Z
class:
core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java
core/src/test/java/org/elasticsearch/index/query/ScriptQueryBuilderTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
comments:
Do not cache script queries. (#20799)

The cache relies on the equals() method so we just need to make sure script
queries can never be equals, even to themselves in the case that a weight
is used to produce a Scorer on the same segment multiple times.

Closes #20763

time:
2016-10-11T06:59:45Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
Added version 5.0.0-rc2

time:
2016-10-10T21:47:35Z
class:
comments:
Enable incremental compilation in gradle (#20847)

time:
2016-10-10T20:51:47Z
class:
comments:
Fixed typos (#20843)

time:
2016-10-10T20:22:48Z
class:
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
comments:
Handle rejected pings on shutdown gracefully (#20842)

`TcpTransport.ScheduledPing` doesn't handle rejected exceutions gracefully
if the executor is shutting down. This change adds correct exception handling
if we try to schedule another ping while the node is shutting down.

time:
2016-10-10T19:14:14Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
comments:
Expose `ctx._now` in update scripts (#20835)

Update scripts might want to update the documents `_timestamp` but need a notion of `now()`.
Painless doesn't support any notion of now() since it would make scripts non-pure functions. Yet,
in the update case this is a valid value and we can pass it with the context together to allow the
script to record the timestamp the document was updated.

Relates to #17895

time:
2016-10-10T15:46:19Z
class:
core/src/main/java/org/apache/lucene/search/vectorhighlight/CustomFieldQuery.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java
comments:
Handle SynonymQuery extraction for the FastVectorHighlighter (#20829)

SynonymQuery was ignored by the FastVectorHighlighter.
This change adds the support for SynonymQuery in the FVH.
Although this change should be implemented in Lucene directly which is why https://issues.apache.org/jira/browse/LUCENE-7484 has been opened.
In the meantime this PR handles the issue on ES side and could be removed when LUCENE-7484 gets merged.

Fixes #20781

time:
2016-10-10T15:45:19Z
class:
core/src/main/java/org/elasticsearch/common/lucene/search/MatchNoDocsQuery.java
core/src/main/java/org/elasticsearch/common/lucene/search/Queries.java
core/src/main/java/org/elasticsearch/index/query/MatchNoneQueryBuilder.java
core/src/main/java/org/elasticsearch/index/search/MultiMatchQuery.java
core/src/main/java/org/elasticsearch/search/slice/SliceBuilder.java
core/src/test/java/org/elasticsearch/common/lucene/search/MatchNoDocsQueryTests.java
core/src/test/java/org/elasticsearch/index/query/DisMaxQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/ExistsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/IdsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchNoneQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchPhrasePrefixQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchPhraseQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MultiMatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/TermsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/slice/SliceBuilderTests.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolatorFieldMapper.java
modules/percolator/src/main/java/org/elasticsearch/percolator/QueryAnalyzer.java
modules/percolator/src/test/java/org/elasticsearch/percolator/CandidateQueryTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolateQueryTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/QueryAnalyzerTests.java
comments:
Replace org.elasticsearch.common.lucene.search.MatchNoDocsQuery with its Lucene version (org.apache.lucene.search.MatchNoDocsQuery) (#20832)

* Replace org.elasticsearch.common.lucene.search.MatchNoDocsQuery with its Lucene version (org.apache.lucene.search.MatchNoDocsQuery)

This change removes the ES version of the match no docs query and replaces it with the Lucene version.

relates #18030

* Add missing change

time:
2016-10-10T15:30:37Z
class:
core/src/main/java/org/elasticsearch/common/util/AbstractArray.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/main/java/org/elasticsearch/transport/TcpTransportChannel.java
core/src/test/java/org/elasticsearch/common/util/BigArraysTests.java
modules/transport-netty3/src/main/java/org/elasticsearch/transport/netty3/Netty3Transport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
comments:
Prevent AbstractArrays from release bytes more than once (#20819)

Today we throw an assertion error if we release an AbstractArray more than once.
Yet, it's recommended to implement close methods such that they can be invoked
more than once. Guaranteed single release calls are hard to implement and some
situations might not be tested causing for instance `CircuitBreaker` to operate on
corrupted memory stats.

time:
2016-10-10T12:56:44Z
class:
benchmarks/src/main/java/org/elasticsearch/benchmark/routing/allocation/AllocationBenchmark.java
comments:
Use 'pipe' instead of of 'comma' to separate benchmark params

With this commit we separate benchmark parameters with pipe symbols
instead of commas as JMH has a special formatting logic for comma-separated
string which messes up the JSON output of microbenchmarks.

time:
2016-10-10T12:54:35Z
class:
comments:
Tests: Fix ingest-attachment vagrant tests

The vagrant tests are checking for a certain jar version.

Relates #20710

time:
2016-10-10T12:47:25Z
class:
comments:
Reword note about windows and FDs

Make it clear why this isn't a thing in windows and remove value
judgement about file descriptors.

Relates to #20737

time:
2016-10-10T10:55:05Z
class:
plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java
comments:
Deps: Update ingest-attachment to latest libraries (#20710)

Also added a test to check for a with a regular PDF,
instead of only an encrypted one with expected exception.

time:
2016-10-10T08:53:17Z
class:
core/src/test/java/org/elasticsearch/index/query/RangeQueryBuilderTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
comments:
[TEST] reformatted comment in query tests

time:
2016-10-10T07:47:26Z
class:
core/src/main/java/org/elasticsearch/common/lucene/all/AllTermQuery.java
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
core/src/test/java/org/elasticsearch/index/search/MultiMatchQueryTests.java
comments:
Fix match_phrase_prefix query with single term on _all field (#20471)

* Fix match_phrase_prefix query with single term on _all field

This change fixes the match_phrase_prefix query when a single term is queried on the _all field.
It builds a prefix query instead of an AllTermQuery which would not match any prefix.

Fixes #20470

* Add missing change

time:
2016-10-10T07:32:26Z
class:
core/src/main/java/org/elasticsearch/common/regex/Regex.java
core/src/main/java/org/elasticsearch/common/xcontent/support/XContentMapValues.java
core/src/test/java/org/elasticsearch/common/xcontent/support/XContentMapValuesTests.java
comments:
Source filtering should treat dots in field names as sub objects. (#20736)

Mappings treat dots in field names as sub objects, for instance

```
{
  "a.b": "c"
}
```

generates the same dynamic mappings as

```
{
  "a": {
    "b": "c"
  }
}
```

Source filtering should be consistent with this behaviour so that an include
list containing `a` should include fields whose name is `a.b`.

To make this change easier, source filtering was refactored to use automata.
The ability to treat dots in field names as sub objects is provided by the
`makeMatchDotsInFieldNames` method of `XContentMapValues`.

Closes #20719

time:
2016-10-09T17:47:59Z
class:
comments:
Loosen assertion in getting-started.asciidoc

We were asserting that the size of an index had a decimal point but it
doesn't always:
https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+5.0+java9-periodic/240/console

time:
2016-10-08T11:35:58Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexStateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java
core/src/main/java/org/elasticsearch/gateway/Gateway.java
core/src/main/java/org/elasticsearch/gateway/GatewayService.java
core/src/main/java/org/elasticsearch/index/IndexModule.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/NodeServicesProvider.java
core/src/main/java/org/elasticsearch/indices/IndicesModule.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/test/java/org/elasticsearch/action/admin/indices/template/put/MetaDataIndexTemplateServiceTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexServiceTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesServiceTests.java
core/src/test/java/org/elasticsearch/gateway/GatewayServiceTests.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/indices/IndicesLifecycleListenerSingleNodeTests.java
core/src/test/java/org/elasticsearch/indices/cluster/AbstractIndicesClusterStateServiceTestCase.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
comments:
Remove NodeServicesProvider

Instead provide services where they are needed. The class worked
well as a temporary measure to easy removal of guice from the index
level but now we can remove it entirely.

-1 @Inject annotation

time:
2016-10-08T10:38:45Z
class:
comments:
Documentation: comments in index templates (#20701)

Fixes #20513

time:
2016-10-08T10:27:33Z
class:
comments:
Docs: Pattern analyzer does not support a max_token_length parameter

Closes #20713

time:
2016-10-07T22:28:51Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
comments:
fix bug in update operation in shard bulk execution

time:
2016-10-07T21:56:35Z
class:
core/src/main/java/org/elasticsearch/action/DocumentRequest.java
comments:
remove redundant final qualifier

time:
2016-10-07T21:52:53Z
class:
core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
core/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportShardFlushAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportShardRefreshAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/TransportValidateQueryAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/explain/TransportExplainAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/analysis/NamedAnalyzer.java
core/src/main/java/org/elasticsearch/index/fieldvisitor/FieldsVisitor.java
core/src/main/java/org/elasticsearch/index/fieldvisitor/SingleFieldsVisitor.java
core/src/main/java/org/elasticsearch/index/mapper/BinaryFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/BooleanFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/CompletionFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IpFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/KeywordFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyByteFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyDateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyDoubleFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyFloatFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyIntegerFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyIpFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyLongFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyShortFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/MappedFieldType.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/index/mapper/NumberFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/StringFieldType.java
core/src/main/java/org/elasticsearch/index/mapper/TTLFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TimestampFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceRangeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/index/query/RangeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/DecayFunctionBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/RandomScoreFunctionBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java
core/src/main/java/org/elasticsearch/index/search/geo/GeoDistanceRangeQuery.java
core/src/main/java/org/elasticsearch/index/search/geo/LegacyIndexedGeoBoundingBoxQuery.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/ttl/IndicesTTLService.java
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/ExtendedBounds.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/derivative/DerivativePipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/support/AggregationContext.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/MatchedQueriesFetchSubPhase.java
core/src/main/java/org/elasticsearch/search/internal/FilteredSearchContext.java
core/src/main/java/org/elasticsearch/search/internal/SearchContext.java
core/src/main/java/org/elasticsearch/search/internal/SubSearchContext.java
core/src/main/java/org/elasticsearch/search/sort/ScriptSortBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggester.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionContext.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
core/src/test/java/org/elasticsearch/index/SearchSlowLogTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/mapper/BinaryFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/BooleanFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/FieldTypeTestCase.java
core/src/test/java/org/elasticsearch/index/mapper/IdFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/IpFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/KeywordFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyByteFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyDateFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyDateFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyDoubleFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyFloatFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyIntegerFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyLongFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyShortFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/NumberFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/ParentFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ScaledFloatFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/TimestampFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/UidFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/BoostingQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/CommonTermsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/ConstantScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/DisMaxQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/ExistsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/FieldMaskingSpanQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/FuzzyQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoDistanceQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoDistanceRangeQueryTests.java
core/src/test/java/org/elasticsearch/index/query/GeoPolygonQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoShapeQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeohashCellQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/HasChildQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/HasParentQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/IdsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/IndicesQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchAllQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchNoneQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchPhrasePrefixQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchPhraseQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MultiMatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/NestedQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/ParentIdQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/PrefixQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryRewriteContextTests.java
core/src/test/java/org/elasticsearch/index/query/QueryShardContextTests.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/RangeQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/RangeQueryRewriteTests.java
core/src/test/java/org/elasticsearch/index/query/RegexpQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/ScriptQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryStringBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SpanContainingQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SpanFirstQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SpanMultiTermQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SpanNearQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SpanNotQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SpanOrQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SpanTermQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SpanWithinQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/TermQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/TermsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/TypeQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/WildcardQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/WrapperQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateRangeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DoubleTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/HistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/LongTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/RangeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsSignificanceScoreIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/StringTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/ExtendedBoundsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/AvgIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/CardinalityIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ExtendedStatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MaxIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MinIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ScriptedMetricIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/StatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/SumIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ValueCountIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/FetchSourceSubPhaseTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilderTests.java
core/src/test/java/org/elasticsearch/search/rescore/QueryRescoreBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TemplateQueryBuilder.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/TemplateQueryBuilderTests.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolateQueryBuilderTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorQuerySearchIT.java
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/storage/AzureStorageServiceImpl.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java
test/framework/src/main/java/org/elasticsearch/test/TestSearchContext.java
test/framework/src/test/java/org/elasticsearch/search/MockSearchServiceTests.java
comments:
Merge branch 'master' into cleanup/transport_bulk

time:
2016-10-07T21:50:15Z
class:
core/src/main/java/org/elasticsearch/action/DocumentRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/DeleteRequest.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationOperation.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/main/java/org/elasticsearch/action/support/single/instance/InstanceShardOperationRequest.java
core/src/main/java/org/elasticsearch/action/support/single/instance/InstanceShardOperationRequestBuilder.java
core/src/main/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationAction.java
core/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java
core/src/main/java/org/elasticsearch/action/update/UpdateReplicaRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequestBuilder.java
core/src/main/java/org/elasticsearch/indices/IndicesModule.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationActionTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
comments:
Revert "Make update a replication action"

This reverts commit eee0d18f94108b5ece7b18a450bbcc5c729d9311.

time:
2016-10-07T21:50:07Z
class:
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/RestNoopBulkAction.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/TransportNoopBulkAction.java
core/src/main/java/org/elasticsearch/action/DocumentRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/DeleteRequest.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/index/IndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/ingest/IngestActionFilter.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateReplicaRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/index/mapper/Uid.java
core/src/main/java/org/elasticsearch/ingest/PipelineExecutionService.java
core/src/test/java/org/elasticsearch/action/bulk/BulkRequestTests.java
core/src/test/java/org/elasticsearch/action/bulk/BulkWithUpdatesIT.java
core/src/test/java/org/elasticsearch/action/bulk/RetryTests.java
core/src/test/java/org/elasticsearch/action/index/IndexRequestTests.java
core/src/test/java/org/elasticsearch/action/ingest/BulkRequestModifierTests.java
core/src/test/java/org/elasticsearch/action/ingest/IngestActionFilterTests.java
core/src/test/java/org/elasticsearch/document/DocumentActionsIT.java
core/src/test/java/org/elasticsearch/ingest/PipelineExecutionServiceTests.java
core/src/test/java/org/elasticsearch/routing/SimpleRoutingIT.java
core/src/test/java/org/elasticsearch/versioning/SimpleVersioningIT.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractAsyncBulkIndexByScrollAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AsyncBulkByScrollActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFailureTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexVersioningTests.java
comments:
Revert "rename DocumentRequest to DocumentWriteRequest"

This reverts commit b5079ce0092e2dfd742fbe3aed8a8f95931a378d.

time:
2016-10-07T21:49:57Z
class:
core/src/main/java/org/elasticsearch/action/DocumentWriteRequest.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
comments:
Revert "fix bug in bulk replication for noop update operation"

This reverts commit 42bc2d15bedb0f3b457bbfe06247311b9667b7c9.

time:
2016-10-07T21:48:44Z
class:
core/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java
comments:
Revert "remove duplicate logic for request resolution and routing verification"

This reverts commit 2a651fc296a6c2b16cc1066e039d5e7f6f5121f9.

time:
2016-10-07T21:33:13Z
class:
comments:
Fix URL for plugins

Reported at https://discuss.elastic.co/t/ingest-geoip-for-beta1/62505

time:
2016-10-07T20:30:45Z
class:
comments:
CONSOLEify some _cat docs

`/_cat/count`, `/_cat/fielddata`, and `/_cat/health`.

Three more files down, 141 to go.

Relates to #18160

time:
2016-10-07T18:24:37Z
class:
comments:
Updated documentation to include precise version of gradle currently required for building (#20776)

time:
2016-10-07T18:05:30Z
class:
core/src/main/java/org/apache/logging/log4j/core/impl/ThrowableProxy.java
core/src/main/java/org/apache/logging/log4j/core/jmx/Server.java
core/src/main/java/org/elasticsearch/bootstrap/JarHell.java
core/src/main/java/org/elasticsearch/common/logging/LogConfigurator.java
core/src/test/java/org/elasticsearch/bootstrap/JarHellTests.java
comments:
Upgrade Log4j 2 to version 2.7

This commit upgrades the Log4j 2 dependency to version 2.7 and removes
some hacks that we had in place to work around bugs in Log4j 2 version
2.6.2.

Relates #20805

time:
2016-10-07T17:06:52Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
Added version 2.4.1 with bwc indices

time:
2016-10-07T16:39:10Z
class:
comments:
Merge pull request #20784 from eskibars/master

Add a note that reindex does not set up mappings, etc

time:
2016-10-07T15:14:38Z
class:
core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/indices/IndicesModule.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySettings.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TaskManagerTestCase.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionTookTests.java
core/src/test/java/org/elasticsearch/action/ingest/IngestProxyActionFilterTests.java
core/src/test/java/org/elasticsearch/action/main/MainActionTests.java
core/src/test/java/org/elasticsearch/action/search/TransportMultiSearchActionTests.java
core/src/test/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeActionTests.java
core/src/test/java/org/elasticsearch/action/support/master/TransportMasterNodeActionTests.java
core/src/test/java/org/elasticsearch/action/support/nodes/TransportNodesActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/BroadcastReplicationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationActionTests.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientHeadersTests.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientNodesServiceTests.java
core/src/test/java/org/elasticsearch/cluster/NodeConnectionsServiceTests.java
core/src/test/java/org/elasticsearch/cluster/action/shard/ShardStateActionTests.java
core/src/test/java/org/elasticsearch/cluster/health/ClusterStateHealthTests.java
core/src/test/java/org/elasticsearch/discovery/ZenFaultDetectionTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ping/unicast/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/discovery/zen/publish/PublishClusterStateActionTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingDisabledTests.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
core/src/test/java/org/elasticsearch/indices/recovery/IndexRecoveryIT.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySettingsDynamicUpdateTests.java
core/src/test/java/org/elasticsearch/indices/store/IndicesStoreTests.java
core/src/test/java/org/elasticsearch/recovery/RecoverySettingsTests.java
core/src/test/java/org/elasticsearch/recovery/TruncatedRecoveryIT.java
core/src/test/java/org/elasticsearch/transport/TransportServiceHandshakeTests.java
modules/transport-netty3/src/test/java/org/elasticsearch/transport/Netty3SizeHeaderFrameDecoderTests.java
modules/transport-netty3/src/test/java/org/elasticsearch/transport/netty3/Netty3ScheduledPingTests.java
modules/transport-netty3/src/test/java/org/elasticsearch/transport/netty3/SimpleNetty3TransportTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/transport/netty4/Netty4ScheduledPingTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/transport/netty4/SimpleNetty4TransportTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryTests.java
plugins/discovery-file/src/test/java/org/elasticsearch/discovery/file/FileBasedUnicastHostsProviderTests.java
plugins/discovery-gce/src/test/java/org/elasticsearch/discovery/gce/GceDiscoveryTests.java
plugins/repository-gcs/src/test/java/org/elasticsearch/common/blobstore/gcs/GoogleCloudStorageBlobStoreContainerTests.java
test/framework/src/main/java/org/elasticsearch/node/MockNode.java
test/framework/src/main/java/org/elasticsearch/node/RecoverySettingsChunkSizePlugin.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
test/framework/src/test/java/org/elasticsearch/transport/MockTcpTransportTests.java
comments:
DeGuice some of IndicesModule

UpdateHelper, MetaDataIndexUpgradeService, and some recovery
stuff.

Move ClusterSettings to nullable ctor parameter of TransportService
so it isn't forgotten.

time:
2016-10-07T14:33:30Z
class:
comments:
Better formatting of date-match URL encoding

time:
2016-10-07T13:56:54Z
class:
core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java
core/src/main/java/org/elasticsearch/common/transport/TransportAddress.java
core/src/test/java/org/elasticsearch/tribe/TribeIT.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteWithAuthTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RetryTests.java
plugins/discovery-file/src/test/java/org/elasticsearch/discovery/file/FileBasedUnicastHostsProviderTests.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
comments:
Simplify TransportAddress (#20798)

since TransportAddress is now final we can simplify it's interface a bit
and remove methods that are only used in tests or are plain delegates.

time:
2016-10-07T13:49:28Z
class:
comments:
Document date math use in the rollover API (#20780)

* Document date math use in the rollover API

Relates to #20709

time:
2016-10-07T13:37:29Z
class:
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/ExtendedBoundsTests.java
comments:
Makes freezing QueryShardContext safer by stopping overrides (#20800)

The `QueryShardContext.failIfFrozen()` and `QueryShardContext.freezeContext()`
methods should be final so that overriding/bypassing the freezing of
`QueryShardContext` is not possible. This is important so that we can
trust when the `QueryShardContext` says a request is cacheable.

This change also makes the methods that call `QueryShardContext.failIfFrozen()`
`final` so they cannot be overridden to bypass setting the request as not
cacheable.

time:
2016-10-07T13:26:34Z
class:
comments:
Clarify some docs about geo-distance sorting. (#20735)

This also improves formatting a bit.

time:
2016-10-07T12:22:15Z
class:
core/src/main/java/org/elasticsearch/common/joda/DateMathParser.java
core/src/test/java/org/elasticsearch/common/joda/DateMathParserTests.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyDateFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyDateFieldTypeTests.java
comments:
Make range queries round up upper bounds again. (#20582)

Elasticsearch 1.x used to implicitly round up upper bounds of queries when they
were inclusive so that eg. `[2016-09-18 TO 2016-09-20]` would actually run
`[2016-09-18T00:00:00.000Z TO 2016-09-20T23:59:59.999Z]` and include dates like
`2016-09-20T15:32:44`. This behaviour was lost in the cleanups of #8889.

Closes #20579

time:
2016-10-07T12:17:01Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/OperationRouting.java
core/src/test/java/org/elasticsearch/cluster/structure/RoutingIteratorTests.java
comments:
Change separator for shards preference

The shards preference on a search request enables specifying a list of
shards to hit, and then a secondary preference (e.g., "_primary") can be
added. Today, the separator between the shards list and the secondary
preference is ';'. Unfortunately, this is also a valid separtor for URL
query parameters. This means that a preference like "_shards:0;_primary"
will be parsed into two URL parameters: "_shards:0" and "_primary". With
the recent change to strict URL parsing, the second parameter will be
rejected, "_primary" is not a valid URL parameter on a search
request. This means that this feature has never worked (unless the ';'
is escaped, but no one does that because our docs do not that, and there
was no indication from Elasticsearch that this did not work). This
commit changes the separator to '|'.

Relates #20786

time:
2016-10-07T09:27:47Z
class:
benchmarks/src/main/java/org/elasticsearch/benchmark/routing/allocation/Allocators.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/transport/TransportClientBenchmark.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodeFilters.java
core/src/main/java/org/elasticsearch/common/network/NetworkModule.java
core/src/main/java/org/elasticsearch/common/transport/BoundTransportAddress.java
core/src/main/java/org/elasticsearch/common/transport/InetSocketTransportAddress.java
core/src/main/java/org/elasticsearch/common/transport/LocalTransportAddress.java
core/src/main/java/org/elasticsearch/common/transport/TransportAddress.java
core/src/main/java/org/elasticsearch/common/transport/TransportAddressSerializers.java
core/src/main/java/org/elasticsearch/discovery/zen/NodeJoinController.java
core/src/main/java/org/elasticsearch/plugins/NetworkPlugin.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestNodeAttrsAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestNodesAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTasksAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestThreadPoolAction.java
core/src/main/java/org/elasticsearch/transport/ActionTransportException.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/main/java/org/elasticsearch/transport/Transports.java
core/src/main/java/org/elasticsearch/transport/local/LocalTransport.java
core/src/main/java/org/elasticsearch/transport/local/LocalTransportChannel.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplanationTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStatsTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TaskManagerTestCase.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TasksIT.java
core/src/test/java/org/elasticsearch/action/admin/indices/shards/IndicesShardStoreResponseTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/shrink/TransportShrinkActionTests.java
core/src/test/java/org/elasticsearch/action/ingest/IngestProxyActionFilterTests.java
core/src/test/java/org/elasticsearch/action/search/TransportMultiSearchActionTests.java
core/src/test/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeActionTests.java
core/src/test/java/org/elasticsearch/action/support/master/IndexingMasterFailoverIT.java
core/src/test/java/org/elasticsearch/action/support/master/TransportMasterNodeActionTests.java
core/src/test/java/org/elasticsearch/action/support/nodes/TransportNodesActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/BroadcastReplicationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/ClusterStateCreationUtils.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapCheckTests.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientHeadersTests.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientIT.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientNodesServiceTests.java
core/src/test/java/org/elasticsearch/cluster/ClusterChangedEventTests.java
core/src/test/java/org/elasticsearch/cluster/ClusterStateDiffIT.java
core/src/test/java/org/elasticsearch/cluster/ClusterStateTests.java
core/src/test/java/org/elasticsearch/cluster/DiskUsageTests.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/NoMasterNodeIT.java
core/src/test/java/org/elasticsearch/cluster/NodeConnectionsServiceTests.java
core/src/test/java/org/elasticsearch/cluster/SpecificMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexServiceTests.java
core/src/test/java/org/elasticsearch/cluster/node/DiscoveryNodeFiltersTests.java
core/src/test/java/org/elasticsearch/cluster/node/DiscoveryNodesTests.java
core/src/test/java/org/elasticsearch/cluster/routing/PrimaryAllocationIT.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/NodeVersionAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/SameShardRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDeciderUnitTests.java
core/src/test/java/org/elasticsearch/cluster/serialization/ClusterSerializationTests.java
core/src/test/java/org/elasticsearch/cluster/serialization/ClusterStateToStringTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceIT.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
core/src/test/java/org/elasticsearch/common/network/NetworkModuleTests.java
core/src/test/java/org/elasticsearch/common/transport/BoundTransportAddressTests.java
core/src/test/java/org/elasticsearch/discovery/BlockingClusterStatePublishResponseHandlerTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/discovery/ZenFaultDetectionTests.java
core/src/test/java/org/elasticsearch/discovery/ZenUnicastDiscoveryIT.java
core/src/test/java/org/elasticsearch/discovery/zen/ElectMasterServiceTests.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeJoinControllerTests.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeRemovalClusterStateTaskExecutorTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryIT.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenPingTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ping/unicast/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/discovery/zen/publish/PendingClusterStatesQueueTests.java
core/src/test/java/org/elasticsearch/discovery/zen/publish/PublishClusterStateActionTests.java
core/src/test/java/org/elasticsearch/gateway/AsyncShardFetchTests.java
core/src/test/java/org/elasticsearch/http/HttpServerTests.java
core/src/test/java/org/elasticsearch/index/TransportIndexFailuresIT.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingDisabledTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/indices/IndexingMemoryControllerTests.java
core/src/test/java/org/elasticsearch/indices/IndicesLifecycleListenerSingleNodeTests.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySourceHandlerTests.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoveryStatusTests.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoveryTargetTests.java
core/src/test/java/org/elasticsearch/indices/recovery/StartRecoveryRequestTests.java
core/src/test/java/org/elasticsearch/indices/state/RareClusterStateIT.java
core/src/test/java/org/elasticsearch/indices/store/IndicesStoreTests.java
core/src/test/java/org/elasticsearch/ingest/PipelineStoreTests.java
core/src/test/java/org/elasticsearch/nodesinfo/NodeInfoStreamingTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramOffsetIT.java
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/transport/local/SimpleLocalTransportTests.java
core/src/test/java/org/elasticsearch/tribe/TribeIT.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AsyncBulkByScrollActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteWhitelistTests.java
modules/transport-netty3/src/main/java/org/elasticsearch/http/netty3/Netty3HttpServerTransport.java
modules/transport-netty3/src/main/java/org/elasticsearch/transport/netty3/Netty3Transport.java
modules/transport-netty3/src/test/java/org/elasticsearch/ESNetty3IntegTestCase.java
modules/transport-netty3/src/test/java/org/elasticsearch/http/netty3/Netty3HttpPublishPortTests.java
modules/transport-netty3/src/test/java/org/elasticsearch/http/netty3/Netty3HttpRequestSizeLimitIT.java
modules/transport-netty3/src/test/java/org/elasticsearch/http/netty3/Netty3HttpServerPipeliningTests.java
modules/transport-netty3/src/test/java/org/elasticsearch/http/netty3/Netty3PipeliningDisabledIT.java
modules/transport-netty3/src/test/java/org/elasticsearch/transport/Netty3SizeHeaderFrameDecoderTests.java
modules/transport-netty3/src/test/java/org/elasticsearch/transport/netty3/Netty3TransportMultiPortIntegrationIT.java
modules/transport-netty3/src/test/java/org/elasticsearch/transport/netty3/Netty3TransportPublishAddressIT.java
modules/transport-netty3/src/test/java/org/elasticsearch/transport/netty3/SimpleNetty3TransportTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
modules/transport-netty4/src/test/java/org/elasticsearch/ESNetty4IntegTestCase.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpPublishPortTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpRequestSizeLimitIT.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerPipeliningTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerTransportTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4PipeliningDisabledIT.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4PipeliningEnabledIT.java
modules/transport-netty4/src/test/java/org/elasticsearch/transport/netty4/Netty4SizeHeaderFrameDecoderTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/transport/netty4/Netty4TransportMultiPortIntegrationIT.java
modules/transport-netty4/src/test/java/org/elasticsearch/transport/netty4/Netty4TransportPublishAddressIT.java
modules/transport-netty4/src/test/java/org/elasticsearch/transport/netty4/SimpleNetty4TransportTests.java
plugins/discovery-azure-classic/src/test/java/org/elasticsearch/discovery/azure/classic/AzureDiscoveryClusterFormationTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryClusterFormationTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryTests.java
plugins/discovery-gce/src/test/java/org/elasticsearch/discovery/gce/GceDiscoverTests.java
plugins/discovery-gce/src/test/java/org/elasticsearch/discovery/gce/GceDiscoveryTests.java
qa/evil-tests/src/test/java/org/elasticsearch/tribe/TribeUnitTests.java
qa/smoke-test-client/src/test/java/org/elasticsearch/smoketest/ESSmokeClientTestCase.java
test/framework/src/main/java/org/elasticsearch/cluster/ESAllocationTestCase.java
test/framework/src/main/java/org/elasticsearch/cluster/MockInternalClusterInfoService.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ClusterServiceUtils.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ExternalTestCluster.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
test/framework/src/main/java/org/elasticsearch/test/transport/AssertingLocalTransport.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
test/framework/src/main/java/org/elasticsearch/transport/AssertingTransportInterceptor.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
test/framework/src/main/java/org/elasticsearch/transport/MockTransportClient.java
test/framework/src/test/java/org/elasticsearch/node/MockNodeTests.java
test/framework/src/test/java/org/elasticsearch/test/test/InternalTestClusterTests.java
comments:
Remove LocalTransport in favor of MockTcpTransport (#20695)

This change proposes the removal of all non-tcp transport implementations. The
mock transport can be used by default to run tests instead of local transport that has
roughly the same performance compared to TCP or at least not noticeably slower.

This is a master only change, deprecation notice in 5.x will be committed as a
separate change.

time:
2016-10-07T09:26:25Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolver.java
core/src/main/java/org/elasticsearch/common/joda/DateMathParser.java
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyDateFieldMapper.java
core/src/main/java/org/elasticsearch/search/DocValueFormat.java
core/src/test/java/org/elasticsearch/common/joda/DateMathParserTests.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/DoubleIndexingDocTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyDateFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyDateFieldTypeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramIT.java
comments:
Removes the now callable in the date math parser in favour of a LongSupplier (#20796)

Previous to this change the DateMathParser accepted a Callable<Long> to use for accessing the now value. The implementations of this callable would fall back on System.currentTimeMillis() if there was no context object provided. This is no longer necessary for two reasons:

We should not fall back to System.currentTimeMillis() as a context should always be provided. This ensures consistency between shards for the now value in all cases
We should use a LongSupplier rather than requiring an implementation of Callable. This means that we can just pass in context::noInMillis for this parameter and not have not implement anything.

time:
2016-10-07T09:24:15Z
class:
core/src/main/java/org/elasticsearch/index/store/Store.java
comments:
also ignore AccessDeniedException (for Windows) when checking file size for store stats (#20790)

Closes #17580
Nice catch @mikemccand 👍 


time:
2016-10-07T07:23:24Z
class:
comments:
Deprecating request parameters in _analyze API

Remove params in indices.analyze.json
Fix REST changes

Closes #20246

time:
2016-10-07T07:23:24Z
class:
comments:
Removing request parameters in _analyze API

Fix small English issue in breaking changes

Closes #20246

time:
2016-10-07T07:23:24Z
class:
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeAction.java
core/src/test/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeActionTests.java
comments:
Removing request parameters in _analyze API

Remove unused imports
Replace POST method by GET method in docs
 Add breaking changes explanation
 Fix small issue in Kuromoji docs

Closes #20246

time:
2016-10-07T07:23:24Z
class:
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeAction.java
core/src/test/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeActionTests.java
comments:
Removing request parameters in _analyze API

Remove request params in _analyze API without index param
Change rest-api-test using JSON
Change docs using JSON

Closes #20246

time:
2016-10-07T03:46:55Z
class:
comments:
[DOCS] Use a better name for fields in examples to avoid ambiguity

Previously, this doc was using a field called "content". This is
confusing, especially when the doc starts talking about the content of
the content field.  This change makes the field name "comment" which
is less ambiguous and also changes some related field names in the doc
to make a consistent example theme of editing docs around blog posts.

time:
2016-10-07T02:53:05Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/allocation/ShardAllocationDecision.java
core/src/main/java/org/elasticsearch/gateway/BaseGatewayShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/ReplicaShardAllocator.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/ShardAllocationDecisionTests.java
comments:
Shard Decision class improvements for Explain API (#20742)

This commit improves the shard decision container class in the following
ways:

 1. Renames UnassignedShardDecision to ShardAllocationDecision, so that
    the class can be used for general shard decisions, not just unassigned
    shard decisions.
 2. Changes ShardAllocationDecision to have the final decision as a Type
    instead of a Decision, because all the information needed from the final
    decision is contained in `Type`.
 3. Uses cached instances of ShardAllocationDecision for NO and THROTTLE
    decisions when no explanation is needed (which is the common case when
    executing reroute's as opposed to using the explain API).

time:
2016-10-06T19:42:11Z
class:
comments:
Fixed released_state docs switch to build correctly and include missing links

time:
2016-10-06T19:27:08Z
class:
comments:
Adds a note that reindex does not set up mappings, etc.  Closes #20783

time:
2016-10-06T19:10:49Z
class:
comments:
Document how to run a single docs test

time:
2016-10-06T18:53:04Z
class:
core/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java
comments:
remove duplicate logic for request resolution and routing verification

time:
2016-10-06T18:46:54Z
class:
core/src/main/java/org/elasticsearch/action/DocumentWriteRequest.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
comments:
fix bug in bulk replication for noop update operation

time:
2016-10-06T18:41:19Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverAction.java
comments:
Remove confusing capturing groups in _rollover index name pattern

time:
2016-10-06T18:06:48Z
class:
comments:
CONSOLEify remaining getting-started docs

Moves some test data used by those docs into the Elasticsearch
repository so we can use it when we test the docs during the build.

Relates to #18160

time:
2016-10-06T17:53:20Z
class:
comments:
Fix broken regex in doc tests

Regexes are hard.

time:
2016-10-06T17:51:54Z
class:
core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/TransportValidateQueryAction.java
core/src/main/java/org/elasticsearch/action/explain/TransportExplainAction.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/fieldvisitor/FieldsVisitor.java
core/src/main/java/org/elasticsearch/index/fieldvisitor/SingleFieldsVisitor.java
core/src/main/java/org/elasticsearch/index/mapper/BinaryFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/BooleanFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IpFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/KeywordFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyByteFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyDateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyDoubleFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyFloatFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyIntegerFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyIpFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyLongFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyShortFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/MappedFieldType.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/index/mapper/NumberFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/StringFieldType.java
core/src/main/java/org/elasticsearch/index/mapper/TTLFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TimestampFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceRangeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/index/query/RangeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/DecayFunctionBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/RandomScoreFunctionBuilder.java
core/src/main/java/org/elasticsearch/index/search/geo/GeoDistanceRangeQuery.java
core/src/main/java/org/elasticsearch/index/search/geo/LegacyIndexedGeoBoundingBoxQuery.java
core/src/main/java/org/elasticsearch/indices/ttl/IndicesTTLService.java
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/MatchedQueriesFetchSubPhase.java
core/src/main/java/org/elasticsearch/search/internal/SearchContext.java
core/src/main/java/org/elasticsearch/search/internal/SubSearchContext.java
core/src/test/java/org/elasticsearch/index/mapper/BinaryFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/BooleanFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/IdFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/IpFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/KeywordFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyByteFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyDateFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyDateFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyDoubleFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyFloatFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyIntegerFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyLongFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyShortFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/NumberFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/ScaledFloatFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/TimestampFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/UidFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/BoostingQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/CommonTermsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/ConstantScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/DisMaxQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/ExistsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/FieldMaskingSpanQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/FuzzyQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoDistanceQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoDistanceRangeQueryTests.java
core/src/test/java/org/elasticsearch/index/query/GeoPolygonQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoShapeQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeohashCellQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/HasChildQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/HasParentQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/IdsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/IndicesQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchAllQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchNoneQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchPhrasePrefixQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchPhraseQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MultiMatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/NestedQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/ParentIdQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/PrefixQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryRewriteContextTests.java
core/src/test/java/org/elasticsearch/index/query/QueryShardContextTests.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/RangeQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/RangeQueryRewriteTests.java
core/src/test/java/org/elasticsearch/index/query/RegexpQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/ScriptQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryStringBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SpanContainingQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SpanFirstQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SpanMultiTermQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SpanNearQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SpanNotQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SpanOrQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SpanTermQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SpanWithinQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/TermQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/TermsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/TypeQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/WildcardQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/WrapperQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/FetchSourceSubPhaseTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilderTests.java
core/src/test/java/org/elasticsearch/search/rescore/QueryRescoreBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/TemplateQueryBuilderTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolateQueryBuilderTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/TestSearchContext.java
test/framework/src/test/java/org/elasticsearch/search/MockSearchServiceTests.java
comments:
Remove SearchContext#current and all it's threadlocals (#20778)

Today SearchContext expose the current context as a thread local which makes any kind of sane interface design very very hard. This PR removes the thread local entirely and instead passes the relevant context anywhere needed. This simplifies state management dramatically and will allow for a much leaner SearchContext interface down the road.

time:
2016-10-06T17:37:21Z
class:
comments:
CONSOLEify some _cat docs

Added `// NOTCONSOLE` to some `_cat` docs that rely on `sort` or
are otherwise too difficult for us to test at this point.

Relates to #20717

time:
2016-10-06T15:58:03Z
class:
comments:
Add placeholder to the docs to distinguish released from unreleased from prerelease versions (#20644)

Closes https://github.com/elastic/stack/issues/18

time:
2016-10-06T14:15:33Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/main/java/org/elasticsearch/index/analysis/NamedAnalyzer.java
core/src/main/java/org/elasticsearch/index/mapper/CompletionFieldMapper.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/FieldTypeTestCase.java
core/src/test/java/org/elasticsearch/index/mapper/ParentFieldMapperTests.java
comments:
Named analyzer should close the analyzer that it wraps

time:
2016-10-06T14:11:27Z
class:
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
comments:
Improve scheduling fairness when batching cluster state changes with equal priority (#20775)

As the wise man @ywelsch said: currently when we batch cluster state update tasks by the same executor, we the first task un-queued from the pending task queue. That means that other tasks for the same executor are left in the queue. When those are dequeued, they will trigger another run for the same executor. This can give unfair precedence to future tasks of the same executor, even if they weren't batched in the first run. Take this queue for example (all with equal priority)

 ```
 T1 (executor 1)
 T2 (executor 1)
 T3 (executor 2)
 T4 (executor 2)
 T5 (executor 1)
 T6 (executor 1)
 ```

 If T1 & T2 are picked up first (when T5 & T6 are not yet queued), one would expect T3 & T4 to run second. However, since T2 is still in the queue, it will trigger execution of T5 & T6.

 The fix is easy - ignore processed tasks when extracting them from the queue.

Closes #20768

time:
2016-10-06T14:00:43Z
class:
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/storage/AzureStorageServiceImpl.java
comments:
Merge branch 'fix/20669-master-azure-log'

time:
2016-10-06T13:44:42Z
class:
comments:
Most date-math chars in index names need to be percent encoded

Updated docs to provide encodings

time:
2016-10-06T09:24:57Z
class:
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyDateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TTLFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/RandomScoreFunctionBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/ExtendedBounds.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/derivative/DerivativePipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/support/AggregationContext.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/internal/FilteredSearchContext.java
core/src/main/java/org/elasticsearch/search/internal/SearchContext.java
core/src/main/java/org/elasticsearch/search/sort/ScriptSortBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggester.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionContext.java
core/src/test/java/org/elasticsearch/index/SearchSlowLogTests.java
core/src/test/java/org/elasticsearch/index/query/QueryShardContextTests.java
core/src/test/java/org/elasticsearch/index/query/ScriptQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateRangeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DoubleTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/HistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/LongTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/RangeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsSignificanceScoreIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/StringTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/ExtendedBoundsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/AvgIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/CardinalityIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ExtendedStatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MaxIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MinIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ScriptedMetricIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/StatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/SumIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ValueCountIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilderTests.java
core/src/test/java/org/elasticsearch/search/rescore/QueryRescoreBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TemplateQueryBuilder.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolateQueryBuilderTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorQuerySearchIT.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java
test/framework/src/main/java/org/elasticsearch/test/TestSearchContext.java
test/framework/src/test/java/org/elasticsearch/search/MockSearchServiceTests.java
comments:
#20750 Prevent requests that use scripts or now() from being cached

Prevent requests that use scripts or now() from being cached

time:
2016-10-06T09:05:59Z
class:
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/RestNoopBulkAction.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/TransportNoopBulkAction.java
core/src/main/java/org/elasticsearch/action/DocumentWriteRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/DeleteRequest.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/index/IndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/ingest/IngestActionFilter.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateReplicaRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/index/mapper/Uid.java
core/src/main/java/org/elasticsearch/ingest/PipelineExecutionService.java
core/src/test/java/org/elasticsearch/action/bulk/BulkRequestTests.java
core/src/test/java/org/elasticsearch/action/bulk/BulkWithUpdatesIT.java
core/src/test/java/org/elasticsearch/action/bulk/RetryTests.java
core/src/test/java/org/elasticsearch/action/index/IndexRequestTests.java
core/src/test/java/org/elasticsearch/action/ingest/BulkRequestModifierTests.java
core/src/test/java/org/elasticsearch/action/ingest/IngestActionFilterTests.java
core/src/test/java/org/elasticsearch/document/DocumentActionsIT.java
core/src/test/java/org/elasticsearch/ingest/PipelineExecutionServiceTests.java
core/src/test/java/org/elasticsearch/routing/SimpleRoutingIT.java
core/src/test/java/org/elasticsearch/versioning/SimpleVersioningIT.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractAsyncBulkIndexByScrollAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AsyncBulkByScrollActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFailureTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexVersioningTests.java
comments:
rename DocumentRequest to DocumentWriteRequest

time:
2016-10-06T09:02:54Z
class:
core/src/main/java/org/elasticsearch/action/DocumentRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/DeleteRequest.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationOperation.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/main/java/org/elasticsearch/action/support/single/instance/InstanceShardOperationRequest.java
core/src/main/java/org/elasticsearch/action/support/single/instance/InstanceShardOperationRequestBuilder.java
core/src/main/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationAction.java
core/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java
core/src/main/java/org/elasticsearch/action/update/UpdateReplicaRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequestBuilder.java
core/src/main/java/org/elasticsearch/indices/IndicesModule.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationActionTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
comments:
Make update a replication action

Currently, update action delegates to index and delete actions
for replication using a dedicated transport action. This change
makes update a replication operation, removing the dedicated
transport action. This simplifies bulk execution and removes
duplicate logic for update retries and translation. This
consolidates the interface for single document write requests.

Now on the primary, the update request is translated to
an index or delete request before execution and the translated
request is sent to copies for replication.

time:
2016-10-06T08:09:23Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportShardFlushAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportShardRefreshAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
test/framework/src/main/java/org/elasticsearch/test/disruption/LongGCDisruption.java
comments:
Merge branch 'master' into dont_cache_scripts

time:
2016-10-06T07:55:31Z
class:
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
comments:
Review comments

time:
2016-10-06T07:55:30Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java
comments:
The `top_hits` aggregation should compile scripts only once. (#20738)

Today it compiles when creating the aggregator, meaning that scripts will be
compiled as many times as there are buckets. Instead it should compile when
creating the factory so that scripts are compiled only once regardless of the
number of buckets.

time:
2016-10-06T06:59:07Z
class:
core/src/main/java/org/elasticsearch/action/DocumentRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
comments:
cleanup

time:
2016-10-06T06:45:35Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportShardFlushAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportShardRefreshAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
comments:
TransportReplicationAction subclasses shouldn't have to resolve shards (#20730)

TRA currently resolves incoming requests to IndexShards in order to acquire operations locks on them. There is no need for all subclasses to have to go through the same IndicesService/IndexService song and dance. Also, doing it once means we don't need to worry about edge cases where the shard is removed while a TRA is in flight.

time:
2016-10-05T21:51:39Z
class:
core/src/main/java/org/elasticsearch/action/bulk/BulkShardRequest.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java
core/src/main/java/org/elasticsearch/rest/BaseRestHandler.java
core/src/main/java/org/elasticsearch/rest/RestRequest.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeAction.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/AbstractRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/AbstractRangeBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/DateRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/DateRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceRangeAggregatorFactory.java
core/src/test/java/org/elasticsearch/indices/IndicesRequestCacheIT.java
core/src/test/java/org/elasticsearch/rest/BaseRestHandlerTests.java
test/framework/src/main/java/org/elasticsearch/test/disruption/LongGCDisruption.java
comments:
Merge branch 'master' into cleanup/transport_bulk

time:
2016-10-05T19:55:50Z
class:
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorQuerySearchIT.java
comments:
move test to a single node test

time:
2016-10-05T19:40:27Z
class:
test/framework/src/main/java/org/elasticsearch/test/disruption/LongGCDisruption.java
comments:
Prevent thread suspension when inside SecurityManager (#20770)

LongGCDisruption suspends and resumes node threads but respects several
`unsafe` class name patterns where it's unsafe to suspend. For instance
log4j uses a global lock so we can't suspend a thread that is currently
calling into log4j. The same is true for the security manager, it's similar
to log4j a shared resource between the test and the node that is _suspended_.
This change adds `java.lang.SecrityManager` to the unsafe patterns.
This prevents test framework deadlocking if a nodes thread is supended
while it's calling into the security manager that uses synchronized maps etc.

time:
2016-10-05T18:43:52Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java
core/src/main/java/org/elasticsearch/rest/BaseRestHandler.java
core/src/test/java/org/elasticsearch/rest/BaseRestHandlerTests.java
comments:
Merge branch 'master' into dont_cache_scripts

time:
2016-10-05T18:43:46Z
class:
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorIT.java
comments:
add percolate with script query test

time:
2016-10-05T18:23:25Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java
comments:
BalancedShardAllocator code improvements (#20746)

This commit improves the logic flow of BalancedShardsAllocator in
preparation for separating out components of this class to be used
in the cluster allocation explain APIs.  In particular, this commit:

 1. Adds a minimum value for the index/shard balance factor settings (0.0)
 2. Makes the Balancer data structures immutable and pre-calculated at
    construction time.
 3. Removes difficult to follow labeled blocks / GOTOs
 4. Better logic for skipping over the same replica set when one of
    the replicas received a NO decision
 5. Separates the decision making logic for a single shard from the logic
    to iterate over all unassigned shards.

time:
2016-10-05T17:01:19Z
class:
comments:
Merge pull request #20766 from jdconrad/now

Remove all date 'now' methods from Painless

time:
2016-10-05T16:47:20Z
class:
comments:
Remove all date 'now' methods from the Painless whitelist to ensure
Painless scripts are pure functions.

time:
2016-10-05T15:42:25Z
class:
comments:
[vagrant] packaging tests: add parametrized retries for dnf install (#20749)

* Add parametrized retries for dnf install

Given that dnf doesn't do retries installation of openjdk can sometimes
be affected by checksum or network issues with mirrors offered by
metalink.

Allow setting number of retries through the parameter
`install_command_retries`

* Insert delay between package install retries

Fedora's metalink occasionally returns broken mirrors. Pausing for a few
seconds between retries increases the chance of receiving a different
list of mirrors from metalink and success with package installation.

time:
2016-10-05T15:26:19Z
class:
core/src/main/java/org/elasticsearch/rest/BaseRestHandler.java
core/src/test/java/org/elasticsearch/rest/BaseRestHandlerTests.java
comments:
Add response params to REST params did you mean

This commit adds the response params as candidates for the did you mean
suggestions for strict REST params handling.

Relates #20753

time:
2016-10-05T15:21:54Z
class:
comments:
CONSOLEify scroll docs

This causes the snippets to be tested during the build and gives
helpful links to the reader to open the docs in console or copy them
as curl commands.

Relates to #18160

time:
2016-10-05T15:20:45Z
class:
comments:
Fix grammar issues in some docs

This commit fixes some grammar issues in various docs.

Closes #20751
Closes #20752
Closes #20754
Closes #20755

time:
2016-10-05T15:10:27Z
class:
comments:
Build: Fix plugin poms to have correct artifact id (#20764)

We already override the name in plugin pom files to be that configured
for the plugin but we also need to explicitly set the artifactId.

time:
2016-10-05T14:38:47Z
class:
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolateQueryBuilderTests.java
comments:
PercolateQuery is never cacheable

time:
2016-10-05T14:03:29Z
class:
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java
comments:
Fix percolator queries to not be cacheable

time:
2016-10-05T10:22:54Z
class:
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/internal/SearchContext.java
comments:
cleanup freeze methods and move them down to QueryShardContext

time:
2016-10-05T10:14:48Z
class:
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/main/java/org/elasticsearch/search/SearchService.java
comments:
clone the entire serach context for rewriting

time:
2016-10-05T09:51:41Z
class:
comments:
Merge branch 'master' into dont_cache_scripts

time:
2016-10-05T09:41:49Z
class:
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/internal/SearchContext.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
comments:
use a private rewrite context to prevent exposing isCachable

time:
2016-10-05T08:45:24Z
class:
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/index/query/functionscore/RandomScoreFunctionBuilder.java
core/src/main/java/org/elasticsearch/search/internal/SearchContext.java
core/src/test/java/org/elasticsearch/index/query/QueryShardContextTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/rescore/QueryRescoreBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/test/java/org/elasticsearch/search/MockSearchServiceTests.java
comments:
fix random score function builder to deal with empty seeds

time:
2016-10-05T08:45:24Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/AbstractRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/AbstractRangeBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/DateRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/DateRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceRangeAggregatorFactory.java
core/src/test/java/org/elasticsearch/indices/IndicesRequestCacheIT.java
comments:
Fix date_range aggregation to not cache if now is used

Before this change the processing of the ranges in the date range (and
other range type) aggregations was done when the Aggregator was created.
This meant that the SearchContext did not know that now had been used in
a range until after the decision to cache was made.

This change moves the processing of the ranges to the aggregation builders
so that the search context is made aware that now has been used before
it decides if the request should be cached

time:
2016-10-05T08:45:24Z
class:
comments:
ingest: Upgrade geoip2 dependency

Closes #20563

time:
2016-10-05T08:45:24Z
class:
core/src/main/java/org/elasticsearch/rest/BaseRestHandler.java
core/src/main/java/org/elasticsearch/rest/RestRequest.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeAction.java
core/src/test/java/org/elasticsearch/rest/BaseRestHandlerTests.java
comments:
Add did you mean to strict REST params

This commit adds a did you mean feature to the strict REST params error
message. This works by comparing any unconsumed parameters to all of the
consumer parameters, comparing the Levenstein distance between those
parameters, and taking any consumed parameters that are close to an
unconsumed parameter as candiates for the did you mean.

* Fix pluralization in strict REST params message

This commit fixes the pluralization in the strict REST parameters error
message so that the word "parameter" is not unconditionally written as
"parameters" even when there is only one unrecognized parameter.

* Strength strict REST params did you mean test

This commit adds an unconsumed parameter that is too far from every
consumed parameter to have any candidate suggestions.

Relates #20747

time:
2016-10-05T08:45:24Z
class:
core/src/main/java/org/elasticsearch/rest/BaseRestHandler.java
core/src/test/java/org/elasticsearch/rest/BaseRestHandlerTests.java
comments:
Clarify wording for the strict REST params message

This commit changes the strict REST parameters message to say that
unconsumed parameters are unrecognized rather than unused. Additionally,
the test is beefed up to include two unused parameters.

Relates #20745

time:
2016-10-05T08:45:24Z
class:
core/src/main/java/org/elasticsearch/action/bulk/BulkShardRequest.java
comments:
Make getter for bulk shard requests items visible (#20743)

time:
2016-10-05T08:32:31Z
class:
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java
comments:
fix check style errors

time:
2016-10-05T08:15:00Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/derivative/DerivativePipelineAggregationBuilder.java
comments:
move extended bounds rounding to date histo agg builder

time:
2016-10-05T08:05:58Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregatorFactory.java
comments:
move extended bounds parse and validate to date hitso factory

time:
2016-10-05T07:41:48Z
class:
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyDateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TTLFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/ExtendedBounds.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/SignificanceHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/support/AggregationContext.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/internal/FilteredSearchContext.java
core/src/main/java/org/elasticsearch/search/internal/SearchContext.java
core/src/main/java/org/elasticsearch/search/sort/ScriptSortBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggester.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionContext.java
core/src/test/java/org/elasticsearch/index/SearchSlowLogTests.java
core/src/test/java/org/elasticsearch/index/query/QueryShardContextTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/ExtendedBoundsTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilderTests.java
core/src/test/java/org/elasticsearch/search/rescore/QueryRescoreBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TemplateQueryBuilder.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java
test/framework/src/main/java/org/elasticsearch/test/TestSearchContext.java
test/framework/src/test/java/org/elasticsearch/search/MockSearchServiceTests.java
comments:
add extra safety when accessing scripts or now and reqeusts are cached

time:
2016-10-05T07:39:08Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/AbstractRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/AbstractRangeBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/DateRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/DateRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceRangeAggregatorFactory.java
core/src/test/java/org/elasticsearch/indices/IndicesRequestCacheIT.java
comments:
Fix date_range aggregation to not cache if now is used

Before this change the processing of the ranges in the date range (and
other range type) aggregations was done when the Aggregator was created.
This meant that the SearchContext did not know that now had been used in
a range until after the decision to cache was made.

This change moves the processing of the ranges to the aggregation builders
so that the search context is made aware that now has been used before
it decides if the request should be cached

time:
2016-10-05T07:31:55Z
class:
comments:
ingest: Upgrade geoip2 dependency

Closes #20563

time:
2016-10-05T00:45:07Z
class:
core/src/main/java/org/elasticsearch/rest/BaseRestHandler.java
core/src/main/java/org/elasticsearch/rest/RestRequest.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeAction.java
core/src/test/java/org/elasticsearch/rest/BaseRestHandlerTests.java
comments:
Add did you mean to strict REST params

This commit adds a did you mean feature to the strict REST params error
message. This works by comparing any unconsumed parameters to all of the
consumer parameters, comparing the Levenstein distance between those
parameters, and taking any consumed parameters that are close to an
unconsumed parameter as candiates for the did you mean.

* Fix pluralization in strict REST params message

This commit fixes the pluralization in the strict REST parameters error
message so that the word "parameter" is not unconditionally written as
"parameters" even when there is only one unrecognized parameter.

* Strength strict REST params did you mean test

This commit adds an unconsumed parameter that is too far from every
consumed parameter to have any candidate suggestions.

Relates #20747

time:
2016-10-04T23:47:47Z
class:
core/src/main/java/org/elasticsearch/rest/BaseRestHandler.java
core/src/test/java/org/elasticsearch/rest/BaseRestHandlerTests.java
comments:
Clarify wording for the strict REST params message

This commit changes the strict REST parameters message to say that
unconsumed parameters are unrecognized rather than unused. Additionally,
the test is beefed up to include two unused parameters.

Relates #20745

time:
2016-10-04T21:24:29Z
class:
core/src/main/java/org/elasticsearch/action/bulk/BulkShardRequest.java
comments:
Make getter for bulk shard requests items visible (#20743)

time:
2016-10-04T19:09:40Z
class:
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/RestNoopBulkAction.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/search/RestNoopSearchAction.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequest.java
core/src/main/java/org/elasticsearch/action/support/tasks/BaseTasksRequest.java
core/src/main/java/org/elasticsearch/action/support/tasks/TasksRequestBuilder.java
core/src/main/java/org/elasticsearch/action/support/tasks/TransportTasksAction.java
core/src/main/java/org/elasticsearch/action/termvectors/MultiTermVectorsRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/main/java/org/elasticsearch/index/mapper/TTLFieldMapper.java
core/src/main/java/org/elasticsearch/rest/AbstractRestChannel.java
core/src/main/java/org/elasticsearch/rest/BaseRestHandler.java
core/src/main/java/org/elasticsearch/rest/RestController.java
core/src/main/java/org/elasticsearch/rest/RestRequest.java
core/src/main/java/org/elasticsearch/rest/action/RestFieldStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/RestMainAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestCancelTasksAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterAllocationExplainAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterGetSettingsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterHealthAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterRerouteAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterSearchShardsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterStateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestCreateSnapshotAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestDeleteRepositoryAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestDeleteSnapshotAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestDeleteStoredScriptAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestGetRepositoriesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestGetSnapshotsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestGetStoredScriptAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestGetTaskAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestListTasksAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesHotThreadsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesInfoAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestPendingClusterTasksAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestPutRepositoryAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestPutStoredScriptAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestRestoreSnapshotAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestSnapshotsStatusAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestVerifyRepositoryAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAliasesExistAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestClearIndicesCacheAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestCloseIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestCreateIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestDeleteIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestDeleteIndexTemplateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestFlushAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestForceMergeAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetFieldMappingAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetIndexTemplateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetIndicesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetMappingAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetSettingsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestHeadIndexTemplateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndexDeleteAliasesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndexPutAliasAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesAliasesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesExistsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesSegmentsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesShardStoresAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestOpenIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestPutIndexTemplateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestPutMappingAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestRecoveryAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestRefreshAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestRolloverIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestShrinkIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestSyncedFlushAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestTypesExistsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestUpgradeAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestValidateQueryAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/AbstractCatAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestAllocationAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestCatAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestFielddataAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestHealthAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestIndicesAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestMasterAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestNodeAttrsAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestNodesAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestPendingClusterTasksAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestPluginsAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestRecoveryAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestRepositoriesAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestSegmentsAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestShardsAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestSnapshotAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTable.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTasksAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTemplatesAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestThreadPoolAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestBulkAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestDeleteAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestGetAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestGetSourceAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestHeadAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestMultiGetAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestMultiTermVectorsAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestTermVectorsAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestUpdateAction.java
core/src/main/java/org/elasticsearch/rest/action/ingest/RestDeletePipelineAction.java
core/src/main/java/org/elasticsearch/rest/action/ingest/RestGetPipelineAction.java
core/src/main/java/org/elasticsearch/rest/action/ingest/RestPutPipelineAction.java
core/src/main/java/org/elasticsearch/rest/action/ingest/RestSimulatePipelineAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestClearScrollAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestExplainAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchScrollAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSuggestAction.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TransportTasksActionTests.java
core/src/test/java/org/elasticsearch/common/network/NetworkModuleTests.java
core/src/test/java/org/elasticsearch/rest/BaseRestHandlerTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestMultiSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestRenderSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestSearchTemplateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateRequest.java
modules/percolator/src/main/java/org/elasticsearch/percolator/RestMultiPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/RestPercolateAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBaseReindexRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestRethrottleAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestUpdateByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuilders.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuildersTests.java
plugins/jvm-example/src/main/java/org/elasticsearch/plugin/example/ExampleCatAction.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/TestDeprecationHeaderRestAction.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/TestResponseHeaderRestAction.java
comments:
Merge branch 'master' into dont_cache_scripts

time:
2016-10-04T19:05:22Z
class:
core/src/main/java/org/elasticsearch/action/DocumentRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
comments:
ensure bwc wire compatibility

time:
2016-10-04T18:31:51Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregationBuilder.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateRangeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DoubleTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/HistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/LongTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/RangeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsSignificanceScoreIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/StringTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/AvgIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/CardinalityIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ExtendedStatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MaxIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MinIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ScriptedMetricIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/StatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/SumIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ValueCountIT.java
comments:
Tests to make sure markAsNotCacheable() works when scripts are used

time:
2016-10-04T18:06:17Z
class:
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/RestNoopBulkAction.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/search/RestNoopSearchAction.java
core/src/main/java/org/elasticsearch/action/CompositeIndicesRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/IndicesAliasesRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequest.java
core/src/main/java/org/elasticsearch/action/support/tasks/BaseTasksRequest.java
core/src/main/java/org/elasticsearch/action/support/tasks/TasksRequestBuilder.java
core/src/main/java/org/elasticsearch/action/support/tasks/TransportTasksAction.java
core/src/main/java/org/elasticsearch/action/termvectors/MultiTermVectorsRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/cluster/ClusterModule.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/main/java/org/elasticsearch/index/mapper/TTLFieldMapper.java
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/main/java/org/elasticsearch/indices/store/IndicesStore.java
core/src/main/java/org/elasticsearch/rest/AbstractRestChannel.java
core/src/main/java/org/elasticsearch/rest/BaseRestHandler.java
core/src/main/java/org/elasticsearch/rest/RestController.java
core/src/main/java/org/elasticsearch/rest/RestRequest.java
core/src/main/java/org/elasticsearch/rest/action/RestFieldStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/RestMainAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestCancelTasksAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterAllocationExplainAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterGetSettingsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterHealthAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterRerouteAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterSearchShardsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterStateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestCreateSnapshotAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestDeleteRepositoryAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestDeleteSnapshotAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestDeleteStoredScriptAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestGetRepositoriesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestGetSnapshotsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestGetStoredScriptAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestGetTaskAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestListTasksAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesHotThreadsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesInfoAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestPendingClusterTasksAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestPutRepositoryAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestPutStoredScriptAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestRestoreSnapshotAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestSnapshotsStatusAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestVerifyRepositoryAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAliasesExistAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestClearIndicesCacheAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestCloseIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestCreateIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestDeleteIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestDeleteIndexTemplateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestFlushAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestForceMergeAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetFieldMappingAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetIndexTemplateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetIndicesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetMappingAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetSettingsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestHeadIndexTemplateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndexDeleteAliasesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndexPutAliasAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesAliasesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesExistsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesSegmentsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesShardStoresAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestOpenIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestPutIndexTemplateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestPutMappingAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestRecoveryAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestRefreshAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestRolloverIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestShrinkIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestSyncedFlushAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestTypesExistsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestUpgradeAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestValidateQueryAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/AbstractCatAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestAllocationAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestCatAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestFielddataAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestHealthAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestIndicesAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestMasterAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestNodeAttrsAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestNodesAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestPendingClusterTasksAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestPluginsAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestRecoveryAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestRepositoriesAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestSegmentsAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestShardsAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestSnapshotAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTable.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTasksAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTemplatesAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestThreadPoolAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestBulkAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestDeleteAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestGetAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestGetSourceAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestHeadAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestMultiGetAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestMultiTermVectorsAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestTermVectorsAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestUpdateAction.java
core/src/main/java/org/elasticsearch/rest/action/ingest/RestDeletePipelineAction.java
core/src/main/java/org/elasticsearch/rest/action/ingest/RestGetPipelineAction.java
core/src/main/java/org/elasticsearch/rest/action/ingest/RestPutPipelineAction.java
core/src/main/java/org/elasticsearch/rest/action/ingest/RestSimulatePipelineAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestClearScrollAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestExplainAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchScrollAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSuggestAction.java
core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TransportTasksActionTests.java
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/bwcompat/RestoreBackwardsCompatIT.java
core/src/test/java/org/elasticsearch/cluster/ClusterModuleTests.java
core/src/test/java/org/elasticsearch/common/network/NetworkModuleTests.java
core/src/test/java/org/elasticsearch/rest/BaseRestHandlerTests.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceIT.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestMultiSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestRenderSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestSearchTemplateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateRequest.java
modules/percolator/src/main/java/org/elasticsearch/percolator/RestMultiPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/RestPercolateAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBaseReindexRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestRethrottleAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestUpdateByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuilders.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuildersTests.java
plugins/jvm-example/src/main/java/org/elasticsearch/plugin/example/ExampleCatAction.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/TestDeprecationHeaderRestAction.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/TestResponseHeaderRestAction.java
comments:
Merge branch 'master' into cleanup/transport_bulk

time:
2016-10-04T16:45:29Z
class:
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/RestNoopBulkAction.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/search/RestNoopSearchAction.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequest.java
core/src/main/java/org/elasticsearch/action/support/tasks/BaseTasksRequest.java
core/src/main/java/org/elasticsearch/action/support/tasks/TasksRequestBuilder.java
core/src/main/java/org/elasticsearch/action/support/tasks/TransportTasksAction.java
core/src/main/java/org/elasticsearch/action/termvectors/MultiTermVectorsRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/main/java/org/elasticsearch/index/mapper/TTLFieldMapper.java
core/src/main/java/org/elasticsearch/rest/AbstractRestChannel.java
core/src/main/java/org/elasticsearch/rest/BaseRestHandler.java
core/src/main/java/org/elasticsearch/rest/RestController.java
core/src/main/java/org/elasticsearch/rest/RestRequest.java
core/src/main/java/org/elasticsearch/rest/action/RestFieldStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/RestMainAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestCancelTasksAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterAllocationExplainAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterGetSettingsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterHealthAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterRerouteAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterSearchShardsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterStateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestCreateSnapshotAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestDeleteRepositoryAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestDeleteSnapshotAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestDeleteStoredScriptAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestGetRepositoriesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestGetSnapshotsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestGetStoredScriptAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestGetTaskAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestListTasksAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesHotThreadsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesInfoAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestPendingClusterTasksAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestPutRepositoryAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestPutStoredScriptAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestRestoreSnapshotAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestSnapshotsStatusAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestVerifyRepositoryAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAliasesExistAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestClearIndicesCacheAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestCloseIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestCreateIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestDeleteIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestDeleteIndexTemplateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestFlushAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestForceMergeAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetFieldMappingAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetIndexTemplateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetIndicesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetMappingAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetSettingsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestHeadIndexTemplateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndexDeleteAliasesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndexPutAliasAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesAliasesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesExistsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesSegmentsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesShardStoresAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestOpenIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestPutIndexTemplateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestPutMappingAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestRecoveryAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestRefreshAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestRolloverIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestShrinkIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestSyncedFlushAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestTypesExistsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestUpgradeAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestValidateQueryAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/AbstractCatAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestAllocationAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestCatAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestFielddataAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestHealthAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestIndicesAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestMasterAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestNodeAttrsAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestNodesAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestPendingClusterTasksAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestPluginsAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestRecoveryAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestRepositoriesAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestSegmentsAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestShardsAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestSnapshotAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTable.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTasksAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTemplatesAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestThreadPoolAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestBulkAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestDeleteAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestGetAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestGetSourceAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestHeadAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestMultiGetAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestMultiTermVectorsAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestTermVectorsAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestUpdateAction.java
core/src/main/java/org/elasticsearch/rest/action/ingest/RestDeletePipelineAction.java
core/src/main/java/org/elasticsearch/rest/action/ingest/RestGetPipelineAction.java
core/src/main/java/org/elasticsearch/rest/action/ingest/RestPutPipelineAction.java
core/src/main/java/org/elasticsearch/rest/action/ingest/RestSimulatePipelineAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestClearScrollAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestExplainAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchScrollAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSuggestAction.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TransportTasksActionTests.java
core/src/test/java/org/elasticsearch/common/network/NetworkModuleTests.java
core/src/test/java/org/elasticsearch/rest/BaseRestHandlerTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestMultiSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestRenderSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestSearchTemplateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateRequest.java
modules/percolator/src/main/java/org/elasticsearch/percolator/RestMultiPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/RestPercolateAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBaseReindexRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestRethrottleAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestUpdateByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuilders.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuildersTests.java
plugins/jvm-example/src/main/java/org/elasticsearch/plugin/example/ExampleCatAction.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/TestDeprecationHeaderRestAction.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/TestResponseHeaderRestAction.java
comments:
Remove lenient URL parameter parsing

Today when parsing a request, Elasticsearch silently ignores incorrect
(including parameters with typos) or unused parameters. This is bad as
it leads to requests having unintended behavior (e.g., if a user hits
the _analyze API and misspell the "tokenizer" then Elasticsearch will
just use the standard analyzer, completely against intentions).

This commit removes lenient URL parameter parsing. The strategy is
simple: when a request is handled and a parameter is touched, we mark it
as such. Before the request is actually executed, we check to ensure
that all parameters have been consumed. If there are remaining
parameters yet to be consumed, we fail the request with a list of the
unconsumed parameters. An exception has to be made for parameters that
format the response (as opposed to controlling the request); for this
case, handlers are able to provide a list of parameters that should be
excluded from tripping the unconsumed parameters check because those
parameters will be used in formatting the response.

Additionally, some inconsistencies between the parameters in the code
and in the docs are corrected.

Relates #20722

time:
2016-10-04T16:05:00Z
class:
core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/SignificanceHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/internal/SearchContext.java
core/src/main/java/org/elasticsearch/search/sort/ScriptSortBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionBuilder.java
core/src/test/java/org/elasticsearch/index/query/ScriptQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TemplateQueryBuilder.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
comments:
Add a #markAsNotCachable() method to context to mark requests as not cachable

time:
2016-10-04T15:32:08Z
class:
comments:
File descriptors limit doesn't apply to Windows

On Windows the JDK uses `CreateFileW` which has a stupidly high
limit for the number of `Handle`s it can make - `16 * 1024 * 1024`.
So this isn't really a problem on Windows at all.

Closes #20732

time:
2016-10-04T12:54:51Z
class:
core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceIT.java
comments:
Geo-distance sorting should use `POSITIVE_INFINITY` for missing geo points instead of `MAX_VALUE`.

This is consistent with the behaviour of geo sorting in Lucene and also numeric
fields in Elasticsearch.

Closes #20733

time:
2016-10-04T12:36:43Z
class:
core/src/main/java/org/elasticsearch/cluster/ClusterModule.java
core/src/test/java/org/elasticsearch/cluster/ClusterModuleTests.java
comments:
Process more expensive allocation deciders last (#20724)

Today, the individual allocation deciders appear in random
order when initialized in AllocationDeciders, which means
potentially more performance intensive allocation deciders
could run before less expensive deciders. This adds to the
execution time when a less expensive decider could terminate
the decision making process early with a NO decision. This
commit orders the initialization of allocation deciders,
based on a general assessment of the big O runtime of each
decider, moving the likely more expensive deciders last.

Closes #12815

time:
2016-10-04T11:22:25Z
class:
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/main/java/org/elasticsearch/indices/store/IndicesStore.java
comments:
Skip shard management code when updating cluster state on client/tribe nodes (#20731)

IndicesClusterStateService and IndicesStore are responsible for synchronizing local shard state based on incoming cluster state updates. On client/tribe nodes, which don't store any such shard/index data/metadata, all of the logic that computes which data is to be deleted, which shards to be initialized etc. can be completely skipped, saving precious CPU cycles.

time:
2016-10-04T09:28:07Z
class:
core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderTests.java
comments:
Optimized LatLon sorting does not work in the descending order.

time:
2016-10-04T08:39:22Z
class:
core/src/main/java/org/elasticsearch/action/CompositeIndicesRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/IndicesAliasesRequest.java
comments:
IndicesAliasesRequest should not implement CompositeIndicesRequest (#20726)

CompositeIndicesRequest should be implemented by all requests that are composed of multiple subrequests which relate to one or more indices. A composite request is
executed by its own transport action class (e.g. TransportMultiSearchAction for _msearch), which goes through all the subrequests and delegates their execution to the appropriate transport action (e.g. TransportSearchAction for _msearch) for each single item. IndicesAliasesRequest is a particular request as it holds multiple items that implement AliasesRequest, but it shouldn't be considered a composite request, as it has no specific transport action for each of its items. Also, either all of its subitems fail or succeed.

Also clarified javadocs for CompositeIndicesRequest.

time:
2016-10-04T08:20:45Z
class:
comments:
Upgrade microbenchmarks to JMH 1.15

time:
2016-10-04T04:40:43Z
class:
comments:
Build: Use more general archivesBaseName setting, to ensure pom uses
matching file name

time:
2016-10-03T22:45:44Z
class:
comments:
Update favicon (#20727)

We have new icons for elastic products with 5.0. This change updates the
favicon embedded in elasticsearch that users see when using the rest api
through a browser.

time:
2016-10-03T21:46:10Z
class:
core/src/test/java/org/elasticsearch/bwcompat/RestoreBackwardsCompatIT.java
comments:
Skip prereleases for restore bwc tests too

time:
2016-10-03T21:23:29Z
class:
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
comments:
Skip prereleases in static bwc tests

time:
2016-10-03T20:12:11Z
class:
benchmarks/src/main/java/org/elasticsearch/benchmark/routing/allocation/AllocationBenchmark.java
benchmarks/src/main/java/org/elasticsearch/benchmark/routing/allocation/Allocators.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/AbstractBenchmark.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/BenchmarkMain.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/BenchmarkRunner.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/metrics/Metrics.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/metrics/MetricsCalculator.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/metrics/Sample.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/metrics/SampleRecorder.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/ops/bulk/BulkBenchmarkTask.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/ops/search/SearchBenchmarkTask.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/rest/RestClientBenchmark.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/transport/TransportClientBenchmark.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/NoopPlugin.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/NoopBulkAction.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/NoopBulkRequestBuilder.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/RestNoopBulkAction.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/TransportNoopBulkAction.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/search/NoopSearchAction.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/search/NoopSearchRequestBuilder.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/search/RestNoopSearchAction.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/search/TransportNoopSearchAction.java
client/rest/src/main/java/org/elasticsearch/client/Response.java
client/rest/src/main/java/org/elasticsearch/client/ResponseException.java
client/rest/src/main/java/org/elasticsearch/client/RestClient.java
client/rest/src/main/java/org/elasticsearch/client/RestClientBuilder.java
client/rest/src/test/java/org/elasticsearch/client/RestClientBuilderTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientIntegTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientMultipleHostsTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostTests.java
client/sniffer/src/main/java/org/elasticsearch/client/sniff/Sniffer.java
client/test/src/main/java/org/elasticsearch/client/RestClientTestCase.java
client/transport/src/test/java/org/elasticsearch/transport/client/PreBuiltTransportClientTests.java
core/src/main/java/org/apache/logging/log4j/core/impl/ThrowableProxy.java
core/src/main/java/org/apache/logging/log4j/core/jmx/Server.java
core/src/main/java/org/apache/lucene/analysis/miscellaneous/UniqueTokenFilter.java
core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
core/src/main/java/org/apache/lucene/store/StoreRateLimiting.java
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/ExceptionsHelper.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/TransportClusterAllocationExplainAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodeInfo.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/info/PluginsAndModules.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStats.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodesStatsRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/TransportGetTaskAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/reroute/TransportClusterRerouteAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/settings/TransportClusterUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/SnapshotsStatusRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/SnapshotsStatusRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/TransportSnapshotsStatusAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/TransportClusterStatsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/IndicesAliasesClusterStateUpdateRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/IndicesAliasesRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/IndicesAliasesRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/TransportIndicesAliasesAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/DetailAnalyzeResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/TransportAnalyzeAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/close/TransportCloseIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexClusterStateUpdateRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/create/TransportCreateIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/delete/TransportDeleteIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/flush/FlushRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/TransportPutMappingAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/open/TransportOpenIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/put/TransportUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/shards/TransportIndicesShardStoresAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/shrink/TransportShrinkAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStats.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStatsFlags.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/ShardStats.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/delete/TransportDeleteIndexTemplateAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/get/GetIndexTemplatesResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/TransportPutIndexTemplateAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/post/TransportUpgradeSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/TransportValidateQueryAction.java
core/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequestHandler.java
core/src/main/java/org/elasticsearch/action/bulk/BulkShardRequest.java
core/src/main/java/org/elasticsearch/action/bulk/Retry.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/explain/ExplainRequest.java
core/src/main/java/org/elasticsearch/action/explain/ExplainRequestBuilder.java
core/src/main/java/org/elasticsearch/action/explain/TransportExplainAction.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStats.java
core/src/main/java/org/elasticsearch/action/get/GetRequest.java
core/src/main/java/org/elasticsearch/action/get/GetRequestBuilder.java
core/src/main/java/org/elasticsearch/action/get/GetResponse.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequest.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequestBuilder.java
core/src/main/java/org/elasticsearch/action/get/MultiGetShardRequest.java
core/src/main/java/org/elasticsearch/action/get/TransportGetAction.java
core/src/main/java/org/elasticsearch/action/get/TransportShardMultiGetAction.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/index/IndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/index/IndexResponse.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/ingest/IngestActionFilter.java
core/src/main/java/org/elasticsearch/action/main/MainResponse.java
core/src/main/java/org/elasticsearch/action/main/TransportMainAction.java
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchRequestBuilder.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/TransportClearScrollAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java
core/src/main/java/org/elasticsearch/action/support/AbstractListenableActionFuture.java
core/src/main/java/org/elasticsearch/action/support/ActiveShardCount.java
core/src/main/java/org/elasticsearch/action/support/AutoCreateIndex.java
core/src/main/java/org/elasticsearch/action/support/HandledTransportAction.java
core/src/main/java/org/elasticsearch/action/support/ThreadedActionListener.java
core/src/main/java/org/elasticsearch/action/support/TransportAction.java
core/src/main/java/org/elasticsearch/action/support/broadcast/TransportBroadcastAction.java
core/src/main/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeAction.java
core/src/main/java/org/elasticsearch/action/support/master/TransportMasterNodeAction.java
core/src/main/java/org/elasticsearch/action/support/nodes/TransportNodesAction.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationOperation.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationRequest.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/main/java/org/elasticsearch/action/support/single/shard/TransportSingleShardAction.java
core/src/main/java/org/elasticsearch/action/support/tasks/TransportTasksAction.java
core/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java
core/src/main/java/org/elasticsearch/action/termvectors/TransportShardMultiTermsVectorAction.java
core/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequestBuilder.java
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapException.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapSettings.java
core/src/main/java/org/elasticsearch/bootstrap/Elasticsearch.java
core/src/main/java/org/elasticsearch/bootstrap/ElasticsearchUncaughtExceptionHandler.java
core/src/main/java/org/elasticsearch/bootstrap/JNACLibrary.java
core/src/main/java/org/elasticsearch/bootstrap/JNAKernel32Library.java
core/src/main/java/org/elasticsearch/bootstrap/JNANatives.java
core/src/main/java/org/elasticsearch/bootstrap/JarHell.java
core/src/main/java/org/elasticsearch/bootstrap/Natives.java
core/src/main/java/org/elasticsearch/bootstrap/Seccomp.java
core/src/main/java/org/elasticsearch/bootstrap/Security.java
core/src/main/java/org/elasticsearch/bootstrap/StartupException.java
core/src/main/java/org/elasticsearch/cli/Command.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java
core/src/main/java/org/elasticsearch/cluster/ClusterModule.java
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateObserver.java
core/src/main/java/org/elasticsearch/cluster/InternalClusterInfoService.java
core/src/main/java/org/elasticsearch/cluster/NodeConnectionsService.java
core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java
core/src/main/java/org/elasticsearch/cluster/health/ClusterIndexHealth.java
core/src/main/java/org/elasticsearch/cluster/health/ClusterShardHealth.java
core/src/main/java/org/elasticsearch/cluster/metadata/AliasAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/AliasValidator.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexGraveyard.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolver.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateFilter.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataDeleteIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexStateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java
core/src/main/java/org/elasticsearch/cluster/routing/DelayedAllocationService.java
core/src/main/java/org/elasticsearch/cluster/routing/IndexRoutingTable.java
core/src/main/java/org/elasticsearch/cluster/routing/RecoverySource.java
core/src/main/java/org/elasticsearch/cluster/routing/RestoreSource.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingChangesObserver.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingNode.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingService.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java
core/src/main/java/org/elasticsearch/cluster/routing/ShardRouting.java
core/src/main/java/org/elasticsearch/cluster/routing/UnassignedInfo.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationService.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/DiskThresholdMonitor.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/FailedRerouteAllocation.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/FailedShard.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/IndexMetaDataUpdater.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RoutingAllocation.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RoutingNodesChangedObserver.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/StaleShard.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/StartedRerouteAllocation.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/UnassignedShardDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/AbstractAllocateAllocationCommand.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/AllocateEmptyPrimaryAllocationCommand.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/AllocateStalePrimaryAllocationCommand.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AllocationDeciders.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AwarenessAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ClusterRebalanceAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ConcurrentRebalanceAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/EnableAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/FilterAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/MaxRetryAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/NodeVersionAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/RebalanceOnlyWhenActiveAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ReplicaAfterPrimaryActiveAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/SameShardAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ShardsLimitAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/SnapshotInProgressAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ThrottlingAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/common/SuppressLoggerChecks.java
core/src/main/java/org/elasticsearch/common/blobstore/fs/FsBlobStore.java
core/src/main/java/org/elasticsearch/common/blobstore/url/URLBlobStore.java
core/src/main/java/org/elasticsearch/common/breaker/ChildMemoryCircuitBreaker.java
core/src/main/java/org/elasticsearch/common/breaker/MemoryCircuitBreaker.java
core/src/main/java/org/elasticsearch/common/component/AbstractComponent.java
core/src/main/java/org/elasticsearch/common/geo/GeoPoint.java
core/src/main/java/org/elasticsearch/common/geo/builders/ShapeBuilder.java
core/src/main/java/org/elasticsearch/common/inject/spi/Elements.java
core/src/main/java/org/elasticsearch/common/io/FileSystemUtils.java
core/src/main/java/org/elasticsearch/common/io/stream/NamedWriteableRegistry.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java
core/src/main/java/org/elasticsearch/common/io/stream/Writeable.java
core/src/main/java/org/elasticsearch/common/logging/ConsoleAppender.java
core/src/main/java/org/elasticsearch/common/logging/DeprecationLogger.java
core/src/main/java/org/elasticsearch/common/logging/ESLogger.java
core/src/main/java/org/elasticsearch/common/logging/ESLoggerFactory.java
core/src/main/java/org/elasticsearch/common/logging/LogConfigurator.java
core/src/main/java/org/elasticsearch/common/logging/Loggers.java
core/src/main/java/org/elasticsearch/common/logging/PrefixLogger.java
core/src/main/java/org/elasticsearch/common/lucene/LoggerInfoStream.java
core/src/main/java/org/elasticsearch/common/lucene/Lucene.java
core/src/main/java/org/elasticsearch/common/network/IfConfig.java
core/src/main/java/org/elasticsearch/common/network/NetworkModule.java
core/src/main/java/org/elasticsearch/common/network/NetworkUtils.java
core/src/main/java/org/elasticsearch/common/settings/AbstractScopedSettings.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/settings/SettingsModule.java
core/src/main/java/org/elasticsearch/common/unit/ByteSizeUnit.java
core/src/main/java/org/elasticsearch/common/unit/ByteSizeValue.java
core/src/main/java/org/elasticsearch/common/unit/MemorySizeValue.java
core/src/main/java/org/elasticsearch/common/unit/SizeValue.java
core/src/main/java/org/elasticsearch/common/unit/TimeValue.java
core/src/main/java/org/elasticsearch/common/util/IndexFolderUpgrader.java
core/src/main/java/org/elasticsearch/common/util/PageCacheRecycler.java
core/src/main/java/org/elasticsearch/common/util/concurrent/AbstractLifecycleRunnable.java
comments:
Merge branch 'master' into cleanup/transport_bulk

time:
2016-10-03T16:27:34Z
class:
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java
core/src/main/java/org/elasticsearch/index/analysis/AnalysisRegistry.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LatLonPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ObjectMapper.java
core/src/test/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilderTests.java
core/src/test/java/org/elasticsearch/indices/analysis/AnalysisModuleTests.java
comments:
Build: Add 5.0.0-rc1 version (#20721)

This change also fixes the version name for beta1, as it was never
updated from alpha6 in master.

time:
2016-10-03T15:33:08Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingNode.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/test/java/org/elasticsearch/indices/cluster/AbstractIndicesClusterStateServiceTestCase.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
comments:
IndicesClusterStateService should clean local started when re-assigns an initializing shard with the same aid (#20687)

When a node get disconnected from the cluster and rejoins during a master election, it may be that the new master already has that node in it's cluster and will try to assign it shards. If the node hosts started primaries, the new shards will be initializing and will have the same allocation id as the allocation ids of the current started size. We currently do not recognize this currently. We should clean the current IndexShard instances and initialize new ones.

This also hardens test assertions in the same area.

time:
2016-10-03T15:27:57Z
class:
core/src/main/java/org/elasticsearch/common/lucene/Lucene.java
core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderIT.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderTests.java
comments:
Optimize geo-distance sorting.

This makes geo-distance sorting use `LatLonDocValuesField.newDistanceSort`
whenever applicable, which should be faster that the current approach since it
tracks a bounding box that documents need to be in in order to be competitive
instead of doing a costly distance computation all the time.

Closes #20450

time:
2016-10-03T14:52:33Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexClusterStateUpdateRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/create/TransportCreateIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/shrink/TransportShrinkAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/test/java/org/elasticsearch/action/admin/indices/rollover/RolloverIT.java
core/src/test/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverActionTests.java
core/src/test/java/org/elasticsearch/indices/DateMathIndexExpressionsIntegrationIT.java
test/framework/src/main/java/org/elasticsearch/test/InternalSettingsPlugin.java
comments:
Add date-math support to `_rollover` (#20709)

today it's not possible to use date-math efficiently with the `_rollover`
API. This change adds support for date-math in the target index as well as
support for preserving the math logic when an existing index that was created with
a date math expression all subsequent indices are created with the same expression.

time:
2016-10-03T13:22:56Z
class:
comments:
CONSOLEify some aggs docs

Cleans up the example result in `children-aggregation` so that
it matches the example data.

Relates to #18160

time:
2016-10-03T13:04:37Z
class:
plugins/repository-azure/src/test/java/org/elasticsearch/repositories/azure/AzureSnapshotRestoreServiceIntegTests.java
comments:
[Docs] Log snapshot shard failures in AzureSnapshotRestoreServiceIntegTests

This commit adds logs when a snapshot has failures for some snapshoted shards.

time:
2016-10-03T09:30:23Z
class:
comments:
 [Docs] Adapt //TESTREPONSE for Windows platforms

 This commit adapts a //TESTRESPONSE check in the getting-started.asciidoc because the Load Average is not available on Windows platforms.

time:
2016-10-01T10:56:23Z
class:
comments:
CONSOLEify the first half of getting-started

Adds a `// TESTRESPONSE[_cat]` syntax that sets up some substitutions
useful for asserting that _cat APIs match.

time:
2016-09-30T15:19:30Z
class:
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapSettings.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/unit/TimeValue.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySettings.java
core/src/main/java/org/elasticsearch/ingest/ConfigurationUtils.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTestHelper.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapCheckTests.java
core/src/test/java/org/elasticsearch/cluster/settings/ClusterSettingsIT.java
core/src/test/java/org/elasticsearch/common/settings/SettingTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ForEachProcessor.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorFactoryTests.java
qa/evil-tests/src/test/java/org/elasticsearch/cluster/metadata/EvilSystemPropertyTests.java
test/framework/src/test/java/org/elasticsearch/test/test/LoggingListenerTests.java
comments:
merge from master

time:
2016-09-30T13:49:39Z
class:
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTestHelper.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
comments:
ESIndexLevelReplicationTestCase: Make it easier to add new TRA-based actions (#20708)

Right now our unit tests in that area only simulate indexing single documents. As we go forward it should be easy
to add other actions, like delete & bulk indexing. This commit extracts the common parts of the current indexing
logic to a based class make it easier to extend.

time:
2016-09-30T13:30:44Z
class:
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/unit/TimeValue.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySettings.java
core/src/test/java/org/elasticsearch/common/settings/SettingTests.java
comments:
Fix Setting.timeValue() methods (#20696)

The Setting.timeValue() method uses TimeValue.toString() which can produce fractional time values. These fractional time values cannot be parsed again by the settings framework.

This commit fix a method that still use the .toString() method and replaces it with .getStringRep(). It also changes a second method so that it's not up to the caller to decide which stringify method to call.

closes #20662

time:
2016-09-30T10:23:42Z
class:
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ForEachProcessor.java
comments:
docs: marked `foreach` processor as experimental

Closes #19602

time:
2016-09-30T06:36:13Z
class:
core/src/test/java/org/elasticsearch/cluster/settings/ClusterSettingsIT.java
comments:
Fix failling logger level update test

This commit fixes a failing cluster settings tests, namely the logger
level update test. The test was incorrectly assuming the default log
level was info, but it could be non-info, for example, if
tests.es.logger.level is set to some non-info level.

Closes #20318

time:
2016-09-30T06:09:35Z
class:
test/framework/src/test/java/org/elasticsearch/test/test/LoggingListenerTests.java
comments:
Fix failing logging listener tests

The logging listener tests started failing after
953a8a959b6c116d99ff41cb329adfcbbca94269 when the tests are run with
tests.es.logger.level set to any level other than debug. This is because
these tests were based around the assumption that the default logging
level was info, which was the case before that commit fixed setting the
default logging level via that system property. This commit fixes these
failing tests by adjusting this assumption to account for the fact that
the default logging level could be different.

time:
2016-09-30T00:18:54Z
class:
core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapSettings.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapCheckTests.java
comments:
Remove ignore system bootstrap checks

Today we allow system bootstrap checks to be ignored with a
setting. Yet, the system bootstrap checks are as vital to the health of
a production node as the non-system checks (e.g., the original bootstrap
check, the file descriptor check, is critical for reducing the chances
of data loss from being too low). This commit removes the ability to
ignore system bootstrap checks.

Relates #20511

time:
2016-09-29T11:26:14Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
qa/evil-tests/src/test/java/org/elasticsearch/cluster/metadata/EvilSystemPropertyTests.java
comments:
[TEST] Fix EvilSystemPropertyTests to be test order independent

time:
2016-09-29T09:34:52Z
class:
core/src/main/java/org/elasticsearch/ingest/ConfigurationUtils.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorFactoryTests.java
comments:
no null values in ingest configuration error messages (#20616)

The invalid ingest configuration field name used to show itself,
even when it was null, in error messages. Sometimes this does not make
sense.

e.g.
```[null] Only one of [file], [id], or [inline] may be configure```
vs.
```Only one of [file], [id], or [inline] may be configure```

The above deals with three fields, therefore this no one property
responsible.

time:
2016-09-29T09:13:17Z
class:
comments:
Stabelize tests in phrase-suggest.asciidoc

time:
2016-09-29T09:03:30Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
qa/evil-tests/src/test/java/org/elasticsearch/bootstrap/EvilSystemPropertyTests.java
comments:
Add a hard limit for `index.number_of_shard` (#20682)

this change adds a hard limit to `index.number_of_shard` that prevents
indices from being created that have more than 1024 shards. This is still
a huge limit and can only be changed via settings a system property.

time:
2016-09-29T01:58:02Z
class:
comments:
Fix failing doc tests in feature/seq_no

This commit fixes failing doc tests in feature/seq_no after merging
master into this branch.

time:
2016-09-29T01:04:43Z
class:
comments:
allow settings logging level via a sys config in unit tests

Pipe in the `tests.es.logger.level` system property to the log4j config file used in tests. We still default to info. Also adapts the logger name to use the first letter of packages.

time:
2016-09-29T01:04:43Z
class:
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/IngestCommonPlugin.java
comments:
[fix] JSON Processor was not properly added (#20613)

time:
2016-09-29T01:04:43Z
class:
comments:
[docs] [fix] `field` is no longer an option for the script processor (#20614)

time:
2016-09-29T01:04:43Z
class:
core/src/test/java/org/elasticsearch/index/mapper/NumberFieldMapperTests.java
comments:
[TEST] Fix NumberFieldMapperTests.testNoDocValues to call correct helper method.

time:
2016-09-29T01:04:37Z
class:
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/index/seqno/LocalCheckpointService.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/test/java/org/elasticsearch/action/index/IndexRequestTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/seqno/CheckpointsIT.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
core/src/test/java/org/elasticsearch/indices/cluster/AbstractIndicesClusterStateServiceTestCase.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySourceHandlerTests.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
comments:
Fix failing tests after merge

This commit fixes failing tests in feature/seq_no after merging master
in.

time:
2016-09-28T23:33:13Z
class:
comments:
allow settings logging level via a sys config in unit tests

Pipe in the `tests.es.logger.level` system property to the log4j config file used in tests. We still default to info. Also adapts the logger name to use the first letter of packages.

time:
2016-09-28T22:22:31Z
class:
benchmarks/src/main/java/org/elasticsearch/benchmark/routing/allocation/AllocationBenchmark.java
benchmarks/src/main/java/org/elasticsearch/benchmark/routing/allocation/Allocators.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/AbstractBenchmark.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/BenchmarkMain.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/BenchmarkRunner.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/BenchmarkTask.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/metrics/Metrics.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/metrics/MetricsCalculator.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/metrics/Sample.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/metrics/SampleRecorder.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/ops/bulk/BulkBenchmarkTask.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/ops/bulk/BulkRequestExecutor.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/ops/search/SearchBenchmarkTask.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/ops/search/SearchRequestExecutor.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/rest/RestClientBenchmark.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/transport/TransportClientBenchmark.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/NoopPlugin.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/NoopBulkAction.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/NoopBulkRequestBuilder.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/RestNoopBulkAction.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/TransportNoopBulkAction.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/search/NoopSearchAction.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/search/NoopSearchRequestBuilder.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/search/RestNoopSearchAction.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/search/TransportNoopSearchAction.java
client/rest/src/main/java/org/elasticsearch/client/HeapBufferedAsyncResponseConsumer.java
client/rest/src/main/java/org/elasticsearch/client/RequestLogger.java
client/rest/src/main/java/org/elasticsearch/client/Response.java
client/rest/src/main/java/org/elasticsearch/client/ResponseException.java
client/rest/src/main/java/org/elasticsearch/client/ResponseListener.java
client/rest/src/main/java/org/elasticsearch/client/RestClient.java
client/rest/src/main/java/org/elasticsearch/client/RestClientBuilder.java
client/rest/src/test/java/org/elasticsearch/client/CloseableBasicHttpResponse.java
client/rest/src/test/java/org/elasticsearch/client/FailureTrackingResponseListenerTests.java
client/rest/src/test/java/org/elasticsearch/client/HeapBufferedAsyncResponseConsumerTests.java
client/rest/src/test/java/org/elasticsearch/client/HostsTrackingFailureListener.java
client/rest/src/test/java/org/elasticsearch/client/RequestLoggerTests.java
client/rest/src/test/java/org/elasticsearch/client/ResponseExceptionTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientBuilderTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientIntegTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientMultipleHostsTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostTests.java
client/rest/src/test/java/org/elasticsearch/client/SyncResponseListenerTests.java
client/rest/src/test/java/org/elasticsearch/client/TrackingFailureListener.java
client/sniffer/src/main/java/org/elasticsearch/client/sniff/ElasticsearchHostsSniffer.java
client/sniffer/src/main/java/org/elasticsearch/client/sniff/HostsSniffer.java
client/sniffer/src/main/java/org/elasticsearch/client/sniff/SniffOnFailureListener.java
client/sniffer/src/main/java/org/elasticsearch/client/sniff/Sniffer.java
client/sniffer/src/main/java/org/elasticsearch/client/sniff/SnifferBuilder.java
client/sniffer/src/test/java/org/elasticsearch/client/sniff/ElasticsearchHostsSnifferTests.java
client/sniffer/src/test/java/org/elasticsearch/client/sniff/HostsSnifferBuilderTests.java
client/sniffer/src/test/java/org/elasticsearch/client/sniff/HostsSnifferTests.java
client/sniffer/src/test/java/org/elasticsearch/client/sniff/MockHostsSniffer.java
client/sniffer/src/test/java/org/elasticsearch/client/sniff/SniffOnFailureListenerTests.java
client/sniffer/src/test/java/org/elasticsearch/client/sniff/SnifferBuilderTests.java
client/test/src/main/java/org/elasticsearch/client/RestClientTestCase.java
client/transport/src/main/java/org/elasticsearch/transport/client/PreBuiltTransportClient.java
client/transport/src/test/java/org/elasticsearch/transport/client/PreBuiltTransportClientTests.java
core/src/main/java/org/apache/log4j/Java9Hack.java
core/src/main/java/org/apache/logging/log4j/core/impl/ThrowableProxy.java
core/src/main/java/org/apache/logging/log4j/core/jmx/Server.java
core/src/main/java/org/apache/lucene/analysis/miscellaneous/UniqueTokenFilter.java
core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
core/src/main/java/org/apache/lucene/search/postingshighlight/CustomPassageFormatter.java
core/src/main/java/org/apache/lucene/search/vectorhighlight/CustomFieldQuery.java
core/src/main/java/org/apache/lucene/store/StoreRateLimiting.java
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/ElasticsearchSecurityException.java
core/src/main/java/org/elasticsearch/ElasticsearchStatusException.java
core/src/main/java/org/elasticsearch/ExceptionsHelper.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/ActionListener.java
core/src/main/java/org/elasticsearch/action/ActionListenerResponseHandler.java
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/action/ActionRequest.java
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
core/src/main/java/org/elasticsearch/action/TransportActionNodeProxy.java
core/src/main/java/org/elasticsearch/action/WriteConsistencyLevel.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplanation.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/TransportClusterAllocationExplainAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodeInfo.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/info/PluginsAndModules.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStats.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodesStatsRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/cancel/CancelTasksResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/cancel/TransportCancelTasksAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/GetTaskResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/TransportGetTaskAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/list/ListTasksResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/list/TransportListTasksAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/reroute/TransportClusterRerouteAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/settings/TransportClusterUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/SnapshotsStatusRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/SnapshotsStatusRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/TransportSnapshotsStatusAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/state/TransportClusterStateAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/TransportClusterStatsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/IndicesAliasesClusterStateUpdateRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/IndicesAliasesRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/IndicesAliasesRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/TransportIndicesAliasesAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/DetailAnalyzeResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/TransportAnalyzeAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/close/TransportCloseIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexClusterStateUpdateRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/create/TransportCreateIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/delete/TransportDeleteIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/flush/FlushRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/flush/ShardFlushRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportShardFlushAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/TransportPutMappingAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/open/TransportOpenIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportRefreshAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportShardRefreshAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/put/TransportUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/shards/TransportIndicesShardStoresAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/shrink/ShrinkRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/shrink/ShrinkRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/shrink/ShrinkResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/shrink/TransportShrinkAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStats.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStatsFlags.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndexShardStats.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/ShardStats.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/delete/TransportDeleteIndexTemplateAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/get/GetIndexTemplatesResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/TransportPutIndexTemplateAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/upgrade/post/TransportUpgradeSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/TransportValidateQueryAction.java
core/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequestBuilder.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequestHandler.java
core/src/main/java/org/elasticsearch/action/bulk/BulkShardRequest.java
core/src/main/java/org/elasticsearch/action/bulk/Retry.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/DeleteResponse.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/explain/ExplainRequest.java
core/src/main/java/org/elasticsearch/action/explain/ExplainRequestBuilder.java
core/src/main/java/org/elasticsearch/action/explain/TransportExplainAction.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStats.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsRequest.java
core/src/main/java/org/elasticsearch/action/fieldstats/TransportFieldStatsAction.java
core/src/main/java/org/elasticsearch/action/get/GetRequest.java
core/src/main/java/org/elasticsearch/action/get/GetRequestBuilder.java
core/src/main/java/org/elasticsearch/action/get/GetResponse.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequest.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequestBuilder.java
core/src/main/java/org/elasticsearch/action/get/MultiGetShardRequest.java
core/src/main/java/org/elasticsearch/action/get/TransportGetAction.java
core/src/main/java/org/elasticsearch/action/get/TransportShardMultiGetAction.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/index/IndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/index/IndexResponse.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/ingest/GetPipelineRequest.java
core/src/main/java/org/elasticsearch/action/ingest/GetPipelineResponse.java
core/src/main/java/org/elasticsearch/action/ingest/IngestActionFilter.java
core/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java
core/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineResponse.java
core/src/main/java/org/elasticsearch/action/ingest/SimulateProcessorResult.java
core/src/main/java/org/elasticsearch/action/ingest/TrackingResultProcessor.java
core/src/main/java/org/elasticsearch/action/ingest/WriteableIngestDocument.java
core/src/main/java/org/elasticsearch/action/main/MainResponse.java
core/src/main/java/org/elasticsearch/action/main/TransportMainAction.java
core/src/main/java/org/elasticsearch/action/package-info.java
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchRequest.java
core/src/main/java/org/elasticsearch/action/search/SearchRequestBuilder.java
core/src/main/java/org/elasticsearch/action/search/SearchResponse.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollRequest.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/TransportClearScrollAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java
core/src/main/java/org/elasticsearch/action/support/AbstractListenableActionFuture.java
core/src/main/java/org/elasticsearch/action/support/ActiveShardCount.java
core/src/main/java/org/elasticsearch/action/support/ActiveShardsObserver.java
core/src/main/java/org/elasticsearch/action/support/AutoCreateIndex.java
core/src/main/java/org/elasticsearch/action/support/HandledTransportAction.java
core/src/main/java/org/elasticsearch/action/support/ThreadedActionListener.java
core/src/main/java/org/elasticsearch/action/support/TransportAction.java
core/src/main/java/org/elasticsearch/action/support/broadcast/TransportBroadcastAction.java
core/src/main/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeAction.java
core/src/main/java/org/elasticsearch/action/support/master/TransportMasterNodeAction.java
core/src/main/java/org/elasticsearch/action/support/nodes/TransportNodesAction.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationOperation.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationRequest.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationRequestBuilder.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/main/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationAction.java
core/src/main/java/org/elasticsearch/action/support/single/shard/TransportSingleShardAction.java
core/src/main/java/org/elasticsearch/action/support/tasks/TransportTasksAction.java
core/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java
core/src/main/java/org/elasticsearch/action/termvectors/TransportShardMultiTermsVectorAction.java
core/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequestBuilder.java
core/src/main/java/org/elasticsearch/action/update/UpdateResponse.java
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapException.java
core/src/main/java/org/elasticsearch/bootstrap/Elasticsearch.java
core/src/main/java/org/elasticsearch/bootstrap/ElasticsearchUncaughtExceptionHandler.java
core/src/main/java/org/elasticsearch/bootstrap/JNACLibrary.java
core/src/main/java/org/elasticsearch/bootstrap/JNAKernel32Library.java
core/src/main/java/org/elasticsearch/bootstrap/JNANatives.java
core/src/main/java/org/elasticsearch/bootstrap/JarHell.java
core/src/main/java/org/elasticsearch/bootstrap/Natives.java
comments:
Merge branch 'master' into feature/seq_no

* master: (1199 commits)
  [DOCS] Remove non-valid link to mapping migration document
  Revert "Default `include_in_all` for numeric-like types to false"
  test: add a test with ipv6 address
  docs: clearify that both ip4 and ip6 addresses are supported
  Include complex settings in settings requests
  Add production warning for pre-release builds
  Clean up confusing error message on unhandled endpoint
  [TEST] Increase logging level in testDelayShards()
  change health from string to enum (#20661)
  Provide error message when plugin id is missing
  Document that sliced scroll works for reindex
  Make reindex-from-remote ignore unknown fields
  Remove NoopGatewayAllocator in favor of a more realistic mock (#20637)
  Remove Marvel character reference from guide
  Fix documentation for setting Java I/O temp dir
  Update client benchmarks to log4j2
  Changes the API of GatewayAllocator#applyStartedShards and (#20642)
  Removes FailedRerouteAllocation and StartedRerouteAllocation
  IndexRoutingTable.initializeEmpty shouldn't override supplied primary RecoverySource (#20638)
  Smoke tester: Adjust to latest changes (#20611)
  ...

time:
2016-09-28T21:04:22Z
class:
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/IngestCommonPlugin.java
comments:
[fix] JSON Processor was not properly added (#20613)

time:
2016-09-28T19:50:32Z
class:
comments:
[docs] [fix] `field` is no longer an option for the script processor (#20614)

time:
2016-09-28T18:09:16Z
class:
core/src/test/java/org/elasticsearch/index/mapper/NumberFieldMapperTests.java
comments:
[TEST] Fix NumberFieldMapperTests.testNoDocValues to call correct helper method.

time:
2016-09-28T15:09:19Z
class:
comments:
[DOCS] Remove non-valid link to mapping migration document

time:
2016-09-28T13:07:46Z
class:
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/GeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/GeoShapeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IpFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/NumberFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapper.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/IpFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/NumberFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapperTests.java
comments:
Revert "Default `include_in_all` for numeric-like types to false"

This reverts commit 66668920386cf8470c4dfc9b5a1b476268ea913e.

time:
2016-09-28T08:04:20Z
class:
plugins/ingest-geoip/src/test/java/org/elasticsearch/ingest/geoip/GeoIpProcessorTests.java
comments:
test: add a test with ipv6 address

time:
2016-09-28T08:03:43Z
class:
comments:
docs: clearify that both ip4 and ip6 addresses are supported

time:
2016-09-28T00:25:03Z
class:
core/src/main/java/org/elasticsearch/common/settings/AbstractScopedSettings.java
core/src/test/java/org/elasticsearch/common/settings/ScopedSettingsTests.java
comments:
Include complex settings in settings requests

Today when getting setting via an API like the cluster settings API,
complex settings are excluded (e.g.,
discovery.zen.ping.unicast.hosts). This commit adds these settings to
the output of such APIs.

Relates #20622

time:
2016-09-28T00:13:12Z
class:
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/node/Node.java
test/framework/src/main/java/org/elasticsearch/node/NodeTests.java
comments:
Add production warning for pre-release builds

This commit adds a usage warning when Elasticsearch is started with a
pre-release build.

Relates #20674

time:
2016-09-27T19:12:50Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexRequest.java
comments:
Merge remote-tracking branch 'dakrone/cleanup-msg'

time:
2016-09-27T14:42:47Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexRequest.java
comments:
Clean up confusing error message on unhandled endpoint

It currently returns something like:

```
"No feature for name [_siohgjoidfhjfihfg]"
```

Which is not the most understandable message, this changes it to be a
little more readable.

Resolves #10946

time:
2016-09-27T14:28:38Z
class:
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/storage/AzureStorageServiceImpl.java
comments:
Fix logger when you can not create an azure storage client

We were swallowing the original exception when creating a client with bad credentials.
So even in `TRACE` log level, nothing useful were coming out of it.
With this commit, it now prints:

```
[2016-09-27 15:54:13,118][ERROR][cloud.azure.storage      ] [node_s0] can not create azure storage client: Storage Key is not a valid base64 encoded string.
```

Closes #20633.

Backport of #20669 for master branch (6.0)

time:
2016-09-27T09:01:38Z
class:
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainIT.java
comments:
[TEST] Increase logging level in testDelayShards()

time:
2016-09-26T20:44:30Z
class:
comments:
change health from string to enum (#20661)

time:
2016-09-26T14:39:55Z
class:
comments:
Merge remote-tracking branch 'dakrone/breaker-done-resiliency'

time:
2016-09-26T12:09:15Z
class:
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java
comments:
Provide error message when plugin id is missing

Today when executing the install plugin command without a plugin id, we
end up throwing an NPE because the plugin id is null yet we just keep
going (ultimatley we try to lookup the null plugin id in a set, the
direct cause of the NPE). This commit modifies the install command so
that a missing plugin id is detected and help is provided to the user.

Relates #20660

time:
2016-09-26T03:27:44Z
class:
comments:
Document that sliced scroll works for reindex

Surprise! You can use sliced scroll to easily parallelize reindex
and friend. They support it because they use the same infrastructure
as a regular search to parse the search request. While we would like
to make an "automatic" option for parallelizing reindex, this manual
option works right now and is pretty convenient!

time:
2016-09-25T22:55:46Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/AbstractObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ConstructingObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java
core/src/test/java/org/elasticsearch/common/xcontent/ConstructingObjectParserTests.java
core/src/test/java/org/elasticsearch/common/xcontent/ObjectParserTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteResponseParsers.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
comments:
Make reindex-from-remote ignore unknown fields

reindex-from-remote should ignore unknown fields so it is mostly
future compatible. This makes it ignore unknown fields by adding an
option to `ObjectParser` and `ConstructingObjectParser` that, if
enabled, causes them to ignore unknown fields.

Closes #20504

time:
2016-09-25T18:15:30Z
class:
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java
core/src/main/java/org/elasticsearch/cluster/routing/IndexRoutingTable.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationService.java
core/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/test/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/shrink/TransportShrinkActionTests.java
core/src/test/java/org/elasticsearch/cluster/health/ClusterStateHealthTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexServiceTests.java
core/src/test/java/org/elasticsearch/cluster/routing/PrimaryTermsTests.java
core/src/test/java/org/elasticsearch/cluster/routing/RoutingTableTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/BalanceConfigurationTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/ClusterRebalanceRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/DecisionsImpactOnClusterHealthTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/FailedShardsRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/FilterAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/MaxRetryAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/NodeVersionAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/PreferLocalPrimariesToRelocatingPrimariesTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/PrimaryElectionRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/RandomAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/SingleShardNoReplicasRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/StartedShardsRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/ThrottlingAllocationTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDeciderTests.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeJoinControllerTests.java
core/src/test/java/org/elasticsearch/gateway/PrimaryShardAllocatorTests.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
test/framework/src/main/java/org/elasticsearch/cluster/ESAllocationTestCase.java
test/framework/src/main/java/org/elasticsearch/test/gateway/TestGatewayAllocator.java
comments:
Remove NoopGatewayAllocator in favor of a more realistic mock (#20637)

Many of our unit tests instantiate an `AllocationService`, which requires having a `GatewayAllocator`. Today almost all of our test use a class called `NoopGatewayAllocator` which does nothing, effectively leaving all shard assignments to the balanced allocator. This is sad as it means we test a system that behaves differently than our production logic in very basic things. For example, a started primary that is lost will be assigned to a node that didn't use to have it.

This PR removes `NoopGatewayAllocator` in favor of a new `TestGatewayAllocator` that inherits the standard `GatewayAllocator` and overrides shard information fetching to return information based on historical assignments the allocator has done. The only exception is `BalanceConfigurationTests` which does test only the balancer and I opted to not have it work around the `GatewayAllocator` being in it's way.

time:
2016-09-25T15:28:13Z
class:
comments:
Remove Marvel character reference from guide

Relates #20654

time:
2016-09-25T01:13:22Z
class:
comments:
Fix documentation for setting Java I/O temp dir

This commit fixes the documentation for configuring the Java I/O temp
dir which incorrectly suggested using the -D flag as a parameter on the
command line; these flags have been removed and should now be specified
as arguments to the JVM using either the ES_JAVA_OPTS environment
variable or using the jvm.options configuration file.

Closes #20652

time:
2016-09-23T13:39:18Z
class:
comments:
Update client benchmarks to log4j2

time:
2016-09-23T13:31:46Z
class:
benchmarks/src/main/java/org/elasticsearch/benchmark/routing/allocation/Allocators.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationService.java
core/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java
test/framework/src/main/java/org/elasticsearch/cluster/ESAllocationTestCase.java
test/framework/src/main/java/org/elasticsearch/test/gateway/NoopGatewayAllocator.java
comments:
Changes the API of GatewayAllocator#applyStartedShards and (#20642)

Changes the API of GatewayAllocator#applyStartedShards and 
GatewayAllocator#applyFailedShards to take both a RoutingAllocation
and a list of shards to apply. This allows better mock allocators
to be created as being done in #20637.

Closes #20642

time:
2016-09-23T13:02:36Z
class:
benchmarks/src/main/java/org/elasticsearch/benchmark/routing/allocation/Allocators.java
core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationService.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/FailedRerouteAllocation.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/FailedShard.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/IndexMetaDataUpdater.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/StaleShard.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/StartedRerouteAllocation.java
core/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java
core/src/test/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteTests.java
core/src/test/java/org/elasticsearch/cluster/action/shard/ShardFailedClusterStateTaskExecutorTests.java
core/src/test/java/org/elasticsearch/cluster/routing/PrimaryTermsTests.java
core/src/test/java/org/elasticsearch/cluster/routing/UnassignedInfoTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/FailedShardsRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/MaxRetryAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
test/framework/src/main/java/org/elasticsearch/cluster/ESAllocationTestCase.java
test/framework/src/main/java/org/elasticsearch/test/gateway/NoopGatewayAllocator.java
comments:
Removes FailedRerouteAllocation and StartedRerouteAllocation

Removes the FailedRerouteAllocation class and StartedRerouteAllocation
class, as they were just wrappers for RerouteAllocation that stored
started and failed shards, but these started and failed shards can
be passed in directly to the methods that needed them, removing the
need for this wrapper class and extra level of indirection.

Closes #20626

time:
2016-09-23T11:17:54Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/IndexRoutingTable.java
core/src/test/java/org/elasticsearch/cluster/health/ClusterStateHealthTests.java
comments:
IndexRoutingTable.initializeEmpty shouldn't override supplied primary RecoverySource (#20638)

When initializing a new index routing table, we make a decision where the primary shards should be recovered from. This can be an empty folder for new indices, a set of specific allocation ids for old indices or a snapshot. We currently allow callers of `IndexRoutingTable.initializeEmpty` to supply the source but also set it automatically if null is given. Sadly the current logic is reusing the supplied parameter to store the result of the automatic decision. This is flawed if some of the decision should be *different* between the different index shard (as the first decision that is maid sticks).

 This commit fixes this but also simplifies the API to always make an automatic decision.

This was discovered while working on #20637 which strengthens the testing infra and caused this to bubble up. I put it as a separate commit to make sure it is not lost as part of a bigger test only PR.

time:
2016-09-23T09:28:46Z
class:
comments:
Smoke tester: Adjust to latest changes (#20611)

* Removed the check for the correct hash in the `/` response, otherwise two hashes would be needed
* Adapted to new URLs
* Added two missing plugins
* Downloaded gpg key only once

time:
2016-09-23T06:53:50Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/TransportAnalyzeAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/analysis/AnalysisRegistry.java
core/src/main/java/org/elasticsearch/index/analysis/AnalysisService.java
core/src/main/java/org/elasticsearch/index/analysis/CustomAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/IndexAnalyzers.java
core/src/main/java/org/elasticsearch/index/mapper/AllFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/CompletionFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/CompletionFieldMapper2x.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyTokenCountFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/Mapper.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/index/mapper/ParseContext.java
core/src/main/java/org/elasticsearch/index/mapper/StringFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TextFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TokenCountFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TypeParsers.java
core/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchPhrasePrefixQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchPhraseQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
core/src/main/java/org/elasticsearch/index/termvectors/TermVectorsService.java
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/main/java/org/elasticsearch/search/internal/FilteredSearchContext.java
core/src/main/java/org/elasticsearch/search/internal/SearchContext.java
core/src/main/java/org/elasticsearch/search/suggest/SuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGeneratorBuilder.java
core/src/test/java/org/elasticsearch/action/admin/indices/TransportAnalyzeActionTests.java
core/src/test/java/org/elasticsearch/index/analysis/ASCIIFoldingTokenFilterFactoryTests.java
core/src/test/java/org/elasticsearch/index/analysis/AnalysisRegistryTests.java
core/src/test/java/org/elasticsearch/index/analysis/AnalysisTestsHelper.java
core/src/test/java/org/elasticsearch/index/analysis/CJKFilterFactoryTests.java
core/src/test/java/org/elasticsearch/index/analysis/CharFilterTests.java
core/src/test/java/org/elasticsearch/index/analysis/CompoundAnalysisTests.java
core/src/test/java/org/elasticsearch/index/analysis/HunspellTokenFilterFactoryTests.java
core/src/test/java/org/elasticsearch/index/analysis/KeepFilterFactoryTests.java
core/src/test/java/org/elasticsearch/index/analysis/KeepTypesFilterFactoryTests.java
core/src/test/java/org/elasticsearch/index/analysis/LimitTokenCountFilterFactoryTests.java
core/src/test/java/org/elasticsearch/index/analysis/MinHashFilterFactoryTests.java
core/src/test/java/org/elasticsearch/index/analysis/PatternCaptureTokenFilterTests.java
core/src/test/java/org/elasticsearch/index/analysis/ShingleTokenFilterFactoryTests.java
core/src/test/java/org/elasticsearch/index/analysis/StemmerTokenFilterFactoryTests.java
core/src/test/java/org/elasticsearch/index/analysis/StopAnalyzerTests.java
core/src/test/java/org/elasticsearch/index/analysis/StopTokenFilterTests.java
core/src/test/java/org/elasticsearch/index/analysis/WordDelimiterTokenFilterFactoryTests.java
core/src/test/java/org/elasticsearch/index/analysis/commongrams/CommonGramsTokenFilterFactoryTests.java
core/src/test/java/org/elasticsearch/index/analysis/synonyms/SynonymsAnalysisTests.java
core/src/test/java/org/elasticsearch/index/codec/CodecTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/FieldNamesFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ParentFieldMapperTests.java
core/src/test/java/org/elasticsearch/indices/analysis/AnalysisModuleTests.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java
plugins/analysis-icu/src/test/java/org/elasticsearch/index/analysis/IcuTokenizerFactoryTests.java
plugins/analysis-icu/src/test/java/org/elasticsearch/index/analysis/SimpleIcuAnalysisTests.java
plugins/analysis-icu/src/test/java/org/elasticsearch/index/analysis/SimpleIcuCollationTokenFilterTests.java
plugins/analysis-icu/src/test/java/org/elasticsearch/index/analysis/SimpleIcuNormalizerCharFilterTests.java
plugins/analysis-kuromoji/src/test/java/org/elasticsearch/index/analysis/KuromojiAnalysisTests.java
plugins/analysis-phonetic/src/test/java/org/elasticsearch/index/analysis/SimplePhoneticAnalysisTests.java
plugins/analysis-smartcn/src/test/java/org/elasticsearch/index/analysis/SimpleSmartChineseAnalysisTests.java
plugins/analysis-stempel/src/test/java/org/elasticsearch/index/analysis/PolishAnalysisTests.java
plugins/analysis-stempel/src/test/java/org/elasticsearch/index/analysis/SimplePolishTokenFilterTests.java
plugins/mapper-murmur3/src/test/java/org/elasticsearch/index/mapper/murmur3/Murmur3FieldMapperTests.java
test/framework/src/main/java/org/elasticsearch/index/MapperTestUtils.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/main/java/org/elasticsearch/test/TestSearchContext.java
comments:
Remove AnalysisService and reduce it to a simple name to analyzer mapping (#20627)

Today we hold on to all possible tokenizers, tokenfilters etc. when we create
an index service on a node. This was mainly done to allow the `_analyze` API to
directly access all these primitive. We fixed this in #19827 and can now get rid of
the AnalysisService entirely and replace it with a simple map like class. This
ensures we don't create a gazillion long living objects that are entirely useless since
they are never used in most of the indices. Also those objects might consume a considerable
amount of memory since they might load stopwords or synonyms etc.

Closes #19828

time:
2016-09-22T12:58:17Z
class:
comments:
Reorganised docs for mapping safeguard settings

time:
2016-09-22T12:42:13Z
class:
core/src/main/java/org/elasticsearch/common/unit/ByteSizeUnit.java
core/src/main/java/org/elasticsearch/common/unit/ByteSizeValue.java
core/src/test/java/org/elasticsearch/common/unit/ByteSizeUnitTests.java
comments:
Make ByteSizeUnit implements Writeable (#20557)

This commit makes ByteSizeUnit implement Writeable.

time:
2016-09-22T11:29:07Z
class:
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/tribe/TribeClientNode.java
core/src/main/java/org/elasticsearch/tribe/TribeService.java
qa/evil-tests/src/test/java/org/elasticsearch/tribe/TribeUnitTests.java
comments:
Pass classpath plugins to tribe nodes

When testing tribe nodes in an integration test, we should pass the classpath
plugins of the node down to the tribe client nodes. Without this the tribe client
nodes could be prevented from communicating with the tribes.

time:
2016-09-22T10:00:11Z
class:
comments:
docs: describe more explicitly what happens when indexing queries that fetch terms

time:
2016-09-21T23:10:47Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EAssignment.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/StringTests.java
comments:
Merge pull request #20623 from jdconrad/catfix

Fixes the a String concatenation bug related to compound assignment in Painless.

Closes #20623

time:
2016-09-21T22:49:56Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EAssignment.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/StringTests.java
comments:
Fix String concatentation bug.

time:
2016-09-21T20:33:15Z
class:
comments:
Fix cluster wait condition

Today we define a cluster wait condition to try to wait at least a
certain number of nodes when running integration tests. Alas, the wait
condition is incorrect because wait_for_nodes>=${numNodes} will be split
by parameter parsing on the equals sign so the request looks like it has
a parameter named wait_for_nodes>. The fact that REST param parsing is
lenient leads to this being undiscovered. This commit fixes this issue.

Relates #20601

time:
2016-09-21T19:48:18Z
class:
comments:
File-based discovery plugin integration tests (#20492)

Adds an integration test for the file-based discovery plugin
to test the plugin operates correctly and uses the hosts
configured in `unicast_hosts.txt` with a real cluster

Closes #20459

time:
2016-09-21T17:07:40Z
class:
core/src/test/java/org/elasticsearch/rest/DeprecationRestHandlerTests.java
comments:
Fixes a test bug for the DeprecationRestHandler where an empty string
could be randomly produced as a header to test against, which is rejected
by header validation as an invalid header.

time:
2016-09-21T16:13:26Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
comments:
Update incoming recoveries stats when shadow replica is reinitialized (#20612)

When an active shadow replica is reinitialized during primary promotion, the recovery stats that are used by the allocation decider settings `cluster.routing.allocation.node_concurrent_recoveries` and `cluster.routing.allocation.node_concurrent_incoming_recoveries` have to be updated.

time:
2016-09-21T15:39:43Z
class:
core/src/main/java/org/elasticsearch/script/NativeScriptEngineService.java
comments:
Native scripts should be created once per index, not per segment. (#20609)

If your native script needs to do some heavy computation on initialization,
the fact that we create a new one for every segment rather than for the whole
index could have a negative performance impact.

time:
2016-09-21T15:25:19Z
class:
comments:
Further document the pom hack

We have a "HUGE HACK" that allows us to publish zip artifacts to
Sonatype's OSS repository without javadoc and source jars. We don't
include those jars because the zip is just a repackaging of the
core and module jars for which we already publish the javadoc and
source jars. So we have a hack to publish the zip artifact when the
pom says the project is of type 'pom'.

time:
2016-09-21T15:22:06Z
class:
comments:
Allow build to run even if there is no Git remote named origin (#20608)

The build currently depends on the presence of a Git remote named origin to determine the URL that is used in the generated POM file. As this is best-effort anyhow and only required by Maven Central, this commit allows the build to run even if a Git remote with the name "origin" is missing.

time:
2016-09-21T13:42:53Z
class:
core/src/main/java/org/elasticsearch/common/util/IndexFolderUpgrader.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/store/Store.java
core/src/main/java/org/elasticsearch/indices/IndexingMemoryController.java
core/src/main/java/org/elasticsearch/plugins/PluginsService.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
modules/lang-groovy/src/main/java/org/elasticsearch/script/groovy/GroovyScriptEngineService.java
test/logger-usage/src/main/java/org/elasticsearch/test/loggerusage/ESLoggerUsageChecker.java
test/logger-usage/src/test/java/org/elasticsearch/test/loggerusage/ESLoggerUsageTests.java
comments:
Merge pull request #20490 from ywelsch/fix/loggerusagecheck-log4j2

With the switch to Log4j 2 the logger usage checker was temporarily disabled. This adapts the checks to work with Log4j 2 and re-enables the Gradle checks. It also fixes the wrong logger usages that have sneaked into the code base.

time:
2016-09-21T13:36:21Z
class:
comments:
Convert more docs to CONSOLE

* plugins/discovery-azure-class.asciidoc
* reference/cluster.asciidoc
* reference/modules/cluster/misc.asciidoc
* reference/modules/indices/request_cache.asciidoc

After this is merged there will be no unconvereted snippets outside
of `reference`.

Related to #18160

time:
2016-09-21T13:33:49Z
class:
comments:
install -> publishToMavenLocal

time:
2016-09-21T12:49:14Z
class:
comments:
Change APT/YUM urls to point to the prerelease repositories

Closes #20593

time:
2016-09-21T12:45:28Z
class:
core/src/main/java/org/elasticsearch/common/util/IndexFolderUpgrader.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/store/Store.java
core/src/main/java/org/elasticsearch/indices/IndexingMemoryController.java
core/src/main/java/org/elasticsearch/plugins/PluginsService.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
modules/lang-groovy/src/main/java/org/elasticsearch/script/groovy/GroovyScriptEngineService.java
comments:
Fix wrong logger usages

These misusages were found by the logger usage checker that was re-enabled in the previous commit.

time:
2016-09-21T12:44:14Z
class:
test/logger-usage/src/main/java/org/elasticsearch/test/loggerusage/ESLoggerUsageChecker.java
test/logger-usage/src/test/java/org/elasticsearch/test/loggerusage/ESLoggerUsageTests.java
comments:
Fix logger usage checker for Log4j 2

With the switch to Log4j 2 throughout our code base, the logger usage checker was temporarily disabled. This commit
adapts the checks to work with Log4j 2 and re-enables the Gradle checks.

Closes #20243

time:
2016-09-21T12:20:24Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/action/admin/indices/flush/FlushRequest.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/FlushNotAllowedEngineException.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/indices/IndexingMemoryController.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/flush/FlushBlocksIT.java
core/src/test/java/org/elasticsearch/action/admin/indices/segments/IndicesSegmentsRequestTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/shards/IndicesShardStoreRequestIT.java
core/src/test/java/org/elasticsearch/gateway/RecoveryFromGatewayIT.java
core/src/test/java/org/elasticsearch/gateway/ReusePeerRecoverySharedTest.java
core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/store/CorruptedFileIT.java
core/src/test/java/org/elasticsearch/indices/flush/FlushIT.java
core/src/test/java/org/elasticsearch/indices/state/OpenCloseIndexIT.java
core/src/test/java/org/elasticsearch/recovery/TruncatedRecoveryIT.java
core/src/test/java/org/elasticsearch/repositories/blobstore/BlobStoreRepositoryTests.java
core/src/test/java/org/elasticsearch/search/basic/SearchWithRandomIOExceptionsIT.java
core/src/test/java/org/elasticsearch/versioning/SimpleVersioningIT.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
comments:
`_flush` should block by default (#20597)

This commit changes the default behavior of `_flush` to block if other flushes are ongoing.
This also removes the use of `FlushNotAllowedException` and instead simply return immediately
by skipping the flush. Users should be aware if they set this option that the flush might or might
not flush everything to disk ie. no transactional behavior of some sort.

Closes #20569

time:
2016-09-21T12:19:49Z
class:
core/src/main/java/org/elasticsearch/index/translog/BaseTranslogReader.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/index/translog/TranslogSnapshot.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
comments:
Remove unused Translog#read method (#20598)

Translog#read is a left-over from realtime-get that allows to read
from an arbitrary location in the transaction log. This method is unused
and can be replaced with snapshots in tests.

time:
2016-09-21T10:40:37Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/RecoverySource.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/FilterAllocationDecider.java
core/src/test/java/org/elasticsearch/action/admin/indices/create/CreateIndexIT.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/FilterAllocationDeciderTests.java
comments:
`index.routing.allocation.initial_recovery` limits replica allocation (#20589)

`index.routing.allocation.initial_recovery` is used with index shrinking to make sure the new index's primary is assigned to the node that holds a copy of each of the source index shards. Sadly with the introduction of `RecoverySource` a regression was introduced that limits the allocation of replicas of the new index.

time:
2016-09-20T22:07:43Z
class:
comments:
[DOCS] Mark combinatorial explosion in aggs as 'done'

This marks the "Prevent combinatorial explosion in aggregations from
causing OOM" task as done in 5.0.0.

Relates to #8081 and #19394

time:
2016-09-20T17:53:07Z
class:
comments:
Weaken overspecified tests in response snippets

The docs in api-conventions contained some very specific response
snippets that made the tests a bit fragile. This removes some of
that fragility.

time:
2016-09-20T17:12:12Z
class:
comments:
Convert more docs to CONSOLE

* reference/api-conventions.asciidoc
* reference/redirects.asciidoc

Relates to #18160

time:
2016-09-20T16:51:56Z
class:
comments:
Fix JVM heap size docs for 5.0

Closes #20587

time:
2016-09-20T15:20:13Z
class:
core/src/main/java/org/elasticsearch/plugins/Plugin.java
comments:
Better explain Plugin (#20573)

Adds some javadoc with more explanation on how to extend Plugin and
why we have all these `@Deprecated public final` `onModule` methods.

Closes #20564

time:
2016-09-20T15:05:23Z
class:
comments:
Fix up nebulaRealPom

I'm not sure why we need this pom instead of the pom generated by
nebula, but if we are going to have it then we need to populate it
with appropriate stuff like project name, description, and url.

time:
2016-09-20T12:53:05Z
class:
comments:
Merge branch 'doc/plugins-offline-url'

time:
2016-09-20T12:28:27Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/cli/Command.java
core/src/main/java/org/elasticsearch/common/logging/LogConfigurator.java
core/src/main/java/org/elasticsearch/index/translog/TranslogToolCli.java
core/src/main/java/org/elasticsearch/plugins/PluginCli.java
qa/evil-tests/src/test/java/org/elasticsearch/common/logging/EvilLoggerConfigurationTests.java
qa/evil-tests/src/test/java/org/elasticsearch/common/logging/EvilLoggerTests.java
comments:
Ensure logging is initialized in CLI tools

Today when CLI tools are executed, logging statements can intentionally
or unintentionally be executed when logging is not configured. This
leads to log messages that the status logger is not configured. This
commit reworks logging configuration for CLI tools so that logging is
always configured.

Relates #20575

time:
2016-09-20T12:07:23Z
class:
core/src/main/java/org/apache/lucene/store/StoreRateLimiting.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodeInfo.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java
core/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java
core/src/main/java/org/elasticsearch/cluster/InternalClusterInfoService.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/DiskThresholdMonitor.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDecider.java
core/src/main/java/org/elasticsearch/common/blobstore/fs/FsBlobStore.java
core/src/main/java/org/elasticsearch/common/blobstore/url/URLBlobStore.java
core/src/main/java/org/elasticsearch/common/breaker/MemoryCircuitBreaker.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/unit/ByteSizeValue.java
core/src/main/java/org/elasticsearch/common/unit/MemorySizeValue.java
core/src/main/java/org/elasticsearch/common/util/PageCacheRecycler.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentBuilder.java
core/src/main/java/org/elasticsearch/index/MergePolicyConfig.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/snapshots/blobstore/BlobStoreIndexShardSnapshot.java
core/src/main/java/org/elasticsearch/indices/IndexingMemoryController.java
core/src/main/java/org/elasticsearch/indices/IndicesQueryCache.java
core/src/main/java/org/elasticsearch/indices/IndicesRequestCache.java
core/src/main/java/org/elasticsearch/indices/breaker/HierarchyCircuitBreakerService.java
core/src/main/java/org/elasticsearch/indices/fielddata/cache/IndicesFieldDataCache.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySettings.java
core/src/main/java/org/elasticsearch/monitor/os/OsStats.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestAllocationAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTable.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/test/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsIT.java
core/src/test/java/org/elasticsearch/cluster/DiskUsageTests.java
core/src/test/java/org/elasticsearch/common/settings/MemorySizeSettingsTests.java
core/src/test/java/org/elasticsearch/common/settings/SettingTests.java
core/src/test/java/org/elasticsearch/common/unit/ByteSizeValueTests.java
core/src/test/java/org/elasticsearch/index/MergePolicySettingsTests.java
core/src/test/java/org/elasticsearch/index/store/StoreTests.java
core/src/test/java/org/elasticsearch/indices/IndicesRequestCacheTests.java
core/src/test/java/org/elasticsearch/indices/memory/breaker/CircuitBreakerServiceIT.java
core/src/test/java/org/elasticsearch/indices/memory/breaker/CircuitBreakerUnitTests.java
core/src/test/java/org/elasticsearch/indices/recovery/IndexRecoveryIT.java
core/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsIT.java
core/src/test/java/org/elasticsearch/monitor/jvm/JvmGcMonitorServiceTests.java
core/src/test/java/org/elasticsearch/monitor/jvm/JvmStatsTests.java
core/src/test/java/org/elasticsearch/monitor/os/OsProbeTests.java
core/src/test/java/org/elasticsearch/monitor/process/ProcessProbeTests.java
core/src/test/java/org/elasticsearch/nodesinfo/SimpleNodesInfoIT.java
modules/transport-netty3/src/main/java/org/elasticsearch/http/netty3/Netty3HttpServerTransport.java
modules/transport-netty3/src/main/java/org/elasticsearch/transport/netty3/Netty3Transport.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
comments:
Remove duplicate methods in ByteSizeValue (#20560)

This commit removes `ByteSizeValue`'s methods that are duplicated (ex: `mbFrac()` and `getMbFrac()`) in order to only keep the `getN` form.
    
It also renames `mb()` -> `getMb()`, `kb()` -> `getKB()` in order to be more coherent with the `ByteSizeUnit` method names.

time:
2016-09-20T10:05:21Z
class:
comments:
[Tests] Fix cat.templates to work when other templates exist

This commit fixes the cat.templates REST tests so that it works when other templates exist (like monitoring)

time:
2016-09-20T09:02:55Z
class:
comments:
[DOC] Add /cat/templates to list of excluded docs

time:
2016-09-20T08:40:23Z
class:
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTemplatesAction.java
comments:
Provides a cat api endpoint for templates. (#20545)

Adds a cat api endpoint: /_cat/templates and its more specific version, /_cat/templates/{name}.

It looks something like:

$ curl "localhost:9200/_cat/templates?v"
name                  template     order version
sushi_california_roll *avocado*    1     1
pizza_hawaiian        *pineapples* 1
pizza_pepperoni       *pepperoni*  1

The specified version (only allows * globs) looks like:

$ curl "localhost:9200/_cat/templates/pizza*"
name            template     order version
pizza_hawaiian  *pineapples* 1
pizza_pepperoni *pepperoni*  1

Partially specified columns:

$ curl "localhost:9200/_cat/templates/pizza*?v=true&h=name,template"
name            template
pizza_hawaiian  *pineapples*
pizza_pepperoni *pepperoni*

The help text:

$ curl "localhost:9200/_cat/templates/pizza*?help"
name     | n | template name
template | t | template pattern string
order    | o | template application order number
version  | v | version

Closes #20467

time:
2016-09-20T08:37:18Z
class:
comments:
Build: Add back hack for client copying client jar pom (#20577)

Gradle appears to have a bug in maven publshing which will not match the
artifactId of a generated pom with the artifact id it puts in the file.
This adds back a copy hack from the original pom file name to the client
pom file name (which we had before #20403 inadvertently
removed it).

time:
2016-09-20T08:31:32Z
class:
core/src/test/java/org/elasticsearch/threadpool/SimpleThreadPoolIT.java
core/src/test/java/org/elasticsearch/tribe/TribeIT.java
comments:
Improve TribeIT tests

This commit adds a new test TribeIT#testClusterStateNodes() to verify that the tribe node correctly reflects the nodes of the remote clusters it is connected to.

It also changes the existing tests so that they really use two remote clusters now.

time:
2016-09-20T08:23:09Z
class:
comments:
[DOC] Remove 'reference/docs/get.asciidoc' from list of excluded docs

time:
2016-09-20T07:18:08Z
class:
comments:
Add CONSOLE tests for snippets in get and bulk API docs (#20473)

* Add CONSOLE tests for snippets in get and bulk API docs

This change adds tests for the snippets in the get and bulk API documentation.

time:
2016-09-20T06:57:49Z
class:
core/src/main/java/org/elasticsearch/action/index/IndexResponse.java
core/src/test/java/org/elasticsearch/action/index/IndexRequestTests.java
comments:
fix IndexResponse#toString to print out shards info (#20562)

IndexResponse#toString method outputs an error caused by the shards object needing to be wrapped into another object. It is fixed by calling a different variant of Strings.toString(XContent) which accepts a second boolean argument that makes sure that a new object is created before outputting ShardInfo. I didn't change ShardInfo#toString directly as whether it needs a new object or not very much depends on where it is printed out. IndexResponse seemed a specific case as the rest of the info were not json, hence the shards object was the first one, but it is usually not the case.

time:
2016-09-20T06:11:02Z
class:
comments:
Remove redundant .x from apt/rpm repo docs

Relates to #20574

time:
2016-09-20T02:43:17Z
class:
comments:
Fix allowed non-CONSOLE docs on windows

`\` vs `/` strikes again. This time I just convert all the `\` into
`/`. It isn't perfect but anyone who sees it'll figure out what is
up.

time:
2016-09-20T01:10:45Z
class:
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
comments:
Convert old download links to unified release urls (#20574)

With the unified release process across the elastic stack, download
links for all products are changing. This change updates docs referring
to the old download and packages urls.

Note that this change also updates the plugin installation command as
the url for downloads is being changed to be consistent with that for
packages (both plural).

time:
2016-09-20T00:25:50Z
class:
core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java
core/src/main/java/org/elasticsearch/monitor/jvm/JvmInfo.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapCheckTests.java
comments:
Add serial collector bootstrap check

The serial collector is not suitable for running with a server
application like Elasticsearch and can decimate performance and lead to
cluster instability. This commit adds a bootstrap check to prevent usage
of the serial collector when Elasticsearch is running in production
mode.

Relates #20558

time:
2016-09-20T00:22:07Z
class:
core/src/main/java/org/elasticsearch/common/lucene/LoggerInfoStream.java
comments:
Avoid unnecessary creation of prefix loggers

Today when acquiring a prefix logger for a logger info stream, we obtain
a new prefix logger per invocation. This can lead to contention on the
markers lock in the constructor of PrefixLogger. Usually this is not a
problem (because the vast majority of callers hold on to the logger they
obtain). Unfortunately, under heavy indexing with multiple threads, the
contention on the lock can be devastating. This commit modifies
LoggerInfoStream to hold on to the loggers it obtains to avoid
contending over the lock there.

Relates #20571

time:
2016-09-19T22:10:41Z
class:
comments:
Build: Remove old maven deploy support (#20403)

* Build: Remove old maven deploy support

This change removes the old maven deploy that we have in parallel to
maven-publish, and makes maven-publish fully work with publishing to
maven local. Using `gradle publishToMavenLocal` should be used to
publish to .m2.

Note that there is an unfortunate hack that means for
zip artifacts we must first create/publish a dummy pom file, and then
follow that with the real pom file. It would be nice to have the pom
file contains packaging=zip, but maven central then requires sources and
javadocs. But our zips are really just attached artifacts, so we already
set the packaging type to pom for our zip files. This change just works
around a limitation of the underlying maven publishing library which
silently skips attached artifacts when the packaging type is set to pom.

relates #20164
closes #20375

* Remove unnecessary extra spacing

time:
2016-09-19T22:06:05Z
class:
comments:
Build: Remove maven central snapshots from repositories (#20567)

We were using maven snapshots during heavy development, but this should
not be something generally available (we should never release depending
on a snapshot version in maven). This change removes the snapshot repo.
If we ever need it temporarily for some reason, we can add it if/when
it is necessary.

relates #20559

time:
2016-09-19T20:43:43Z
class:
comments:
Fail build if new doc snippets aren't `// CONSOLE`

This tracks the snippets that probably should be converted to
`// CONSOLE` or `// TESTRESPONSE` and fails the build if the list
of files with such snippets doesn't match the list in `docs/build.gradle`.
Setting the file looks like
```
/* List of files that have snippets that probably should be converted to
 * `// CONSOLE` and `// TESTRESPONSE` but have yet to be converted. Try and
 * only remove entries from this list. When it is empty we'll remove it
 * entirely and have a party! There will be cake and everything.... */
buildRestTests.expectedUnconvertedCandidates = [
  'plugins/discovery-azure-classic.asciidoc',
...
  'reference/search/suggesters/completion-suggest.asciidoc',
]
```

This list is in `build.gradle` because we expect it to be fairly
temporary. In a few months we'll have converted all of the docs and won't
ned it any more.

From now on if you add now docs that contain a snippet that shows an
interaction with elasticsearch you have three choices:
1. Stick `// CONSOLE` on the interactions and `// TESTRESPONSE` on the
responses. The build (specifically (`gradle docs:check`) will test that
these interactions "work". If there isn't a `// TESTRESPONSE` snippet
then "work" just means "Elasticsearch responds with a 200-level response
code and no `WARNING` headers. This is way better than nothing.

2. Add `// NOTCONSOLE` if the snippet isn't actually interacting with
Elasticsearch. This should only be required for stuff like javascript
source code or `curl` against an external service like AWS or GCE. The
snippet will not get "OPEN IN CONSOLE" or "COPY AS CURL" buttons or be
tested.

3. Add `// TEST[skip:reason]` under the snippet. This will just skip the
snippet in the test phase. This should really be reserved for snippets
where we can't test them because they require an external service that
we don't have at testing time.

Please, please, please, please don't add more things to the list. After
all, it sais there'll be cake when we remove it entirely!

Relates to #18160

time:
2016-09-19T20:14:38Z
class:
qa/rolling-upgrade/src/test/java/org/elasticsearch/upgrades/UpgradeClusterClientYamlTestSuiteIT.java
test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java
comments:
Merge pull request #20532 from rjernst/rolling_upgrades

This PR introduces backward compatibility index tests to test the rolling upgrade process amongst Elasticsearch instances within the same major version. The test executes in three phases. In the first phase, we form a cluster of 2 ES instances on an old version. In the second phase, we keep one of the nodes from the old cluster, kill the other node, but preserve its data directory and start an instance of the current version of ES using the same data directory as the killed instance. In the third phase, we kill the other old version ES instance from the first phase and launch a new instance, using the same data directory as the killed instance. Therefore, during phase 3, we have fully migrated and have all current versions of ES running. In each phase, we run REST tests that index documents and search them, ensuring at each stage that the documents from the previous phase are still there.

Note that because we haven't released a GA yet of 5.0, the tests currently don't start an old version cluster in the first phase. Once GA is released, this will be changed to make the backward compatibility version 5.0, while the current version in the cluster will be 5.x.

time:
2016-09-19T20:10:47Z
class:
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/common/network/NetworkModule.java
core/src/main/java/org/elasticsearch/http/HttpServer.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/NetworkPlugin.java
core/src/main/java/org/elasticsearch/plugins/Plugin.java
core/src/main/java/org/elasticsearch/transport/local/LocalTransport.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteRequestTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteTests.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientHeadersTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AllocationCommandsTests.java
core/src/test/java/org/elasticsearch/common/network/NetworkModuleTests.java
modules/transport-netty3/src/main/java/org/elasticsearch/http/netty3/Netty3HttpServerTransport.java
modules/transport-netty3/src/main/java/org/elasticsearch/transport/Netty3Plugin.java
modules/transport-netty3/src/main/java/org/elasticsearch/transport/netty3/Netty3Transport.java
modules/transport-netty3/src/test/java/org/elasticsearch/transport/netty3/Netty3TransportIT.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/Netty4Plugin.java
modules/transport-netty4/src/test/java/org/elasticsearch/transport/netty4/Netty4TransportIT.java
test/framework/src/main/java/org/elasticsearch/node/MockNode.java
test/framework/src/main/java/org/elasticsearch/test/transport/AssertingLocalTransport.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransportPlugin.java
comments:
Unguice Transport and friends (#20526)

This change removes all guice interaction from Transport, HttpServerTransport,
HttpServer and TransportService. All these classes as well as their subclasses
or extended version configured via plugins are now created by using plain old
bloody java constructors. YAY!

time:
2016-09-19T19:45:41Z
class:
qa/rolling-upgrade/src/test/java/org/elasticsearch/upgrades/UpgradeClusterClientYamlTestSuiteIT.java
comments:
Change the timeout of the rolling upgrades test from 40 mins to 5 mins
to still allow accounting for slow VMs

time:
2016-09-19T15:52:13Z
class:
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/SearchTemplateRequest.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/SearchTemplateRequestBuilder.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
comments:
Add profile and explain parameters to template API

We can now run templates using `explain` and/or `profile` parameters.
Which is interesting when you have defined a complicated profile but want to debug it in an easier way than running the full query again.

You can use `explain` parameter when running a template:

```js
GET /_search/template
{
  "file": "my_template",
  "params": {
    "status": [ "pending", "published" ]
  },
  "explain": true
}
```

You can use `profile` parameter when running a template:

```js
GET /_search/template
{
  "file": "my_template",
  "params": {
    "status": [ "pending", "published" ]
  },
  "profile": true
}
```

time:
2016-09-19T15:00:17Z
class:
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
comments:
Call onNewEngine before the engine is actually published

time:
2016-09-19T13:15:51Z
class:
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/EngineConfig.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/ShadowIndexShard.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
comments:
Take refresh IOExceptions into account when catching ACE in InternalEngine (#20546)

Since #19975 we are aggressively failing with AssertionError when we catch an ACE
inside the InternalEngine. We treat everything that is neither a tragic even on
the IndexWriter or the Translog as a bug and throw an AssertionError. Yet, if the
engine hits an IOException on refresh of some sort and the IW doesn't realize it since
it's not fully under it's control we fail he engine but neither IW nor Translog are marked
as failed by tragic event while they are already closed.
This change takes the `failedEngine` exception into account and if it's set we know
that the engine failed by some other even than a tragic one and can continue.

This change also uses the `ReferenceManager#RefreshListener` interface in the engine rather
than it's concrete implementation.

Relates to #19975

time:
2016-09-19T13:04:29Z
class:
comments:
Add link to "offline install" and show the full URL

time:
2016-09-19T12:51:55Z
class:
benchmarks/src/main/java/org/elasticsearch/benchmark/routing/allocation/AllocationBenchmark.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/RestNoopBulkAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/TransportGetTaskAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/reroute/TransportClusterRerouteAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/settings/TransportClusterUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/TransportValidateQueryAction.java
core/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/explain/ExplainRequest.java
core/src/main/java/org/elasticsearch/action/explain/ExplainRequestBuilder.java
core/src/main/java/org/elasticsearch/action/explain/TransportExplainAction.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStats.java
core/src/main/java/org/elasticsearch/action/get/GetRequest.java
core/src/main/java/org/elasticsearch/action/get/GetRequestBuilder.java
core/src/main/java/org/elasticsearch/action/get/GetResponse.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequest.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequestBuilder.java
core/src/main/java/org/elasticsearch/action/get/MultiGetShardRequest.java
core/src/main/java/org/elasticsearch/action/get/TransportGetAction.java
core/src/main/java/org/elasticsearch/action/get/TransportShardMultiGetAction.java
core/src/main/java/org/elasticsearch/action/main/MainResponse.java
core/src/main/java/org/elasticsearch/action/main/TransportMainAction.java
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/TransportClearScrollAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java
core/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java
core/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequestBuilder.java
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapException.java
core/src/main/java/org/elasticsearch/bootstrap/Elasticsearch.java
core/src/main/java/org/elasticsearch/bootstrap/Security.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataDeleteIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexStateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java
core/src/main/java/org/elasticsearch/cluster/routing/DelayedAllocationService.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingService.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationService.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RoutingAllocation.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/UnassignedShardDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AllocationDeciders.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AwarenessAllocationDecider.java
core/src/main/java/org/elasticsearch/common/geo/GeoPoint.java
core/src/main/java/org/elasticsearch/common/logging/ESLoggerFactory.java
core/src/main/java/org/elasticsearch/common/logging/LogConfigurator.java
core/src/main/java/org/elasticsearch/common/logging/Loggers.java
core/src/main/java/org/elasticsearch/common/logging/PrefixLogger.java
core/src/main/java/org/elasticsearch/common/logging/PrefixMessageFactory.java
core/src/main/java/org/elasticsearch/common/lucene/LoggerInfoStream.java
core/src/main/java/org/elasticsearch/common/network/NetworkModule.java
core/src/main/java/org/elasticsearch/common/network/NetworkUtils.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/local/LocalDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/ElectMasterService.java
core/src/main/java/org/elasticsearch/discovery/zen/NodeJoinController.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/fd/MasterFaultDetection.java
core/src/main/java/org/elasticsearch/discovery/zen/fd/NodesFaultDetection.java
core/src/main/java/org/elasticsearch/discovery/zen/membership/MembershipAction.java
core/src/main/java/org/elasticsearch/discovery/zen/ping/PingContextProvider.java
core/src/main/java/org/elasticsearch/discovery/zen/ping/ZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/ping/ZenPingService.java
core/src/main/java/org/elasticsearch/discovery/zen/ping/unicast/UnicastZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/publish/PublishClusterStateAction.java
core/src/main/java/org/elasticsearch/env/NodeEnvironment.java
core/src/main/java/org/elasticsearch/gateway/BaseGatewayShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/GatewayService.java
core/src/main/java/org/elasticsearch/gateway/LocalAllocateDangledIndices.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/ReplicaShardAllocator.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractLatLonPointDVIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/LatLonPointDVAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/get/GetResult.java
core/src/main/java/org/elasticsearch/index/get/ShardGetService.java
core/src/main/java/org/elasticsearch/index/mapper/BaseGeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/GeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LatLonPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyGeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/MappedFieldType.java
core/src/main/java/org/elasticsearch/index/query/BoolQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceRangeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoPolygonQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeohashCellQuery.java
core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryParseContext.java
core/src/main/java/org/elasticsearch/index/search/geo/GeoDistanceRangeQuery.java
core/src/main/java/org/elasticsearch/index/search/geo/LegacyIndexedGeoBoundingBoxQuery.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/termvectors/TermVectorsService.java
core/src/main/java/org/elasticsearch/indices/IndicesModule.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/ListPluginsCommand.java
core/src/main/java/org/elasticsearch/repositories/VerifyNodeRepositoryAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestIndicesAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestBulkAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestGetAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestHeadAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestMultiGetAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestUpdateAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestExplainAction.java
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/main/java/org/elasticsearch/search/fetch/FetchSearchResult.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/FetchSourceContext.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/FetchSourceSubPhase.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/CustomQueryScorer.java
core/src/main/java/org/elasticsearch/search/internal/FilteredSearchContext.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHits.java
core/src/main/java/org/elasticsearch/search/internal/SearchContext.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchLocalRequest.java
core/src/main/java/org/elasticsearch/search/internal/SubSearchContext.java
core/src/main/java/org/elasticsearch/search/query/QueryPhase.java
core/src/main/java/org/elasticsearch/search/query/QuerySearchResult.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestion.java
core/src/main/java/org/elasticsearch/search/suggest/completion/context/GeoContextMapping.java
core/src/main/java/org/elasticsearch/snapshots/RestoreService.java
core/src/main/java/org/elasticsearch/transport/TransportInterceptor.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TaskManagerTestCase.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TasksIT.java
core/src/test/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/shards/IndicesShardStoreRequestIT.java
core/src/test/java/org/elasticsearch/action/admin/indices/template/put/MetaDataIndexTemplateServiceTests.java
core/src/test/java/org/elasticsearch/action/bulk/BulkRequestTests.java
core/src/test/java/org/elasticsearch/action/bulk/BulkWithUpdatesIT.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionTookTests.java
core/src/test/java/org/elasticsearch/action/get/MultiGetShardRequestTests.java
core/src/test/java/org/elasticsearch/action/ingest/IngestProxyActionFilterTests.java
core/src/test/java/org/elasticsearch/action/main/MainActionTests.java
core/src/test/java/org/elasticsearch/action/search/SearchPhaseControllerTests.java
core/src/test/java/org/elasticsearch/action/search/TransportMultiSearchActionTests.java
core/src/test/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeActionTests.java
core/src/test/java/org/elasticsearch/action/support/master/IndexingMasterFailoverIT.java
core/src/test/java/org/elasticsearch/action/support/master/TransportMasterNodeActionTests.java
core/src/test/java/org/elasticsearch/action/support/nodes/TransportNodesActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/BroadcastReplicationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationActionTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/bootstrap/ElasticsearchCliTests.java
core/src/test/java/org/elasticsearch/bwcompat/RepositoryUpgradabilityIT.java
core/src/test/java/org/elasticsearch/client/AbstractClientHeadersTestCase.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientHeadersTests.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientNodesServiceTests.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/NodeConnectionsServiceTests.java
core/src/test/java/org/elasticsearch/cluster/action/shard/ShardFailedClusterStateTaskExecutorTests.java
core/src/test/java/org/elasticsearch/cluster/action/shard/ShardStateActionTests.java
core/src/test/java/org/elasticsearch/cluster/allocation/AwarenessAllocationIT.java
core/src/test/java/org/elasticsearch/cluster/health/ClusterStateHealthTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataDeleteIndexServiceTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeServiceTests.java
core/src/test/java/org/elasticsearch/cluster/routing/DelayedAllocationServiceTests.java
core/src/test/java/org/elasticsearch/cluster/routing/PrimaryTermsTests.java
core/src/test/java/org/elasticsearch/cluster/routing/RoutingTableTests.java
core/src/test/java/org/elasticsearch/cluster/routing/UnassignedInfoTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AddIncrementallyTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AllocationCommandsTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AllocationPriorityTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AwarenessAllocationTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/BalanceConfigurationTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/BalanceUnbalancedClusterTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/CatAllocationTestCase.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/ClusterRebalanceRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/ConcurrentRebalanceRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/DeadNodesAllocationTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/ElectReplicaAsPrimaryDuringRelocationTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/ExpectedShardSizeAllocationTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/FailedNodeRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/FailedShardsRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/FilterAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/FilterRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/InSyncAllocationIdTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/IndexBalanceTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/MaxRetryAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/NodeVersionAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/PreferLocalPrimariesToRelocatingPrimariesTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/PreferPrimaryAllocationTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/PrimaryElectionRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/PrimaryNotRelocatedWhileBeingRecoveredTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/RandomAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/RebalanceAfterActiveTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/RoutingNodesIntegrityTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/SameShardRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/ShardsLimitAllocationTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/SingleShardNoReplicasRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/SingleShardOneReplicaRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/StartedShardsRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/TenShardsOneReplicaRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/ThrottlingAllocationTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/UnassignedShardDecisionTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/UpdateNumberOfReplicasTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDeciderUnitTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/EnableAllocationTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceIT.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
core/src/test/java/org/elasticsearch/cluster/structure/RoutingIteratorTests.java
core/src/test/java/org/elasticsearch/common/geo/GeoJSONShapeParserTests.java
core/src/test/java/org/elasticsearch/common/network/NetworkModuleTests.java
core/src/test/java/org/elasticsearch/common/network/NetworkUtilsTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryModuleTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/discovery/ZenFaultDetectionTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ElectMasterServiceTests.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeJoinControllerTests.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeRemovalClusterStateTaskExecutorTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryIT.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenPingTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ping/unicast/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/discovery/zen/publish/PublishClusterStateActionTests.java
core/src/test/java/org/elasticsearch/document/DocumentActionsIT.java
core/src/test/java/org/elasticsearch/env/NodeEnvironmentTests.java
core/src/test/java/org/elasticsearch/explain/ExplainActionIT.java
core/src/test/java/org/elasticsearch/fieldstats/FieldStatsTests.java
core/src/test/java/org/elasticsearch/gateway/GatewayIndexStateIT.java
core/src/test/java/org/elasticsearch/gateway/QuorumGatewayIT.java
core/src/test/java/org/elasticsearch/get/GetActionIT.java
core/src/test/java/org/elasticsearch/index/IndexServiceTests.java
core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentParserTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingDisabledTests.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalMapper.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalValuesMapperIntegrationIT.java
core/src/test/java/org/elasticsearch/index/mapper/GeoPointFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/GeoPointFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/GeohashMappingGeoPointTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyGeohashMappingGeoPointTests.java
core/src/test/java/org/elasticsearch/index/mapper/MultiFieldsIntegrationIT.java
core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoDistanceQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoDistanceRangeQueryTests.java
core/src/test/java/org/elasticsearch/index/query/GeoPolygonQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeohashCellQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/NestedQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/RangeQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/ShardUtilsTests.java
core/src/test/java/org/elasticsearch/index/store/CorruptedFileIT.java
core/src/test/java/org/elasticsearch/indices/IndexingMemoryControllerTests.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
core/src/test/java/org/elasticsearch/indices/recovery/IndexPrimaryRelocationIT.java
core/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsIT.java
core/src/test/java/org/elasticsearch/indices/state/RareClusterStateIT.java
core/src/test/java/org/elasticsearch/indices/store/IndicesStoreTests.java
core/src/test/java/org/elasticsearch/recovery/RecoveryWhileUnderLoadIT.java
core/src/test/java/org/elasticsearch/recovery/RelocationIT.java
core/src/test/java/org/elasticsearch/rest/action/RestMainActionTests.java
core/src/test/java/org/elasticsearch/rest/action/cat/RestIndicesActionTests.java
core/src/test/java/org/elasticsearch/search/AbstractSearchTestCase.java
core/src/test/java/org/elasticsearch/search/DefaultSearchContextTests.java
core/src/test/java/org/elasticsearch/search/SearchRequestTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorParsingTests.java
comments:
Merge branch 'master' into doc/plugins-offline-url

# Conflicts:
#	docs/plugins/mapper-attachments.asciidoc

time:
2016-09-19T12:47:14Z
class:
plugins/mapper-attachments/src/main/java/org/elasticsearch/mapper/attachments/AttachmentMapper.java
plugins/mapper-attachments/src/main/java/org/elasticsearch/mapper/attachments/MapperAttachmentsPlugin.java
plugins/mapper-attachments/src/main/java/org/elasticsearch/mapper/attachments/TikaImpl.java
plugins/mapper-attachments/src/test/java/org/elasticsearch/mapper/attachments/AttachmentUnitTestCase.java
plugins/mapper-attachments/src/test/java/org/elasticsearch/mapper/attachments/DateAttachmentMapperTests.java
plugins/mapper-attachments/src/test/java/org/elasticsearch/mapper/attachments/EncryptedDocMapperTests.java
plugins/mapper-attachments/src/test/java/org/elasticsearch/mapper/attachments/LanguageDetectionAttachmentMapperTests.java
plugins/mapper-attachments/src/test/java/org/elasticsearch/mapper/attachments/MapperAttachmentsClientYamlTestSuiteIT.java
plugins/mapper-attachments/src/test/java/org/elasticsearch/mapper/attachments/MetadataMapperTests.java
plugins/mapper-attachments/src/test/java/org/elasticsearch/mapper/attachments/MultifieldAttachmentMapperTests.java
plugins/mapper-attachments/src/test/java/org/elasticsearch/mapper/attachments/SimpleAttachmentMapperTests.java
plugins/mapper-attachments/src/test/java/org/elasticsearch/mapper/attachments/TikaDocTests.java
plugins/mapper-attachments/src/test/java/org/elasticsearch/mapper/attachments/TikaImplTests.java
plugins/mapper-attachments/src/test/java/org/elasticsearch/mapper/attachments/VariousDocTests.java
comments:
Merge branch 'pr/remove-mapper-attachments'

time:
2016-09-19T12:31:09Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AwarenessAllocationDecider.java
comments:
Merge pull request #20553 from jasontedor/node-attributes

Node attributes and REST API spec README

time:
2016-09-19T12:28:16Z
class:
comments:
Upgrade from JMH 1.12 to JMH 1.14

time:
2016-09-19T12:28:16Z
class:
comments:
Provide log4j2 logging config for microbenchmarks

time:
2016-09-19T11:54:35Z
class:
benchmarks/src/main/java/org/elasticsearch/benchmark/routing/allocation/AllocationBenchmark.java
core/src/main/java/org/elasticsearch/action/admin/cluster/reroute/TransportClusterRerouteAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/settings/TransportClusterUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataDeleteIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexStateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java
core/src/main/java/org/elasticsearch/cluster/routing/DelayedAllocationService.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingService.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationService.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RoutingAllocation.java
core/src/main/java/org/elasticsearch/discovery/local/LocalDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/NodeJoinController.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/gateway/GatewayService.java
core/src/main/java/org/elasticsearch/gateway/LocalAllocateDangledIndices.java
core/src/main/java/org/elasticsearch/snapshots/RestoreService.java
core/src/test/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/cluster/action/shard/ShardFailedClusterStateTaskExecutorTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataDeleteIndexServiceTests.java
core/src/test/java/org/elasticsearch/cluster/routing/DelayedAllocationServiceTests.java
core/src/test/java/org/elasticsearch/cluster/routing/PrimaryTermsTests.java
core/src/test/java/org/elasticsearch/cluster/routing/RoutingTableTests.java
core/src/test/java/org/elasticsearch/cluster/routing/UnassignedInfoTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AddIncrementallyTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AllocationCommandsTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AllocationPriorityTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AwarenessAllocationTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/BalanceConfigurationTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/BalanceUnbalancedClusterTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/CatAllocationTestCase.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/ClusterRebalanceRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/ConcurrentRebalanceRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/DeadNodesAllocationTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/ElectReplicaAsPrimaryDuringRelocationTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/ExpectedShardSizeAllocationTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/FailedNodeRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/FailedShardsRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/FilterAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/FilterRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/InSyncAllocationIdTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/IndexBalanceTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/MaxRetryAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/NodeVersionAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/PreferLocalPrimariesToRelocatingPrimariesTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/PreferPrimaryAllocationTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/PrimaryElectionRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/PrimaryNotRelocatedWhileBeingRecoveredTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/RandomAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/RebalanceAfterActiveTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/RoutingNodesIntegrityTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/SameShardRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/ShardsLimitAllocationTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/SingleShardNoReplicasRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/SingleShardOneReplicaRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/StartedShardsRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/TenShardsOneReplicaRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/ThrottlingAllocationTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/UpdateNumberOfReplicasTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDeciderUnitTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/EnableAllocationTests.java
core/src/test/java/org/elasticsearch/cluster/structure/RoutingIteratorTests.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeRemovalClusterStateTaskExecutorTests.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
core/src/test/java/org/elasticsearch/indices/state/RareClusterStateIT.java
test/framework/src/main/java/org/elasticsearch/cluster/ESAllocationTestCase.java
comments:
Remove `RoutingAllocation.Result` (#20538)

Currently all the reroute-like methods of `AllocationService` return a result object of type `RoutingAllocation.Result`. The result object contains the new `RoutingTable` and `MetaData` plus an indication whether those were changed. The caller is then responsible of updating a cluster state with these. These means that things can easily go wrong and one can take one of these but not the other causing inconsistencies. We already have a utility method on the `ClusterState` builder that does but no one forces you to do so. Also 99% of the callers do the same thing: i.e., check if the result was changed and if so update the very same cluster state that was passed to `AllocationService`.  This PR folds this pattern into `AllocationService` and changes almost all it's methods to return a new cluster state (potentially the original one).  This saves some 500 lines of code.

The one exception here is the reroute API which executes allocation commands and potentially returns an explanation as well (next to the routing table and metadata). That API now returns a `CommandsResult` object which encapsulate a cluster state and the explanation.

time:
2016-09-19T11:54:04Z
class:
comments:
Fix minhash docs level

Relates #20547

time:
2016-09-19T11:47:02Z
class:
comments:
Fix command-line arguments in REST API spec

The command-line arguments for Elasticsearch must now be specified using
-E. This commit fixes the usage of command-line arguments in the REST
API spec README.

time:
2016-09-19T11:45:31Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AwarenessAllocationDecider.java
comments:
Fix leftover node attributes usage

Previously node attributes could be set via node.* but this now requires
using node.attr.*. This commit fixes some leftover usages of the old
way.

time:
2016-09-19T09:56:28Z
class:
comments:
[DOC] Remove obsolete node names from documentation

Funny node names have been removed in #19456 and replaced by UUID. This commit removes these obsolete node names and replace them by real UUIDs in the documentation.

closes #20065

time:
2016-09-19T07:31:48Z
class:
comments:
[DOC] Update /_cat/nodes doc

closes #20162

time:
2016-09-19T07:01:16Z
class:
plugins/mapper-attachments/src/main/java/org/elasticsearch/mapper/attachments/AttachmentMapper.java
plugins/mapper-attachments/src/main/java/org/elasticsearch/mapper/attachments/MapperAttachmentsPlugin.java
plugins/mapper-attachments/src/main/java/org/elasticsearch/mapper/attachments/TikaImpl.java
plugins/mapper-attachments/src/test/java/org/elasticsearch/mapper/attachments/AttachmentUnitTestCase.java
plugins/mapper-attachments/src/test/java/org/elasticsearch/mapper/attachments/DateAttachmentMapperTests.java
plugins/mapper-attachments/src/test/java/org/elasticsearch/mapper/attachments/EncryptedDocMapperTests.java
plugins/mapper-attachments/src/test/java/org/elasticsearch/mapper/attachments/LanguageDetectionAttachmentMapperTests.java
plugins/mapper-attachments/src/test/java/org/elasticsearch/mapper/attachments/MapperAttachmentsClientYamlTestSuiteIT.java
plugins/mapper-attachments/src/test/java/org/elasticsearch/mapper/attachments/MetadataMapperTests.java
plugins/mapper-attachments/src/test/java/org/elasticsearch/mapper/attachments/MultifieldAttachmentMapperTests.java
plugins/mapper-attachments/src/test/java/org/elasticsearch/mapper/attachments/SimpleAttachmentMapperTests.java
plugins/mapper-attachments/src/test/java/org/elasticsearch/mapper/attachments/TikaDocTests.java
plugins/mapper-attachments/src/test/java/org/elasticsearch/mapper/attachments/TikaImplTests.java
plugins/mapper-attachments/src/test/java/org/elasticsearch/mapper/attachments/VariousDocTests.java
comments:
Remove mapper attachments plugin

We now have in 5.0.0 `ingest-attachment` plugin.
We can remove `mapper-attachments` plugin for 6.0.

Closes #18837.

time:
2016-09-17T21:29:24Z
class:
comments:
Added wildcards imports configuration for IntelliJ IDEA

Closes #20534

time:
2016-09-17T21:23:27Z
class:
comments:
Fixed aggregation by "gender" request example.

`gender.keyword` should be used instead of just `gender` or we
get an error `Fielddata is disabled on text fields by default. Set
fielddata=true on [gender] in order to load fielddata in memory by
uninverting the inverted index. Note that this can however use

Closes #20535
significant memory.`

time:
2016-09-16T23:21:26Z
class:
qa/rolling-upgrade/src/test/java/org/elasticsearch/upgrades/UpgradeClusterClientYamlTestSuiteIT.java
test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java
comments:
Adds a preserveIndicesUponCompletion method to ESRestTestCase
that can be overridden by subclasses if the test must not
delete indices it created after exiting.

time:
2016-09-16T20:32:43Z
class:
comments:
Removes stopNodeUponCompletion in favor of moving the stop
nodes task to the final part of the cluster test task execution
graph.

time:
2016-09-16T20:06:18Z
class:
comments:
Improves the documentation for the (#20531)

`cluster.routing.allocation.cluster_concurrent_rebalance` setting,
clarifying in which shard allocation situations the rebalance limit
takes effect.

Closes #20529

time:
2016-09-16T19:05:55Z
class:
core/src/test/java/org/elasticsearch/search/AbstractSearchTestCase.java
core/src/test/java/org/elasticsearch/search/SearchRequestTests.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
core/src/test/java/org/elasticsearch/search/fetch/FetchSubPhasePluginIT.java
core/src/test/java/org/elasticsearch/search/internal/ShardSearchTransportRequestTests.java
comments:
Merge pull request #20521 from javanna/test/random_search_ext

introduce test plugin to inject random search ext elements in search request tests

time:
2016-09-16T19:03:27Z
class:
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
comments:
[TEST] delete specific index boost serialization test, already covered by testSerialization

indexBoost is already randomly set, we don't need a specific test for it in SearchSourceBuilderTests

time:
2016-09-16T19:03:27Z
class:
core/src/test/java/org/elasticsearch/search/fetch/FetchSubPhasePluginIT.java
comments:
[TEST] set back the visibility of our search ext plugin in FetchSubPhasePluginIT to private

This plugin is not used in other tests anymore, it should be private to make sure its usage doesn't spread again

time:
2016-09-16T19:03:27Z
class:
core/src/test/java/org/elasticsearch/search/AbstractSearchTestCase.java
core/src/test/java/org/elasticsearch/search/SearchRequestTests.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
core/src/test/java/org/elasticsearch/search/internal/ShardSearchTransportRequestTests.java
comments:
[TEST] introduce test plugin to inject random search ext elements in search request tests

A few of our unit tests generate a random search request body nd run tests against it. The source can optionally contain ext elements under the ext sections, which can be parsed by plugins. With this commit we introduce a plugin so that the tests don't use the one from FetchSubPhasePluginIT anymore. They rather generate multiple search ext elements. The plugin can parse and deal with all those. This extends the test coverage as we may have multiple elements with random names.

Took the chance to introduce a common test base class for search requests, called AbstractSearchTestCase, given that the setup phase is the same for all three tests around search source. Then we can have the setup isolated to the base class and the subclasses relying on it.

Closes #17685

time:
2016-09-16T19:02:12Z
class:
core/src/main/java/org/elasticsearch/index/query/BoolQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryParseContext.java
core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
comments:
Throw error if query element doesn't end with END_OBJECT (#20528)

* Throw error if query element doesn't end with END_OBJECT

Followup to #20515 where we added validation that after we parse a query within a query element, we should not get a field name. Truth is that the only token allowed at that point is END_OBJECT, as our DSL allows only one single query within the query object:

```
{
  "query" : {
    "term" : { "field" : "value" }
  }
}
```

We can then check that after parsing of the query we have an end_object that closes the query itself (which we already do). Following that we can check that the query object is immediately closed, as there are no other tokens that can be present in that position.

Relates to #20515

time:
2016-09-16T16:18:41Z
class:
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TasksIT.java
comments:
Fix up tasks integ test

I'd made some mistakes that hadn't caused the test to fail but did
slow it down and partially invalidate some of the assertions. This
fixes those mistakes.

time:
2016-09-16T16:16:40Z
class:
comments:
Edited response structure on indexing a document (#20517)

Added "_shards" and "result" keys to the response.

time:
2016-09-16T15:32:28Z
class:
comments:
Disables unit tests for rolling upgrades, as there are only
rest integration tests.

time:
2016-09-16T14:43:38Z
class:
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/RestNoopBulkAction.java
core/src/main/java/org/apache/logging/log4j/core/jmx/Server.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStats.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/NodesStatsRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/TransportGetTaskAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/DetailAnalyzeResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStats.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStatsFlags.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/ShardStats.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/get/GetIndexTemplatesResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/TransportPutIndexTemplateAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/TransportValidateQueryAction.java
core/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/explain/ExplainRequest.java
core/src/main/java/org/elasticsearch/action/explain/ExplainRequestBuilder.java
core/src/main/java/org/elasticsearch/action/explain/TransportExplainAction.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStats.java
core/src/main/java/org/elasticsearch/action/get/GetRequest.java
core/src/main/java/org/elasticsearch/action/get/GetRequestBuilder.java
core/src/main/java/org/elasticsearch/action/get/GetResponse.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequest.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequestBuilder.java
core/src/main/java/org/elasticsearch/action/get/MultiGetShardRequest.java
core/src/main/java/org/elasticsearch/action/get/TransportGetAction.java
core/src/main/java/org/elasticsearch/action/get/TransportShardMultiGetAction.java
core/src/main/java/org/elasticsearch/action/main/MainResponse.java
core/src/main/java/org/elasticsearch/action/main/TransportMainAction.java
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/TransportClearScrollAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java
core/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java
core/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequestBuilder.java
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapException.java
core/src/main/java/org/elasticsearch/bootstrap/Elasticsearch.java
core/src/main/java/org/elasticsearch/bootstrap/JarHell.java
core/src/main/java/org/elasticsearch/bootstrap/Security.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolver.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/UnassignedShardDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AllocationDeciders.java
core/src/main/java/org/elasticsearch/common/geo/GeoPoint.java
core/src/main/java/org/elasticsearch/common/io/stream/NamedWriteableRegistry.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java
core/src/main/java/org/elasticsearch/common/logging/ESLoggerFactory.java
core/src/main/java/org/elasticsearch/common/logging/LogConfigurator.java
core/src/main/java/org/elasticsearch/common/logging/Loggers.java
core/src/main/java/org/elasticsearch/common/logging/PrefixLogger.java
core/src/main/java/org/elasticsearch/common/logging/PrefixMessageFactory.java
core/src/main/java/org/elasticsearch/common/lucene/LoggerInfoStream.java
core/src/main/java/org/elasticsearch/common/network/NetworkModule.java
core/src/main/java/org/elasticsearch/common/network/NetworkUtils.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/util/PageCacheRecycler.java
core/src/main/java/org/elasticsearch/common/xcontent/XContent.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentBuilder.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentGenerator.java
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContentGenerator.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryStats.java
core/src/main/java/org/elasticsearch/discovery/local/LocalDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/ElectMasterService.java
core/src/main/java/org/elasticsearch/discovery/zen/NodeJoinController.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/fd/MasterFaultDetection.java
core/src/main/java/org/elasticsearch/discovery/zen/fd/NodesFaultDetection.java
core/src/main/java/org/elasticsearch/discovery/zen/membership/MembershipAction.java
core/src/main/java/org/elasticsearch/discovery/zen/ping/PingContextProvider.java
core/src/main/java/org/elasticsearch/discovery/zen/ping/ZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/ping/ZenPingService.java
core/src/main/java/org/elasticsearch/discovery/zen/ping/unicast/UnicastZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/publish/PendingClusterStateStats.java
core/src/main/java/org/elasticsearch/discovery/zen/publish/PublishClusterStateAction.java
core/src/main/java/org/elasticsearch/env/NodeEnvironment.java
core/src/main/java/org/elasticsearch/gateway/BaseGatewayShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/ReplicaShardAllocator.java
core/src/main/java/org/elasticsearch/http/HttpStats.java
core/src/main/java/org/elasticsearch/index/IndexSettings.java
core/src/main/java/org/elasticsearch/index/MergeSchedulerConfig.java
core/src/main/java/org/elasticsearch/index/VersionType.java
core/src/main/java/org/elasticsearch/index/analysis/AnalysisRegistry.java
core/src/main/java/org/elasticsearch/index/analysis/MinHashTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractLatLonPointDVIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/LatLonPointDVAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/get/GetResult.java
core/src/main/java/org/elasticsearch/index/get/ShardGetService.java
core/src/main/java/org/elasticsearch/index/mapper/BaseGeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/GeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/GeoShapeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IpFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LatLonPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyGeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/MappedFieldType.java
core/src/main/java/org/elasticsearch/index/mapper/NumberFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceRangeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoPolygonQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeohashCellQuery.java
core/src/main/java/org/elasticsearch/index/query/IndicesQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryParseContext.java
core/src/main/java/org/elasticsearch/index/query/SpanNearQueryBuilder.java
core/src/main/java/org/elasticsearch/index/search/geo/GeoDistanceRangeQuery.java
core/src/main/java/org/elasticsearch/index/search/geo/LegacyIndexedGeoBoundingBoxQuery.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/termvectors/TermVectorsService.java
core/src/main/java/org/elasticsearch/indices/IndexingMemoryController.java
core/src/main/java/org/elasticsearch/indices/IndicesModule.java
core/src/main/java/org/elasticsearch/indices/IndicesQueryCache.java
core/src/main/java/org/elasticsearch/indices/IndicesRequestCache.java
core/src/main/java/org/elasticsearch/indices/NodeIndicesStats.java
core/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java
core/src/main/java/org/elasticsearch/indices/breaker/AllCircuitBreakerStats.java
core/src/main/java/org/elasticsearch/indices/breaker/CircuitBreakerStats.java
core/src/main/java/org/elasticsearch/indices/breaker/HierarchyCircuitBreakerService.java
core/src/main/java/org/elasticsearch/indices/fielddata/cache/IndicesFieldDataCache.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryState.java
core/src/main/java/org/elasticsearch/ingest/ConfigurationUtils.java
core/src/main/java/org/elasticsearch/ingest/Pipeline.java
core/src/main/java/org/elasticsearch/monitor/fs/FsInfo.java
core/src/main/java/org/elasticsearch/monitor/jvm/JvmInfo.java
core/src/main/java/org/elasticsearch/monitor/jvm/JvmStats.java
core/src/main/java/org/elasticsearch/monitor/process/ProcessProbe.java
core/src/main/java/org/elasticsearch/monitor/process/ProcessStats.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/node/NodeValidationException.java
core/src/main/java/org/elasticsearch/plugins/ListPluginsCommand.java
core/src/main/java/org/elasticsearch/plugins/SearchPlugin.java
core/src/main/java/org/elasticsearch/repositories/VerifyNodeRepositoryAction.java
core/src/main/java/org/elasticsearch/repositories/fs/FsRepository.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestPutIndexTemplateAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestIndicesAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestBulkAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestGetAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestHeadAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestMultiGetAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestUpdateAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestExplainAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/script/ScriptMetaData.java
core/src/main/java/org/elasticsearch/script/ScriptStats.java
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/main/java/org/elasticsearch/search/SearchExtBuilder.java
core/src/main/java/org/elasticsearch/search/SearchExtParser.java
core/src/main/java/org/elasticsearch/search/SearchExtRegistry.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/SearchPhase.java
core/src/main/java/org/elasticsearch/search/SearchRequestParsers.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregationPhase.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentileRanksAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentilesAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/percentile/PercentilesBucketPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/main/java/org/elasticsearch/search/dfs/DfsPhase.java
core/src/main/java/org/elasticsearch/search/fetch/FetchPhase.java
core/src/main/java/org/elasticsearch/search/fetch/FetchSearchResult.java
core/src/main/java/org/elasticsearch/search/fetch/FetchSubPhase.java
core/src/main/java/org/elasticsearch/search/fetch/FetchSubPhaseContext.java
core/src/main/java/org/elasticsearch/search/fetch/FetchSubPhaseParseElement.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/DocValueFieldsContext.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/DocValueFieldsFetchSubPhase.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/FetchSourceContext.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/FetchSourceSubPhase.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/CustomQueryScorer.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilder.java
core/src/main/java/org/elasticsearch/search/internal/FilteredSearchContext.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHits.java
core/src/main/java/org/elasticsearch/search/internal/SearchContext.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchLocalRequest.java
core/src/main/java/org/elasticsearch/search/internal/SubSearchContext.java
core/src/main/java/org/elasticsearch/search/query/QueryPhase.java
core/src/main/java/org/elasticsearch/search/query/QuerySearchResult.java
core/src/main/java/org/elasticsearch/search/rescore/RescorePhase.java
core/src/main/java/org/elasticsearch/search/searchafter/SearchAfterBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/SuggestPhase.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestion.java
core/src/main/java/org/elasticsearch/search/suggest/completion/context/GeoContextMapping.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/context/GeolocationContextMapping.java
core/src/main/java/org/elasticsearch/tasks/TaskInfo.java
core/src/main/java/org/elasticsearch/threadpool/ThreadPoolStats.java
core/src/main/java/org/elasticsearch/transport/TransportInterceptor.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/main/java/org/elasticsearch/transport/TransportStats.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStatsTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TaskManagerTestCase.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TasksIT.java
core/src/test/java/org/elasticsearch/action/admin/indices/TransportAnalyzeActionTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/alias/AliasActionsTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/shards/IndicesShardStoreRequestIT.java
core/src/test/java/org/elasticsearch/action/admin/indices/template/put/MetaDataIndexTemplateServiceTests.java
core/src/test/java/org/elasticsearch/action/bulk/BulkRequestTests.java
core/src/test/java/org/elasticsearch/action/bulk/BulkWithUpdatesIT.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionTookTests.java
core/src/test/java/org/elasticsearch/action/get/MultiGetShardRequestTests.java
core/src/test/java/org/elasticsearch/action/ingest/IngestActionFilterTests.java
core/src/test/java/org/elasticsearch/action/ingest/IngestProxyActionFilterTests.java
core/src/test/java/org/elasticsearch/action/ingest/SimulateDocumentSimpleResultTests.java
core/src/test/java/org/elasticsearch/action/ingest/SimulateExecutionServiceTests.java
core/src/test/java/org/elasticsearch/action/ingest/SimulatePipelineRequestParsingTests.java
core/src/test/java/org/elasticsearch/action/ingest/SimulatePipelineRequestTests.java
core/src/test/java/org/elasticsearch/action/ingest/SimulatePipelineResponseTests.java
core/src/test/java/org/elasticsearch/action/ingest/SimulateProcessorResultTests.java
core/src/test/java/org/elasticsearch/action/ingest/WriteableIngestDocumentTests.java
core/src/test/java/org/elasticsearch/action/main/MainActionTests.java
core/src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
core/src/test/java/org/elasticsearch/action/search/SearchPhaseControllerTests.java
core/src/test/java/org/elasticsearch/action/search/TransportMultiSearchActionTests.java
core/src/test/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeActionTests.java
core/src/test/java/org/elasticsearch/action/support/master/IndexingMasterFailoverIT.java
core/src/test/java/org/elasticsearch/action/support/master/TransportMasterNodeActionTests.java
core/src/test/java/org/elasticsearch/action/support/nodes/TransportNodesActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/BroadcastReplicationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationActionTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapCheckTests.java
core/src/test/java/org/elasticsearch/bootstrap/ElasticsearchCliTests.java
core/src/test/java/org/elasticsearch/bootstrap/JarHellTests.java
core/src/test/java/org/elasticsearch/bootstrap/MaxMapCountCheckTests.java
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/bwcompat/RepositoryUpgradabilityIT.java
core/src/test/java/org/elasticsearch/client/AbstractClientHeadersTestCase.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientHeadersTests.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientIT.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientNodesServiceTests.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/NodeConnectionsServiceTests.java
core/src/test/java/org/elasticsearch/cluster/action/shard/ShardStateActionTests.java
core/src/test/java/org/elasticsearch/cluster/allocation/AwarenessAllocationIT.java
core/src/test/java/org/elasticsearch/cluster/health/ClusterStateHealthTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeServiceTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/WildcardExpressionResolverTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/UnassignedShardDecisionTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceIT.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
core/src/test/java/org/elasticsearch/common/geo/GeoJSONShapeParserTests.java
core/src/test/java/org/elasticsearch/common/network/NetworkModuleTests.java
core/src/test/java/org/elasticsearch/common/network/NetworkUtilsTests.java
core/src/test/java/org/elasticsearch/common/settings/MemorySizeSettingsTests.java
core/src/test/java/org/elasticsearch/common/settings/SettingTests.java
core/src/test/java/org/elasticsearch/common/xcontent/BaseXContentTestCase.java
core/src/test/java/org/elasticsearch/common/xcontent/builder/XContentBuilderTests.java
core/src/test/java/org/elasticsearch/common/xcontent/cbor/JsonVsCborTests.java
core/src/test/java/org/elasticsearch/common/xcontent/smile/JsonVsSmileTests.java
core/src/test/java/org/elasticsearch/common/xcontent/support/XContentMapValuesTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryModuleTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/discovery/ZenFaultDetectionTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ElectMasterServiceTests.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeJoinControllerTests.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeRemovalClusterStateTaskExecutorTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryIT.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
comments:
Merge remote-tracking branch 'upstream/master' into rolling_upgrades

time:
2016-09-16T14:36:55Z
class:
comments:
In the rolling upgrades tests, we do not want to stop nodes
automatically between tasks, as we want some of the nodes from
the previous task to continue running in the next task. This
commit enables a cluster configuration setting to not stop
nodes automatically after a task runs, but instead the creator
of the test task must stop the running nodes explicitly in a
cleanup phase.

time:
2016-09-16T14:15:46Z
class:
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStats.java
core/src/test/java/org/elasticsearch/fieldstats/FieldStatsTests.java
comments:
Fix FieldStats deserialization of `ip` field (#20522)

* Fix FieldStats deserialization of `ip` field

Add missing readBytes in `ip` field deserialization
Add (de)serialization tests for all types
This change also removes the ability to set FieldStats.minValue or FieldStats.maxValue to null.
This is not required anymore since the stats are built on fields with values only.

Fixes #20516

time:
2016-09-16T14:13:38Z
class:
core/src/test/java/org/elasticsearch/common/geo/GeoJSONShapeParserTests.java
comments:
[TEST] Refactor Geo test names to follow naming and style convention

This commit closes a stale issue where GeoJson parsing tests used a combination of underscore and camel case.

closes #8998

time:
2016-09-16T14:11:53Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeServiceTests.java
comments:
Ensure elasticsearch doesn't start with unuspported indices (#20514)

If an index was created with pre 2.0 we should not treat it as supported
even if all segments have been upgraded to a supported lucene version.

Closes #20512

time:
2016-09-16T13:41:26Z
class:
comments:
When Elasticsearch nodes are started in gradle to form a
cluster, we wait for the cluster health to indicate the
necessary nodes have formed a cluster.  This check was an
exact value (equality) check.  However, if we are trying to
connect the nodes in the cluster to nodes from a previously
formed cluster (of the same name), then we will have more
nodes returned by the cluster health check than the current
task's configured number of nodes.  Hence, this check needs
to be a >= check.  This commit fixes it.

time:
2016-09-16T07:47:53Z
class:
core/src/main/java/org/elasticsearch/common/network/NetworkModule.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/transport/TransportInterceptor.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TaskManagerTestCase.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionTookTests.java
core/src/test/java/org/elasticsearch/action/ingest/IngestProxyActionFilterTests.java
core/src/test/java/org/elasticsearch/action/main/MainActionTests.java
core/src/test/java/org/elasticsearch/action/search/TransportMultiSearchActionTests.java
core/src/test/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeActionTests.java
core/src/test/java/org/elasticsearch/action/support/master/TransportMasterNodeActionTests.java
core/src/test/java/org/elasticsearch/action/support/nodes/TransportNodesActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/BroadcastReplicationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationActionTests.java
core/src/test/java/org/elasticsearch/client/AbstractClientHeadersTestCase.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientHeadersTests.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientNodesServiceTests.java
core/src/test/java/org/elasticsearch/cluster/NodeConnectionsServiceTests.java
core/src/test/java/org/elasticsearch/cluster/action/shard/ShardStateActionTests.java
core/src/test/java/org/elasticsearch/cluster/health/ClusterStateHealthTests.java
core/src/test/java/org/elasticsearch/common/network/NetworkModuleTests.java
core/src/test/java/org/elasticsearch/discovery/ZenFaultDetectionTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ping/unicast/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingDisabledTests.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
core/src/test/java/org/elasticsearch/indices/store/IndicesStoreTests.java
core/src/test/java/org/elasticsearch/transport/TransportModuleTests.java
core/src/test/java/org/elasticsearch/transport/TransportServiceHandshakeTests.java
modules/transport-netty3/src/test/java/org/elasticsearch/transport/Netty3SizeHeaderFrameDecoderTests.java
modules/transport-netty3/src/test/java/org/elasticsearch/transport/netty3/Netty3ScheduledPingTests.java
modules/transport-netty3/src/test/java/org/elasticsearch/transport/netty3/SimpleNetty3TransportTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/transport/netty4/Netty4ScheduledPingTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/transport/netty4/SimpleNetty4TransportTests.java
plugins/discovery-file/src/test/java/org/elasticsearch/discovery/file/FileBasedUnicastHostsProviderTests.java
test/framework/src/main/java/org/elasticsearch/node/MockNode.java
test/framework/src/main/java/org/elasticsearch/test/ExternalNode.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
test/framework/src/main/java/org/elasticsearch/transport/MockTransportClient.java
test/framework/src/test/java/org/elasticsearch/transport/MockTcpTransportTests.java
comments:
Remove ability to plug-in TransportService (#20505)

TransportService is such a central part of the core server, replacing
it's implementation is risky and can cause serious issues. This change removes the ability to
plug in TransportService but allows registering a TransportInterceptor that enables
plugins to intercept requests on both the sender and the receiver ends. This is a commonly used
and overwritten functionality but encapsulates the custom code in a contained manner.

time:
2016-09-15T21:39:11Z
class:
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/zen/ElectMasterService.java
core/src/main/java/org/elasticsearch/discovery/zen/NodeJoinController.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/ping/PingContextProvider.java
core/src/main/java/org/elasticsearch/discovery/zen/ping/ZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/ping/ZenPingService.java
core/src/main/java/org/elasticsearch/discovery/zen/ping/unicast/UnicastZenPing.java
core/src/test/java/org/elasticsearch/action/support/master/IndexingMasterFailoverIT.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/allocation/AwarenessAllocationIT.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryModuleTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/discovery/zen/ElectMasterServiceTests.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeJoinControllerTests.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeRemovalClusterStateTaskExecutorTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryIT.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenPingTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ping/unicast/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/gateway/GatewayIndexStateIT.java
core/src/test/java/org/elasticsearch/gateway/QuorumGatewayIT.java
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
test/framework/src/main/java/org/elasticsearch/test/disruption/NetworkDisruption.java
test/framework/src/main/java/org/elasticsearch/test/disruption/NetworkDisruptionTests.java
comments:
Add current cluster state version to zen pings and use them in master election (#20384)

During a networking partition, cluster states updates (like mapping changes or shard assignments)
are committed if a majority of the masters node received the update correctly. This means that the current master has access to enough nodes in the cluster to continue to operate correctly. When the network partition heals, the isolated nodes catch up with the current state and get the changes they couldn't receive before. However, if a second partition happens while the cluster
is still recovering from the previous one *and* the old master is put in the minority side, it may be that a new master is elected which did not yet catch up. If that happens, cluster state updates can be lost.

This commit fixed 95% of this rare problem by adding the current cluster state version to `PingResponse` and use them when deciding which master to join (and thus casting the node's vote). 

Note: this doesn't fully mitigate the problem as a cluster state update which is issued concurrently with a network partition can be lost if the partition prevents the commit message (part of the two phased commit of cluster state updates) from reaching any single node in the majority side *and* the partition does allow for the master to acknowledge the change. We are working on a more comprehensive fix but that requires considerate work  and is targeted at 6.0.

time:
2016-09-15T21:05:27Z
class:
comments:
Merge pull request #20488 from areek/docs/clarify_plugins_installation

[DOC] Add note requiring full cluster restart for installing plugins with custom metadata

time:
2016-09-15T21:04:45Z
class:
comments:
[DOC] Add note for full cluster restart for installing plugins using custom metadata

Currently, we check if a node has the same set of custom metadata as the master
before joining the cluster. This implies freshly installing a plugin that has its
custom metadata requires a full cluster restart.

time:
2016-09-15T20:56:26Z
class:
core/src/test/java/org/elasticsearch/search/sort/FieldSortIT.java
comments:
[TEST] Reduce the number of docs per indexRandom in FieldSortIT#testIssue6614

time:
2016-09-15T20:53:17Z
class:
core/src/main/java/org/elasticsearch/index/query/QueryParseContext.java
core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
comments:
Merge pull request #20515 from areek/fix/query_validation

Fix silently accepting malformed queries

time:
2016-09-15T20:32:28Z
class:
core/src/main/java/org/elasticsearch/index/query/QueryParseContext.java
core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
comments:
Fix silently accepting malformed queries

Currently, we silently accept malformed query where more
than one key is defined at the top-level for query object.
If all the keys have a valid query body, only the last query
is executed, besides throwing off parsing for additional suggest,
aggregation or highlighting defined in the search request.

This commit throws a parsing exception when we encounter a query
with multiple keys.

closes #20500

time:
2016-09-15T19:50:24Z
class:
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
comments:
add a reduced TCP_CONNECT_TIMEOUT setting to DiscoveryWithServiceDisruptionsIT

The default of 30s causes some tests to timeout when running ensureGreen and similar. This is because network delays simulation blocks connect until either the connect timeout expires or the disruption configured time stops. We do *not* immediately connect when the disruption is stopped.

time:
2016-09-15T19:08:11Z
class:
comments:
Better checks for the cluster being up in the rolling upgrades tests.

time:
2016-09-15T18:49:11Z
class:
test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java
comments:
Clean up snapshots after each REST test

The only repository we can be sure is safe to clean is `fs` so we clean
any snapshots in those repositories after each test. Other repositories
like url and azure tend to throw exceptions rather than let us fetch
their contents during the REST test. So we clean what we can....

Closes #18159

time:
2016-09-15T18:38:52Z
class:
core/src/test/java/org/elasticsearch/search/suggest/ContextCompletionSuggestSearchIT.java
comments:
[TEST] ensure context filtering with valid utf-8 characters work with completion suggester

time:
2016-09-15T15:58:21Z
class:
comments:
Convert more search docs to CONSOLE

`profile.asciidoc` now runs all of its command but it doesn't validate
all of the results. Writing the validation is time consuming so I only
did some of it.

time:
2016-09-15T14:25:17Z
class:
core/src/main/java/org/elasticsearch/action/main/MainResponse.java
core/src/main/java/org/elasticsearch/action/main/TransportMainAction.java
core/src/test/java/org/elasticsearch/action/main/MainActionTests.java
core/src/test/java/org/elasticsearch/rest/action/RestMainActionTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteResponseParsers.java
comments:
Add clusterUUID to RestMainAction output (#20503)

Add clusterUUID to RestMainAction output

GET / now returns the clusterUUID as well as part of its output for monitoring purposes

time:
2016-09-15T13:53:44Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Elasticsearch.java
comments:
Rename service.bat to elasticsearch-service.bat (#20496)

Closes gh-17528.

time:
2016-09-15T11:44:05Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/bootstrap/Elasticsearch.java
core/src/main/java/org/elasticsearch/common/logging/LogConfigurator.java
qa/evil-tests/src/test/java/org/elasticsearch/common/logging/EvilLoggerConfigurationTests.java
qa/evil-tests/src/test/java/org/elasticsearch/common/logging/EvilLoggerTests.java
comments:
Give useful error message if log config is missing

Today when starting Elasticsearch without a Log4j 2 configuration file,
we end up throwing an array index out of bounds exception. This is
because we are passing no configuration files to Log4j. Instead, we
should throw a useful error message to the user. This commit modifies
the Log4j configuration setup to throw a user exception if no Log4j
configuration files are present in the config directory.

Relates #20493

time:
2016-09-15T06:50:58Z
class:
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
comments:
testCanNotPublishWithoutMinMastNodes could time out if disruption hit just before cluster was fully formed

The test uses a NetworkDelay that drops requests and slows down connecting. Next to that it disable node fault detection to make sure nodes are not removed before we check our publishing. Sadly that can lead to huge slow downs if the disruption hits while a node is still pinging (and tries to connect, which is slowed down). Instead we can start the disruption on the cluster state thread, making sure the result of fault detection won't be processed before we publish

time:
2016-09-15T06:50:18Z
class:
test/framework/src/main/java/org/elasticsearch/test/disruption/LongGCDisruption.java
test/framework/src/main/java/org/elasticsearch/test/disruption/LongGCDisruptionTest.java
comments:
Fix LongGCDisruption to be aware of log4j2 (#20348)

LongGCDisruption simulates a Long GC by suspending all threads belonging to a node. That's fine, unless those threads hold shared locks that can prevent other nodes from running. Concretely the logging infrastructure, which is shared between the nodes, can cause some deadlocks. LongGCDisruption has protection for this, but it needs to be updated to point at log4j2 classes, introduced in #20235

This commit also fixes improper handling of retry logic in LongGCDisruption and adds a protection against deadlocking the test code which activates the disruption (and uses logging too! :)).

On top of that we have some new, evil and nasty tests.

time:
2016-09-15T03:34:19Z
class:
test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java
comments:
Prevent the rolling upgrades rest tests from cleaning up indices
after finishing if a the tests.rest.preserve_indices system property
is set

time:
2016-09-14T21:09:06Z
class:
comments:
Plugins: Use sysprop like with es.path.home to pass conf dir (#18870)

Currently we always pass -E to the the plugin cli with the conf dir, but
this causes a very confusing error message when not giving a specific
command to the plugin cli. This change makes path.conf pass just like
path.home. These are special settings, so passing via sysprops is the
right thing to do (it is all about how we pass between shell and java
cli).

closes #18689

time:
2016-09-14T20:37:02Z
class:
core/src/main/java/org/elasticsearch/index/mapper/MappedFieldType.java
comments:
Change 'norelease' in MappedFieldType to 'TODO'

This should not block any sort of release, it is only to be more
protective towards fields not having any settings changed.

time:
2016-09-14T20:10:49Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/test/java/org/elasticsearch/action/admin/indices/template/put/MetaDataIndexTemplateServiceTests.java
comments:
Merge remote-tracking branch 'dakrone/remove-idx-shard-count-norelease'

time:
2016-09-14T19:25:34Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/test/java/org/elasticsearch/action/admin/indices/template/put/MetaDataIndexTemplateServiceTests.java
comments:
Validate index settings differently when registering index template

This was actually a byproduct of trying to remove a //norelease for
index shard setting validation in MetaDataIndexService. This //norelease
is now removed. Previously this check was *only* used by the template
service, so we validated twice, once in the Settings infrastructure and
once when actually creating the index. We now instead use the Settings
infrastructure to validate the settings for shard count.

time:
2016-09-14T19:14:30Z
class:
comments:
[TEST] Fix SystemD test on Fedora 24

The journalctl command on Fedora24 returns an exit code 0 if no log entry exist in the journal, whereas other distributions return 1.

time:
2016-09-14T18:32:29Z
class:
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/fd/MasterFaultDetection.java
core/src/main/java/org/elasticsearch/discovery/zen/fd/NodesFaultDetection.java
core/src/main/java/org/elasticsearch/discovery/zen/membership/MembershipAction.java
core/src/main/java/org/elasticsearch/discovery/zen/ping/unicast/UnicastZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/publish/PublishClusterStateAction.java
core/src/main/java/org/elasticsearch/repositories/VerifyNodeRepositoryAction.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/discovery/zen/publish/PublishClusterStateActionTests.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
comments:
Remove TransportService#registerRequestHandler leniency (#20469)

`TransportService#registerRequestHandler` allowed to register
handlers more than once and issues an annoying warn log message when
this happens. This change simple throws an exception to prevent regsitering
the same handler more than once. This commit also removes the ability
to remove request handlers.

Relates to #20468

time:
2016-09-14T17:36:58Z
class:
comments:
Fixed typo in cat indices docs

time:
2016-09-14T17:35:20Z
class:
test/framework/src/main/java/org/elasticsearch/common/io/PathUtilsForTesting.java
comments:
Replace usage of LuceneTestCase#getBaseTempDirForTestClass (#20484)

LuceneTestCase#getBaseTempDirForTestClass is deprecated, we should not use it.

Closes #15845

time:
2016-09-14T17:33:23Z
class:
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
comments:
[TEST] remove unused currentTypes variable from SearchSourceBuilderTests

time:
2016-09-14T17:06:37Z
class:
comments:
CONSOLEify some search docs

* search/search.asciidoc
* search/request-body.asciidoc
* search/explain.asciidoc
* search/search-shards.asciidoc

time:
2016-09-14T16:58:03Z
class:
comments:
Correct the description for refresh

The refresh description should indicate that the affected shards are
refreshed as opposed to the entire index.

This was raised as a discrepancy on
discuss (https://discuss.elastic.co/t/refresh-parameter-of-index-api/59008/2)
on the .NET client that originates from code generated from the rest api
spec. The description has been updated in master but should be updated
for the 2.4.0 release.

time:
2016-09-14T16:26:03Z
class:
comments:
[Packaging] Run BATS upgrade tests against the current version (#20453)

BATS upgrade tests fails on master branch because it tries to install 2.x versions to upgrade from instead of 5.x versions. And since #18554 we should only test upgrades from 5.0.0-alpha4 versions.

This commit changes the vagrant tests so that it tries to list all the previous releases from version N-1. If nothing is found, it will fetch the current version and will run the upgrade tests with it. It works nicely with the current master 6.0.0-alpha1-SNAPSHOT. Once 5.0.0 is released it should run the test with it.

time:
2016-09-14T16:18:37Z
class:
comments:
[Package] Remove bin/lib/modules directories on RPM uninstall/upgrade (#20448)

When uninstalling or upgrading elasticsearch using the RPM package some empty directories remain on the filesystem:

    /usr/share/elasticsearch/bin
    /usr/share/elasticsearch/lib
    /usr/share/elasticsearch/modules
    /usr/share/elasticsearch/modules/foo

Having empty directories in modules can prevent elasticsearch to start after an upgrade: the plugins service expects to find a plugin-descriptor.properties file in every sub directory of modules.

This PR cleans things a bit so that these empty directories are removed on upgrade/removal like it was in 2.x.

time:
2016-09-14T16:07:10Z
class:
comments:
Update rescoring docs in respect to sort (#20477)

* Update rescoring docs in respect to sort

If sort is present in a query the rescore query is not executed. As long as this feature is neither implemented (see discussion in #6788) nor  the combination of sort and rescoring raises an error, we should warn the user in the documentation about this.

* Missed a dot

time:
2016-09-14T15:50:14Z
class:
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TasksIT.java
comments:
[TEST] Don't use transport client if we are blocking internal actions we might run into disconnects

time:
2016-09-14T15:44:45Z
class:
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHits.java
comments:
Remove unused imports

time:
2016-09-14T15:25:28Z
class:
qa/evil-tests/src/test/java/org/elasticsearch/common/logging/EvilLoggerTests.java
comments:
Simplify Log4j shutdown hack test

The Log4j shutdown hack test tests that a hack we have in place to
workaround a bug in Log4j during shutdown is effective. Log4j can use
JMX to control logging levels, but we disable this through the use of a
system property log4j2.disable.jmx (mainly because there is no need for
this feature, but it also means granting additional security
permissions). The bug in Log4j is that during shutdown, it neglects to
check whether or not its usage of JMX is disable and so it attempts to
unregister management beans, leading to a permissions violation. The
test works by attempting to shutdown Log4j and thus triggering the bad
code path. With the Log4j hack in place, we have introduced jar hell so
that its our code running instead of code from the Log4j jar. Our code
correctly checks that the usage of JMX is disabled and thus does not
trip on a permissions violation. The test was a little complicated in
that it attempted to just grant the minimal permissions needed for Log4j
to do its thing, but this can sometimes lead to other unwanted
permissions violations because the permissions put in place are more
restrictive necessary. This commit simplifies this situation by
rewriting the test to only deny Log4j the sole permission needed to
trigger the bug.

Relates #20476

time:
2016-09-14T15:23:40Z
class:
comments:
Don't generate html outputs from checkstyle (#20481)

We run our builds with `gradle --info` and that ends up generating horrific long dumps of xslt.

time:
2016-09-14T13:25:25Z
class:
core/src/main/java/org/elasticsearch/search/fetch/FetchSearchResult.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHits.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestion.java
core/src/test/java/org/elasticsearch/search/internal/InternalSearchHitTests.java
core/src/test/java/org/elasticsearch/search/sort/FieldSortIT.java
comments:
Remove poor-mans compression in InternalSearchHit and friends (#20472)

We still use some crazy poor mans compression in InternalSearchHit that
uses a thread local and an unordered map as a lookup table if requested.
Stuff like this should be handled by compression on the transport layer
rather than in-line in the serialization code. This code is complex enough.

time:
2016-09-14T13:23:17Z
class:
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
comments:
Only try to read new segments info if we really flushed the index (#20474)

There is no reason to read the current segments info unless we flushed
/ committed the lucene index.

time:
2016-09-14T12:08:49Z
class:
comments:
Update logger names in docs

In 7560101ec73331acb39a042bde6130e59e4bb630, the Elasticsearch logger
names were modified to be their fully-qualified class name (with some
exceptions for special loggers like the slow logs and the transport
tracer). This commit updates the docs accordingly.

Relates #20475

time:
2016-09-14T08:52:10Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
comments:
fix styling

time:
2016-09-14T08:34:40Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/TransportClearScrollAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java
comments:
Don't register SearchTransportService handlers more than once (#20468)

This utility class is used in 3 places while we only need to register
the handlers once per node. Otherwise we will see nasty `WARN` logs like:
`registered two transport handlers for action indices:data/read/search[phase/fetch/id/scroll]...`

This change will only register handlers inside the main TransportSearchAction.

time:
2016-09-14T08:11:27Z
class:
comments:
[Packaging] Do not remove scripts directory on upgrade (#20452)

When upgrading elasticsearch using the RPM package, the scripts directory is removed if it's empty but it won't be recreated by the upgraded package. But after that the service won't start because the scripts dir is missing.

time:
2016-09-14T08:07:53Z
class:
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorParsingTests.java
core/src/test/java/org/elasticsearch/search/aggregations/BaseAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/BasePipelineAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
comments:
Unguice SearchModule (#20456)

After this change SearchModule doesn't subclass AbstractModule anymore and all wiring
happens in `Node.java`. As a side-effect several tests don't need a guice injector anymore.

time:
2016-09-14T02:46:54Z
class:
core/src/main/java/org/elasticsearch/common/logging/ESLoggerFactory.java
core/src/main/java/org/elasticsearch/common/logging/Loggers.java
core/src/main/java/org/elasticsearch/common/lucene/LoggerInfoStream.java
core/src/test/java/org/elasticsearch/action/admin/indices/shards/IndicesShardStoreRequestIT.java
core/src/test/java/org/elasticsearch/bwcompat/RepositoryUpgradabilityIT.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceIT.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeJoinControllerTests.java
core/src/test/java/org/elasticsearch/discovery/zen/publish/PublishClusterStateActionTests.java
core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/store/CorruptedFileIT.java
core/src/test/java/org/elasticsearch/indices/recovery/IndexPrimaryRelocationIT.java
core/src/test/java/org/elasticsearch/recovery/RecoveryWhileUnderLoadIT.java
core/src/test/java/org/elasticsearch/recovery/RelocationIT.java
test/framework/src/main/java/org/elasticsearch/test/junit/annotations/TestLogging.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
comments:
Complete Elasticsearch logger names

This commit modifies the logger names within Elasticsearch to be the
fully-qualified class name as opposed removing the org.elasticsearch
prefix and dropping the class name. This change separates the root
logger from the Elasticsearch loggers (they were equated from the
removal of the org.elasticsearch prefix) and enables log levels to be
set at the class level (instead of the package level).

Relates #20457

time:
2016-09-14T02:46:14Z
class:
core/src/main/java/org/elasticsearch/common/logging/LogConfigurator.java
core/src/main/java/org/elasticsearch/common/logging/Loggers.java
qa/evil-tests/src/test/java/org/elasticsearch/common/logging/EvilLoggerConfigurationTests.java
comments:
Fix logging hierarchy configs

Today when setting the logging level via the command-line or an API
call, the expectation is that the logging level should trickle down the
hiearchy to descendant loggers. However, this is not necessarily the
case. For example, if loggers x and x.y are already configured then
setting the logging level on x will not descend to x.y. This is because
the logging config for x.y has already been forked from the logging
config for x. Therefore, we must explicitly descend the hierarchy when
setting the logging level and that is what this commit does.

Relates #20463

time:
2016-09-14T01:12:02Z
class:
plugins/ingest-geoip/src/main/java/org/elasticsearch/ingest/geoip/GeoIpProcessor.java
plugins/ingest-geoip/src/test/java/org/elasticsearch/ingest/geoip/GeoIpProcessorTests.java
comments:
[ingest-geoip] do not insert null-valued fields in geoip response

update geoip to not include null-valued results from database

Originally, the plugin would still insert all the requested fields, but
assign null to each one. This fixes that by not writing the fields at
all. Makes for a better experience when the null fields conflict with
the typical geo_point field mapping.

time:
2016-09-14T00:53:10Z
class:
comments:
Documentation for file-based discovery plugin (#20462)

Documentation for file-based discovery plugin.

Closes #20458

time:
2016-09-14T00:52:39Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/ping/unicast/UnicastZenPing.java
plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedDiscoveryPlugin.java
plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedUnicastHostsProvider.java
plugins/discovery-file/src/test/java/org/elasticsearch/discovery/file/FileBasedDiscoveryClientYamlTestSuiteIT.java
plugins/discovery-file/src/test/java/org/elasticsearch/discovery/file/FileBasedUnicastHostsProviderTests.java
comments:
File-based discovery plugin (#20394)

This commit introduces a new plugin for file-based unicast hosts
discovery. This allows specifying the unicast hosts participating
in discovery through a `unicast_hosts.txt` file located in the
`config/discovery-file` directory. The plugin will use the hosts 
specified in this file as the set of hosts to ping during discovery.

The format of the `unicast_hosts.txt` file is to have one host/port
entry per line. The hosts file is read and parsed every time
discovery makes ping requests, thus a new version of the file that
is published to the config directory will automatically be picked
up.

Closes #20323

time:
2016-09-14T00:40:24Z
class:
comments:
Docs: Added redirect for geohash_cell query topic.

time:
2016-09-13T23:04:00Z
class:
comments:
Fix spacing for json formatting

time:
2016-09-13T21:38:38Z
class:
comments:
[DOC] Cleanup dangling references to deprecated geo parameters

With the cut over to LatLonPoint the geohash, geohash_precision, lat_lon, and geohash_prefix parameters have been removed. This commit fixes the doc build by removing the remaining dangling references to these removed parameters.

time:
2016-09-13T21:27:55Z
class:
core/src/test/java/org/elasticsearch/index/mapper/ExternalFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/GeoPointFieldMapperTests.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceIT.java
comments:
[TEST] Fix geo_point backcompat tests

This commit fixes the following geo_point bwc tests:

* GeoDistanceIT to test deprecated GeoDistanceRangeQuery on legacy indexes only.
* ExternalFieldMapperTests to correctly handle LatLonPoint type
* GeoPointFieldMapperTests to correctly test stored geo_point fields

time:
2016-09-13T21:27:44Z
class:
qa/evil-tests/src/test/java/org/elasticsearch/common/logging/EvilLoggerConfigurationTests.java
comments:
Fix logger defaults test

This commit fixes the test EvilLoggerConfigurationTests#testDefaults.

time:
2016-09-13T21:05:52Z
class:
comments:
Build: Add pom building and associated files to rest api spec jar (#20460)

We put the rest api spec into a jar for upload to maven, so that we can
use within external rest tests. This change adds making a pom for maven
(as well as producing sources and javadoc jars, even though they will be
empty, because maven central requires them).

time:
2016-09-13T20:27:39Z
class:
core/src/test/java/org/elasticsearch/index/mapper/LegacyGeohashMappingGeoPointTests.java
comments:
[TEST] Refactor LegacyGeohashMappingGeoPointTests to 2.x indices only

These tests should only exist to ensure backcompat with 2.x indices.

