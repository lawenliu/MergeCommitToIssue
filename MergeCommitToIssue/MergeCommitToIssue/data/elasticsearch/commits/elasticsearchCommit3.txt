time:
2017-01-24T17:49:53Z
class:
core/src/main/java/org/elasticsearch/search/fetch/subphase/ParentFieldSubFetchPhase.java
comments:
skip parentid if child document is an orphan

#22770

time:
2017-01-24T16:34:05Z
class:
client/rest/src/main/java/org/elasticsearch/client/RestClient.java
client/rest/src/test/java/org/elasticsearch/client/RestClientMultipleHostsTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostIntegTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
comments:
Support Preemptive Authentication with RestClient (#21336)

This adds the necessary `AuthCache` needed to support preemptive authorization. By adding every host to the cache, the automatically added `RequestAuthCache` interceptor will add credentials on the first pass rather than waiting to do it after _each_ anonymous request is rejected (thus always sending everything twice when basic auth is required).

time:
2017-01-24T15:12:45Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseExecutionException.java
core/src/main/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeAction.java
core/src/main/java/org/elasticsearch/common/io/stream/NotSerializableExceptionWrapper.java
core/src/test/java/org/elasticsearch/ESExceptionTests.java
core/src/test/java/org/elasticsearch/ElasticsearchExceptionTests.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationResponseTests.java
core/src/test/java/org/elasticsearch/rest/BytesRestResponseTests.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Debug.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/ScriptImpl.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/DebugTests.java
comments:
Stop returning "es." internal exception headers as http response headers (#22703)

move "es." internal headers to separate metadata set in ElasticsearchException and stop returning them as response headers

Closes #17593

* [TEST] remove ESExceptionTests, move its methods to ElasticsearchExceptionTests or ExceptionSerializationTests

time:
2017-01-24T11:44:01Z
class:
comments:
Docs: Made cross-cluster search experimental

time:
2017-01-24T11:36:03Z
class:
core/src/main/java/org/elasticsearch/monitor/os/OsProbe.java
comments:
Add hack for Docker cgroups

Docker cgroups are mounted in the wrong place (i.e., inconsistently with
/proc/self/cgroup). This commit adds an undocumented hack for working
around, for now.

Relates #22757

time:
2017-01-24T10:17:58Z
class:
core/src/main/java/org/elasticsearch/action/delete/DeleteResponse.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentHelper.java
core/src/test/java/org/elasticsearch/action/delete/DeleteResponseTests.java
core/src/test/java/org/elasticsearch/action/get/GetResponseTests.java
core/src/test/java/org/elasticsearch/action/index/IndexResponseTests.java
core/src/test/java/org/elasticsearch/action/search/ShardSearchFailureTests.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationResponseTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateResponseTests.java
core/src/test/java/org/elasticsearch/common/xcontent/support/XContentHelperTests.java
core/src/test/java/org/elasticsearch/index/get/GetFieldTests.java
core/src/test/java/org/elasticsearch/index/get/GetResultTests.java
core/src/test/java/org/elasticsearch/search/internal/InternalSearchHitTests.java
core/src/test/java/org/elasticsearch/search/internal/InternalSearchHitsTests.java
core/src/test/java/org/elasticsearch/search/internal/SearchSortValuesTests.java
core/src/test/java/org/elasticsearch/search/profile/SearchProfileShardResultsTests.java
core/src/test/java/org/elasticsearch/search/profile/aggregation/AggregationProfileShardResultTests.java
core/src/test/java/org/elasticsearch/search/profile/query/QueryProfileShardResultTests.java
comments:
Include human readable responses in response parsing tests (#22717)

As a follow up to #22649, this changes the resent tests for parsing parts of search 
responses to randomly set the humanReadable() flag of the XContentBuilder that 
is used to render the responses. This should help to test that we can parse back 
thoses classes if the user specifies `?human=true` in the request url.

time:
2017-01-24T10:09:57Z
class:
comments:
Use Gradle-version specific source sets

Instead of using Gradle-version specific compilation options, use distinct source sets. This also allows compilation of buildSrc/build-tools under IDEs that
don't understand the version-specific compilation options.

Relates to #22669

time:
2017-01-24T10:09:57Z
class:
comments:
Make build Gradle 2.14 / 3.x compatible (#22669)

This changes build files so that building Elasticsearch works with both Gradle 2.13 as well as higher versions of Gradle (tested 2.14 and 3.3), enabling a smooth transition from Gradle 2.13 to 3.x.

time:
2017-01-24T09:25:02Z
class:
comments:
Add missing mime4j library

In some cases (apparently with outlook files), mime4j library is needed.
We removed it in the past which can cause elasticsearch to crash when you are using ingest-attachment (and probably mapper-attachments as well in 2.x series) with a file which requires this library.

 Similar problem as the one reported at #22077.

time:
2017-01-24T08:26:23Z
class:
core/src/main/java/org/elasticsearch/search/collapse/CollapseBuilder.java
comments:
Remove unused field in CollapseBuilder

time:
2017-01-24T07:34:16Z
class:
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
comments:
Add BWC tests for field collapsing

Field collapsing is supported from version 5.3

time:
2017-01-23T22:34:24Z
class:
plugins/discovery-gce/src/main/java/org/elasticsearch/cloud/gce/util/Access.java
plugins/repository-gcs/src/main/java/org/elasticsearch/common/blobstore/gcs/util/SocketAccess.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/util/SocketAccess.java
comments:
Use generic interfaces for checking socket access (#22753)

This commit replaces specialized functional interfaces in various
plugins with generic options. Instead of creating `StorageRunnable`
interfaces in every plugin we can just use `Runnable` or `CheckedRunnable`.

time:
2017-01-23T22:16:20Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/Definition.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/WriterConstants.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/api/Augmentation.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/api/package-info.java
comments:
Generate javadoc jar for painless's public API (#22704)

The simplest way to do that is to move the public API into a
new package and generate javadoc for that package.

time:
2017-01-23T21:30:42Z
class:
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
comments:
Rename constant

It deserves a new name after the cleanup in #22749

time:
2017-01-23T18:40:24Z
class:
core/src/test/java/org/elasticsearch/action/bulk/BulkRequestTests.java
comments:
[TEST] add test to verify that the SMILE format works within the _bulk api

time:
2017-01-23T16:57:43Z
class:
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
comments:
Fix parsing for `max_determinized_states` (#22749)

There was a typo in the `ParseField` declaration. I know
we want to port these parsers to `ObjectParser` eventually
but I don't have the energy for that today and want to get
this fixed.

Closes #22722

time:
2017-01-23T16:33:40Z
class:
comments:
Update span-multi-term-query.asciidoc (#22733)

"term" is not actually a multi-term query (perhaps confusion with "term range")

time:
2017-01-23T16:29:00Z
class:
comments:
"from" => "gte", "to" => "lte" in bool example (#22735)

time:
2017-01-23T15:39:11Z
class:
comments:
Add note regarding custom jvm.options

When users need to specify a custom location for configuration files,
they also need to specify a custom location for the jvm.options file yet
our docs are absent in this regard. This commit adds a note to the
rolling upgrade docs explaining this situation.

Relates #22747

time:
2017-01-23T15:33:51Z
class:
core/src/main/java/org/apache/lucene/search/grouping/CollapseTopFieldDocs.java
core/src/main/java/org/apache/lucene/search/grouping/CollapsingDocValuesSource.java
core/src/main/java/org/apache/lucene/search/grouping/CollapsingTopDocsCollector.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchRequestBuilder.java
core/src/main/java/org/elasticsearch/common/lucene/Lucene.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/main/java/org/elasticsearch/search/collapse/CollapseBuilder.java
core/src/main/java/org/elasticsearch/search/collapse/CollapseContext.java
core/src/main/java/org/elasticsearch/search/collapse/ExpandCollapseSearchResponseListener.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/DocValueFieldsFetchSubPhase.java
core/src/main/java/org/elasticsearch/search/internal/FilteredSearchContext.java
core/src/main/java/org/elasticsearch/search/internal/SearchContext.java
core/src/main/java/org/elasticsearch/search/internal/SubSearchContext.java
core/src/main/java/org/elasticsearch/search/query/QueryPhase.java
core/src/test/java/org/apache/lucene/grouping/CollapsingTopDocsCollectorTests.java
core/src/test/java/org/elasticsearch/search/AbstractSearchTestCase.java
core/src/test/java/org/elasticsearch/search/collapse/CollapseBuilderTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexParallelizationHelperTests.java
test/framework/src/main/java/org/elasticsearch/search/RandomSearchRequestGenerator.java
test/framework/src/main/java/org/elasticsearch/test/TestSearchContext.java
comments:
Add field collapsing for search request (#22337)

* Add top hits collapsing to search request

The field collapsing is done with a custom top docs collector that "collapse" search hits with same field value.
The distributed aspect is resolve using the two passes that the regular search uses. The first pass "collapse" the top hits, then the coordinating node merge/collapse the top hits from each shard.

```
GET _search
{
   "collapse": {
      "field": "category",
   }
}
```

This change also adds an ExpandCollapseSearchResponseListener that intercepts the search response and expands collapsed hits using the CollapseBuilder#innerHit} options.
The retrieval of each inner_hits is done by sending a query to all shards filtered by the collapse key.

```
GET _search
{
   "collapse": {
      "field": "category",
      "inner_hits": {
	"size": 2
      }
   }
}
```
This is a great feature, exactly what my team is looking for!
We are eagerly waiting for a stable version where this feature will be included (maybe 5.3 in 3-4 months from now).
It would be interesting to have a feature where the number of collapsed entries per result can be returned. Is there a plan to have such functionality?

time:
2017-01-23T15:24:55Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/valuecount/InternalValueCount.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/valuecount/InternalValueCountTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/valuecount/ValueCountAggregatorTests.java
comments:
Add unit tests for ValueCountAggregator and InternalValueCount (#22741)

Adds unit tests for the value count aggregator.

Relates #22278

time:
2017-01-23T15:07:29Z
class:
comments:
Docs: CONSOLE-ify value_count aggregation docs

Adds the `VIEW IN CONSOLE` and `COPY AS CURL` links to the snippets
in the `value_count` docs and causes the build to execute the snippets
for testing.

Release #18160

time:
2017-01-23T10:18:30Z
class:
comments:
Docs fix - Added missing link to new Adjacency-matrix agg

time:
2017-01-23T10:04:27Z
class:
core/src/main/java/org/elasticsearch/common/network/NetworkModule.java
core/src/main/java/org/elasticsearch/transport/TransportInterceptor.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientHeadersTests.java
core/src/test/java/org/elasticsearch/common/network/NetworkModuleTests.java
test/framework/src/main/java/org/elasticsearch/transport/AssertingTransportInterceptor.java
comments:
Pass `forceExecution` flag to transport interceptor (#22739)

To effectively allow a plugin to intercept a transport handler it needs
to know if the handler must be executed even if there is a rejection on the
thread pool in the case the wrapper forks a thread to execute the actual handler.

time:
2017-01-23T08:53:21Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
Version: Add missing releases from 2.x in Version.java (#22594)

time:
2017-01-23T06:32:56Z
class:
comments:
CONSOLE-ify filter aggregation docs

This adds the `VIEW IN CONSOLE` and `COPY AS CURL` links to the
snippet and causes the build to execute the snippet as a test.

Relates to #18160

time:
2017-01-23T04:38:45Z
class:
comments:
CONSOLE-ify date_range aggregation docs

This adds the `VIEW IN CONSOLE` and `COPY AS CURL` links to the
snippets in the docs for the `date_range` aggregation and tests
those snippets as part of the build.

Relates to #18160

time:
2017-01-21T18:03:52Z
class:
core/src/main/java/org/elasticsearch/SpecialPermission.java
core/src/test/java/org/elasticsearch/SpecialPermissionTests.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/ExpressionScriptEngineService.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MustacheScriptEngineService.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/PainlessScriptEngineService.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/channel/PrivilegedNioServerSocketChannel.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/channel/PrivilegedNioSocketChannel.java
plugins/discovery-azure-classic/src/main/java/org/elasticsearch/cloud/azure/classic/management/AzureComputeServiceImpl.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/util/SocketAccess.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/plugin/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/discovery-gce/src/main/java/org/elasticsearch/cloud/gce/util/Access.java
plugins/ingest-attachment/src/main/java/org/elasticsearch/ingest/attachment/TikaImpl.java
plugins/ingest-geoip/src/main/java/org/elasticsearch/ingest/geoip/GeoIpProcessor.java
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/blobstore/util/SocketAccess.java
plugins/repository-gcs/src/main/java/org/elasticsearch/common/blobstore/gcs/util/SocketAccess.java
plugins/repository-gcs/src/main/java/org/elasticsearch/plugin/repository/gcs/GoogleCloudStoragePlugin.java
plugins/repository-hdfs/src/main/java/org/elasticsearch/repositories/hdfs/HdfsBlobStore.java
plugins/repository-hdfs/src/main/java/org/elasticsearch/repositories/hdfs/HdfsPlugin.java
plugins/repository-hdfs/src/main/java/org/elasticsearch/repositories/hdfs/HdfsRepository.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/util/SocketAccess.java
plugins/repository-s3/src/main/java/org/elasticsearch/plugin/repository/s3/S3RepositoryPlugin.java
comments:
Add single static instance of SpecialPermission (#22726)

This commit adds a SpecialPermission constant and uses that constant
opposed to introducing new instances everywhere.

Additionally, this commit introduces a single static method to check that
the current code has permission. This avoids all the duplicated access
blocks that exist currently.

time:
2017-01-21T07:51:35Z
class:
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
comments:
Simplify InternalEngine#innerIndex (#22721)

Today `InternalEngine#innerIndex` is a pretty big method (> 150 SLoC). This
commit merged `#index` and `#innerIndex` and splits it up into smaller contained
methods.

time:
2017-01-21T03:48:01Z
class:
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/ExpressionExecutableScript.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/ExpressionScriptEngineService.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/ExpressionSearchScript.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/ReplaceableConstDoubleValueSource.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/ReplaceableConstDoubleValues.java
comments:
Upgrade to Lucene 6.4.0 (#22724)

* Upgrade to Lucene 6.4.0

`ValueSource`s are now converted to `DoubleValueSource`s using the Lucene adapter made for the migration to the new API in 6.4.0.

time:
2017-01-21T01:57:42Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/list/ListTasksResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/list/TaskGroup.java
core/src/main/java/org/elasticsearch/tasks/TaskInfo.java
core/src/main/java/org/elasticsearch/tasks/TaskResult.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TaskTests.java
comments:
Fix broken TaskInfo.toString()

Related to #22387

time:
2017-01-21T01:17:44Z
class:
core/src/main/java/org/elasticsearch/common/CheckedRunnable.java
core/src/main/java/org/elasticsearch/common/CheckedSupplier.java
comments:
Add CheckedSupplier and CheckedRunnable to core (#22725)

Introduce CheckedSupplier and CheckedRunnable functional interfaces
into core. These offer a checked version of the Supplier and Runnable
interfaces for use with lambda apis.

time:
2017-01-20T23:16:45Z
class:
comments:
Revert "Make build Gradle 2.14 / 3.x compatible (#22669)"

This reverts commit 652cb7dbf70c5f5b3c7ac98f7ca0c367b55a803b.

Relates #22727

time:
2017-01-20T23:00:46Z
class:
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/mockstore/MockRepository.java
comments:
Fixes retrieval of the latest snapshot index blob (#22700)

This commit ensures that the index.latest blob is first examined to
determine the latest index-N blob id, before attempting to list all
index-N blobs and picking the blob with the highest N.

It also fixes the MockRepository#move so that tests are able to handle
non-atomic moves.  This is done by adding a special setting to the
MockRepository that requires the test to specify if it can handle
non-atomic moves.  If so, then the MockRepository#move operation will be
non-atomic to allow testing for against such repositories.

time:
2017-01-20T21:23:28Z
class:
comments:
CONSOLE-ify date histogram docs

This adds the `VIEW IN SENSE` and `COPY AS CURL` links and has
the build automatically execute the snippets and verify that they
work.

Relates to #18160

time:
2017-01-20T20:33:00Z
class:
comments:
CONSOLE-ify min and max aggregation docs

Adds the `VIEW IN CONSOLE` and `COPY AS CURL` links to the docs
and makes the build automatically test them.

Relates to #18160

time:
2017-01-20T19:36:51Z
class:
comments:
CONSOLE-ify global-aggregation.asciidoc

Adds the `VIEW IN CONSOLE` and `COPY AS CURL` links to the example
`global` aggregation. Also improves the example by adding a
non-`global` aggregation to compare it to.

Relates to #18160

time:
2017-01-20T18:50:57Z
class:
core/src/main/java/org/elasticsearch/common/lucene/search/function/WeightFactorFunction.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreTests.java
comments:
Fix script score function that combines _score and weight (#22713)

The weight factor function does not check if the delegate score function needs to access the score of the query.
This results in a _score equals to 0 for all score function that set a weight.
This change modifies the WeightFactorFunction#needsScore to delegate the call to its underlying score function.

Fix #21483

time:
2017-01-20T18:00:10Z
class:
comments:
Corrected a plural verb to a singular one. (#22681)

time:
2017-01-20T17:45:10Z
class:
comments:
Fix duplicates from search.query (#22701)

search.query_current, search.query_time and search.query_total have wrong aliases.

time:
2017-01-20T17:39:37Z
class:
comments:
Readd unconverted snippets mark for doc

I accidentally removed it when cleaning up something else.

time:
2017-01-20T16:48:51Z
class:
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/NoopPlugin.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/RestNoopBulkAction.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/search/RestNoopSearchAction.java
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/common/path/PathTrie.java
core/src/main/java/org/elasticsearch/common/settings/SettingsModule.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/ActionPlugin.java
core/src/main/java/org/elasticsearch/rest/action/RestFieldStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/RestMainAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestCancelTasksAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterAllocationExplainAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterGetSettingsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterHealthAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterRerouteAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterSearchShardsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterStateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestCreateSnapshotAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestDeleteRepositoryAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestDeleteSnapshotAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestDeleteStoredScriptAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestGetRepositoriesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestGetSnapshotsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestGetStoredScriptAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestGetTaskAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestListTasksAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesHotThreadsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesInfoAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestPendingClusterTasksAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestPutRepositoryAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestPutStoredScriptAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestRestoreSnapshotAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestSnapshotsStatusAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestVerifyRepositoryAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAliasesExistAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestClearIndicesCacheAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestCloseIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestCreateIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestDeleteIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestDeleteIndexTemplateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestFlushAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestForceMergeAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetFieldMappingAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetIndexTemplateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetIndicesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetMappingAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetSettingsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestHeadIndexTemplateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndexDeleteAliasesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndexPutAliasAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesAliasesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesExistsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesSegmentsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesShardStoresAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestOpenIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestPutIndexTemplateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestPutMappingAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestRecoveryAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestRefreshAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestRolloverIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestShrinkIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestSyncedFlushAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestTypesExistsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestUpgradeAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestValidateQueryAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestAllocationAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestCatAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestFielddataAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestHealthAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestIndicesAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestMasterAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestNodeAttrsAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestNodesAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestPendingClusterTasksAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestPluginsAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestRecoveryAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestRepositoriesAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestSegmentsAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestShardsAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestSnapshotAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTasksAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTemplatesAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestThreadPoolAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestBulkAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestDeleteAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestGetAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestGetSourceAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestHeadAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestMultiGetAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestMultiTermVectorsAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestTermVectorsAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestUpdateAction.java
core/src/main/java/org/elasticsearch/rest/action/ingest/RestDeletePipelineAction.java
core/src/main/java/org/elasticsearch/rest/action/ingest/RestGetPipelineAction.java
core/src/main/java/org/elasticsearch/rest/action/ingest/RestPutPipelineAction.java
core/src/main/java/org/elasticsearch/rest/action/ingest/RestSimulatePipelineAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestClearScrollAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestExplainAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchScrollAction.java
core/src/test/java/org/elasticsearch/action/ActionModuleTests.java
core/src/test/java/org/elasticsearch/rest/action/cat/RestRecoveryActionTests.java
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MustachePlugin.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestDeleteSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestGetSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestMultiSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestPutSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestRenderSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestSearchTemplateAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexPlugin.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestRethrottleAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestUpdateByQueryAction.java
plugins/jvm-example/src/main/java/org/elasticsearch/plugin/example/ExampleCatAction.java
plugins/jvm-example/src/main/java/org/elasticsearch/plugin/example/ExamplePluginConfiguration.java
plugins/jvm-example/src/main/java/org/elasticsearch/plugin/example/JvmExamplePlugin.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/TestDeprecationHeaderRestAction.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/TestDeprecationPlugin.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/TestResponseHeaderPlugin.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/TestResponseHeaderRestAction.java
comments:
Deguice rest handlers (#22575)

There are presently 7 ctor args used in any rest handlers:
* `Settings`: Every handler uses it to initialize a logger and
  some other strange things.
* `RestController`: Every handler registers itself with it.
* `ClusterSettings`: Used by `RestClusterGetSettingsAction` to
  render the default values for cluster settings.
* `IndexScopedSettings`: Used by `RestGetSettingsAction` to get
  the default values for index settings.
* `SettingsFilter`: Used by a few handlers to filter returned
  settings so we don't expose stuff like passwords.
* `IndexNameExpressionResolver`: Used by `_cat/indices` to
  filter the list of indices.
* `Supplier<DiscoveryNodes>`: Used to fill enrich the response
  by handlers that list tasks.

We probably want to reduce these arguments over time but
switching construction away from guice gives us tighter
control over the list of available arguments.

These parameters are passed to plugins using
`ActionPlugin#initRestHandlers` which is expected to build and
return that handlers immediately. This felt simpler than
returning an reference to the ctors given all the different
possible args.

Breaks java plugins by moving rest handlers off of guice.

time:
2017-01-20T16:31:52Z
class:
comments:
Remove unused scripts from docs build

These were added in 5.x to support testing the lang-python and
lang-js plugins which have since been removed.

time:
2017-01-20T15:55:00Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/TranslogRecoveryPerformer.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/engine/ShadowEngineTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
comments:
Fix handling of document failure expcetion in InternalEngine (#22718)

Today we try to be smart and make a generic decision if an exception should
be treated as a document failure but in some cases concurrency in the index writer
make this decision very difficult since we don't have a consistent state in the case
another thread is currently failing the IndexWriter/InternalEngine due to a tragic event.

This change simplifies the exception handling and makes specific decisions about document failures
rather than using a generic heuristic. This prevent exceptions to be treated as document failures
that should have failed the engine but backed out of failing since since some other thread has
already taken over the failure procedure but didn't finish yet.

time:
2017-01-20T15:49:31Z
class:
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/main/java/org/elasticsearch/index/IndexSettings.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregationBuilders.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/adjacency/AdjacencyMatrix.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/adjacency/AdjacencyMatrixAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/adjacency/AdjacencyMatrixAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/adjacency/AdjacencyMatrixAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/adjacency/InternalAdjacencyMatrix.java
core/src/test/java/org/elasticsearch/index/IndexSettingsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/AdjacencyMatrixIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/AdjacencyMatrixTests.java
comments:
New AdjacencyMatrix aggregation

Similar to the Filters aggregation but only supports "keyed" filter buckets and automatically "ANDs" pairs of filters to produce a form of adjacency matrix.
The intersection of buckets "A" and "B" is named "A&B" (the choice of separator is configurable). Empty intersection buckets are removed from the final results.

Closes #22169

time:
2017-01-20T15:27:45Z
class:
comments:
Remove accept SocketPermissions from core (#22622)

This is related to #22116. Core no longer needs SocketPermission 
accept. This permission is relegated to the transport-netty4 module 
and (for tests) to the mocksocket jar.

time:
2017-01-20T13:18:30Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregatorTests.java
comments:
Add unit tests for DateHistogramAggregator (#22714)

Adds unit tests for the date histogram aggregator.

Relates #22278

time:
2017-01-20T12:23:04Z
class:
comments:
Add example configuration for rotating GC log (#22715)

By default, the JVM GC log file grows without
limitation. This is inconvenient for a long running
process like Elasticsearch.

With this commit we add an example configuration
for a rotating GC log in `conig/jvm.options`.

time:
2017-01-20T11:49:54Z
class:
core/src/main/java/org/elasticsearch/action/search/ShardSearchFailure.java
core/src/test/java/org/elasticsearch/action/search/ShardSearchFailureTests.java
comments:
Add parsing from xContent to ShardSearchFailure (#22699)

In preparation for being able to parse SearchResponse from its rest
representation, this adds fromXContent to ShardSearchFailure.

time:
2017-01-20T11:26:07Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/PublishClusterStateAction.java
comments:
Close InputStream when receiving cluster state in PublishClusterStateAction (#22711)

Not closing the InputStream will leak native memory as the DeflateCompressor/Inflater won't be closed.

time:
2017-01-20T09:14:13Z
class:
core/src/main/java/org/elasticsearch/action/support/ContextPreservingActionListener.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java
core/src/test/java/org/elasticsearch/action/support/ContextPreservingActionListenerTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
comments:
Index creation and setting update may not return deprecation logging (#22702)

Those services validate their setting before submitting an AckedClusterStateUpdateTask to the cluster state service. An acked cluster state may be completed by a networking thread when the last acks as received. As such it needs special care to make sure that thread context headers are handled correctly.

time:
2017-01-20T09:13:13Z
class:
core/src/test/java/org/elasticsearch/action/delete/DeleteResponseTests.java
comments:
Fix comment

time:
2017-01-20T08:16:34Z
class:
core/src/main/java/org/elasticsearch/action/delete/DeleteResponse.java
core/src/test/java/org/elasticsearch/action/delete/DeleteResponseTests.java
comments:
Merge branch 'pr/delete-from-xcontent'

time:
2017-01-19T22:37:06Z
class:
core/src/main/java/org/elasticsearch/monitor/fs/FsInfo.java
comments:
Add missing serialization BWC for disk usage estimates

Relates to #22081

time:
2017-01-19T22:31:12Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/EnhancedPainlessLexer.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/PainlessLexer.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/SlashStrategy.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/package-info.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/package-info.java
comments:
Mechanical changes to make PainlessLexer a bit more obvious (#22695)

Makes `PainlessLexer` abstract and adds the hacks that it needs as abstract methods implemented in `EnhancedPainlessLexer`. This feels a little cleaner than referencing the hacks statically.

time:
2017-01-19T20:56:52Z
class:
core/src/main/java/org/elasticsearch/monitor/MonitorService.java
core/src/main/java/org/elasticsearch/monitor/fs/FsInfo.java
core/src/main/java/org/elasticsearch/monitor/fs/FsProbe.java
core/src/main/java/org/elasticsearch/monitor/fs/FsService.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/test/java/org/elasticsearch/cluster/ClusterInfoServiceIT.java
core/src/test/java/org/elasticsearch/monitor/fs/FsProbeTests.java
comments:
Expose disk usage estimates in nodes stats

This exposes the least and most used disk usage estimates within the "fs" nodes
stats output:

```json
GET /_nodes/stats/fs?pretty&human
{
  "nodes" : {
    "34fPVU0uQ_-wWitDzDXX_g" : {
      "fs" : {
        "timestamp" : 1481238723550,
        "total" : {
          "total" : "396.1gb",
          "total_in_bytes" : 425343254528,
          "free" : "140.6gb",
          "free_in_bytes" : 151068725248,
          "available" : "120.5gb",
          "available_in_bytes" : 129438912512
        },
        "least_usage_estimate" : {
          "path" : "/home/hinmanm/es/elasticsearch/distribution/build/cluster/run node0/elasticsearch-6.0.0-alpha1-SNAPSHOT/data/nodes/0",
          "total" : "396.1gb",
          "total_in_bytes" : 425343254528,
          "available" : "120.5gb",
          "available_in_bytes" : 129438633984,
          "used_disk_percent" : 69.56842912023208
        },
        "most_usage_estimate" : {
          "path" : "/home/hinmanm/es/elasticsearch/distribution/build/cluster/run node0/elasticsearch-6.0.0-alpha1-SNAPSHOT/data/nodes/0",
          "total" : "396.1gb",
          "total_in_bytes" : 425343254528,
          "available" : "120.5gb",
          "available_in_bytes" : 129438633984,
          "used_disk_percent" : 69.56842912023208
        },
        "data" : [{...}],
        "io_stats" : {...}
      }
    }
  }
}
```

Resolves #8686
Resolves #22081

time:
2017-01-19T20:36:32Z
class:
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/AwsS3ServiceImplTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/EnvironmentCredentialsTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/SyspropCredentialsTests.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
S3 repository: Deprecate specifying credentials through env vars, sys props, and remove profile files (#22567)

* S3 repository: Deprecate specifying credentials through env vars and sys props

This is a follow up to #22479, where storing credentials secure way was
added.

time:
2017-01-19T18:13:11Z
class:
comments:
Fix Eclipse project generation

The new plugin causes Eclipse to go a bit crazy. So we skip it
for Eclipse.

Relates to #22646

time:
2017-01-19T17:30:33Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/main/java/org/elasticsearch/index/IndexSettings.java
core/src/main/java/org/elasticsearch/index/MergePolicyConfig.java
core/src/main/java/org/elasticsearch/index/analysis/ASCIIFoldingTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/Analysis.java
core/src/main/java/org/elasticsearch/index/analysis/CJKBigramFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/CommonGramsTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/HunspellTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/KeywordMarkerTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/LimitTokenCountFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/PathHierarchyTokenizerFactory.java
core/src/main/java/org/elasticsearch/index/analysis/PatternAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/PatternCaptureGroupTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/PatternReplaceTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/ShingleTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/StopTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/SynonymTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/UniqueTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/WordDelimiterTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/compound/AbstractCompoundWordTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/similarity/BM25SimilarityProvider.java
core/src/main/java/org/elasticsearch/index/similarity/ClassicSimilarityProvider.java
core/src/main/java/org/elasticsearch/index/similarity/DFISimilarityProvider.java
core/src/test/java/org/elasticsearch/common/settings/SettingsTests.java
plugins/analysis-icu/src/main/java/org/elasticsearch/index/analysis/IcuCollationTokenFilterFactory.java
plugins/analysis-kuromoji/src/main/java/org/elasticsearch/index/analysis/JapaneseStopTokenFilterFactory.java
plugins/analysis-kuromoji/src/main/java/org/elasticsearch/index/analysis/KuromojiIterationMarkCharFilterFactory.java
plugins/analysis-kuromoji/src/main/java/org/elasticsearch/index/analysis/KuromojiReadingFormFilterFactory.java
plugins/analysis-kuromoji/src/main/java/org/elasticsearch/index/analysis/KuromojiTokenizerFactory.java
plugins/analysis-phonetic/src/main/java/org/elasticsearch/index/analysis/PhoneticTokenFilterFactory.java
comments:
Fix deprecation logging for lenient booleans

This commit fixes an issue with deprecation logging for lenient
booleans. The underlying issue is that adding deprecation logging for
lenient booleans added a static deprecation logger to the Settings
class. However, the Settings class is initialized very early and in CLI
tools can be initialized before logging is initialized. This leads to
status logger error messages. Additionally, the deprecation logging for
a lot of the settings does not provide useful context (for example, in
the token filter factories, the deprecation logging only produces the
name of the setting, but gives no context which token filter factory it
comes from). This commit addresses both of these issues by changing the
call sites to push a deprecation logger through to the lenient boolean
parsing.

Relates #22696

time:
2017-01-19T16:44:13Z
class:
comments:
Remove @header we no longer need

time:
2017-01-19T16:41:50Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/PainlessLexer.java
comments:
Make lexer abstract

time:
2017-01-19T16:33:40Z
class:
comments:
[Docs] Remove outdated info about enabling/disabling doc_values (#22694)

time:
2017-01-19T16:28:31Z
class:
core/src/test/java/org/elasticsearch/action/delete/DeleteResponseTests.java
comments:
Also test found field

And optimize imports

time:
2017-01-19T16:23:16Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/EnhancedPainlessLexer.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/PainlessLexer.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/SlashStrategy.java
comments:
Move lexer hacks to EnhancedPainlessLexer

This "feels" nicer. Less classes at least.

time:
2017-01-19T16:08:38Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/bucket/GlobalAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MaxAggregatorTests.java
comments:
Fix incorrect args order passed to createAggregator

This commit fixes a compile issue where the arguments are passed to
createAggregator in the incorrect order.

time:
2017-01-19T16:04:08Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/package-info.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/package-info.java
comments:
Improve painless's javadocs

Hopefully useful references.

time:
2017-01-19T15:43:53Z
class:
comments:
Add TestWithDependenciesPlugin to build (#22646)

This commit adds a MessyRestTestPlugin to the gradle build. It extends 
StandaloneRestTestPlugin. The main piece of functionality that it adds 
is to copy plugin-metadata from dependencies into the 
generated-resources for the current test source. This is necessary to 
ensure that permissions for dependencies are applied when running the 
tests.

A current limitation is that the permissions are applied differently 
than in the distribution sources. When permissions are granted to all 
depedencies for a module or plugin, the permissions are granted to all 
dependencies on the classpath for tests besides a few hardcoded 
exclusions:
- es core
- es test framework
- lucene test framework
- randomized runner
- junit library

time:
2017-01-19T15:29:10Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/XContentHelper.java
core/src/main/java/org/elasticsearch/search/profile/AbstractInternalProfileTree.java
core/src/main/java/org/elasticsearch/search/profile/ProfileResult.java
core/src/main/java/org/elasticsearch/search/profile/SearchProfileShardResults.java
core/src/main/java/org/elasticsearch/search/profile/aggregation/AggregationProfileShardResult.java
core/src/main/java/org/elasticsearch/search/profile/query/CollectorResult.java
core/src/main/java/org/elasticsearch/search/profile/query/QueryProfileShardResult.java
core/src/test/java/org/elasticsearch/search/profile/ProfileResultTests.java
core/src/test/java/org/elasticsearch/search/profile/SearchProfileShardResultsTests.java
core/src/test/java/org/elasticsearch/search/profile/aggregation/AggregationProfileShardResultTests.java
core/src/test/java/org/elasticsearch/search/profile/query/CollectorResultTests.java
core/src/test/java/org/elasticsearch/search/profile/query/QueryProfileShardResultTests.java
comments:
Add parsing from xContent to SearchProfileShardResults and nested classes (#22649)

In preparation for being able to parse SearchResponse from its rest representation
for the java rest client, this adds fromXContent to SearchProfileShardResults and its
nested classes.

time:
2017-01-19T15:22:48Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/FiltersAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/min/MinAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorTests.java
comments:
Add unit tests for FiltersAggregator (#22678)

Adds unit tests for the `filters` aggregation.
This change also adds an helper to search and reduce any aggregator in a unit test.
This is done by dividing a single searcher in sub-searcher, one for each segment.

Relates #22278

time:
2017-01-19T15:10:13Z
class:
core/src/main/java/org/elasticsearch/action/delete/DeleteResponse.java
core/src/test/java/org/elasticsearch/action/delete/DeleteResponseTests.java
comments:
Use now common methods with index/update

Brought by #22229

time:
2017-01-19T15:08:24Z
class:
core/src/main/java/org/elasticsearch/search/SearchModule.java
comments:
Don't register search response listener in transport clients

Small fix for https://github.com/elastic/elasticsearch/pull/22682

time:
2017-01-19T14:59:24Z
class:
core/src/main/java/org/elasticsearch/action/delete/DeleteResponse.java
core/src/test/java/org/elasticsearch/action/delete/DeleteResponseTests.java
comments:
Add fromxcontent methods to delete response

This commit adds the parsing fromXContent() methods to the IndexResponse class.

It's a pale copy of what has been done in #22229.

time:
2017-01-19T14:44:00Z
class:
core/src/test/java/org/elasticsearch/fieldstats/FieldStatsIntegrationIT.java
comments:
unmute FieldStatsIntegrationIT.testGeoPointNotIndexed, fix already pushed

time:
2017-01-19T14:38:17Z
class:
core/src/test/java/org/elasticsearch/fieldstats/FieldStatsIntegrationIT.java
comments:
Mute FieldStatsIntegrationIT.testGeoPointNotIndexed, for now

time:
2017-01-19T14:31:45Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/Augmentation.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/StringTests.java
comments:
Painless: Add augmentation to string for base 64 (#22665)

We don't want to expose `String#getBytes` which is required for
`Base64.getEncoder.encode` to work because we're worried about
character sets. This adds `encodeBase64` and `decodeBase64`
methods to `String` in Painless that are duals of one another
such that:
`someString == someString.encodeBase64().decodeBase64()`.

Both methods work with the UTF-8 encoding of the string.

Closes #22648

time:
2017-01-19T13:20:07Z
class:
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStats.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsShardResponse.java
core/src/main/java/org/elasticsearch/action/fieldstats/TransportFieldStatsAction.java
core/src/test/java/org/elasticsearch/action/fieldstats/FieldStatsRequestTests.java
core/src/test/java/org/elasticsearch/fieldstats/FieldStatsTests.java
comments:
Fix NPE on FieldStats with mixed cluster on version pre/post 5.2 (#22688)

* Fix NPE on FieldStats with mixed cluster on version pre/post 5.2

In 5.2 the FieldStats API can return null min/max values.
These values cannot be deserialized by a node with version pre 5.2 so if this node
is pick to coordinate a FieldStats request in a mixed cluster an NPE can be thrown.
This change prevents the NPE by removing the non serializable FieldStats object directly in the field stats shard request.
The filtered fields will not be present in the response when a node pre 5.2 acts as a coordinating node.

time:
2017-01-19T11:49:45Z
class:
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
core/src/main/java/org/elasticsearch/action/index/IndexResponse.java
core/src/main/java/org/elasticsearch/action/update/UpdateResponse.java
core/src/main/java/org/elasticsearch/index/get/GetResult.java
core/src/test/java/org/elasticsearch/action/index/IndexResponseTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateResponseTests.java
core/src/test/java/org/elasticsearch/index/get/GetResultTests.java
comments:
Add parsing methods for UpdateResponse (#22586)

This commit adds the fromXContent() method to the UpdateResponse class, so that it can be used with the high level rest client.

time:
2017-01-19T11:48:45Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/SearchPlugin.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/test/java/org/elasticsearch/search/ResponseListenerPluginIT.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
comments:
Add the ability to define search response listeners in plugins (#22682)

This change is a simple adaptation of https://github.com/elastic/elasticsearch/pull/19587 for the current state of master.
It allows to define search response listener in the form of `BiConsumer<SearchRequest, SearchResponse>`s in a search plugin.

time:
2017-01-19T08:56:54Z
class:
comments:
Make build Gradle 2.14 / 3.x compatible (#22669)

This changes build files so that building Elasticsearch works with both Gradle 2.13 as well as higher versions of Gradle (tested 2.14 and 3.3), enabling a smooth transition from Gradle 2.13 to 3.x.

time:
2017-01-19T07:33:08Z
class:
core/src/test/java/org/elasticsearch/fieldstats/FieldStatsIntegrationIT.java
comments:
Use a proper boolean in FieldStatsIntegrationIT#testGeoPointNotIndexed()

time:
2017-01-19T06:59:18Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/create/CreateSnapshotRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/RestoreSnapshotRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportShardFlushAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportShardRefreshAction.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequest.java
core/src/main/java/org/elasticsearch/action/get/TransportGetAction.java
core/src/main/java/org/elasticsearch/action/support/AutoCreateIndex.java
core/src/main/java/org/elasticsearch/action/support/IndicesOptions.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/cluster/InternalClusterInfoService.java
core/src/main/java/org/elasticsearch/cluster/metadata/AutoExpandReplicas.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MappingMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/routing/IndexRoutingTable.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java
core/src/main/java/org/elasticsearch/common/Booleans.java
core/src/main/java/org/elasticsearch/common/TriFunction.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/main/java/org/elasticsearch/common/xcontent/XContent.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/support/AbstractXContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/support/XContentMapValues.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/main/java/org/elasticsearch/index/IndexModule.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/IndexSettings.java
core/src/main/java/org/elasticsearch/index/MergePolicyConfig.java
core/src/main/java/org/elasticsearch/index/analysis/ASCIIFoldingTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/Analysis.java
core/src/main/java/org/elasticsearch/index/analysis/ArabicAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/ArmenianAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/BasqueAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/BrazilianAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/BulgarianAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/CJKBigramFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/CatalanAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/CjkAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/CommonGramsTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/CzechAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/DanishAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/DutchAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/ElisionTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/EnglishAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/FingerprintAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/FinnishAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/FrenchAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/GalicianAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/GermanAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/GreekAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/HindiAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/HungarianAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/HunspellTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/IndonesianAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/IrishAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/ItalianAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/KeepWordFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/KeywordMarkerTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/LatvianAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/LimitTokenCountFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/LithuanianAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/NorwegianAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/PathHierarchyTokenizerFactory.java
core/src/main/java/org/elasticsearch/index/analysis/PatternAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/PatternCaptureGroupTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/PatternReplaceTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/PersianAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/PortugueseAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/RomanianAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/RussianAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/ShingleTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/SnowballAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/SoraniAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/SpanishAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/StandardAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/StandardHtmlStripAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/StopAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/StopTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/SwedishAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/SynonymTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/ThaiAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/TurkishAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/UniqueTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/WordDelimiterTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/compound/AbstractCompoundWordTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/mapper/AllFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/BaseGeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/BooleanFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/FieldNamesFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/GeoShapeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IpFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/KeywordFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/NumberFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ObjectMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ParentFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/RangeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/RootObjectMapper.java
core/src/main/java/org/elasticsearch/index/mapper/RoutingFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TextFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TypeParsers.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/similarity/BM25SimilarityProvider.java
core/src/main/java/org/elasticsearch/index/similarity/ClassicSimilarityProvider.java
core/src/main/java/org/elasticsearch/index/similarity/DFISimilarityProvider.java
core/src/main/java/org/elasticsearch/index/similarity/DFRSimilarityProvider.java
core/src/main/java/org/elasticsearch/index/similarity/IBSimilarityProvider.java
core/src/main/java/org/elasticsearch/index/similarity/LMDirichletSimilarityProvider.java
core/src/main/java/org/elasticsearch/index/similarity/LMJelinekMercerSimilarityProvider.java
core/src/main/java/org/elasticsearch/index/similarity/SimilarityService.java
core/src/main/java/org/elasticsearch/index/store/FsDirectoryService.java
core/src/main/java/org/elasticsearch/rest/RestRequest.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestShardsAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/FetchSourceContext.java
core/src/test/java/org/elasticsearch/action/get/MultiGetRequestTests.java
core/src/test/java/org/elasticsearch/action/support/IndicesOptionsTests.java
core/src/test/java/org/elasticsearch/bwcompat/RestoreBackwardsCompatIT.java
core/src/test/java/org/elasticsearch/cluster/SimpleClusterStateIT.java
core/src/test/java/org/elasticsearch/common/BooleansTests.java
core/src/test/java/org/elasticsearch/common/settings/SettingTests.java
core/src/test/java/org/elasticsearch/common/settings/SettingsModuleTests.java
core/src/test/java/org/elasticsearch/common/settings/SettingsTests.java
core/src/test/java/org/elasticsearch/common/xcontent/XContentParserTests.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/IndexServiceTests.java
core/src/test/java/org/elasticsearch/index/IndexingSlowLogTests.java
core/src/test/java/org/elasticsearch/index/mapper/BooleanFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/FieldTypeTestCase.java
core/src/test/java/org/elasticsearch/index/mapper/UpdateMappingTests.java
core/src/test/java/org/elasticsearch/index/query/HasChildQueryBuilderTests.java
core/src/test/java/org/elasticsearch/indices/analysis/AnalysisModuleTests.java
core/src/test/java/org/elasticsearch/indices/template/SimpleIndexTemplateIT.java
core/src/test/java/org/elasticsearch/rest/BaseRestHandlerTests.java
core/src/test/java/org/elasticsearch/rest/action/cat/RestTableTests.java
core/src/test/java/org/elasticsearch/script/ScriptContextTests.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
plugins/analysis-icu/src/main/java/org/elasticsearch/index/analysis/IcuCollationTokenFilterFactory.java
plugins/analysis-kuromoji/src/main/java/org/elasticsearch/index/analysis/JapaneseStopTokenFilterFactory.java
plugins/analysis-kuromoji/src/main/java/org/elasticsearch/index/analysis/KuromojiAnalyzerProvider.java
plugins/analysis-kuromoji/src/main/java/org/elasticsearch/index/analysis/KuromojiIterationMarkCharFilterFactory.java
plugins/analysis-kuromoji/src/main/java/org/elasticsearch/index/analysis/KuromojiReadingFormFilterFactory.java
plugins/analysis-kuromoji/src/main/java/org/elasticsearch/index/analysis/KuromojiTokenizerFactory.java
plugins/analysis-phonetic/src/main/java/org/elasticsearch/index/analysis/PhoneticTokenFilterFactory.java
plugins/analysis-ukrainian/src/main/java/org/elasticsearch/index/analysis/UkrainianAnalyzerProvider.java
plugins/mapper-size/src/main/java/org/elasticsearch/index/mapper/size/SizeFieldMapper.java
comments:
Make boolean conversion strict (#22200)

This PR removes all leniency in the conversion of Strings to booleans: "true"
is converted to the boolean value `true`, "false" is converted to the boolean
value `false`. Everything else raises an error.

time:
2017-01-18T21:58:39Z
class:
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractAsyncBulkIndexByScrollAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportUpdateByQueryAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollActionMetadataTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollActionScriptTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollActionTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AsyncBulkByScrollActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexMetadataTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexScriptTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryMetadataTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryWithScriptTests.java
comments:
Consolidate some reindex utility classes (#22666)

Everything that extended `AbstractAsyncBulkByScrollAction` also
extended `AbstractAsyncBulkIndexByScrollAction` so this removes
`AbstractAsyncBulkIndexByScrollAction`, merging it into
`AbstractAsyncBulkByScrollAction`.

time:
2017-01-18T20:51:56Z
class:
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStats.java
comments:
remove unnecessary text from exception message

time:
2017-01-18T20:37:03Z
class:
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStats.java
core/src/main/java/org/elasticsearch/index/mapper/BaseGeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LatLonPointFieldMapper.java
core/src/test/java/org/elasticsearch/fieldstats/FieldStatsIntegrationIT.java
comments:
Add geo_point to FieldStats

This commit adds a new GeoPoint class to FieldStats for computing field stats over geo_point field types.

time:
2017-01-18T20:18:32Z
class:
core/src/main/java/org/elasticsearch/action/support/AutoCreateIndex.java
core/src/main/java/org/elasticsearch/index/IndexNotFoundException.java
core/src/test/java/org/elasticsearch/action/support/AutoCreateIndexTests.java
core/src/test/java/org/elasticsearch/cluster/NoMasterNodeIT.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingDisabledTests.java
comments:
Better error when can't auto create index (#22488)

Changes the error message when `action.auto_create_index` or
`index.mapper.dynamic` forbids automatic creation of an index
from `no such index` to one of:
* `no such index and [action.auto_create_index] is [false]`
* `no such index and [index.mapper.dynamic] is [false]`
* `no such index and [action.auto_create_index] contains [-<pattern>] which forbids automatic creation of the index`
* `no such index and [action.auto_create_index] ([all patterns]) doesn't match`

This should make it more clear *why* there is `no such index`.

Closes #22435

time:
2017-01-18T18:51:25Z
class:
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
comments:
[TEST] testAckedIndexing waits for all nodes to stabilize

testAckedIndexing now waits for all nodes to stabilize in the cluster
state through an assertBusy before final validation that all documents
are found in tehir respective shards in the cluster.  Before, what could
happen is that the ensureGreen check passes but only after that is a
ping failure from the network disruption processed by the master,
thereby rendering the cluster RED again.  This assertBusy waits up to 30
seconds for all nodes to have stabilized and all get document actions to
succeed.

time:
2017-01-18T16:12:18Z
class:
plugins/discovery-azure-classic/src/main/java/org/elasticsearch/cloud/azure/classic/management/AzureComputeServiceImpl.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/network/Ec2NameResolver.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/util/SocketAccess.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/plugin/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/discovery-gce/src/main/java/org/elasticsearch/cloud/gce/GceInstancesServiceImpl.java
plugins/discovery-gce/src/main/java/org/elasticsearch/cloud/gce/GceMetadataService.java
plugins/discovery-gce/src/main/java/org/elasticsearch/cloud/gce/network/GceNameResolver.java
plugins/discovery-gce/src/main/java/org/elasticsearch/cloud/gce/util/Access.java
plugins/discovery-gce/src/main/java/org/elasticsearch/discovery/gce/RetryHttpInitializerWrapper.java
plugins/discovery-gce/src/main/java/org/elasticsearch/plugin/discovery/gce/GceDiscoveryPlugin.java
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/blobstore/util/SocketAccess.java
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/storage/AzureStorageServiceImpl.java
plugins/repository-gcs/src/main/java/org/elasticsearch/common/blobstore/gcs/GoogleCloudStorageBlobStore.java
plugins/repository-gcs/src/main/java/org/elasticsearch/common/blobstore/gcs/util/SocketAccess.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/blobstore/S3BlobContainer.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/blobstore/S3BlobStore.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/util/SocketAccess.java
comments:
Add doPrivilege blocks for socket connect operations in plugins (#22534)

This is related to #22116. Certain plugins (discovery-azure-classic, 
discovery-ec2, discovery-gce, repository-azure, repository-gcs, and 
repository-s3) open socket connections. As SocketPermissions are 
transitioned out of core, these plugins will require connect 
permission. This pull request wraps operations that require these 
permissions in doPrivileged blocks.

time:
2017-01-18T16:05:34Z
class:
core/src/main/java/org/elasticsearch/index/analysis/AnalysisRegistry.java
core/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java
comments:
Finish exposing FlattenGraphTokenFilter (#22667)

time:
2017-01-18T15:33:45Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/global/GlobalAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/max/InternalMax.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/GlobalAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalMaxTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MaxAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/min/InternalMinTests.java
comments:
Improve unit test coverage of aggs (#22668)

Add tests for `GlobalAggregator`, `MaxAggregator`, and `InternalMax`.

Relates to #22278

time:
2017-01-18T15:17:54Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateObserver.java
core/src/main/java/org/elasticsearch/common/util/concurrent/ThreadContext.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/common/util/concurrent/ThreadContextTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AsyncBulkByScrollActionTests.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
comments:
Streamline foreign stored context restore and allow to perserve response headers (#22677)

Today we do not preserve response headers if they are present on a transport protocol
response. While preserving these headers is not always desired, in the most cases we
should pass on these headers to have consistent results for depreciation headers etc.
yet, this hasn't been much of a problem since most of the deprecations are detected early
ie. on the coordinating node such that this bug wasn't uncovered until #22647

This commit allow to optionally preserve headers when a context is restored and also streamlines
the context restore since it leaked frequently into the callers thread context when the callers
context wasn't restored again.

time:
2017-01-18T13:53:29Z
class:
core/src/test/java/org/elasticsearch/snapshots/mockstore/MockRepository.java
comments:
[TEST] add logging to MockRepository to help debug index-N blob reading

time:
2017-01-18T11:28:09Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/env/NodeEnvironment.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/test/java/org/elasticsearch/gateway/PrimaryShardAllocatorTests.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
comments:
Add a deprecation notice to shadow replicas  (#22647)

Relates to #22024

On top of documentation, the PR adds deprecation loggers and deals with the resulting warning headers.

The yaml test is set exclude versions up to 6.0. This is need to make sure bwc tests pass until this is backported to 5.2.0 . Once that's done, I will change the yaml test version limits

time:
2017-01-18T10:09:09Z
class:
core/src/main/java/org/elasticsearch/search/dfs/AggregatedDfs.java
comments:
Remove unnecessary class cast

time:
2017-01-18T09:41:22Z
class:
comments:
[DOCS] Fix inconsistent formatting for fieldnames in profile.asciidoc

time:
2017-01-18T09:13:48Z
class:
comments:
Docs: Fix link syntax in cross-cluster docs

Also tidy up settings list

time:
2017-01-18T09:02:51Z
class:
comments:
Docs: Cross-cluster search doc wasn't being included

time:
2017-01-18T08:28:04Z
class:
core/src/main/java/org/elasticsearch/action/ActionListener.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsGroup.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponse.java
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/search/internal/AliasFilter.java
core/src/main/java/org/elasticsearch/transport/ConnectionProfile.java
core/src/main/java/org/elasticsearch/transport/TransportActionProxy.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/action/ActionListenerTests.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterConnectionTests.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterServiceTests.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
core/src/test/java/org/elasticsearch/common/settings/SettingTests.java
core/src/test/java/org/elasticsearch/search/simple/SimpleSearchIT.java
core/src/test/java/org/elasticsearch/transport/TransportActionProxyTests.java
qa/multi-cluster-search/src/test/java/org/elasticsearch/upgrades/MultiClusterSearchYamlTestSuiteIT.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
comments:
Add federated cross cluster search capabilities (#22502)

Today Elasticsearch can act as a tribe node that fully joins another cluster to support operations across all different clusters. While tribe is a popular feature it also has it's downsides like:
 * non-trivial testing
 * special configuration
 * receives a non trivial amount of cluster-state updates
 * maintains connections to all nodes in all clusters and vice versa
 * has to be restarted to join another cluster
 * needs special strategies to disambiguate indices with identical names

That said, from a functionality standpoint the only feature in elasticsearch that needs cross cluster communication is in-fact the search layer. Everything else can be done on the client side by communicating with each cluster individually. For `_search` the merge of aggregations etc. is non trivial and can't be done on the client side. 

The feature added in this PR is called `cross cluster search` and allows any node to act as a federated search node without joining any of the other clusters. There are 2 basic modes of operations: 

 * globally configured remote clusters via cluster state settings
 * locally configured remote clusters via elasticsearch.yaml

A node with such a configuration will `connect` to the remote cluster and discover a set of nodes that it can communicate with for federated search (Default # of nodes is 3). It won't connect to all nodes but only eligible nodes in the remote cluster (depending on their version and optionally on a node attribute (`node.addr`).

Remote clusters can be configured and updated at any time via cluster settings without the need of a node-restart.  Each remote cluster specified via a `name` -> `seed node IP list` ie:

 * `search.remote.my_cluster.seeds: 127.0.0.1:9300, 127.0.0.1:9301`

indices of this cluster can then be addressed via the clusters alias: `GET index_1,my_cluster:index_1, my_cluster:other*/_search` 


Closes #21473

time:
2017-01-18T08:24:35Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/action/TaskOperationFailure.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/cancel/TransportCancelTasksAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/TransportGetTaskAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/shards/IndicesShardStoresResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/shrink/TransportShrinkAction.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/main/java/org/elasticsearch/action/get/MultiGetResponse.java
core/src/main/java/org/elasticsearch/action/ingest/SimulateDocumentBaseResult.java
core/src/main/java/org/elasticsearch/action/ingest/SimulateProcessorResult.java
core/src/main/java/org/elasticsearch/action/search/MultiSearchResponse.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseExecutionException.java
core/src/main/java/org/elasticsearch/action/search/SearchTask.java
core/src/main/java/org/elasticsearch/action/search/ShardSearchFailure.java
core/src/main/java/org/elasticsearch/action/support/DefaultShardOperationFailedException.java
core/src/main/java/org/elasticsearch/action/support/broadcast/TransportBroadcastAction.java
core/src/main/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeAction.java
core/src/main/java/org/elasticsearch/action/support/master/TransportMasterNodeAction.java
core/src/main/java/org/elasticsearch/action/support/nodes/TransportNodesAction.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationResponse.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportBroadcastReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/tasks/TransportTasksAction.java
core/src/main/java/org/elasticsearch/action/termvectors/MultiTermVectorsResponse.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodeFilters.java
core/src/main/java/org/elasticsearch/cluster/routing/OperationRouting.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/NodeAllocationResult.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AwarenessAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/FilterAllocationDecider.java
core/src/main/java/org/elasticsearch/common/ParsingException.java
core/src/main/java/org/elasticsearch/common/breaker/CircuitBreakingException.java
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/index/query/QueryShardException.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/rest/BytesRestResponse.java
core/src/main/java/org/elasticsearch/script/ScriptException.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/main/java/org/elasticsearch/search/SearchParseException.java
core/src/main/java/org/elasticsearch/tasks/CancellableTask.java
core/src/main/java/org/elasticsearch/tasks/TaskManager.java
core/src/main/java/org/elasticsearch/tasks/TaskResult.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/ESExceptionTests.java
core/src/test/java/org/elasticsearch/ElasticsearchExceptionTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/CancellableTasksTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TestTaskPlugin.java
core/src/test/java/org/elasticsearch/action/admin/indices/create/CreateIndexIT.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/cluster/allocation/FilteringAllocationIT.java
core/src/test/java/org/elasticsearch/cluster/node/DiscoveryNodeFiltersTests.java
core/src/test/java/org/elasticsearch/cluster/routing/OperationRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AwarenessAllocationTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/FilterAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
core/src/test/java/org/elasticsearch/indices/template/SimpleIndexTemplateIT.java
core/src/test/java/org/elasticsearch/routing/PartitionedRoutingIT.java
core/src/test/java/org/elasticsearch/snapshots/mockstore/MockRepository.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MultiSearchTemplateResponse.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/BulkByScrollTask.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexParallelizationHelper.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AsyncBulkByScrollActionTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerTransportTests.java
test/framework/src/main/java/org/elasticsearch/node/NodeTests.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/restspec/ClientYamlSuiteRestSpec.java
comments:
Merge branch 'master' into feature/multi_cluster_search

time:
2017-01-18T07:51:23Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/shrink/TransportShrinkAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/main/java/org/elasticsearch/cluster/routing/OperationRouting.java
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/test/java/org/elasticsearch/action/admin/indices/create/CreateIndexIT.java
core/src/test/java/org/elasticsearch/cluster/routing/OperationRoutingTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
core/src/test/java/org/elasticsearch/indices/template/SimpleIndexTemplateIT.java
core/src/test/java/org/elasticsearch/routing/PartitionedRoutingIT.java
comments:
Allow an index to be partitioned with custom routing (#22274)

This change makes it possible for custom routing values to go to a subset of shards rather than
just a single shard. This enables the ability to utilize the spatial locality that custom routing can
provide while mitigating the likelihood of ending up with an imbalanced cluster or suffering
from a hot shard.

This is ideal for large multi-tenant indices with custom routing that suffer from one or both of
the following:
- The big tenants cannot fit into a single shard or there is so many of them that they will likely
end up on the same shard
- Tenants often have a surge in write traffic and a single shard cannot process it fast enough

Beyond that, this should also be useful for use cases where most queries are done under the context
of a specific field (e.g. a category) since it gives a hint at how the data can be stored to minimize
the number of shards to check per query. While a similar solution can be achieved with multiple
concrete indices or aliases per value today, those approaches breakdown for high cardinality fields.

A partitioned index enforces that mappings have routing required, that the partition size does not
change when shrinking an index (the partitions will shrink proportionally), and rejects mappings
that have parent/child relationships.

Closes #21585

time:
2017-01-18T02:00:36Z
class:
comments:
Improve wording in recipes docs

This commit improves some of the wording the recipes docs.

Relates #22661

time:
2017-01-18T01:57:22Z
class:
comments:
Correct grammar in list in how-to docs

This commit corrects the grammar in a list in the how-to docs; namely,
the word "and" was missing preceding the final element in a list.

Relates #22663

time:
2017-01-17T23:07:31Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/cancel/TransportCancelTasksAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/TransportGetTaskAction.java
core/src/main/java/org/elasticsearch/action/search/SearchTask.java
core/src/main/java/org/elasticsearch/action/support/broadcast/TransportBroadcastAction.java
core/src/main/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeAction.java
core/src/main/java/org/elasticsearch/action/support/master/TransportMasterNodeAction.java
core/src/main/java/org/elasticsearch/action/support/nodes/TransportNodesAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportBroadcastReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/tasks/TransportTasksAction.java
core/src/main/java/org/elasticsearch/tasks/CancellableTask.java
core/src/main/java/org/elasticsearch/tasks/TaskManager.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/CancellableTasksTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TestTaskPlugin.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/BulkByScrollTask.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexParallelizationHelper.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AsyncBulkByScrollActionTests.java
comments:
Remove taskManager.registerChildTask

Instead of forcing each task to register all nodes where its children are running, this commit runs cancellation on all nodes. The task cancellation operation doesn't run too frequently, so this optimization doesn't seem to be worth additional complexity of the interface.

time:
2017-01-17T22:29:14Z
class:
comments:
[TEST] fix documentation checking tests to account for possible
pending tasks in the cluster state

time:
2017-01-17T21:38:32Z
class:
comments:
Build: Only add ASL license to pom for elasticsearch project (#22664)

The extra plugins that may be attached to the elasticsearch build
contain their own license. In the past, the ASL license elasticsearch
uses was avoided by specially checking for the gradle project prefix of
`:x-plugins`. However, since refactoring to the elasticsearch-extra dir
structure, this mechanism was broken. This change fixes the pom license
adding to only be applied to projects that fall under the root project
(ie elasticsearch).

time:
2017-01-17T20:36:31Z
class:
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
comments:
[TEST] testAckedIndexing waits for the cluster state to have propogated
to all nodes in the cluster before checking the existance of documents
on each node

time:
2017-01-17T19:53:54Z
class:
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
comments:
Fix compilation in eclipse

Eclipse needs a bit of extra special help with type parameters
in `TransportReplicationActionTests` now.

time:
2017-01-17T17:33:01Z
class:
comments:
Capitalize "Elasticsearch" in indexing speed docs

This commit fixes the capitalization of "Elasticsearch" in the indexing
speed docs.

Relates #22659

time:
2017-01-17T17:17:29Z
class:
core/src/test/java/org/elasticsearch/snapshots/mockstore/MockRepository.java
comments:
[TEST] add retries to MockRepository getRepositoryData to try to
diagnose a NotXContentException being thrown

time:
2017-01-17T16:29:43Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterServiceTests.java
comments:
fix exception message

time:
2017-01-17T16:20:52Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterServiceTests.java
comments:
apply review comments

time:
2017-01-17T15:43:11Z
class:
comments:
Minor doc changes to clarify mapping index param for string type (#22652)

* Grammatical correction

* Add note for legacy string mapping type

* Update truncate token filter to not mention the keyword tokenizer

The advice predates the existence of the keyword field

Closes #22650

time:
2017-01-17T15:13:09Z
class:
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/restspec/ClientYamlSuiteRestSpec.java
comments:
[TEST] parse global parameters from _common.json (#22655)

Replace the hardcoded global parameters in the yaml test suite with parameters parsed from the newly added _common.json file.

Relates to #22569

time:
2017-01-17T14:51:04Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodeFilters.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AwarenessAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/FilterAllocationDecider.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/test/java/org/elasticsearch/cluster/allocation/FilteringAllocationIT.java
core/src/test/java/org/elasticsearch/cluster/node/DiscoveryNodeFiltersTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AwarenessAllocationTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/FilterAllocationDeciderTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerTransportTests.java
test/framework/src/main/java/org/elasticsearch/node/NodeTests.java
comments:
Allow comma delimited array settings to have a space after each entry (#22591)

Previously, certain settings that could take multiple comma delimited
values would pick up incorrect values for all entries but the first if
each comma separated value was followed by a whitespace character.  For
example, the multi-value "A,B,C" would be correctly parsed as
["A", "B", "C"] but the multi-value "A, B, C" would be incorrectly parsed
as ["A", " B", " C"].

This commit allows a comma separated list to have whitespace characters
after each entry.  The specific settings that were affected by this are:

  cluster.routing.allocation.awareness.attributes
  index.routing.allocation.require.*
  index.routing.allocation.include.*
  index.routing.allocation.exclude.*
  cluster.routing.allocation.require.*
  cluster.routing.allocation.include.*
  cluster.routing.allocation.exclude.*
  http.cors.allow-methods
  http.cors.allow-headers

For the allocation filtering related settings, this commit also provides
validation of each specified entry if the filtering is done by _ip,
_host_ip, or _publish_ip, to ensure that each entry is a valid IP
address.

Closes #22297

time:
2017-01-17T14:44:49Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/action/TaskOperationFailure.java
core/src/main/java/org/elasticsearch/action/admin/indices/shards/IndicesShardStoresResponse.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/main/java/org/elasticsearch/action/get/MultiGetResponse.java
core/src/main/java/org/elasticsearch/action/ingest/SimulateDocumentBaseResult.java
core/src/main/java/org/elasticsearch/action/ingest/SimulateProcessorResult.java
core/src/main/java/org/elasticsearch/action/search/MultiSearchResponse.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseExecutionException.java
core/src/main/java/org/elasticsearch/action/search/ShardSearchFailure.java
core/src/main/java/org/elasticsearch/action/support/DefaultShardOperationFailedException.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationResponse.java
core/src/main/java/org/elasticsearch/action/termvectors/MultiTermVectorsResponse.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/NodeAllocationResult.java
core/src/main/java/org/elasticsearch/common/ParsingException.java
core/src/main/java/org/elasticsearch/common/breaker/CircuitBreakingException.java
core/src/main/java/org/elasticsearch/index/query/QueryShardException.java
core/src/main/java/org/elasticsearch/rest/BytesRestResponse.java
core/src/main/java/org/elasticsearch/script/ScriptException.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/main/java/org/elasticsearch/search/SearchParseException.java
core/src/main/java/org/elasticsearch/tasks/TaskResult.java
core/src/test/java/org/elasticsearch/ESExceptionTests.java
core/src/test/java/org/elasticsearch/ElasticsearchExceptionTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MultiSearchTemplateResponse.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/BulkByScrollTask.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ScrollableHitSource.java
comments:
Simplify ElasticsearchException rendering as a XContent (#22611)

This commit tries to simplify the way ElasticsearchException are rendered to xcontent. It adds some documentation and renames and merges some methods. Current behavior is preserved, the goal is to be more readable and centralize everything in the ElasticsearchException class.

time:
2017-01-17T13:13:09Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterServiceTests.java
comments:
Add test for the grouping error message if indices and cluster can't be disambiguated

time:
2017-01-17T13:05:36Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterServiceTests.java
comments:
Improve remote / local indices filtering by not modifying external state

time:
2017-01-17T12:35:14Z
class:
comments:
Include global query string parameters in the REST spec

Closes #11638

time:
2017-01-17T11:34:36Z
class:
client/rest/src/main/java/org/elasticsearch/client/RestClient.java
client/rest/src/main/java/org/elasticsearch/client/RestClientBuilder.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostTests.java
client/test/src/main/java/org/elasticsearch/client/RestClientTestUtil.java
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/info/TransportNodesInfoAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/TransportNodesStatsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/TransportClusterStatsAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/ingest/DeletePipelineTransportAction.java
core/src/main/java/org/elasticsearch/action/ingest/GetPipelineTransportAction.java
core/src/main/java/org/elasticsearch/action/ingest/PutPipelineTransportAction.java
core/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineTransportAction.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationOperation.java
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/cli/EnvironmentAwareCommand.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/common/CheckedFunction.java
core/src/main/java/org/elasticsearch/common/logging/LogConfigurator.java
core/src/main/java/org/elasticsearch/common/network/NetworkModule.java
core/src/main/java/org/elasticsearch/common/network/NetworkService.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/common/settings/SettingsModule.java
core/src/main/java/org/elasticsearch/http/HttpServer.java
core/src/main/java/org/elasticsearch/http/HttpServerTransport.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/analysis/FlattenGraphTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/EngineClosedException.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/ShadowEngine.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/index/query/functionscore/ScoreFunctionParser.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/translog/TranslogToolCli.java
core/src/main/java/org/elasticsearch/indices/IndexingMemoryController.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/node/InternalSettingsPreparer.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/node/NodeModule.java
core/src/main/java/org/elasticsearch/node/NodeService.java
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
core/src/main/java/org/elasticsearch/plugins/ListPluginsCommand.java
core/src/main/java/org/elasticsearch/plugins/NetworkPlugin.java
core/src/main/java/org/elasticsearch/rest/BaseRestHandler.java
core/src/main/java/org/elasticsearch/rest/RestController.java
core/src/main/java/org/elasticsearch/search/internal/AliasFilter.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchRequest.java
core/src/main/java/org/elasticsearch/search/profile/ProfileResult.java
core/src/main/java/org/elasticsearch/search/profile/query/CollectorResult.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/main/java/org/elasticsearch/transport/Transports.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/common/network/NetworkModuleTests.java
core/src/test/java/org/elasticsearch/http/HttpServerTests.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java
core/src/test/java/org/elasticsearch/index/analysis/FlattenGraphTokenFilterFactoryTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/engine/ShadowEngineTests.java
core/src/test/java/org/elasticsearch/index/mapper/TextFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexingOperationListenerTests.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
core/src/test/java/org/elasticsearch/ingest/IngestProcessorNotInstalledOnAllNodesIT.java
core/src/test/java/org/elasticsearch/node/internal/InternalSettingsPreparerTests.java
core/src/test/java/org/elasticsearch/rest/RestControllerTests.java
core/src/test/java/org/elasticsearch/rest/action/admin/cluster/RestNodesStatsActionTests.java
core/src/test/java/org/elasticsearch/rest/action/admin/indices/RestIndicesStatsActionTests.java
core/src/test/java/org/elasticsearch/rest/action/cat/RestIndicesActionTests.java
core/src/test/java/org/elasticsearch/rest/action/cat/RestRecoveryActionTests.java
core/src/test/java/org/elasticsearch/search/internal/ShardSearchTransportRequestTests.java
core/src/test/java/org/elasticsearch/search/profile/ProfileResultTests.java
core/src/test/java/org/elasticsearch/search/profile/query/CollectorResultTests.java
core/src/test/java/org/elasticsearch/threadpool/ScalingThreadPoolTests.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQuery.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolatorHighlightSubFetchPhase.java
modules/percolator/src/test/java/org/elasticsearch/percolator/CandidateQueryTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/Netty4Plugin.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/channel/PrivilegedOioServerSocketChannel.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/channel/PrivilegedOioSocketChannel.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpChannelTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerPipeliningTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerTransportTests.java
plugins/analysis-stempel/src/main/java/org/elasticsearch/index/analysis/pl/PolishStemTokenFilterFactory.java
plugins/analysis-stempel/src/test/java/org/elasticsearch/index/analysis/AnalysisPolishFactoryTests.java
qa/evil-tests/src/test/java/org/elasticsearch/common/logging/EvilLoggerConfigurationTests.java
qa/evil-tests/src/test/java/org/elasticsearch/common/logging/EvilLoggerTests.java
test/framework/src/main/java/org/elasticsearch/AnalysisFactoryTestCase.java
test/framework/src/main/java/org/elasticsearch/node/MockNode.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java
comments:
Merge branch 'master' into feature/multi_cluster_search

time:
2017-01-17T11:20:03Z
class:
comments:
Docs: Fix the first highlighting example to work

Closes #22642
@clintongormley Thanks for fixing it. Here are my 2 cents. This `GET /_search` query only makes sense in the context of some particular index and data. So in my opinion we need either add the query where data is initialized on the top of this article or at least use the index we created in the other part of documentation, like here https://www.elastic.co/guide/en/elasticsearch/reference/current/docs-index_.html (in this case we need to keep `query` section as is but change `content` to `name` in the `highlight` section). That would make this article consistent. Thanks.

time:
2017-01-17T11:15:22Z
class:
comments:
Update truncate token filter to not mention the keyword tokenizer

The advice predates the existence of the keyword field

Closes #22650

time:
2017-01-17T10:47:29Z
class:
comments:
fix some docs issues

time:
2017-01-17T10:46:55Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/transport/TransportActionProxy.java
comments:
apply review comments

time:
2017-01-17T00:38:51Z
class:
core/src/main/java/org/elasticsearch/common/network/NetworkService.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/http/HttpServerTransport.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/main/java/org/elasticsearch/transport/Transports.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/Netty4Plugin.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/channel/PrivilegedOioServerSocketChannel.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/channel/PrivilegedOioSocketChannel.java
comments:
Remove blocking TCP clients and servers (#22639)

This commit removes the option to use the blocking variants of the TCP
transport server, TCP transport client, or http server.

time:
2017-01-16T21:53:32Z
class:
core/src/main/java/org/elasticsearch/index/analysis/FlattenGraphTokenFilterFactory.java
core/src/test/java/org/elasticsearch/index/analysis/FlattenGraphTokenFilterFactoryTests.java
test/framework/src/main/java/org/elasticsearch/AnalysisFactoryTestCase.java
comments:
Expose FlattenGraphTokenFilter (#22643)

FlattenGraphTokenFilter is necessary for using graph-based token streams (e.g. the new SynonymGraphFilter) during indexing.

time:
2017-01-16T20:14:41Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/EngineClosedException.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/ShadowEngine.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/indices/IndexingMemoryController.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/engine/ShadowEngineTests.java
core/src/test/java/org/elasticsearch/index/mapper/TextFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexingOperationListenerTests.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
comments:
Replace EngineClosedException with AlreadyClosedExcpetion (#22631)

`EngineClosedException` is a ES level exception that is used to indicate that the engine is closed when operation starts. It doesn't really add much value and we can use `AlreadyClosedException` from Lucene (which may already bubble if things go wrong during operations). Having two exception can just add confusion and lead to bugs, like wrong handling of `EngineClosedException` when dealing with document level failures. The latter was exposed by `IndexWithShadowReplicasIT`.

This PR also removes the AwaitFix from the `IndexWithShadowReplicasIT` tests (which was what cause this to be discovered). While debugging the source of the issue I found some mismatches in document uid management in the tests. The term that was passed to the engine didn't correspond to the uid in the parsed doc - those are fixed as well.

time:
2017-01-16T20:06:08Z
class:
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/info/TransportNodesInfoAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/stats/TransportNodesStatsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/TransportClusterStatsAction.java
core/src/main/java/org/elasticsearch/action/ingest/DeletePipelineTransportAction.java
core/src/main/java/org/elasticsearch/action/ingest/GetPipelineTransportAction.java
core/src/main/java/org/elasticsearch/action/ingest/PutPipelineTransportAction.java
core/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineTransportAction.java
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/cli/EnvironmentAwareCommand.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/common/network/NetworkModule.java
core/src/main/java/org/elasticsearch/common/settings/SettingsModule.java
core/src/main/java/org/elasticsearch/http/HttpServer.java
core/src/main/java/org/elasticsearch/http/HttpServerAdapter.java
core/src/main/java/org/elasticsearch/http/HttpServerTransport.java
core/src/main/java/org/elasticsearch/index/translog/TranslogToolCli.java
core/src/main/java/org/elasticsearch/node/InternalSettingsPreparer.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/node/NodeModule.java
core/src/main/java/org/elasticsearch/node/NodeService.java
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
core/src/main/java/org/elasticsearch/plugins/ListPluginsCommand.java
core/src/main/java/org/elasticsearch/plugins/NetworkPlugin.java
core/src/main/java/org/elasticsearch/rest/RestController.java
core/src/test/java/org/elasticsearch/common/network/NetworkModuleTests.java
core/src/test/java/org/elasticsearch/http/HttpServerTests.java
core/src/test/java/org/elasticsearch/ingest/IngestProcessorNotInstalledOnAllNodesIT.java
core/src/test/java/org/elasticsearch/node/internal/InternalSettingsPreparerTests.java
core/src/test/java/org/elasticsearch/rest/RestControllerTests.java
core/src/test/java/org/elasticsearch/rest/action/admin/cluster/RestNodesStatsActionTests.java
core/src/test/java/org/elasticsearch/rest/action/admin/indices/RestIndicesStatsActionTests.java
core/src/test/java/org/elasticsearch/rest/action/cat/RestIndicesActionTests.java
core/src/test/java/org/elasticsearch/rest/action/cat/RestRecoveryActionTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/Netty4Plugin.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpChannelTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerPipeliningTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerTransportTests.java
test/framework/src/main/java/org/elasticsearch/node/MockNode.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
comments:
Remove HttpServer and HttpServerAdapter in favor of a simple dispatch method (#22636)

Today we have quite some abstractions that are essentially providing a simple
dispatch method to the plugins defining a `HttpServerTransport`. This commit
removes `HttpServer` and `HttpServerAdaptor` and introduces a simple `Dispatcher` functional
interface that delegate to `RestController` by default.

Relates to #18482

time:
2017-01-16T17:54:44Z
class:
client/rest/src/main/java/org/elasticsearch/client/RestClient.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostTests.java
client/test/src/main/java/org/elasticsearch/client/RestClientTestUtil.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java
comments:
move ignore parameter support from yaml test client to low level rest client (#22637)

All the language clients support a special ignore parameter that doesn't get passed to elasticsearch with the request, but used to indicate which error code should not lead to an exception if returned for a specific request.

Moving this to the low level REST client will allow the high level REST client to make use of it too, for instance so that it doesn't have to intercept ResponseExceptions when the get api returns a 404.

time:
2017-01-16T15:36:36Z
class:
plugins/analysis-stempel/src/main/java/org/elasticsearch/index/analysis/pl/PolishStemTokenFilterFactory.java
plugins/analysis-stempel/src/test/java/org/elasticsearch/index/analysis/AnalysisPolishFactoryTests.java
comments:
Fix thread safety of Stempel's token filter factory (#22610)


Closes #21911

time:
2017-01-16T15:19:07Z
class:
comments:
Update profile.asciidoc

Making the "Human readable output" section a note instead of an own section.

time:
2017-01-16T15:17:44Z
class:
client/rest/src/main/java/org/elasticsearch/client/RestClientBuilder.java
comments:
Wrap rest httpclient with doPrivileged blocks (#22603)

This is related to #22116. A number of modules (reindex, etc) use the
rest client. The rest client opens connections using the apache http
client. To avoid throwing SecurityException when using the
SecurityManager these operations must be privileged. This is tricky
because connections are opened within the httpclient code on its
reactor thread. The way I confronted this was to wrap the creation
of the client (and creation of reactor thread) in a doPrivileged
block. The new thread inherits the existing security context.

time:
2017-01-16T15:15:41Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/env/Environment.java
core/src/main/java/org/elasticsearch/env/NodeEnvironment.java
comments:
Revert "Add a deprecation notice to shadow replicas (#22025)"

This reverts commit 0da190234c87838df5d37f2375e901351e05e03d.

time:
2017-01-16T15:15:32Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
comments:
Revert "Don'y use `INDEX_SHARED_FS_ALLOW_RECOVERY_ON_ANY_NODE_SETTING` directly as it triggers (many) deprecation logging"

This reverts commit e976aa09bbd98b631cb12b86e9dc787d45fdb969.

time:
2017-01-16T15:11:59Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
comments:
Don'y use `INDEX_SHARED_FS_ALLOW_RECOVERY_ON_ANY_NODE_SETTING` directly as it triggers (many) deprecation logging

#22025 deprecated this setting (pending it's removal) but it's frequent usage will spam the deprecation logs and also fails test. As temporary work around we should not use the setting object directly.

time:
2017-01-16T14:40:05Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/env/Environment.java
core/src/main/java/org/elasticsearch/env/NodeEnvironment.java
comments:
Add a deprecation notice to shadow replicas (#22025)

Also adds deprecation logging.

See #22024

time:
2017-01-16T13:53:06Z
class:
comments:
[Docs] Fix section title in profile.asciidoc

time:
2017-01-16T13:27:55Z
class:
core/src/main/java/org/elasticsearch/search/profile/ProfileResult.java
core/src/main/java/org/elasticsearch/search/profile/query/CollectorResult.java
core/src/test/java/org/elasticsearch/search/profile/ProfileResultTests.java
core/src/test/java/org/elasticsearch/search/profile/query/CollectorResultTests.java
comments:
ProfileResult and CollectorResult should print machine readable timing information (#22561)

Currently both ProfileResult and CollectorResult print the time field in a human readable string format
 (e.g. "time": "55.20315000ms"). When trying to parse this back to a long value, for example to use in 
the planned high level java rest client, we can lose precision because of conversion and rounding issues. 
This change adds a new additional field (`time_in_nanos`) to the profile response to be able to get the 
original time value in nanoseconds back. 

The old `time` field is only printed when the `?`human=true` flag in the url is set. This follow the behaviour for 
all other stats-related apis. Also the format of the `time` field is slightly changed. Instead of always formatting 
the output as a 10-digit ms value, by using the `XContentBuilder#timeValueField()` method we now print 
the largest time unit present is used (e.g. "s", "ms", "micros").

time:
2017-01-16T13:19:11Z
class:
comments:
Merge pull request #22612 from dadoonet/doc/remote-debug

gradle run --debug-jvm is explained twice

time:
2017-01-16T13:08:52Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationOperation.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
Add replica ops with version conflict to translog

An operation that completed successfully on a primary can result in a
version conflict on a replica due to the asynchronous nature of
operations. When a replica operation results in a version conflict, the
operation is not added to the translog. This leads to gaps in the
translog which is problematic as it can lead to situations where a
replica shard can never advance its local checkpoint. As such operations
are just normal course of business for a replica shard, these operations
should be treated as if they completed successfully. This commit adds
these operations to the translog.

Relates #22626

time:
2017-01-16T12:57:58Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
comments:
Replace custom Functional interface in ElasticsearchException with CheckedFunction

time:
2017-01-16T12:57:58Z
class:
core/src/main/java/org/elasticsearch/rest/BaseRestHandler.java
comments:
Make RestChannelConsumer extend CheckedConsumer<RestChannel, Exception>

time:
2017-01-16T12:57:58Z
class:
core/src/main/java/org/elasticsearch/index/query/functionscore/ScoreFunctionParser.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/search/internal/AliasFilter.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchRequest.java
core/src/test/java/org/elasticsearch/search/internal/ShardSearchTransportRequestTests.java
comments:
replace ShardSearchRequest.FilterParser functional interface with CheckedFunction

time:
2017-01-16T12:57:58Z
class:
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQuery.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolatorHighlightSubFetchPhase.java
modules/percolator/src/test/java/org/elasticsearch/percolator/CandidateQueryTests.java
comments:
replace custom functional interface with CheckedFunction in percolate module

time:
2017-01-16T12:57:58Z
class:
core/src/test/java/org/elasticsearch/threadpool/ScalingThreadPoolTests.java
comments:
[TEST] replace SizeFunction with Function<Integer, Integer>

time:
2017-01-16T12:57:58Z
class:
core/src/main/java/org/elasticsearch/common/CheckedFunction.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
comments:
Expose CheckedFunction

time:
2017-01-16T12:39:37Z
class:
core/src/main/java/org/elasticsearch/common/logging/LogConfigurator.java
qa/evil-tests/src/test/java/org/elasticsearch/common/logging/EvilLoggerTests.java
comments:
Expose logs base path

For certain situations, end-users need the base path for Elasticsearch
logs. Exposing this as a property is better than hard-coding the path
into the logging configuration file as otherwise the logging
configuration file could easily diverge from the Elasticsearch
configuration file. Additionally, Elasticsearch will only have
permissions to write to the log directory configured in the
Elasticsearch configuration file. This commit adds a property that
exposes this base path.

One use-case for this is configuring a rollover strategy to retain logs
for a certain period of time. As such, we add an example of this to the
documentation.

Additionally, we expose the property es.logs.cluster_name as this is
used as the name of the log files in the default configuration.

Finally, we expose es.logs.node_name in cases where node.name is
explicitly set in case users want to include the node name as part of
the name of the log files.

Relates #22625

time:
2017-01-16T12:30:21Z
class:
core/src/main/java/org/elasticsearch/common/logging/LogConfigurator.java
qa/evil-tests/src/test/java/org/elasticsearch/common/logging/EvilLoggerConfigurationTests.java
comments:
Do not configure a logger named level

When logger.level is set, we end up configuring a logger named "level"
because we look for all settings of the form "logger\..+" as configuring
a logger. Yet, logger.level is special and is meant to only configure
the default logging level. This commit causes is to avoid not
configuring a logger named level.

Relates #22624

time:
2017-01-16T12:20:45Z
class:
core/src/main/java/org/elasticsearch/common/network/NetworkModule.java
core/src/main/java/org/elasticsearch/index/IndexingSlowLog.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/IndexingOperationListener.java
core/src/main/java/org/elasticsearch/index/shard/InternalIndexingStats.java
core/src/main/java/org/elasticsearch/indices/IndexingMemoryController.java
core/src/main/java/org/elasticsearch/monitor/os/OsProbe.java
core/src/main/java/org/elasticsearch/plugins/NetworkPlugin.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientHeadersTests.java
core/src/test/java/org/elasticsearch/common/network/NetworkModuleTests.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexingOperationListenerTests.java
core/src/test/java/org/elasticsearch/monitor/os/OsProbeTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/CancelTests.java
test/framework/src/main/java/org/elasticsearch/transport/AssertingTransportInterceptor.java
comments:
Merge branch 'master' into feature/multi_cluster_search

time:
2017-01-16T11:58:59Z
class:
comments:
Inclusion of link to Multi Delete (#22619)

Based on the 2 categories it looks like the docs-delete-by-query was to be listed here under the Multi-document APIs section.

time:
2017-01-16T11:44:51Z
class:
comments:
Fix formatting in update-by-query (#22628)

The automatic slicing section wasn't displaying the bullet list correctly.

time:
2017-01-16T09:32:07Z
class:
comments:
[DOCS] Fiexes typo in getting started doc

time:
2017-01-16T09:26:12Z
class:
comments:
Update doc after review

time:
2017-01-16T09:15:24Z
class:
comments:
[DOCS]cMake it clear that bulk API actions are processed sequentially on each shard rather than sequentially overall (#22550)

time:
2017-01-16T08:08:16Z
class:
core/src/main/java/org/elasticsearch/index/IndexingSlowLog.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/IndexingOperationListener.java
core/src/main/java/org/elasticsearch/index/shard/InternalIndexingStats.java
core/src/main/java/org/elasticsearch/indices/IndexingMemoryController.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexingOperationListenerTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/CancelTests.java
comments:
Indexing: Add shard id to indexing operation listener (#22606)

The IndexingOperationListener interface did not provide any
information about the shard id when a document was indexed.

This commit adds the shard id as the first parameter to all methods
in the IndexingOperationListener.

time:
2017-01-15T17:18:16Z
class:
core/src/main/java/org/elasticsearch/monitor/os/OsProbe.java
core/src/test/java/org/elasticsearch/monitor/os/OsProbeTests.java
comments:
Cleanup handling of cgroup stats

This commit is a simple cleanup of the code related to cgroup stats:
 - reduce visibility of a method
 - remove an unneeded logger guard
 - cleanup the formatting of comments

time:
2017-01-15T12:35:39Z
class:
core/src/main/java/org/elasticsearch/common/network/NetworkModule.java
core/src/main/java/org/elasticsearch/plugins/NetworkPlugin.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientHeadersTests.java
core/src/test/java/org/elasticsearch/common/network/NetworkModuleTests.java
test/framework/src/main/java/org/elasticsearch/transport/AssertingTransportInterceptor.java
comments:
Pass ThreadContext to transport interceptors to allow header modification (#22618)

TransportInterceptors are commonly used to enrich requests with headers etc.
which requires access the the thread context. This is not always easily possible
since threadpools are hard to access for instance if the interceptor is used on a transport client.

This commit passes on the thread context to all the interceptors for further consumption.

Closes #22585

time:
2017-01-15T09:28:34Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Security.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataDeleteIndexService.java
qa/evil-tests/src/test/java/org/elasticsearch/common/logging/EvilLoggerTests.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
comments:
Merge branch 'master' into feature/multi_cluster_search

time:
2017-01-15T04:13:40Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataDeleteIndexService.java
comments:
Log deleting indices at info level

Deleting indices is an important event in a cluster and as such should
be logged at the info level. This commit changes the logging level on
index deletion to the info level.

Relates #22627

time:
2017-01-14T17:51:43Z
class:
qa/evil-tests/src/test/java/org/elasticsearch/common/logging/EvilLoggerTests.java
comments:
Remove obsolete logging test

This commit removes a logging test that is now obsolete. This test was
added when we included a forked version of some Log4j 2 classes to
workaround a bug in Log4j 2. This bug was fixed and a version of Log4j 2
incorporating this fix was previously integrated into Elaticsearch. At
that time, the forked versions were removed, and this test should have
been removed with it.

time:
2017-01-13T22:59:59Z
class:
core/src/test/java/org/elasticsearch/action/search/RemoteClusterConnectionTests.java
comments:
harden tests

time:
2017-01-13T22:20:45Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Security.java
comments:
Fix out-of-date Javadocs on Security.java

We have made the security manager non-optional, but the Javadocs for
Security.java imply that it still is. This commit fixes this issue.

Relates #16176

time:
2017-01-13T22:19:04Z
class:
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
comments:
[TEST] Remove connection listener from all transports in AbstractSimpleTransportTestCase#testSendRandomRequests

time:
2017-01-13T22:07:20Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/TransportAnalyzeAction.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportSingleItemBulkWriteAction.java
core/src/main/java/org/elasticsearch/action/delete/DeleteRequest.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/common/settings/AddStringKeyStoreCommand.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/threadpool/ThreadPool.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TaskManagerTestCase.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionIngestTests.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionTookTests.java
core/src/test/java/org/elasticsearch/action/index/TransportIndexActionIngestTests.java
core/src/test/java/org/elasticsearch/action/main/MainActionTests.java
core/src/test/java/org/elasticsearch/action/search/TransportMultiSearchActionTests.java
core/src/test/java/org/elasticsearch/action/support/WaitActiveShardCountIT.java
core/src/test/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeActionTests.java
core/src/test/java/org/elasticsearch/action/support/master/TransportMasterNodeActionTests.java
core/src/test/java/org/elasticsearch/action/support/nodes/TransportNodesActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/BroadcastReplicationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationActionTests.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientHeadersTests.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientNodesServiceTests.java
core/src/test/java/org/elasticsearch/cluster/ClusterModuleTests.java
core/src/test/java/org/elasticsearch/cluster/NoMasterNodeIT.java
core/src/test/java/org/elasticsearch/cluster/NodeConnectionsServiceTests.java
core/src/test/java/org/elasticsearch/cluster/action/shard/ShardStateActionTests.java
core/src/test/java/org/elasticsearch/cluster/health/ClusterStateHealthTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
core/src/test/java/org/elasticsearch/common/settings/AddStringKeyStoreCommandTests.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/gateway/GatewayServiceTests.java
core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingDisabledTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/seqno/GlobalCheckpointSyncActionTests.java
core/src/test/java/org/elasticsearch/indices/analyze/AnalyzeActionIT.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
core/src/test/java/org/elasticsearch/snapshots/mockstore/MockRepository.java
core/src/test/java/org/elasticsearch/transport/TransportServiceHandshakeTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportDeleteByQueryAction.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/channel/PrivilegedNioServerSocketChannel.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/channel/PrivilegedNioSocketChannel.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/channel/PrivilegedOioServerSocketChannel.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/channel/PrivilegedOioSocketChannel.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpClient.java
test/framework/src/main/java/org/elasticsearch/node/MockNode.java
test/framework/src/main/java/org/elasticsearch/test/ClusterServiceUtils.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
comments:
Merge branch 'master' into feature/multi_cluster_search

time:
2017-01-13T20:57:37Z
class:
core/src/test/java/org/elasticsearch/snapshots/mockstore/MockRepository.java
comments:
[TEST] No longer randomly block on the index-N files in the
MockRepository, because the getRepositoryData() call depends on it,
which is used in non-synchronized actions such as getting
snapshot status.

time:
2017-01-13T20:27:09Z
class:
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/channel/PrivilegedNioServerSocketChannel.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/channel/PrivilegedNioSocketChannel.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/channel/PrivilegedOioServerSocketChannel.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/channel/PrivilegedOioSocketChannel.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpClient.java
comments:
Wrap netty accept/connect ops with doPrivileged (#22572)

This is related to #22116. netty channels require socket `connect` and
`accept` privileges. Netty does not currently wrap these operations
with `doPrivileged` blocks. These changes extend the netty channels
and wrap calls to the relevant super methods in doPrivileged blocks.

time:
2017-01-13T17:09:18Z
class:
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportSingleItemBulkWriteAction.java
core/src/main/java/org/elasticsearch/action/delete/DeleteRequest.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/main/java/org/elasticsearch/threadpool/ThreadPool.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionIngestTests.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionTookTests.java
core/src/test/java/org/elasticsearch/action/index/TransportIndexActionIngestTests.java
core/src/test/java/org/elasticsearch/action/support/WaitActiveShardCountIT.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/cluster/NoMasterNodeIT.java
core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingDisabledTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
comments:
Merge remote-tracking branch 'zareek/enhancement/use_shard_bulk_for_single_ops'

time:
2017-01-13T16:05:13Z
class:
comments:
State default sort order on missing values

Closes #19099

time:
2017-01-13T15:12:27Z
class:
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TaskManagerTestCase.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionTookTests.java
core/src/test/java/org/elasticsearch/action/main/MainActionTests.java
core/src/test/java/org/elasticsearch/action/search/TransportMultiSearchActionTests.java
core/src/test/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeActionTests.java
core/src/test/java/org/elasticsearch/action/support/master/TransportMasterNodeActionTests.java
core/src/test/java/org/elasticsearch/action/support/nodes/TransportNodesActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/BroadcastReplicationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationActionTests.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientHeadersTests.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientNodesServiceTests.java
core/src/test/java/org/elasticsearch/cluster/ClusterModuleTests.java
core/src/test/java/org/elasticsearch/cluster/NodeConnectionsServiceTests.java
core/src/test/java/org/elasticsearch/cluster/action/shard/ShardStateActionTests.java
core/src/test/java/org/elasticsearch/cluster/health/ClusterStateHealthTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/gateway/GatewayServiceTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingDisabledTests.java
core/src/test/java/org/elasticsearch/index/seqno/GlobalCheckpointSyncActionTests.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
core/src/test/java/org/elasticsearch/transport/TransportServiceHandshakeTests.java
test/framework/src/main/java/org/elasticsearch/node/MockNode.java
test/framework/src/main/java/org/elasticsearch/test/ClusterServiceUtils.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
comments:
Remove setLocalNode from ClusterService and TransportService (#22608)

ClusterService and TransportService expect the local discovery node to be set
before they are started but this requires manual interaction and is error prone since
to work absolutely correct they should share the same instance (same ephemeral ID).

TransportService also has 2 modes of operation, mainly realted to transport client vs. internal
to a node. This change removes the mode where we don't maintain a local node and uses a dummy local
node in the transport client since we don't bind to any port in such a case.

Local discovery node instances are now managed by the node itself and only suppliers and factories that allow
creation only once are passed to TransportService and ClusterService.

time:
2017-01-13T15:04:05Z
class:
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
comments:
Harder close and remove reference concurrency in MockTcpTransport (#22613)

There was still small race in MockTcpTransport where channesl that are concurrently
closing are not yet removed from the reference tracking causing tests to fail. Compared to
the other races before this is a rather small windown and requires very very short test durations.

time:
2017-01-13T14:42:02Z
class:
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportDeleteByQueryAction.java
comments:
Increase visibility of doExecute so it can be used directly (#22614)

time:
2017-01-13T14:12:49Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/TransportAnalyzeAction.java
core/src/test/java/org/elasticsearch/indices/analyze/AnalyzeActionIT.java
comments:
Analyze API Position Length Support (#22574)

Expose the position length attribute if a token has a non-standard position length greater than 1.

time:
2017-01-13T13:57:40Z
class:
comments:
Add documentation on remote debugging

For a node which is launched outside the context of Gradle.

time:
2017-01-13T13:42:27Z
class:
comments:
gradle run --debug-jvm is explained twice

We are already explaining how to debug remotely in `Debugging from an IDE` section.
We can remove one.

time:
2017-01-13T12:00:14Z
class:
core/src/main/java/org/elasticsearch/common/settings/AddStringKeyStoreCommand.java
core/src/test/java/org/elasticsearch/common/settings/AddStringKeyStoreCommandTests.java
comments:
Merge pull request #22609 from dadoonet/pr/keystore-npe

NPE when no setting name passed to elasticsearch-keystore

time:
2017-01-13T11:51:35Z
class:
core/src/main/java/org/elasticsearch/common/settings/AddStringKeyStoreCommand.java
core/src/test/java/org/elasticsearch/common/settings/AddStringKeyStoreCommandTests.java
comments:
Update after review and add a test

time:
2017-01-13T11:25:35Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
comments:
Use a set rather than a list for connected nodes

time:
2017-01-13T11:25:18Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
comments:
preserve original excetption

time:
2017-01-13T11:22:52Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterServiceTests.java
comments:
Fail request if there is a local index that matches the both a remote and local index

time:
2017-01-13T11:20:20Z
class:
core/src/main/java/org/elasticsearch/common/settings/AddStringKeyStoreCommand.java
comments:
NPE when no setting name passed to elasticsearch-keystore

```h
$ bin/elasticsearch-keystore create
Created elasticsearch keystore in /Users/dpilato/Documents/Elasticsearch/apps/elasticsearch/elasticsearch-6.0.0-alpha1/config
$ bin/elasticsearch-keystore add
Enter value for null: xyz
Exception in thread "main" java.lang.NullPointerException: invalid null input
	at java.security.KeyStore.setEntry(KeyStore.java:1552)
	at org.elasticsearch.common.settings.KeyStoreWrapper.setString(KeyStoreWrapper.java:264)
	at org.elasticsearch.common.settings.AddStringKeyStoreCommand.execute(AddStringKeyStoreCommand.java:83)
	at org.elasticsearch.cli.EnvironmentAwareCommand.execute(EnvironmentAwareCommand.java:58)
	at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:122)
	at org.elasticsearch.cli.MultiCommand.execute(MultiCommand.java:69)
	at org.elasticsearch.cli.Command.mainWithoutErrorHandling(Command.java:122)
	at org.elasticsearch.cli.Command.main(Command.java:88)
	at org.elasticsearch.common.settings.KeyStoreCli.main(KeyStoreCli.java:39)
```

time:
2017-01-13T11:10:23Z
class:
client/transport/src/test/java/org/elasticsearch/transport/client/PreBuiltTransportClientTests.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/TransportGetTaskAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/IndicesAliasesRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/Condition.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/shrink/ShrinkRequest.java
core/src/main/java/org/elasticsearch/action/support/TransportAction.java
core/src/main/java/org/elasticsearch/cluster/routing/AllocationId.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/AbstractAllocateAllocationCommand.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/AllocateEmptyPrimaryAllocationCommand.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/AllocateReplicaAllocationCommand.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/AllocateStalePrimaryAllocationCommand.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/BasePrimaryAllocationCommand.java
core/src/main/java/org/elasticsearch/common/ParseFieldMatcher.java
core/src/main/java/org/elasticsearch/common/ParseFieldMatcherSupplier.java
core/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/support/XContentMapValues.java
core/src/main/java/org/elasticsearch/env/NodeMetaData.java
core/src/main/java/org/elasticsearch/index/IndexSettings.java
core/src/main/java/org/elasticsearch/index/mapper/AllFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IpFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/AbstractQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryParseContext.java
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/ingest/PipelineConfiguration.java
core/src/main/java/org/elasticsearch/rest/BaseRestHandler.java
core/src/main/java/org/elasticsearch/rest/action/RestActions.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesAliasesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestRolloverIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestShrinkIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestValidateQueryAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestExplainAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/ExtendedBounds.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/completion/context/GeoQueryContext.java
core/src/main/java/org/elasticsearch/tasks/TaskInfo.java
core/src/main/java/org/elasticsearch/tasks/TaskResult.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/test/java/org/elasticsearch/action/admin/indices/alias/AliasActionsTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequestTests.java
core/src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
core/src/test/java/org/elasticsearch/common/xcontent/ConstructingObjectParserTests.java
core/src/test/java/org/elasticsearch/common/xcontent/ObjectParserTests.java
core/src/test/java/org/elasticsearch/common/xcontent/support/XContentMapValuesTests.java
core/src/test/java/org/elasticsearch/get/GetActionIT.java
core/src/test/java/org/elasticsearch/index/mapper/AbstractNumericFieldMapperTestCase.java
core/src/test/java/org/elasticsearch/index/mapper/AllFieldMapperPositionIncrementGapTests.java
core/src/test/java/org/elasticsearch/index/mapper/AllFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentMapperParserTests.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentParserTests.java
core/src/test/java/org/elasticsearch/index/mapper/FieldNamesFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/IpFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
core/src/test/java/org/elasticsearch/index/mapper/NumberFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/RangeFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/UpdateMappingOnClusterIT.java
core/src/test/java/org/elasticsearch/index/mapper/UpdateMappingTests.java
core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/IdsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/InnerHitBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryParseContextTests.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryStringBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SpanNearQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/routing/AliasResolveRoutingIT.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregationCollectorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorFactoriesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/BaseAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/BasePipelineAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridParserTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/ExtendedBoundsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/significant/SignificanceHeuristicTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/FiltersTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/support/IncludeExcludeTests.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilderTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java
core/src/test/java/org/elasticsearch/search/internal/ShardSearchTransportRequestTests.java
core/src/test/java/org/elasticsearch/search/morelikethis/MoreLikeThisIT.java
core/src/test/java/org/elasticsearch/search/nested/SimpleNestedIT.java
core/src/test/java/org/elasticsearch/search/query/QueryStringIT.java
core/src/test/java/org/elasticsearch/search/query/SearchQueryIT.java
core/src/test/java/org/elasticsearch/search/query/SimpleQueryStringIT.java
core/src/test/java/org/elasticsearch/search/rescore/QueryRescoreBuilderTests.java
core/src/test/java/org/elasticsearch/search/searchafter/SearchAfterBuilderTests.java
core/src/test/java/org/elasticsearch/search/slice/SliceBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
core/src/test/java/org/elasticsearch/search/sort/FieldSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/ScoreSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/ScriptSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/SortBuilderTests.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestSearchIT.java
core/src/test/java/org/elasticsearch/search/suggest/completion/CategoryContextMappingTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/GeoContextMappingTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/QueryContextTestCase.java
core/src/test/java/org/elasticsearch/tasks/TaskResultTests.java
core/src/test/java/org/elasticsearch/validate/SimpleValidateQueryIT.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Definition.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByQueryRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestUpdateByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteResponseParsers.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/storage/AzureStorageService.java
plugins/repository-azure/src/main/java/org/elasticsearch/repositories/azure/AzureRepository.java
plugins/repository-azure/src/test/java/org/elasticsearch/repositories/azure/AzureRepositorySettingsTests.java
plugins/repository-gcs/src/main/java/org/elasticsearch/repositories/gcs/GoogleCloudStorageRepository.java
plugins/repository-gcs/src/test/java/org/elasticsearch/repositories/gcs/GoogleCloudStorageBlobStoreRepositoryTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
comments:
Merge branch 'master' into feature/multi_cluster_search

time:
2017-01-13T08:16:24Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
comments:
Fix NPE in TermsAggregatorTests when global ordinals are needed

time:
2017-01-13T08:05:48Z
class:
comments:
Update Jackson to 2.8.6 (#22596)

closes #22266

time:
2017-01-13T00:00:39Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/support/XContentMapValues.java
core/src/test/java/org/elasticsearch/common/xcontent/support/XContentMapValuesTests.java
comments:
Source filtering: only accept array items if the previous include pattern matches (#22593)

Source filtering was always accepting array items even if the include pattern did not match.

Closes #22557

time:
2017-01-12T20:26:09Z
class:
core/src/main/java/org/elasticsearch/index/mapper/IpFieldMapper.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Definition.java
comments:
Whitelist some ScriptDocValues in painless (#22600)

Without this whitelist painless can't use ip or binary doc values.

Closes #22584

time:
2017-01-12T19:37:26Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
Bump version to 5.1.3 (#22597)

* Bump version to 5.1.3

Bumps version and adds the BWC indices

time:
2017-01-12T19:27:09Z
class:
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
comments:
Ensure new connections won't be opened if transport is closed or closing (#22589)

Today there are several races / holes in TcpTransport and MockTcpTransport
that can allow connections to be opened and remain unclosed while the actual
transport implementation is closed. A recently added assertions in #22554 exposes
these problems. This commit fixes several issues related to missed locks or channel
creations outside of a lock not checking if the resource is still open.

time:
2017-01-12T17:17:51Z
class:
core/src/main/java/org/elasticsearch/index/mapper/AllFieldMapper.java
core/src/test/java/org/elasticsearch/get/GetActionIT.java
core/src/test/java/org/elasticsearch/index/mapper/AbstractNumericFieldMapperTestCase.java
core/src/test/java/org/elasticsearch/index/mapper/AllFieldMapperPositionIncrementGapTests.java
core/src/test/java/org/elasticsearch/index/mapper/AllFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentMapperParserTests.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentParserTests.java
core/src/test/java/org/elasticsearch/index/mapper/FieldNamesFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/IpFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
core/src/test/java/org/elasticsearch/index/mapper/NumberFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/RangeFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/UpdateMappingOnClusterIT.java
core/src/test/java/org/elasticsearch/index/mapper/UpdateMappingTests.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryStringBuilderTests.java
core/src/test/java/org/elasticsearch/routing/AliasResolveRoutingIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java
core/src/test/java/org/elasticsearch/search/morelikethis/MoreLikeThisIT.java
core/src/test/java/org/elasticsearch/search/nested/SimpleNestedIT.java
core/src/test/java/org/elasticsearch/search/query/QueryStringIT.java
core/src/test/java/org/elasticsearch/search/query/SearchQueryIT.java
core/src/test/java/org/elasticsearch/search/query/SimpleQueryStringIT.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestSearchIT.java
core/src/test/java/org/elasticsearch/validate/SimpleValidateQueryIT.java
comments:
Merge remote-tracking branch 'dakrone/disable-all-by-default'

time:
2017-01-12T15:58:21Z
class:
client/transport/src/test/java/org/elasticsearch/transport/client/PreBuiltTransportClientTests.java
comments:
Upgrade to Netty 4.1.7

This commit upgrades the Netty dependency to version 4.1.7.Final,
picking up some important bug fixes.

Relates #22587

time:
2017-01-12T13:59:22Z
class:
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/storage/AzureStorageService.java
plugins/repository-azure/src/main/java/org/elasticsearch/repositories/azure/AzureRepository.java
plugins/repository-azure/src/test/java/org/elasticsearch/repositories/azure/AzureRepositorySettingsTests.java
plugins/repository-gcs/src/main/java/org/elasticsearch/repositories/gcs/GoogleCloudStorageRepository.java
plugins/repository-gcs/src/test/java/org/elasticsearch/repositories/gcs/GoogleCloudStorageBlobStoreRepositoryTests.java
comments:
Fixes default chunk size for Azure repositories (#22577)

Before, the default chunk size for Azure repositories was
-1 bytes, which meant that if the chunk_size was not set on
the Azure repository, nor as a node setting, then no data
files would get written as part of the snapshot (because
the BlobStoreRepository's PartSliceStream does not know
how to process negative chunk sizes).

This commit fixes the default chunk size for Azure repositories
to be the same as the maximum chunk size.  This commit also
adds tests for both the Azure and Google Cloud repositories to
ensure only valid chunk sizes can be set.

Closes #22513

time:
2017-01-12T13:57:03Z
class:
comments:
[DOC] Document {{url}} mustache function (#22549)

This function introduced in #20838 wasn't documented at all.

Related to #22459

time:
2017-01-12T13:43:35Z
class:
core/src/main/java/org/elasticsearch/common/ParseFieldMatcher.java
core/src/main/java/org/elasticsearch/common/ParseFieldMatcherSupplier.java
comments:
Remove ParseFieldMatcher and ParseFieldMatcherSupplier

Closes #19552

time:
2017-01-12T13:43:35Z
class:
core/src/main/java/org/elasticsearch/rest/BaseRestHandler.java
comments:
Remove ParseFieldMatcher usages from BaseRestHandler

time:
2017-01-12T13:43:35Z
class:
core/src/main/java/org/elasticsearch/action/support/TransportAction.java
comments:
Remove ParseFieldMatcher usages from TransportAction

time:
2017-01-12T13:43:35Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/BasePrimaryAllocationCommand.java
core/src/main/java/org/elasticsearch/index/IndexSettings.java
core/src/main/java/org/elasticsearch/ingest/PipelineConfiguration.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/tasks/TaskResult.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestSearchTemplateAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByQueryRestHandler.java
comments:
Remove ParseFieldMatcher usages from IndexSettings

time:
2017-01-12T13:43:35Z
class:
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
comments:
Remove ParseFieldMatcher usages from QueryRewriteContext

time:
2017-01-12T13:43:35Z
class:
core/src/main/java/org/elasticsearch/index/query/AbstractQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryParseContext.java
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/rest/action/RestActions.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestValidateQueryAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestExplainAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/ExtendedBounds.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/completion/context/GeoQueryContext.java
core/src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/IdsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/InnerHitBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryParseContextTests.java
core/src/test/java/org/elasticsearch/index/query/SpanNearQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregationCollectorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorFactoriesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/BaseAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/BasePipelineAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridParserTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/significant/SignificanceHeuristicTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/FiltersTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/support/IncludeExcludeTests.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilderTests.java
core/src/test/java/org/elasticsearch/search/internal/ShardSearchTransportRequestTests.java
core/src/test/java/org/elasticsearch/search/rescore/QueryRescoreBuilderTests.java
core/src/test/java/org/elasticsearch/search/searchafter/SearchAfterBuilderTests.java
core/src/test/java/org/elasticsearch/search/slice/SliceBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
core/src/test/java/org/elasticsearch/search/sort/FieldSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/ScoreSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/ScriptSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/SortBuilderTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/CategoryContextMappingTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/GeoContextMappingTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/QueryContextTestCase.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
comments:
Remove ParseFieldMatcher usages from QueryParseContext

time:
2017-01-12T09:21:47Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/ExtendedBounds.java
comments:
fix compile error

ExtendedBounds cannot yet have its ParseFieldMatcher usage removed, reverted that bit.

time:
2017-01-12T09:04:45Z
class:
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java
comments:
Move human flag under always accepted query_string params (#22562)

There are some parameters that are accepted by each and every api we expose. Those (pretty, source, error_trace and filter_path)  are not explicitly listed in the spec of every api, rather whitelisted in clients test runners so that they are always accepted. The `human` flag has been treated up until now as a parameter that's accepted by only some stats and info api, but that doesn't reflect reality as es core treats it exactly like `pretty` (relevant especially now that we validate params and throw exception when we find one that is not supported). Furthermore, the human flag has effect on every api that outputs a date, time, percentage or byte size field. For instance the tasks api outputs a date field although they don't have the human flag explicitly listed in their spec. There are other similar cases. This commit removes the human flag from the rest spec and makes it an always accepted query_string param.

time:
2017-01-12T09:04:10Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/TransportGetTaskAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/IndicesAliasesRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/Condition.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/shrink/ShrinkRequest.java
core/src/main/java/org/elasticsearch/cluster/routing/AllocationId.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/AbstractAllocateAllocationCommand.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/AllocateEmptyPrimaryAllocationCommand.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/AllocateReplicaAllocationCommand.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/AllocateStalePrimaryAllocationCommand.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/BasePrimaryAllocationCommand.java
core/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java
core/src/main/java/org/elasticsearch/env/NodeMetaData.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesAliasesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestRolloverIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestShrinkIndexAction.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/ExtendedBounds.java
core/src/main/java/org/elasticsearch/tasks/TaskInfo.java
core/src/main/java/org/elasticsearch/tasks/TaskResult.java
core/src/test/java/org/elasticsearch/action/admin/indices/alias/AliasActionsTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequestTests.java
core/src/test/java/org/elasticsearch/common/xcontent/ConstructingObjectParserTests.java
core/src/test/java/org/elasticsearch/common/xcontent/ObjectParserTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/ExtendedBoundsTests.java
core/src/test/java/org/elasticsearch/tasks/TaskResultTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestUpdateByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteResponseParsers.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
comments:
Remove some more ParseFieldMatcher usages (#22571)

time:
2017-01-12T08:38:36Z
class:
comments:
Indentation error on example of dist_max (#22578)

There was a problem with the indentation on the example of the `dist_max` query

time:
2017-01-11T23:47:13Z
class:
core/src/main/java/org/elasticsearch/index/mapper/AllFieldMapper.java
core/src/test/java/org/elasticsearch/get/GetActionIT.java
core/src/test/java/org/elasticsearch/index/mapper/AbstractNumericFieldMapperTestCase.java
core/src/test/java/org/elasticsearch/index/mapper/AllFieldMapperPositionIncrementGapTests.java
core/src/test/java/org/elasticsearch/index/mapper/AllFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentMapperParserTests.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentParserTests.java
core/src/test/java/org/elasticsearch/index/mapper/FieldNamesFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/IpFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
core/src/test/java/org/elasticsearch/index/mapper/NumberFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/RangeFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/UpdateMappingOnClusterIT.java
core/src/test/java/org/elasticsearch/index/mapper/UpdateMappingTests.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryStringBuilderTests.java
core/src/test/java/org/elasticsearch/routing/AliasResolveRoutingIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java
core/src/test/java/org/elasticsearch/search/morelikethis/MoreLikeThisIT.java
core/src/test/java/org/elasticsearch/search/nested/SimpleNestedIT.java
core/src/test/java/org/elasticsearch/search/query/QueryStringIT.java
core/src/test/java/org/elasticsearch/search/query/SearchQueryIT.java
core/src/test/java/org/elasticsearch/search/query/SimpleQueryStringIT.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestSearchIT.java
core/src/test/java/org/elasticsearch/validate/SimpleValidateQueryIT.java
comments:
Disable _all by default

This change disables the _all meta field by default.

Now that we have the "all-fields" method of query execution, we can save both
indexing time and disk space by disabling it.

_all can no longer be configured for indices created after 6.0.

Relates to #20925 and #21341
Resolves #19784

time:
2017-01-11T23:21:46Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterConnectionTests.java
comments:
flush pending listeners if remote cluster connection is closed

time:
2017-01-11T22:40:46Z
class:
core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/common/lucene/search/Queries.java
core/src/main/java/org/elasticsearch/common/settings/AddStringKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/KeyStoreWrapper.java
core/src/main/java/org/elasticsearch/common/settings/SecureSetting.java
core/src/main/java/org/elasticsearch/common/settings/SecureSettings.java
core/src/main/java/org/elasticsearch/common/settings/SecureString.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/main/java/org/elasticsearch/common/xcontent/cbor/CborXContentGenerator.java
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContentGenerator.java
core/src/main/java/org/elasticsearch/common/xcontent/smile/SmileXContentGenerator.java
core/src/main/java/org/elasticsearch/common/xcontent/yaml/YamlXContentGenerator.java
core/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/main/java/org/elasticsearch/index/search/MultiMatchQuery.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/test/java/org/elasticsearch/common/settings/KeyStoreCommandTestCase.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryParserTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
core/src/test/java/org/elasticsearch/search/query/QueryStringIT.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/CompilerSettings.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/WhenThingsGoWrongTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/AwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/AwsS3ServiceImplTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3RepositoryTests.java
test/framework/src/main/java/org/elasticsearch/common/settings/MockSecureSettings.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
comments:
Merge branch 'master' into feature/multi_cluster_search

time:
2017-01-11T22:37:12Z
class:
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
comments:
Move assertion for open channels under TcpTransport lock

TcpTransport has an actual mechanism to stop resources in subclasses.
Instead of overriding `doStop` subclasses should override `stopInternal`
that is executed under the connection lock guaranteeing that there is no
concurrency etc.

Relates to #22554

time:
2017-01-11T22:10:56Z
class:
comments:
Fix default port for unicast zen ping hosts

Today when you do not specify a port for an entry in
discovery.zen.ping.unicast.hosts, the default port is the value of the
setting transport.profiles.default.port and falls back to the value of
transport.tcp.port if this is not set. For a node that is explicitly
bound to a different port than the default port, this means that the
default port will be equal to this explicitly bound port. Yet, the docs
say that we fall back to 9300 here. This commit corrects the docs.

Relates #22568

time:
2017-01-11T19:51:23Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/cbor/CborXContentGenerator.java
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContentGenerator.java
core/src/main/java/org/elasticsearch/common/xcontent/smile/SmileXContentGenerator.java
core/src/main/java/org/elasticsearch/common/xcontent/yaml/YamlXContentGenerator.java
comments:
Remove unused *XContentGenerator constructors (#22558)

time:
2017-01-11T19:19:46Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/common/settings/AddStringKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/KeyStoreWrapper.java
core/src/main/java/org/elasticsearch/common/settings/SecureSetting.java
core/src/main/java/org/elasticsearch/common/settings/SecureSettings.java
core/src/main/java/org/elasticsearch/common/settings/SecureString.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/test/java/org/elasticsearch/common/settings/KeyStoreCommandTestCase.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/AwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/AwsS3ServiceImplTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3RepositoryTests.java
test/framework/src/main/java/org/elasticsearch/common/settings/MockSecureSettings.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
Make s3 repository sensitive settings use secure settings (#22479)

* Settings: Make s3 repository sensitive settings use secure settings

This change converts repository-s3 to use the new secure settings. In
order to support the multiple ways we allow aws creds to be configured,
it also moves the main methods for the keystore wrapper into a
SecureSettings interface, in order to allow settings prefixing to work.

time:
2017-01-11T17:59:43Z
class:
core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
core/src/main/java/org/elasticsearch/common/lucene/search/Queries.java
core/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/main/java/org/elasticsearch/index/search/MultiMatchQuery.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryParserTests.java
core/src/test/java/org/elasticsearch/search/query/QueryStringIT.java
comments:
QueryString and SimpleQueryString Graph Support (#22541)

Add support for graph token streams to "query_String" and
"simple_query_string" queries.

time:
2017-01-11T17:55:23Z
class:
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
comments:
Improve error message when reindex-from-remote gets bad json (#22536)

Adds a message about how the remote is unlikely to be Elasticsearch.
This isn't as good as including the whole message from the remote but
we can't do that because we are stream parsing it and we don't want
to mark the whole request.

Closes #22330

time:
2017-01-11T17:47:04Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/CompilerSettings.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/WhenThingsGoWrongTests.java
comments:
Update Painless Loop Counter to be Higher (#22560)

Updated Painless loop counter to be 1000000 statements instead of 10000 for update queries.

time:
2017-01-11T17:22:24Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/CompilerSettings.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/WhenThingsGoWrongTests.java
comments:
Update loop counter to be higher (1000000) instead of (10000).

time:
2017-01-11T17:08:46Z
class:
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
core/src/main/java/org/elasticsearch/action/index/IndexResponse.java
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/ShardSearchFailure.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchHelper.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationResponse.java
core/src/main/java/org/elasticsearch/client/node/NodeClient.java
core/src/main/java/org/elasticsearch/cluster/NodeConnectionsService.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/common/logging/ESLoggerFactory.java
core/src/main/java/org/elasticsearch/common/settings/AbstractScopedSettings.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentParserUtils.java
core/src/main/java/org/elasticsearch/index/get/GetField.java
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
core/src/main/java/org/elasticsearch/index/shard/ShardId.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/Plugin.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/rest/BytesRestResponse.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/search/SearchHit.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/SearchRequestParsers.java
core/src/main/java/org/elasticsearch/search/SearchShardTarget.java
core/src/main/java/org/elasticsearch/search/aggregations/AbstractAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/children/ChildrenAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/children/ChildrenAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/FilterAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/FilterAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoGridAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/global/GlobalAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/global/GlobalAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/global/InternalGlobal.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/missing/MissingAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/missing/MissingAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/AbstractRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/AbstractRangeBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/BinaryRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/InternalRange.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/DateRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/DateRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/InternalDateRange.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/InternalGeoDistance.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/ip/IpRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/LongTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/AvgAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/AvgAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/GeoBoundsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/GeoBoundsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/GeoCentroidAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/GeoCentroidAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/max/MaxAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/max/MaxAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/min/MinAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/min/MinAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentileRanksAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentilesAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/HDRPercentileRanksAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/HDRPercentilesAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/TDigestPercentileRanksAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/TDigestPercentilesAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/StatsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/StatsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ExtendedStatsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ExtendedStatsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/sum/SumAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/sum/SumAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/valuecount/ValueCountAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/valuecount/ValueCountAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightField.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHits.java
core/src/main/java/org/elasticsearch/search/internal/SearchSortValues.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotShardsService.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/test/java/org/elasticsearch/action/ExplainRequestTests.java
core/src/test/java/org/elasticsearch/action/ShardValidateQueryRequestTests.java
core/src/test/java/org/elasticsearch/action/index/IndexRequestTests.java
core/src/test/java/org/elasticsearch/action/index/IndexResponseTests.java
core/src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationResponseTests.java
core/src/test/java/org/elasticsearch/client/node/NodeClientHeadersTests.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/NodeConnectionsServiceTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
core/src/test/java/org/elasticsearch/common/settings/ScopedSettingsTests.java
core/src/test/java/org/elasticsearch/common/settings/SettingTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/index/engine/LiveVersionMapTests.java
core/src/test/java/org/elasticsearch/index/get/GetFieldTests.java
core/src/test/java/org/elasticsearch/index/get/GetResultTests.java
core/src/test/java/org/elasticsearch/index/search/MatchQueryIT.java
core/src/test/java/org/elasticsearch/index/shard/ShardIdTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
core/src/test/java/org/elasticsearch/search/AbstractSearchTestCase.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightFieldTests.java
core/src/test/java/org/elasticsearch/search/internal/InternalSearchHitTests.java
core/src/test/java/org/elasticsearch/search/internal/InternalSearchHitsTests.java
core/src/test/java/org/elasticsearch/search/internal/SearchSortValuesTests.java
core/src/test/java/org/elasticsearch/search/preference/SearchPreferenceIT.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/matrix/stats/MatrixStatsAggregationBuilder.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/matrix/stats/MatrixStatsAggregatorFactory.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/support/MultiValuesSourceAggregationBuilder.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/support/MultiValuesSourceAggregatorFactory.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateRequest.java
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateRequestBuilder.java
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateResponse.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateRequest.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateRequestBuilder.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateResponse.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateSourceBuilder.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolatorPlugin.java
modules/percolator/src/main/java/org/elasticsearch/percolator/RestMultiPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/RestPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportMultiPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportPercolateAction.java
modules/percolator/src/test/java/org/elasticsearch/percolator/MultiPercolatorIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/MultiPercolatorRequestTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorAggregationsIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorClientYamlTestSuiteIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorQuerySearchIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorTestUtil.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBaseReindexRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByQueryRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ClientScrollableHitSource.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestUpdateByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ScrollableHitSource.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuilders.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RestReindexActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuildersTests.java
plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedDiscoveryPlugin.java
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/storage/AzureStorageSettings.java
test/framework/src/main/java/org/elasticsearch/test/ClusterServiceUtils.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
test/framework/src/main/java/org/elasticsearch/test/RandomObjects.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
comments:
Merge branch 'master' into enhancement/use_shard_bulk_for_single_ops

time:
2017-01-11T17:08:04Z
class:
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
comments:
Fix Translog.Delete serialization for sequence numbers (#22543)

* Fix Translog.Delete serialization for sequence numbers

Translog.Delete used `.writeVLong` instead of `.writeLong` for the sequence
number and primary term (and their respective "read" variants). This could lead
to issues where a 5.x node sent a translog operation with a negative sequence
number (-2 for unassigned seq no) that tripped an assertion serializing a
negative number and causing ES to exit.

Adds a unit test for serialization and a mixed-cluster REST test, since that was
how this was originally caught.

* Use more realistic values for random seqNum and primary term

* Add comment with TODO for removal in 7.0

* Change comment into an assert

time:
2017-01-11T16:27:25Z
class:
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
comments:
Adds debugging information for invalid repository data x-content

time:
2017-01-11T16:23:07Z
class:
comments:
Remove doc links from config template

The config template that ships with Elasticsearch distributions contains
links to various pieces of documentation. Links go out of date and get
broken. This commit removes such links from the config template.

Relates #22553

time:
2017-01-11T16:03:30Z
class:
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/Plugin.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/SearchRequestParsers.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/test/java/org/elasticsearch/action/ExplainRequestTests.java
core/src/test/java/org/elasticsearch/action/ShardValidateQueryRequestTests.java
core/src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
core/src/test/java/org/elasticsearch/search/AbstractSearchTestCase.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBaseReindexRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByQueryRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestUpdateByQueryAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RestReindexActionTests.java
plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedDiscoveryPlugin.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
comments:
Merge branch 'master' into feature/multi_cluster_search

time:
2017-01-11T16:02:36Z
class:
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
comments:
Prevent open channel leaks if handshake times out or is interrupted (#22554)

The low level TCP handshake can cause channel / connection leaks if it's interrupted
since the caller doesn't close the channel / connection if the handshake was not successful.
This commit fixes the channel leak and adds general test infrastructure to detect channel leaks
in the future.

time:
2017-01-11T15:28:14Z
class:
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/Plugin.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/SearchRequestParsers.java
core/src/test/java/org/elasticsearch/action/ExplainRequestTests.java
core/src/test/java/org/elasticsearch/action/ShardValidateQueryRequestTests.java
core/src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
core/src/test/java/org/elasticsearch/search/AbstractSearchTestCase.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBaseReindexRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByQueryRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestUpdateByQueryAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RestReindexActionTests.java
plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedDiscoveryPlugin.java
comments:
Remove SearchRequestParsers (#22538)

It is empty now that we've moved all the parsing into `namedObject`.

time:
2017-01-11T14:10:36Z
class:
comments:
remove leftover

time:
2017-01-11T14:09:29Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
comments:
fix redundant modifier

time:
2017-01-11T13:52:41Z
class:
comments:
improve docs based on review commments:
there is a leftover `"` after nodes ;)

time:
2017-01-11T13:49:55Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
comments:
add additional explaination to exception handling in AbstractSearchAsyncAction

time:
2017-01-11T13:47:45Z
class:
core/src/main/java/org/elasticsearch/action/ActionListener.java
core/src/test/java/org/elasticsearch/action/ActionListenerTests.java
comments:
Simplify ActionListener helpers and add dedicated unittests

time:
2017-01-11T11:41:26Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/ShardSearchFailure.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchHelper.java
core/src/main/java/org/elasticsearch/search/SearchShardTarget.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java
core/src/test/java/org/elasticsearch/index/engine/LiveVersionMapTests.java
core/src/test/java/org/elasticsearch/search/internal/InternalSearchHitTests.java
core/src/test/java/org/elasticsearch/search/preference/SearchPreferenceIT.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ClientScrollableHitSource.java
comments:
Merge branch 'master' into feature/multi_cluster_search

time:
2017-01-11T11:38:46Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterServiceTests.java
core/src/test/java/org/elasticsearch/common/settings/SettingTests.java
comments:
Cut over to use affix setting for remote cluster configuration

Instead of `search.remote.seeds.${clustername}` we now specify the seeds as:
`search.remote.${clustername}.seeds` which is a real list setting compared to an unvalidated
group setting before.

time:
2017-01-11T09:55:29Z
class:
core/src/test/java/org/elasticsearch/index/engine/LiveVersionMapTests.java
comments:
[TEST] Disable testRamBytesUsed on JDK 9

time:
2017-01-11T09:13:05Z
class:
comments:
[docs] Add missing RUN command from custom docker config

Fix the `Dockerfile` example in the `Customizing image` third configuration
method by adding the missing RUN instruction.

Originally reported by Shankar Vasudevan (@vshank77).

Relates #21973

time:
2017-01-11T09:08:31Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/ShardSearchFailure.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchHelper.java
core/src/main/java/org/elasticsearch/search/SearchShardTarget.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java
core/src/test/java/org/elasticsearch/search/internal/InternalSearchHitTests.java
core/src/test/java/org/elasticsearch/search/preference/SearchPreferenceIT.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ClientScrollableHitSource.java
comments:
Clean up SearchShardTarget (#22468)

* unify shard target setter

* Remove indexText member from SearchShardTarget

* Remove duplicated indexName getter from SearchShardTarget

* Remove duplicated shardId getter from SearchShardTarget

* Remove duplicated nodeIde getter from SearchShardTarget

* Rename SearchShardTarget#nodeIdText getter to getNodeIdText

* Remove unused InternalSearchHit#internalSourceRef unused method

* Remove unused InternalSearchHit#internalHighlightFields unused method

* Make SearchShardTarget members final

time:
2017-01-11T08:28:00Z
class:
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
core/src/main/java/org/elasticsearch/action/index/IndexResponse.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationResponse.java
core/src/main/java/org/elasticsearch/client/node/NodeClient.java
core/src/main/java/org/elasticsearch/cluster/NodeConnectionsService.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/AllocationCommandRegistry.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/AllocationCommands.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/common/compress/CompressorFactory.java
core/src/main/java/org/elasticsearch/common/logging/ESLoggerFactory.java
core/src/main/java/org/elasticsearch/common/network/NetworkModule.java
core/src/main/java/org/elasticsearch/common/settings/AbstractScopedSettings.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentParserUtils.java
core/src/main/java/org/elasticsearch/index/get/GetField.java
core/src/main/java/org/elasticsearch/index/get/GetResult.java
core/src/main/java/org/elasticsearch/index/query/HasChildQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/HasParentQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/NestedQueryBuilder.java
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
core/src/main/java/org/elasticsearch/index/shard/ShardId.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/SearchPlugin.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/rest/BytesRestResponse.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterRerouteAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/search/SearchExtBuilder.java
core/src/main/java/org/elasticsearch/search/SearchExtRegistry.java
core/src/main/java/org/elasticsearch/search/SearchHit.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/SearchRequestParsers.java
core/src/main/java/org/elasticsearch/search/aggregations/AbstractAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorFactories.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorParsers.java
core/src/main/java/org/elasticsearch/search/aggregations/BaseAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/PipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/children/ChildrenAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/children/ChildrenAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/FilterAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/FilterAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoGridAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/global/GlobalAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/global/GlobalAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/global/InternalGlobal.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/missing/MissingAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/missing/MissingAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/AbstractRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/AbstractRangeBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/BinaryRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/InternalRange.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/DateRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/DateRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/InternalDateRange.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/InternalGeoDistance.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/ip/IpRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/LongTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/AvgAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/AvgAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/GeoBoundsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/GeoBoundsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/GeoCentroidAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/GeoCentroidAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/max/MaxAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/max/MaxAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/min/MinAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/min/MinAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentileRanksAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentilesAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/HDRPercentileRanksAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/HDRPercentilesAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/TDigestPercentileRanksAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/TDigestPercentilesAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/StatsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/StatsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ExtendedStatsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ExtendedStatsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/sum/SumAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/sum/SumAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/valuecount/ValueCountAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/valuecount/ValueCountAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/AbstractPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightField.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHits.java
core/src/main/java/org/elasticsearch/search/internal/SearchSortValues.java
core/src/main/java/org/elasticsearch/search/suggest/SuggestBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/Suggester.java
core/src/main/java/org/elasticsearch/search/suggest/Suggesters.java
core/src/main/java/org/elasticsearch/search/suggest/SuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggester.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/completion/FuzzyOptions.java
core/src/main/java/org/elasticsearch/search/suggest/completion/RegexOptions.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGeneratorBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/Laplace.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/LinearInterpolation.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggester.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/SmoothingModel.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/StupidBackoff.java
core/src/main/java/org/elasticsearch/search/suggest/term/TermSuggester.java
core/src/main/java/org/elasticsearch/search/suggest/term/TermSuggestionBuilder.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotShardsService.java
core/src/test/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteRequestTests.java
core/src/test/java/org/elasticsearch/action/index/IndexRequestTests.java
core/src/test/java/org/elasticsearch/action/index/IndexResponseTests.java
core/src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationResponseTests.java
core/src/test/java/org/elasticsearch/client/node/NodeClientHeadersTests.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/NodeConnectionsServiceTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AllocationCommandsTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
core/src/test/java/org/elasticsearch/common/settings/ScopedSettingsTests.java
core/src/test/java/org/elasticsearch/common/settings/SettingTests.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/index/get/GetFieldTests.java
core/src/test/java/org/elasticsearch/index/get/GetResultTests.java
core/src/test/java/org/elasticsearch/index/query/HasChildQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/HasParentQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/NestedQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/search/MatchQueryIT.java
core/src/test/java/org/elasticsearch/index/shard/ShardIdTests.java
core/src/test/java/org/elasticsearch/search/AbstractSearchTestCase.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregationCollectorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorFactoriesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorParsingTests.java
core/src/test/java/org/elasticsearch/search/aggregations/BaseAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/BasePipelineAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/ExtendedStatsBucketTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/PercentilesBucketTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/moving/avg/MovAvgTests.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
core/src/test/java/org/elasticsearch/search/fetch/FetchSubPhasePluginIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightFieldTests.java
core/src/test/java/org/elasticsearch/search/internal/InternalSearchHitTests.java
core/src/test/java/org/elasticsearch/search/internal/InternalSearchHitsTests.java
core/src/test/java/org/elasticsearch/search/internal/SearchSortValuesTests.java
core/src/test/java/org/elasticsearch/search/suggest/AbstractSuggestionBuilderTestCase.java
core/src/test/java/org/elasticsearch/search/suggest/CustomSuggester.java
core/src/test/java/org/elasticsearch/search/suggest/CustomSuggesterPlugin.java
core/src/test/java/org/elasticsearch/search/suggest/CustomSuggesterSearchIT.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestBuilderTests.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGeneratorTests.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/LaplaceModelTests.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/LinearInterpolationModelTests.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/SmoothingModelTestCase.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/StupidBackoffModelTests.java
core/src/test/java/org/elasticsearch/search/suggest/term/TermSuggestionBuilderTests.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/matrix/stats/MatrixStatsAggregationBuilder.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/matrix/stats/MatrixStatsAggregatorFactory.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/support/MultiValuesSourceAggregationBuilder.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/support/MultiValuesSourceAggregatorFactory.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateRequest.java
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateRequestBuilder.java
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateResponse.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateRequest.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateRequestBuilder.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateResponse.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateSourceBuilder.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolatorPlugin.java
modules/percolator/src/main/java/org/elasticsearch/percolator/RestMultiPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/RestPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportMultiPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportPercolateAction.java
modules/percolator/src/test/java/org/elasticsearch/percolator/MultiPercolatorIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/MultiPercolatorRequestTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorAggregationsIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorClientYamlTestSuiteIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorQuerySearchIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorTestUtil.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBaseReindexRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByQueryRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ClientScrollableHitSource.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestUpdateByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ScrollableHitSource.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuilders.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RestReindexActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuildersTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/storage/AzureStorageSettings.java
test/framework/src/main/java/org/elasticsearch/test/ClusterServiceUtils.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
test/framework/src/main/java/org/elasticsearch/test/RandomObjects.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
comments:
Merge branch 'master' into feature/multi_cluster_search

time:
2017-01-11T08:24:47Z
class:
core/src/main/java/org/elasticsearch/common/settings/AbstractScopedSettings.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/test/java/org/elasticsearch/common/settings/ScopedSettingsTests.java
comments:
Allow affix settings to be dynamic / updatable (#22526)

Today affix settings are not dynamic since it's required to know
it's namespace in order to pull a concrete setting from it. This is not possible
in practice since the namespaces are dynamic by design. This change allows to register
a specialized settings consumer that consumes the namespace and the actual value if
a setting gets updated.

time:
2017-01-10T23:26:06Z
class:
core/src/main/java/org/elasticsearch/client/node/NodeClient.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/test/java/org/elasticsearch/client/node/NodeClientHeadersTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBaseReindexRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByQueryRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestUpdateByQueryAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RestReindexActionTests.java
comments:
Remove ClusterService from ctors in reindex (#22539)

Moves fetching the local node id into `NodeClient` which is a
fairly useful place to put it so you can generate task ids from
`NodeClient#executeLocally`.

time:
2017-01-10T21:11:05Z
class:
comments:
Fix some typos in error messages in the build

time:
2017-01-10T19:58:31Z
class:
core/src/main/java/org/elasticsearch/rest/BytesRestResponse.java
comments:
use ElasticsearchException#renderException in BytesRestResponse#convert (#22531)

time:
2017-01-10T19:47:32Z
class:
comments:
Merge remote-tracking branch 'dakrone/document-sqs-negation-better'

time:
2017-01-10T19:30:15Z
class:
comments:
Remove disabling Netty pooled allocator

This commit reverts switching to the unpooled allocator (for now) to let
some benchmarks run to see if this is the source of an increase in GC
times.

Relates #22452

time:
2017-01-10T19:25:32Z
class:
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
core/src/main/java/org/elasticsearch/action/index/IndexResponse.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationResponse.java
core/src/test/java/org/elasticsearch/action/index/IndexRequestTests.java
core/src/test/java/org/elasticsearch/action/index/IndexResponseTests.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationResponseTests.java
test/framework/src/main/java/org/elasticsearch/test/RandomObjects.java
comments:
Add fromxcontent methods to index response (#22229)

This commit adds the parsing fromXContent() methods to the IndexResponse class. The method is based on a ObjectParser because it is easier to use when parsing parent abstract classes like DocWriteResponse.

It also changes the ReplicationResponse.ShardInfo so that it now implements ToXContentObject. This way, the ShardInfo.fromXContent() method can be used by the IndexResponse's ObjectParser.

time:
2017-01-10T19:12:55Z
class:
comments:
Update getting-started.asciidoc (#22370)

time:
2017-01-10T18:54:29Z
class:
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
comments:
Removes remaining snapshot backwards compatibility logic (#22512)

Previously, we removed all unneeded backward compatibility logic 
from the BlobStoreRepository because 6.0 does not need to support
2.x snapshot formats.  During the process of removing this backward
compatibility logic, some code was leftover that is no longer
necessary.  This commit removes all the remaining unnecessary
backwards compatibility code in BlobStoreRepository.

time:
2017-01-10T18:49:57Z
class:
comments:
Update Debian package installation documentation (#22405)

#9261 added a warning about the use of `add-apt-repository` which is becoming obsolete over time as new distribution releases include later versions of `add-apt-repository` which don't automatically add the `deb-src` line. This change updates the documentation to make the block a note rather than a warning and adds two other reasons for avoiding `add-apt-repository` which are still relevant: avoiding edits to a system shared file and not requiring a large number of non-default packages to add one line of text to a file.

time:
2017-01-10T17:57:13Z
class:
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightFieldTests.java
comments:
[Test] Fix test problem with potentially duplicate keys in rest response highlight section

time:
2017-01-10T17:27:00Z
class:
comments:
Document simple_query_string negation with default_operator of OR

This can be confusing when unexpected.

Resolves #4707

time:
2017-01-10T16:59:50Z
class:
comments:
Update api-conventions.asciidoc (#22439)

The example

```
/<logstash-{now/d-2d}>,<logstash-{now/d-1d}>,<logstash-{now/d}>/_search
```

shows escaped URL where `,  => %2C`, so I assume it should be escaped and be present in the table

time:
2017-01-10T16:57:19Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/AbstractAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/children/ChildrenAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/children/ChildrenAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/FilterAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/FilterAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoGridAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/global/GlobalAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/global/GlobalAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/global/InternalGlobal.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/missing/MissingAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/missing/MissingAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/AbstractRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/AbstractRangeBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/BinaryRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/InternalRange.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/DateRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/DateRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/InternalDateRange.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/InternalGeoDistance.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/ip/IpRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/AvgAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/AvgAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/GeoBoundsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/GeoBoundsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/GeoCentroidAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/GeoCentroidAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/max/MaxAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/max/MaxAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/min/MinAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/min/MinAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentileRanksAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentilesAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/HDRPercentileRanksAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/HDRPercentilesAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/TDigestPercentileRanksAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/TDigestPercentilesAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/StatsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/StatsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ExtendedStatsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ExtendedStatsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/sum/SumAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/sum/SumAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/valuecount/ValueCountAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/valuecount/ValueCountAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceAggregatorFactory.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/matrix/stats/MatrixStatsAggregationBuilder.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/matrix/stats/MatrixStatsAggregatorFactory.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/support/MultiValuesSourceAggregationBuilder.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/support/MultiValuesSourceAggregatorFactory.java
comments:
Remove InternalAggregation.Type (#22511)

It is no longer needed. It used to contain a lot of strings
used by serialization but those have since been removed. Now
it is just another thing to pass around that we don't really
need.

time:
2017-01-10T16:54:49Z
class:
core/src/main/java/org/elasticsearch/snapshots/SnapshotShardsService.java
comments:
Use general cluster state batching mechanism for snapshot state updates (#22528)

Relates to #14899

time:
2017-01-10T16:53:04Z
class:
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
comments:
[TEST] Fix JSON generation of failure in InternalTestCluster

Relates to #22387

time:
2017-01-10T16:26:48Z
class:
comments:
Document `must_not` context and scoring (#22532)

Document that `must_not` uses filter context and returns a score of `0`.

time:
2017-01-10T15:33:18Z
class:
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
comments:
Don't use Guava as compile dependency

time:
2017-01-10T15:30:23Z
class:
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ClientScrollableHitSource.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ScrollableHitSource.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
comments:
Fix reindex from remote clearing scroll (#22525)

Reindex-from-remote had a race when it tried to clear the scroll. It
first starts the request to clear the scroll and then submits a task
to the generic threadpool to shutdown the client. These two things
race and, in my experience, closing the scroll generally loses. That
means that most of the time reindex-from-remote isn't clearing the
scrolls that it uses. This isn't the end of the world because we
flush old scroll contexts after a while but this isn't great.

Noticed while experimenting with #22514.

time:
2017-01-10T15:01:31Z
class:
comments:
Fix parent_id example in docs

And fix some indentation I noticed while looking up the query.

time:
2017-01-10T14:55:39Z
class:
comments:
Cluster allocation explain API documentation (#22436)

This commit updates the cluster allocation explain API documentation to
explain the new request parameters and response formats, and gives
examples of the explain API responses under various scenarios.

time:
2017-01-10T14:24:56Z
class:
comments:
Hindu-Arabico-Latino Numerals (#22476)

Hi, same edit as for : https://www.elastic.co/guide/en/elasticsearch/reference/current/analyzer-anatomy.html

time:
2017-01-10T14:14:55Z
class:
core/src/main/java/org/elasticsearch/common/logging/ESLoggerFactory.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/test/java/org/elasticsearch/common/settings/ScopedSettingsTests.java
core/src/test/java/org/elasticsearch/common/settings/SettingTests.java
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/storage/AzureStorageSettings.java
comments:
Allow affix settings to delegate to actual settings (#22523)

Affix settings are useful to namespace a certain setting. Yet, affix settings
must be specialized for their concrete type which causes lot of code duplication.
This commit allows to reuse an existing setting with and affix setting as soon as
a concrete key is available.

time:
2017-01-10T14:00:12Z
class:
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuilders.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuildersTests.java
comments:
Fix source filtering in reindex-from-remote (#22514)

Reindex-from-remote was accepting source filtering in the request
but ignoring it and setting `_source=true` on the search URI. This
fixes the filtering so it is piped through to the remote node and
adds tests for that.

Closes #22507

time:
2017-01-10T13:41:03Z
class:
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
core/src/test/java/org/elasticsearch/index/search/MatchQueryIT.java
comments:
Additional Graph Support in Match Query (#22503)

Make match queries that use phrase prefix or cutoff frequency options
graph aware.

Closes #22490

time:
2017-01-10T13:11:27Z
class:
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
comments:
ZenDiscoveryUnitTests should close objects in reverse order of creation

One needs to close the higher level objects (like UnicastZenPing) before closing the transport service. The latter can throw assertions w.r.t open connections

time:
2017-01-10T13:03:31Z
class:
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
comments:
MockTransportService.doClose assertions should check openConnections under lock

time:
2017-01-10T13:00:04Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/XContentParserUtils.java
core/src/main/java/org/elasticsearch/index/get/GetField.java
core/src/main/java/org/elasticsearch/index/shard/ShardId.java
core/src/main/java/org/elasticsearch/search/SearchHit.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightField.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHits.java
core/src/main/java/org/elasticsearch/search/internal/SearchSortValues.java
core/src/test/java/org/elasticsearch/index/get/GetFieldTests.java
core/src/test/java/org/elasticsearch/index/shard/ShardIdTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightFieldTests.java
core/src/test/java/org/elasticsearch/search/internal/InternalSearchHitTests.java
core/src/test/java/org/elasticsearch/search/internal/InternalSearchHitsTests.java
core/src/test/java/org/elasticsearch/search/internal/SearchSortValuesTests.java
comments:
Add parsing from xContent to InternalSearchHit and InternalSearchHits (#22429)

This adds methods to parse InternalSearchHit and InternalSearchHits from their
xContent representation. Most of the information in the original object is
preserved when rendering the object to xContent and then parsing it back.
However, some pieces of information are lost which we currently cannot parse
back from the rest response, most notably:

* the "match" property of the lucene explanation is not rendered in the
  "_explain" section and cannot be reconstructed on the client side
* the original "shard" information (SearchShardTarget) is only rendered if the
  "explanation" is also set, also we loose the indexUUID of the contained
  ShardId because we don't write it out. As a replacement we can use
  ClusterState.UNKNOWN_UUID on the receiving side

time:
2017-01-10T12:48:07Z
class:
comments:
Docs: Parent field is no longer indexed and should use parent_id instead of term query

Closes #22517

time:
2017-01-10T12:38:34Z
class:
comments:
Update delete-by-query.asciidoc (#22519)

Fixed some grammatical mistakes

time:
2017-01-10T12:29:49Z
class:
core/src/main/java/org/elasticsearch/cluster/NodeConnectionsService.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/NodeConnectionsServiceTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
test/framework/src/main/java/org/elasticsearch/test/ClusterServiceUtils.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
comments:
Keep NodeConnectionsService in sync with current nodes in the cluster state (#22509)

The NodeConnectionsService currently determines which nodes to connect to / disconnect from by inspecting cluster state changes and connecting to added nodes / disconnecting from removed nodes. When a master steps down (for example due to another master-eligible node shutting down which brings the number of master-eligible nodes below minimum_master_master), and the connection to other existing nodes was dropped while pinging, however, the connection to these nodes is not re-established while publishing the first cluster state that establishes the node as master.
This commit changes the NodeConnectionsService connect / disconnect logic to always rely on the state that is to be / was published, looking not only at the added / removed nodes, but validating that exactly all nodes that are currently registered in NodeConnectionsService are connected (corresponds to a NOOP if the node is already connected).

time:
2017-01-10T12:21:03Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
comments:
fix generics warning

time:
2017-01-10T12:17:48Z
class:
comments:
Add a high level description of ES's data replication model (#22327)

This commit adds a document describing our data replication model in high level terms. The goal is give people basic insight into how things work in order to better understand how read and writes interact, both during normal operations and under failures.

time:
2017-01-10T12:12:00Z
class:
core/src/test/java/org/elasticsearch/index/get/GetResultTests.java
comments:
[TESTS] Fix GetResultTests.testGetSourceAsBytes() (#22524)

The document in the randomized GetResult can exist with no source (like if the _source was disabled in mappings), that's why the test should not always expect a non null source when the doc exists.

time:
2017-01-10T10:50:56Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/LongTerms.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorTests.java
comments:
Promote longs to doubles when a terms agg mixes decimal and non-decimal numbers (#22449)

* Promote longs to doubles when a terms agg mixes decimal and non-decimal number

This change makes the terms aggregation work when the buckets coming from different indices are a mix of decimal numbers and non-decimal numbers. In this case non-decimal number (longs) are promoted to decimal (double) which can result in a loss of precision for big numbers.

Fixes #22232

time:
2017-01-10T10:18:27Z
class:
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateRequest.java
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateRequestBuilder.java
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateResponse.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateRequest.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateRequestBuilder.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateResponse.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateSourceBuilder.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolatorPlugin.java
modules/percolator/src/main/java/org/elasticsearch/percolator/RestMultiPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/RestPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportMultiPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportPercolateAction.java
modules/percolator/src/test/java/org/elasticsearch/percolator/MultiPercolatorIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/MultiPercolatorRequestTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorAggregationsIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorClientYamlTestSuiteIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorQuerySearchIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorTestUtil.java
comments:
percolator: remove deprecated percolate and mpercolate apis

time:
2017-01-10T08:57:57Z
class:
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
comments:
Fixing the error message to report the number of docs correctly for each node (#22515)

There is a bug in the error message that is thrown if the number of docs differs between the source and target shards when recovering a shard with a syncId. The source and target doc counts are swapped around.

Closes #21893

time:
2017-01-10T08:45:33Z
class:
comments:
[TESTS] Create vagrant up task for all boxes (#22496)

Currently, such tasks are only created for default boxes (centos-7, ubuntu-1404) and not all boxes and this can be misleading for developers who want to debug testing scripts on non-default boxes.

time:
2017-01-09T23:30:58Z
class:
core/src/main/java/org/elasticsearch/plugins/SearchPlugin.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/SearchRequestParsers.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/SuggestBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/Suggester.java
core/src/main/java/org/elasticsearch/search/suggest/Suggesters.java
core/src/main/java/org/elasticsearch/search/suggest/SuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggester.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/completion/FuzzyOptions.java
core/src/main/java/org/elasticsearch/search/suggest/completion/RegexOptions.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGeneratorBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/Laplace.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/LinearInterpolation.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggester.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/SmoothingModel.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/StupidBackoff.java
core/src/main/java/org/elasticsearch/search/suggest/term/TermSuggester.java
core/src/main/java/org/elasticsearch/search/suggest/term/TermSuggestionBuilder.java
core/src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
core/src/test/java/org/elasticsearch/search/suggest/AbstractSuggestionBuilderTestCase.java
core/src/test/java/org/elasticsearch/search/suggest/CustomSuggester.java
core/src/test/java/org/elasticsearch/search/suggest/CustomSuggesterPlugin.java
core/src/test/java/org/elasticsearch/search/suggest/CustomSuggesterSearchIT.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestBuilderTests.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGeneratorTests.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/LaplaceModelTests.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/LinearInterpolationModelTests.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/SmoothingModelTestCase.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/StupidBackoffModelTests.java
core/src/test/java/org/elasticsearch/search/suggest/term/TermSuggestionBuilderTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportPercolateAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RestReindexActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
comments:
Merge branch 'master' into enhancement/use_shard_bulk_for_single_ops

time:
2017-01-09T21:51:08Z
class:
core/src/main/java/org/elasticsearch/plugins/SearchPlugin.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/SearchRequestParsers.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/SuggestBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/Suggester.java
core/src/main/java/org/elasticsearch/search/suggest/Suggesters.java
core/src/main/java/org/elasticsearch/search/suggest/SuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggester.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/completion/FuzzyOptions.java
core/src/main/java/org/elasticsearch/search/suggest/completion/RegexOptions.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGeneratorBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/Laplace.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/LinearInterpolation.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggester.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/SmoothingModel.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/StupidBackoff.java
core/src/main/java/org/elasticsearch/search/suggest/term/TermSuggester.java
core/src/main/java/org/elasticsearch/search/suggest/term/TermSuggestionBuilder.java
core/src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
core/src/test/java/org/elasticsearch/search/suggest/AbstractSuggestionBuilderTestCase.java
core/src/test/java/org/elasticsearch/search/suggest/CustomSuggester.java
core/src/test/java/org/elasticsearch/search/suggest/CustomSuggesterPlugin.java
core/src/test/java/org/elasticsearch/search/suggest/CustomSuggesterSearchIT.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestBuilderTests.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGeneratorTests.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/LaplaceModelTests.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/LinearInterpolationModelTests.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/SmoothingModelTestCase.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/StupidBackoffModelTests.java
core/src/test/java/org/elasticsearch/search/suggest/term/TermSuggestionBuilderTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportPercolateAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RestReindexActionTests.java
comments:
Replace Suggesters with namedObject (#22491)

Removes another parser registery type thing in favor of
`XContentParser#namedObject`.

time:
2017-01-09T21:29:59Z
class:
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
comments:
Fix test under windows

Silly `\r`.

time:
2017-01-09T21:22:00Z
class:
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/SearchRequestParsers.java
core/src/main/java/org/elasticsearch/search/aggregations/AbstractAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorFactories.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorParsers.java
core/src/main/java/org/elasticsearch/search/aggregations/BaseAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/PipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/AbstractPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregationCollectorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorFactoriesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorParsingTests.java
core/src/test/java/org/elasticsearch/search/aggregations/BaseAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/BasePipelineAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/ExtendedStatsBucketTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/PercentilesBucketTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/moving/avg/MovAvgTests.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportMultiPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportPercolateAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RestReindexActionTests.java
comments:
Merge branch 'master' into enhancement/use_shard_bulk_for_single_ops

time:
2017-01-09T20:27:09Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
comments:
first review round

time:
2017-01-09T20:17:50Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
comments:
fix typo

time:
2017-01-09T20:13:49Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorParsers.java
comments:
Remove AggregatorParsers

Meant to remove it with e3f77b4795c27d85c52fd7beabb9ccc8c1f5c307.
It is no longer used.

time:
2017-01-09T18:59:38Z
class:
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/SearchRequestParsers.java
core/src/main/java/org/elasticsearch/search/aggregations/AbstractAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorFactories.java
core/src/main/java/org/elasticsearch/search/aggregations/BaseAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/PipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/AbstractPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregationCollectorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorFactoriesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorParsingTests.java
core/src/test/java/org/elasticsearch/search/aggregations/BaseAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/BasePipelineAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/ExtendedStatsBucketTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/PercentilesBucketTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/moving/avg/MovAvgTests.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportMultiPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportPercolateAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RestReindexActionTests.java
comments:
Replace AggregatorParsers with namedObject (#22397)

Removes `AggregatorParsers`, replacing all of its functionality with
`XContentParser#namedObject`.

This is the third bit of payoff from #22003, one less thing to pass
around the entire application.

time:
2017-01-09T18:44:14Z
class:
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/RestNoopBulkAction.java
client/rest-high-level/src/main/java/org/elasticsearch/client/RestHighLevelClient.java
client/rest-high-level/src/test/java/org/elasticsearch/client/ESRestHighLevelClientTestCase.java
client/rest-high-level/src/test/java/org/elasticsearch/client/MainActionIT.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RestHighLevelClientTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientMultipleHostsIntegTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostIntegTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostTests.java
client/sniffer/src/test/java/org/elasticsearch/client/sniff/ElasticsearchHostsSnifferTests.java
client/test/src/main/java/org/elasticsearch/client/RestClientTestCase.java
client/test/src/main/java/org/elasticsearch/client/RestClientTestUtil.java
client/transport/src/main/java/org/elasticsearch/transport/client/PreBuiltTransportClient.java
core/src/main/java/org/apache/lucene/analysis/synonym/GraphTokenStreamFiniteStrings.java
core/src/main/java/org/apache/lucene/analysis/synonym/SynonymGraphFilter.java
core/src/main/java/org/apache/lucene/search/GraphQuery.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplanation.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/NodeExplanation.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/TransportClusterAllocationExplainAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/GetTaskResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/list/ListTasksResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/repositories/verify/VerifyRepositoryResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/create/CreateSnapshotResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/delete/TransportDeleteSnapshotAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/GetSnapshotsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/TransportGetSnapshotsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/RestoreSnapshotResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/SnapshotsStatusResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/TransportSnapshotsStatusAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/tasks/PendingClusterTasksResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetMappingsResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/get/GetIndexTemplatesResponse.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/delete/DeleteResponse.java
core/src/main/java/org/elasticsearch/action/get/GetResponse.java
core/src/main/java/org/elasticsearch/action/get/MultiGetResponse.java
core/src/main/java/org/elasticsearch/action/index/IndexResponse.java
core/src/main/java/org/elasticsearch/action/ingest/GetPipelineResponse.java
core/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineResponse.java
core/src/main/java/org/elasticsearch/action/search/ClearScrollResponse.java
core/src/main/java/org/elasticsearch/action/search/MultiSearchResponse.java
core/src/main/java/org/elasticsearch/action/search/SearchRequest.java
core/src/main/java/org/elasticsearch/action/search/SearchResponse.java
core/src/main/java/org/elasticsearch/action/search/SearchType.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationResponse.java
core/src/main/java/org/elasticsearch/action/termvectors/MultiTermVectorsResponse.java
core/src/main/java/org/elasticsearch/action/termvectors/TermVectorsResponse.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateResponse.java
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapException.java
core/src/main/java/org/elasticsearch/bootstrap/Elasticsearch.java
core/src/main/java/org/elasticsearch/cli/Terminal.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/cluster/AbstractDiffable.java
core/src/main/java/org/elasticsearch/cluster/AbstractNamedDiffable.java
core/src/main/java/org/elasticsearch/cluster/ClusterModule.java
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateTaskExecutor.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateUpdateTask.java
core/src/main/java/org/elasticsearch/cluster/Diffable.java
core/src/main/java/org/elasticsearch/cluster/DiffableUtils.java
core/src/main/java/org/elasticsearch/cluster/LocalClusterUpdateTask.java
core/src/main/java/org/elasticsearch/cluster/NamedDiff.java
core/src/main/java/org/elasticsearch/cluster/NamedDiffable.java
core/src/main/java/org/elasticsearch/cluster/NamedDiffableValueSerializer.java
core/src/main/java/org/elasticsearch/cluster/RestoreInProgress.java
core/src/main/java/org/elasticsearch/cluster/SnapshotDeletionsInProgress.java
core/src/main/java/org/elasticsearch/cluster/SnapshotsInProgress.java
core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java
core/src/main/java/org/elasticsearch/cluster/block/ClusterBlocks.java
core/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexGraveyard.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MappingMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java
core/src/main/java/org/elasticsearch/cluster/metadata/RepositoriesMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/RepositoryMetaData.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodes.java
core/src/main/java/org/elasticsearch/cluster/routing/IndexRoutingTable.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AbstractAllocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocateUnassignedDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/MoveDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RoutingAllocation.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/ShardAllocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/ShardsAllocator.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/AllocationCommandRegistry.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/AllocationCommands.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AllocationDeciders.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/Decision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/EnableAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/common/ParseFieldMatcher.java
core/src/main/java/org/elasticsearch/common/Strings.java
core/src/main/java/org/elasticsearch/common/compress/CompressorFactory.java
core/src/main/java/org/elasticsearch/common/io/stream/NamedWriteableAwareStreamInput.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java
core/src/main/java/org/elasticsearch/common/logging/DeprecationLogger.java
core/src/main/java/org/elasticsearch/common/lucene/ShardCoreKeyMap.java
core/src/main/java/org/elasticsearch/common/network/IfConfig.java
core/src/main/java/org/elasticsearch/common/network/NetworkModule.java
core/src/main/java/org/elasticsearch/common/network/NetworkService.java
core/src/main/java/org/elasticsearch/common/settings/AddStringKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/CreateKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/KeyStoreCli.java
core/src/main/java/org/elasticsearch/common/settings/KeyStoreWrapper.java
core/src/main/java/org/elasticsearch/common/settings/ListKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/RemoveSettingKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/SecureSetting.java
core/src/main/java/org/elasticsearch/common/settings/SecureString.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/main/java/org/elasticsearch/common/util/IndexFolderUpgrader.java
core/src/main/java/org/elasticsearch/common/xcontent/AbstractObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ConstructingObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ParseFieldRegistry.java
core/src/main/java/org/elasticsearch/common/xcontent/StatusToXContentObject.java
core/src/main/java/org/elasticsearch/common/xcontent/ToXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/ToXContentObject.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentHelper.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/zen/MembershipAction.java
core/src/main/java/org/elasticsearch/discovery/zen/NodeJoinController.java
core/src/main/java/org/elasticsearch/discovery/zen/PublishClusterStateAction.java
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/env/NodeEnvironment.java
core/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java
core/src/main/java/org/elasticsearch/gateway/LocalAllocateDangledIndices.java
core/src/main/java/org/elasticsearch/gateway/MetaDataStateFormat.java
core/src/main/java/org/elasticsearch/gateway/MetaStateService.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/TransportNodesListGatewayMetaState.java
core/src/main/java/org/elasticsearch/gateway/TransportNodesListGatewayStartedShards.java
core/src/main/java/org/elasticsearch/index/Index.java
core/src/main/java/org/elasticsearch/index/analysis/AnalysisRegistry.java
core/src/main/java/org/elasticsearch/index/analysis/CustomAnalyzer.java
core/src/main/java/org/elasticsearch/index/analysis/CustomNormalizerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/IndexAnalyzers.java
core/src/main/java/org/elasticsearch/index/analysis/SynonymGraphTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/ShadowEngine.java
core/src/main/java/org/elasticsearch/index/get/GetResult.java
core/src/main/java/org/elasticsearch/index/mapper/BaseGeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/CompletionFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java
core/src/main/java/org/elasticsearch/index/mapper/GeoShapeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/KeywordFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/Mapper.java
core/src/main/java/org/elasticsearch/index/mapper/NumberFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ParentFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/RangeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/BoolQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/BoostingQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ConstantScoreQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/DisMaxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ExistsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/FieldMaskingSpanQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/FuzzyQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoPolygonQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoShapeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/HasChildQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/HasParentQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchNoneQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchPhrasePrefixQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchPhraseQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/NestedQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ParentIdQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/PrefixQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryParseContext.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/RangeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/RegexpQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanContainingQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanFirstQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanMultiTermQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanNearQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanNotQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanOrQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanTermQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanWithinQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TermQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TypeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/WildcardQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/WrapperQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/DecayFunctionParser.java
core/src/main/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java
core/src/main/java/org/elasticsearch/index/query/support/QueryParsers.java
core/src/main/java/org/elasticsearch/index/refresh/RefreshStats.java
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointService.java
core/src/main/java/org/elasticsearch/index/seqno/LocalCheckpointService.java
core/src/main/java/org/elasticsearch/index/seqno/SeqNoStats.java
core/src/main/java/org/elasticsearch/index/seqno/SequenceNumbersService.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/RefreshListeners.java
core/src/main/java/org/elasticsearch/index/shard/ShardPath.java
core/src/main/java/org/elasticsearch/index/shard/TranslogRecoveryPerformer.java
core/src/main/java/org/elasticsearch/index/snapshots/blobstore/BlobStoreIndexShardSnapshot.java
core/src/main/java/org/elasticsearch/index/snapshots/blobstore/BlobStoreIndexShardSnapshots.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveriesCollection.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySettings.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
core/src/main/java/org/elasticsearch/indices/recovery/SharedFSRecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/store/IndicesStore.java
core/src/main/java/org/elasticsearch/indices/store/TransportNodesListShardStoreMetaData.java
core/src/main/java/org/elasticsearch/ingest/ConfigurationUtils.java
core/src/main/java/org/elasticsearch/ingest/IngestMetadata.java
core/src/main/java/org/elasticsearch/ingest/PipelineConfiguration.java
comments:
Merge branch 'master' into enhancement/use_shard_bulk_for_single_ops

time:
2017-01-09T17:30:19Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
comments:
fix typo in RemoteClusterConnection javadocs

time:
2017-01-09T17:26:57Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/AllocationCommandRegistry.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/AllocationCommands.java
core/src/main/java/org/elasticsearch/common/network/NetworkModule.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterRerouteAction.java
core/src/test/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteRequestTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AllocationCommandsTests.java
comments:
Use namedObject to parse AllocationCommands (#22489)

This removes `AllocationCommandRegistry` entirely and replaces
it with `XContentParser#namedObject`, removing another class from
guice.

time:
2017-01-09T17:22:11Z
class:
comments:
fix another typo in the docs

time:
2017-01-09T17:17:43Z
class:
comments:
fix couple of typos in the docs

time:
2017-01-09T17:14:26Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/transport/TransportActionProxy.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
comments:
adjust some javadocs and methods visibility

time:
2017-01-09T16:50:20Z
class:
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
comments:
Remove content-type detection from reindex-from-remote (#22504)

If the remote doesn't return a content type then reindex
tried to guess the content-type. This didn't work most
of the time and produced a rather useless error message.
Given that Elasticsearch always returns the content-type
we are dropping content-type detection in favor of just
failing the request if the remote didn't return a content-type.

Closes #22329

time:
2017-01-09T16:42:28Z
class:
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
comments:
UnicastZenPingTests didn't properly wait for pinging rounds to be closed

The test ping and waited for the ping results to be returned but since we first return the result and then close temporary connections, assertions are tripped that expects all connections to close by end of test .

Closes #22497

time:
2017-01-09T16:36:27Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
comments:
Adjust RemoteClusterConnection javadocs

time:
2017-01-09T16:36:27Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
comments:
Adjust RemoteClusterService javadocs

time:
2017-01-09T16:34:18Z
class:
core/src/main/java/org/elasticsearch/transport/TransportActionProxy.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterConnectionTests.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
comments:
add missing license, forbidden API suppression and line length

time:
2017-01-09T16:17:34Z
class:
core/src/main/java/org/elasticsearch/index/query/HasChildQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/HasParentQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/NestedQueryBuilder.java
core/src/test/java/org/elasticsearch/index/query/HasChildQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/HasParentQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/NestedQueryBuilderTests.java
comments:
Don't ignore `ignore_unmapped` options on nested, has_child and has_parent queries if the wrapped query gets rewritten.

time:
2017-01-09T16:01:57Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponse.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
comments:
Fix line length

time:
2017-01-09T14:19:05Z
class:
core/src/main/java/org/elasticsearch/common/compress/CompressorFactory.java
core/src/main/java/org/elasticsearch/index/get/GetResult.java
core/src/test/java/org/elasticsearch/index/get/GetResultTests.java
comments:
prevent NPE when calling GetResponse#getSourceAsBytesRef

This commit checks for a null BytesReference as the value for `source`
in GetResult#sourceRef and simply returns null. Previously this would
have resulted in a NPE. While this does seem internal at first glance, it can affect
user code as a GetResponse could trigger this when the document is missing.

Additionally, the CompressorFactory#uncompressIfNeeded now requires a
non-null argument.

time:
2017-01-09T13:35:54Z
class:
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/SearchPlugin.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/search/SearchExtBuilder.java
core/src/main/java/org/elasticsearch/search/SearchExtParser.java
core/src/main/java/org/elasticsearch/search/SearchExtRegistry.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/SearchRequestParsers.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
core/src/test/java/org/elasticsearch/search/AbstractSearchTestCase.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
core/src/test/java/org/elasticsearch/search/fetch/FetchSubPhasePluginIT.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportMultiPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportPercolateAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RestReindexActionTests.java
comments:
Replace SearchExtRegistry with namedObject (#22492)

This is one of the last things in `SearchRequestParsers`.

time:
2017-01-09T11:09:23Z
class:
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/RestNoopBulkAction.java
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/GetTaskResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/list/ListTasksResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/repositories/verify/VerifyRepositoryResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/create/CreateSnapshotResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/GetSnapshotsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/TransportGetSnapshotsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/RestoreSnapshotResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/SnapshotsStatusResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/TransportSnapshotsStatusAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/tasks/PendingClusterTasksResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/get/GetIndexTemplatesResponse.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/main/java/org/elasticsearch/action/delete/DeleteResponse.java
core/src/main/java/org/elasticsearch/action/get/GetResponse.java
core/src/main/java/org/elasticsearch/action/get/MultiGetResponse.java
core/src/main/java/org/elasticsearch/action/index/IndexResponse.java
core/src/main/java/org/elasticsearch/action/ingest/GetPipelineResponse.java
core/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineResponse.java
core/src/main/java/org/elasticsearch/action/search/ClearScrollResponse.java
core/src/main/java/org/elasticsearch/action/search/MultiSearchResponse.java
core/src/main/java/org/elasticsearch/action/search/SearchResponse.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationResponse.java
core/src/main/java/org/elasticsearch/action/termvectors/MultiTermVectorsResponse.java
core/src/main/java/org/elasticsearch/action/termvectors/TermVectorsResponse.java
core/src/main/java/org/elasticsearch/action/update/UpdateResponse.java
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapException.java
core/src/main/java/org/elasticsearch/bootstrap/Elasticsearch.java
core/src/main/java/org/elasticsearch/cli/Terminal.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/common/Strings.java
core/src/main/java/org/elasticsearch/common/network/IfConfig.java
core/src/main/java/org/elasticsearch/common/network/NetworkService.java
core/src/main/java/org/elasticsearch/common/settings/AddStringKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/CreateKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/KeyStoreCli.java
core/src/main/java/org/elasticsearch/common/settings/KeyStoreWrapper.java
core/src/main/java/org/elasticsearch/common/settings/ListKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/RemoveSettingKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/SecureSetting.java
core/src/main/java/org/elasticsearch/common/settings/SecureString.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/main/java/org/elasticsearch/common/xcontent/StatusToXContentObject.java
core/src/main/java/org/elasticsearch/common/xcontent/ToXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/ToXContentObject.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentHelper.java
core/src/main/java/org/elasticsearch/index/get/GetResult.java
core/src/main/java/org/elasticsearch/index/refresh/RefreshStats.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/RefreshListeners.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/SharedFSRecoverySourceHandler.java
core/src/main/java/org/elasticsearch/node/internal/InternalSettingsPreparer.java
core/src/main/java/org/elasticsearch/repositories/RepositoryData.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/rest/action/RestStatusToXContentListener.java
core/src/main/java/org/elasticsearch/rest/action/RestToXContentListener.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestIndicesAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestNodesAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestShardsAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestBulkAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestGetAction.java
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/snapshots/RestoreService.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotInfo.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotState.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java
core/src/test/java/org/elasticsearch/action/DocWriteResponseTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/create/CreateIndexIT.java
core/src/test/java/org/elasticsearch/action/admin/indices/create/ShrinkIndexIT.java
core/src/test/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsTests.java
core/src/test/java/org/elasticsearch/action/get/GetResponseTests.java
core/src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationResponseTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/action/termvectors/GetTermVectorsCheckDocFreqIT.java
core/src/test/java/org/elasticsearch/action/termvectors/GetTermVectorsIT.java
core/src/test/java/org/elasticsearch/bootstrap/ElasticsearchCliTests.java
core/src/test/java/org/elasticsearch/cli/TerminalTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexServiceTests.java
core/src/test/java/org/elasticsearch/cluster/serialization/ClusterStateToStringTests.java
core/src/test/java/org/elasticsearch/common/StringsTests.java
core/src/test/java/org/elasticsearch/common/settings/AddStringKeyStoreCommandTests.java
core/src/test/java/org/elasticsearch/common/settings/CreateKeyStoreCommandTests.java
core/src/test/java/org/elasticsearch/common/settings/KeyStoreCommandTestCase.java
core/src/test/java/org/elasticsearch/common/settings/ListKeyStoreCommandTests.java
core/src/test/java/org/elasticsearch/common/settings/RemoveSettingKeyStoreCommandTests.java
core/src/test/java/org/elasticsearch/common/xcontent/support/XContentHelperTests.java
core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java
core/src/test/java/org/elasticsearch/index/get/GetFieldTests.java
core/src/test/java/org/elasticsearch/index/get/GetResultTests.java
core/src/test/java/org/elasticsearch/index/refresh/RefreshStatsTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
core/src/test/java/org/elasticsearch/repositories/RepositoryDataTests.java
core/src/test/java/org/elasticsearch/repositories/blobstore/BlobStoreRepositoryTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/AbstractGeoTestCase.java
core/src/test/java/org/elasticsearch/search/internal/SearchSortValuesTests.java
core/src/test/java/org/elasticsearch/search/scroll/SearchScrollIT.java
distribution/integ-test-zip/src/test/java/org/elasticsearch/test/rest/WaitForRefreshAndCloseTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MultiSearchTemplateResponse.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/SearchTemplateResponse.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/EnhancedPainlessLexer.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/PainlessLexer.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/Walker.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/BasicExpressionTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/WhenThingsGoWrongTests.java
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateResponse.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateResponse.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImpl.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
qa/backwards-5.0/src/test/java/org/elasticsearch/backwards/IndexingIT.java
qa/evil-tests/src/test/java/org/elasticsearch/bootstrap/EvilElasticsearchCliTests.java
test/framework/src/main/java/org/elasticsearch/bootstrap/BootstrapForTesting.java
test/framework/src/main/java/org/elasticsearch/bootstrap/ESElasticsearchCliTestCase.java
test/framework/src/main/java/org/elasticsearch/test/AbstractStreamableTestCase.java
comments:
Merge branch 'master' into feature/multi_cluster_search

time:
2017-01-08T13:21:02Z
class:
comments:
[TEST] Fixed the incorrect indentation for the `skip` clauses in the REST tests

This patch fixes the incorrect indentation in the REST tests, which makes tests in language runners (eg. Ruby, Python) to fail, since the skip clause is parsed as an empty value. Tha Java YAML parser is smarter/lenient about whitespace, so it doesn't catch this.

time:
2017-01-08T11:18:52Z
class:
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/SharedFSRecoverySourceHandler.java
core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java
comments:
Fix primary relocation for shadow replicas (#22474)

The recovery process started during primary relocation of shadow replicas accesses the engine on the source shard after it's been closed, which results in the source shard failing itself.

time:
2017-01-07T01:37:35Z
class:
comments:
Fixes 5.3.0-SNAPSHOT typo

time:
2017-01-07T01:36:38Z
class:
comments:
Updates backwards compatibility 5.0 tests to pull
the latest 5.x version - 5.3.0-SNAPSHOT

time:
2017-01-07T01:03:32Z
class:
core/src/main/java/org/elasticsearch/index/refresh/RefreshStats.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/RefreshListeners.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestIndicesAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestNodesAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestShardsAction.java
core/src/test/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/index/refresh/RefreshStatsTests.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
distribution/integ-test-zip/src/test/java/org/elasticsearch/test/rest/WaitForRefreshAndCloseTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractStreamableTestCase.java
comments:
Close and flush refresh listeners on shard close

Right now closing a shard looks like it strands refresh listeners,
causing tests like
`delete/50_refresh/refresh=wait_for waits until changes are visible in search`
to fail. Here is a build that fails:
https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+multi_cluster_search+multijob-darwin-compatibility/4/console

This attempts to fix the problem by implements `Closeable` on
`RefreshListeners` and rejecting listeners when closed. More importantly
the act of closing the instance flushes all pending listeners
so we shouldn't have any stranded listeners on close.

Because it was needed for testing, this also adds the number of
pending listeners to the `CommonStats` object and all API to which
that flows: `_cat/nodes`, `_cat/indices`, `_cat/shards`, and
`_nodes/stats`.

time:
2017-01-06T22:52:10Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/TransportGetSnapshotsAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/TransportSnapshotsStatusAction.java
core/src/main/java/org/elasticsearch/repositories/RepositoryData.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/snapshots/RestoreService.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotInfo.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotState.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/repositories/RepositoryDataTests.java
core/src/test/java/org/elasticsearch/repositories/blobstore/BlobStoreRepositoryTests.java
comments:
Gracefully handles pre 2.x compressed snapshots

In pre 2.x versions, if the repository was set to compress snapshots,
then snapshots would be compressed with the LZF algorithm.  In 5.x,
Elasticsearch no longer supports the LZF compression algorithm.  This
presents an issue when retrieving snapshots in a repository or upgrading
repository data to the 5.x version, because Elasticsearch throws an
exception when it tries to read the snapshot metadata because it was
compressed using LZF.

This commit gracefully handles the situation by introducing a new
incompatible-snapshots blob to the repository.  For any pre-2.x snapshot
that cannot be read, that snapshot is removed from the list of active
snapshots, because the snapshot could not be restored anyway.  Instead,
the snapshot is recorded in the incompatible-snapshots blob.  When
listing snapshots, both active snapshots and incompatible snapshots will
be listed, with incompatible snapshots showing a `INCOMPATIBLE` state.
Any attempt to restore an incompatible snapshot will result in an
exception.

time:
2017-01-06T22:31:48Z
class:
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/RestNoopBulkAction.java
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthResponse.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/main/java/org/elasticsearch/action/ingest/GetPipelineResponse.java
core/src/main/java/org/elasticsearch/action/search/ClearScrollResponse.java
core/src/main/java/org/elasticsearch/action/search/SearchResponse.java
core/src/main/java/org/elasticsearch/common/xcontent/StatusToXContentObject.java
core/src/main/java/org/elasticsearch/rest/action/RestStatusToXContentListener.java
core/src/main/java/org/elasticsearch/rest/action/RestToXContentListener.java
core/src/main/java/org/elasticsearch/rest/action/document/RestBulkAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/SearchTemplateResponse.java
comments:
Make StatusToXContent extend ToXContentObject and rename it to StatusToXContentObject

This also allows to make RestToXContentListener require ToXContentObject rather than ToXContent

time:
2017-01-06T22:31:48Z
class:
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateResponse.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateResponse.java
comments:
Make PercolateResponse a ToXContentObject

time:
2017-01-06T22:31:48Z
class:
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/main/java/org/elasticsearch/action/delete/DeleteResponse.java
core/src/main/java/org/elasticsearch/action/index/IndexResponse.java
core/src/main/java/org/elasticsearch/action/update/UpdateResponse.java
core/src/test/java/org/elasticsearch/action/DocWriteResponseTests.java
comments:
Make DocWriteResponse a ToXContentObject

This involved changing also index, delete, update so that bulk can print them out in its own format.

time:
2017-01-06T22:31:48Z
class:
core/src/main/java/org/elasticsearch/action/search/MultiSearchResponse.java
core/src/main/java/org/elasticsearch/action/search/SearchResponse.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/AbstractGeoTestCase.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MultiSearchTemplateResponse.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/SearchTemplateResponse.java
comments:
Make SearchResponse a ToXContentObject

time:
2017-01-06T22:31:48Z
class:
core/src/main/java/org/elasticsearch/action/termvectors/MultiTermVectorsResponse.java
core/src/main/java/org/elasticsearch/action/termvectors/TermVectorsResponse.java
core/src/test/java/org/elasticsearch/action/termvectors/GetTermVectorsCheckDocFreqIT.java
core/src/test/java/org/elasticsearch/action/termvectors/GetTermVectorsIT.java
comments:
Make TermVectorsResponse a ToXContentObject

time:
2017-01-06T22:31:48Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/GetTaskResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/list/ListTasksResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/repositories/verify/VerifyRepositoryResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/create/CreateSnapshotResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/GetSnapshotsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/RestoreSnapshotResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/SnapshotsStatusResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/tasks/PendingClusterTasksResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/get/GetIndexTemplatesResponse.java
core/src/main/java/org/elasticsearch/action/get/GetResponse.java
core/src/main/java/org/elasticsearch/action/get/MultiGetResponse.java
core/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineResponse.java
core/src/main/java/org/elasticsearch/action/search/ClearScrollResponse.java
core/src/main/java/org/elasticsearch/action/search/MultiSearchResponse.java
core/src/main/java/org/elasticsearch/action/termvectors/MultiTermVectorsResponse.java
core/src/main/java/org/elasticsearch/index/get/GetResult.java
core/src/main/java/org/elasticsearch/script/Script.java
core/src/test/java/org/elasticsearch/action/get/GetResponseTests.java
core/src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
core/src/test/java/org/elasticsearch/index/get/GetResultTests.java
core/src/test/java/org/elasticsearch/search/scroll/SearchScrollIT.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MultiSearchTemplateResponse.java
comments:
Migrate some more responses to ToXContentObject

time:
2017-01-06T22:31:48Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/list/ListTasksResponse.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/main/java/org/elasticsearch/action/get/GetResponse.java
core/src/main/java/org/elasticsearch/action/index/IndexResponse.java
core/src/main/java/org/elasticsearch/action/ingest/GetPipelineResponse.java
core/src/main/java/org/elasticsearch/action/search/ClearScrollResponse.java
core/src/main/java/org/elasticsearch/action/search/SearchResponse.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationResponse.java
core/src/main/java/org/elasticsearch/common/Strings.java
core/src/main/java/org/elasticsearch/common/xcontent/ToXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/ToXContentObject.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentHelper.java
core/src/main/java/org/elasticsearch/rest/action/RestStatusToXContentListener.java
core/src/main/java/org/elasticsearch/rest/action/RestToXContentListener.java
core/src/main/java/org/elasticsearch/rest/action/document/RestGetAction.java
core/src/test/java/org/elasticsearch/action/get/GetResponseTests.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationResponseTests.java
core/src/test/java/org/elasticsearch/cluster/serialization/ClusterStateToStringTests.java
core/src/test/java/org/elasticsearch/common/StringsTests.java
core/src/test/java/org/elasticsearch/common/xcontent/support/XContentHelperTests.java
core/src/test/java/org/elasticsearch/index/get/GetFieldTests.java
core/src/test/java/org/elasticsearch/index/get/GetResultTests.java
core/src/test/java/org/elasticsearch/search/internal/SearchSortValuesTests.java
qa/backwards-5.0/src/test/java/org/elasticsearch/backwards/IndexingIT.java
comments:
introduce ToXContentObject interface

`ToXContentObject` extends `ToXContent` without adding new methods to it, while allowing to mark classes that output complete xcontent objects to distinguish them from classes that require starting and ending an anonymous object externally.

Ideally ToXContent would be renamed to ToXContentFragment, but that would be a huge change in our codebase, hence we simply document the fact that toXContent outputs fragments with no guarantees that the output is valid per se without an external ancestor.

Relates to #16347

time:
2017-01-06T22:27:08Z
class:
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImpl.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
comments:
Add support for ca-central-1 region to EC2 and S3 plugins

Closes #22458 #22454

time:
2017-01-06T20:03:45Z
class:
comments:
Merge pull request #22443 from rjernst/disable_assertions

Use tests.asserts flag to allow disabling assertions

time:
2017-01-06T19:48:17Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapException.java
core/src/main/java/org/elasticsearch/bootstrap/Elasticsearch.java
core/src/main/java/org/elasticsearch/cli/Terminal.java
core/src/main/java/org/elasticsearch/common/settings/AddStringKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/CreateKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/KeyStoreCli.java
core/src/main/java/org/elasticsearch/common/settings/KeyStoreWrapper.java
core/src/main/java/org/elasticsearch/common/settings/ListKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/RemoveSettingKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/SecureSetting.java
core/src/main/java/org/elasticsearch/common/settings/SecureString.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/main/java/org/elasticsearch/node/internal/InternalSettingsPreparer.java
core/src/test/java/org/elasticsearch/bootstrap/ElasticsearchCliTests.java
core/src/test/java/org/elasticsearch/cli/TerminalTests.java
core/src/test/java/org/elasticsearch/common/settings/AddStringKeyStoreCommandTests.java
core/src/test/java/org/elasticsearch/common/settings/CreateKeyStoreCommandTests.java
core/src/test/java/org/elasticsearch/common/settings/KeyStoreCommandTestCase.java
core/src/test/java/org/elasticsearch/common/settings/ListKeyStoreCommandTests.java
core/src/test/java/org/elasticsearch/common/settings/RemoveSettingKeyStoreCommandTests.java
qa/evil-tests/src/test/java/org/elasticsearch/bootstrap/EvilElasticsearchCliTests.java
test/framework/src/main/java/org/elasticsearch/bootstrap/ESElasticsearchCliTestCase.java
comments:
Merge pull request #22335 from rjernst/keystore

Settings: Add infrastructure for elasticsearch keystore

time:
2017-01-06T17:32:08Z
class:
client/rest-high-level/src/main/java/org/elasticsearch/client/RestHighLevelClient.java
client/rest-high-level/src/test/java/org/elasticsearch/client/ESRestHighLevelClientTestCase.java
client/rest-high-level/src/test/java/org/elasticsearch/client/MainActionIT.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RestHighLevelClientTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientMultipleHostsIntegTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostIntegTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostTests.java
client/sniffer/src/test/java/org/elasticsearch/client/sniff/ElasticsearchHostsSnifferTests.java
client/test/src/main/java/org/elasticsearch/client/RestClientTestCase.java
client/test/src/main/java/org/elasticsearch/client/RestClientTestUtil.java
client/transport/src/main/java/org/elasticsearch/transport/client/PreBuiltTransportClient.java
core/src/main/java/org/apache/lucene/analysis/synonym/GraphTokenStreamFiniteStrings.java
core/src/main/java/org/apache/lucene/analysis/synonym/SynonymGraphFilter.java
core/src/main/java/org/apache/lucene/search/GraphQuery.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplanation.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/NodeExplanation.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/TransportClusterAllocationExplainAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/delete/TransportDeleteSnapshotAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetMappingsResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/get/GetIndexTemplatesResponse.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/ingest/GetPipelineResponse.java
core/src/main/java/org/elasticsearch/action/search/SearchRequest.java
core/src/main/java/org/elasticsearch/action/search/SearchType.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/cluster/AbstractDiffable.java
core/src/main/java/org/elasticsearch/cluster/AbstractNamedDiffable.java
core/src/main/java/org/elasticsearch/cluster/ClusterModule.java
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateTaskExecutor.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateUpdateTask.java
core/src/main/java/org/elasticsearch/cluster/Diffable.java
core/src/main/java/org/elasticsearch/cluster/DiffableUtils.java
core/src/main/java/org/elasticsearch/cluster/LocalClusterUpdateTask.java
core/src/main/java/org/elasticsearch/cluster/NamedDiff.java
core/src/main/java/org/elasticsearch/cluster/NamedDiffable.java
core/src/main/java/org/elasticsearch/cluster/NamedDiffableValueSerializer.java
core/src/main/java/org/elasticsearch/cluster/RestoreInProgress.java
core/src/main/java/org/elasticsearch/cluster/SnapshotDeletionsInProgress.java
core/src/main/java/org/elasticsearch/cluster/SnapshotsInProgress.java
core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java
core/src/main/java/org/elasticsearch/cluster/block/ClusterBlocks.java
core/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexGraveyard.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MappingMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java
core/src/main/java/org/elasticsearch/cluster/metadata/RepositoriesMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/RepositoryMetaData.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodes.java
core/src/main/java/org/elasticsearch/cluster/routing/IndexRoutingTable.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AbstractAllocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocateUnassignedDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/MoveDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RoutingAllocation.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/ShardAllocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/ShardsAllocator.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/AllocationCommands.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AllocationDeciders.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/Decision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/EnableAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/common/ParseFieldMatcher.java
core/src/main/java/org/elasticsearch/common/io/stream/NamedWriteableAwareStreamInput.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java
core/src/main/java/org/elasticsearch/common/logging/DeprecationLogger.java
core/src/main/java/org/elasticsearch/common/network/IfConfig.java
core/src/main/java/org/elasticsearch/common/network/NetworkService.java
core/src/main/java/org/elasticsearch/common/util/IndexFolderUpgrader.java
core/src/main/java/org/elasticsearch/common/xcontent/AbstractObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ConstructingObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ParseFieldRegistry.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/zen/MembershipAction.java
core/src/main/java/org/elasticsearch/discovery/zen/NodeJoinController.java
core/src/main/java/org/elasticsearch/discovery/zen/PublishClusterStateAction.java
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/env/NodeEnvironment.java
core/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java
core/src/main/java/org/elasticsearch/gateway/LocalAllocateDangledIndices.java
core/src/main/java/org/elasticsearch/gateway/MetaDataStateFormat.java
core/src/main/java/org/elasticsearch/gateway/MetaStateService.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/TransportNodesListGatewayMetaState.java
core/src/main/java/org/elasticsearch/gateway/TransportNodesListGatewayStartedShards.java
core/src/main/java/org/elasticsearch/index/Index.java
core/src/main/java/org/elasticsearch/index/analysis/AnalysisRegistry.java
core/src/main/java/org/elasticsearch/index/analysis/CustomAnalyzer.java
core/src/main/java/org/elasticsearch/index/analysis/CustomNormalizerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/IndexAnalyzers.java
core/src/main/java/org/elasticsearch/index/analysis/SynonymGraphTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/mapper/BaseGeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/CompletionFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java
core/src/main/java/org/elasticsearch/index/mapper/GeoShapeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/KeywordFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/Mapper.java
core/src/main/java/org/elasticsearch/index/mapper/NumberFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ParentFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/BoolQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/BoostingQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ConstantScoreQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/DisMaxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ExistsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/FieldMaskingSpanQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/FuzzyQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoPolygonQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoShapeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/HasChildQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/HasParentQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchNoneQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchPhrasePrefixQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchPhraseQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/NestedQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ParentIdQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/PrefixQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryParseContext.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/RangeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/RegexpQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanContainingQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanFirstQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanMultiTermQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanNearQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanNotQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanOrQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanTermQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanWithinQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TermQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TypeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/WildcardQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/WrapperQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/DecayFunctionParser.java
core/src/main/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java
core/src/main/java/org/elasticsearch/index/query/support/QueryParsers.java
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointService.java
core/src/main/java/org/elasticsearch/index/seqno/LocalCheckpointService.java
core/src/main/java/org/elasticsearch/index/seqno/SeqNoStats.java
core/src/main/java/org/elasticsearch/index/seqno/SequenceNumbersService.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/ShardPath.java
core/src/main/java/org/elasticsearch/index/snapshots/blobstore/BlobStoreIndexShardSnapshot.java
core/src/main/java/org/elasticsearch/index/snapshots/blobstore/BlobStoreIndexShardSnapshots.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveriesCollection.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySettings.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
core/src/main/java/org/elasticsearch/indices/store/IndicesStore.java
core/src/main/java/org/elasticsearch/indices/store/TransportNodesListShardStoreMetaData.java
core/src/main/java/org/elasticsearch/ingest/IngestMetadata.java
core/src/main/java/org/elasticsearch/ingest/PipelineConfiguration.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/DiscoveryPlugin.java
core/src/main/java/org/elasticsearch/plugins/RepositoryPlugin.java
core/src/main/java/org/elasticsearch/repositories/RepositoriesModule.java
core/src/main/java/org/elasticsearch/repositories/Repository.java
core/src/main/java/org/elasticsearch/repositories/RepositoryData.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreFormat.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/repositories/blobstore/ChecksumBlobStoreFormat.java
core/src/main/java/org/elasticsearch/repositories/fs/FsRepository.java
core/src/main/java/org/elasticsearch/repositories/uri/URLRepository.java
core/src/main/java/org/elasticsearch/rest/BytesRestResponse.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterAllocationExplainAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterRerouteAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestClearIndicesCacheAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetMappingAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/script/ScriptMetaData.java
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/aggregations/Aggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorParsers.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/DateRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/ip/IpRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/GND.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/NXYSignificanceHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/support/IncludeExclude.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/BucketHelpers.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/BucketMetricsParser.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/percentile/PercentilesBucketPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/stats/extended/ExtendedStatsBucketParser.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketscript/BucketScriptPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketselector/BucketSelectorPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/cumulativesum/CumulativeSumPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/derivative/DerivativePipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/MovAvgPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/models/EwmaModel.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/models/HoltLinearModel.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/models/HoltWintersModel.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/models/LinearModel.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/models/MovAvgModel.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/models/SimpleModel.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/serialdiff/SerialDiffPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceParserHelper.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/FetchSourceContext.java
core/src/main/java/org/elasticsearch/search/internal/FilteredSearchContext.java
comments:
Merge branch 'master' into keystore

time:
2017-01-06T17:11:07Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
comments:
fix NPE

time:
2017-01-06T17:10:53Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/common/network/IfConfig.java
core/src/main/java/org/elasticsearch/common/network/NetworkService.java
test/framework/src/main/java/org/elasticsearch/bootstrap/BootstrapForTesting.java
comments:
Move IfConfig.logIfNecessary call into bootstrap (#22455)

This is related to #22116. A logIfNecessary() call makes a call to
NetworkInterface.getInterfaceAddresses() requiring SocketPermission
connect privileges. By moving this to bootstrap the logging call can be
made before installing the SecurityManager.

time:
2017-01-06T16:35:22Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/EnhancedPainlessLexer.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/PainlessLexer.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/Walker.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/BasicExpressionTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/WhenThingsGoWrongTests.java
comments:
Fix some issues with painless's strings (#22393)

1. Escape sequences we're working. For example `\\` is now correctly
interpreted as `\` instead of `\\`. Same with `\'` being `'` and
`\"` being `"`.
2. `'` delimited strings weren't allowed to contain `"`s but it looked
like they were intended to support it. Now they do.
3. Improves the error message when the script contains an invalid
escape sequence inside a string to include a list of the valid
escape sequences.

Closes #22372

time:
2017-01-06T16:07:40Z
class:
comments:
[TEST] fix explain API rest test that assumes there is only a single
node in the cluster (incorrect assumption)

time:
2017-01-06T15:50:43Z
class:
comments:
Fix compilation of benchmarks on JDK 9

The JDK 9 compiler (b151) emits the warning "No processor claimed any of these annotations" for annotations that would be runtime annotation. Maybe a
regression from https://bugs.openjdk.java.net/browse/JDK-8039469. This is a quick fix so that compilation works again.

time:
2017-01-06T15:36:43Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/test/java/org/elasticsearch/action/admin/indices/create/CreateIndexIT.java
core/src/test/java/org/elasticsearch/action/admin/indices/create/ShrinkIndexIT.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexServiceTests.java
comments:
Ensure shrunk indices carry over version information from its source (#22469)

Today when an index is shrunk the version information is not carried over
from the source to the target index. This can cause major issues like mapping
incompatibilities for instance if an index from a previous major version is shrunk.

This commit ensures that all version information from the soruce index is preserved
when a shrunk index is created.

Closes #22373

time:
2017-01-06T15:24:52Z
class:
comments:
Document the `detailed` parameter of tasks API (#22425)

Provides an example of using is and an example return description
and explains that we've added descriptions for some tasks but not
even close to all of them. And that we expect to change the
descriptions as we learn more.

Closes #22407

* Fix example

Getting a single task is always detailed, no need to specify.

* Rewrite like imotov wants it

time:
2017-01-06T11:37:49Z
class:
comments:
Disable the Netty recycler and pooled allocator

Netty plays a lot of games with recycling byte buffers in thread local
caches, and using a pooled byte buffer allocator to reduce pressure on
the garbage collector.

The recycler in particular appears to be fraught with peril. It appears
that there are circumstances where the recycler does not recycle quickly
enough and can exceed its capacity leading to heap exhaustion and out of
memory errors. If you spend a few minutes reading the history of the
recycler on the Netty GitHub issues, it appears it has been nothing but
a source of trouble, and the project itself has an open issue that
proposes disabling by default and possibly even removing the recycler.

The pooled byte buffer allocator has problems itself. It sizes the pool
based on the number of runtime processors and can indeed grab a very
large percentage of the heap (in some cases 50% or more). Additionally,
the Netty project continues to struggle with leaks here.

We are seeing users struggle with issues in 5.x that I think are largely
driven by some of the problems here with Netty.

This change proposes to disable the recycler, and to disable the pooled
byte buffer allocator. I think that disabling these features will return
some of the stablity that these features appear to be losing us.

I have done performance testing on my workstation with disabling these
and I do not see a difference in performance. I propose that we make
this change in master and let some nightly benchmarks run to confirm
that there is not a difference in performance. If we are comfortable
with the performance changes, I propose backporting this to all active
branches.

Relates #22452

time:
2017-01-06T11:35:18Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsGroup.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterServiceTests.java
comments:
add more tests for RemoteClusterService

time:
2017-01-06T09:24:40Z
class:
client/rest-high-level/src/main/java/org/elasticsearch/client/RestHighLevelClient.java
client/rest-high-level/src/test/java/org/elasticsearch/client/ESRestHighLevelClientTestCase.java
client/rest-high-level/src/test/java/org/elasticsearch/client/MainActionIT.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RestHighLevelClientTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostIntegTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostTests.java
client/test/src/main/java/org/elasticsearch/client/RestClientTestCase.java
client/test/src/main/java/org/elasticsearch/client/RestClientTestUtil.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/search/SearchRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexGraveyard.java
core/src/main/java/org/elasticsearch/common/xcontent/AbstractObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ConstructingObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java
core/src/main/java/org/elasticsearch/index/Index.java
core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java
core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java
core/src/main/java/org/elasticsearch/index/snapshots/blobstore/BlobStoreIndexShardSnapshot.java
core/src/main/java/org/elasticsearch/index/snapshots/blobstore/BlobStoreIndexShardSnapshots.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveriesCollection.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
core/src/main/java/org/elasticsearch/ingest/IngestMetadata.java
core/src/main/java/org/elasticsearch/ingest/PipelineConfiguration.java
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/DateRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/ip/IpRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/support/IncludeExclude.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketscript/BucketScriptPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketselector/BucketSelectorPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/MovAvgPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/models/EwmaModel.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/models/HoltLinearModel.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/models/HoltWintersModel.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/models/LinearModel.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/models/MovAvgModel.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/models/SimpleModel.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceParserHelper.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/FetchSourceContext.java
core/src/main/java/org/elasticsearch/search/internal/FilteredSearchContext.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java
core/src/main/java/org/elasticsearch/search/searchafter/SearchAfterBuilder.java
core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java
core/src/main/java/org/elasticsearch/search/sort/ScriptSortBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/SuggestBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/SuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/completion/context/CategoryQueryContext.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/LinearInterpolation.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/SmoothingModel.java
core/src/main/java/org/elasticsearch/search/suggest/term/TermSuggestionBuilder.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotInfo.java
core/src/test/java/org/elasticsearch/index/engine/LiveVersionMapTests.java
core/src/test/java/org/elasticsearch/indices/recovery/IndexRecoveryIT.java
core/src/test/java/org/elasticsearch/script/ScriptTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/moving/avg/MovAvgUnitTests.java
core/src/test/java/org/elasticsearch/search/searchafter/SearchAfterBuilderTests.java
core/src/test/java/org/elasticsearch/search/suggest/CustomSuggesterSearchIT.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/matrix/stats/MatrixStatsParser.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/support/MultiValuesSourceParser.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TemplateQueryBuilder.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MustacheScriptEngineTests.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportMultiPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportPercolateAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/ContextAndHeaderTransportIT.java
test/framework/src/main/java/org/elasticsearch/search/RandomSearchRequestGenerator.java
comments:
Merge branch 'master' into feature/multi_cluster_search

time:
2017-01-06T09:03:45Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/bootstrap/Elasticsearch.java
core/src/main/java/org/elasticsearch/common/settings/KeyStoreWrapper.java
test/framework/src/main/java/org/elasticsearch/bootstrap/ESElasticsearchCliTestCase.java
comments:
more renames

time:
2017-01-06T08:49:18Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/common/settings/AddStringKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/KeyStoreWrapper.java
core/src/main/java/org/elasticsearch/common/settings/ListKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/RemoveSettingKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/SecureString.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/test/java/org/elasticsearch/common/settings/AddStringKeyStoreCommandTests.java
core/src/test/java/org/elasticsearch/common/settings/CreateKeyStoreCommandTests.java
core/src/test/java/org/elasticsearch/common/settings/KeyStoreCommandTestCase.java
comments:
addressing more PR comments

time:
2017-01-05T19:37:27Z
class:
comments:
Fixed id's of 'worked example' in scripted metric aggs docs (#22430)

time:
2017-01-05T19:36:18Z
class:
comments:
Docs: Detail on false/strict dynamic mapping setting (#22451)

Reference: https://www.elastic.co/guide/en/elasticsearch/guide/master/dynamic-mapping.html

time:
2017-01-05T18:33:04Z
class:
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java
comments:
remove ParseFieldMatcher usages from InternalSearchHit

time:
2017-01-05T18:33:04Z
class:
core/src/main/java/org/elasticsearch/search/suggest/completion/context/CategoryQueryContext.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/LinearInterpolation.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionBuilder.java
comments:
remove ParseFieldMatcher usages from suggesters

time:
2017-01-05T18:33:04Z
class:
core/src/main/java/org/elasticsearch/ingest/IngestMetadata.java
core/src/main/java/org/elasticsearch/ingest/PipelineConfiguration.java
comments:
remove ParseFieldMatcher usages from IngestMetadata

time:
2017-01-05T18:33:04Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/IndexGraveyard.java
core/src/main/java/org/elasticsearch/index/Index.java
comments:
remove ParseFieldMatcher usages from IndexGraveyard

time:
2017-01-05T18:33:04Z
class:
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/main/java/org/elasticsearch/search/searchafter/SearchAfterBuilder.java
core/src/test/java/org/elasticsearch/search/searchafter/SearchAfterBuilderTests.java
test/framework/src/main/java/org/elasticsearch/search/RandomSearchRequestGenerator.java
comments:
remove ParseFieldMatcher usages from SearchAfterBuilder

time:
2017-01-05T18:33:04Z
class:
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/FetchSourceContext.java
comments:
remove ParseFieldMatcher usages from FetchSourceContext

time:
2017-01-05T18:33:04Z
class:
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestSearchTemplateAction.java
comments:
remove ParseFieldMatcher usages from RestSearchTemplateAction

time:
2017-01-05T18:33:04Z
class:
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketscript/BucketScriptPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketselector/BucketSelectorPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceParserHelper.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/main/java/org/elasticsearch/search/sort/ScriptSortBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionBuilder.java
core/src/test/java/org/elasticsearch/script/ScriptTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TemplateQueryBuilder.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MustacheScriptEngineTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
comments:
remove ParseFieldMatcher usages from Script parsing code

time:
2017-01-05T18:33:04Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java
comments:
fix unchecked generics warnings in ObjectParser

time:
2017-01-05T18:33:04Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/AbstractObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ConstructingObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java
comments:
ObjectParser to no longer require ParseFieldMatcherSupplier as its Context

ParseFieldMatcher as well as ParseFieldMatcherSupplier will be soon removed, hence the ObjectParser's context doesn't need to be a ParseFieldMatcherSupplier anymore. That will allow to remove ParseFieldMatcherSupplier's implementations, little by little.

time:
2017-01-05T18:33:04Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchRequest.java
core/src/main/java/org/elasticsearch/index/snapshots/blobstore/BlobStoreIndexShardSnapshot.java
core/src/main/java/org/elasticsearch/index/snapshots/blobstore/BlobStoreIndexShardSnapshots.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/DateRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/ip/IpRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/support/IncludeExclude.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/MovAvgPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/models/EwmaModel.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/models/HoltLinearModel.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/models/HoltWintersModel.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/models/LinearModel.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/models/MovAvgModel.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/models/SimpleModel.java
core/src/main/java/org/elasticsearch/search/internal/FilteredSearchContext.java
core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/SuggestBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/SuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/SmoothingModel.java
core/src/main/java/org/elasticsearch/search/suggest/term/TermSuggestionBuilder.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotInfo.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/moving/avg/MovAvgUnitTests.java
core/src/test/java/org/elasticsearch/search/suggest/CustomSuggesterSearchIT.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/matrix/stats/MatrixStatsParser.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/support/MultiValuesSourceParser.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportMultiPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportPercolateAction.java
comments:
remove unused ParseFieldMatcher imports/arguments

time:
2017-01-05T18:12:21Z
class:
core/src/test/java/org/elasticsearch/indices/recovery/IndexRecoveryIT.java
comments:
[TEST] Fix IndexRecoveryIT.testDisconnectsDuringRecovery

The test currently checks that the recovering shard is not failed when it is not a primary relocation that has moved past the finalization step.
Checking if it has moved past that step is done by intercepting the request between the replication source and the target and checking if it has seen
then WAIT_FOR_CLUSTERSTATE action as this is the next action that is called after finalization. This action can, however, occur only after the shard was
already failed, and thus trip the assertion. This commit changes the check to look out for the FINALIZE action, independently of whether it succeeded or not.

time:
2017-01-05T17:11:58Z
class:
core/src/main/java/org/elasticsearch/indices/recovery/RecoveriesCollection.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
comments:
Don't close store under CancellableThreads (#22434)

#22325 changed the recovery retry logic to use unique recovery ids. The change also introduced an issue, however, which made it possible for the shard store to be closed under CancellableThreads, triggering assertions in the node locking logic. This commit limits the use of CancellableThreads only to the part where we wait on the old recovery target to be closed.

time:
2017-01-05T16:15:34Z
class:
comments:
remove double slash from license header

time:
2017-01-05T16:03:12Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterConnectionTests.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterServiceTests.java
comments:
cut over to use : instead of | for cross cluster search

time:
2017-01-05T15:10:34Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
comments:
add basic docs

time:
2017-01-05T14:23:55Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
core/src/test/java/org/elasticsearch/search/simple/SimpleSearchIT.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
comments:
More cleanups

time:
2017-01-05T13:13:08Z
class:
core/src/main/java/org/elasticsearch/transport/TransportActionProxy.java
comments:
Add javadocs to TransportActionProxy

time:
2017-01-05T13:07:56Z
class:
core/src/main/java/org/elasticsearch/action/ActionListener.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterConnectionTests.java
comments:
document and test concurrent remote cluster node discovery

time:
2017-01-05T10:33:24Z
class:
core/src/test/java/org/elasticsearch/index/engine/LiveVersionMapTests.java
comments:
Relax LiveVersionMapTests.testRamBytesUsed.

With Java9's new restrictions we cannot compute ram usage as accurately as
before. See https://issues.apache.org/jira/browse/LUCENE-7595.

time:
2017-01-05T10:29:41Z
class:
client/rest-high-level/src/main/java/org/elasticsearch/client/RestHighLevelClient.java
comments:
Make RestHighLevelClient non final

time:
2017-01-05T09:55:47Z
class:
comments:
Switch from standalone-test to standalone-rest-test

standalone-rest-test doesn't configure unit tests and for these
integ test only tests, that is what we want.

time:
2017-01-05T09:55:47Z
class:
qa/smoke-test-http/src/test/java/org/elasticsearch/http/ContextAndHeaderTransportIT.java
comments:
Require either BuildPlugin or StandaloneTestBasePlugin to use RestTestPlugin

It used to be that RestTestPlugin "came with" StandaloneTestBasePlugin
but we'd like to use it with BuildPlugin for the high level rest client.

time:
2017-01-05T09:55:47Z
class:
client/rest-high-level/src/main/java/org/elasticsearch/client/RestHighLevelClient.java
client/rest-high-level/src/test/java/org/elasticsearch/client/ESRestHighLevelClientTestCase.java
client/rest-high-level/src/test/java/org/elasticsearch/client/MainActionIT.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RestHighLevelClientTests.java
comments:
add REST high level client gradle submodule and first simple method

The RestHighLevelClient class takes as as an argument a low level client instance RestClient. The first method added is ping, which returns true if the call to HEAD / went ok and false if an IOException was thrown. Any other exception gets bubbled up.

There are two kinds of tests, a unit test (RestHighLevelClientTests) that verifies the interaction between high level and low level client, and an integration test (MainActionIT) which relies on an externally started es cluster to send requests to.

time:
2017-01-05T09:55:47Z
class:
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostIntegTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostTests.java
client/test/src/main/java/org/elasticsearch/client/RestClientTestCase.java
client/test/src/main/java/org/elasticsearch/client/RestClientTestUtil.java
comments:
[TEST] move randomHeaders method from RestClientTestCase to RestClientTestUtil and simplify headers assertions

time:
2017-01-05T07:00:03Z
class:
client/rest/src/test/java/org/elasticsearch/client/RestClientMultipleHostsIntegTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostIntegTests.java
client/sniffer/src/test/java/org/elasticsearch/client/sniff/ElasticsearchHostsSnifferTests.java
core/src/main/java/org/apache/lucene/analysis/synonym/GraphTokenStreamFiniteStrings.java
core/src/main/java/org/apache/lucene/analysis/synonym/SynonymGraphFilter.java
core/src/main/java/org/apache/lucene/search/GraphQuery.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/search/SearchRequest.java
core/src/main/java/org/elasticsearch/action/search/SearchType.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/AllocationCommands.java
core/src/main/java/org/elasticsearch/common/xcontent/ParseFieldRegistry.java
core/src/main/java/org/elasticsearch/index/analysis/AnalysisRegistry.java
core/src/main/java/org/elasticsearch/index/analysis/SynonymGraphTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/mapper/BaseGeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java
core/src/main/java/org/elasticsearch/index/mapper/GeoShapeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/Mapper.java
core/src/main/java/org/elasticsearch/index/mapper/NumberFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/BoolQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/FuzzyQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/PrefixQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/RegexpQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/WildcardQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/support/QueryParsers.java
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointService.java
core/src/main/java/org/elasticsearch/index/seqno/LocalCheckpointService.java
core/src/main/java/org/elasticsearch/index/seqno/SequenceNumbersService.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterRerouteAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestClearIndicesCacheAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/aggregations/Aggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorParsers.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/MovAvgPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/main/java/org/elasticsearch/search/internal/FilteredSearchContext.java
core/src/main/java/org/elasticsearch/search/internal/SearchContext.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainIT.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AllocationCommandsTests.java
core/src/test/java/org/elasticsearch/common/ParseFieldTests.java
core/src/test/java/org/elasticsearch/index/analysis/AnalysisRegistryTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicTemplateTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/search/MatchQueryIT.java
core/src/test/java/org/elasticsearch/index/seqno/GlobalCheckpointTests.java
core/src/test/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeActionTests.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/BaseAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/BasePipelineAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/ExtendedStatsBucketTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/PercentilesBucketTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/moving/avg/MovAvgTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/MatchedQueriesIT.java
core/src/test/java/org/elasticsearch/search/query/SearchQueryIT.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/TemplateQueryBuilderTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Utils.java
modules/transport-netty4/src/test/java/org/elasticsearch/transport/netty4/Netty4SizeHeaderFrameDecoderTests.java
plugins/discovery-azure-classic/src/test/java/org/elasticsearch/discovery/azure/classic/AzureDiscoveryClusterFormationTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryClusterFormationTests.java
plugins/discovery-file/src/test/java/org/elasticsearch/discovery/file/FileBasedDiscoveryPluginTests.java
plugins/discovery-gce/src/test/java/org/elasticsearch/discovery/gce/GceDiscoverTests.java
plugins/jvm-example/src/test/java/org/elasticsearch/plugin/example/ExampleExternalIT.java
test/framework/src/main/java/org/elasticsearch/AnalysisFactoryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/main/java/org/elasticsearch/test/TestSearchContext.java
test/framework/src/main/java/org/elasticsearch/test/discovery/ClusterDiscoveryConfiguration.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ESClientYamlSuiteTestCase.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
comments:
Merge branch 'master' into feature/multi_cluster_search

time:
2017-01-05T06:32:53Z
class:
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
comments:
Execute low level handshake in #openConnection (#22440)

Today we execute the low level handshake on the TCP layer in #connectToNode.
If #openConnection is used directly, which is truly expert, no handshake is executed
which allows connecting to nodes that are not necessarily compatible. This change
moves the handshake to #openConnection to prevent bypassing this logic.

time:
2017-01-04T23:56:53Z
class:
comments:
Use tests.asserts flag to allow disabling assertions

Randomized runner uses a flag, tests.asserts, which we have previously
not used, but is used in lucene for disabling assertions. This change
modifies the gradle configuration to look for this flag and pass through
to the test runner to determine whether -ea and -esa are added to the
java commandline for tests.

time:
2017-01-04T23:00:43Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
Add 5.3 version

time:
2017-01-04T20:38:51Z
class:
client/rest/src/test/java/org/elasticsearch/client/RestClientMultipleHostsIntegTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostIntegTests.java
client/sniffer/src/test/java/org/elasticsearch/client/sniff/ElasticsearchHostsSnifferTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/transport/netty4/Netty4SizeHeaderFrameDecoderTests.java
plugins/discovery-azure-classic/src/test/java/org/elasticsearch/discovery/azure/classic/AzureDiscoveryClusterFormationTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryClusterFormationTests.java
plugins/discovery-gce/src/test/java/org/elasticsearch/discovery/gce/GceDiscoverTests.java
plugins/jvm-example/src/test/java/org/elasticsearch/plugin/example/ExampleExternalIT.java
test/framework/src/main/java/org/elasticsearch/test/discovery/ClusterDiscoveryConfiguration.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
comments:
Replace Socket, ServerSocket, and HttpServer usages in tests with mocksocket versions (#22287)

This integrates the mocksocket jar with elasticsearch tests. Mocksocket wraps actions requiring SocketPermissions in doPrivilege blocks. This will eventually allow SocketPermissions to be assigned to the mocksocket jar opposed to the entire elasticsearch codebase.

time:
2017-01-04T20:36:53Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponse.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterConnectionTests.java
comments:
Make RemoteClusterConnectionIT a unit test

time:
2017-01-04T19:34:00Z
class:
comments:
[TEST] explain API rest test may have shard allocation throttled

time:
2017-01-04T19:16:49Z
class:
core/src/main/java/org/elasticsearch/indices/IndicesService.java
comments:
IndicesService handles all exceptions during index deletion (#22433)

Previously, we could run into a situation where attempting to delete an
index due to a cluster state update would cause an unhandled exception
to bubble up to the ClusterService and cause the cluster state applier
to fail. The result of this situation is that the cluster state never
gets updated on the ClusterService because the exception happens before
all cluster state appliers have completed and the ClusterService only
updates the cluster state once all cluster state appliers have
successfully completed.

All other methods on IndicesService properly handle all exceptions and
not just IOExceptions, but there were two instances with respect to
index deletion where only IOExceptions where handled by the
IndicesService. If any other exception occurred during these delete
operations, the exception would be bubbled up to the ClusterService,
causing the aforementioned issues.

This commit ensures all methods in IndicesService properly capture all
types of Exceptions, so that the ClusterService manages to update the
cluster state, even in the presence of shard creation/deletion failures.

Note that the lack of updating the cluster state in the presence of such
exceptions can have many unintended consequences, one of them being
the tripping of the assertion in IndicesClusterStateService#removeUnallocatedIndices
where the assumption is that if there is an IndexService to remove with
an unassigned shard, then the index must exist in the cluster state, but if
the cluster state was never updated due to the aforementioned exceptions,
then the cluster state will not have the index in question.

time:
2017-01-04T18:03:52Z
class:
core/src/main/java/org/apache/lucene/analysis/synonym/GraphTokenStreamFiniteStrings.java
core/src/main/java/org/apache/lucene/analysis/synonym/SynonymGraphFilter.java
core/src/main/java/org/apache/lucene/search/GraphQuery.java
core/src/main/java/org/elasticsearch/index/analysis/AnalysisRegistry.java
core/src/main/java/org/elasticsearch/index/analysis/SynonymGraphTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/mapper/NumberFieldMapper.java
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
core/src/test/java/org/elasticsearch/index/search/MatchQueryIT.java
test/framework/src/main/java/org/elasticsearch/AnalysisFactoryTestCase.java
comments:
Upgrade to lucene-6.4.0-snapshot-084f7a0. (#22413)

time:
2017-01-04T17:07:17Z
class:
comments:
[TEST] 5.x snapshot build is working again, so update the backwards
compatibility tests for the allocation explain API to include 5.2.0

time:
2017-01-04T16:26:00Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterConnectionIT.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterConnectionTests.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterServiceTests.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
comments:
Cleanup lots of code, add javadocs and tests

time:
2017-01-04T12:31:59Z
class:
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
comments:
[TEST] Also register replica node in node map

time:
2017-01-04T12:14:09Z
class:
comments:
Fix BWC layer with field_stats and geo_point

time:
2017-01-04T10:23:33Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
comments:
handle nodes that are not connected early in AbstractSearchAsyncAction

time:
2017-01-04T09:42:22Z
class:
core/src/main/java/org/elasticsearch/index/mapper/BaseGeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/GeoShapeFieldMapper.java
comments:
Implement stats for geo_point and geo_shape field (#22391)

Currently `geo_point` and `geo_shape` field are treated as `text` field by the field stats API and we
try to extract the min/max values with MultiFields.getTerms.
This is ok in master because a `geo_point` field is always a Point field but it can cause problem in 5.x (and 2.x) because the legacy
 `geo_point` are indexed as terms.
 As a result the min and max are extracted and then printed in the FieldStats output using BytesRef.utf8ToString
 which can throw an IndexOutOfBoundException since it's not valid UTF8 strings.
 This change ensure that we never try to extract min/max information from a `geo_point` field.
 It does not add a new type for geo points in the fieldstats API so we'll continue to use `text` for this kind of field.
 This PR is targeted to master even though we could only commit this change to 5.x. I think it's cleaner to have it in master too before we make any decision on
  https://github.com/elastic/elasticsearch/pull/21947.

Fixes #22384

time:
2017-01-03T23:42:38Z
class:
core/src/main/java/org/elasticsearch/cli/Terminal.java
core/src/main/java/org/elasticsearch/common/settings/AddStringKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/CreateKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/KeyStoreWrapper.java
core/src/main/java/org/elasticsearch/common/settings/ListKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/SecureString.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/test/java/org/elasticsearch/cli/TerminalTests.java
core/src/test/java/org/elasticsearch/common/settings/RemoveSettingKeyStoreCommandTests.java
comments:
feedback

time:
2017-01-03T22:40:52Z
class:
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
comments:
Filter actions to trace in test

Notifications for request tracing are invoked concurrently and can still
be in flight once a tracer is installed in the test. This can lead to side-effects
since the test relied on exact invocations. This commit adds action filtering
to the test tracer to only count invocations for the relevant actions.

Closes #22418

time:
2017-01-03T20:10:38Z
class:
core/src/main/java/org/elasticsearch/index/seqno/SequenceNumbersService.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
comments:
Cleanup some comments in IndexShard.java

This commit cleans up the comments in IndexShard related to sequence numbers, making
them uniform in their formatting and taking advantage of the line-length
limit of 140 characters.

time:
2017-01-03T17:44:49Z
class:
comments:
Fix listing format in reindex docs (#22420)

time:
2017-01-03T17:23:33Z
class:
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointService.java
core/src/test/java/org/elasticsearch/index/seqno/GlobalCheckpointTests.java
comments:
Cleanup comments in GlobalCheckpointService.java

This commit cleans up the comments in GlobalCheckpointService, making
them uniform in their formatting and taking advantage of the line-length
limit of 140 characters.

time:
2017-01-03T17:06:43Z
class:
core/src/main/java/org/elasticsearch/index/seqno/SequenceNumbersService.java
comments:
Cleanup comments in SequenceNumbersService.java

This commit cleans up the comments in SequenceNumbersService, making
them uniform in their formatting and taking advantage of the line-length
limit of 140 characters.

time:
2017-01-03T16:39:40Z
class:
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainIT.java
comments:
[TEST] only check node decisions if not in the AWAITING_INFO state

time:
2017-01-03T16:24:32Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterConnectionTests.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
core/src/test/java/org/elasticsearch/search/simple/SimpleSearchIT.java
qa/multi-cluster-search/src/test/java/org/elasticsearch/upgrades/MultiClusterSearchYamlTestSuiteIT.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
comments:
Add support for proxy nodes

this commit adds full support for proxy nodes on the search layer.
This allows to connection only to a small set of nodes on a remote cluster
to exectue the search. The nodes will proxy the request to the correct node in the
cluster while the coordinting node doesn't need to be connected to the target node.

time:
2017-01-03T14:52:32Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/Aggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregationBuilder.java
comments:
Remove ParseFieldMatcher usages from Aggregator

time:
2017-01-03T14:52:32Z
class:
core/src/main/java/org/elasticsearch/search/SearchService.java
comments:
Remove ParseFieldMatcher usages from SearchService

time:
2017-01-03T14:52:32Z
class:
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/internal/FilteredSearchContext.java
core/src/main/java/org/elasticsearch/search/internal/SearchContext.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
test/framework/src/main/java/org/elasticsearch/test/TestSearchContext.java
comments:
Remove ParseFieldMatcher usages from SearchContext

time:
2017-01-03T14:52:32Z
class:
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestClearIndicesCacheAction.java
core/src/test/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeActionTests.java
comments:
Remove ParseFieldMatcher usages from a couple of Rest Actions

time:
2017-01-03T14:52:32Z
class:
core/src/main/java/org/elasticsearch/index/query/FuzzyQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/PrefixQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/RegexpQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/WildcardQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/support/QueryParsers.java
comments:
Remove ParseFieldMatcher usages from QueryParsers#parseRewriteMethod

time:
2017-01-03T14:52:32Z
class:
core/src/main/java/org/elasticsearch/index/query/support/QueryParsers.java
comments:
Remove unused QueryParsers#setRewriteMethod

time:
2017-01-03T14:52:32Z
class:
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java
core/src/test/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilderTests.java
comments:
Remove ParseFieldMatcher usages from MoreLikeThisQueryBuilder & MultiMatchQueryBuilder

time:
2017-01-03T14:52:32Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchRequest.java
core/src/main/java/org/elasticsearch/action/search/SearchType.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
comments:
Remove ParseFieldMatcher usage from SearchRequest

time:
2017-01-03T14:52:32Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorParsers.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
core/src/test/java/org/elasticsearch/search/aggregations/BaseAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/BasePipelineAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/ExtendedStatsBucketTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/PercentilesBucketTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/moving/avg/MovAvgTests.java
comments:
Remove ParseFieldMatcher usage from AggregatorParsers

time:
2017-01-03T14:52:32Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/AllocationCommands.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterRerouteAction.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AllocationCommandsTests.java
comments:
Remove ParseFieldMatcher usage from AllocationCommands

time:
2017-01-03T14:52:32Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/allocation/command/AllocationCommands.java
core/src/main/java/org/elasticsearch/common/xcontent/ParseFieldRegistry.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorParsers.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/MovAvgPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
comments:
Remove ParseFieldMatcher usage from ParseFieldRegistry

time:
2017-01-03T14:52:32Z
class:
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java
core/src/main/java/org/elasticsearch/index/mapper/Mapper.java
comments:
Remove ParseFieldMatcher usage from Mappers

time:
2017-01-03T14:30:31Z
class:
core/src/main/java/org/elasticsearch/index/seqno/LocalCheckpointService.java
comments:
Cleanup some whitespace in LocalCheckpointService.java

This commit just fixes a couple whitespace formatting issues in
o/e/i/s/LocalCheckpointService.java.

time:
2017-01-03T14:29:01Z
class:
core/src/main/java/org/elasticsearch/index/seqno/LocalCheckpointService.java
comments:
Cleanup comments in LocalCheckpointService.java

This commit cleans up the comments in LocalCheckpointService, making
them uniform in their formatting and taking advantage of the line-length
limit of 140 characters.

time:
2017-01-03T14:25:05Z
class:
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ESClientYamlSuiteTestCase.java
comments:
[TEST] assign blacklistPathMatchers only after the contexts have been assigned

There could be an issue creating the REST clients and/or making the first request to the external cluster. If that happens, the blacklist has already been assigned and the following tests will fail because of an assertion that checks that the blacklist is not already assigned when the contexts are not.

time:
2017-01-03T14:14:33Z
class:
core/src/main/java/org/elasticsearch/index/query/BoolQueryBuilder.java
comments:
Remove deprecated `minimum_number_should_match` in BoolQueryBuilder

After deprecating getters and setters and the query DSL parameter in 5.x,
support for `minimum_number_should_match` can be removed entirely. Also
consolidated comments with the ones on 5.x branch and added an entry to the
migration docs.

time:
2017-01-03T13:15:57Z
class:
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Utils.java
comments:
Fix stale comment in Netty4Utils

We previously named the thread using a frame from the stack trace, but
this was removed to simplify the code here. However, the comment
explaining this was left behind and this commit cleans that up.

time:
2017-01-03T11:36:28Z
class:
core/src/test/java/org/elasticsearch/common/ParseFieldTests.java
core/src/test/java/org/elasticsearch/index/analysis/AnalysisRegistryTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicTemplateTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/TemplateQueryBuilderTests.java
plugins/discovery-file/src/test/java/org/elasticsearch/discovery/file/FileBasedDiscoveryPluginTests.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
Eliminate unneccessary declaration of IOException

With this commit we remove the declaration of IOException from
assertWarnings and modify all call sites.

Checked with @javanna

time:
2017-01-03T10:29:04Z
class:
core/src/main/java/org/elasticsearch/index/query/BoolQueryBuilder.java
core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/MatchedQueriesIT.java
core/src/test/java/org/elasticsearch/search/query/SearchQueryIT.java
comments:
Remove getters and setters for "minimumNumberShouldMatch" in BoolQueryBuilder

Currently we have getters an setters for both "minimumNumberShouldMatch" and
"minimumShouldMatch", which both access the same internal value
(minimumShouldMatch). Since we only document the `minimum_should_match`
parameter for the query DSL, I think we can deprecate the other getters and
setters for 5.x and remove with 6.0, also deprecating the
`minimum_number_should_match` query DSL parameter.

time:
2017-01-03T10:17:54Z
class:
client/transport/src/main/java/org/elasticsearch/transport/client/PreBuiltTransportClient.java
client/transport/src/test/java/org/elasticsearch/transport/client/PreBuiltTransportClientTests.java
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/ElasticsearchParseException.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplanation.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/NodeExplanation.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/TransportClusterAllocationExplainAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/TransportGetTaskAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/delete/TransportDeleteSnapshotAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetMappingsResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/get/GetIndexTemplatesResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/ingest/GetPipelineResponse.java
core/src/main/java/org/elasticsearch/action/support/ActiveShardsObserver.java
core/src/main/java/org/elasticsearch/action/support/master/TransportMasterNodeAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationAction.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java
core/src/main/java/org/elasticsearch/cluster/AbstractDiffable.java
core/src/main/java/org/elasticsearch/cluster/AbstractNamedDiffable.java
core/src/main/java/org/elasticsearch/cluster/ClusterModule.java
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateObserver.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateTaskExecutor.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateUpdateTask.java
core/src/main/java/org/elasticsearch/cluster/Diffable.java
core/src/main/java/org/elasticsearch/cluster/DiffableUtils.java
core/src/main/java/org/elasticsearch/cluster/LocalClusterUpdateTask.java
core/src/main/java/org/elasticsearch/cluster/NamedDiff.java
core/src/main/java/org/elasticsearch/cluster/NamedDiffable.java
core/src/main/java/org/elasticsearch/cluster/NamedDiffableValueSerializer.java
core/src/main/java/org/elasticsearch/cluster/RestoreInProgress.java
core/src/main/java/org/elasticsearch/cluster/SnapshotDeletionsInProgress.java
core/src/main/java/org/elasticsearch/cluster/SnapshotsInProgress.java
core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java
core/src/main/java/org/elasticsearch/cluster/block/ClusterBlocks.java
core/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/AliasValidator.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexGraveyard.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MappingMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java
core/src/main/java/org/elasticsearch/cluster/metadata/RepositoriesMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/RepositoryMetaData.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodes.java
core/src/main/java/org/elasticsearch/cluster/routing/IndexRoutingTable.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AbstractAllocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocateUnassignedDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/MoveDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RoutingAllocation.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/ShardAllocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/ShardsAllocator.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AllocationDeciders.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AwarenessAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ClusterRebalanceAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ConcurrentRebalanceAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/Decision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/EnableAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/FilterAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/SameShardAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ShardsLimitAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ThrottlingAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/common/ParseFieldMatcher.java
core/src/main/java/org/elasticsearch/common/Strings.java
core/src/main/java/org/elasticsearch/common/io/stream/NamedWriteableAwareStreamInput.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java
core/src/main/java/org/elasticsearch/common/logging/DeprecationLogger.java
core/src/main/java/org/elasticsearch/common/lucene/ShardCoreKeyMap.java
core/src/main/java/org/elasticsearch/common/network/NetworkModule.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/settings/loader/XContentSettingsLoader.java
core/src/main/java/org/elasticsearch/common/util/IndexFolderUpgrader.java
core/src/main/java/org/elasticsearch/common/xcontent/NamedXContentRegistry.java
core/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ParseFieldRegistry.java
core/src/main/java/org/elasticsearch/common/xcontent/XContent.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentHelper.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentParserUtils.java
core/src/main/java/org/elasticsearch/common/xcontent/cbor/CborXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/cbor/CborXContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContentGenerator.java
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/smile/SmileXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/smile/SmileXContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/support/AbstractXContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/yaml/YamlXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/yaml/YamlXContentParser.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/zen/ElectMasterService.java
core/src/main/java/org/elasticsearch/discovery/zen/MembershipAction.java
core/src/main/java/org/elasticsearch/discovery/zen/NodeJoinController.java
core/src/main/java/org/elasticsearch/discovery/zen/PublishClusterStateAction.java
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenPing.java
core/src/main/java/org/elasticsearch/env/NodeEnvironment.java
core/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java
core/src/main/java/org/elasticsearch/gateway/LocalAllocateDangledIndices.java
core/src/main/java/org/elasticsearch/gateway/MetaDataStateFormat.java
core/src/main/java/org/elasticsearch/gateway/MetaStateService.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/TransportNodesListGatewayMetaState.java
core/src/main/java/org/elasticsearch/gateway/TransportNodesListGatewayStartedShards.java
core/src/main/java/org/elasticsearch/index/IndexModule.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/analysis/AnalysisRegistry.java
core/src/main/java/org/elasticsearch/index/analysis/CustomAnalyzer.java
core/src/main/java/org/elasticsearch/index/analysis/CustomNormalizerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/IndexAnalyzers.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/ShadowEngine.java
core/src/main/java/org/elasticsearch/index/mapper/CompletionFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java
core/src/main/java/org/elasticsearch/index/mapper/DynamicTemplate.java
core/src/main/java/org/elasticsearch/index/mapper/KeywordFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/index/mapper/NumberFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ParentFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/RangeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/BoolQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/BoostingQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ConstantScoreQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/DisMaxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ExistsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/FieldMaskingSpanQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/FuzzyQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoPolygonQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoShapeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/HasChildQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/HasParentQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchAllQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchNoneQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchPhrasePrefixQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchPhraseQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/NestedQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ParentIdQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/PrefixQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryParseContext.java
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/RangeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/RegexpQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanContainingQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanFirstQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanMultiTermQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanNearQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanNotQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanOrQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanTermQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanWithinQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TermQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TypeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/WildcardQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/WrapperQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/DecayFunctionBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/DecayFunctionParser.java
core/src/main/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java
core/src/main/java/org/elasticsearch/index/query/support/QueryParsers.java
core/src/main/java/org/elasticsearch/index/seqno/SeqNoStats.java
core/src/main/java/org/elasticsearch/index/shard/CommitPoints.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/ShardPath.java
core/src/main/java/org/elasticsearch/index/shard/TranslogRecoveryPerformer.java
core/src/main/java/org/elasticsearch/index/snapshots/blobstore/BlobStoreIndexShardSnapshot.java
core/src/main/java/org/elasticsearch/index/snapshots/blobstore/BlobStoreIndexShardSnapshots.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java
core/src/main/java/org/elasticsearch/indices/query/IndicesQueriesRegistry.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveriesCollection.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySettings.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
core/src/main/java/org/elasticsearch/indices/store/IndicesStore.java
core/src/main/java/org/elasticsearch/indices/store/TransportNodesListShardStoreMetaData.java
core/src/main/java/org/elasticsearch/ingest/ConfigurationUtils.java
core/src/main/java/org/elasticsearch/ingest/IngestDocument.java
core/src/main/java/org/elasticsearch/ingest/IngestMetadata.java
core/src/main/java/org/elasticsearch/ingest/PipelineConfiguration.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/DiscoveryPlugin.java
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
core/src/main/java/org/elasticsearch/plugins/NetworkPlugin.java
core/src/main/java/org/elasticsearch/plugins/Plugin.java
core/src/main/java/org/elasticsearch/plugins/RepositoryPlugin.java
core/src/main/java/org/elasticsearch/repositories/RepositoriesModule.java
core/src/main/java/org/elasticsearch/repositories/Repository.java
core/src/main/java/org/elasticsearch/repositories/RepositoryData.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreFormat.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/repositories/blobstore/ChecksumBlobStoreFormat.java
core/src/main/java/org/elasticsearch/repositories/fs/FsRepository.java
core/src/main/java/org/elasticsearch/repositories/uri/URLRepository.java
core/src/main/java/org/elasticsearch/rest/BytesRestResponse.java
core/src/main/java/org/elasticsearch/rest/RestRequest.java
core/src/main/java/org/elasticsearch/rest/action/RestActions.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterAllocationExplainAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestClearIndicesCacheAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetMappingAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestValidateQueryAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestExplainAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/script/ScriptMetaData.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/SearchRequestParsers.java
core/src/main/java/org/elasticsearch/search/aggregations/Aggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/ip/IpRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/GND.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/NXYSignificanceHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/support/IncludeExclude.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/InternalNumericMetricsAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/min/InternalMin.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/BucketHelpers.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/BucketMetricsParser.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/percentile/PercentilesBucketPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/stats/extended/ExtendedStatsBucketParser.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketscript/BucketScriptPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketselector/BucketSelectorPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/cumulativesum/CumulativeSumPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/derivative/DerivativePipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/MovAvgPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/models/HoltWintersModel.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/serialdiff/SerialDiffPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/support/MissingValues.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceParserHelper.java
core/src/main/java/org/elasticsearch/search/aggregations/support/values/ScriptLongValues.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/FetchSourceContext.java
core/src/main/java/org/elasticsearch/search/internal/AliasFilter.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java
core/src/main/java/org/elasticsearch/search/internal/SearchSortValues.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchRequest.java
core/src/main/java/org/elasticsearch/search/rescore/RescoreBuilder.java
core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/SuggestBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/SuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestionBuilder.java
comments:
Merge branch 'master' into feature/multi_cluster_search

time:
2017-01-03T01:20:17Z
class:
core/src/main/java/org/elasticsearch/Version.java
core/src/test/java/org/elasticsearch/VersionTests.java
comments:
Implement Comparable in Version (#22378)

Supports using streams to calculate min/max of a collection of Versions, etc.

time:
2017-01-02T23:31:17Z
class:
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainIT.java
comments:
[TEST] don't wait for all cluster info in the explain API, just assert
an upper and lower bound

time:
2017-01-02T23:26:19Z
class:
comments:
[TEST] mute backwards compatability tests for explain API until 5.2
snapshot builds can be published again

time:
2017-01-02T23:18:09Z
class:
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainIT.java
comments:
[TEST] fix explain API awaiting info explanation check

time:
2017-01-02T20:24:01Z
class:
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainIT.java
comments:
[TEST] fix explain API test to allow for either awaiting info state or
no valid shard copy

time:
2017-01-02T19:05:09Z
class:
comments:
Remove leftover checkstyle suppression

This commit removes a leftover checkstyle suppression for a source file
that was temporarily forked into the codebase to hack around a bug in
Log4j. When that source file was removed, the suppression was left
behind.

time:
2017-01-02T18:28:32Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplanation.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/NodeExplanation.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/TransportClusterAllocationExplainAction.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AbstractAllocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocateUnassignedDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/MoveDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RoutingAllocation.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/ShardAllocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/ShardsAllocator.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AllocationDeciders.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/Decision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/EnableAllocationDecider.java
core/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterAllocationExplainAction.java
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainActionTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainIT.java
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainRequestTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplanationTests.java
core/src/test/java/org/elasticsearch/cluster/ClusterModuleTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AllocateUnassignedDecisionTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AllocationDecisionTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/BalanceConfigurationTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/BalancedSingleShardTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/MoveDecisionTests.java
comments:
Cluster Explain API uses the allocation process to explain shard allocation decisions (#22182)

This PR completes the refactoring of the cluster allocation explain API and improves it in the following two high-level ways:

 1. The explain API now uses the same allocators that the AllocationService uses to make shard allocation decisions. Prior to this PR, the explain API would run the deciders against each node for the shard in question, but this was not executed on the same code path as the allocators, and many of the scenarios in shard allocation were not captured due to not executing through the same code paths as the allocators.

 2. The APIs have changed, both on the Java and JSON level, to accurately capture the decisions made by the system. The APIs also now report on shard moving and rebalancing decisions, whereas the previous API did not report decisions for moving shards which cannot remain on their current node or rebalancing shards to form a more balanced cluster.

Note: this change affects plugin developers who may have a custom implementation of the ShardsAllocator interface. The method weighShards has been removed and no longer has any utility. In order to support the new explain API, however, a custom implementation of ShardsAllocator must now implement ShardAllocationDecision decideShardAllocation(ShardRouting shard, RoutingAllocation allocation) which provides a decision and explanation for allocating a single shard. For implementations that do not support explaining a single shard allocation via the cluster allocation explain API, this method can simply return an UnsupportedOperationException.

time:
2016-12-31T08:24:44Z
class:
core/src/main/java/org/elasticsearch/common/ParseFieldMatcher.java
core/src/main/java/org/elasticsearch/search/suggest/SuggestionBuilder.java
comments:
Remove unused ParseFieldMatcher#match method

time:
2016-12-31T08:24:44Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java
core/src/main/java/org/elasticsearch/index/mapper/CompletionFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ParentFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/support/QueryParsers.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestClearIndicesCacheAction.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/ip/IpRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/GND.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/NXYSignificanceHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/SuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/LinearInterpolation.java
core/src/test/java/org/elasticsearch/search/aggregations/support/IncludeExcludeTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestUpdateByQueryAction.java
comments:
Remove some usages of ParseFieldMatcher in favour of using ParseField directly

Relates to #19552
Relates to #22130

time:
2016-12-30T19:27:09Z
class:
core/src/main/java/org/elasticsearch/cluster/AbstractNamedDiffable.java
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/DiffableUtils.java
core/src/main/java/org/elasticsearch/cluster/NamedDiff.java
core/src/main/java/org/elasticsearch/cluster/NamedDiffable.java
core/src/main/java/org/elasticsearch/cluster/NamedDiffableValueSerializer.java
core/src/main/java/org/elasticsearch/cluster/SnapshotDeletionsInProgress.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java
core/src/test/java/org/elasticsearch/cluster/serialization/ClusterSerializationTests.java
comments:
Add a generic way of checking version before serializing custom cluster object

In #22313 we added a check that prevents the SnapshotDeletionsInProgress custom cluster state objects from being sent to older elasticsearch nodes. This commits make this check generic and available to other cluster state custom objects if needed.

time:
2016-12-30T17:57:47Z
class:
core/src/main/java/org/elasticsearch/index/query/QueryParseContext.java
comments:
fix compiler warning on access to static field using `this`

time:
2016-12-30T17:57:47Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/ParseFieldRegistry.java
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryParseContext.java
core/src/main/java/org/elasticsearch/index/snapshots/blobstore/BlobStoreIndexShardSnapshot.java
core/src/main/java/org/elasticsearch/index/snapshots/blobstore/BlobStoreIndexShardSnapshots.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeAction.java
core/src/main/java/org/elasticsearch/search/aggregations/Aggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/support/IncludeExclude.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/models/HoltWintersModel.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/FetchSourceContext.java
core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/SuggestBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/SmoothingModel.java
core/src/main/java/org/elasticsearch/search/suggest/term/TermSuggestionBuilder.java
core/src/test/java/org/elasticsearch/search/suggest/CustomSuggesterSearchIT.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/matrix/stats/MatrixStatsParser.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/support/MultiValuesSourceParser.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestUpdateByQueryAction.java
comments:
Remove some more usages of ParseFieldMatcher in favour of using ParseField directly

Relates to #19552
Relates to #22130

time:
2016-12-30T17:57:47Z
class:
core/src/main/java/org/elasticsearch/index/query/BoolQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/BoostingQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ConstantScoreQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/DisMaxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ExistsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/FieldMaskingSpanQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/FuzzyQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoPolygonQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoShapeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/HasChildQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/HasParentQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchNoneQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchPhrasePrefixQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchPhraseQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/NestedQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ParentIdQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/PrefixQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/RangeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/RegexpQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanContainingQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanFirstQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanMultiTermQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanNearQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanNotQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanOrQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanTermQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanWithinQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TermQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TypeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/WildcardQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/WrapperQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java
core/src/main/java/org/elasticsearch/search/rescore/RescoreBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/Laplace.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/StupidBackoff.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java
comments:
Remove some more usages of ParseFieldMatcher in favour of using ParseField directly

Relates to #19552
Relates to #22130

time:
2016-12-30T17:57:47Z
class:
core/src/main/java/org/elasticsearch/index/query/functionscore/DecayFunctionParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/BucketHelpers.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/BucketMetricsParser.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/percentile/PercentilesBucketPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/stats/extended/ExtendedStatsBucketParser.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketscript/BucketScriptPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketselector/BucketSelectorPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/cumulativesum/CumulativeSumPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/derivative/DerivativePipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/MovAvgPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/serialdiff/SerialDiffPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/support/MultiValuesSourceParser.java
comments:
Remove some usages of ParseFieldMatcher in favour of using ParseField directly

Relates to #19552
Relates to #22130

time:
2016-12-30T17:50:17Z
class:
comments:
Descriptions for scripting enabled (#22388)

The `Script source settings` section currently states that `false` means scripting is ENABLED.
The other sections seem to indicate that `false` means scripting is DISABLED.

If the current documentation is correct, that would imply that `inline` and `stored` scripting are ENABLED by default, which seems to conflict with all the other sections in the document.

time:
2016-12-30T10:18:02Z
class:
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
comments:
The percentage of deleted docs needs to be strictly over 10% for deleted docs to be expunged.

time:
2016-12-30T09:12:24Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorTests.java
comments:
Fix TermsAggregatorTests to not use LuceneTestCase.newSearcher since it needs a DirectoryReader.

time:
2016-12-30T08:48:24Z
class:
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingTests.java
comments:
Dynamic `date` fields should use the `format` that was used to detect it is a date. (#22174)

Unless the dynamic templates define an explicit format in the mapping
definition: in that case the explicit mapping should have precedence.

Closes #9410

time:
2016-12-30T08:36:10Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/main/java/org/elasticsearch/index/analysis/AnalysisRegistry.java
core/src/main/java/org/elasticsearch/index/analysis/CustomAnalyzer.java
core/src/main/java/org/elasticsearch/index/analysis/CustomNormalizerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/IndexAnalyzers.java
core/src/main/java/org/elasticsearch/index/mapper/KeywordFieldMapper.java
core/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java
core/src/test/java/org/elasticsearch/gateway/GatewayIndexStateIT.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/analysis/AnalysisRegistryTests.java
core/src/test/java/org/elasticsearch/index/analysis/CustomNormalizerTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/mapper/KeywordFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/KeywordFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/ParentFieldMapperTests.java
comments:
Add the ability to set an analyzer on keyword fields. (#21919)

This adds a new `normalizer` property to `keyword` fields that pre-processes the
field value prior to indexing, but without altering the `_source`. Note that
only the normalization components that work on a per-character basis are
applied, so for instance stemming filters will be ignored while lowercasing or
ascii folding will be applied.

Closes #18064

time:
2016-12-29T17:41:26Z
class:
comments:
Docs fix native script usage in 5.x (#22362)

time:
2016-12-29T16:05:47Z
class:
core/src/main/java/org/elasticsearch/indices/recovery/RecoveriesCollection.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
comments:
Free shard resources when recovery reset is cancelled

Resetting a recovery consists of resetting the old recovery target and replacing it by a new recovery target object. This is done on the Cancellable threads of
the new recovery target. If the new recovery target is already cancelled before or while this happens, for example due to shard closing or recovery source
changing, we have to make sure that the old recovery target object frees all shard resources.

Relates to #22325

time:
2016-12-29T10:05:28Z
class:
comments:
Docs: Added link from bool and constant score query to filter context

Closes #22353

time:
2016-12-29T09:58:15Z
class:
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveriesCollection.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySettings.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
core/src/test/java/org/elasticsearch/indices/recovery/IndexRecoveryIT.java
core/src/test/java/org/elasticsearch/recovery/RecoveriesCollectionTests.java
comments:
Use a fresh recovery id when retrying recoveries (#22325)

Recoveries are tracked on the target node using RecoveryTarget objects that are kept in a RecoveriesCollection. Each recovery has a unique id that is communicated from the recovery target to the source so that it can call back to the target and execute actions using the right recovery context. In case of a network disconnect, recoveries are retried. At the moment, the same recovery id is reused for the restarted recovery. This can lead to confusion though if the disconnect is unilateral and the recovery source continues with the recovery process. If the target reuses the same recovery id while doing a second attempt, there might be two concurrent recoveries running on the source for the same target.

This commit changes the recovery retry process to use a fresh recovery id. It also waits for the first recovery attempt to be fully finished (all resources locally freed) to further prevent concurrent access to the shard. Finally, in case of primary relocation, it also fails a second recovery attempt if the first attempt moved past the finalization step, as the relocation source can then be moved to RELOCATED state and start indexing as primary into the target shard (see TransportReplicationAction). Resetting the target shard in this state could mean that indexing is halted until the recovery retry attempt is completed and could also destroy existing documents indexed and acknowledged before the reset.

Relates to #22043

time:
2016-12-28T18:32:35Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/get/GetAliasesResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetMappingsResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/get/GetIndexTemplatesResponse.java
core/src/main/java/org/elasticsearch/action/ingest/GetPipelineResponse.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/cluster/AbstractDiffable.java
core/src/main/java/org/elasticsearch/cluster/AbstractNamedDiffable.java
core/src/main/java/org/elasticsearch/cluster/ClusterModule.java
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/Diffable.java
core/src/main/java/org/elasticsearch/cluster/DiffableUtils.java
core/src/main/java/org/elasticsearch/cluster/NamedDiff.java
core/src/main/java/org/elasticsearch/cluster/RestoreInProgress.java
core/src/main/java/org/elasticsearch/cluster/SnapshotDeletionsInProgress.java
core/src/main/java/org/elasticsearch/cluster/SnapshotsInProgress.java
core/src/main/java/org/elasticsearch/cluster/block/ClusterBlocks.java
core/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexGraveyard.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MappingMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/RepositoriesMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/RepositoryMetaData.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodes.java
core/src/main/java/org/elasticsearch/cluster/routing/IndexRoutingTable.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java
core/src/main/java/org/elasticsearch/common/io/stream/NamedWriteableAwareStreamInput.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java
core/src/main/java/org/elasticsearch/common/util/IndexFolderUpgrader.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/zen/MembershipAction.java
core/src/main/java/org/elasticsearch/discovery/zen/PublishClusterStateAction.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/env/NodeEnvironment.java
core/src/main/java/org/elasticsearch/gateway/LocalAllocateDangledIndices.java
core/src/main/java/org/elasticsearch/gateway/MetaDataStateFormat.java
core/src/main/java/org/elasticsearch/gateway/MetaStateService.java
core/src/main/java/org/elasticsearch/gateway/TransportNodesListGatewayMetaState.java
core/src/main/java/org/elasticsearch/gateway/TransportNodesListGatewayStartedShards.java
core/src/main/java/org/elasticsearch/index/seqno/SeqNoStats.java
core/src/main/java/org/elasticsearch/index/shard/ShardPath.java
core/src/main/java/org/elasticsearch/index/snapshots/blobstore/BlobStoreIndexShardSnapshot.java
core/src/main/java/org/elasticsearch/index/snapshots/blobstore/BlobStoreIndexShardSnapshots.java
core/src/main/java/org/elasticsearch/indices/store/TransportNodesListShardStoreMetaData.java
core/src/main/java/org/elasticsearch/ingest/IngestMetadata.java
core/src/main/java/org/elasticsearch/ingest/PipelineConfiguration.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/DiscoveryPlugin.java
core/src/main/java/org/elasticsearch/plugins/RepositoryPlugin.java
core/src/main/java/org/elasticsearch/repositories/RepositoriesModule.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreFormat.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/repositories/blobstore/ChecksumBlobStoreFormat.java
core/src/main/java/org/elasticsearch/repositories/fs/FsRepository.java
core/src/main/java/org/elasticsearch/repositories/uri/URLRepository.java
core/src/main/java/org/elasticsearch/script/ScriptMetaData.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotInfo.java
core/src/main/java/org/elasticsearch/tribe/TribeService.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TaskManagerTestCase.java
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/cluster/ClusterChangedEventTests.java
core/src/test/java/org/elasticsearch/cluster/ClusterStateDiffIT.java
core/src/test/java/org/elasticsearch/cluster/metadata/IndexGraveyardTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/IndexMetaDataTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaDataTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataTests.java
core/src/test/java/org/elasticsearch/cluster/serialization/ClusterSerializationTests.java
core/src/test/java/org/elasticsearch/cluster/serialization/DiffableTests.java
core/src/test/java/org/elasticsearch/common/util/IndexFolderUpgraderTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryModuleTests.java
core/src/test/java/org/elasticsearch/discovery/zen/PublishClusterStateActionTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryIT.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/gateway/DanglingIndicesStateTests.java
core/src/test/java/org/elasticsearch/gateway/GatewayMetaStateTests.java
core/src/test/java/org/elasticsearch/gateway/MetaDataStateFormatTests.java
core/src/test/java/org/elasticsearch/gateway/MetaStateServiceTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/ingest/IngestMetadataTests.java
core/src/test/java/org/elasticsearch/script/ScriptMetaDataTests.java
core/src/test/java/org/elasticsearch/snapshots/BlobStoreFormatIT.java
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/mockstore/MockRepository.java
core/src/test/java/org/elasticsearch/tribe/TribeIT.java
core/src/test/java/org/elasticsearch/tribe/TribeServiceTests.java
plugins/discovery-azure-classic/src/main/java/org/elasticsearch/plugin/discovery/azure/classic/AzureDiscoveryPlugin.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/plugin/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/discovery-gce/src/main/java/org/elasticsearch/plugin/discovery/gce/GceDiscoveryPlugin.java
plugins/repository-azure/src/main/java/org/elasticsearch/plugin/repository/azure/AzureRepositoryPlugin.java
plugins/repository-azure/src/main/java/org/elasticsearch/repositories/azure/AzureRepository.java
plugins/repository-azure/src/test/java/org/elasticsearch/repositories/azure/AzureRepositorySettingsTests.java
plugins/repository-gcs/src/main/java/org/elasticsearch/plugin/repository/gcs/GoogleCloudStoragePlugin.java
plugins/repository-gcs/src/main/java/org/elasticsearch/repositories/gcs/GoogleCloudStorageRepository.java
plugins/repository-hdfs/src/main/java/org/elasticsearch/repositories/hdfs/HdfsPlugin.java
plugins/repository-hdfs/src/main/java/org/elasticsearch/repositories/hdfs/HdfsRepository.java
plugins/repository-s3/src/main/java/org/elasticsearch/plugin/repository/s3/S3RepositoryPlugin.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3RepositoryTests.java
qa/rolling-upgrade/src/test/java/org/elasticsearch/upgrades/UpgradeClusterClientYamlTestSuiteIT.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/main/java/org/elasticsearch/test/OldIndexUtils.java
test/framework/src/main/java/org/elasticsearch/test/TestCustomMetaData.java
test/framework/src/main/java/org/elasticsearch/test/discovery/TestZenDiscovery.java
test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
test/framework/src/test/java/org/elasticsearch/search/MockSearchServiceTests.java
comments:
Remove PROTO-based custom cluster state components

Switches custom cluster state components from PROTO-based de-serialization to named objects based de-serialization

time:
2016-12-28T17:50:10Z
class:
comments:
Fixing a second "second" reference in docs (#22345)

time:
2016-12-27T21:56:01Z
class:
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolatorFieldMapper.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorFieldMapperTests.java
comments:
percolator: Fix NPE in percolator's 'now' range check for percolator queries with range queries.

Closes #22355

time:
2016-12-27T20:52:27Z
class:
comments:
Fix bwc integ test that tries to perform a term aggs on a scaled_float. This is broken when a node with version prior to 5.2.0 is used with another node > 5.2.0. This is because scaled_float fields are considered as longs in version < 5.2.0. This is fixed in 5.2.0 where scaled_float are recognized as doubles.

time:
2016-12-27T18:57:11Z
class:
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/KeyValueProcessor.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/KeyValueProcessorTests.java
comments:
fix index out of bounds error in KV Processor (#22288)

- checks for index-out-of-bounds
- added unit tests for failed `field_split` and `value_split` scenarios

missed this test in #22272.

time:
2016-12-27T08:23:22Z
class:
core/src/main/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapper.java
core/src/test/java/org/elasticsearch/index/mapper/ScaledFloatFieldTypeTests.java
comments:
Fix scaled_float numeric type in aggregations (#22351)

`scaled_float` should be used as DOUBLE in aggregations but currently they are used as LONG.
This change fixes this issue and adds a simple it test for it.

Fixes #22350

time:
2016-12-26T19:19:11Z
class:
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
comments:
Fix IndexShardTests.testDocStats.

time:
2016-12-26T15:05:27Z
class:
core/src/test/java/org/elasticsearch/indices/memory/breaker/CircuitBreakerServiceIT.java
comments:
Add trace logging to CircuitBreakerServiceIT.testParentChecking.

time:
2016-12-26T13:55:22Z
class:
core/src/main/java/org/elasticsearch/common/logging/DeprecationLogger.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
Make ESTestCase resilient to initialization errors.

time:
2016-12-26T10:22:09Z
class:
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationResponseTests.java
comments:
Fix LineLength issues.

time:
2016-12-26T09:34:50Z
class:
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationResponseTests.java
test/framework/src/main/java/org/elasticsearch/test/EqualsHashCodeTestUtils.java
comments:
Fix mutate function to always actually modify the failure object.

time:
2016-12-26T00:28:01Z
class:
core/src/main/java/org/elasticsearch/cluster/SnapshotDeletionsInProgress.java
core/src/main/java/org/elasticsearch/cluster/SnapshotsInProgress.java
comments:
Updates SnapshotDeletionsInProgress version number introduced to 5.2.0

time:
2016-12-26T00:00:20Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/delete/TransportDeleteSnapshotAction.java
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/DiffableUtils.java
core/src/main/java/org/elasticsearch/cluster/SnapshotDeletionsInProgress.java
core/src/main/java/org/elasticsearch/cluster/SnapshotsInProgress.java
core/src/main/java/org/elasticsearch/repositories/Repository.java
core/src/main/java/org/elasticsearch/repositories/RepositoryData.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/snapshots/RestoreService.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java
core/src/test/java/org/elasticsearch/cluster/ClusterStateDiffIT.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataDeleteIndexServiceTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/repositories/RepositoryDataTests.java
core/src/test/java/org/elasticsearch/repositories/blobstore/BlobStoreRepositoryTests.java
core/src/test/java/org/elasticsearch/snapshots/MinThreadsSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
comments:
Synchronize snapshot deletions on the cluster state (#22313)

Before, snapshot/restore would synchronize all operations on the cluster
state except for deleting snapshots.  This meant that only one
snapshot/restore operation would be allowed in the cluster at any given
time, except for deletions - there could be two or more snapshot
deletions running at the same time, or a deletion could be running,
unbeknowest to the rest of the cluster, and thus a snapshot or restore
would be allowed at the same time as the snapshot deletion was still in
progress.  This could cause any number of synchronization issues,
including the situation where a snapshot that was deleted could reappear
in the index-N file, even though its data was no longer present in the
repository.

This commit introduces a new custom type to the cluster state to
represent deletions in progress.  Now, another deletion cannot start if
a deletion is currently in progress.  Similarily, a snapshot or restore
cannot be started if a deletion is currently in progress.  In each case,
if attempting to run another snapshot/restore operation while a deletion
is in progress, a ConcurrentSnapshotExecutionException will be thrown.
This is the same exception thrown if trying to snapshot while another
snapshot is in progress, or restore while a snapshot is in progress.

Closes #19957

time:
2016-12-23T23:14:36Z
class:
client/transport/src/main/java/org/elasticsearch/transport/client/PreBuiltTransportClient.java
comments:
Add comment clarifying property setting in client

This commit adds a comment clarifying why we do not catch a security
exception in the pre-built transport client.

time:
2016-12-23T20:20:42Z
class:
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
comments:
Fix doc stats test when deleting all docs

This commit fixes an issue with IndexShardTests#testDocStats when the
number of deleted docs is equal to the number of docs. In this case,
Luence will remove the underlying segment tripping an assertion on the
number of deleted docs.

time:
2016-12-23T18:57:02Z
class:
core/src/test/java/org/elasticsearch/common/settings/CreateKeyStoreCommandTests.java
comments:
Fix getBytes invocation to use explicit charset

time:
2016-12-23T16:50:43Z
class:
core/src/main/java/org/elasticsearch/index/translog/Translog.java
comments:
Fix delete op serialization format constant

The delete op serizliation format constant for 5.x was off by one. This
commit fixes this, and cleans up the handling of these formats.

time:
2016-12-23T15:04:19Z
class:
comments:
Merge pull request #22235 from dadoonet/doc/dbq-java-api

Add documentation for Delete By Query Java API

time:
2016-12-23T14:44:56Z
class:
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/engine/ShadowEngineTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/indices/stats/IndexStatsIT.java
comments:
Use reader for doc stats

Today we try to pull stats from index writer but we do not get a
consistent view of stats. Under heavy indexing, this inconsistency can
be very skewed indeed. In particular, it can lead to the number of
deleted docs being reported as negative and this leads to serialization
issues. Instead, we should provide a consistent view of the stats by
using an index reader.

Relates #22317

time:
2016-12-23T13:17:16Z
class:
comments:
build: do not use cached snapshots for backwards compatibility tests

The backwards compatibility tests rely on gradle's built-in mechanisms for resolving dependencies
to get the zip of the older version we test against. By default, this will cache snapshots for
24 hours, which can lead to unexpected failures in CI. This change makes the special configurations
for backwards compatibility always update their snapshots by setting the amount of time to cache
to 0 seconds.

time:
2016-12-23T12:55:12Z
class:
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
comments:
TransportService should capture listener before spawning background notification task

Not doing this made it difficult to establish a happens before relationship between connecting to a node and adding a listeners. Causing test code like this to fail sproadically:

```
        // connection to reuse
        handleA.transportService.connectToNode(handleB.node);

        // install a listener to check that no new connections are made
        handleA.transportService.addConnectionListener(new TransportConnectionListener() {
            @Override
            public void onConnectionOpened(DiscoveryNode node) {
                fail("should not open any connections. got [" + node + "]");
            }
        });

```

relates to #22277

time:
2016-12-23T12:51:35Z
class:
test/framework/src/main/java/org/elasticsearch/test/junit/listeners/LoggingListener.java
test/framework/src/test/java/org/elasticsearch/test/test/LoggingListenerTests.java
comments:
Reject invalid test logging annotations

Today we silently ignore invalid test logging annotations. This commit
rejects these annotations, failing the processing of the annotation and
aborting the test.

time:
2016-12-23T12:51:19Z
class:
test/framework/src/main/java/org/elasticsearch/test/junit/listeners/LoggingListener.java
test/framework/src/test/java/org/elasticsearch/test/test/LoggingListenerTests.java
comments:
Apply logging levels in hierarchical order

This commit adds a test for applying logging levels in hierarchical
order, and addresses an issue with restoring the logging levels at the
end of a test or suite.

time:
2016-12-23T11:23:52Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateTaskExecutor.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateUpdateTask.java
core/src/main/java/org/elasticsearch/cluster/LocalClusterUpdateTask.java
core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/discovery/zen/NodeJoinController.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/indices/store/IndicesStore.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/snapshots/RestoreService.java
core/src/main/java/org/elasticsearch/tribe/TribeService.java
core/src/test/java/org/elasticsearch/cluster/action/shard/ShardFailedClusterStateTaskExecutorTests.java
core/src/test/java/org/elasticsearch/cluster/health/ClusterStateHealthTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeJoinControllerTests.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeRemovalClusterStateTaskExecutorTests.java
core/src/test/java/org/elasticsearch/indices/store/IndicesStoreIntegrationIT.java
core/src/test/java/org/elasticsearch/tribe/TribeIT.java
test/framework/src/main/java/org/elasticsearch/test/ClusterServiceUtils.java
test/framework/src/main/java/org/elasticsearch/test/disruption/BlockClusterStateProcessing.java
test/framework/src/main/java/org/elasticsearch/test/disruption/SlowClusterStateProcessing.java
comments:
Separate cluster update tasks that are published from those that are not (#21912)

This commit factors out the cluster state update tasks that are published (ClusterStateUpdateTask) from those that are not (LocalClusterUpdateTask), serving as a basis for future refactorings to separate the publishing mechanism out of ClusterService.

time:
2016-12-23T10:30:19Z
class:
comments:
Merge pull request #22300 from dadoonet/doc/ingest-attachment

Adds more information about ingest attachment properties extraction

time:
2016-12-23T10:28:12Z
class:
comments:
Makes more obvious that we expect an array

time:
2016-12-23T09:33:23Z
class:
comments:
Merge pull request #22310 from gameldar/patch-3

Add ingest-attachment-with-arrays section to ingest attachments doc

time:
2016-12-23T08:38:20Z
class:
comments:
Only run the unmapped+missing tests on 5.2+.

time:
2016-12-23T08:15:11Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
comments:
UnicastZenPing add trace logging on connection opening

time:
2016-12-23T08:03:43Z
class:
test/framework/src/main/java/org/elasticsearch/test/junit/listeners/LoggingListener.java
comments:
process TestLogging annotation value in prefix-first order

We have to sort the logger names so they wouldn't override each other. Processing org.elasticsearch:DEBUG after org.elasticsearch.transport:TRACE resets the setting of the later

time:
2016-12-23T05:51:14Z
class:
comments:
Fix the ingest attachment array examples

Fix up the ingest attachment array handling example so they are full
examples and validated by the build system correctly.

time:
2016-12-23T01:08:02Z
class:
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/rest/BytesRestResponse.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetMappingAction.java
comments:
Enable assertions in integration tests

When starting a standalone cluster, we do not able assertions. This is
problematic because it means that we miss opportunities to catch
bugs. This commit enables assertions for standalone integration tests,
and fixes a couple bugs that were uncovered by enabling these.

Relates #22334

time:
2016-12-23T00:28:34Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapException.java
core/src/main/java/org/elasticsearch/bootstrap/Elasticsearch.java
core/src/main/java/org/elasticsearch/common/settings/AddStringKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/CreateKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/KeyStoreCli.java
core/src/main/java/org/elasticsearch/common/settings/KeyStoreWrapper.java
core/src/main/java/org/elasticsearch/common/settings/ListKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/RemoveSettingKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/SecureSetting.java
core/src/main/java/org/elasticsearch/common/settings/SecureString.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/main/java/org/elasticsearch/node/internal/InternalSettingsPreparer.java
core/src/test/java/org/elasticsearch/bootstrap/ElasticsearchCliTests.java
core/src/test/java/org/elasticsearch/common/settings/AddStringKeyStoreCommandTests.java
core/src/test/java/org/elasticsearch/common/settings/CreateKeyStoreCommandTests.java
core/src/test/java/org/elasticsearch/common/settings/KeyStoreCommandTestCase.java
core/src/test/java/org/elasticsearch/common/settings/ListKeyStoreCommandTests.java
core/src/test/java/org/elasticsearch/common/settings/RemoveSettingKeyStoreCommandTests.java
qa/evil-tests/src/test/java/org/elasticsearch/bootstrap/EvilElasticsearchCliTests.java
test/framework/src/main/java/org/elasticsearch/bootstrap/ESElasticsearchCliTestCase.java
comments:
Settings: Add infrastructure for elasticsearch keystore

This change is the first towards providing the ability to store
sensitive settings in elasticsearch. It adds the
`elasticsearch-keystore` tool, which allows managing a java keystore.
The keystore is loaded upon node startup in Elasticsearch, and used by
the Setting infrastructure when a setting is configured as secure.

There are a lot of caveats to this PR. The most important is it only
provides the tool and setting infrastructure for secure strings. It does
not yet provide for keystore passwords, keypairs, certificates, or even
convert any existing string settings to secure string settings. Those
will all come in follow up PRs. But this PR was already too big, so this
at least gets a basic version of the infrastructure in.

The two main things to look at.  The first is the `SecureSetting` class,
which extends `Setting`, but removes the assumption for the raw value of the
setting to be a string. SecureSetting provides, for now, a single
helper, `stringSetting()` to create a SecureSetting which will return a
SecureString (which is like String, but is closeable, so that the
underlying character array can be cleared). The second is the
`KeyStoreWrapper` class, which wraps the java `KeyStore` to provide a
simpler api (we do not need the entire keystore api) and also extend
the serialized format to add metadata needed for loading the keystore
with no assumptions about keystore type (so that we can change this in
the future) as well as whether the keystore has a password (so that we
can know whether prompting is necessary when we add support for keystore
passwords).

time:
2016-12-22T19:25:09Z
class:
comments:
Merge pull request #22332 from tbrooks8/add_clean_idea_build_task

Add cleanIdeaBuildDir gradle task that cleans the idea build directory

time:
2016-12-22T18:02:39Z
class:
core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java
core/src/test/java/org/elasticsearch/common/io/stream/BytesStreamsTests.java
comments:
Support negative numbers in writeVLong (#22314)

We don't *want* to use negative numbers with `writeVLong`
so throw an exception when we try. On the other
hand unforeseen bugs might cause us to write negative numbers (some versions of Elasticsearch don't have the exception, only an assertion)
so this fixes `readVLong` so that instead of reading a wrong
value and corrupting the stream it reads the negative value.

time:
2016-12-22T17:45:44Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
comments:
UnicastZenPing's PingingRound should prevent opening connections after being closed

This may cause them to leak. Provisioning for it was made in #22277 but sadly a crucial ensureOpen call was forgotten

time:
2016-12-22T17:24:13Z
class:
comments:
Add task to clean idea build directory. Make cleanIdea task invoke it.

time:
2016-12-22T17:10:15Z
class:
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
comments:
add trace logging to UnicastZenPingTests.testResolveReuseExistingNodeConnections

time:
2016-12-22T16:24:00Z
class:
core/src/main/java/org/elasticsearch/ingest/ConfigurationUtils.java
core/src/test/java/org/elasticsearch/ingest/ConfigurationUtilsTests.java
comments:
Adds ingest processor headers to exception for unknown processor. (#22315)

Optimistically check for `tag` of an unknown processor for better tracking of which
processor declaration is to blame in an invalid configuration.

Closes #21429.

time:
2016-12-22T16:00:34Z
class:
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
distribution/deb/src/test/java/org/elasticsearch/test/rest/DebClientYamlTestSuiteIT.java
distribution/integ-test-zip/src/test/java/org/elasticsearch/test/rest/IntegTestZipClientYamlTestSuiteIT.java
distribution/rpm/src/test/java/org/elasticsearch/test/rest/RpmClientYamlTestSuiteIT.java
distribution/tar/src/test/java/org/elasticsearch/test/rest/TarClientYamlTestSuiteIT.java
distribution/zip/src/test/java/org/elasticsearch/test/rest/ZipClientYamlTestSuiteIT.java
docs/src/test/java/org/elasticsearch/smoketest/DocsClientYamlTestSuiteIT.java
modules/aggs-matrix-stats/src/test/java/org/elasticsearch/search/aggregations/matrix/MatrixStatsClientYamlTestSuiteIT.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/IngestCommonClientYamlTestSuiteIT.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/LangExpressionClientYamlTestSuiteIT.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/LangMustacheClientYamlTestSuiteIT.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/LangPainlessClientYamlTestSuiteIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorClientYamlTestSuiteIT.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexClientYamlTestSuiteIT.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4ClientYamlTestSuiteIT.java
plugins/analysis-icu/src/test/java/org/elasticsearch/index/analysis/IcuClientYamlTestSuiteIT.java
plugins/analysis-kuromoji/src/test/java/org/elasticsearch/index/analysis/KuromojiClientYamlTestSuiteIT.java
plugins/analysis-phonetic/src/test/java/org/elasticsearch/index/analysis/PhoneticClientYamlTestSuiteIT.java
plugins/analysis-smartcn/src/test/java/org/elasticsearch/index/analysis/SmartCNClientYamlTestSuiteIT.java
plugins/analysis-stempel/src/test/java/org/elasticsearch/index/analysis/StempelClientYamlTestSuiteIT.java
plugins/analysis-ukrainian/src/test/java/org/elasticsearch/index/analysis/UkrainianClientYamlTestSuiteIT.java
plugins/discovery-azure-classic/src/test/java/org/elasticsearch/discovery/azure/classic/DiscoveryAzureClassicClientYamlTestSuiteIT.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/cloud/aws/CloudAwsClientYamlTestSuiteIT.java
plugins/discovery-file/src/test/java/org/elasticsearch/discovery/file/FileBasedDiscoveryClientYamlTestSuiteIT.java
plugins/discovery-gce/src/test/java/org/elasticsearch/discovery/gce/DiscoveryGceClientYamlTestSuiteIT.java
plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/IngestAttachmentClientYamlTestSuiteIT.java
plugins/ingest-geoip/src/test/java/org/elasticsearch/ingest/geoip/IngestGeoIpClientYamlTestSuiteIT.java
plugins/ingest-user-agent/src/test/java/org/elasticsearch/ingest/useragent/IngestUserAgentClientYamlTestSuiteIT.java
plugins/jvm-example/src/test/java/org/elasticsearch/plugin/example/JvmExampleClientYamlTestSuiteIT.java
plugins/mapper-murmur3/src/test/java/org/elasticsearch/index/mapper/murmur3/MapperMurmur3ClientYamlTestSuiteIT.java
plugins/mapper-size/src/test/java/org/elasticsearch/index/mapper/size/MapperSizeClientYamlTestSuiteIT.java
plugins/repository-azure/src/test/java/org/elasticsearch/repositories/azure/RepositoryAzureClientYamlTestSuiteIT.java
plugins/repository-gcs/src/test/java/org/elasticsearch/repositories/gcs/RepositoryGcsClientYamlTestSuiteIT.java
plugins/repository-hdfs/src/test/java/org/elasticsearch/repositories/hdfs/RepositoryHdfsClientYamlTestSuiteIT.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/RepositoryS3ClientYamlTestSuiteIT.java
plugins/store-smb/src/test/java/org/elasticsearch/index/store/StoreSmbClientYamlTestSuiteIT.java
qa/backwards-5.0/src/test/java/org/elasticsearch/backwards/Backwards50ClientYamlTestSuiteIT.java
qa/rolling-upgrade/src/test/java/org/elasticsearch/upgrades/UpgradeClusterClientYamlTestSuiteIT.java
qa/smoke-test-ingest-disabled/src/test/java/org/elasticsearch/smoketest/SmokeTestIngestDisabledClientYamlTestSuiteIT.java
qa/smoke-test-ingest-with-all-dependencies/src/test/java/org/elasticsearch/smoketest/SmokeTestIngestWithAllDepsClientYamlTestSuiteIT.java
qa/smoke-test-multinode/src/test/java/org/elasticsearch/smoketest/SmokeTestMultiNodeClientYamlTestSuiteIT.java
qa/smoke-test-plugins/src/test/java/org/elasticsearch/smoketest/SmokeTestPluginsClientYamlTestSuiteIT.java
qa/smoke-test-reindex-with-painless/src/test/java/org/elasticsearch/smoketest/SmokeTestReindexWithPainlessClientYamlTestSuiteIT.java
qa/smoke-test-tribe-node/src/test/java/org/elasticsearch/tribe/TribeClientYamlTestSuiteIT.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ESClientYamlSuiteTestCase.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/ClientYamlTestFragmentParser.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/ClientYamlTestParseException.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/ClientYamlTestSectionParser.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/ClientYamlTestSuiteParseContext.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/ClientYamlTestSuiteParser.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/DoSectionParser.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/GreaterThanEqualToParser.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/GreaterThanParser.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/IsFalseParser.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/IsTrueParser.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/LengthParser.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/LessThanOrEqualToParser.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/LessThanParser.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/MatchParser.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/SetSectionParser.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/SetupSectionParser.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/SkipSectionParser.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/TeardownSectionParser.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/ClientYamlTestSection.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/ClientYamlTestSuite.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/DoSection.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/ExecutableSection.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/GreaterThanAssertion.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/GreaterThanEqualToAssertion.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/IsFalseAssertion.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/IsTrueAssertion.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/LengthAssertion.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/LessThanAssertion.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/LessThanOrEqualToAssertion.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/MatchAssertion.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/ParserUtils.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/SetSection.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/SetupSection.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/SkipSection.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/TeardownSection.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/parser/DoSectionParserTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/parser/SkipSectionParserTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/parser/TestSectionParserTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/restspec/ClientYamlSuiteRestApiParserTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/AbstractClientYamlTestFragmentParserTestCase.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/AssertionTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/ClientYamlTestSectionTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/ClientYamlTestSuiteTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/DoSectionTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/SetSectionTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/SetupSectionTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/SkipSectionTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/TeardownSectionTests.java
comments:
Remove much ceremony from parsing client yaml test suites (#22311)

* Remove a checked exception, replacing it with `ParsingException`.
* Remove all Parser classes for the yaml sections, replacing them with static methods.
* Remove `ClientYamlTestFragmentParser`. Isn't used any more.
* Remove `ClientYamlTestSuiteParseContext`, replacing it with some static utility methods.

I did not rewrite the parsers using `ObjectParser` because I don't think it is worth it right now.

time:
2016-12-22T14:20:15Z
class:
core/src/main/java/org/elasticsearch/index/mapper/NumberFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/RangeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapper.java
core/src/test/java/org/elasticsearch/index/mapper/NumberFieldTypeTests.java
comments:
Support numeric bounds with decimal parts for long/integer/short/byte datatypes (#21972)

Close #21600

time:
2016-12-22T13:51:33Z
class:
core/src/main/java/org/elasticsearch/index/query/HasChildQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/HasParentQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java
core/src/main/java/org/elasticsearch/index/query/NestedQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/test/java/org/elasticsearch/index/query/HasChildQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/HasParentQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/InnerHitBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/NestedQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/child/ChildQuerySearchIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/InnerHitsIT.java
comments:
inner hits: Don't inline inner hits if the query the inner hits is inlined into can't resolve mappings and ignore_unmapped has been set to true

Closes #21620

time:
2016-12-22T13:50:54Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/InternalNumericMetricsAggregation.java
comments:
Fix stackoverflow error on InternalNumericMetricAggregation

time:
2016-12-22T13:35:59Z
class:
core/src/main/java/org/elasticsearch/common/Strings.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentParserTests.java
comments:
Date detection should not rely on a hardcoded set of characters. (#22171)

Currently we only apply date detection on strings that contain either `:`, `-`
or `/`. This commit inverses the heuristic in order to only apply date detection
on strings that are not parseable as a number, so that more date formats can be
used as dynamic dates formats.

Closes #1694

time:
2016-12-22T13:35:12Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/support/MissingValues.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceParserHelper.java
core/src/test/java/org/elasticsearch/search/aggregations/support/MissingValuesTests.java
comments:
`value_type` is useful regardless of scripting. (#22160)

Today we only expose `value_type` in scriptable aggregations, however it is
also useful with unmapped fields. I suspect we never noticed because
`value_type` was not documented (fixed) and most aggregations are scriptable.

Closes #20163

time:
2016-12-22T13:34:08Z
class:
core/src/main/java/org/elasticsearch/common/lucene/ShardCoreKeyMap.java
comments:
Improve concurrency of ShardCoreKeyMap. (#22316)

`ShardCoreKeyMap.add` is called on each segment for all search requests, which
means it might become a bottleneck under a cocurrent load of cheap search
requests since this method acquires a mutex. This change proposes to use a
`ConcurrentHashMap` which allows to only take the mutex in the case that the
`LeafReader` has never been seen before.

time:
2016-12-22T13:18:30Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregation.java
comments:
fixed jdocs and removed already fixed norelease

time:
2016-12-22T12:52:08Z
class:
comments:
Link directly to the attachments in arrays section

The link should be made to the relevant section of the ingest attachments documentation, rather than the top of the page.

time:
2016-12-22T10:49:18Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/InternalNumericMetricsAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/min/InternalMin.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/min/InternalMinTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractSerializingTestCase.java
test/framework/src/main/java/org/elasticsearch/test/AbstractStreamableTestCase.java
test/framework/src/main/java/org/elasticsearch/test/AbstractStreamableXContentTestCase.java
test/framework/src/main/java/org/elasticsearch/test/AbstractWireSerializingTestCase.java
comments:
Adds abstract test classes for serialisation (#22281)

This adds test classes that can be used to test the wire serialisation and (optionally) the XContent serialisation of objects that implement Streamable/Writeable and ToXContent.

These test classes will enable classes sich as InternalAggregation (or at least its implementations) to be tested in a consistent way when is comes to testing serialisation.

time:
2016-12-22T06:47:59Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportSingleItemBulkWriteAction.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionIngestTests.java
comments:
Add ingest tests for single item bulk action

time:
2016-12-22T06:46:56Z
class:
core/src/main/java/org/elasticsearch/action/delete/DeleteRequest.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
comments:
make index and delete requests composite

time:
2016-12-22T04:08:16Z
class:
core/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/ShadowEngine.java
core/src/main/java/org/elasticsearch/index/shard/TranslogRecoveryPerformer.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStatsTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/common/FieldMemoryStatsTests.java
core/src/test/java/org/elasticsearch/common/unit/ByteSizeValueTests.java
core/src/test/java/org/elasticsearch/common/unit/SizeValueTests.java
core/src/test/java/org/elasticsearch/common/unit/TimeValueTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ElectMasterServiceTests.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/fieldstats/FieldStatsTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/fielddata/FieldDataStatsTests.java
core/src/test/java/org/elasticsearch/index/get/GetResultTests.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/RangeFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/query/QueryShardContextTests.java
core/src/test/java/org/elasticsearch/index/seqno/GlobalCheckpointSyncActionTests.java
core/src/test/java/org/elasticsearch/index/suggest/stats/CompletionsStatsTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
core/src/test/java/org/elasticsearch/monitor/os/OsProbeTests.java
core/src/test/java/org/elasticsearch/monitor/os/OsStatsTests.java
core/src/test/java/org/elasticsearch/monitor/process/ProcessProbeTests.java
core/src/test/java/org/elasticsearch/nodesinfo/NodeInfoStreamingTests.java
core/src/test/java/org/elasticsearch/search/SearchRequestTests.java
core/src/test/java/org/elasticsearch/search/internal/ShardSearchTransportRequestTests.java
core/src/test/java/org/elasticsearch/search/rescore/QueryRescoreBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RoundTripTests.java
plugins/ingest-geoip/src/test/java/org/elasticsearch/ingest/geoip/GeoIpProcessorFactoryTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/test/java/org/elasticsearch/search/MockSearchServiceTests.java
comments:
Introduce translog no-op

As the translog evolves towards a full operations log as part of the
sequence numbers push, there is a need for the translog to be able to
represent operations for which a sequence number was assigned, but the
operation did not mutate the index. Examples of how this can arise are
operations that fail after the sequence number is assigned, and gaps in
this history that arise when an operation is assigned a sequence number
but the operation never completed (e.g., a node crash). It is important
that these operations appear in the history so that they can be
replicated and replayed during recovery as otherwise the history will be
incomplete and local checkpoints will not be able to advance. This
commit introduces a no-op to the translog to set the stage for these
efforts.

Relates #22291

time:
2016-12-22T03:37:07Z
class:
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java
comments:
Provide helpful error message if a plugin exists

Today if an older version of a plugin exists, we fail to notify the user
with a helpful error message. This happens because during plugin
verification, we attempt to read the plugin descriptors for all existing
plugins. When an older version of a plugin is sitting on disk, we will
attempt to read this old plugin descriptor and fail due to a version
mismatch. This leads to an unhelpful error message. Instead, we should
check for existence of the plugin as part of the verification phase, but
before attempting to read plugin descriptors for existing plugins. This
enables us to provide a helpful error message to the user.

Relates #22305

time:
2016-12-21T21:33:30Z
class:
client/transport/src/main/java/org/elasticsearch/transport/client/PreBuiltTransportClient.java
client/transport/src/test/java/org/elasticsearch/transport/client/PreBuiltTransportClientTests.java
core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentParserUtils.java
core/src/main/java/org/elasticsearch/discovery/zen/ElectMasterService.java
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenPing.java
core/src/main/java/org/elasticsearch/index/IndexModule.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/mapper/DynamicTemplate.java
core/src/main/java/org/elasticsearch/index/mapper/NumberFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/MatchAllQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryParseContext.java
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/query/IndicesQueriesRegistry.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/rest/action/RestActions.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestValidateQueryAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestExplainAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/SearchRequestParsers.java
core/src/main/java/org/elasticsearch/search/aggregations/support/values/ScriptLongValues.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java
core/src/main/java/org/elasticsearch/search/internal/SearchSortValues.java
core/src/main/java/org/elasticsearch/transport/ConnectionProfile.java
core/src/main/java/org/elasticsearch/transport/Transport.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenPingTests.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicTemplateTests.java
core/src/test/java/org/elasticsearch/index/mapper/NumberFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/RangeFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/InnerHitBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryParseContextTests.java
core/src/test/java/org/elasticsearch/index/query/QueryShardContextTests.java
core/src/test/java/org/elasticsearch/index/query/RangeQueryRewriteTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryParserTests.java
core/src/test/java/org/elasticsearch/indices/store/IndicesStoreIntegrationIT.java
core/src/test/java/org/elasticsearch/search/AbstractSearchTestCase.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregationCollectorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorParsingTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/BaseAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/BasePipelineAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridParserTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/ExtendedBoundsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/significant/SignificanceHeuristicTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/FiltersTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/min/MinAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/ExtendedStatsBucketTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/PercentilesBucketTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/moving/avg/MovAvgTests.java
core/src/test/java/org/elasticsearch/search/aggregations/support/IncludeExcludeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/support/ScriptValuesTests.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilderTests.java
core/src/test/java/org/elasticsearch/search/internal/SearchSortValuesTests.java
core/src/test/java/org/elasticsearch/search/internal/ShardSearchTransportRequestTests.java
core/src/test/java/org/elasticsearch/search/rescore/QueryRescoreBuilderTests.java
core/src/test/java/org/elasticsearch/search/searchafter/SearchAfterBuilderTests.java
core/src/test/java/org/elasticsearch/search/slice/SliceBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
core/src/test/java/org/elasticsearch/search/sort/FieldSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/ScoreSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/ScriptSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/SortBuilderTests.java
core/src/test/java/org/elasticsearch/search/suggest/AbstractSuggestionBuilderTestCase.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestBuilderTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/CategoryContextMappingTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/GeoContextMappingTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/QueryContextTestCase.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGeneratorTests.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/SmoothingModelTestCase.java
core/src/test/java/org/elasticsearch/transport/TCPTransportTests.java
core/src/test/java/org/elasticsearch/transport/TransportServiceHandshakeTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportMultiPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportPercolateAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RestReindexActionTests.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImpl.java
plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedUnicastHostsProvider.java
plugins/discovery-file/src/test/java/org/elasticsearch/discovery/file/FileBasedUnicastHostsProviderTests.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/main/java/org/elasticsearch/test/discovery/MockZenPing.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
test/framework/src/test/java/org/elasticsearch/search/MockSearchServiceTests.java
comments:
Merge branch 'master' into enhancement/use_shard_bulk_for_single_ops

time:
2016-12-21T20:09:21Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/transport/TransportActionProxy.java
core/src/test/java/org/elasticsearch/transport/TransportActionProxyTests.java
comments:
add current WIP

time:
2016-12-21T19:52:42Z
class:
core/src/main/java/org/elasticsearch/transport/TransportActionProxy.java
core/src/test/java/org/elasticsearch/transport/TransportActionProxyTests.java
comments:
Add TransportActionProxy infrastructure

time:
2016-12-21T19:24:18Z
class:
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/main/java/org/elasticsearch/action/bulk/SingleWriteOperationUtility.java
core/src/main/java/org/elasticsearch/action/bulk/TransportSingleItemBulkWriteAction.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
comments:
better code sharding?

time:
2016-12-21T18:39:28Z
class:
core/src/test/java/org/elasticsearch/index/query/QueryParseContextTests.java
comments:
Clear static variable after suite

This was causing test failures:
https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+java9-periodic/1101/console
https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+dockeralpine-periodic/513/consoleFull

time:
2016-12-21T16:32:02Z
class:
comments:
Repeated language analyzers (#22240)

* Repeated language analyzers

The `catalan` analyzer was repeated on the supported list :)

* Reordered the languages to have alphabetic order

* Added space for format

* Reordered the languages and removed repeated

time:
2016-12-21T16:18:33Z
class:
comments:
Add ingest-attachment-with-arrays section to ingest attachments doc

Added a new section detailing how to use the attachment processor
within an array.

This reverts commit #22296 and instead links to the foreach processor.

time:
2016-12-21T15:57:42Z
class:
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImpl.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
comments:
Merge pull request #22308 from nicpalmer/master

Support for eu-west-2 (London) cloud-aws plugin

See:

* http://docs.aws.amazon.com/general/latest/gr/rande.html#ec2_region
* http://docs.aws.amazon.com/general/latest/gr/rande.html#s3_region

time:
2016-12-21T15:56:55Z
class:
core/src/main/java/org/elasticsearch/index/mapper/DynamicTemplate.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicTemplateTests.java
comments:
Restore deprecation warning for invalid match_mapping_type values (#22304)

The deprecation warning gives now the same message as 5.x. The deprecation warning was previously removed, but given that we are still lenient with old indices we should still output the warning.

time:
2016-12-21T15:51:45Z
class:
core/src/main/java/org/elasticsearch/index/mapper/NumberFieldMapper.java
core/src/test/java/org/elasticsearch/index/mapper/NumberFieldTypeTests.java
comments:
Make `-0` compare less than `+0` consistently. (#22173)

Our `float`/`double` fields generally assume that `-0` compares less than `+0`,
except when bounds are exclusive: an exclusive lower bound on `-0` excludes
`+0` and an exclusive upper bound on `+0` excludes `-0`.

Closes #22167

time:
2016-12-21T15:49:33Z
class:
client/transport/src/main/java/org/elasticsearch/transport/client/PreBuiltTransportClient.java
client/transport/src/test/java/org/elasticsearch/transport/client/PreBuiltTransportClientTests.java
comments:
Tell Netty not to be unsafe in transport client

Today we ship with default jvm.options for server Elasticsearch that
prevents Netty from using some unsafe optimizations. Yet, the settings
do nothing for the transport client since it is embedded in other
applications that will not read and use those settings. This commit adds
these settings for the transport client, and is done so in a way that
still enables users to go unsafe if they want to go unsafe (they
shouldn't, but the option is there).

Relates #22284

time:
2016-12-21T15:48:53Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/support/values/ScriptLongValues.java
core/src/test/java/org/elasticsearch/search/aggregations/support/ScriptValuesTests.java
comments:
Allow terms aggregations on pure boolean scripts. (#22201)

The way aggregations on scripts work is by hiding scripts behind the same API
that we use for regular fields. However, there is no native support for boolean
fields, those need to be exposed as integers, with `0` standing for `false` and
`1` for true.

Relates #20941

time:
2016-12-21T15:48:07Z
class:
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImpl.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
comments:
Fixed eu-west-2 entries for discovery-ec2 and repository-s3 also updated the asciidocs

time:
2016-12-21T14:09:58Z
class:
core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java
core/src/main/java/org/elasticsearch/discovery/zen/ElectMasterService.java
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenPing.java
core/src/main/java/org/elasticsearch/transport/ConnectionProfile.java
core/src/main/java/org/elasticsearch/transport/Transport.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenPingTests.java
core/src/test/java/org/elasticsearch/transport/TCPTransportTests.java
core/src/test/java/org/elasticsearch/transport/TransportServiceHandshakeTests.java
plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedUnicastHostsProvider.java
plugins/discovery-file/src/test/java/org/elasticsearch/discovery/file/FileBasedUnicastHostsProviderTests.java
test/framework/src/main/java/org/elasticsearch/test/discovery/MockZenPing.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
comments:
Simplify Unicast Zen Ping (#22277)

The `UnicastZenPing` shows it's age and is the result of many small changes. The current state of affairs is confusing and is hard to reason about. This PR cleans it up (while following the same original intentions). Highlights of the changes are:

1) Clear 3 round flow - no interleaving of scheduling.
2) The previous implementation did a best effort attempt to wait for ongoing pings to be sent and completed. The pings were guaranteed to complete because each used the total ping duration as a timeout. This did make it hard to reason about the total ping duration and the flow of the code. All of this is removed now and ping should just complete within the given duration or not be counted (note that it was very handy for testing, but I move the needed sync logic to the test).
3) Because of (2) the pinging scheduling changed a bit, to give a chance for the last round to complete. We now ping at the beginning, 1/3 and 2/3 of the duration.
4) To offset for (3) a bit, incoming ping requests are now added to on going ping collections.
5) UnicastZenPing never establishes full blown connections (but does reuse them if there). Relates to #22120
6) Discovery host providers are only used once per pinging round. Closes #21739
7) Usage of the ability to open a connection without connecting to a node ( #22194 ) and shorter connection timeouts helps with connections piling up. Closes #19370
8) Beefed up testing and sped them up.
9) removed light profile from production code

time:
2016-12-21T14:05:14Z
class:
core/src/main/java/org/elasticsearch/index/IndexModule.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/query/MatchAllQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryParseContext.java
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/query/IndicesQueriesRegistry.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/rest/action/RestActions.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestValidateQueryAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestExplainAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/SearchRequestParsers.java
core/src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/RangeFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/InnerHitBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryParseContextTests.java
core/src/test/java/org/elasticsearch/index/query/QueryShardContextTests.java
core/src/test/java/org/elasticsearch/index/query/RangeQueryRewriteTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryParserTests.java
core/src/test/java/org/elasticsearch/search/AbstractSearchTestCase.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregationCollectorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorParsingTests.java
core/src/test/java/org/elasticsearch/search/aggregations/BaseAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/BasePipelineAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridParserTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/ExtendedBoundsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/significant/SignificanceHeuristicTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/FiltersTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/ExtendedStatsBucketTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/PercentilesBucketTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/moving/avg/MovAvgTests.java
core/src/test/java/org/elasticsearch/search/aggregations/support/IncludeExcludeTests.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilderTests.java
core/src/test/java/org/elasticsearch/search/internal/ShardSearchTransportRequestTests.java
core/src/test/java/org/elasticsearch/search/rescore/QueryRescoreBuilderTests.java
core/src/test/java/org/elasticsearch/search/searchafter/SearchAfterBuilderTests.java
core/src/test/java/org/elasticsearch/search/slice/SliceBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
core/src/test/java/org/elasticsearch/search/sort/FieldSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/ScoreSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/ScriptSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/SortBuilderTests.java
core/src/test/java/org/elasticsearch/search/suggest/AbstractSuggestionBuilderTestCase.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestBuilderTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/CategoryContextMappingTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/GeoContextMappingTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/QueryContextTestCase.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGeneratorTests.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/SmoothingModelTestCase.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportMultiPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportPercolateAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RestReindexActionTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/test/java/org/elasticsearch/search/MockSearchServiceTests.java
comments:
Replace IndicesQueriesRegistry (#22289)

* Switch query parsing to namedObject
* Remove IndicesQueriesRegistry

time:
2016-12-21T13:18:16Z
class:
comments:
Fixed document mistake and fit for 5.1.1 API

time:
2016-12-21T13:10:50Z
class:
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
Merge remote-tracking branch 'elastic/master'

time:
2016-12-21T13:10:33Z
class:
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImpl.java
comments:
Push for eu-west-2 issue

time:
2016-12-21T12:31:02Z
class:
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
[TEST] improve error message in ESTestCase#assertWarnings

time:
2016-12-21T12:28:43Z
class:
comments:
[TEST] remove deleted test classes from checkstyle suppressions

Relates to #21915

time:
2016-12-21T11:46:01Z
class:
comments:
Add // CONSOLE to the snippet

time:
2016-12-21T11:13:16Z
class:
comments:
Adds more information about ingest attachment properties extraction

This is coming from thsi thread on discuss: https://discuss.elastic.co/t/ingest-attachment-plugin-exception/69167/10

time:
2016-12-21T10:44:24Z
class:
test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
[TEST] make ESSingleNodeTestCase tests repeatable (#22283)

If we conditionally do random things, e.g. initialize a node only after the first test, we have to make sure that we unconditionally create a new seed calling random.nextLong(), then initialize the node under a private randomness context. This makes sure that any random usage through Randomness.get() will retrieve the proper random instance through RandomizedContext.current().getRandom(). When running under private randomness, the context will return the Random instance that was created with the provided seed (forked from the main random instance) rather than the main Random that's exposed to tests as well. Otherwise tests become non repeatable because that initialization part happens only before the first executed test.

time:
2016-12-21T10:41:28Z
class:
comments:
Merge pull request #22296 from gameldar/patch-2

Add link to foreach processor to ingest-attachment.asciidoc

time:
2016-12-21T10:28:07Z
class:
comments:
Link for setting page in elasticsearch.yml is outdated

Closes #22299.

time:
2016-12-21T10:19:47Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/XContentParserUtils.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java
core/src/main/java/org/elasticsearch/search/internal/SearchSortValues.java
core/src/test/java/org/elasticsearch/search/internal/SearchSortValuesTests.java
comments:
Factor out sort values from InternalSearchHit (#22080)

This adds fromXContent method and unit test for sort values that are part of 
InternalSearchHit. In order to centralize serialisation and xContent parsing and
rendering code, move all relevant parts to a new class which can be unit tested
much better in isolation.This is part of the preparation for parsing search
responses on the client side.

time:
2016-12-21T09:54:27Z
class:
comments:
Add ID for percolate query to Java API docs

time:
2016-12-21T09:25:33Z
class:
comments:
x_refresh.yaml tests should use unique index names and doc ids to ease debugging

 This is to make it easier to grep the node logs

time:
2016-12-21T09:11:56Z
class:
core/src/test/java/org/elasticsearch/indices/store/IndicesStoreIntegrationIT.java
comments:
IndicesStoreIntegrationIT should not use start recovery sending as an indication that the recovery started

Sending a request is not a good indicator as it doesn't mean it's processed yet. Instead we should use one of the first request from source to target.

This caused the cluster state block to be added to early , blocking the recovery it self

time:
2016-12-21T09:00:04Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterConnectionTests.java
comments:
make connection to nodes async and ensure that if we are not fully connected a search will fork or a reconnect

time:
2016-12-21T07:44:05Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/min/MinAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorTests.java
comments:
Added base class for testing aggregators and some initial tests for `terms`, `top_hits` and `min` aggregations.

time:
2016-12-21T07:15:19Z
class:
comments:
Add link to foreach processor to ingest-attachment.asciidoc

Add a Note to the foreach processor for processing an array of attachments, as this is required to be able to process an array of attachments.

time:
2016-12-21T06:04:31Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/ElasticsearchParseException.java
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/TransportGetTaskAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/get/GetResponse.java
core/src/main/java/org/elasticsearch/action/get/MultiGetResponse.java
core/src/main/java/org/elasticsearch/action/support/ActiveShardsObserver.java
core/src/main/java/org/elasticsearch/action/support/master/TransportMasterNodeAction.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationResponse.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationAction.java
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapException.java
core/src/main/java/org/elasticsearch/bootstrap/Elasticsearch.java
core/src/main/java/org/elasticsearch/cli/EnvironmentAwareCommand.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateObserver.java
core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/AliasValidator.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MappingMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AwarenessAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ClusterRebalanceAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ConcurrentRebalanceAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/EnableAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/FilterAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/SameShardAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ShardsLimitAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ThrottlingAllocationDecider.java
core/src/main/java/org/elasticsearch/common/ParseField.java
core/src/main/java/org/elasticsearch/common/ParseFieldMatcher.java
core/src/main/java/org/elasticsearch/common/logging/DeprecationLogger.java
core/src/main/java/org/elasticsearch/common/network/NetworkModule.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/settings/loader/XContentSettingsLoader.java
core/src/main/java/org/elasticsearch/common/text/Text.java
core/src/main/java/org/elasticsearch/common/xcontent/NamedXContentRegistry.java
core/src/main/java/org/elasticsearch/common/xcontent/XContent.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentHelper.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentParserUtils.java
core/src/main/java/org/elasticsearch/common/xcontent/cbor/CborXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/cbor/CborXContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContentGenerator.java
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/smile/SmileXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/smile/SmileXContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/support/AbstractXContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/yaml/YamlXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/yaml/YamlXContentParser.java
core/src/main/java/org/elasticsearch/gateway/MetaDataStateFormat.java
core/src/main/java/org/elasticsearch/index/IndexModule.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/get/GetField.java
core/src/main/java/org/elasticsearch/index/get/GetResult.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/index/mapper/TypeParsers.java
core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoPolygonQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoShapeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/index/query/WrapperQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/DecayFunctionBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilder.java
core/src/main/java/org/elasticsearch/index/shard/CommitPoints.java
core/src/main/java/org/elasticsearch/index/translog/TruncateTranslogCommand.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/ingest/IngestDocument.java
core/src/main/java/org/elasticsearch/ingest/PipelineStore.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
core/src/main/java/org/elasticsearch/plugins/ListPluginsCommand.java
core/src/main/java/org/elasticsearch/plugins/NetworkPlugin.java
core/src/main/java/org/elasticsearch/plugins/Plugin.java
core/src/main/java/org/elasticsearch/plugins/RemovePluginCommand.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreFormat.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/rest/RestRequest.java
core/src/main/java/org/elasticsearch/rest/action/RestToXContentListener.java
core/src/main/java/org/elasticsearch/rest/action/document/RestGetAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestUpdateAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/script/ScriptMetaData.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/internal/AliasFilter.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchRequest.java
core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/SuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggester.java
core/src/test/java/org/elasticsearch/ElasticsearchExceptionTests.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
core/src/test/java/org/elasticsearch/action/DocWriteResponseTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainIT.java
core/src/test/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteRequestTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequestTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/template/BWCTemplateTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/template/put/MetaDataIndexTemplateServiceTests.java
core/src/test/java/org/elasticsearch/action/get/GetResponseTests.java
core/src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationResponseTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/bootstrap/ElasticsearchCliTests.java
core/src/test/java/org/elasticsearch/cluster/action/shard/ShardStateActionTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesServiceTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeServiceTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDeciderUnitTests.java
core/src/test/java/org/elasticsearch/common/ParseFieldTests.java
core/src/test/java/org/elasticsearch/common/logging/DeprecationLoggerTests.java
core/src/test/java/org/elasticsearch/common/network/NetworkModuleTests.java
core/src/test/java/org/elasticsearch/common/unit/FuzzinessTests.java
core/src/test/java/org/elasticsearch/common/xcontent/BaseXContentTestCase.java
core/src/test/java/org/elasticsearch/common/xcontent/ObjectParserTests.java
core/src/test/java/org/elasticsearch/common/xcontent/UnknownNamedObjectExceptionTests.java
core/src/test/java/org/elasticsearch/common/xcontent/XContentParserUtilsTests.java
core/src/test/java/org/elasticsearch/common/xcontent/support/XContentHelperTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/gateway/GatewayMetaStateTests.java
core/src/test/java/org/elasticsearch/http/HttpServerTests.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/analysis/AnalysisRegistryTests.java
core/src/test/java/org/elasticsearch/index/codec/CodecTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/get/GetFieldTests.java
core/src/test/java/org/elasticsearch/index/get/GetResultTests.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicTemplateTests.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/FieldNamesFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
core/src/test/java/org/elasticsearch/index/mapper/MultiFieldCopyToMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/MultiFieldIncludeInAllMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ParentFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/RangeFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoDistanceQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoPolygonQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/HasParentQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/IdsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryShardContextTests.java
core/src/test/java/org/elasticsearch/index/query/RangeQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/RangeQueryRewriteTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryParserTests.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
core/src/test/java/org/elasticsearch/index/translog/TruncateTranslogIT.java
core/src/test/java/org/elasticsearch/indices/analysis/AnalysisModuleTests.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
core/src/test/java/org/elasticsearch/ingest/PipelineStoreTests.java
core/src/test/java/org/elasticsearch/rest/BaseRestHandlerTests.java
core/src/test/java/org/elasticsearch/rest/BytesRestResponseTests.java
core/src/test/java/org/elasticsearch/rest/RestControllerTests.java
core/src/test/java/org/elasticsearch/rest/RestRequestTests.java
core/src/test/java/org/elasticsearch/rest/action/RestMainActionTests.java
core/src/test/java/org/elasticsearch/rest/action/admin/cluster/RestNodesStatsActionTests.java
core/src/test/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeActionTests.java
core/src/test/java/org/elasticsearch/rest/action/admin/indices/RestIndicesStatsActionTests.java
core/src/test/java/org/elasticsearch/rest/action/cat/RestTableTests.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/ExtendedBoundsTests.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilderTests.java
core/src/test/java/org/elasticsearch/search/internal/ShardSearchTransportRequestTests.java
core/src/test/java/org/elasticsearch/search/rescore/QueryRescoreBuilderTests.java
core/src/test/java/org/elasticsearch/search/scroll/RestClearScrollActionTests.java
core/src/test/java/org/elasticsearch/search/scroll/RestSearchScrollActionTests.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderTests.java
core/src/test/java/org/elasticsearch/snapshots/SnapshotRequestsTests.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/IngestCommonPlugin.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/JsonProcessor.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/KeyValueProcessor.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/JsonProcessorTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/KeyValueProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/KeyValueProcessorTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestMultiSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TemplateQueryBuilder.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequestTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MustacheScriptEngineTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateIT.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/TemplateQueryBuilderTests.java
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateRequest.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportMultiPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportPercolateAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBaseReindexRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByQueryRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestUpdateByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuilders.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RestReindexActionTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpRequest.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpRequestHandler.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/Netty4Plugin.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpChannelTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerPipeliningTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerTransportTests.java
plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedDiscoveryPlugin.java
plugins/discovery-file/src/test/java/org/elasticsearch/discovery/file/FileBasedDiscoveryPluginTests.java
plugins/ingest-attachment/src/main/java/org/elasticsearch/ingest/attachment/AttachmentProcessor.java
plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorFactoryTests.java
plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java
plugins/ingest-geoip/src/main/java/org/elasticsearch/ingest/geoip/GeoIpProcessor.java
plugins/ingest-geoip/src/test/java/org/elasticsearch/ingest/geoip/GeoIpProcessorFactoryTests.java
plugins/ingest-geoip/src/test/java/org/elasticsearch/ingest/geoip/GeoIpProcessorTests.java
plugins/ingest-user-agent/src/main/java/org/elasticsearch/ingest/useragent/UserAgentParser.java
plugins/ingest-user-agent/src/main/java/org/elasticsearch/ingest/useragent/UserAgentProcessor.java
plugins/ingest-user-agent/src/test/java/org/elasticsearch/ingest/useragent/UserAgentProcessorFactoryTests.java
plugins/ingest-user-agent/src/test/java/org/elasticsearch/ingest/useragent/UserAgentProcessorTests.java
plugins/mapper-murmur3/src/test/java/org/elasticsearch/index/mapper/murmur3/Murmur3FieldMapperTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3RepositoryTests.java
qa/evil-tests/src/test/java/org/elasticsearch/bootstrap/EvilElasticsearchCliTests.java
qa/evil-tests/src/test/java/org/elasticsearch/common/logging/EvilLoggerTests.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/RemovePluginCommandTests.java
test/framework/src/main/java/org/elasticsearch/bootstrap/ESElasticsearchCliTestCase.java
test/framework/src/main/java/org/elasticsearch/index/MapperTestUtils.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
test/framework/src/main/java/org/elasticsearch/search/RandomSearchRequestGenerator.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/main/java/org/elasticsearch/test/RandomObjects.java
test/framework/src/main/java/org/elasticsearch/test/hamcrest/ElasticsearchAssertions.java
test/framework/src/main/java/org/elasticsearch/test/rest/FakeRestRequest.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ESClientYamlSuiteTestCase.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ObjectPath.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/ClientYamlTestSuiteParser.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/DoSectionParser.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/restspec/ClientYamlSuiteRestSpec.java
test/framework/src/test/java/org/elasticsearch/search/MockSearchServiceTests.java
comments:
Merge branch 'master' into enhancement/use_shard_bulk_for_single_ops

time:
2016-12-21T05:26:58Z
class:
core/src/main/java/org/elasticsearch/action/bulk/SingleWriteOperationUtility.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/test/java/org/elasticsearch/cluster/NoMasterNodeIT.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingDisabledTests.java
comments:
incorporate feedback

time:
2016-12-21T02:08:36Z
class:
comments:
Another fix for handling of paths on Windows

A previous fix for the handling of paths on Windows related to paths
containing multiple spaces introduced a issue where if JAVA_HOME ends
with a backslash, then Elasticsearch will refuse to start. This is not a
critical bug as a workaround exists (remove the trailing backslash), but
should be fixed nevertheless. This commit addresses this situation while
not regressing the previous fix.

Relates #22132

time:
2016-12-21T00:07:36Z
class:
comments:
[DOCS] Update Percolate Java example

The percolator's Java example was note quite right. This updates it to use working code.

time:
2016-12-20T21:26:17Z
class:
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/IngestCommonPlugin.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/KeyValueProcessor.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/KeyValueProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/KeyValueProcessorTests.java
comments:
introduce KV Processor in Ingest Node (#22272)

Now you can parse field values of the `key=value` variety and have
`key` be inserted as a field name in an ingest document.

Closes #22222.

time:
2016-12-20T21:23:11Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/transport/ConnectionProfile.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterConnectionTests.java
comments:
Add remote cluster connections manager

time:
2016-12-20T18:53:28Z
class:
core/src/main/java/org/elasticsearch/ingest/IngestDocument.java
plugins/ingest-attachment/src/main/java/org/elasticsearch/ingest/attachment/AttachmentProcessor.java
plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorFactoryTests.java
plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java
plugins/ingest-geoip/src/main/java/org/elasticsearch/ingest/geoip/GeoIpProcessor.java
plugins/ingest-geoip/src/test/java/org/elasticsearch/ingest/geoip/GeoIpProcessorFactoryTests.java
plugins/ingest-geoip/src/test/java/org/elasticsearch/ingest/geoip/GeoIpProcessorTests.java
plugins/ingest-user-agent/src/main/java/org/elasticsearch/ingest/useragent/UserAgentProcessor.java
plugins/ingest-user-agent/src/test/java/org/elasticsearch/ingest/useragent/UserAgentProcessorFactoryTests.java
plugins/ingest-user-agent/src/test/java/org/elasticsearch/ingest/useragent/UserAgentProcessorTests.java
comments:
add `ignore_missing` flag to ingest plugins (#22273)

added `ignore_missing` flag to:

- Attachment Processor
- GeoIP Processor
- User-Agent Processor

time:
2016-12-20T18:52:17Z
class:
comments:
[docs] update ingest-node delete docs to mention wildcarding (#22270)

time:
2016-12-20T17:25:52Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AwarenessAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ClusterRebalanceAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ConcurrentRebalanceAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/EnableAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/FilterAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/SameShardAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ShardsLimitAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ThrottlingAllocationDecider.java
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainIT.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDeciderUnitTests.java
comments:
Adds setting level to allocation decider explanations (#22268)

The allocation decider explanation messages where improved in #21771 to
include the specific Elasticsearch setting that contributed to the
decision taken by the decider.  This commit improves upon the
explanation message output by including whether the setting was an index
level setting or a cluster level setting.  This will further help the
user understand and locate the setting that is the cause of shards
remaining unassigned or remaining on their current node.

time:
2016-12-20T16:05:24Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/ElasticsearchParseException.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/TransportGetTaskAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/metadata/AliasMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/AliasValidator.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MappingMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/main/java/org/elasticsearch/common/network/NetworkModule.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/settings/loader/XContentSettingsLoader.java
core/src/main/java/org/elasticsearch/common/xcontent/NamedXContentRegistry.java
core/src/main/java/org/elasticsearch/common/xcontent/XContent.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentHelper.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/cbor/CborXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/cbor/CborXContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContentGenerator.java
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/smile/SmileXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/smile/SmileXContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/support/AbstractXContentParser.java
core/src/main/java/org/elasticsearch/common/xcontent/yaml/YamlXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/yaml/YamlXContentParser.java
core/src/main/java/org/elasticsearch/gateway/MetaDataStateFormat.java
core/src/main/java/org/elasticsearch/index/IndexModule.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/index/query/GeoShapeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/index/query/WrapperQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/DecayFunctionBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilder.java
core/src/main/java/org/elasticsearch/index/shard/CommitPoints.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/NetworkPlugin.java
core/src/main/java/org/elasticsearch/plugins/Plugin.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreFormat.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/rest/RestRequest.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/script/ScriptMetaData.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/internal/AliasFilter.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchRequest.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggester.java
core/src/test/java/org/elasticsearch/ElasticsearchExceptionTests.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteRequestTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequestTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/template/put/MetaDataIndexTemplateServiceTests.java
core/src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationResponseTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesServiceTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeServiceTests.java
core/src/test/java/org/elasticsearch/common/network/NetworkModuleTests.java
core/src/test/java/org/elasticsearch/common/unit/FuzzinessTests.java
core/src/test/java/org/elasticsearch/common/xcontent/BaseXContentTestCase.java
core/src/test/java/org/elasticsearch/common/xcontent/ObjectParserTests.java
core/src/test/java/org/elasticsearch/common/xcontent/UnknownNamedObjectExceptionTests.java
core/src/test/java/org/elasticsearch/common/xcontent/XContentParserUtilsTests.java
core/src/test/java/org/elasticsearch/common/xcontent/support/XContentHelperTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/gateway/GatewayMetaStateTests.java
core/src/test/java/org/elasticsearch/http/HttpServerTests.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/codec/CodecTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/FieldNamesFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
core/src/test/java/org/elasticsearch/index/mapper/MultiFieldCopyToMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/MultiFieldIncludeInAllMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ParentFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/RangeFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/query/QueryShardContextTests.java
core/src/test/java/org/elasticsearch/index/query/RangeQueryRewriteTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryParserTests.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
core/src/test/java/org/elasticsearch/rest/BaseRestHandlerTests.java
core/src/test/java/org/elasticsearch/rest/BytesRestResponseTests.java
core/src/test/java/org/elasticsearch/rest/RestControllerTests.java
core/src/test/java/org/elasticsearch/rest/RestRequestTests.java
core/src/test/java/org/elasticsearch/rest/action/RestMainActionTests.java
core/src/test/java/org/elasticsearch/rest/action/admin/cluster/RestNodesStatsActionTests.java
core/src/test/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeActionTests.java
core/src/test/java/org/elasticsearch/rest/action/admin/indices/RestIndicesStatsActionTests.java
core/src/test/java/org/elasticsearch/rest/action/cat/RestTableTests.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/ExtendedBoundsTests.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilderTests.java
core/src/test/java/org/elasticsearch/search/internal/ShardSearchTransportRequestTests.java
core/src/test/java/org/elasticsearch/search/rescore/QueryRescoreBuilderTests.java
core/src/test/java/org/elasticsearch/search/scroll/RestClearScrollActionTests.java
core/src/test/java/org/elasticsearch/search/scroll/RestSearchScrollActionTests.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
core/src/test/java/org/elasticsearch/snapshots/SnapshotRequestsTests.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/JsonProcessor.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/JsonProcessorTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestMultiSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TemplateQueryBuilder.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequestTests.java
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateRequest.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportMultiPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportPercolateAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBaseReindexRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByQueryRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestUpdateByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuilders.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RestReindexActionTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpRequest.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpRequestHandler.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/Netty4Plugin.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpChannelTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerPipeliningTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerTransportTests.java
plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedDiscoveryPlugin.java
plugins/ingest-user-agent/src/main/java/org/elasticsearch/ingest/useragent/UserAgentParser.java
plugins/mapper-murmur3/src/test/java/org/elasticsearch/index/mapper/murmur3/Murmur3FieldMapperTests.java
test/framework/src/main/java/org/elasticsearch/index/MapperTestUtils.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
test/framework/src/main/java/org/elasticsearch/search/RandomSearchRequestGenerator.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/main/java/org/elasticsearch/test/hamcrest/ElasticsearchAssertions.java
test/framework/src/main/java/org/elasticsearch/test/rest/FakeRestRequest.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ObjectPath.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/ClientYamlTestSuiteParser.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/parser/DoSectionParser.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/restspec/ClientYamlSuiteRestSpec.java
test/framework/src/test/java/org/elasticsearch/search/MockSearchServiceTests.java
comments:
Introduce XContentParser#namedObject (#22003)

Introduces `XContentParser#namedObject which works a little like
`StreamInput#readNamedWriteable`: on startup components register
parsers under names and a superclass. At runtime we look up the
parser and call it to parse the object.

Right now the parsers take a context object they use to help with
the parsing but I hope to be able to eliminate the need for this
context as most what it is used for at this point is to move
around parser registries which should be replaced by this method
eventually. I make no effort to do so in this PR because it is
big enough already. This is meant to the a start down a road that
allows us to remove classes like `QueryParseContext`,
`AggregatorParsers`, `IndicesQueriesRegistry`, and
`ParseFieldRegistry`.

The goal here is to reduce the amount of plumbing required to
allow parsing pluggable things. With this you don't have to pass
registries all over the place. Instead you must pass a super
registry to fewer places and use it to wrap the reader. This is
the same tradeoff that we use for NamedWriteable and it allows
much, much simpler binary serialization. We think we want that
same thing for xcontent serialization.

The only parsing actually converted to this method is parsing
`ScoreFunctions` inside of `FunctionScoreQuery`. I chose this
because it is relatively self contained.

time:
2016-12-20T15:00:14Z
class:
comments:
Reindex test: catch exception name instead of reason

It looks like the exception reason can differ in different default
locales, so the build would fail in any non-English locale. This
switches the catch to the name of the exception which shouldn't
vary.

time:
2016-12-20T14:16:04Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java
core/src/main/java/org/elasticsearch/action/support/ActiveShardsObserver.java
core/src/main/java/org/elasticsearch/action/support/master/TransportMasterNodeAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationAction.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateObserver.java
core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/test/java/org/elasticsearch/cluster/action/shard/ShardStateActionTests.java
comments:
Let ClusterStateObserver only hold onto state that's needed for change detection (#21631)

ClusterStateObserver is a utility class that simplifies interacting with the cluster state in cases where an action takes a decision based on the current cluster state but may want to wait for a new state and retry upon failure. The ClusterStateObserver implements its functionality by keeping a reference to the last cluster state that it observed. When a new ClusterStateObserver is created, it samples a cluster state from the cluster service which is subsequently used for change detection. If actions take a long time to process, however, the cluster observer can reference very old cluster states. Due to cluster observers being created very frequently and cluster states being potentially large the referenced cluster states can waste a lot of heap space. A specific example where this can make a node go out of memory is given in point 2 of issue #21568: The action listener in TransportMasterNodeAction.AsyncSingleAction has a ClusterStateObserver to coordinate the retry mechanism if the action on the master node fails due to the node not being master anymore. The ClusterStateObserver in AsyncSingleAction keeps a reference to the full cluster state when the action was initiated. If the pending tasks queue grows quite large and has older items in it lots of cluster states can possibly be referenced.

This commit changes the ClusterStateObserver to hold only onto the part of the cluster state that's needed for change detection.

time:
2016-12-20T14:10:58Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
comments:
fix compile issue

time:
2016-12-20T13:57:28Z
class:
core/src/main/java/org/elasticsearch/search/suggest/SuggestionBuilder.java
comments:
SuggestionBuilder doesn't need to extend ToXContentToBytes

This changes the class from extending the abstract class to implementing the
ToXContent interface only. The former could lead to unexpected behaviour when
trying to display the object, since the "toString()" method inherited from
ToXContentToBytes would create an error message because the SuggestionBuilders
toXContent() methods don't render complete json objects.

time:
2016-12-20T13:32:09Z
class:
client/rest/src/main/java/org/elasticsearch/client/RequestLogger.java
client/rest/src/main/java/org/elasticsearch/client/ResponseListener.java
client/rest/src/main/java/org/elasticsearch/client/RestClientBuilder.java
client/rest/src/test/java/org/elasticsearch/client/RequestLoggerTests.java
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/ActionListener.java
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/NodeExplanation.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/TransportGetTaskAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/repositories/put/PutRepositoryRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/create/CreateSnapshotRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/RestoreSnapshotRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/TransportRestoreSnapshotAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodeResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/flush/ShardFlushRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportShardFlushAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportShardRefreshAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/shrink/ShrinkRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStats.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/ShardStats.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkShardRequest.java
core/src/main/java/org/elasticsearch/action/bulk/Retry.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStats.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsRequest.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsResponse.java
core/src/main/java/org/elasticsearch/action/get/GetResponse.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequest.java
core/src/main/java/org/elasticsearch/action/get/MultiGetResponse.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/index/IndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/ingest/IngestActionFilter.java
core/src/main/java/org/elasticsearch/action/ingest/IngestActionForwarder.java
core/src/main/java/org/elasticsearch/action/ingest/IngestProxyActionFilter.java
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/action/support/ActionFilter.java
core/src/main/java/org/elasticsearch/action/support/ActionFilterChain.java
core/src/main/java/org/elasticsearch/action/support/ActiveShardsObserver.java
core/src/main/java/org/elasticsearch/action/support/TransportAction.java
core/src/main/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeAction.java
core/src/main/java/org/elasticsearch/action/support/master/TransportMasterNodeAction.java
core/src/main/java/org/elasticsearch/action/support/replication/BasicReplicationRequest.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicatedWriteRequest.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationOperation.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationRequest.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationResponse.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/main/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationAction.java
core/src/main/java/org/elasticsearch/action/termvectors/MultiTermVectorsRequest.java
core/src/main/java/org/elasticsearch/action/termvectors/TermVectorsWriter.java
core/src/main/java/org/elasticsearch/action/termvectors/TransportTermVectorsAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapException.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapInfo.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapSettings.java
core/src/main/java/org/elasticsearch/bootstrap/Elasticsearch.java
core/src/main/java/org/elasticsearch/bootstrap/JNACLibrary.java
core/src/main/java/org/elasticsearch/bootstrap/JNAKernel32Library.java
core/src/main/java/org/elasticsearch/bootstrap/JNANatives.java
core/src/main/java/org/elasticsearch/bootstrap/JavaVersion.java
core/src/main/java/org/elasticsearch/bootstrap/Natives.java
core/src/main/java/org/elasticsearch/bootstrap/Spawner.java
core/src/main/java/org/elasticsearch/bootstrap/StartupException.java
core/src/main/java/org/elasticsearch/bootstrap/SystemCallFilter.java
core/src/main/java/org/elasticsearch/cli/Command.java
core/src/main/java/org/elasticsearch/cli/EnvironmentAwareCommand.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateApplier.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateObserver.java
core/src/main/java/org/elasticsearch/cluster/InternalClusterInfoService.java
core/src/main/java/org/elasticsearch/cluster/MasterNodeChangePredicate.java
core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/AliasValidator.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexGraveyard.java
core/src/main/java/org/elasticsearch/cluster/metadata/MappingMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java
core/src/main/java/org/elasticsearch/cluster/routing/DelayedAllocationService.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AbstractAllocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocateUnassignedDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/IndexMetaDataUpdater.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/MoveDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/NodeAllocationResult.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/NodeRebalanceResult.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RebalanceDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RelocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RerouteExplanation.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/Decision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/EnableAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/MaxRetryAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/SameShardAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ShardsLimitAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterServiceState.java
core/src/main/java/org/elasticsearch/common/CheckedConsumer.java
core/src/main/java/org/elasticsearch/common/FieldMemoryStats.java
core/src/main/java/org/elasticsearch/common/ParseField.java
core/src/main/java/org/elasticsearch/common/ParseFieldMatcher.java
core/src/main/java/org/elasticsearch/common/blobstore/url/URLBlobContainer.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java
core/src/main/java/org/elasticsearch/common/joda/FormatDateTimeFormatter.java
core/src/main/java/org/elasticsearch/common/logging/DeprecationLogger.java
core/src/main/java/org/elasticsearch/common/lucene/uid/Versions.java
core/src/main/java/org/elasticsearch/common/settings/AbstractScopedSettings.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/main/java/org/elasticsearch/common/text/Text.java
core/src/main/java/org/elasticsearch/common/transport/TransportAddress.java
core/src/main/java/org/elasticsearch/common/xcontent/AbstractObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ConstructingObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ContextParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/XContent.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentFactory.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentHelper.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentParserUtils.java
core/src/main/java/org/elasticsearch/common/xcontent/cbor/CborXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/smile/SmileXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/yaml/YamlXContent.java
core/src/main/java/org/elasticsearch/discovery/zen/NodeJoinController.java
core/src/main/java/org/elasticsearch/discovery/zen/PublishClusterStateAction.java
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/gateway/BaseGatewayShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/DanglingIndicesState.java
core/src/main/java/org/elasticsearch/gateway/Gateway.java
core/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java
core/src/main/java/org/elasticsearch/gateway/GatewayMetaState.java
core/src/main/java/org/elasticsearch/gateway/GatewayService.java
core/src/main/java/org/elasticsearch/gateway/MetaStateService.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/ReplicaShardAllocator.java
core/src/main/java/org/elasticsearch/http/HttpServer.java
core/src/main/java/org/elasticsearch/index/CompositeIndexEventListener.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/SearchSlowLog.java
core/src/main/java/org/elasticsearch/index/analysis/ASCIIFoldingTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/cache/query/QueryCacheStats.java
core/src/main/java/org/elasticsearch/index/engine/CommitStats.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/SegmentsStats.java
core/src/main/java/org/elasticsearch/index/fielddata/FieldDataStats.java
core/src/main/java/org/elasticsearch/index/fielddata/ShardFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/GlobalOrdinalsBuilder.java
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/InternalGlobalOrdinalsIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractAtomicOrdinalsFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractIndexOrdinalsFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/DocValuesIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/IndexIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/PagedBytesAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/SortedSetDVBytesAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/SortedSetDVOrdinalsIndexFieldData.java
core/src/main/java/org/elasticsearch/index/flush/FlushStats.java
core/src/main/java/org/elasticsearch/index/get/GetField.java
core/src/main/java/org/elasticsearch/index/get/GetResult.java
core/src/main/java/org/elasticsearch/index/get/GetStats.java
core/src/main/java/org/elasticsearch/index/mapper/AllFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java
core/src/main/java/org/elasticsearch/index/mapper/DynamicTemplate.java
core/src/main/java/org/elasticsearch/index/mapper/FieldNamesFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/FieldTypeLookup.java
core/src/main/java/org/elasticsearch/index/mapper/IdFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IndexFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IpFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/MappedFieldType.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/index/mapper/Mapping.java
core/src/main/java/org/elasticsearch/index/mapper/MetadataFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/NumberFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ParentFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ParseContext.java
core/src/main/java/org/elasticsearch/index/mapper/ParsedDocument.java
core/src/main/java/org/elasticsearch/index/mapper/RoutingFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/SeqNoFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TypeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TypeParsers.java
core/src/main/java/org/elasticsearch/index/mapper/UidFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/VersionFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/internal/SeqNoFieldMapper.java
core/src/main/java/org/elasticsearch/index/merge/MergeStats.java
core/src/main/java/org/elasticsearch/index/query/BoolQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/BoostingQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ConstantScoreQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/DisMaxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ExistsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/FieldMaskingSpanQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/FuzzyQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoPolygonQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoShapeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/HasChildQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/HasParentQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/IdsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchAllQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchNoneQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchPhrasePrefixQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchPhraseQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/NestedQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ParentIdQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/PrefixQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryBuilders.java
core/src/main/java/org/elasticsearch/index/query/QueryParseContext.java
core/src/main/java/org/elasticsearch/index/query/QueryParser.java
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/RangeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/RegexpQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanContainingQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanFirstQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanMultiTermQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanNearQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanNotQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanOrQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanTermQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanWithinQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TermQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TypeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/WildcardQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/WrapperQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilder.java
core/src/main/java/org/elasticsearch/index/refresh/RefreshStats.java
core/src/main/java/org/elasticsearch/index/search/stats/SearchStats.java
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointService.java
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointSyncAction.java
core/src/main/java/org/elasticsearch/index/shard/DocsStats.java
core/src/main/java/org/elasticsearch/index/shard/IndexEventListener.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/IndexingStats.java
core/src/main/java/org/elasticsearch/index/shard/LocalShardSnapshot.java
core/src/main/java/org/elasticsearch/index/shard/StoreRecovery.java
core/src/main/java/org/elasticsearch/index/shard/TranslogRecoveryPerformer.java
core/src/main/java/org/elasticsearch/index/store/StoreStats.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/index/translog/TruncateTranslogCommand.java
core/src/main/java/org/elasticsearch/index/warmer/WarmerStats.java
core/src/main/java/org/elasticsearch/indices/IndicesModule.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/analysis/PreBuiltTokenFilters.java
core/src/main/java/org/elasticsearch/indices/analysis/PreBuiltTokenizers.java
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryFailedException.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryFinalizeRecoveryRequest.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTargetHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RemoteRecoveryTargetHandler.java
comments:
Merge branch 'master' into feature/multi_cluster_search

time:
2016-12-20T08:29:11Z
class:
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationResponse.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationResponseTests.java
comments:
Add fromXContent() methods for ReplicationResponse (#22196)

This commit adds the parsing fromXContent() methods to the ReplicationResponse.ShardInfo and ReplicationResponse.ShardInfo.Failure classes.

time:
2016-12-19T23:23:44Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapException.java
core/src/main/java/org/elasticsearch/bootstrap/Elasticsearch.java
core/src/main/java/org/elasticsearch/cli/EnvironmentAwareCommand.java
core/src/main/java/org/elasticsearch/index/translog/TruncateTranslogCommand.java
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
core/src/main/java/org/elasticsearch/plugins/ListPluginsCommand.java
core/src/main/java/org/elasticsearch/plugins/RemovePluginCommand.java
core/src/test/java/org/elasticsearch/bootstrap/ElasticsearchCliTests.java
core/src/test/java/org/elasticsearch/index/translog/TruncateTranslogIT.java
qa/evil-tests/src/test/java/org/elasticsearch/bootstrap/EvilElasticsearchCliTests.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/RemovePluginCommandTests.java
test/framework/src/main/java/org/elasticsearch/bootstrap/ESElasticsearchCliTestCase.java
comments:
Internal: Refactor SettingCommand into EnvironmentAwareCommand (#22175)

* Internal: Refactor SettingCommand into EnvironmentAwareCommand

This change renames and changes the behavior of SettingCommand to have
its primary method take in a fully initialized Environment for
elasticsearch instead of just a map of settings. All of the subclasses
of SettingCommand already did this at some point, so this just removes
duplication.

time:
2016-12-19T22:34:09Z
class:
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
comments:
Fix java 9 build

We removed a cast we needed to appease Java 9. I've recreated it
in simpler form and left a comment about why we need it.

time:
2016-12-19T21:44:08Z
class:
comments:
Reinex test: don't fail if iis is running on port 0

time:
2016-12-19T20:56:09Z
class:
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
core/src/main/java/org/elasticsearch/rest/action/document/RestIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestUpdateAction.java
core/src/test/java/org/elasticsearch/action/DocWriteResponseTests.java
comments:
Adds percent-encoding for Location headers (#21057)

This should cause unicode elements in the location header to be percent-encoded, instead of being left alone.

Closes #21016

time:
2016-12-19T20:07:14Z
class:
core/src/test/java/org/elasticsearch/index/mapper/MultiFieldIncludeInAllMapperTests.java
comments:
Fix line length

time:
2016-12-19T20:07:00Z
class:
core/src/main/java/org/elasticsearch/index/mapper/TypeParsers.java
core/src/test/java/org/elasticsearch/index/mapper/MultiFieldIncludeInAllMapperTests.java
comments:
Sub-fields should not accept `include_in_all` parameter (#21971)

Fail to update mapping when multifield has `include_in_all`.

Closes #21710

time:
2016-12-19T18:59:59Z
class:
core/src/main/java/org/elasticsearch/ingest/PipelineStore.java
core/src/test/java/org/elasticsearch/ingest/PipelineStoreTests.java
comments:
Added ability to remove pipelines via wildcards (#22149) (#22191)

This commit is adding an ability to remove pipelines with wildcards.

time:
2016-12-19T18:39:56Z
class:
core/src/main/java/org/elasticsearch/common/logging/DeprecationLogger.java
core/src/test/java/org/elasticsearch/action/admin/indices/template/BWCTemplateTests.java
core/src/test/java/org/elasticsearch/common/ParseFieldTests.java
core/src/test/java/org/elasticsearch/common/logging/DeprecationLoggerTests.java
core/src/test/java/org/elasticsearch/common/xcontent/ObjectParserTests.java
core/src/test/java/org/elasticsearch/index/analysis/AnalysisRegistryTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicTemplateTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
core/src/test/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoDistanceQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoPolygonQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/HasParentQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/IdsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/RangeQueryBuilderTests.java
core/src/test/java/org/elasticsearch/indices/analysis/AnalysisModuleTests.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateIT.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/TemplateQueryBuilderTests.java
plugins/discovery-file/src/test/java/org/elasticsearch/discovery/file/FileBasedDiscoveryPluginTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3RepositoryTests.java
qa/evil-tests/src/test/java/org/elasticsearch/common/logging/EvilLoggerTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
[TEST] add warnings check to ESTestCase

We are currenlty checking that no deprecation warnings are emitted in our query tests. That can be moved to ESTestCase (disabled in ESIntegTestCase) as it allows us to easily catch where our tests use deprecated features and assert on the expected warnings.

time:
2016-12-19T18:39:56Z
class:
core/src/main/java/org/elasticsearch/common/ParseField.java
core/src/main/java/org/elasticsearch/common/ParseFieldMatcher.java
core/src/main/java/org/elasticsearch/index/mapper/TypeParsers.java
core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoPolygonQueryBuilder.java
core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java
core/src/test/java/org/elasticsearch/common/ParseFieldTests.java
core/src/test/java/org/elasticsearch/common/xcontent/ObjectParserTests.java
core/src/test/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoDistanceQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoPolygonQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/HasParentQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/IdsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/RangeQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MustacheScriptEngineTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/TemplateQueryBuilderTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
comments:
Remove support for strict parsing mode

We return deprecation warnings as response headers, besides logging them. Strict parsing mode stayed around, but was only used in query tests, though we also introduced checks for deprecation warnings there that don't need strict parsing anymore (see #20993).

 We can then safely remove support for strict parsing mode. The final goal is to remove the ParseFieldMatcher class, but there are many many users of it. This commit prepares the field for the removal, by deprecating ParseFieldMatcher and making it effectively not needed. Strict parsing is removed from ParseFieldMatcher, and strict parsing is replaced in tests where needed with deprecation warnings checks.

 Note that the setting to enable strict parsing was never ported to the new settings infra hance it cannot be set in production. It is really only used in our own tests.

 Relates to #19552

time:
2016-12-19T18:32:50Z
class:
core/src/test/java/org/elasticsearch/action/get/GetResponseTests.java
core/src/test/java/org/elasticsearch/index/get/GetFieldTests.java
core/src/test/java/org/elasticsearch/index/get/GetResultTests.java
test/framework/src/main/java/org/elasticsearch/test/hamcrest/ElasticsearchAssertions.java
comments:
[TEST] improve ElasticsearchAssertions#assertEquivalent for ToXContent

Rename the method to assertToXContentEquivalent to highlight that it's tailored to ToXContent comparisons.

Rather than parsing into a map and replacing byte[] in both those maps, add custom equality assertions that recursively walk maps and lists and call Arrays.equals whenever a byte[] is encountered.

time:
2016-12-19T18:32:50Z
class:
core/src/main/java/org/elasticsearch/index/get/GetField.java
comments:
add inline comments on GetField binary values parsing

time:
2016-12-19T17:51:38Z
class:
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
comments:
Properly fail reindex-from-remote if can't detect content type

time:
2016-12-19T16:53:42Z
class:
core/src/test/java/org/elasticsearch/common/xcontent/support/XContentHelperTests.java
comments:
[TEST] add unit test for XContentHelper#toXContent method

time:
2016-12-19T16:21:26Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/action/get/GetResponse.java
core/src/main/java/org/elasticsearch/action/get/MultiGetResponse.java
core/src/main/java/org/elasticsearch/common/text/Text.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentHelper.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentParserUtils.java
core/src/main/java/org/elasticsearch/index/get/GetField.java
core/src/main/java/org/elasticsearch/index/get/GetResult.java
core/src/main/java/org/elasticsearch/rest/action/RestToXContentListener.java
core/src/main/java/org/elasticsearch/rest/action/document/RestGetAction.java
core/src/test/java/org/elasticsearch/action/get/GetResponseTests.java
core/src/test/java/org/elasticsearch/common/xcontent/XContentParserUtilsTests.java
core/src/test/java/org/elasticsearch/index/get/GetFieldTests.java
core/src/test/java/org/elasticsearch/index/get/GetResultTests.java
test/framework/src/main/java/org/elasticsearch/test/RandomObjects.java
test/framework/src/main/java/org/elasticsearch/test/hamcrest/ElasticsearchAssertions.java
comments:
Add fromXContent method to GetResponse (#22082)

Moved field values `toXContent` logic to `GetField` (from `GetResult`), which outputs its own fields, and can also parse them now. Also added `fromXContent` to `GetResult` and `GetResponse`.

 The start object and end object for `GetResponse` output have been moved to `GetResult#toXContent`, from the corresponding rest action. This makes it possible to have `toXContent` and `fromXContent` completely symmetric, as parsing requires looping till an end object is found which is weird when the corresponding `toXContent` doesn't print that out.

This also introduces the foundation for testing retrieval of _source and stored field values.

time:
2016-12-19T15:57:26Z
class:
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ESClientYamlSuiteTestCase.java
comments:
Unescape \\r in stash dump

Oh windows.....

Relates to #22195

time:
2016-12-19T15:07:02Z
class:
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/flush/ShardFlushRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportShardFlushAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportShardRefreshAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStats.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/ShardStats.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeAction.java
core/src/main/java/org/elasticsearch/action/support/replication/BasicReplicationRequest.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicatedWriteRequest.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationOperation.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationRequest.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapInfo.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapSettings.java
core/src/main/java/org/elasticsearch/bootstrap/JNANatives.java
core/src/main/java/org/elasticsearch/bootstrap/Natives.java
core/src/main/java/org/elasticsearch/bootstrap/Spawner.java
core/src/main/java/org/elasticsearch/bootstrap/SystemCallFilter.java
core/src/main/java/org/elasticsearch/cluster/metadata/MappingMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java
core/src/main/java/org/elasticsearch/common/FieldMemoryStats.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java
core/src/main/java/org/elasticsearch/common/settings/AbstractScopedSettings.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/main/java/org/elasticsearch/common/xcontent/XContent.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentFactory.java
core/src/main/java/org/elasticsearch/common/xcontent/cbor/CborXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/smile/SmileXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/yaml/YamlXContent.java
core/src/main/java/org/elasticsearch/index/cache/query/QueryCacheStats.java
core/src/main/java/org/elasticsearch/index/engine/CommitStats.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/SegmentsStats.java
core/src/main/java/org/elasticsearch/index/fielddata/FieldDataStats.java
core/src/main/java/org/elasticsearch/index/fielddata/ShardFieldData.java
core/src/main/java/org/elasticsearch/index/flush/FlushStats.java
core/src/main/java/org/elasticsearch/index/get/GetStats.java
core/src/main/java/org/elasticsearch/index/mapper/AllFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java
core/src/main/java/org/elasticsearch/index/mapper/FieldNamesFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IdFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IndexFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/index/mapper/MetadataFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ParentFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/RoutingFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/SeqNoFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TypeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/UidFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/VersionFieldMapper.java
core/src/main/java/org/elasticsearch/index/merge/MergeStats.java
core/src/main/java/org/elasticsearch/index/refresh/RefreshStats.java
core/src/main/java/org/elasticsearch/index/search/stats/SearchStats.java
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointService.java
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointSyncAction.java
core/src/main/java/org/elasticsearch/index/shard/DocsStats.java
core/src/main/java/org/elasticsearch/index/shard/IndexingStats.java
core/src/main/java/org/elasticsearch/index/shard/LocalShardSnapshot.java
core/src/main/java/org/elasticsearch/index/shard/StoreRecovery.java
core/src/main/java/org/elasticsearch/index/store/StoreStats.java
core/src/main/java/org/elasticsearch/index/warmer/WarmerStats.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryFinalizeRecoveryRequest.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTargetHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RemoteRecoveryTargetHandler.java
core/src/main/java/org/elasticsearch/ingest/IngestDocument.java
core/src/main/java/org/elasticsearch/ingest/IngestStats.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSuggestAction.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorFactories.java
core/src/main/java/org/elasticsearch/search/suggest/Suggest.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionFieldStats.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionStats.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/action/admin/indices/create/CreateIndexIT.java
core/src/test/java/org/elasticsearch/action/admin/indices/flush/FlushBlocksIT.java
core/src/test/java/org/elasticsearch/action/admin/indices/refresh/RefreshBlocksIT.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationOperationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapCheckTests.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapSettingsTests.java
core/src/test/java/org/elasticsearch/bootstrap/SpawnerTests.java
core/src/test/java/org/elasticsearch/common/FieldMemoryStatsTests.java
core/src/test/java/org/elasticsearch/common/io/stream/BytesStreamsTests.java
core/src/test/java/org/elasticsearch/common/settings/SettingsTests.java
core/src/test/java/org/elasticsearch/common/settings/loader/JsonSettingsLoaderTests.java
core/src/test/java/org/elasticsearch/common/settings/loader/YamlSettingsLoaderTests.java
core/src/test/java/org/elasticsearch/common/xcontent/BaseXContentTestCase.java
core/src/test/java/org/elasticsearch/common/xcontent/ConstructingObjectParserTests.java
core/src/test/java/org/elasticsearch/common/xcontent/json/JsonXContentTests.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/gateway/GatewayIndexStateIT.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/fielddata/FieldDataStatsTests.java
core/src/test/java/org/elasticsearch/index/mapper/AllFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalMetadataMapper.java
core/src/test/java/org/elasticsearch/index/mapper/FieldNamesFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/GeoShapeFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
core/src/test/java/org/elasticsearch/index/mapper/UpdateMappingTests.java
core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/ConstantScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java
core/src/test/java/org/elasticsearch/index/suggest/stats/CompletionsStatsTests.java
core/src/test/java/org/elasticsearch/indices/IndicesModuleTests.java
core/src/test/java/org/elasticsearch/indices/stats/IndexStatsIT.java
core/src/test/java/org/elasticsearch/ingest/IngestDocumentTests.java
core/src/test/java/org/elasticsearch/recovery/RelocationIT.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorFactoriesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorParsingTests.java
core/src/test/java/org/elasticsearch/search/child/ChildQuerySearchIT.java
core/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchIT.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGeneratorTests.java
core/src/test/java/org/elasticsearch/transport/TransportServiceHandshakeTests.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/JsonProcessor.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/JsonProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/JsonProcessorTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorFieldMapperTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/transport/netty4/SimpleNetty4TransportTests.java
plugins/ingest-geoip/src/main/java/org/elasticsearch/ingest/geoip/GeoIpCache.java
plugins/ingest-geoip/src/main/java/org/elasticsearch/ingest/geoip/IngestGeoIpPlugin.java
plugins/ingest-geoip/src/test/java/org/elasticsearch/ingest/geoip/GeoIpCacheTests.java
plugins/ingest-geoip/src/test/java/org/elasticsearch/ingest/geoip/GeoIpProcessorFactoryTests.java
plugins/mapper-size/src/main/java/org/elasticsearch/index/mapper/size/SizeFieldMapper.java
qa/backwards-5.0/src/test/java/org/elasticsearch/backwards/IndexingIT.java
qa/evil-tests/src/test/java/org/elasticsearch/bootstrap/SystemCallFilterTests.java
qa/no-bootstrap-tests/src/test/java/org/elasticsearch/bootstrap/SpawnerNoBootstrapTests.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ObjectPath.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/parser/AbstractClientYamlTestFragmentParserTestCase.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/parser/DoSectionParserTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/restspec/ClientYamlSuiteRestApiParserFailingTests.java
test/framework/src/test/java/org/elasticsearch/transport/MockTcpTransportTests.java
comments:
Merge branch 'master' into enhancement/use_shard_bulk_for_single_ops

time:
2016-12-19T13:39:50Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/index/shard/LocalShardSnapshot.java
core/src/main/java/org/elasticsearch/index/shard/StoreRecovery.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/test/java/org/elasticsearch/action/admin/indices/create/CreateIndexIT.java
core/src/test/java/org/elasticsearch/gateway/GatewayIndexStateIT.java
core/src/test/java/org/elasticsearch/index/mapper/GeoShapeFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
core/src/test/java/org/elasticsearch/index/mapper/UpdateMappingTests.java
core/src/test/java/org/elasticsearch/search/child/ChildQuerySearchIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorFieldMapperTests.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
comments:
Atomic mapping updates across types (#22220)

This commit makes mapping updates atomic when multiple types in an index are updated. Mappings for an index are now applied in a single atomic operation, which also allows to optimize some of the cross-type updates and checks.

time:
2016-12-19T13:36:58Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportShardFlushAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportShardRefreshAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/test/java/org/elasticsearch/action/admin/indices/flush/FlushBlocksIT.java
core/src/test/java/org/elasticsearch/action/admin/indices/refresh/RefreshBlocksIT.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
comments:
Use correct block levels for TRA subclasses (#22224)

Subclasses of TransportReplicationAction can currently chose to implement block levels for which the request will be blocked.
- Refresh/Flush was using the block level METADATA_WRITE although they don't operate at the cluster meta data level (but more like shard level meta data which is not represented in the block levels). Their level has been changed to null so that they can operate freely in the presence of blocks.
- GlobChkptSync was using WRITE although it does not make any changes to the actual documents of a shard. The level has been changed to null so that it can operate freely in the presence of blocks.
The commit also adds a check for closed indices in TRA so that the right exception is thrown if refresh/flush/checkpoint syncing is attempted on a closed index (before it was throwing an IndexNotFoundException, now it's throwing IndexClosedException).

time:
2016-12-19T13:21:21Z
class:
comments:
Be explicit about the fact backslashes need to be escaped. (#22257)

Relates #22255

time:
2016-12-19T12:08:24Z
class:
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/flush/ShardFlushRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/ShardStats.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/support/replication/BasicReplicationRequest.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicatedWriteRequest.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationOperation.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationRequest.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/MappingMetaData.java
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointSyncAction.java
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationOperationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
qa/backwards-5.0/src/test/java/org/elasticsearch/backwards/IndexingIT.java
test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ObjectPath.java
comments:
Add BWC layer to seq no infra and enable BWC tests (#22185)

Sequence BWC logic consists of two elements:

1) Wire level BWC using stream versions.
2) A changed to the global checkpoint maintenance semantics.

For the sequence number infra to work with a mixed version clusters, we have to consider situation where the primary is on an old node and replicas are on new ones (i.e., the replicas will receive operations without seq#) and also the reverse (i.e., the primary sends operations to a replica but the replica can't process the seq# and respond with local checkpoint). An new primary with an old replica is a rare because we do not allow a replica to recover from a new primary. However, it can occur if the old primary failed and a new replica was promoted or during primary relocation where the source primary is treated as a replica until the master starts the target.

1) Old Primary & New Replica - this case is easy as is taken care of by the wire level BWC. All incoming requests will have their seq# set to `UNASSIGNED_SEQ_NO`, which doesn't confuse the local checkpoint logic (keeping it at `NO_OPS_PERFORMED`) 
2) New Primary & Old replica - this one is trickier as the global checkpoint service currently takes all in sync replicas into consideration for the global checkpoint calculation. In order to deal with old replicas, we change the semantics to say all *new node* in sync replicas. That means the replicas on old nodes don't count for the global checkpointing. In this state the seq# infra is not fully operational (you can't search on it, because copies may miss it) but it is maintained on shards that can support it. The old replicas will have to go through a file based recovery at some point and will get the seq# information at that point. There is still an edge case where a new primary fails and an old replica takes over. I'lll discuss this one with @ywelsch as I prefer to avoid it completely.

This PR also re-enables the BWC tests which were disabled. As such it had to fix any BWC issue that had crept in. Most notably an issue with the removal of the `timestamp` field in #21670.

The commit also includes a fix for the default value of the seq number field in replicated write requests (it was 0 but should be -2), that surface some other minor bugs which are fixed as well.

Last - I added some debugging tools like more sane node names and forcing replication request to implement a `toString`

time:
2016-12-19T09:52:07Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorFactories.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorFactoriesTests.java
comments:
Allow setting aggs after parsing them elsewhere (#22238)

This commit exposes public getters for the aggregations in
AggregatorFactories.Builder. The reason is that it allows to
parse the aggregation object from elsewhere (e.g. a plugin) and then
be able to get the aggregation builders in order to set them in
a SearchSourceBuilder.

The alternative would have been to expose a setter for the
AggregatorFactories.Builder object. But that would be making
the API a bit trappy.

time:
2016-12-19T09:48:38Z
class:
core/src/main/java/org/elasticsearch/common/settings/AbstractScopedSettings.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/test/java/org/elasticsearch/common/settings/SettingsTests.java
comments:
Speed up filter and prefix settings operations (#22249)

Today if a settings object has many keys ie. if somebody specifies
a gazillion synonym in-line (arrays are keys ending with ordinals) operations like
`Settings#getByPrefix` have a linear runtime. This can cause index creations to be
very slow producing lots of garbage at the same time. Yet, `Settings#getByPrefix` is called
quite frequently by group settings etc. which can cause heavy load on the system.

While it's not recommended to have synonym lists with 25k entries in-line these use-cases should
not have such a large impact on the cluster / node. This change introduces a view-like map
that filters based on the prefixes referencing the actual source map instead of copying all values
over and over again. A benchmark that adds a single key with 25k random synonyms between 2 and 5 chars
takes 16 seconds to get the synonym prefix 200 times while the filtered view takes 4 ms for the 200 iterations.

This relates to https://discuss.elastic.co/t/200-cpu-elasticsearch-5-index-creation-very-slow-with-a-huge-synonyms-list/69052

time:
2016-12-19T09:09:24Z
class:
comments:
Update painless-syntax.asciidoc

Fix asciidoc syntax

time:
2016-12-19T09:06:12Z
class:
plugins/ingest-geoip/src/main/java/org/elasticsearch/ingest/geoip/GeoIpCache.java
plugins/ingest-geoip/src/main/java/org/elasticsearch/ingest/geoip/IngestGeoIpPlugin.java
plugins/ingest-geoip/src/test/java/org/elasticsearch/ingest/geoip/GeoIpCacheTests.java
plugins/ingest-geoip/src/test/java/org/elasticsearch/ingest/geoip/GeoIpProcessorFactoryTests.java
comments:
Cache results of geoip lookups (#22231)

With this commit, we introduce a cache to the geoip ingest processor.
The cache is enabled by default and caches the 1000 most recent items.
The cache size is controlled by the setting `ingest.geoip.cache_size`.

Closes #22074

time:
2016-12-19T09:02:42Z
class:
comments:
Update JMH to 1.17.3

time:
2016-12-19T09:02:42Z
class:
comments:
Update Gradle shadow plugin for microbenchmarks to 1.2.4

time:
2016-12-19T08:55:13Z
class:
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
comments:
Fix MapperService.allEnabled(). (#22227)

It returns whether the last merged mapping has `_all` enabled rather than
whether any of the types has `_all` enabled.

time:
2016-12-19T08:54:27Z
class:
core/src/main/java/org/elasticsearch/index/mapper/AllFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java
core/src/main/java/org/elasticsearch/index/mapper/FieldNamesFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IdFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IndexFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/MetadataFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ParentFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/RoutingFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/SeqNoFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TypeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/UidFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/VersionFieldMapper.java
core/src/test/java/org/elasticsearch/index/mapper/AllFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalMetadataMapper.java
core/src/test/java/org/elasticsearch/index/mapper/FieldNamesFieldMapperTests.java
core/src/test/java/org/elasticsearch/indices/IndicesModuleTests.java
plugins/mapper-size/src/main/java/org/elasticsearch/index/mapper/size/SizeFieldMapper.java
comments:
The `_all` default mapper is not completely configured. (#22236)

In some cases, it might happen that the `_all` field gets a field type that is
not totally configured, and in particular lacks analyzers. This is due to the
fact that `AllFieldMapper.TypeParser.getDefault` uses `Defaults.FIELD_TYPE` as
a default field type, which does not have any analyzers configured since it
does not know about the default analyzers.

time:
2016-12-19T08:29:47Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/XContent.java
core/src/main/java/org/elasticsearch/common/xcontent/cbor/CborXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/smile/SmileXContent.java
core/src/main/java/org/elasticsearch/common/xcontent/yaml/YamlXContent.java
core/src/test/java/org/elasticsearch/common/settings/loader/JsonSettingsLoaderTests.java
core/src/test/java/org/elasticsearch/common/settings/loader/YamlSettingsLoaderTests.java
core/src/test/java/org/elasticsearch/common/xcontent/BaseXContentTestCase.java
core/src/test/java/org/elasticsearch/common/xcontent/ConstructingObjectParserTests.java
core/src/test/java/org/elasticsearch/common/xcontent/json/JsonXContentTests.java
core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/ConstantScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorParsingTests.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGeneratorTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/parser/AbstractClientYamlTestFragmentParserTestCase.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/parser/DoSectionParserTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/restspec/ClientYamlSuiteRestApiParserFailingTests.java
comments:
Enable strict duplicate checks for all XContent types (#22225)

With this commit we enable the Jackson feature 'STRICT_DUPLICATE_DETECTION'
by default for all XContent types (not only JSON).

We have also changed the name of the system property to disable this feature
from `es.json.strict_duplicate_detection` to the now more appropriate name
`es.xcontent.strict_duplicate_detection`.

Relates elastic/elasticsearch#19614
Relates elastic/elasticsearch#22073

time:
2016-12-19T08:10:58Z
class:
core/src/main/java/org/elasticsearch/ingest/IngestDocument.java
core/src/test/java/org/elasticsearch/ingest/IngestDocumentTests.java
comments:
Change type of ingest doc meta-data field 'TIMESTAMP' to `Date` (#22234)

With this commit we change the data type of the 'TIMESTAMP'
meta-data field from a formatted date string to a plain
`java.util.Date` instance. The main reason for this change is
that our benchmarks have indicated that this contributes
significantly to the time spent in the ingest pipeline.

The overhead in terms of indexing throughput of the ingest
pipeline is about 15% and breaks down roughly as follows:

* 5% overhead caused by the conversion from `XContent` -> `Map`
* 5% overhead caused by the timestamp formatting
* 5% overhead caused by the conversion `Map` -> `XContent`

Relates #22074

time:
2016-12-18T08:26:53Z
class:
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
modules/transport-netty4/src/test/java/org/elasticsearch/transport/netty4/SimpleNetty4TransportTests.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
test/framework/src/test/java/org/elasticsearch/transport/MockTcpTransportTests.java
comments:
Remove `doHandshake` test-only settings from TcpTransport (#22241)

In #22094 we introduce a test-only setting to simulate transport
impls that don't support handshakes. This commit implements the same logic
without a setting.

time:
2016-12-18T07:05:59Z
class:
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
InternalEngine should use global checkpoint when committing the translog

relates to #22212

time:
2016-12-17T14:20:46Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointService.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryFinalizeRecoveryRequest.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTargetHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RemoteRecoveryTargetHandler.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java
core/src/test/java/org/elasticsearch/recovery/RelocationIT.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
comments:
Tighten sequence numbers recovery

This commit touches addresses issues related to recovery and sequence numbers:
 - A sequence number can be assigned and a Lucene commit created with a
   maximum sequence number at least as large as that sequence number,
   yet the operation corresponding to that sequence number can be
   missing from both the Lucene commit and the translog. This means that
   upon recovery the local checkpoint will be stuck at or below this
   missing sequence number. To address this, we force the local
   checkpoint to the maximum sequence number in the Lucene commit when
   opening the engine. Note that there can still be gaps in the history
   in the translog but we do not address those here.
 - The global checkpoint is transferred to the target shard at the end
   of peer recovery.
 - Additionally, we reenable the relocation integration tests.

Lastly, this work uncovered some bugs in the assignment of sequence
numbers on replica operations:
 - setting the sequence number on replica write requests was missing,
   very likely introduced as a result of resolving merge conflicts
 - handling operations that arrive out of order on a replica and have a
   version conflict with a previous operation were never marked as
   processed

Relates #22212

time:
2016-12-17T10:49:57Z
class:
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/transport/TransportServiceHandshakeTests.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
comments:
Add infrastructure to manage network connections outside of Transport/TransportService (#22194)

Some expert users like UnicastZenPing today establishes real connections to nodes during it's ping
phase that can be used by other parts of the system. Yet, this is potentially dangerous
and undesirable unless the nodes have been fully verified and should be connected to in the
case of a cluster state update or if we join a newly elected master. For use-cases like this, this change adds the infrastructure to manually handle connections that are not publicly available on the node ie. should not be managed by `Transport`/`TransportSerivce`

time:
2016-12-17T10:45:55Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStats.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/stats/ShardStats.java
core/src/main/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeAction.java
core/src/main/java/org/elasticsearch/common/FieldMemoryStats.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java
core/src/main/java/org/elasticsearch/index/cache/query/QueryCacheStats.java
core/src/main/java/org/elasticsearch/index/engine/CommitStats.java
core/src/main/java/org/elasticsearch/index/engine/SegmentsStats.java
core/src/main/java/org/elasticsearch/index/fielddata/FieldDataStats.java
core/src/main/java/org/elasticsearch/index/fielddata/ShardFieldData.java
core/src/main/java/org/elasticsearch/index/flush/FlushStats.java
core/src/main/java/org/elasticsearch/index/get/GetStats.java
core/src/main/java/org/elasticsearch/index/merge/MergeStats.java
core/src/main/java/org/elasticsearch/index/refresh/RefreshStats.java
core/src/main/java/org/elasticsearch/index/search/stats/SearchStats.java
core/src/main/java/org/elasticsearch/index/shard/DocsStats.java
core/src/main/java/org/elasticsearch/index/shard/IndexingStats.java
core/src/main/java/org/elasticsearch/index/store/StoreStats.java
core/src/main/java/org/elasticsearch/index/warmer/WarmerStats.java
core/src/main/java/org/elasticsearch/ingest/IngestStats.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionFieldStats.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionStats.java
core/src/test/java/org/elasticsearch/common/FieldMemoryStatsTests.java
core/src/test/java/org/elasticsearch/common/io/stream/BytesStreamsTests.java
core/src/test/java/org/elasticsearch/index/fielddata/FieldDataStatsTests.java
core/src/test/java/org/elasticsearch/index/suggest/stats/CompletionsStatsTests.java
core/src/test/java/org/elasticsearch/indices/stats/IndexStatsIT.java
core/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchIT.java
comments:
Cleanup random stats serialization code (#22223)

Some of our stats serialization code duplicates complicated seriazliation logic
or could use existing building blocks from StreamOutput/Input. This commit
cleans up some of the serialization code.

time:
2016-12-17T07:31:57Z
class:
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapInfo.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapSettings.java
core/src/main/java/org/elasticsearch/bootstrap/JNANatives.java
core/src/main/java/org/elasticsearch/bootstrap/Natives.java
core/src/main/java/org/elasticsearch/bootstrap/Spawner.java
core/src/main/java/org/elasticsearch/bootstrap/SystemCallFilter.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentFactory.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSuggestAction.java
core/src/main/java/org/elasticsearch/search/suggest/Suggest.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapCheckTests.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapSettingsTests.java
core/src/test/java/org/elasticsearch/bootstrap/SpawnerTests.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/JsonProcessor.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/JsonProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/JsonProcessorTests.java
qa/evil-tests/src/test/java/org/elasticsearch/bootstrap/SystemCallFilterTests.java
qa/no-bootstrap-tests/src/test/java/org/elasticsearch/bootstrap/SpawnerNoBootstrapTests.java
comments:
Merge remote-tracking branch 'origin/master'

time:
2016-12-17T06:18:56Z
class:
core/src/main/java/org/elasticsearch/bootstrap/SystemCallFilter.java
comments:
Fix line lengths in renamed seccomp file

time:
2016-12-16T23:30:19Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapInfo.java
core/src/main/java/org/elasticsearch/bootstrap/JNANatives.java
core/src/main/java/org/elasticsearch/bootstrap/Natives.java
core/src/main/java/org/elasticsearch/bootstrap/Spawner.java
core/src/main/java/org/elasticsearch/bootstrap/SystemCallFilter.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapCheckTests.java
core/src/test/java/org/elasticsearch/bootstrap/SpawnerTests.java
qa/evil-tests/src/test/java/org/elasticsearch/bootstrap/SystemCallFilterTests.java
qa/no-bootstrap-tests/src/test/java/org/elasticsearch/bootstrap/SpawnerNoBootstrapTests.java
comments:
Refer to system call filter instead of seccomp

Today in the codebase we refer to seccomp everywhere instead of system
call filter even if we are not specifically referring to Linux. This
commit is a purely mechanical change to refer to system call filter
where appropriate instead of the general seccomp, and only leaves
seccomp in place when actually referring to the Linux implementation.

Relates #22243

time:
2016-12-16T23:22:54Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapSettings.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapCheckTests.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapSettingsTests.java
comments:
Rename bootstrap.seccomp to bootstrap.system_call_filter

We try to install a system call filter on various operating systems
(Linux, macOS, BSD, Solaris, and Windows) but the setting
(bootstrap.seccomp) to control this is named after the Linux
implementation (seccomp). This commit replaces this setting with
bootstrap.system_call_filter. For backwards compatibility reasons, we
fallback to bootstrap.seccomp and log a deprecation message if
bootstrap.seccomp is set. We intend to remove this fallback in
6.0.0. Note that now is the time to make this change it's likely that
most users are not making this setting anyway as prior to version 5.2.0
(currently unreleased) it was not necessary to configure anything to
enable a node to start up if the system call filter failed to install
(we marched on anyway) but starting in 5.2.0 it will be necessary in
this case.

Relates #22226

time:
2016-12-16T18:33:12Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/XContentFactory.java
comments:
Deprecate XContentType auto detection methods in XContentFactory (#22181)

With recent changes to our parsing code we have drastically reduced the places where we auto-detect the content type from the input. The usage of these methods spread in our codebase for no reason, given that in most of the cases we know the content type upfront and we don't need any auto-detection mechanism. Deprecating these methods is a way to try and make sure that these methods are carefully used, and hopefully not introduced in newly written code.

We have yet to fix the REST layer to read the Content-Type header, which is the long term solution, but for now we just want to make sure that the usage of these methods doesn't spread any further.

Relates to #19388

time:
2016-12-16T18:17:27Z
class:
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/JsonProcessor.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/JsonProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/JsonProcessorTests.java
comments:
Enables the ability to inject serialized json fields into root of document. (#22179)

The JSON processor has an optional field called "target_field".
If you don't specify target_field then target_field becomes what you specified as "field".
There isn't anyway to add the fields to the root of a document. By
setting `add_to_root`, now serialized fields will be inserted into the
top-level fields of the ingest document.

Closes #21898.

time:
2016-12-16T17:11:55Z
class:
comments:
Add documentation for Delete By Query Java API

Closes #22114

time:
2016-12-16T17:06:02Z
class:
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSuggestAction.java
core/src/main/java/org/elasticsearch/search/suggest/Suggest.java
comments:
Remove deprecated _suggest endpoint (#22203)

In #20305, _suggest endpoint was deprecated
in favour of using _search endpoint. This
commit removes the dedicated _suggest endpoint
entirely from master.

time:
2016-12-16T17:03:40Z
class:
client/rest/src/main/java/org/elasticsearch/client/RequestLogger.java
client/rest/src/main/java/org/elasticsearch/client/ResponseListener.java
client/rest/src/test/java/org/elasticsearch/client/RequestLoggerTests.java
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/ActionListener.java
core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/TransportGetTaskAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/repositories/put/PutRepositoryRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/create/CreateSnapshotRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/RestoreSnapshotRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/TransportRestoreSnapshotAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodeResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/shrink/ShrinkRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsRequest.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequest.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/ingest/IngestActionForwarder.java
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/action/support/ActiveShardsObserver.java
core/src/main/java/org/elasticsearch/action/support/master/TransportMasterNodeAction.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationResponse.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationAction.java
core/src/main/java/org/elasticsearch/action/termvectors/MultiTermVectorsRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java
core/src/main/java/org/elasticsearch/cli/Command.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateApplier.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateObserver.java
core/src/main/java/org/elasticsearch/cluster/InternalClusterInfoService.java
core/src/main/java/org/elasticsearch/cluster/MasterNodeChangePredicate.java
core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/AliasValidator.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexGraveyard.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java
core/src/main/java/org/elasticsearch/cluster/routing/DelayedAllocationService.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterServiceState.java
core/src/main/java/org/elasticsearch/common/CheckedConsumer.java
core/src/main/java/org/elasticsearch/common/blobstore/url/URLBlobContainer.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java
core/src/main/java/org/elasticsearch/common/joda/FormatDateTimeFormatter.java
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/main/java/org/elasticsearch/common/xcontent/AbstractObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ConstructingObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ContextParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentFactory.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentParserUtils.java
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContent.java
core/src/main/java/org/elasticsearch/discovery/zen/NodeJoinController.java
core/src/main/java/org/elasticsearch/discovery/zen/PublishClusterStateAction.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/gateway/DanglingIndicesState.java
core/src/main/java/org/elasticsearch/gateway/Gateway.java
core/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java
core/src/main/java/org/elasticsearch/gateway/GatewayMetaState.java
core/src/main/java/org/elasticsearch/gateway/GatewayService.java
core/src/main/java/org/elasticsearch/gateway/MetaStateService.java
core/src/main/java/org/elasticsearch/index/CompositeIndexEventListener.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/SearchSlowLog.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java
core/src/main/java/org/elasticsearch/index/mapper/DynamicTemplate.java
core/src/main/java/org/elasticsearch/index/mapper/FieldTypeLookup.java
core/src/main/java/org/elasticsearch/index/mapper/Mapping.java
core/src/main/java/org/elasticsearch/index/query/BoolQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/BoostingQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ConstantScoreQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/DisMaxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ExistsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/FieldMaskingSpanQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/FuzzyQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoPolygonQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoShapeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/HasChildQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/HasParentQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/IdsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchAllQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchNoneQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchPhrasePrefixQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchPhraseQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/NestedQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ParentIdQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/PrefixQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryBuilders.java
core/src/main/java/org/elasticsearch/index/query/QueryParseContext.java
core/src/main/java/org/elasticsearch/index/query/QueryParser.java
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/RangeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/RegexpQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanContainingQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanFirstQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanMultiTermQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanNearQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanNotQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanOrQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanTermQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanWithinQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TermQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TypeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/WildcardQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/WrapperQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilder.java
core/src/main/java/org/elasticsearch/index/shard/IndexEventListener.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/store/IndicesStore.java
core/src/main/java/org/elasticsearch/ingest/PipelineConfiguration.java
core/src/main/java/org/elasticsearch/ingest/PipelineExecutionService.java
core/src/main/java/org/elasticsearch/ingest/PipelineStore.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/node/NodeValidationException.java
core/src/main/java/org/elasticsearch/node/service/NodeService.java
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
core/src/main/java/org/elasticsearch/plugins/Plugin.java
core/src/main/java/org/elasticsearch/plugins/PluginCli.java
core/src/main/java/org/elasticsearch/plugins/RemovePluginCommand.java
core/src/main/java/org/elasticsearch/repositories/RepositoriesService.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/repositories/blobstore/LegacyBlobStoreFormat.java
core/src/main/java/org/elasticsearch/rest/RestRequest.java
core/src/main/java/org/elasticsearch/rest/action/RestActions.java
core/src/main/java/org/elasticsearch/rest/action/RestFieldStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterAllocationExplainAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterRerouteAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestCreateSnapshotAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestPutRepositoryAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestRestoreSnapshotAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestCreateIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndexPutAliasAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesAliasesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestRolloverIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestShrinkIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestValidateQueryAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestMultiGetAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestMultiTermVectorsAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestTermVectorsAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestUpdateAction.java
core/src/main/java/org/elasticsearch/rest/action/ingest/RestPutPipelineAction.java
core/src/main/java/org/elasticsearch/rest/action/ingest/RestSimulatePipelineAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestClearScrollAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestExplainAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchScrollAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSuggestAction.java
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/main/java/org/elasticsearch/search/DocValueFormat.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/aggregations/AbstractAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregationPhase.java
core/src/main/java/org/elasticsearch/search/aggregations/Aggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorBase.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorFactories.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/NonCollectingAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/SearchContextAggregations.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/BestBucketsDeferringCollector.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/BucketsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/DeferringBucketCollector.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/SingleBucketAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/children/ChildrenAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/children/ChildrenAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/children/ParentToChildrenAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/FilterAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/FilterAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/FilterAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoGridAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/global/GlobalAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/global/GlobalAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/global/GlobalAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/missing/MissingAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/missing/MissingAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/missing/MissingAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/missing/MissingParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/AbstractRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/AbstractRangeBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/BinaryRangeAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/BinaryRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/DateRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/DateRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/DateRangeParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/ip/IpRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/ip/IpRangeParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedBytesHashSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedMapSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedNumericSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedOrdinalsSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedSamplerParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/GlobalOrdinalsSignificantTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantLongTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantStringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/GND.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/JLHScore.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/NXYSignificanceHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/PercentageScore.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/SignificanceHeuristicParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/AbstractStringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/AbstractTermsParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/GlobalOrdinalsStringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/LongTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/StringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/support/IncludeExclude.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/MetricsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/NumericMetricsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/AvgAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/AvgAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/AvgAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/AvgParser.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityParser.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/GeoBoundsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/GeoBoundsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/GeoBoundsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/GeoBoundsParser.java
comments:
Merge branch 'master' into enhancement/use_shard_bulk_for_single_ops

time:
2016-12-16T15:45:56Z
class:
comments:
Explain how to use bulk processor in a test context

When using a bulk processor in test, you might write something like:

```java
BulkProcessor bulkProcessor = BulkProcessor.builder(client, new BulkProcessor.Listener() {
    @Override public void beforeBulk(long executionId, BulkRequest request) {}
    @Override public void afterBulk(long executionId, BulkRequest request, BulkResponse response) {}
    @Override public void afterBulk(long executionId, BulkRequest request, Throwable failure) {}
})
        .setBulkActions(10000)
        .setFlushInterval(TimeValue.timeValueSeconds(10))
        .build();

for (int i = 0; i < 10000; i++) {
    bulkProcessor.add(new IndexRequest("foo", "bar", "doc_" + i)
            .source(jsonBuilder().startObject().field("foo", "bar").endObject()
    ));
}

bulkProcessor.flush();
client.admin().indices().prepareRefresh("foo").get();
SearchResponse response = client.prepareSearch("foo").get();
// response does not contain any hit
```

The problem is that by default bulkProcessor defines the number of concurrent requests to 1 which is using behind the scene an Async BulkRequestHandler.
When you call `flush()` in a test, you expect it to flush all the content of the bulk so you can search for your docs.
But because of the async handling, there is a great chance that none of the documents has been indexed yet when you call the `refresh` method.

We should advice in our Java guide to explicitly set concurrent requests to `0` so users will use behind the scene the Sync BulkRequestHandler.

```java
BulkProcessor bulkProcessor = BulkProcessor.builder(client, new BulkProcessor.Listener() {
    @Override public void beforeBulk(long executionId, BulkRequest request) {}
    @Override public void afterBulk(long executionId, BulkRequest request, BulkResponse response) {}
    @Override public void afterBulk(long executionId, BulkRequest request, Throwable failure) {}
})
        .setBulkActions(5000)
        .setFlushInterval(TimeValue.timeValueSeconds(10))
        .setConcurrentRequests(0)
        .build();
```

Closes #22158.

time:
2016-12-16T15:22:07Z
class:
comments:
Merge branch 'pr/update-docs-51'

time:
2016-12-16T14:25:41Z
class:
comments:
Fix Link to virtual hosting of buckets

Was using markdown style instead of asciidoc

time:
2016-12-16T13:50:06Z
class:
comments:
Small typo fix in the docs. (#22180)

There is a small typo in the convert processor code example.

time:
2016-12-16T13:25:17Z
class:
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
comments:
[TEST] Add some testlogging

time:
2016-12-16T11:39:22Z
class:
comments:
Update bucket-script-aggregation.asciidoc (#22219)

Example is missing "params." for painless

time:
2016-12-16T08:31:03Z
class:
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
comments:
Merge pull request #22215 from masaruh/skip_empty_boost

Don't print empty indices_boost

time:
2016-12-16T08:06:57Z
class:
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
comments:
Only notify handshake handler onClose if it can be successfully removed

Depending on how the connection is closed the `#onChannelClosed` callback
might be invoked more than once or the handler has been processed by the response
of the handshake already. This commit only notifies the handler if was removed from
the pending map.

time:
2016-12-16T07:19:34Z
class:
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
comments:
Don't print empty indices_boost

time:
2016-12-16T06:07:51Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/main/java/org/elasticsearch/search/internal/FilteredSearchContext.java
core/src/main/java/org/elasticsearch/search/internal/SearchContext.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchLocalRequest.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchRequest.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchTransportRequest.java
core/src/main/java/org/elasticsearch/search/internal/SubSearchContext.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
core/src/test/java/org/elasticsearch/index/SearchSlowLogTests.java
core/src/test/java/org/elasticsearch/search/SearchServiceTests.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
core/src/test/java/org/elasticsearch/search/indicesboost/SimpleIndicesBoostSearchIT.java
core/src/test/java/org/elasticsearch/search/internal/ShardSearchTransportRequestTests.java
test/framework/src/main/java/org/elasticsearch/test/TestSearchContext.java
comments:
Merge pull request #21393 from masaruh/alias_boost

Resolve index names in indices_boost

time:
2016-12-16T04:22:54Z
class:
comments:
Fix doc bug for cgroup cpuacct usage metric

This commit fixes a silly doc bug where the field that represents the
total CPU time consumed by all tasks in the same cgroup was mistakenly
reported as "usage" instead of "usage_nanos".

Relates #21029

time:
2016-12-16T02:08:51Z
class:
comments:
Add skip for include segment file sizes REST tests

This commit adds a skip for the include segment file sizes REST tests on
nodes less than or equal to version 5.1.1 as the stats APIs did not
correctly account for this parameter prior to version 5.1.2.

Relates #21879

time:
2016-12-15T18:35:14Z
class:
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestExplainAction.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestExecutionContext.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ESClientYamlSuiteTestCase.java
comments:
Send error_trace by default when testing (#22195)

Sends the `error_trace` parameter with all requests sent by the
yaml test framework, including the doc snippet tests. This can be
overridden by settings `error_trace: false`. While this drift's
core's handling of the yaml tests from the client's slightly this
should only be a problem for tests that rely on the default value,
both of which I've fixed by setting the value explicitly.

This also escapes `\n` and `\t` in the `Stash dump on failure` so
the `stack_trace` is more readable.

Also fixes `RestUpdateSettingsAction` to not think of the `error_trace`
parameter as a setting.

time:
2016-12-15T18:24:47Z
class:
modules/transport-netty4/src/main/java/org/elasticsearch/transport/Netty4Plugin.java
comments:
Eagerly initialize Netty 4

Today we initialize Netty in a static initializer. We trigger this
method via static initializers from Netty-related classes, but we can
trigger this method earlier than we do to ensure that Netty is
initialized how we want it to be.

time:
2016-12-15T16:19:51Z
class:
client/rest/src/main/java/org/elasticsearch/client/RequestLogger.java
client/rest/src/test/java/org/elasticsearch/client/RequestLoggerTests.java
comments:
Don't use null charset in RequestLogger (#22197)

If the response comes back with a content type with a `null`
charset we were blindly using it, causing `NullPointerException`s.

Closes #22190

time:
2016-12-15T16:06:25Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/TransportRestoreSnapshotAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/ingest/IngestActionForwarder.java
core/src/main/java/org/elasticsearch/action/support/ActiveShardsObserver.java
core/src/main/java/org/elasticsearch/action/support/master/TransportMasterNodeAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationAction.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateApplier.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateObserver.java
core/src/main/java/org/elasticsearch/cluster/InternalClusterInfoService.java
core/src/main/java/org/elasticsearch/cluster/MasterNodeChangePredicate.java
core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java
core/src/main/java/org/elasticsearch/cluster/routing/DelayedAllocationService.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterServiceState.java
core/src/main/java/org/elasticsearch/discovery/zen/PublishClusterStateAction.java
core/src/main/java/org/elasticsearch/gateway/DanglingIndicesState.java
core/src/main/java/org/elasticsearch/gateway/Gateway.java
core/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java
core/src/main/java/org/elasticsearch/gateway/GatewayMetaState.java
core/src/main/java/org/elasticsearch/gateway/GatewayService.java
core/src/main/java/org/elasticsearch/index/CompositeIndexEventListener.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/index/shard/IndexEventListener.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/store/IndicesStore.java
core/src/main/java/org/elasticsearch/ingest/PipelineExecutionService.java
core/src/main/java/org/elasticsearch/ingest/PipelineStore.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/node/service/NodeService.java
core/src/main/java/org/elasticsearch/repositories/RepositoriesService.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/snapshots/RestoreService.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotShardsService.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java
core/src/main/java/org/elasticsearch/tasks/TaskManager.java
core/src/main/java/org/elasticsearch/tribe/TribeService.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TaskManagerTestCase.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionIngestTests.java
core/src/test/java/org/elasticsearch/action/index/TransportIndexActionIngestTests.java
core/src/test/java/org/elasticsearch/cluster/health/ClusterStateHealthTests.java
core/src/test/java/org/elasticsearch/cluster/routing/DelayedAllocationServiceTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryIT.java
core/src/test/java/org/elasticsearch/gateway/DanglingIndicesStateTests.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractGeoFieldDataTestCase.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/RangeFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/query/QueryShardContextTests.java
core/src/test/java/org/elasticsearch/index/query/RangeQueryRewriteTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryParserTests.java
core/src/test/java/org/elasticsearch/indices/IndicesLifecycleListenerSingleNodeTests.java
core/src/test/java/org/elasticsearch/indices/cluster/AbstractIndicesClusterStateServiceTestCase.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
core/src/test/java/org/elasticsearch/search/SearchServiceTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/ExtendedBoundsTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilderTests.java
core/src/test/java/org/elasticsearch/search/internal/ShardSearchTransportRequestTests.java
core/src/test/java/org/elasticsearch/search/rescore/QueryRescoreBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/MockIndexEventListener.java
test/framework/src/test/java/org/elasticsearch/search/MockSearchServiceTests.java
comments:
ClusterService should expose "applied" cluster states (i.e., remove ClusterStateStatus) (#21817)

`ClusterService` is responsible of updating the cluster state on every node (as a response to an API call on the master and when non-masters receive a new state from the master). When a new cluster state is processed, it is made visible via the `ClusterService#state` method and is sent to series of listeners. Those listeners come in two flavours - one is to change the state of the node in response to the new cluster state (call these cluster state appliers), the other is to start a secondary process. Examples for the later include an indexing operation waiting for a shard to be started or a master node action waiting for a master to be elected. 

The fact that we expose the state before applying it means that samplers of the cluster state had to worry about two things - working based on a stale CS and working based on a future, i.e., "being applied" CS. The `ClusterStateStatus` was used to allow distinguishing between the two. Working with a stale cluster state is not avoidable. How this PR changes things to make sure consumers don't need to worry about future CS, removing the need for the status and simplifying the waiting logic.

This change does come with a price as "cluster state appliers" can't sample the cluster state from `ClusterService` whenever they want as the cluster state isn't exposed yet. However, recent clean ups made this is situation easier and this PR takes the last steps to remove such sampling. This also helps clarify the "information flow" and helps component separation (and thus potential unit testing). It also adds an assertion that will trigger if the cluster state is sampled by such listeners. 

Note that there are still many "appliers" that could be made a simpler, unrestricted "listener" but this can be done in smaller bits in the future. The commit also makes it clear what the `appliers` and what the `listeners` are by using dedicated interfaces.

Also, since I had to change the listener types I went ahead and changed the data structure for temporary/timeout listeners (used for the observer) so addition and removal won't be an O(n) operation.

time:
2016-12-15T15:12:33Z
class:
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationResponse.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationResponseTests.java
comments:
Add unit tests for toXContent methods in ReplicationResponse (#22188)

This commit adds unit tests for the toXContent() methods of the inner classes  ReplicationResponse.ShardInfo and ReplicationResponse.ShardInfo.Failure.

time:
2016-12-15T12:29:11Z
class:
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestNodesStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesStatsAction.java
comments:
Fix handling of segment file sizes in stats API

This commit addresses an issue in the stats APIs where
include_segment_file_sizes was not being consumed leading to requests
containing this parameter being rejected.

Relates #21879

time:
2016-12-15T11:47:01Z
class:
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
comments:
Remove TCP handshake BWC from master (#22151)

Since #22094 has been back-ported to 5.2 we can remove all BWC layers from master since all supported version will handle handshake requests.

Relates to #22094

time:
2016-12-15T11:41:50Z
class:
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
comments:
Handle race-condition when connection is closed before handshake listener was added

Today sending a message on a closed channel doesn't throw an exception. The channel
might just swallow the exception and informs the internal async exception handler
that a channel got disconnected. This change adds a safety check that we fail
the handshake if we registered a handler but the channel has been closed already
for instance due to a reset by peer.

time:
2016-12-15T10:08:17Z
class:
core/src/main/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilder.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
comments:
Fix boost_mode propagation when the function score query builder is rewritten (#22172)

This change fixes the cloning of the FunctionScoreQueryBuilder when the inner query or functions are rewritten.

Fixes #22138

time:
2016-12-15T08:20:28Z
class:
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java
core/src/main/java/org/elasticsearch/index/mapper/FieldTypeLookup.java
core/src/main/java/org/elasticsearch/index/mapper/Mapping.java
core/src/test/java/org/elasticsearch/index/mapper/FieldTypeLookupTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
comments:
Only update DocumentMapper if field type changes (#22165)

Merging mappings ensures that fields are used consistently across mapping types. Disabling norms for a specific field in one mapping type for example also disables norms for the same field in other mapping types of that index. The logic that ensures this while merging mappings currently always creates a fresh document mapper for all existing mapping types, even if no change occurred. Creating such a fresh document mapper does not come for free though as it involves recompressing the source. Making a mapping change to one type of an index with 100 types will thus re-serialize and recompress all 100 types, independent of any changes made to those types.

This commit fixes the update logic to only create a new DocumentMapper if a field type actually changes.

time:
2016-12-15T06:31:18Z
class:
core/src/test/java/org/elasticsearch/index/mapper/MultiFieldIncludeInAllMapperTests.java
comments:
1. add license declaration in class header
2. remove Created by declaration
3. fix typo method name from testExceptionForCopyToInMultiFields to testExceptionForIncludeInAllInMultiFields
4. fix typo method name from createMappinmgWithIncludeInAllInMultiField to createMappingWithIncludeInAllInMultiField
5. use expectThrows rather than try catch according to nik9000's comments

time:
2016-12-15T02:49:53Z
class:
core/src/main/java/org/elasticsearch/rest/action/search/RestSuggestAction.java
comments:
Deprecate _suggest endpoint in favour of _search (#20305)

* Replace _suggest endpoint to _search in docs

In 5.0, the _suggest endpoint is just sugar for _search
with suggestions specified. Users should move away from
using the _suggest endpoint, as it is marked as deprecated in 5.x and
will be removed in 6.0

* update docs to use _search endpoint instead of _suggest

* Add deprecation logging to RestSuggestAction

* Use search endpoint instead of suggest endpoint in rest tests

time:
2016-12-15T01:26:51Z
class:
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ScriptProcessor.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorTests.java
comments:
compile ScriptProcessor inline scripts when creating ingest pipelines (#21858)

Inline scripts defined in Ingest Pipelines are now compiled at creation time to preemptively catch errors on initialization of the pipeline.

Fixes #21842.

time:
2016-12-14T23:02:07Z
class:
comments:
Build: Remove hardcoded reference to x-plugins in build (#21773)

* Build: Remove hardcoded reference to x-plugins in build

The gradle build currenlty allows extra plugins to be hooked into the
elasticsearch build by placing under an x-plugins directory as a sibling
of the elasticsearch checkout. This change converts this directory to
one called elasticsearch-extra. The subdirectories of
elasticsearch-extra become first level projects in gradle (while before
they would have been subprojects of `:x-plugins`. Additionally, this
allows major version checkouts to be associated with extra plugins. For
example, you could have elasticsearch checked out as
`elasticsearch-5.x`, and a sibling `elasticsearch-5.x-extra` directory.

time:
2016-12-14T22:04:14Z
class:
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
comments:
Handle connection close / reset events gracefully during handshake (#22178)

Low level handshake code doesn't handle situations gracefully if the connection
is concurrently closed or reset by peer. This commit adds the relevant code to
fail the handshake if the connection is closed.

time:
2016-12-14T20:41:25Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/repositories/put/PutRepositoryRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/create/CreateSnapshotRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/RestoreSnapshotRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/shrink/ShrinkRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/rest/RestRequest.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterRerouteAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestCreateSnapshotAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestPutRepositoryAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestRestoreSnapshotAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestCreateIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndexPutAliasAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesAliasesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestRolloverIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestShrinkIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestUpdateAction.java
core/src/test/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequestTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/rest/RestRequestTests.java
core/src/test/java/org/elasticsearch/snapshots/SnapshotRequestsTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/TestDeprecationHeaderRestAction.java
comments:
Consolidate the last easy parser construction (#22095)

Moves the last of the "easy" parser construction into
`RestRequest`, this time with a new method
`RestRequest#contentParser`. The rest of the production
code that builds `XContentParser` isn't "easy" because it is
exposed in the Transport Client API (a Builder) object.

time:
2016-12-14T19:14:16Z
class:
core/src/test/java/org/elasticsearch/action/admin/indices/exists/IndicesExistsIT.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/gateway/RecoverAfterNodesIT.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
test/framework/src/test/java/org/elasticsearch/test/test/InternalTestClusterTests.java
comments:
Enforce min master nodes in test cluster (#22065)

In order to start clusters with min master nodes set without setting `discovery.initial_state_timeout`, #21846 has changed the way we start nodes. Instead to the previous serial start up, we now always start the nodes in an async fashion (internally). This means that starting a cluster is unsafe without `min_master_nodes` being set. We should therefore make it mandatory.

time:
2016-12-14T16:52:09Z
class:
core/src/test/java/org/elasticsearch/action/fieldstats/FieldStatsRequestTests.java
core/src/test/java/org/elasticsearch/common/xcontent/BaseXContentTestCase.java
core/src/test/java/org/elasticsearch/threadpool/ThreadPoolSerializationTests.java
comments:
Centralize remaining XContentParser creation in tests

Now we're ready to add `NamedXContentRegistry`.

time:
2016-12-14T16:37:52Z
class:
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationResponse.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationResponseTests.java
comments:
Add equals() and hashCode() methods to ReplicationResponse (#22168)

This commit adds the equals() and hashCode() methods to ReplicationResponse.ShardInfo and ReplicationResponse.ShardInfo.Failure classes.

time:
2016-12-14T15:11:44Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentParserUtils.java
core/src/test/java/org/elasticsearch/ElasticsearchExceptionTests.java
core/src/test/java/org/elasticsearch/common/xcontent/XContentParserUtilsTests.java
comments:
Add parsing method for ElasticsearchException (#22143)

ElasticsearchException is used in various response objects like IndexResponse, DeleteResponse or BulkItemResponse.Failure. It would be helpful to the High Level Rest Client to be able to parse these exceptions back.

This commit adds the fromXContent() method to the ElasticsearchException object. This method does not return the original (wrapped or unwrapped) exception but always returns a ElasticsearchException that serves as a simple POJO for all types of exceptions. The parsed ElasticsearchException's message will be composed of the original exception type (ex: illegal_argument_exception) concatenated with the original reason to help users/clients to known and handle the error.

time:
2016-12-14T14:04:24Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/NodeJoinController.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeJoinControllerTests.java
comments:
Prefer joining node with conflicting transport address when becoming master (#22134)

PR #22049 changed the node update logic to never remove nodes from the cluster state when the cluster state is not published. This led to an issue electing a master (#22120) based on nodes with same transport address (but different node id) as previous nodes. The joining nodes should take precedence over conflicting ones. Note that this only applies to the action of becoming master. If a master is established and a node joins an existing master, it will be rejected if there is another node with same transport address.

time:
2016-12-14T12:44:57Z
class:
comments:
Fix typo in command for checking single doc file

The recommended command line option for running the doc check on a single documentation file contained a typo.

h/t to @nik9000 for finding the typo.

time:
2016-12-14T11:37:11Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/LongTermsAggregator.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/LongTermsIT.java
comments:
Fix numeric terms aggregations with includes/excludes and minDocCount=0 (#22141)

For minDocCount=0 the numeric terms aggregator should also check the includes/excludes when buckets with empty count are added to the result.
This change fixes this bug and adds a test for it.

Fixes #22140

time:
2016-12-14T10:44:10Z
class:
comments:
Update script metric aggregation for 5.0

From 5.0, we are now using painless.

time:
2016-12-14T10:36:55Z
class:
comments:
Update script query doc for 5.1

From 5.1, we changed the order of Script class ctor.

Related to https://github.com/elastic/elasticsearch/pull/21321#issuecomment-266432519

time:
2016-12-14T10:36:32Z
class:
comments:
Update search template doc for 5.1

From 5.1, we can't use anymore `ScriptService.ScriptType` but `ScriptType`.

Related to https://github.com/elastic/elasticsearch/pull/21136#issuecomment-266429243

time:
2016-12-14T10:29:39Z
class:
comments:
Document using round-robin DNS for discovery (#21810)

* Document using round-robin DNS for discovery

Closes #8427

* Improve wording around round robin DNS

* Included jason's suggestion

time:
2016-12-14T09:03:09Z
class:
core/src/main/java/org/elasticsearch/search/DocValueFormat.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValueType.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceConfig.java
core/src/test/java/org/elasticsearch/search/aggregations/support/ValueTypeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/support/ValuesSourceConfigTests.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/support/MultiValuesSourceAggregatorFactory.java
comments:
Fix `missing` on aggs on `boolean` fields. (#22135)

The creation of the `ValuesSource` used to pass `DateTimeZone.UTC` as a time
zone all the time in case of empty fields in spite of the fact that all doc
value formats but the date one reject this parameter.

This commit centralizes the creation of the `ValuesSource` and adds unit tests
to it.

Closes #22009

time:
2016-12-14T08:35:53Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContent.java
core/src/test/java/org/elasticsearch/action/fieldstats/FieldStatsRequestTests.java
core/src/test/java/org/elasticsearch/common/settings/loader/JsonSettingsLoaderTests.java
core/src/test/java/org/elasticsearch/common/xcontent/ConstructingObjectParserTests.java
core/src/test/java/org/elasticsearch/common/xcontent/json/JsonXContentTests.java
core/src/test/java/org/elasticsearch/index/mapper/CopyToMapperTests.java
core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/ConstantScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorParsingTests.java
core/src/test/java/org/elasticsearch/search/nested/SimpleNestedIT.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGeneratorTests.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/MoreExpressionTests.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportPercolateAction.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorAggregationsIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorIT.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/restspec/ClientYamlSuiteRestApiParserFailingTests.java
comments:
Enable strict duplicate checks for JSON content

With this commit we enable the Jackson feature 'STRICT_DUPLICATE_DETECTION'
by default. This ensures that JSON keys are always unique. While this has
a performance impact, benchmarking has indicated that the typical drop in
indexing throughput is around 1 - 2%.

As a last resort, we allow users to still disable strict duplicate checks
by setting `-Des.json.strict_duplicate_detection=false` which is
intentionally undocumented.

Closes #19614

time:
2016-12-14T01:28:41Z
class:
core/src/test/java/org/elasticsearch/action/admin/indices/alias/AliasActionsTests.java
core/src/test/java/org/elasticsearch/action/termvectors/TermVectorsUnitTests.java
core/src/test/java/org/elasticsearch/common/geo/builders/AbstractShapeBuilderTestCase.java
core/src/test/java/org/elasticsearch/common/xcontent/cbor/CborXContentParserTests.java
core/src/test/java/org/elasticsearch/common/xcontent/support/filtering/AbstractFilteringJsonGeneratorTestCase.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingTests.java
core/src/test/java/org/elasticsearch/index/query/InnerHitBuilderTests.java
core/src/test/java/org/elasticsearch/index/search/geo/GeoUtilsTests.java
core/src/test/java/org/elasticsearch/indices/mapping/SimpleGetFieldMappingsIT.java
core/src/test/java/org/elasticsearch/ingest/IngestMetadataTests.java
core/src/test/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeActionTests.java
core/src/test/java/org/elasticsearch/script/ScriptMetaDataTests.java
core/src/test/java/org/elasticsearch/script/ScriptTests.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorParsingTests.java
core/src/test/java/org/elasticsearch/search/aggregations/BaseAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/BasePipelineAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/FiltersTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/ExtendedStatsBucketTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/PercentilesBucketTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/moving/avg/MovAvgTests.java
core/src/test/java/org/elasticsearch/search/aggregations/support/IncludeExcludeTests.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilderTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightFieldTests.java
core/src/test/java/org/elasticsearch/search/internal/InternalNestedIdentityTests.java
core/src/test/java/org/elasticsearch/search/rescore/QueryRescoreBuilderTests.java
core/src/test/java/org/elasticsearch/search/scroll/RestClearScrollActionTests.java
core/src/test/java/org/elasticsearch/search/scroll/RestSearchScrollActionTests.java
core/src/test/java/org/elasticsearch/search/scroll/SearchScrollIT.java
core/src/test/java/org/elasticsearch/search/searchafter/SearchAfterBuilderTests.java
core/src/test/java/org/elasticsearch/search/slice/SliceBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
core/src/test/java/org/elasticsearch/search/sort/FieldSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/ScoreSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/ScriptSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/SortBuilderTests.java
core/src/test/java/org/elasticsearch/search/suggest/AbstractSuggestionBuilderTestCase.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestBuilderTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/QueryContextTestCase.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGeneratorTests.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/SmoothingModelTestCase.java
core/src/test/java/org/elasticsearch/search/suggest/term/TermSuggestionBuilderTests.java
core/src/test/java/org/elasticsearch/tasks/TaskResultTests.java
core/src/test/java/org/elasticsearch/threadpool/ThreadPoolSerializationTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MustacheScriptEngineTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateIT.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateRequestTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/MultiPercolatorRequestTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorFieldMapperTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java
test/framework/src/test/java/org/elasticsearch/test/test/ESTestCaseTests.java
comments:
Consolidate more parser creation into ESTestCase

This will make it easier to add the forthcoming required argument,
`NamedXContentRegistry`.

time:
2016-12-14T01:10:05Z
class:
core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java
core/src/test/java/org/elasticsearch/common/io/stream/StreamTests.java
comments:
Avoid corruption when deserializing booleans

Today we write 0x00 or 0x01 for false or true when serializing a boolean
(and 0x02 for null when serializing an optional boolean) but we
deserialize any non-zero byte to true (except when deserializing an
optional boolean in which case we deserialize 0x02 to null, 0x01 to
true, and any other non-zero byte to false). This too easily allows
corruption into the stream. Instead, we should mark the stream as
corrupted and stop deserializing. This catches when we try to
deserialize something as a boolean that is not a boolean.

Relates #22152

time:
2016-12-14T00:10:11Z
class:
core/src/main/java/org/elasticsearch/cli/Command.java
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
core/src/main/java/org/elasticsearch/plugins/PluginCli.java
core/src/main/java/org/elasticsearch/plugins/RemovePluginCommand.java
core/src/test/java/org/elasticsearch/cli/CommandTests.java
qa/evil-tests/src/test/java/org/elasticsearch/cli/EvilCommandTests.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/ListPluginsCommandTests.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/RemovePluginCommandTests.java
test/framework/src/main/java/org/elasticsearch/bootstrap/ESElasticsearchCliTestCase.java
comments:
Add shutdown hook for closing CLI commands

This commit enables CLI commands to be closeable and installs a runtime
shutdown hook to ensure that if the JVM shuts down (as opposed to
aborting) the close method is called.

It is not enough to wrap uses of commands in main methods in
try-with-resources blocks as these will not run if, say, the virtual
machine is terminated in response to SIGINT, or system shutdown event.

Relates #22126

time:
2016-12-13T22:22:39Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/XContentFactory.java
core/src/test/java/org/elasticsearch/action/DocWriteResponseTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/shards/IndicesShardStoreResponseTests.java
core/src/test/java/org/elasticsearch/action/termvectors/TermVectorsUnitTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/IndexGraveyardTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/IndexMetaDataTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/ToAndFromJsonMetaDataTests.java
core/src/test/java/org/elasticsearch/cluster/routing/AllocationIdTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AllocationCommandsTests.java
core/src/test/java/org/elasticsearch/common/geo/GeoJSONShapeParserTests.java
core/src/test/java/org/elasticsearch/common/xcontent/ConstructingObjectParserTests.java
core/src/test/java/org/elasticsearch/common/xcontent/ObjectParserTests.java
core/src/test/java/org/elasticsearch/common/xcontent/XContentParserTests.java
core/src/test/java/org/elasticsearch/common/xcontent/builder/XContentBuilderTests.java
core/src/test/java/org/elasticsearch/common/xcontent/cbor/JsonVsCborTests.java
core/src/test/java/org/elasticsearch/common/xcontent/smile/JsonVsSmileTests.java
core/src/test/java/org/elasticsearch/common/xcontent/support/XContentMapValuesTests.java
core/src/test/java/org/elasticsearch/index/IndexTests.java
core/src/test/java/org/elasticsearch/index/mapper/CompletionFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/CopyToMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/SourceFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/CommonTermsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/PrefixQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryParseContextTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/search/geo/GeoPointParsingTests.java
core/src/test/java/org/elasticsearch/index/snapshots/blobstore/FileInfoTests.java
core/src/test/java/org/elasticsearch/repositories/IndexIdTests.java
core/src/test/java/org/elasticsearch/repositories/RepositoryDataTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregationCollectorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridParserTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/ExtendedBoundsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/significant/SignificanceHeuristicTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilderTests.java
core/src/test/java/org/elasticsearch/search/rescore/QueryRescoreBuilderTests.java
core/src/test/java/org/elasticsearch/search/searchafter/SearchAfterBuilderTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/CategoryContextMappingTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/GeoContextMappingTests.java
core/src/test/java/org/elasticsearch/threadpool/SimpleThreadPoolIT.java
core/src/test/java/org/elasticsearch/threadpool/ThreadPoolStatsTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/TemplateQueryBuilderTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RestReindexActionTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/parser/AbstractClientYamlTestFragmentParserTestCase.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/parser/AssertionParsersTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/parser/ClientYamlSuiteTestParserTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/parser/DoSectionParserTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/parser/SetSectionParserTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/parser/SetupSectionParserTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/parser/SkipSectionParserTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/parser/TeardownSectionParserTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/parser/TestSectionParserTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/restspec/ClientYamlSuiteRestApiParserFailingTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/restspec/ClientYamlSuiteRestApiParserTests.java
comments:
Continue consolidating `XContentParser` construction in tests (#22145)

Consolidate more parser creation in tests

Moves more parser creation in tests to the `createParser` methods
in `ESTestCase`.

time:
2016-12-13T21:20:44Z
class:
comments:
[TEST] Skip term / int partitioning tests in bwc tests pre 5.2.0

time:
2016-12-13T21:19:55Z
class:
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/Grok.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/GrokProcessor.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/GrokProcessorTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/GrokTests.java
comments:
Fixes GrokProcessor's ignorance of named-captures with same name. (#22131)

Grok was originally ignoring potential matches to named-capture groups
larger than one. For example, If you had two patterns containing the
same named field, but only the second pattern matched, it would fail to
pick this up.

This PR fixes this by exploring all potential places where a
named-capture was used and chooses the first one that matched.

Fixes #22117.

time:
2016-12-13T20:27:42Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodeResponse.java
comments:
Fix for loop that is bad and should feel bad

This commit fixes a for loop that reverses the order of shard stats
coming off the wire, and is really hard to read anyway (with the
post-increment in the loop initializer).

Relates #22150

time:
2016-12-13T20:06:23Z
class:
core/src/main/java/org/elasticsearch/transport/ConnectionProfile.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/main/java/org/elasticsearch/transport/Transport.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/main/java/org/elasticsearch/transport/TransportStatus.java
core/src/test/java/org/elasticsearch/client/transport/FailAndRetryMockTransport.java
core/src/test/java/org/elasticsearch/cluster/NodeConnectionsServiceTests.java
core/src/test/java/org/elasticsearch/transport/TCPTransportTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4MessageChannelHandler.java
modules/transport-netty4/src/test/java/org/elasticsearch/transport/netty4/Netty4TransportIT.java
test/framework/src/main/java/org/elasticsearch/test/transport/CapturingTransport.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
comments:
Introduce a low level protocol handshake (#22094)

Today we rely on the version that the API user passes in together with the DiscoveryNode. This commit introduces a low level handshake where nodes exchange their version to be used with the transport protocol that is executed every time a connection to a node is established. This, on the one hand allows to change the wire protocol based on the version we are talking to even without a full cluster restart. Today we would need to carry on a BWC layer across major versions but with a handshake we can rely on the fact that the latest version of the previous minor executes a handshake and uses the latest protocol version across all communication with the N+1 version nodes.

This change is yet fully backwards compatible, a followup PR will remove the BWC in 6.0 once this has been back-ported to the 5.x branch

time:
2016-12-13T16:22:15Z
class:
core/src/test/java/org/elasticsearch/common/xcontent/cbor/JsonVsCborTests.java
core/src/test/java/org/elasticsearch/common/xcontent/smile/JsonVsSmileTests.java
core/src/test/java/org/elasticsearch/common/xcontent/support/XContentMapValuesTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
Start to centralize creation of XContentParser in tests (#22096)

Starts to centralize creation of the `XContentParser` in
`protected final` methods on `ESTestCase`. The idea is to enable
adding `NamedXContentRegistry` relatively easily by giving tests
a single place they can override to define the
`NamedXContentRegistry`. Since `NamedXContentRegistry` doesn't
exist yet neither does the override point.

This doesn't attempt to migrate all the tests to calling the
new methods to build the parsers. I wanted to make this so we
could review the concept and then I'll merge a followup to
migrate the tests.

time:
2016-12-13T15:23:09Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/support/IncludeExclude.java
core/src/test/java/org/elasticsearch/search/aggregations/support/IncludeExcludeTests.java
comments:
Added tests for toXContent and fromXContent for IncludeExclude class.
New REST test revealed an issue with inconsistent hashing in partitioned
term tests which is also fixed in this change.

Closes #22102

time:
2016-12-13T15:15:52Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
Added version 2.4.3 plus bwc indices

time:
2016-12-13T14:01:51Z
class:
client/rest/src/main/java/org/elasticsearch/client/RequestLogger.java
comments:
Remove unused import from RequestLogger

Not only was StringJoiner unused, it's also a class only available in java 1.8, which is a problem given that the REST client has minimum java required set to 1.7

time:
2016-12-13T08:09:40Z
class:
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/aggregations/AbstractAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregationPhase.java
core/src/main/java/org/elasticsearch/search/aggregations/Aggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorBase.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorFactories.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/NonCollectingAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/SearchContextAggregations.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/BestBucketsDeferringCollector.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/BucketsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/DeferringBucketCollector.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/SingleBucketAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/children/ChildrenAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/children/ChildrenAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/children/ParentToChildrenAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/FilterAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/FilterAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/FilterAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoGridAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/global/GlobalAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/global/GlobalAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/global/GlobalAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/missing/MissingAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/missing/MissingAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/missing/MissingAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/AbstractRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/AbstractRangeBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/BinaryRangeAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/BinaryRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/DateRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/DateRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/ip/IpRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedBytesHashSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedMapSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedNumericSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedOrdinalsSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/GlobalOrdinalsSignificantTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantLongTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantStringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/AbstractStringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/GlobalOrdinalsStringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/LongTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/StringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/MetricsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/NumericMetricsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/AvgAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/AvgAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/AvgAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/GeoBoundsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/GeoBoundsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/GeoBoundsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/GeoCentroidAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/GeoCentroidAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/GeoCentroidAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/max/MaxAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/max/MaxAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/max/MaxAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/min/MinAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/min/MinAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/min/MinAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentileRanksAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentilesAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/AbstractHDRPercentilesAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/HDRPercentileRanksAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/HDRPercentileRanksAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/HDRPercentilesAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/HDRPercentilesAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/AbstractTDigestPercentilesAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/TDigestPercentileRanksAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/TDigestPercentileRanksAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/TDigestPercentilesAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/TDigestPercentilesAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/StatsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/StatsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/StatsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ExtendedStatsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ExtendedStatsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ExtendedStatsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/sum/SumAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/sum/SumAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/sum/SumAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/valuecount/ValueCountAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/valuecount/ValueCountAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/valuecount/ValueCountAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/support/AggregationContext.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceConfig.java
core/src/main/java/org/elasticsearch/search/profile/aggregation/ProfilingAggregator.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregationCollectorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorTests.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/matrix/stats/MatrixStatsAggregationBuilder.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/matrix/stats/MatrixStatsAggregator.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/matrix/stats/MatrixStatsAggregatorFactory.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/support/MultiValuesSourceAggregationBuilder.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/support/MultiValuesSourceAggregatorFactory.java
comments:
Remove `AggregationContext`. (#22124)

This class is just a wrapper around `SearchContext`, so let's use
`SearchContext` directly. The change is mechanical, except the
`ValuesSourceConfig` class, where I moved the logic to get a `ValuesSource`
given a config.

time:
2016-12-12T16:59:48Z
class:
core/src/main/java/org/elasticsearch/index/mapper/DynamicTemplate.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicTemplateTests.java
comments:
Throw an exception on unrecognized "match_mapping_type"

When using dynamic templates, ES will now throw an exception if a
`match_mapping_type` is used that doesn't correspond to an actual type.

Relates to #17285

time:
2016-12-12T16:35:00Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/node/NodeValidationException.java
core/src/main/java/org/elasticsearch/plugins/Plugin.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapCheckTests.java
core/src/test/java/org/elasticsearch/bootstrap/MaxMapCountCheckTests.java
test/framework/src/main/java/org/elasticsearch/node/NodeTests.java
comments:
Allow plugins to install bootstrap checks (#22110)

Plugins also have the need to provide better OOTB experience by configuring
defaults unless the plugin is used in _production_ mode. This change exposes
the bootstrap check infrastructure as part of the plugin API to allow plugins
to specify / install their own bootstrap checks if necessary.

time:
2016-12-12T14:00:53Z
class:
comments:
Clarify first search API explanation of parameters (#21958)

Added info about the sort parameter and included the pretty parameter in the example.

time:
2016-12-12T13:56:52Z
class:
comments:
add missing url-access-control link (#21960)

time:
2016-12-12T13:13:20Z
class:
core/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java
core/src/test/java/org/elasticsearch/index/query/MultiMatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
comments:
Merge pull request #22105 from geekpete/master

Fix Fuziness typo in multimatch error message and associated tests

time:
2016-12-12T11:37:12Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/AliasValidator.java
core/src/main/java/org/elasticsearch/index/query/BoolQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/BoostingQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ConstantScoreQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/DisMaxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ExistsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/FieldMaskingSpanQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/FuzzyQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoPolygonQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoShapeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/HasChildQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/HasParentQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/IdsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchAllQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchNoneQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchPhrasePrefixQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchPhraseQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/NestedQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ParentIdQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/PrefixQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryParseContext.java
core/src/main/java/org/elasticsearch/index/query/QueryParser.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/RangeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/RegexpQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanContainingQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanFirstQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanMultiTermQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanNearQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanNotQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanOrQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanTermQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SpanWithinQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TermQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TypeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/WildcardQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/WrapperQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/FilterAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/AbstractHighlighterBuilder.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchRequest.java
core/src/main/java/org/elasticsearch/search/rescore/QueryRescorerBuilder.java
core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java
core/src/main/java/org/elasticsearch/search/sort/SortBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggester.java
core/src/test/java/org/elasticsearch/aliases/IndexAliasesIT.java
core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/BoostingQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/ConstantScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/DisMaxQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/HasChildQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/HasParentQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryParseContextTests.java
core/src/test/java/org/elasticsearch/index/query/plugin/DummyQueryBuilder.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/FilterIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/FiltersIT.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TemplateQueryBuilder.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolatorFieldMapper.java
modules/percolator/src/main/java/org/elasticsearch/percolator/TransportPercolateAction.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorFieldMapperTests.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/TestDeprecatedQueryBuilder.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
comments:
Remove support for empty queries (#22092)

Our query DSL supports empty queries (`{}`), which have a different meaning depending on the query that holds it, either ignored, match_all or match_none. We deprecated the support for empty queries in 5.0, where we log a deprecation warning wherever they are used.

The way we supported it once we moved query parsing to the coordinating node was having an Optional<QueryBuilder> return type in all of our parse methods (called fromXContent). See #17624. The central place for this was QueryParseContext#parseInnerQueryBuilder. We can now remove all the optional return types and simply throw an exception whenever an empty query is found.

time:
2016-12-12T11:11:42Z
class:
client/rest/src/main/java/org/elasticsearch/client/RequestLogger.java
client/rest/src/test/java/org/elasticsearch/client/RequestLoggerTests.java
comments:
Warn log deprecation warnings received from server (#21895)

The warnings get printed out in a single line e.g. WARNING: request [DELETE http://localhost:9200/index/type/_api] returned 3 warnings:[this is warning number 0],[this is warning number 1],[this is warning number 2]

time:
2016-12-12T11:10:23Z
class:
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
comments:
Don't output empty ext object in SearchSourceBuilder#toXContent (#22093)

We shouldn't output an empty ext object if no ext sections have been set to the SearchSourceBuilder.

Closes #20969

time:
2016-12-12T11:09:16Z
class:
core/src/main/java/org/elasticsearch/index/query/FuzzyQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryBuilders.java
core/src/test/java/org/elasticsearch/index/query/FuzzyQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/RandomQueryBuilder.java
core/src/test/java/org/elasticsearch/search/profile/query/RandomQueryGenerator.java
comments:
Un-deprecate fuzzy query (#22088)

When we decided to deprecate and remove fuzzy query in #15760, we didn't realize we would take away the possibililty for uses to use a fuzzy query as part of a span query, which is not possible using match query. This means we have to go back and un-deprecate fuzzy query, which will not be removed.

Closes #15760

time:
2016-12-12T10:59:01Z
class:
plugins/repository-azure/src/main/java/org/elasticsearch/repositories/azure/AzureRepository.java
plugins/repository-azure/src/test/java/org/elasticsearch/repositories/azure/AzureRepositorySettingsTests.java
comments:
Merge branch 'fix/22053-azure-readonly'

time:
2016-12-12T01:33:31Z
class:
core/src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java
core/src/test/java/org/elasticsearch/index/query/MultiMatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
comments:
Fix Fuziness typo in multimatch error message and associated tests

time:
2016-12-11T13:37:12Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregationBuilder.java
comments:
 Rewrite filter queries in FiltersAggregationBuilder (#22076)

Queries must be rewritten before the query phase executes otherwise non-executable queries like `wrapper` query or `terms`  will fail or queries that require resources like script service can't access these service unless rewritten.

Relates to #21303

time:
2016-12-11T12:41:49Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/main/java/org/elasticsearch/search/internal/FilteredSearchContext.java
core/src/main/java/org/elasticsearch/search/internal/SearchContext.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchLocalRequest.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchRequest.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchTransportRequest.java
core/src/main/java/org/elasticsearch/search/internal/SubSearchContext.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
core/src/test/java/org/elasticsearch/index/SearchSlowLogTests.java
core/src/test/java/org/elasticsearch/search/SearchServiceTests.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
core/src/test/java/org/elasticsearch/search/indicesboost/SimpleIndicesBoostSearchIT.java
core/src/test/java/org/elasticsearch/search/internal/ShardSearchTransportRequestTests.java
test/framework/src/main/java/org/elasticsearch/test/TestSearchContext.java
comments:
Resolve index names in indices_boost

This change allows specifying alias/wildcard expression in indices_boost.
And added another format for specifying indices_boost. It accepts array of index name and boost pair.
If an index is included in multiple aliases/wildcard expressions, the first match will be used.
With new format, old format is marked as deprecated.

Closes #4756

time:
2016-12-11T08:55:53Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/support/IncludeExclude.java
comments:
Fix IncludeExclude parsing

`include` / `exclude` in terms / sig-terms aggs seems completely broken
and massively untested. This commit makes the TermsTests pass again that
randomly use `include` / `exclude`. This class must be tested individually
and we need real integ tests that use xcontent that use this feature.

time:
2016-12-10T20:11:05Z
class:
comments:
Restore proper bwcVersion in qa/backwards gradle build file

time:
2016-12-10T20:09:49Z
class:
comments:
fix typos in qa/backwards gradle build file

time:
2016-12-10T15:35:14Z
class:
comments:
Fix test for changed message

Message is only changed in 5.2.0 so we shouldn't assert on it
if we're running with any nodes less than that version.

time:
2016-12-10T12:49:47Z
class:
core/src/test/java/org/elasticsearch/bwcompat/RestoreBackwardsCompatIT.java
comments:
[TEST] Unmute testRestoreUnsupportedSnapshots

time:
2016-12-10T12:49:47Z
class:
core/src/test/java/org/elasticsearch/bwcompat/RestoreBackwardsCompatIT.java
comments:
[TEST] Handle legacy snapshots as if they don't exist anymore

An earlier commit removed BWC for pre-5.0 snapshots, which also meant removing the capability to load pre-5.0 snapshots. In 6.0, such snapshots are now
invisible and must be treated by the BWC tests in that way.

time:
2016-12-10T12:49:47Z
class:
core/src/main/java/org/elasticsearch/common/blobstore/url/URLBlobContainer.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
comments:
Throw NoSuchFileException to correctly adhere to readBlob contract

URLBlobContainer can in certain situations throw a FileNotFoundException. To fulfill the contract of the readBlob method it should throw a NoSuchFileException instead when the given blob cannot be found.

time:
2016-12-10T09:03:26Z
class:
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/main/java/org/elasticsearch/transport/Transport.java
core/src/main/java/org/elasticsearch/transport/TransportConnectionListener.java
core/src/main/java/org/elasticsearch/transport/TransportInterceptor.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/main/java/org/elasticsearch/transport/TransportServiceAdapter.java
core/src/test/java/org/elasticsearch/client/transport/FailAndRetryMockTransport.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientHeadersTests.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientNodesServiceTests.java
core/src/test/java/org/elasticsearch/cluster/ClusterInfoServiceIT.java
core/src/test/java/org/elasticsearch/cluster/NodeConnectionsServiceTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java
core/src/test/java/org/elasticsearch/index/store/CorruptedFileIT.java
core/src/test/java/org/elasticsearch/index/store/ExceptionRetryIT.java
core/src/test/java/org/elasticsearch/indices/recovery/IndexRecoveryIT.java
core/src/test/java/org/elasticsearch/indices/store/IndicesStoreIntegrationIT.java
core/src/test/java/org/elasticsearch/recovery/RelocationIT.java
core/src/test/java/org/elasticsearch/recovery/TruncatedRecoveryIT.java
core/src/test/java/org/elasticsearch/transport/TCPTransportTests.java
core/src/test/java/org/elasticsearch/transport/TransportServiceHandshakeTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
test/framework/src/main/java/org/elasticsearch/test/transport/CapturingTransport.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
test/framework/src/main/java/org/elasticsearch/transport/AssertingTransportInterceptor.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
comments:
Detach handshake from connect to node (#22037)

Today we connect and publish the nodes connection before we execute a
handshake with the node we connect to. In the case of connecting to a node
that won't pass the handshake this connection is already `published` and other
code paths can use it. This commit detaches the connection and the publish of the
connection such that `TransportService` can do a handshake before actually connect
and publish the connection.

time:
2016-12-10T01:23:02Z
class:
core/src/main/java/org/elasticsearch/action/ActionListener.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsRequest.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequest.java
core/src/main/java/org/elasticsearch/action/termvectors/MultiTermVectorsRequest.java
core/src/main/java/org/elasticsearch/common/CheckedConsumer.java
core/src/main/java/org/elasticsearch/rest/RestRequest.java
core/src/main/java/org/elasticsearch/rest/action/RestActions.java
core/src/main/java/org/elasticsearch/rest/action/RestFieldStatsAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterAllocationExplainAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestValidateQueryAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestMultiGetAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestMultiTermVectorsAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestTermVectorsAction.java
core/src/main/java/org/elasticsearch/rest/action/ingest/RestPutPipelineAction.java
core/src/main/java/org/elasticsearch/rest/action/ingest/RestSimulatePipelineAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestClearScrollAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestExplainAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchScrollAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSuggestAction.java
core/src/test/java/org/elasticsearch/action/fieldstats/FieldStatsRequestTests.java
core/src/test/java/org/elasticsearch/action/termvectors/TermVectorsUnitTests.java
core/src/test/java/org/elasticsearch/rest/RestRequestTests.java
core/src/test/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeActionTests.java
core/src/test/java/org/elasticsearch/search/scroll/RestClearScrollActionTests.java
core/src/test/java/org/elasticsearch/search/scroll/RestSearchScrollActionTests.java
core/src/test/java/org/elasticsearch/search/scroll/SearchScrollIT.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestMultiSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestRenderSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestSearchTemplateAction.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateIT.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateRequestTests.java
modules/percolator/src/main/java/org/elasticsearch/percolator/RestMultiPercolateAction.java
modules/percolator/src/main/java/org/elasticsearch/percolator/RestPercolateAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByQueryRestHandler.java
comments:
Begin centralizing XContentParser creation into RestRequest (#22041)

To get #22003 in cleanly we need to centralize as much `XContentParser` creation as possible into `RestRequest`. That'll mean we have to plumb the `NamedXContentRegistry` into fewer places.

This removes `RestAction.hasBody`, `RestAction.guessBodyContentType`, and `RestActions.getRestContent`, moving callers over to `RestRequest.hasContentOrSourceParam`, `RestRequest.contentOrSourceParam`, and `RestRequest.contentOrSourceParamParser` and `RestRequest.withContentOrSourceParamParserOrNull`. The idea is to use `withContentOrSourceParamParserOrNull` if you need to handle requests without any sort of body content and to use `contentOrSourceParamParser` otherwise.

I believe the vast majority of this PR to be purely mechanical but I know I've made the following behavioral change (I'll add more if I think of more):
* If you make a request to an endpoint that requires a request body and has cut over to the new APIs instead of getting `Failed to derive xcontent` you'll get `Body required`.
* Template parsing is now non-strict by default. This is important because we need to be able to deprecate things without requests failing.

time:
2016-12-09T20:50:46Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/get/TransportGetTaskAction.java
comments:
Improve the error message if task and node isn't found (#22062)

Improves the error message returned when looking up a task that
belongs to a node that is no longer part of the cluster. The new
error message tells the user that the node isn't part of the cluster.
This is useful because if you start a task and the node goes down
there isn't a record of the task at all. This hints to the user that
the task might have died with the node.

Relates to #22027

time:
2016-12-09T20:24:08Z
class:
comments:
Correct typo in "detect_noop" documentation (#22039)

The documentation reads:

> You can disable this behavior by setting "detect_noop": false like this:

Followed by a code example, that originally set `"detect_noop": true`.

Please correct me if I got the change backwards (i.e. the paragraph should be changed to `true`), but this seems like it makes the most sense.

time:
2016-12-09T18:05:00Z
class:
comments:
Fix BWC condition on REST test

Adds a missing skip section to a REST test that was forgotten in #21998

time:
2016-12-09T17:38:28Z
class:
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/main/java/org/elasticsearch/index/SearchSlowLog.java
core/src/test/java/org/elasticsearch/index/SearchSlowLogTests.java
comments:
Restores the original default format of search slow log

In 5.0, the search slow log switched to the multi-line format with no option to get back to the origin single-line format that was used prior to 5.0 by default. This commit removes the reformat option from the search slow log and returns the search slow log back to the single-line format.

Closes #21711

time:
2016-12-09T16:56:40Z
class:
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
comments:
Allow flush/force_merge/upgrade on shard marked as relocated (#22078)

A shard that is locally marked as relocated, but where the relocation target shard has not been activated yet by the master, can still receive index operations, which in return can lead to flushes being triggered. Flushing is currently (wrongly) prohibited on shards marked as relocated, which makes the flushing process go into an endless retry loop and log warnings until the shard is closed. This commit fixes this situation by allowing flush, force_merge and upgrade operations to run on shards that are marked as relocated.

time:
2016-12-09T16:33:31Z
class:
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataMappingServiceTests.java
comments:
Better error message when _parent isn't an object (#21987)

If you make a mistake and specify a mapping like:
```
{
  "parent": {
    "properties": {}
  },
  "child": {
    "_parent": "parent",
    "properties": {}
  }
}
```

then the error message you get back amounts to
`Failed to parse mapping for [child]: can't cast a String to a Map`.
Since it doens't tell you *which* string can't be cast to a map you
have to dig through the stack trace to figure out what to fix. This
replaces the error message with:
```
Failed to parse mapping [child]: [_parent] must be an object containing [type]
```
so you can tell that the problem is with the `parent` field.

time:
2016-12-09T15:39:51Z
class:
client/rest/src/main/java/org/elasticsearch/client/ResponseListener.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteWithAuthTests.java
comments:
Don't close rest client from its callback (#22061)

If you try to close the rest client inside one of its callbacks then
it blocks itself. The thread pool switches the status to one that
requests a shutdown and then waits for the pool to shutdown. When
another thread attempts to honor the shutdown request it waits
for all the threads in the pool to finish what they are working on.
Thus thread a is waiting on thread b while thread b is waiting
on thread a. It isn't quite that simple, but it is close.

Relates to #22027

time:
2016-12-09T13:55:48Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeRemovalClusterStateTaskExecutorTests.java
comments:
Don't update nodes list when stepping down as master (#22049)

This commit simplifies the node update logic so that nodes are never removed from the cluster state when the cluster state is not published.

time:
2016-12-09T13:52:06Z
class:
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java
core/src/test/java/org/elasticsearch/search/internal/InternalNestedIdentityTests.java
comments:
Add fromXContent to InternalNestedIdentity

This adds a fromXContent method and unit test to InternalNestedIdentity so we can parse it as part of a search response. This is part of the preparation for parsing search responses on the client side.

time:
2016-12-09T13:21:22Z
class:
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
comments:
Reject external versioning and explicit version numbers on create (#21998)

Fixes an issue where indexing requests with operation type "create" auto-convert external versioning to internal versioning and silently ignore the version number instead of failing with an error message.

time:
2016-12-09T12:45:57Z
class:
comments:
Fix typo in percolated-query.asciidoc (#21991)

time:
2016-12-09T10:32:40Z
class:
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
comments:
Add stored binary fields to static backwards compatibility indices tests (#22054)

Add stored binary fields to static backwards compatibility indices tests

time:
2016-12-09T09:41:07Z
class:
core/src/test/java/org/elasticsearch/bwcompat/RestoreBackwardsCompatIT.java
comments:
Mute RestoreBackwardsCompatIT.testRestoreUnsupportedSnapshots.

time:
2016-12-09T09:34:29Z
class:
comments:
Fixed typo (#22066)

time:
2016-12-09T08:48:48Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregationBuilder.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/FiltersTests.java
comments:
Fix `other_bucket` on the `filters` agg to be enabled if a key is set. (#21994)

Closes #21951

time:
2016-12-09T08:48:16Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/support/IncludeExclude.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/TermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/support/IncludeExcludeTests.java
comments:
Partition-based include-exclude does not implement equals/hashcode/serialization correctly. (#22051)

time:
2016-12-09T08:45:53Z
class:
core/src/main/java/org/elasticsearch/common/joda/FormatDateTimeFormatter.java
comments:
Document the `locale` option of the `date` field. (#22050)

This also adds another level of protection against using the default locale.
Relates to https://discuss.elastic.co/t/mapping-for-12h-date-format/68433/3.

time:
2016-12-09T08:45:16Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/IndexGraveyard.java
core/src/main/java/org/elasticsearch/common/xcontent/AbstractObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ConstructingObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ContextParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java
core/src/main/java/org/elasticsearch/ingest/PipelineConfiguration.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoGridAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/missing/MissingAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/missing/MissingParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/DateRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/DateRangeParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/ip/IpRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/ip/IpRangeParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedSamplerParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/GND.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/JLHScore.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/NXYSignificanceHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/PercentageScore.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/SignificanceHeuristicParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/AbstractTermsParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsParser.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/support/IncludeExclude.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/AvgAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/AvgParser.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityParser.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/GeoBoundsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/GeoBoundsParser.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/GeoCentroidAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/GeoCentroidParser.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/max/MaxAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/max/MaxParser.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/min/MinAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/min/MinParser.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/AbstractPercentilesParser.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentileRanksAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentileRanksParser.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentilesAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentilesMethod.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentilesParser.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/StatsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/StatsParser.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ExtendedStatsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ExtendedStatsParser.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/sum/SumAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/sum/SumParser.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/valuecount/ValueCountAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/valuecount/ValueCountParser.java
core/src/main/java/org/elasticsearch/search/aggregations/support/AbstractValuesSourceParser.java
core/src/main/java/org/elasticsearch/search/aggregations/support/GeoPointParser.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceParserHelper.java
core/src/main/java/org/elasticsearch/search/aggregations/support/XContentParseContext.java
core/src/test/java/org/elasticsearch/common/xcontent/ConstructingObjectParserTests.java
core/src/test/java/org/elasticsearch/common/xcontent/ObjectParserTests.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/GeoDistanceRangeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsSignificanceScoreIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/TermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridParserTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/significant/SignificanceHeuristicTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteResponseParsers.java
comments:
Start using `ObjectParser` for aggs. (#22048)

This is an attempt to start moving aggs parsing to `ObjectParser`. There is
still A LOT to do, but ObjectParser is way better than the way aggregations
parsing works today. For instance in most cases, we reject numbers that are
provided as strings, which we are supposed to accept since some client languages
(looking at you Perl) cannot make sure to use the appropriate types.

Relates to #22009

time:
2016-12-09T05:58:14Z
class:
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkShardRequest.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/common/lucene/uid/Versions.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java
core/src/main/java/org/elasticsearch/index/mapper/ParseContext.java
core/src/main/java/org/elasticsearch/index/mapper/ParsedDocument.java
core/src/main/java/org/elasticsearch/index/mapper/SeqNoFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/internal/SeqNoFieldMapper.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/TranslogRecoveryPerformer.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/indices/IndicesModule.java
core/src/main/java/org/elasticsearch/node/service/NodeService.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TasksIT.java
core/src/test/java/org/elasticsearch/index/IndexingSlowLogTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/engine/ShadowEngineTests.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractFieldDataImplTestCase.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractFieldDataTestCase.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractStringFieldDataTestCase.java
core/src/test/java/org/elasticsearch/index/fielddata/BinaryDVFieldDataTests.java
core/src/test/java/org/elasticsearch/index/fielddata/FilterFieldDataTests.java
core/src/test/java/org/elasticsearch/index/fielddata/GeoFieldDataTests.java
core/src/test/java/org/elasticsearch/index/fielddata/ParentChildFieldDataTests.java
core/src/test/java/org/elasticsearch/index/mapper/FieldNamesFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
core/src/test/java/org/elasticsearch/node/service/NodeServiceTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorFieldMapperTests.java
comments:
Merge branch 'master' into enhancement/use_shard_bulk_for_single_ops

time:
2016-12-09T05:48:35Z
class:
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java
core/src/main/java/org/elasticsearch/gateway/MetaStateService.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/repositories/blobstore/LegacyBlobStoreFormat.java
core/src/main/java/org/elasticsearch/snapshots/RestoreService.java
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/snapshots/BlobStoreFormatIT.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuildersTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
comments:
Remove 2.0 prerelease version constants (#22004)

* Remove 2.0 prerelease version constants

This is a start to addressing #21887. This removes:
* pre 2.0 snapshot format support
* automatic units addition to cluster settings
* bwc check for delete by query in pre 2.0 indexes

time:
2016-12-09T05:44:04Z
class:
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/NodeExplanation.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/index/IndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/ingest/IngestActionFilter.java
core/src/main/java/org/elasticsearch/action/ingest/IngestActionForwarder.java
core/src/main/java/org/elasticsearch/action/ingest/IngestProxyActionFilter.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AbstractAllocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocateUnassignedDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/IndexMetaDataUpdater.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/MoveDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/NodeAllocationResult.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/NodeRebalanceResult.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RebalanceDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RelocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RerouteExplanation.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/Decision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/EnableAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/MaxRetryAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/SameShardAllocationDecider.java
core/src/main/java/org/elasticsearch/gateway/BaseGatewayShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/ReplicaShardAllocator.java
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/GlobalOrdinalsBuilder.java
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/InternalGlobalOrdinalsIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractAtomicOrdinalsFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractIndexOrdinalsFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/DocValuesIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/IndexIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/PagedBytesAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/SortedSetDVBytesAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/SortedSetDVOrdinalsIndexFieldData.java
core/src/main/java/org/elasticsearch/index/mapper/IpFieldMapper.java
core/src/main/java/org/elasticsearch/index/shard/StoreRecovery.java
core/src/main/java/org/elasticsearch/indices/analysis/PreBuiltTokenFilters.java
core/src/main/java/org/elasticsearch/indices/analysis/PreBuiltTokenizers.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/ip/IpRangeAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightField.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/action/bulk/BulkRequestModifierTests.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionIngestTests.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionTookTests.java
core/src/test/java/org/elasticsearch/action/ingest/IngestActionFilterTests.java
core/src/test/java/org/elasticsearch/action/ingest/IngestProxyActionFilterTests.java
core/src/test/java/org/elasticsearch/action/support/replication/ClusterStateCreationUtils.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AllocateUnassignedDecisionTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AllocationDecisionTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/BalancedSingleShardTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/InSyncAllocationIdTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/MoveDecisionTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/NodeAllocationResultTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/SameShardRoutingTests.java
core/src/test/java/org/elasticsearch/gateway/ReplicaShardAllocatorTests.java
core/src/test/java/org/elasticsearch/index/fielddata/FieldDataCacheTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingDisabledTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/IpRangeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/IpTermsIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightFieldTests.java
core/src/test/java/org/elasticsearch/search/fields/SearchFieldsIT.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateResponse.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2Service.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImpl.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/plugin/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImplTests.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/AwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/plugin/repository/s3/S3RepositoryPlugin.java
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/AwsS3ServiceImplTests.java
test/framework/src/main/java/org/elasticsearch/AnalysisFactoryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/gateway/TestGatewayAllocator.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/ClientYamlTestSection.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/ClientYamlTestSectionTests.java
comments:
Merge branch 'master' into enhancement/use_shard_bulk_for_single_ops

time:
2016-12-09T02:59:52Z
class:
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkShardRequest.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TasksIT.java
comments:
Add descriptions to bulk tasks

Related to #21768

time:
2016-12-09T02:47:21Z
class:
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/common/lucene/uid/Versions.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java
core/src/main/java/org/elasticsearch/index/mapper/ParseContext.java
core/src/main/java/org/elasticsearch/index/mapper/ParsedDocument.java
core/src/main/java/org/elasticsearch/index/mapper/SeqNoFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/internal/SeqNoFieldMapper.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/TranslogRecoveryPerformer.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/indices/IndicesModule.java
core/src/test/java/org/elasticsearch/index/IndexingSlowLogTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/engine/ShadowEngineTests.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractFieldDataImplTestCase.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractFieldDataTestCase.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractStringFieldDataTestCase.java
core/src/test/java/org/elasticsearch/index/fielddata/BinaryDVFieldDataTests.java
core/src/test/java/org/elasticsearch/index/fielddata/FilterFieldDataTests.java
core/src/test/java/org/elasticsearch/index/fielddata/GeoFieldDataTests.java
core/src/test/java/org/elasticsearch/index/fielddata/ParentChildFieldDataTests.java
core/src/test/java/org/elasticsearch/index/mapper/FieldNamesFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorFieldMapperTests.java
comments:
Merge remote-tracking branch 'dakrone/index-seq-id-and-primary-term'

time:
2016-12-09T02:47:03Z
class:
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/common/lucene/uid/Versions.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java
core/src/main/java/org/elasticsearch/index/mapper/ParseContext.java
core/src/main/java/org/elasticsearch/index/mapper/ParsedDocument.java
core/src/main/java/org/elasticsearch/index/mapper/SeqNoFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/internal/SeqNoFieldMapper.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/TranslogRecoveryPerformer.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/indices/IndicesModule.java
core/src/test/java/org/elasticsearch/index/IndexingSlowLogTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/engine/ShadowEngineTests.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractFieldDataImplTestCase.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractFieldDataTestCase.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractStringFieldDataTestCase.java
core/src/test/java/org/elasticsearch/index/fielddata/BinaryDVFieldDataTests.java
core/src/test/java/org/elasticsearch/index/fielddata/FilterFieldDataTests.java
core/src/test/java/org/elasticsearch/index/fielddata/GeoFieldDataTests.java
core/src/test/java/org/elasticsearch/index/fielddata/ParentChildFieldDataTests.java
core/src/test/java/org/elasticsearch/index/mapper/FieldNamesFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorFieldMapperTests.java
comments:
Add internal _primary_term doc values field, fix _seq_no indexing

This adds the `_primary_term` field internally to the mappings. This field is
populated with the current shard's primary term.

It is intended to be used for collision resolution when two document copies have
the same sequence id, therefore, doc_values for the field are stored but the
filed itself is not indexed.

This also fixes the `_seq_no` field so that doc_values are retrievable (they
were previously stored but irretrievable) and changes the `stats` implementation
to more efficiently use the points API to retrieve the min/max instead of
iterating on each doc_value value. Additionally, even though we intend to be
able to search on the field, it was previously not searchable. This commit makes
it searchable.

There is no user-visible `_primary_term` field. Instead, the fields are
updated by calling:

```java
index.parsedDoc().updateSeqID(seqNum, primaryTerm);
```

This includes example methods in `Versions` and `Engine` for retrieving the
sequence id values from the index (see `Engine.getSequenceID`) that are only
used in unit tests. These will be extended/replaced by actual implementations
once we make use of sequence numbers as a conflict resolution measure.

Relates to #10708
Supercedes #21480

P.S. As a side effect of this commit, `SlowCompositeReaderWrapper` cannot be
used for documents that contain `_seq_no` because it is a Point value and SCRW
cannot wrap documents with points, so the tests have been updated to loop
through the `LeafReaderContext`s now instead.

time:
2016-12-09T00:59:02Z
class:
core/src/main/java/org/elasticsearch/node/service/NodeService.java
core/src/test/java/org/elasticsearch/node/service/NodeServiceTests.java
comments:
Avoid NPE in NodeService#stats if HTTP is disabled

This commit adds safety against an NPE if HTTP stats are requested but
HTTP is disabled on a node.

Relates #22060

time:
2016-12-08T22:17:41Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingDisabledTests.java
comments:
Add bwc for index/delete requests from pre-6.0 nodes

time:
2016-12-08T21:40:39Z
class:
comments:
Skip IP range query REST test prior to 5.1.2

This commit adds a skip for the IP range query REST test on version
prior to 5.1.2 due to a exclusive bug on the top end of the range.

time:
2016-12-08T21:40:39Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
Bump version to 5.1.2

This commit bumps the version to 5.1.2.

Relates #22057

time:
2016-12-08T18:17:31Z
class:
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/ClientYamlTestSection.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/ClientYamlTestSectionTests.java
comments:
Don't allow yaml tests with `warnings` that don't skip `warnings` (#21989)

If you write a yaml test with a `warnings` section in a `do` block
that doesn't also have a corresponding `skip` section for `warnings`
then client test runners that don't support `warnings` will fail.
This causes the elasticsearch build to fail so we catch these errors
earlier.

Related to #21811

time:
2016-12-08T17:54:00Z
class:
plugins/repository-azure/src/main/java/org/elasticsearch/repositories/azure/AzureRepository.java
plugins/repository-azure/src/test/java/org/elasticsearch/repositories/azure/AzureRepositorySettingsTests.java
comments:
readonly on azure repository must be taken into account

While I was fixing a documentation issue (#22007), I looked at the code and discovered that we actually never read what the user entered as a `readonly` parameter when he creates an azure repository.

So if someone sends:

```
PUT _snapshot/my_backup4
{
    "type": "azure",
    "settings": {
        "account": "my_account2",
        "location_mode": "primary_only",
        "readonly": true
    }
}
```

The repository is not actually defined as `readonly`.

It's caused by the fact we are always overwriting `readonly`setting based on `location_mode`.
If a user sets it to `primary_only`, `readonly` is forced to `false`.
If a user sets it to `primary_then_secondary`, `readonly` is forced to `false`.
If a user sets it to `secondary_only`, `readonly` is forced to `false`.

Note that with this change, a user can force a `secondary_only` repository to `readonly: false` which will lead him to an error later on when we check the repository as per definition in Azure, a secondary repository is not writable.
Another option could have been to detect this mismatch and throw an exception in that case. Note sure it is worth writing more code though.

Closes #22053.

time:
2016-12-08T17:21:19Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/SameShardAllocationDecider.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/SameShardRoutingTests.java
comments:
Cannot force allocate primary to a node where the shard already exists (#22031)

Before, it was possible that the SameShardAllocationDecider would allow
force allocation of an unassigned primary to the same node on which an
active replica is assigned.  This could only happen with shadow replica
indices, because when a shadow replica primary fails, the replica gets
promoted to primary but in the INITIALIZED state, not in the STARTED
state (because the engine has specific reinitialization that must take
place in the case of shadow replicas).  Therefore, if the now promoted
primary that is initializing fails also, the primary will be in the
unassigned state, because replica to primary promotion only happens when
the failed shard was in the started state.  The now unassigned primary
shard will go through the allocation deciders, where the
SameShardsAllocationDecider would return a NO decision, but would still
permit force allocation on the primary if all deciders returned NO.

This commit implements canForceAllocatePrimary on the
SameShardAllocationDecider, which ensures that a primary cannot be
force allocated to the same node on which an active replica already
exists.

time:
2016-12-08T17:00:56Z
class:
comments:
Fix REST test for ip range aggregations.

Relates to #22018

time:
2016-12-08T16:50:03Z
class:
comments:
Build: NORELEASE is the same as norelease (#22006)

Changes the build to recognize `NORELEASE` as well as `NOCOMMIT` to
mean the same thing as `norelease` and `nocommit` respectively. This
is useful because people have been using them that way but haven't
realized that only the lowercase versions worked.

This also explicitly forbids silly things like `NoReLeAsE` and
`noCOMMIT`, failing the build and telling you to spell them properly.

time:
2016-12-08T15:57:50Z
class:
comments:
S3/Azure snapshot repo documentation wrong for "read_only"

We used to write that people should use `read_only` although it should be `readonly`.

Closes #22007.

time:
2016-12-08T14:58:32Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/ip/IpRangeAggregationBuilder.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/IpRangeTests.java
comments:
IP range masks exclude the maximum address of the range. (#22018)

Closes #22005

time:
2016-12-08T11:44:40Z
class:
core/src/test/java/org/elasticsearch/index/mapper/MultiFieldIncludeInAllMapperTests.java
comments:
add test case for parse include_in_all in mulit fields

time:
2016-12-08T03:21:09Z
class:
core/src/main/java/org/elasticsearch/gateway/BaseGatewayShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/ReplicaShardAllocator.java
comments:
When shard data is still being fetched from nodes in the cluster,
the ReplicaShardAllocator, when in explain mode, would get the
node decisions for all nodes in the cluster.  The PrimaryShardAllocator
neglected to do this and tried to use the shard fetch data in explain
mode, which had not yet been fully fetched.  This commit fixes this by
ensuring the PrimaryShardAllocator gets node decisions in the same way
the ReplicaShardAllocator does in explain mode, if shard data is still
being fetched.

time:
2016-12-08T03:04:33Z
class:
core/src/main/java/org/elasticsearch/index/mapper/TypeParsers.java
comments:
modified code according to nik9000's comments.

time:
2016-12-08T00:41:59Z
class:
comments:
Fix systemd override example in configuring docs

When overriding a systemd configuration via a drop-in file, the
[Service] header is required. This commit adds this to an example
drop-in override in the configuring docs.

Relates #22038

time:
2016-12-07T22:37:51Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/NodeExplanation.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AbstractAllocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocateUnassignedDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/MoveDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/NodeAllocationResult.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/NodeRebalanceResult.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RebalanceDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RelocationDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RerouteExplanation.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/Decision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/EnableAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/MaxRetryAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/SameShardAllocationDecider.java
core/src/main/java/org/elasticsearch/gateway/BaseGatewayShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/ReplicaShardAllocator.java
core/src/main/java/org/elasticsearch/index/shard/StoreRecovery.java
core/src/test/java/org/elasticsearch/action/support/replication/ClusterStateCreationUtils.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AllocateUnassignedDecisionTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AllocationDecisionTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/BalancedSingleShardTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/MoveDecisionTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/NodeAllocationResultTests.java
core/src/test/java/org/elasticsearch/gateway/ReplicaShardAllocatorTests.java
test/framework/src/main/java/org/elasticsearch/test/gateway/TestGatewayAllocator.java
comments:
Prepares allocator decision objects for use with the allocation explain API (#21691)

This commit enhances the allocator decision result objects (namely,
AllocateUnassignedDecision, MoveDecision, and RebalanceDecision)
to enable them to be used directly by the cluster allocation explain API. In
particular, this commit does the following:

- Adds serialization and toXContent methods to the response objects,
which will form the explain API responses.
- Moves the calculation of the final explanation to the response
object itself, removing it from the responsibility of the allocators.
- Adds shard store information to the NodeAllocationResult, so that
store information is available for each node, when explaining a
shard allocation by the PrimaryShardAllocator or the ReplicaShardAllocator.
- Removes RebalanceDecision in favor of using MoveDecision for both
moving and rebalancing shards.
- Removes NodeRebalanceResult in favor of using NodeAllocationResult.
- Changes the notion of weight ranking to be relative to the current node,
instead of an absolute weight that doesn't convey any added value to the
API user and can be confusing.
- Introduces a new enum AllocationDecision to convey the decision type,
which enables conveying unassigned, moving, and rebalancing scenarios
with more detail as opposed to just Decision.Type and AllocationStatus.

time:
2016-12-07T18:24:28Z
class:
comments:
add Lua client (#22028)

Add entry for elasticsearch-lua (https://github.com/DhavalKapil/elasticsearch-lua)

time:
2016-12-07T18:11:55Z
class:
core/src/test/java/org/elasticsearch/action/bulk/BulkRequestModifierTests.java
comments:
[TEST] fixes line length issue in BulkRequestModifierTests

time:
2016-12-07T16:58:46Z
class:
comments:
Fix wrong link (#22019)

time:
2016-12-07T16:43:26Z
class:
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/ingest/IngestActionFilter.java
core/src/main/java/org/elasticsearch/action/ingest/IngestActionForwarder.java
core/src/main/java/org/elasticsearch/action/ingest/IngestProxyActionFilter.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/action/bulk/BulkRequestModifierTests.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionIngestTests.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionTookTests.java
core/src/test/java/org/elasticsearch/action/index/TransportIndexActionIngestTests.java
core/src/test/java/org/elasticsearch/action/ingest/IngestActionFilterTests.java
core/src/test/java/org/elasticsearch/action/ingest/IngestProxyActionFilterTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingDisabledTests.java
comments:
Ingest: Moved ingest invocation into index/bulk actions (#22015)

* Ingest: Moved ingest invocation into index/bulk actions

Ingest was originally setup as a plugin, and in order to hook into the
index and bulk actions, action filters were used. However, ingest was
later moved into core, but the action filters were never removed. This
change moves the execution of ingest into the index and bulk actions.

* Address PR comments

* Remove forwarder direct dependency on ClusterService

time:
2016-12-07T16:00:24Z
class:
comments:
Update order examples to use max instead of avg (#22032)

The use of the avg aggregation for sorting the terms aggregation is not encouraged since it has unbounded error. This changes the examples to use the max aggregation which does not suffer the same issues

time:
2016-12-07T15:32:44Z
class:
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightField.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightFieldTests.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateResponse.java
comments:
Add fromXContent to HighlightField

This adds a fromXContent method and unit test to the HighlightField class so we
can parse it as part of a serch response. This is part of the preparation for
parsing search responses on the client side.

time:
2016-12-07T15:00:48Z
class:
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2Service.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImpl.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/plugin/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImplTests.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/AwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/plugin/repository/s3/S3RepositoryPlugin.java
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/AwsS3ServiceImplTests.java
comments:
Merge pull request #21956 from alexshadow007/aws_read_timeout

Add setting to set read timeout for EC2 discovery and S3 repository plugins

time:
2016-12-07T14:58:22Z
class:
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
comments:
Add toString() for TransportReplicationAction.ConcreteShardRequest

time:
2016-12-07T14:20:36Z
class:
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/index/IndexRequestBuilder.java
comments:
Remove redundant source setters from IndexRequestBuilder

time:
2016-12-07T13:22:49Z
class:
comments:
Fix typos in threads docs

This commit fixes a typo in the threads docs where the past tense form
of a verb was used when current tense is needed.

Relates #22016

time:
2016-12-07T13:12:10Z
class:
comments:
[Docs] Correct setting name in snapshot/restore documentation (#22023)

There is no setting include_cluster_state for snapshot restore. The correct name for this setting is include_global_state.

time:
2016-12-07T12:59:43Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java
comments:
Promote shadow replica to primary when initializing primary fails (#22021)

Failing an initializing primary when shadow replicas are enabled for the index can leave the primary unassigned with replicas being active. Instead, a replica should be promoted to primary, which is fixed by this commit.

time:
2016-12-07T09:59:11Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/allocation/IndexMetaDataUpdater.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/InSyncAllocationIdTests.java
comments:
Trim in-sync allocations set only when it grows (#21976)

This commit makes two changes to how the in-sync allocations set is updated:

- the set is only trimmed when it grows. This prevents trimming too eagerly when the number of replicas was decreased while shards were unassigned.
- the allocation id of an active primary that failed is only removed from the in-sync set if another replica gets promoted to primary. This prevents the situation where the only available shard copy in the cluster gets removed the in-sync set.

Closes #21719

time:
2016-12-07T09:32:25Z
class:
core/src/main/java/org/elasticsearch/indices/analysis/PreBuiltTokenFilters.java
core/src/main/java/org/elasticsearch/indices/analysis/PreBuiltTokenizers.java
test/framework/src/main/java/org/elasticsearch/AnalysisFactoryTestCase.java
comments:
Pre-built analysis factories do not implement MultiTermAware correctly. (#21981)

We had tests for the regular factories, but not for the pre-built ones, that
ship by default without requiring users to define them in the analysis settings.

time:
2016-12-07T09:32:11Z
class:
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/GlobalOrdinalsBuilder.java
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/InternalGlobalOrdinalsIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractAtomicOrdinalsFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractIndexOrdinalsFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/DocValuesIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/IndexIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/PagedBytesAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/SortedSetDVBytesAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/SortedSetDVOrdinalsIndexFieldData.java
core/src/main/java/org/elasticsearch/index/mapper/IpFieldMapper.java
core/src/test/java/org/elasticsearch/index/fielddata/FieldDataCacheTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/IpTermsIT.java
core/src/test/java/org/elasticsearch/search/fields/SearchFieldsIT.java
comments:
Expose `ip` fields as strings in scripts. (#21997)

Currently we expose the internal representation that we use for ip addresses,
which are the ipv6 bytes. However, this is not really usable, exposes internal
implementation details and also does not work fine with other APIs that expect
that the values can be `toString`'d.

Closes #21977

time:
2016-12-07T05:43:04Z
class:
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/threadpool/ThreadPool.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionTookTests.java
core/src/test/java/org/elasticsearch/action/support/WaitActiveShardCountIT.java
core/src/test/java/org/elasticsearch/cluster/NoMasterNodeIT.java
core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingDisabledTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
comments:
Make index and delete operation execute as a single bulk item

Performance testing by @danielmitterdorfer revealed single
index/delete operations have similar performance (indexing
throughput) to equivalent single item bulk request.
This PR reduces the code paths to executing single write
operations, by reusing the logic in (shard) bulk action for
executing single operation as a single-item bulk request.

time:
2016-12-06T19:55:46Z
class:
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RestReindexActionTests.java
comments:
Reindex: Better error message for pipeline in wrong place (#21985)

`_update_by_query` supports specifying the `pipeline` to process the
documents as a url parameter but `_reindex` doesn't. It doesn't because
everything about the `_reindex` request that has to do with writing
the documents is grouped under the `dest` object in the request body.
This changes the response parameter from
`request [_reindex] contains unrecognized parameter: [pipeline]` to
`_reindex doesn't support [pipeline] as a query parmaeter. Specify it in the [dest] object instead.`

time:
2016-12-06T18:58:11Z
class:
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
comments:
InternalTestCluster shouldn't auto heal an active disruption when a new one is set

Instead people should explicitly clear the existing one so it's clear what's going on.

time:
2016-12-06T18:13:28Z
class:
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2Service.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImpl.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/AwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
comments:
Using ClientConfiguration.DEFAULT_SOCKET_TIMEOUT as default value for read timeout

time:
2016-12-06T16:29:09Z
class:
core/src/main/java/org/elasticsearch/action/termvectors/TransportTermVectorsAction.java
core/src/test/java/org/elasticsearch/action/termvectors/GetTermVectorsIT.java
comments:
Fix _termvectors with preference to not hit NPE (#21959)

When you submit a _termvectors request for an artificial document and
specify the 'preference' parameter to send the request to a particular
shard, the request sometimes hits NPE. Fix this case by ignoring the
auto-generated artificial document ID and pick a shard per the
preference parameter, or a random shard.

This closes #21928

time:
2016-12-06T12:32:57Z
class:
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStats.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsResponse.java
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IpFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/MappedFieldType.java
core/src/main/java/org/elasticsearch/index/mapper/NumberFieldMapper.java
core/src/test/java/org/elasticsearch/fieldstats/FieldStatsTests.java
comments:
Include unindexed field in FieldStats response (#21821)

* Include unindexed field in FieldStats response

This change adds non-searchable fields to the FieldStats response. These fields do not have min/max informations but they can be aggregatable. Fields that are only stored in _source (store:no, index:no, doc_values:no) will still be missing since they do not have any useful information to show. Indices and clients must be at least on V_5_2_0 to see this change.

time:
2016-12-06T11:06:15Z
class:
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainIT.java
core/src/test/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsIT.java
core/src/test/java/org/elasticsearch/action/support/master/IndexingMasterFailoverIT.java
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/cluster/ClusterInfoServiceIT.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/UpdateSettingsValidationIT.java
core/src/test/java/org/elasticsearch/cluster/allocation/AwarenessAllocationIT.java
core/src/test/java/org/elasticsearch/cluster/allocation/ClusterRerouteIT.java
core/src/test/java/org/elasticsearch/cluster/allocation/FilteringAllocationIT.java
core/src/test/java/org/elasticsearch/cluster/routing/DelayedAllocationIT.java
core/src/test/java/org/elasticsearch/cluster/routing/PrimaryAllocationIT.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/MockDiskUsagesIT.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/discovery/ZenUnicastDiscoveryIT.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryIT.java
core/src/test/java/org/elasticsearch/gateway/GatewayIndexStateIT.java
core/src/test/java/org/elasticsearch/gateway/MetaDataWriteDataNodesIT.java
core/src/test/java/org/elasticsearch/gateway/QuorumGatewayIT.java
core/src/test/java/org/elasticsearch/gateway/RecoveryFromGatewayIT.java
core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java
core/src/test/java/org/elasticsearch/index/store/CorruptedTranslogIT.java
core/src/test/java/org/elasticsearch/index/translog/TruncateTranslogIT.java
core/src/test/java/org/elasticsearch/indices/mapping/DedicatedMasterGetFieldMappingIT.java
core/src/test/java/org/elasticsearch/indices/state/RareClusterStateIT.java
core/src/test/java/org/elasticsearch/indices/store/IndicesStoreIntegrationIT.java
core/src/test/java/org/elasticsearch/nodesinfo/SimpleNodesInfoIT.java
core/src/test/java/org/elasticsearch/recovery/FullRollingRestartIT.java
core/src/test/java/org/elasticsearch/recovery/RelocationIT.java
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
plugins/discovery-azure-classic/src/test/java/org/elasticsearch/discovery/azure/classic/AzureDiscoveryClusterFormationTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryClusterFormationTests.java
plugins/discovery-gce/src/test/java/org/elasticsearch/discovery/gce/GceDiscoverTests.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
comments:
Remove `InternalTestCluster.startNode(s)Async` (#21846)

Since the removal of local discovery of #https://github.com/elastic/elasticsearch/pull/20960 we rely on minimum master nodes to be set in our test cluster. The settings is automatically managed by the cluster (by default) but current management doesn't work with concurrent single node async starting. On the other hand, with `MockZenPing` and the `discovery.initial_state_timeout` set to `0s` node starting and joining is very fast making async starting an unneeded complexity. Test that still need async starting could, in theory, still do so themselves via background threads.

Note that this change also removes the usage of `INITIAL_STATE_TIMEOUT_SETTINGS` as the starting of nodes is done concurrently (but building them is sequential)

time:
2016-12-06T09:07:51Z
class:
core/src/main/java/org/elasticsearch/ingest/Processor.java
comments:
Document thread-safety for ingest processors

With this commit we document that ingest processors need to be
thread-safe. Previously this could be inferred from reading the
source code but we got several user questions about this so
it is stated explicitly in the Javadocs of Processor now.

time:
2016-12-06T09:01:04Z
class:
core/src/main/java/org/elasticsearch/index/analysis/ASCIIFoldingTokenFilterFactory.java
core/src/test/java/org/elasticsearch/index/analysis/ASCIIFoldingTokenFilterFactoryTests.java
comments:
AsciiFoldingFilter's multi-term component should never preserve the original token. (#21982)

This ports the fix of https://issues.apache.org/jira/browse/LUCENE-7536 to
Elasticsearch's ASCIIFoldingTokenFilterFactory.

time:
2016-12-06T00:14:04Z
class:
core/src/main/java/org/elasticsearch/action/ingest/IngestActionFilter.java
core/src/main/java/org/elasticsearch/action/ingest/IngestProxyActionFilter.java
core/src/main/java/org/elasticsearch/action/support/ActionFilter.java
core/src/main/java/org/elasticsearch/action/support/ActionFilterChain.java
core/src/main/java/org/elasticsearch/action/support/TransportAction.java
core/src/test/java/org/elasticsearch/action/support/TransportActionFilterChainTests.java
core/src/test/java/org/elasticsearch/cluster/ClusterInfoServiceIT.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteWithAuthTests.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/ContextAndHeaderTransportIT.java
comments:
Plugins: Remove response action filters (#21950)

Action filters currently have the ability to filter both the request and
response. But the response side was not actually used. This change
removes support for filtering responses with action filters.

time:
2016-12-05T18:29:17Z
class:
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2Service.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImpl.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImplTests.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/AwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/AwsS3ServiceImplTests.java
comments:
Remove default value for read_timeout setting
Fix tests and docs

time:
2016-12-05T15:54:51Z
class:
client/rest/src/main/java/org/elasticsearch/client/RestClientBuilder.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/BulkByScrollTask.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteInfo.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteBuildRestClientTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteWhitelistTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteWithAuthTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexRequestTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexSourceTargetValidationTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RestReindexActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RetryTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RoundTripTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteInfoTests.java
test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java
comments:
Timeout improvements for rest client and reindex (#21741)

Changes the default socket and connection timeouts for the rest
client from 10 seconds to the more generous 30 seconds.

Defaults reindex-from-remote to those timeouts and make the
timeouts configurable like so:
```
POST _reindex
{
  "source": {
    "remote": {
      "host": "http://otherhost:9200",
      "socket_timeout": "1m",
      "connect_timeout": "10s"
    },
    "index": "source",
    "query": {
      "match": {
        "test": "data"
      }
    }
  },
  "dest": {
    "index": "dest"
  }
}
```

Closes #21707

time:
2016-12-05T14:31:53Z
class:
core/src/main/java/org/elasticsearch/action/get/GetResponse.java
comments:
Undeprecate GetResponse#getFields and GetResponse#getField

These functions should not have been deprecated as they can be used to retrieve stored and doc-value field.

time:
2016-12-05T11:14:34Z
class:
core/src/main/java/org/elasticsearch/index/mapper/TypeParsers.java
comments:
fix bug: https://github.com/elastic/elasticsearch/issues/21710

time:
2016-12-05T10:13:33Z
class:
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImpl.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
comments:
Merge pull request #21961 from alexshadow007/us-east-2

Add us-east-2 AWS region

time:
2016-12-04T20:23:35Z
class:
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryFailedException.java
comments:
Don't output null source node in RecoveryFailedException (#21963)

The RecoveryFailedException's output prints the source and
target nodes for the recovery.  However, sometimes there is
no source node for the recovery, only a target node (such as
when recovering a primary shard from disk).  In this case,
we don't want to display the source node.  This commit fixes
this by displaying "Recovery failed on target node.." instead
of "Recovery failed from null to target node" which is what the
output currently displays.

time:
2016-12-04T17:02:05Z
class:
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImpl.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
comments:
Add us-east-2 AWS region

time:
2016-12-04T13:06:01Z
class:
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
comments:
Increase test logging on test simple pings test

This commit increases the test logging on the unicast zeng ping test of
simple pings to gather more info for chasing a race condition that is
happening in this test.

time:
2016-12-04T03:19:55Z
class:
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
comments:
Increase timeouts in UnicastZenPingTests

Sadly, the timeouts here need to be increased to reduce the likelihood
of spurious test failures (test hosts under load are especially prone to
this). This does slow down this test suite a bit, but it's still not as
slow as it was before this endeavor of lowering these timeouts started.

time:
2016-12-04T03:00:30Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
comments:
Cleanup unicast zen ping unknown hosts cached test

This commit cleans up the unicast zen ping unknown hosts cached test:
 - send pings from the same node to more clearly indicate DNS lookups
   are not cached (within the same UnicastZenPing instance)
 - increase ping and wait timeout to 500ms to address race conditions
   (on a test host under load, the timeout was too short for the
   connect/handshake/ping cycle to complete)

time:
2016-12-03T22:58:53Z
class:
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2Service.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImpl.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/plugin/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/cloud/aws/AwsEc2ServiceImplTests.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/AwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/plugin/repository/s3/S3RepositoryPlugin.java
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/AwsS3ServiceImplTests.java
comments:
Add setting to set read timeout for EC2 discovery and S3 repository plugins

time:
2016-12-03T14:02:44Z
class:
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
comments:
Increase resolve timeout in unknown hosts test

The port limit test is a simple test that fakes that resolving an
address with a port range results the correct address collection.  This
test is subject to a race condition where the timeout on the resolve
request can fire before the resolve code finishes executing (this race
is exceptionally rare, because there are not actually any DNS lookups
being done here since we are just resolving addresses). This commit
increases the timeout here to significantly reduce the chance of a
losing race causing a spurious test failure. This increased timeout
should not increase the runtime of the test, just make failures less
likely.

time:
2016-12-03T13:46:24Z
class:
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
comments:
Increase resolve timeout in unknown hosts test

The unknown hosts test is a simple test that fakes that resolving an
address results in an unknown host exception. The main purpose of this
test is to ensure that we log (and do not silently drop) when a host
fails to resolve. This test is subject to a race condition where the
timeout on the resolve request can fire before the resolve code finishes
executing (this race is exceptionally rare, because there are not
actually any DNS lookups being done here, just a mock resolve
implementation that throws an exception and that's where losing the race
can arise). This commit increases the timeout here to significantly
reduce the chance of a losing race causing a spurious test failure. This
increased timeout should not increase the runtime of the test, just make
failures less likely.

time:
2016-12-03T02:46:38Z
class:
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByScrollRequest.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/CancelTests.java
comments:
Add proper descriptions to reindex, update-by-query and delete-by-query tasks.

Related to #21768

time:
2016-12-03T02:13:54Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/create/CreateSnapshotRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/RestoreSnapshotRequest.java
core/src/test/java/org/elasticsearch/snapshots/SnapshotTests.java
comments:
Add descriptions to create snapshot and restore snapshot tasks.

Related to #21768

time:
2016-12-03T01:46:26Z
class:
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
comments:
Rename method in InternalEngine

This commit renames InternalEngine#loadSeqNoStatsLucene to
InternalEngine#loadSeqNoStatsFromLucene to make this name consistent
with the method InternalEngine#loadSeqNoStatsFromLuceneAndTranslog.

time:
2016-12-02T22:54:51Z
class:
core/src/main/java/org/elasticsearch/action/ActionListener.java
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/http/HttpServer.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/ActionPlugin.java
core/src/main/java/org/elasticsearch/plugins/NetworkPlugin.java
core/src/main/java/org/elasticsearch/rest/RestController.java
core/src/main/java/org/elasticsearch/rest/RestFilter.java
core/src/main/java/org/elasticsearch/rest/RestFilterChain.java
core/src/test/java/org/elasticsearch/http/HttpServerTests.java
core/src/test/java/org/elasticsearch/rest/RestControllerTests.java
core/src/test/java/org/elasticsearch/rest/RestFilterChainTests.java
core/src/test/java/org/elasticsearch/rest/action/admin/cluster/RestNodesStatsActionTests.java
core/src/test/java/org/elasticsearch/rest/action/admin/indices/RestIndicesStatsActionTests.java
core/src/test/java/org/elasticsearch/rest/action/cat/RestIndicesActionTests.java
core/src/test/java/org/elasticsearch/rest/action/cat/RestRecoveryActionTests.java
comments:
Plugins: Replace Rest filters with RestHandler wrapper (#21905)

* Plugins: Replace Rest filters with RestHandler wrapper

RestFilters are a complex way of allowing plugins to add extra code
before rest actions are executed. This change removes rest filters, and
replaces with a wrapper which a single plugin may provide.

time:
2016-12-02T22:41:13Z
class:
modules/lang-painless/src/test/java/org/elasticsearch/painless/EqualsTests.java
comments:
Test fix for def equals test in Painless. (#21945)

Closes #21801

time:
2016-12-02T20:00:16Z
class:
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
comments:
Clarify global checkpoint recovery

Today when starting a new engine, we read the global checkpoint from the
translog only if we are opening an existing translog. This commit
clarifies this situation by distinguishing the three cases of engine
creation in the constructor leading to clearer code.

Relates #21934

time:
2016-12-02T19:27:54Z
class:
core/src/main/java/org/elasticsearch/bootstrap/BootstrapCheck.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapCheckTests.java
comments:
Add system call filter bootstrap check

Today if system call filters fail to install on startup, we log a
message but otherwise march on. This might leave users without system
call filters installed not knowing that they have implicitly accepted
the additional risk. We should not be lenient like this, instead clearly
informing the user that they have to either fix their configuration or
accept the risk of not having system call filters installed. This commit
adds a bootstrap check that if system call filters are enabled, they
must successfully install.

Relates #21940

time:
2016-12-02T18:48:51Z
class:
core/src/main/java/org/elasticsearch/action/bulk/Retry.java
core/src/test/java/org/elasticsearch/action/bulk/RetryTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ClientScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AsyncBulkByScrollActionTests.java
test/framework/src/main/java/org/elasticsearch/test/client/NoOpClient.java
comments:
Keep context during reindex's retries (#21941)

* Keep context during reindex's retries

This fixes reindex and friend's retries to keep the context.

* Docs

time:
2016-12-02T17:21:53Z
class:
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java
core/src/main/java/org/elasticsearch/common/transport/TransportAddress.java
core/src/test/java/org/elasticsearch/cluster/node/DiscoveryNodeTests.java
comments:
Do not lose host information when pinging

In #21828, serialization of the host string was added to preserve this information when
a TransportAddress gets serialized. However, there is still a case where this did not always
work. In UnicastZenPings, DiscoveryNode instances are created for the ping hosts with the
minimum compatibility version, which is currently less than the version required to preserve
the host information. This means that when a node is received from a PingResponse that the
host information is no longer set correctly on the InetSocketAddress contained in the
DiscoveryNode.

This commit adds a workaround for this situation by allowing the host string to be passed
into the TransportAddress constructor that takes a StreamInput and using that as the host
for the InetAddress that is created during deserialization.

time:
2016-12-02T15:49:51Z
class:
comments:
Update lowercase-tokenizer.asciidoc (#21896)

Fixed typo

time:
2016-12-02T15:39:20Z
class:
comments:
elasticsearch.R is abandoned (#21897)

README file reads: (This project is no longer maintained, if you would like to take over feel free to send me an email)

time:
2016-12-02T15:11:41Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/NodeExplanation.java
core/src/main/java/org/elasticsearch/bootstrap/JNACLibrary.java
core/src/main/java/org/elasticsearch/bootstrap/JNAKernel32Library.java
core/src/main/java/org/elasticsearch/bootstrap/JavaVersion.java
core/src/main/java/org/elasticsearch/bootstrap/Seccomp.java
core/src/main/java/org/elasticsearch/bootstrap/StartupException.java
comments:
Avoid some redundant unboxing and object creation (#21909)

time:
2016-12-02T13:02:23Z
class:
comments:
[DOC] Update node names (#21892)

Update the node names in the documentation.

time:
2016-12-02T12:25:40Z
class:
test/framework/src/main/java/org/elasticsearch/test/CompositeTestCluster.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ExternalNode.java
comments:
[TEST] Remove CompositeTestCluster and ExternalNode (#21933)

They are not used anymore. Related #21915

time:
2016-12-02T10:53:33Z
class:
modules/transport-netty4/src/test/java/org/elasticsearch/ESNetty4IntegTestCase.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/HttpSmokeTestCase.java
comments:
[TEST] Add back skip of external clusters

time:
2016-12-02T09:54:27Z
class:
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ExternalTestCluster.java
comments:
[TEST] Add back ExternalTestCluster - downstream tests still use it

time:
2016-12-02T09:34:33Z
class:
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
comments:
Port assert from 5.x to master

I added an assertion to Netty4/Netty3Transport in 5.x that is not in
master yet. This commit port the assert to ensure we consumed all connection
in `connectToChannels`

time:
2016-12-02T07:14:45Z
class:
core/src/main/java/org/elasticsearch/action/termvectors/TermVectorsWriter.java
core/src/test/java/org/elasticsearch/action/termvectors/GetTermVectorsIT.java
comments:
Return correct term statistics when a field is not found in a shard (#21922)

If you ask for the term vectors of an artificial document with
term_statistics=true, but a shard does not have any terms of the doc's
field(s), it returns the doc's term vectors values as the shard-level
term statistics. This commit fixes that to return 0 for `ttf` and also
field-level aggregated statistics.

Closes #21906

time:
2016-12-02T07:06:20Z
class:
core/src/test/java/org/elasticsearch/action/admin/indices/upgrade/UpgradeIT.java
core/src/test/java/org/elasticsearch/bwcompat/BasicAnalysisBackwardCompatibilityIT.java
core/src/test/java/org/elasticsearch/bwcompat/BasicBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/bwcompat/ClusterStateBackwardsCompatIT.java
core/src/test/java/org/elasticsearch/bwcompat/GetIndexBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/bwcompat/NodesStatsBasicBackwardsCompatIT.java
core/src/test/java/org/elasticsearch/bwcompat/TransportClientBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/bwcompat/UnicastBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/gateway/RecoveryBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/indices/analysis/PreBuiltAnalyzerIntegrationIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsBackwardCompatibilityIT.java
core/src/test/java/org/elasticsearch/search/functionscore/FunctionScoreBackwardCompatibilityIT.java
core/src/test/java/org/elasticsearch/snapshots/SnapshotBackwardsCompatibilityIT.java
modules/transport-netty4/src/test/java/org/elasticsearch/ESNetty4IntegTestCase.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/ContextAndHeaderTransportIT.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/CorsRegexIT.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/DetailedErrorsDisabledIT.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/HttpCompressionIT.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/HttpSmokeTestCase.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/ResponseHeaderPluginIT.java
test/framework/src/main/java/org/elasticsearch/test/ESBackcompatTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ExternalTestCluster.java
test/framework/src/main/java/org/elasticsearch/test/junit/listeners/ReproduceInfoPrinter.java
comments:
Remove legacy BWC test infrastructure and tests (#21915)

We don't use the test infra nor do we run the tests. They might all be
entirely out of date. We also have a different BWC test infra in-place.
This change removes all of the legacy infra.

time:
2016-12-02T03:10:47Z
class:
comments:
Add skip for missing types REST test

This commit adds a skip for the missing types REST test. There was a bug
for an unclosed XContent object on version prior to version 5.0.3 which
is going to lead to different responses on vresions prior to 5.0.3 and
versions on or after version 5.0.3.

time:
2016-12-02T02:27:02Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ShardsLimitAllocationDecider.java
comments:
Refactor shard limit allocation decider

This commit simplifies the shard limit allocation decider, removing some
duplicated code into a common method.

Relates #21845

time:
2016-12-02T01:05:19Z
class:
comments:
Fix reference to jvm.options docs

The reference for the jvm.options docs recently changed from
es-java-opts to jvm-options. This commit fixes a broken reference that
arose as a result of this change.

time:
2016-12-02T00:57:12Z
class:
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetMappingAction.java
comments:
Mappings: Fix get mapping when no indexes exist to not fail in response generation (#21924)

When there are no indexes, get mapping has a series of special cases.
Two of those expect the response object already started, and the other
two respond with an exception. Those two cases (types passed in but no
indexes and vice versa) would fail in their error response generation
because it did not expect an object to already be started in the json
generator. This change moves the object start to where it is needed for
the empty responses.

closes #21916

time:
2016-12-02T00:38:19Z
class:
comments:
[TEST] check _shards.total to make sure that cross cluster search hits the right number of shards

time:
2016-12-02T00:36:41Z
class:
comments:
Fix handling of spaces in Windows paths

This commit fixes the handling of spaces in Windows paths. The current
mechanism works fine in a path that contains a single space, but fails
on a path that contains multiple spaces. With this commit, that is no
longer the case.

Relates #21921
this destroys the path: "E:\Server\jre\"\bin\java.exe  -Xmx50M -version 
because of this, this command will result in an exitcode of 1: %JAVA% -Xmx50M -version > nul 2>&1
which causes the the detection of x86/x64 to fail.

@svenso I'm not sure what you mean as I'm not able to reproduce what you're describing here. I created a JRE installation in `C:\server\jre` and set `JAVA_HOME` to `C:\server\jre` and Elasticsearch starts fine with the 64-bit JVM, and the Elasticsearch service installs and starts correctly. If you think you found an issue, would you please open a bug report with complete steps to reproduce?
@jasontedor Sorry I'm not really used to github. I just tried it again. It's a problem, if JAVA_HOME ends with a "\\". Then it doesn't work anymore (and it did before, that's why I tried to track it down).
set JAVA_HOME=D:\ELK\jre works
set JAVA_HOME=D:\ELK\jre\ not working anymore
@svenso It's really okay, no need to be sorry. Thanks for the extra pointer, I'll see if I can reproduce and if anything needs to be done I will address it.
@svenso Thanks for reporting. I have confirmed the issue and opened #22132 to fix.

time:
2016-12-02T00:34:11Z
class:
comments:
[TEST] test also aggregations and fix indendation

time:
2016-12-02T00:02:37Z
class:
comments:
[TEST] rename local index so that the name is the same as the remote one

This way we make sure that index names are disambiguated.

time:
2016-12-02T00:00:20Z
class:
comments:
[TEST] Remove flush calls that are not needed

time:
2016-12-01T23:49:04Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
comments:
adapt node connection to upstream changes

time:
2016-12-01T23:39:43Z
class:
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/TransportNoopBulkAction.java
core/src/main/java/org/apache/lucene/analysis/synonym/GraphTokenStreamFiniteStrings.java
core/src/main/java/org/apache/lucene/analysis/synonym/SynonymGraphFilter.java
core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
core/src/main/java/org/apache/lucene/search/GraphQuery.java
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/CompositeIndicesRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponse.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequest.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/index/IndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java
core/src/main/java/org/elasticsearch/action/search/MultiSearchRequest.java
core/src/main/java/org/elasticsearch/action/termvectors/MultiTermVectorsRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequestBuilder.java
core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MappingMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexStateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodes.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationExplanation.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/DiskThresholdSettings.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RoutingAllocation.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AwarenessAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ClusterRebalanceAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ConcurrentRebalanceAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/EnableAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/FilterAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/RebalanceOnlyWhenActiveAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/SameShardAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ShardsLimitAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/SnapshotInProgressAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ThrottlingAllocationDecider.java
core/src/main/java/org/elasticsearch/common/geo/GeoUtils.java
core/src/main/java/org/elasticsearch/common/io/stream/BytesStreamOutput.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/common/transport/TransportAddress.java
core/src/main/java/org/elasticsearch/discovery/zen/MembershipAction.java
core/src/main/java/org/elasticsearch/discovery/zen/NodeJoinController.java
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/gateway/GatewayMetaState.java
core/src/main/java/org/elasticsearch/gateway/LocalAllocateDangledIndices.java
core/src/main/java/org/elasticsearch/index/IndexModule.java
core/src/main/java/org/elasticsearch/index/IndexSettings.java
core/src/main/java/org/elasticsearch/index/analysis/AnalysisRegistry.java
core/src/main/java/org/elasticsearch/index/analysis/SynonymGraphFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/SynonymTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/codec/PerFieldMappingPostingFormatCodec.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractGeoPointDVIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/GeoPointArrayAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/GeoPointArrayIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/GeoPointArrayLegacyAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/GeoPointLegacyDVAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fieldvisitor/FieldsVisitor.java
core/src/main/java/org/elasticsearch/index/mapper/AllFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/BaseGeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/BinaryFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/BooleanFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/CompletionFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/CompletionFieldMapper2x.java
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java
core/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/FieldNamesFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/GeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/GeoShapeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IdFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IndexFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IpFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/KeywordFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LatLonPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyByteFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyDateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyDoubleFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyFloatFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyGeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyIntegerFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyIpFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyIpIndexFieldData.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyLongFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyNumberFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyShortFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyTokenCountFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/MappedFieldType.java
core/src/main/java/org/elasticsearch/index/mapper/NumberFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ParentFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ParsedDocument.java
core/src/main/java/org/elasticsearch/index/mapper/RangeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/RoutingFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/SourceToParse.java
core/src/main/java/org/elasticsearch/index/mapper/StringFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TTLFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TextFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TimestampFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TokenCountFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TypeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TypeParsers.java
core/src/main/java/org/elasticsearch/index/mapper/UidFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/VersionFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/internal/SeqNoFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceRangeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoPolygonQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeohashCellQuery.java
core/src/main/java/org/elasticsearch/index/query/IndicesQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryBuilders.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/RangeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/DecayFunctionBuilder.java
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
core/src/main/java/org/elasticsearch/index/search/MultiMatchQuery.java
core/src/main/java/org/elasticsearch/index/search/geo/GeoDistanceRangeQuery.java
core/src/main/java/org/elasticsearch/index/search/geo/GeoPolygonQuery.java
core/src/main/java/org/elasticsearch/index/search/geo/LegacyInMemoryGeoBoundingBoxQuery.java
core/src/main/java/org/elasticsearch/index/search/geo/LegacyIndexedGeoBoundingBoxQuery.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/TranslogRecoveryPerformer.java
core/src/main/java/org/elasticsearch/index/store/FsDirectoryService.java
core/src/main/java/org/elasticsearch/index/termvectors/TermVectorsService.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/indices/IndicesModule.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java
core/src/main/java/org/elasticsearch/indices/analysis/PreBuiltTokenFilters.java
core/src/main/java/org/elasticsearch/indices/ttl/IndicesTTLService.java
core/src/main/java/org/elasticsearch/ingest/IngestDocument.java
core/src/main/java/org/elasticsearch/ingest/PipelineExecutionService.java
core/src/main/java/org/elasticsearch/monitor/os/OsStats.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/rest/action/document/RestIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestUpdateAction.java
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/CustomQueryScorer.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightPhase.java
core/src/main/java/org/elasticsearch/search/internal/AliasFilter.java
core/src/main/java/org/elasticsearch/search/suggest/Suggest.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggester.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestionContext.java
core/src/main/java/org/elasticsearch/search/suggest/completion/context/GeoContextMapping.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/AnalyzingCompletionLookupProvider.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/Completion090PostingsFormat.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/CompletionSuggestion.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/CompletionTokenStream.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/PayloadProcessor.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/context/CategoryContextMapping.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/context/ContextBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/context/ContextMapping.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/context/GeolocationContextMapping.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/context/package-info.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/package-info.java
core/src/main/java/org/elasticsearch/snapshots/RestoreService.java
core/src/main/java/org/elasticsearch/transport/ConnectionProfile.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/main/java/org/elasticsearch/transport/Transport.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/main/java/org/elasticsearch/transport/TransportStatus.java
core/src/test/java/org/apache/lucene/analysis/synonym/SynonymGraphFilterTests.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainIT.java
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponseTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/template/put/MetaDataIndexTemplateServiceTests.java
core/src/test/java/org/elasticsearch/action/index/IndexRequestTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/bwcompat/RestoreBackwardsCompatIT.java
core/src/test/java/org/elasticsearch/client/transport/FailAndRetryMockTransport.java
core/src/test/java/org/elasticsearch/cluster/NodeConnectionsServiceTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeServiceTests.java
core/src/test/java/org/elasticsearch/cluster/node/DiscoveryNodeTests.java
core/src/test/java/org/elasticsearch/cluster/node/DiscoveryNodesTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/FilterAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDeciderUnitTests.java
core/src/test/java/org/elasticsearch/codecs/CodecTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/explain/ExplainActionIT.java
core/src/test/java/org/elasticsearch/gateway/GatewayIndexStateIT.java
core/src/test/java/org/elasticsearch/gateway/GatewayMetaStateTests.java
core/src/test/java/org/elasticsearch/get/GetActionIT.java
core/src/test/java/org/elasticsearch/index/IndexSettingsTests.java
core/src/test/java/org/elasticsearch/index/IndexingSlowLogTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/engine/ShadowEngineTests.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractFieldDataTestCase.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractGeoFieldDataTestCase.java
core/src/test/java/org/elasticsearch/index/fielddata/IndexFieldDataServiceTests.java
core/src/test/java/org/elasticsearch/index/fielddata/ParentChildFieldDataTests.java
core/src/test/java/org/elasticsearch/index/mapper/AbstractNumericFieldMapperTestCase.java
core/src/test/java/org/elasticsearch/index/mapper/BinaryFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/BooleanFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/CompletionFieldMapper2xTests.java
core/src/test/java/org/elasticsearch/index/mapper/CompoundTypesTests.java
core/src/test/java/org/elasticsearch/index/mapper/CustomBoostMappingTests.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentParserTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicTemplateTests.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalMapper.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalMetadataMapper.java
core/src/test/java/org/elasticsearch/index/mapper/FakeStringFieldMapper.java
core/src/test/java/org/elasticsearch/index/mapper/FieldLevelBoostTests.java
core/src/test/java/org/elasticsearch/index/mapper/FieldNamesFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/GeoEncodingTests.java
core/src/test/java/org/elasticsearch/index/mapper/GeoPointFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/GeoPointFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/GeoShapeFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/IndexFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/IpFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/KeywordFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyByteFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyDateFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyDateFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyDoubleFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyFloatFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyGeohashMappingGeoPointTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyIntegerFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyIpFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyLongFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyNumberFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyShortFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyStringMappingTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyTokenCountFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
core/src/test/java/org/elasticsearch/index/mapper/MultiFieldCopyToMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/NumberFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ObjectMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ParentFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/RangeFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/RangeFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/SourceFieldMapperTests.java
comments:
Merge branch 'master' into feature/multi_cluster_search

time:
2016-12-01T23:34:33Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
comments:
Don't light connect to discovery nodes received from search shards

Those discovery nodes are already enough to go ahead with the remote search, no need to light connect and update the discovery node, it's already updated.

time:
2016-12-01T23:27:42Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
comments:
add TODO on validating cluster name of remote clusters

time:
2016-12-01T23:23:32Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
comments:
remove outdated TODOs

We will eagerly connect to all configured nodes, the liveness api call is not needed as we already do a light connect and get back the updated discovery node.

time:
2016-12-01T23:20:48Z
class:
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
comments:
Don't carry remoteUUIDs around, simplify remote alias filter handling

Also added explanation of when and why alias filters don't work at the moment

time:
2016-12-01T22:26:29Z
class:
comments:
Improve the out-of-the-box experience

Elasticsearch can be run in a few different ways:
 - from the command line on Linux and Windows
 - as a service on Linux and Windows

on both 32-bit client and 64-bit server VMs. We strive for a great
out-of-the-box experience any of these combinations but today it is
lacking on 32-bit client JVMs and on the Windows service. There are two
deficiencies that arise:
 - on any 32-bit client JVM we fail to start out of the box because we
   force the server JVM in jvm.options
 - when installing the Windows service, the thread stack size must be
   specified in jvm.options

This commit attempts to address these deficiencies.

We should continue to force the server JVM because there are systems
where the server JVM is not active by default (e.g., the 32-bit JDK on
Windows). This does mean that if a user tries to run with a client JVM
they will see a failure message at startup but this is the best that we
can do if we want to continue to force the server JVM. Thus, this commit
at least documents this situation.

To improve the situation with installing the Windows service, this
commit adds a default setting for the thread stack size. This default is
chosen based on the default thread stack size across all 64-bit server
JVMs. This means that if a user tries to run with a 32-bit JVM they
could otherwise see significantly higher memory usage (this situation is
complicated, it's really only on Windows where the extra memory usage is
egregious, but cutting into the 32-bit address space on any system is
bad). So this commit makes it so that the out-of-the-box experience is
improved for the Windows service on 64-bit server JVMs and we document
the need to adjust this setting on 32-bit JVMs.

Again, we are focusing on the out-of-the-box experience here and this
means optimizing for the best experience on any 64-bit server JVM as
this covers the vast majority of the user base. The users that are on
32-bit JVMs will suffer a little bit but at least now any user on any
64-bit server JVM can start Elasticsearch out of the box.

Finally, we fix some references to the jvm.options documentation.

Relates #21920

time:
2016-12-01T22:23:51Z
class:
comments:
Add option to skip kernel parameters on install

During package install on systemd-based systems, we try to set
vm.max_map_count. On some systems (e.g., containers), users do not have
the ability to tune these parameters from within the container. This
commit provides an option for these users to skip setting such kernel
parameters.

Relates #21899

time:
2016-12-01T14:40:35Z
class:
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexStateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodes.java
core/src/main/java/org/elasticsearch/discovery/zen/MembershipAction.java
core/src/main/java/org/elasticsearch/discovery/zen/NodeJoinController.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/gateway/GatewayMetaState.java
core/src/main/java/org/elasticsearch/gateway/LocalAllocateDangledIndices.java
core/src/main/java/org/elasticsearch/snapshots/RestoreService.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/bwcompat/RestoreBackwardsCompatIT.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeServiceTests.java
core/src/test/java/org/elasticsearch/cluster/node/DiscoveryNodesTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/gateway/GatewayIndexStateIT.java
core/src/test/java/org/elasticsearch/gateway/GatewayMetaStateTests.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
test/framework/src/main/java/org/elasticsearch/test/ESBackcompatTestCase.java
comments:
Add validation for supported index version on node join, restore, upgrade & open index (#21830)

Today we can easily join a cluster that holds an index we don't support since
we currently allow rolling upgrades from 5.x to 6.x. Along the same lines we don't check if we can support an index based on the nodes in the cluster when we open, restore or metadata-upgrade and index. This commit adds
additional safety that fails cluster state validation, open, restore and /or upgrade if there is an open index with an incompatible index version created in the cluster.

Realtes to #21670

time:
2016-12-01T14:39:49Z
class:
core/src/main/java/org/elasticsearch/transport/ConnectionProfile.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/test/java/org/elasticsearch/transport/ConnectionProfileTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
comments:
Add a connect timeout to the ConnectionProfile to allow per node connect timeouts (#21847)

Timeouts are global today across all connections this commit allows to specify
a connection timeout per node such that depending on the context connections can
be established with different timeouts.

Relates to #19719

time:
2016-12-01T13:21:57Z
class:
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/TemplateQueryBuilderTests.java
plugins/mapper-murmur3/src/test/java/org/elasticsearch/index/mapper/murmur3/Murmur3FieldMapperTests.java
comments:
fix TemplateQueryBuilderTests & Murmur3FieldMapperTests

time:
2016-12-01T12:40:27Z
class:
core/src/test/java/org/elasticsearch/index/fielddata/ParentChildFieldDataTests.java
core/src/test/java/org/elasticsearch/index/mapper/AbstractNumericFieldMapperTestCase.java
core/src/test/java/org/elasticsearch/index/mapper/BooleanFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/IpFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/KeywordFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/TextFieldMapperTests.java
core/src/test/java/org/elasticsearch/search/SearchCancellationTests.java
core/src/test/java/org/elasticsearch/search/profile/query/QueryProfilerTests.java
comments:
rename more before() methods that now conflict with ESTestCase

time:
2016-12-01T11:57:44Z
class:
test/framework/src/test/java/org/elasticsearch/test/test/InternalTestClusterTests.java
comments:
always auto manage min master node in testTwoNodeCluster

time:
2016-12-01T11:56:37Z
class:
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java
comments:
Add before and after logging for unit tests

Currently we have these logs for integration tests only.

This adds the following log at the start:
```
logger.info("[{}]: before test", getTestName());
```

and this is logged at the end, but before any clean up done in sub classes

```
 logger.info("[{}]: after test", getTestName());
```

time:
2016-12-01T07:00:48Z
class:
core/src/main/java/org/elasticsearch/transport/ConnectionProfile.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/test/java/org/elasticsearch/transport/ConnectionProfileTests.java
core/src/test/java/org/elasticsearch/transport/TCPTransportTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
comments:
Reduce number of connections per node depending on the nodes role (#21849)

We currently treat every node equally when we establish connections to a node.
Yet, if we are not master eligible or can't hold any data there is no point in creating
a dedicated connection for sending the cluster state or running remote recoveries respectively.
The usage of STATE and RECOVERY connections on non-master and/or non-data nodes will result in an IllegalStateException.

time:
2016-11-30T22:11:38Z
class:
core/src/main/java/org/elasticsearch/index/mapper/AllFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/MappedFieldType.java
core/src/main/java/org/elasticsearch/index/mapper/TypeFieldMapper.java
core/src/test/java/org/elasticsearch/index/query/SpanTermQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/WildcardQueryBuilderTests.java
comments:
Handle specialized term queries in MappedFieldType.extractTerm(TermQuery) (#21889)

For some fields we have a specialized implementation of a TermQuery that is specific for the field.
When these kind of fields are used in a wildcard query or a span term query it fails with an exception because they don't recognize the specialized form.
The impacted fields are [_all] and [_type] and the impacted queries are [span_term] and [wilcard].
This change handles these forms and correctly extracts the term inside them for further use.

Fixes #21882

time:
2016-11-30T20:29:33Z
class:
core/src/main/java/org/elasticsearch/transport/TransportService.java
comments:
Remove traces during connect with handshake

This commit removes two trace logging statements during connection with
handshake as they are just clutter.

time:
2016-11-30T20:28:56Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
comments:
Throw exception on ping from another cluster

When we receive a ping from another cluster, we should throw an
exception so as to not leak the channel.

time:
2016-11-30T20:09:42Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
comments:
Do not reply to pings from another cluster

Today when sending responses to discovery pings, we unconditionally
reply. Instead, this commit modifies the response handler to not reply
when the cluster names do not match.

This addresses a race condition identified after reducing the timeout in
UnicastZenPingTests#testSimplePings. In particular, we send pings in the
following way:
 - if not connected to the node, connect to the node and after
   successful handshake, send a ping
 - if connected to the node, send a ping

When the ping timeout is set low, a subsequent batch of pings can race
against a connect/disconnect cycle from a prior batch of pings. In
particular, consider the following scenario:
 - node A from cluster X
 - node B from cluster Y
 - pings are initiated from node A with node B in the hosts list
 - node A will try to connect and handshake with B
 - the connection will succeed, and the handshake will eventually fail due to mismatched cluster names
 - on a short timeout, a second batch of pings will fire, and on this
   batch node A will see that it is still connected to node B; thus, it
   will immediately fire a ping to node B and node B will dutifully
   respond

Relates #21894

time:
2016-11-30T18:37:01Z
class:
core/src/main/java/org/elasticsearch/index/IndexSettings.java
core/src/main/java/org/elasticsearch/index/query/IndicesQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryBuilders.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/test/java/org/elasticsearch/index/IndexSettingsTests.java
core/src/test/java/org/elasticsearch/index/query/IndicesQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryDSLDocumentationTests.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/MatchedQueriesIT.java
core/src/test/java/org/elasticsearch/search/query/SearchQueryIT.java
test/framework/src/main/java/org/elasticsearch/test/IndexSettingsModule.java
comments:
Remove indices query (#21837)

The indices query is deprecated since 5.0.0 (#17710). It can now be removed in master (future 6.0 version).

time:
2016-11-30T17:11:47Z
class:
comments:
Remove misplaced parenthesis from configuring docs

This commit removes a misplaced parenthesis from the systemd section of
the configuring docs.

time:
2016-11-30T16:16:13Z
class:
core/src/test/java/org/elasticsearch/search/functionscore/DecayFunctionScoreIT.java
comments:
Remove testing of 2.x indices in DecayFunctionScoreIT.

Such old indices will not be supported in 6.0.

time:
2016-11-30T16:14:17Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponse.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/main/java/org/elasticsearch/monitor/os/OsStats.java
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/search/internal/AliasFilter.java
core/src/test/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponseTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByScrollRequest.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/BulkByScrollTask.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RoundTripTests.java
comments:
Add version 5.1.1

This commit removes the version constant for 5.1.0 (due to an
inadvertent release) and adds the version constant for 5.1.1.

Relates #21890

time:
2016-11-30T16:07:53Z
class:
core/src/test/java/org/elasticsearch/index/query/TermsQueryBuilderTests.java
comments:
Fix TermsQueryBuilderTests expectations.

time:
2016-11-30T15:48:46Z
class:
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
comments:
Prevent testing on double values whose toString may use the scientific notation.

This might break query parsers because the standard analyzer splits on
punctuation.

time:
2016-11-30T15:36:55Z
class:
comments:
Remove docs for the removed `geo_distance_range` query.

time:
2016-11-30T14:33:26Z
class:
core/src/main/java/org/elasticsearch/index/IndexModule.java
core/src/main/java/org/elasticsearch/index/store/FsDirectoryService.java
core/src/test/java/org/elasticsearch/index/store/IndexStoreTests.java
comments:
Remove the `default` store type. (#21616)

It used to be a hybrid store between `niofs` and `mmapfs`, which we removed when
we switched to `fs` by default (which is `mmapfs` on 64-bits systems).

time:
2016-11-30T14:29:09Z
class:
core/src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java
core/src/test/java/org/elasticsearch/index/query/TermsQueryBuilderTests.java
comments:
The `terms` query should always map to a Lucene `TermsQuery`. (#21786)

Currently, the `terms` query is just syctactic sugar for a `bool` query when
used in a query context. This change proposes to always generate the same query
in query and filter contexts, which is less confusing.

time:
2016-11-30T14:03:58Z
class:
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/TransportNoopBulkAction.java
core/src/main/java/org/elasticsearch/action/CompositeIndicesRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/get/MultiGetRequest.java
core/src/main/java/org/elasticsearch/action/search/MultiSearchRequest.java
core/src/main/java/org/elasticsearch/action/termvectors/MultiTermVectorsRequest.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequest.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/SearchTemplateRequest.java
modules/percolator/src/main/java/org/elasticsearch/percolator/MultiPercolateRequest.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java
comments:
Remove subrequests method from CompositeIndicesRequest (#21873)

time:
2016-11-30T13:51:06Z
class:
comments:
Update Java documentation for 5.0

Remove old links
Fix template search layout

time:
2016-11-30T13:15:27Z
class:
comments:
Merge branch 'doc/java-api'

time:
2016-11-30T13:13:52Z
class:
comments:
Update Java documentation for 5.0

Fix after review

time:
2016-11-30T12:45:54Z
class:
core/src/main/java/org/apache/lucene/analysis/synonym/SynonymGraphFilter.java
core/src/main/java/org/apache/lucene/util/XQueryBuilder.java
core/src/main/java/org/apache/lucene/util/XRollingBuffer.java
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
comments:
Remove forked XRollingBuffer and XQueryBuilder. (#21866)

Remove the forked versions now that we are on lucene-6.4.0-snapshot.

time:
2016-11-30T12:35:56Z
class:
core/src/main/java/org/elasticsearch/common/io/stream/BytesStreamOutput.java
core/src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java
core/src/test/java/org/elasticsearch/index/query/TermsQueryBuilderTests.java
comments:
Reduce memory pressure when sending large terms queries. (#21776)

When users send large `terms` query to Elasticsearch, every value is stored in
an object. This change does not reduce the amount of created objects, but makes
sure these objects die young by optimizing the list storage in case all values
are either non-null instances of Long objects or BytesRef objects, which seems
to help the JVM significantly.

time:
2016-11-30T12:34:46Z
class:
core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/index/IndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
core/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequestBuilder.java
core/src/main/java/org/elasticsearch/cluster/metadata/MappingMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/main/java/org/elasticsearch/common/geo/GeoUtils.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/index/codec/PerFieldMappingPostingFormatCodec.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractGeoPointDVIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/GeoPointArrayAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/GeoPointArrayIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/GeoPointArrayLegacyAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/GeoPointLegacyDVAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fieldvisitor/FieldsVisitor.java
core/src/main/java/org/elasticsearch/index/mapper/BaseGeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/CompletionFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/CompletionFieldMapper2x.java
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java
core/src/main/java/org/elasticsearch/index/mapper/GeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IpFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/KeywordFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LatLonPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyByteFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyDateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyDoubleFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyFloatFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyGeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyIntegerFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyIpFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyIpIndexFieldData.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyLongFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyNumberFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyShortFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyTokenCountFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/NumberFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ParsedDocument.java
core/src/main/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/SourceToParse.java
core/src/main/java/org/elasticsearch/index/mapper/StringFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TTLFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TextFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TimestampFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TokenCountFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TypeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TypeParsers.java
core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceRangeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoPolygonQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeohashCellQuery.java
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryBuilders.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/RangeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/DecayFunctionBuilder.java
core/src/main/java/org/elasticsearch/index/search/geo/GeoDistanceRangeQuery.java
core/src/main/java/org/elasticsearch/index/search/geo/GeoPolygonQuery.java
core/src/main/java/org/elasticsearch/index/search/geo/LegacyInMemoryGeoBoundingBoxQuery.java
core/src/main/java/org/elasticsearch/index/search/geo/LegacyIndexedGeoBoundingBoxQuery.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/TranslogRecoveryPerformer.java
core/src/main/java/org/elasticsearch/index/termvectors/TermVectorsService.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/indices/IndicesModule.java
core/src/main/java/org/elasticsearch/indices/ttl/IndicesTTLService.java
core/src/main/java/org/elasticsearch/ingest/IngestDocument.java
core/src/main/java/org/elasticsearch/ingest/PipelineExecutionService.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/rest/action/document/RestIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestUpdateAction.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightPhase.java
core/src/main/java/org/elasticsearch/search/suggest/Suggest.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggester.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestionContext.java
core/src/main/java/org/elasticsearch/search/suggest/completion/context/GeoContextMapping.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/AnalyzingCompletionLookupProvider.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/Completion090PostingsFormat.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/CompletionSuggestion.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/CompletionTokenStream.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/PayloadProcessor.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/context/CategoryContextMapping.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/context/ContextBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/context/ContextMapping.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/context/GeolocationContextMapping.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/context/package-info.java
core/src/main/java/org/elasticsearch/search/suggest/completion2x/package-info.java
core/src/test/java/org/elasticsearch/action/admin/indices/template/put/MetaDataIndexTemplateServiceTests.java
core/src/test/java/org/elasticsearch/action/index/IndexRequestTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/bwcompat/RestoreBackwardsCompatIT.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeServiceTests.java
core/src/test/java/org/elasticsearch/codecs/CodecTests.java
core/src/test/java/org/elasticsearch/explain/ExplainActionIT.java
core/src/test/java/org/elasticsearch/gateway/GatewayIndexStateIT.java
core/src/test/java/org/elasticsearch/get/GetActionIT.java
core/src/test/java/org/elasticsearch/index/IndexingSlowLogTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/engine/ShadowEngineTests.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractFieldDataTestCase.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractGeoFieldDataTestCase.java
core/src/test/java/org/elasticsearch/index/fielddata/IndexFieldDataServiceTests.java
core/src/test/java/org/elasticsearch/index/mapper/BinaryFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/BooleanFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/CompletionFieldMapper2xTests.java
core/src/test/java/org/elasticsearch/index/mapper/CompoundTypesTests.java
core/src/test/java/org/elasticsearch/index/mapper/CustomBoostMappingTests.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicTemplateTests.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalMapper.java
core/src/test/java/org/elasticsearch/index/mapper/FakeStringFieldMapper.java
core/src/test/java/org/elasticsearch/index/mapper/FieldLevelBoostTests.java
core/src/test/java/org/elasticsearch/index/mapper/GeoEncodingTests.java
core/src/test/java/org/elasticsearch/index/mapper/GeoPointFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/GeoPointFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/GeoShapeFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/IndexFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/IpFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/KeywordFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyByteFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyDateFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyDateFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyDoubleFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyFloatFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyGeohashMappingGeoPointTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyIntegerFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyIpFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyLongFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyNumberFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyShortFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyStringMappingTests.java
core/src/test/java/org/elasticsearch/index/mapper/LegacyTokenCountFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
core/src/test/java/org/elasticsearch/index/mapper/MultiFieldCopyToMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/NumberFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ObjectMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ParentFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/SourceFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/StringFieldMapperPositionIncrementGapTests.java
core/src/test/java/org/elasticsearch/index/mapper/StringFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/StringMappingUpgradeTests.java
core/src/test/java/org/elasticsearch/index/mapper/TTLFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/TextFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/TimestampFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/TimestampFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/TokenCountFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/TypeFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/UpdateMappingTests.java
core/src/test/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoDistanceQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoDistanceRangeQueryTests.java
core/src/test/java/org/elasticsearch/index/query/GeoPolygonQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeohashCellQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/NestedQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryDSLDocumentationTests.java
core/src/test/java/org/elasticsearch/index/query/RangeQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
core/src/test/java/org/elasticsearch/indices/IndicesServiceTests.java
core/src/test/java/org/elasticsearch/indices/template/SimpleIndexTemplateIT.java
core/src/test/java/org/elasticsearch/ingest/IngestClientIT.java
core/src/test/java/org/elasticsearch/ingest/IngestDocumentTests.java
core/src/test/java/org/elasticsearch/ingest/PipelineExecutionServiceTests.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
core/src/test/java/org/elasticsearch/search/basic/TransportSearchFailuresIT.java
core/src/test/java/org/elasticsearch/search/basic/TransportTwoNodesSearchIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java
core/src/test/java/org/elasticsearch/search/fields/SearchFieldsIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoBoundingBoxIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoDistanceIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoFilterIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoPolygonIT.java
core/src/test/java/org/elasticsearch/search/query/MultiMatchQueryIT.java
core/src/test/java/org/elasticsearch/search/query/SimpleQueryStringIT.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceIT.java
core/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearch2xIT.java
core/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchIT.java
core/src/test/java/org/elasticsearch/search/suggest/ContextSuggestSearch2xIT.java
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/timestamp/SimpleTimestampIT.java
core/src/test/java/org/elasticsearch/ttl/SimpleTTLIT.java
core/src/test/java/org/elasticsearch/update/TimestampTTLBWIT.java
core/src/test/java/org/elasticsearch/update/UpdateIT.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/DateIndexNameProcessorTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ForEachProcessorTests.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/ExpressionScriptEngineService.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolateQueryBuilderTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorIT.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractAsyncBulkIndexByScrollAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ClientScrollableHitSource.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ScrollableHitSource.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportUpdateByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteResponseParsers.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AbstractAsyncBulkIndexbyScrollActionMetadataTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFailureTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexRequestTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexScriptTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryWithScriptTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpRequestSizeLimitIT.java
plugins/mapper-murmur3/src/test/java/org/elasticsearch/index/mapper/murmur3/Murmur3FieldMapperUpgradeTests.java
plugins/mapper-size/src/main/java/org/elasticsearch/index/mapper/size/SizeFieldMapper.java
plugins/mapper-size/src/test/java/org/elasticsearch/index/mapper/size/SizeFieldMapperUpgradeTests.java
plugins/mapper-size/src/test/java/org/elasticsearch/index/mapper/size/SizeMappingTests.java
qa/smoke-test-ingest-with-all-dependencies/src/test/java/org/elasticsearch/ingest/IngestDocumentMustacheIT.java
qa/smoke-test-ingest-with-all-dependencies/src/test/java/org/elasticsearch/ingest/ValueSourceMustacheIT.java
test/framework/src/main/java/org/elasticsearch/ingest/RandomDocumentPicks.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
comments:
Remove 2.x backward compatibility of mappings. (#21670)

For the record, I also had to remove the geo-hash cell and geo-distance range
queries to make the code compile. These queries already throw an exception in
all cases with 5.x indices, so that does not hurt any more.

I also had to rename all 2.x bwc indices from `index-${version}` to
`unsupported-${version}` to make `OldIndexBackwardCompatibilityIT`
happy.

time:
2016-11-30T11:56:00Z
class:
comments:
typo fix (and -> any) (#21860)

time:
2016-11-30T04:27:25Z
class:
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
comments:
Speed up UnicastZenPingTests

These tests using ping timeouts on the order of seconds, but this is
unnecessary since all the sockets are within the same JVM it really
should not take that long.

Relates #21874

time:
2016-11-29T23:34:55Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/Version.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
comments:
Add version 5.0.3

This commit adds version 5.0.3 and the BWC indices for version 5.0.2.

Relates #21867

time:
2016-11-29T21:18:08Z
class:
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java
core/src/main/java/org/elasticsearch/common/transport/TransportAddress.java
core/src/test/java/org/elasticsearch/cluster/node/DiscoveryNodeTests.java
comments:
DiscoveryNode and TransportAddress should preserve host information

In some cases, such as the creation of DiscoveryNode instances for unicast ping requests, the
host information was not being populated properly and instead the address string was being used.
Additionally, when serializing a DiscoveryNode and in turn a transport address, the host was not
being set on the InetAddress when deserializing the object, so even if the address was created
from a hostname, the address in the deserialized instance had no knowledge of the hostname that
was originally used.

time:
2016-11-29T19:52:43Z
class:
core/src/main/java/org/elasticsearch/action/CompositeIndicesRequest.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequest.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/SearchTemplateRequest.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequestTests.java
comments:
SearchTemplateRequest to implement CompositeIndicesRequest (#21865)

SearchTemplateRequest to implement CompositeIndicesRequest

Given that SearchTemplateRequest effectively delegates to search when a search is being executed, it should implement the CompositeIndicesRequest interface. The subrequests method should return a single search request. When a search is not going to be executed, because we are in simulate mode, there are no inner requests, and there are no corresponding indices to that request either.

Closes #21747

time:
2016-11-29T19:38:19Z
class:
core/src/main/java/org/elasticsearch/node/Node.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
test/framework/src/test/java/org/elasticsearch/test/test/InternalTestClusterTests.java
comments:
improve debug logging when node waits for initial cluster state

And enabled debug logging in InternalTestClusterTests so we can see it.

time:
2016-11-29T19:05:30Z
class:
comments:
[DOCS] document breaking changes added with #21852

time:
2016-11-29T18:07:01Z
class:
core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/test/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/TermsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
comments:
Remove deprecated query names: in, geo_bbox, mlt, fuzzy_match and match_fuzzy (#21852)

These query names were all deprecated in 5.0.0:
- in is removed in favour of terms
- geo_bbox is removed in favour of geo_bounding_box
- mlt is removed in favour of more_like_this
- fuzzy_match and match_fuzzy are removed in favour of match

time:
2016-11-29T17:40:31Z
class:
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/basic/TransportTwoNodesSearchIT.java
comments:
Upgrade to lucene-6.4.0-snapshot-ec38570 (#21853)

Set lucene version to 6.4.0-snapshot-ec38570 and update all the sha1s/license
Fix invalid combo after upgrade in query_string query. split_on_whitespace=false is disallowed if auto_generate_phrase_queries=true
Adapt the expectations of some tests to the new format of the Lucene explain output

time:
2016-11-29T16:10:14Z
class:
core/src/main/java/org/elasticsearch/index/mapper/AllFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/BaseGeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/BinaryFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/BooleanFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/CompletionFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/CompletionFieldMapper2x.java
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/FieldNamesFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/GeoShapeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IdFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IndexFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IpFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/KeywordFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyByteFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyDateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyDoubleFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyFloatFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyIntegerFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyIpFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyLongFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyNumberFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyShortFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LegacyTokenCountFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/NumberFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ParentFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/RangeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/RoutingFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/StringFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TTLFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TextFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TimestampFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TokenCountFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TypeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/UidFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/VersionFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/internal/SeqNoFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/RangeQueryBuilder.java
core/src/main/java/org/elasticsearch/indices/IndicesModule.java
core/src/test/java/org/elasticsearch/index/mapper/AbstractNumericFieldMapperTestCase.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalMapper.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalMetadataMapper.java
core/src/test/java/org/elasticsearch/index/mapper/FakeStringFieldMapper.java
core/src/test/java/org/elasticsearch/index/mapper/FieldNamesFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/NumberFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/RangeFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/RangeFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/query/RangeQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/TermsQueryBuilderTests.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolatorFieldMapper.java
plugins/mapper-murmur3/src/main/java/org/elasticsearch/index/mapper/murmur3/Murmur3FieldMapper.java
plugins/mapper-size/src/main/java/org/elasticsearch/index/mapper/size/SizeFieldMapper.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
comments:
Add RangeFieldMapper for numeric and date range types

Lucene 6.2 added index and query support for numeric ranges. This commit adds a new RangeFieldMapper for indexing numeric (int, long, float, double) and date ranges and creating appropriate range and term queries. The design is similar to NumericFieldMapper in that it uses a RangeType enumerator for implementing the logic specific to each type. The following range types are supported by this field mapper: int_range, float_range, long_range, double_range, date_range.

Lucene does not provide a DocValue field specific to RangeField types so the RangeFieldMapper implements a CustomRangeDocValuesField for handling doc value support.

When executing a Range query over a Range field, the RangeQueryBuilder has been enhanced to accept a new relation parameter for defining the type of query as one of: WITHIN, CONTAINS, INTERSECTS. This provides support for finding all ranges that are related to a specific range in a desired way. As with other spatial queries, DISJOINT can be achieved as a MUST_NOT of an INTERSECTS query.

time:
2016-11-29T13:00:26Z
class:
comments:
Fixing cut-in-middle paragraph (#21850)

time:
2016-11-29T08:35:07Z
class:
core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
core/src/main/java/org/elasticsearch/transport/ConnectionProfile.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/main/java/org/elasticsearch/transport/Transport.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/main/java/org/elasticsearch/transport/TransportStatus.java
core/src/test/java/org/elasticsearch/client/transport/FailAndRetryMockTransport.java
core/src/test/java/org/elasticsearch/cluster/NodeConnectionsServiceTests.java
core/src/test/java/org/elasticsearch/transport/ConnectionProfileTests.java
core/src/test/java/org/elasticsearch/transport/TCPTransportTests.java
core/src/test/java/org/elasticsearch/transport/TransportServiceHandshakeTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
test/framework/src/main/java/org/elasticsearch/test/transport/CapturingTransport.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
comments:
Remove connectToNodeLight and replace it with a connection profile (#21799)

The Transport#connectToNodeLight concepts is confusing and not very flexible.
neither really testable on a unittest level. This commit cleans up the code used
to connect to nodes and simplifies transport implementations to share more code.
This also allows to connect to nodes with custom profiles if needed, for instance
future improvements can be added to connect to/from nodes that are non-data nodes without
dedicated bulks and recovery connections.

time:
2016-11-29T08:22:54Z
class:
comments:
[DOCS] add source filtering example to reindex docs (#21835)

time:
2016-11-29T01:37:19Z
class:
core/src/test/java/org/elasticsearch/cluster/routing/allocation/FilterAllocationDeciderTests.java
comments:
[TEST] fixes FilterAllocationDecider test for decision explanation
when the initial recovery is LOCAL_SHARDS

time:
2016-11-29T01:23:16Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/DiskThresholdSettings.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AwarenessAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ClusterRebalanceAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ConcurrentRebalanceAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/EnableAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/FilterAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/RebalanceOnlyWhenActiveAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/SameShardAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ShardsLimitAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/SnapshotInProgressAllocationDecider.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ThrottlingAllocationDecider.java
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainIT.java
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/FilterAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDeciderUnitTests.java
comments:
Improves allocation decider decision explanation messages (#21771)

This commit improves the decision explanation messages,
particularly for NO decisions, in the various AllocationDecider
implementations by including the setting(s) in the explanation
message that led to the decision.

This commit also returns a THROTTLE decision instead of a NO
decision when the concurrent rebalances limit has been reached
in ConcurrentRebalanceAllocationDecider, because it more accurately
reflects a temporary throttling that will turn into a YES decision
once the number of concurrent rebalances lessens, as opposed to a
more permanent NO decision (e.g. due to filtering).

time:
2016-11-28T23:47:32Z
class:
comments:
Grant Netty permission to read system somaxconn

When Netty listens on a socket, it specifies the established connection
backlog for the socket. On Linux, Netty tries to read the system-wide
configuration for this from /proc/sys/net/core/somaxconn and falls back
to a default value when it can not read this value. This commit grants
Netty permission to read this file so that it can honor the system-wide
configuration for the connection backlog for sockets that it is
listening on. This also removes an obnoxious stack trace that appears
when Netty logging is set to debug logging.

Relates #21840

time:
2016-11-28T17:43:27Z
class:
modules/transport-netty4/src/test/java/org/elasticsearch/rest/Netty4HeadBodyIsEmptyIT.java
test/framework/src/main/java/org/elasticsearch/rest/HeadBodyIsEmptyIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestExecutionContext.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ESClientYamlSuiteTestCase.java
comments:
[TEST] Don't reinitialize YamlTestClient and RestClient before each single test (#21807)

In the past we ran yaml tests against an internal cluster, which would get restarted after each test failure, hence the client objects needed to eventually be refreshed before each test. That is why we had the initClient method to re-initialize the YamlTestClient in the execution context. We ended up though re-initializing the client unconditionally, which is not needed.

Also, ESRestTestCase recreates the RestClient against the external cluster before each test, which is not needed given that nothing changes in the external cluster.

This commit removes the initClient method from the yaml tests execution context. The YamlTestClient can be eagerly created before the first yaml test runs and then re-used in subsequent tests. Also api calls to check for nodes versions etc. are moved out of YamlTestClient to ESClientYamlSuiteTestCase. Also the RestClient is now initialized in ESRestTestCase before the first test runs, and kept around afterwards as a static member.

Basically each subclass of EsRestTestCase will have its own RestClient instance, but the client will be shared across the different tests within the same class. The yaml test suite is just a special suite, composed of 600+ tests that are loaded from files, which will share the same client instance.

This change should speed tests up as well, as we don't recreate the RestClient before each single test, and we don't call _cat/nodes either before each single test.

time:
2016-11-28T17:25:49Z
class:
core/src/main/java/org/apache/lucene/analysis/synonym/GraphTokenStreamFiniteStrings.java
core/src/main/java/org/apache/lucene/analysis/synonym/SynonymGraphFilter.java
core/src/main/java/org/apache/lucene/search/GraphQuery.java
core/src/main/java/org/apache/lucene/util/XQueryBuilder.java
core/src/main/java/org/apache/lucene/util/XRollingBuffer.java
core/src/main/java/org/elasticsearch/index/analysis/AnalysisRegistry.java
core/src/main/java/org/elasticsearch/index/analysis/SynonymGraphFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/SynonymTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
core/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java
core/src/main/java/org/elasticsearch/indices/analysis/PreBuiltTokenFilters.java
core/src/test/java/org/apache/lucene/analysis/synonym/SynonymGraphFilterTests.java
core/src/test/java/org/elasticsearch/index/search/MatchQueryIT.java
comments:
Synonym Graph Support (LUCENE-6664) (#21517)

Integrate the patch from LUCENE-6664 into elasticsearch and
add support for handling a graph token stream in match/multi-match
queries.

This fixes longstanding bugs with multi-token synonyms returning
incorrect results with proximity queries.

time:
2016-11-28T16:56:24Z
class:
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/CustomQueryScorer.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java
comments:
Fix FiltersFunctionScoreQuery highlighting (#21827)

This is a cleanup of the fix pushed in https://github.com/elastic/elasticsearch/pull/20400.
FiltersFunctionScoreQuery sub query should be extracted in CustomQueryScorer.extract (and not in CustomQueryScorer.extractUnknownQuery).
This does not fix any bug in this branch (it's just a cleanup) but the intent is first to clean up and then to backport in 2.x where there is a real bug.
The bug is in 2.x only because the backport of https://github.com/elastic/elasticsearch/pull/20400 in 2.x mistakenly renamed the FiltersFunctionScoreQuery to FunctionScoreQuery.
This leads to incorrect highlighting on FiltersFunctionScoreQuery in 2.x.

time:
2016-11-28T16:36:06Z
class:
core/src/main/java/org/elasticsearch/script/ScriptService.java
comments:
Log ScriptException's xcontent if file script compilation fails (#21767)

When a file script fails to compile, rather than logging the
exception that caused the failure this logs the xcontent of
that exception. This is both shorter and has the script stack
which is useful for figuring out why the compilation failed.

Still logs the entire stacktrace at debug level just in case
you need it.

Relates to #21733

time:
2016-11-28T16:33:40Z
class:
comments:
Update Java documentation for 5.0

Some of the methods have been removed or deprecated.

Also related to #21825.

time:
2016-11-28T16:04:56Z
class:
comments:
then -> than (#21829)

time:
2016-11-28T15:46:33Z
class:
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
comments:
Fixes shard level snapshot metadata loading when index-N file is missing (#21813)

In making changes for the 5.0 version of snapshots, a bug was
introduced where if an index-N file could not be found for an
individual shard, the backup was to iterate over all snap-*.dat
files in the shard folder to know which snapshots contain that
shard's data, but in 5.0, reading the snap-*.dat files as backup
was incorrectly passing in the blob name for the snap-*.dat file,
thereby failing to load all index files for a given snapshot
when the index-N file is missing.  This condition should be rare
as there is no reason an index-N file should be absent (unless
it was deleted or there was corruption reading the file), but
nevertheless, this situation can be encountered and this commit
fixes the bug by reading the correct snap-*.dat blob name in the
shard data folder.

time:
2016-11-28T15:06:59Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/main/java/org/elasticsearch/transport/Transport.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/client/transport/FailAndRetryMockTransport.java
core/src/test/java/org/elasticsearch/cluster/NodeConnectionsServiceTests.java
test/framework/src/main/java/org/elasticsearch/test/transport/CapturingTransport.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
comments:
Remove TcpTransport#addressSupported since TransportAddress is now final

TransportAddress used to be customizable per transport but this has been removed
a while ago. Therefore we can remove all usage of this method as well.

Relates to #20695

time:
2016-11-28T14:18:58Z
class:
qa/smoke-test-multinode/src/test/java/org/elasticsearch/smoketest/SmokeTestMultiNodeClientYamlTestSuiteIT.java
comments:
Increase suite timeout for multi-node smoke tests

Running this on a Windows CI with slow VMs makes the suite run into timeouts.

time:
2016-11-28T13:14:01Z
class:
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
core/src/main/java/org/elasticsearch/index/search/MultiMatchQuery.java
core/src/test/java/org/elasticsearch/index/search/MultiMatchQueryTests.java
comments:
Fix cross_fields type on multi_match query with synonyms (#21638)

* Fix cross_fields type on multi_match query with synonyms

This change fixes the cross_fields type of the multi_match query when synonyms are involved.
Since 2.x the Lucene query parser creates SynonymQuery for words that appear at the same position.
For simple term query the CrossFieldsQueryBuilder expands the term to all requested fields and creates a BlendedTermQuery.
This change adds the same mechanism for SynonymQuery which otherwise are not expanded to all requested fields.
As a side note I wonder if we should not replace the BlendedTermQuery with the SynonymQuery. They have the same purpose and behave similarly.

Fixes #21633

* Fallback to SynonymQuery for blended terms on a single field

time:
2016-11-28T13:09:26Z
class:
test/framework/src/main/java/org/elasticsearch/common/util/MockBigArrays.java
comments:
Minor clean-ups in MockBigArrays (#21822)

Removes an unused static variable and an unused instance variable.

time:
2016-11-28T10:24:25Z
class:
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
test/framework/src/main/java/org/elasticsearch/test/disruption/IntermittentLongGCDisruption.java
test/framework/src/main/java/org/elasticsearch/test/disruption/LongGCDisruption.java
test/framework/src/main/java/org/elasticsearch/test/disruption/LongGCDisruptionTest.java
comments:
Detect nodes being blocked by GC-disrupted node (#21797)

The disruption type LongGCDisruption simulates GCs on a node by suspending all the threads of that node. If the suspended threads are in a code section with shared JVM locks, however, it can prevent the other nodes from doing their thing. The class LongGCDisruption has a list of class names for which we know that this can occur. Whenever a test using the GC disruption type fails in mysterious ways, it becomes a long guessing game to find the offending class. This commit adds code to LongGCDisruption to automatically detect these situations, fail the test early and report the offending class and all relevant context.

time:
2016-11-28T10:05:17Z
class:
comments:
Added Smalltalk client (#21361)

> Pharo Smalltalk
> Pharo emerged as a fork of Squeak Smalltalk. It focuses on modern software engineering and development techniques.

project:
- http://pharo.org/ Pharo Smalltalk

time:
2016-11-28T10:02:59Z
class:
comments:
include not work in 5.x anymore (#21815)

include not work in 5.x anymore use includes instead

time:
2016-11-28T09:34:43Z
class:
comments:
Document that min/max operate on the double representation of the data.

Relates #9545

time:
2016-11-28T08:57:32Z
class:
core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentParserTests.java
comments:
Fail to index fields with dots in field names when one of the intermediate objects is nested. (#21787)

Closes #21726

time:
2016-11-27T18:18:50Z
class:
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Utils.java
comments:
Remove unused imports from Netty4Utils

This commit removes two unused imports from Netty4Utils that were
leftover from a previous change.

time:
2016-11-27T18:14:24Z
class:
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Utils.java
comments:
Simplify handling of fatal network layer errors

This commit simplifies the handling of fatal errors on the network
layer. The simplification here is to remove the use of a
StringWriter/PrintWriter pair to format the stack trace, removing the
need for the method to declare that it throws a checked IOException.

time:
2016-11-26T12:18:26Z
class:
core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java
comments:
Log failure to connect to node at info instead of debug (#21809)

Closes #6468

time:
2016-11-26T11:43:56Z
class:
comments:
Document that the PUT mapping API with the _default_ type overwrites instead of merging

Closes #8215

time:
2016-11-26T11:35:33Z
class:
comments:
Update percolate-query.asciidoc

Add missing callout to percolate query

time:
2016-11-25T18:52:52Z
class:
comments:
Disable disk watermarks on REST tests (#21803)

REST tests use the default OOTB low/high disk watermarks of 85%/90%, which can make some tests fail if run on a machine with a fuller disk. This commit changes the watermarks in the same way as in IntegTestCase so that they're essentially ignored.

time:
2016-11-25T17:18:23Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationExplanation.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RoutingAllocation.java
comments:
Removing unused AllocationExplanation class (#21805)

This commit removes the unused AllocationExplanation class.  The
RoutingAllocation class only created an empty instance of it and
never used it anywhere else.  The allocation explanations will be
encompassed in the various decision classes exposed via the cluster
allocation explain API.  Therefore, there is no reason to keep the
AllocationExplanation class.

time:
2016-11-25T16:47:40Z
class:
comments:
[DOCS] fixes word usage in allocation awareness docs

time:
2016-11-25T16:21:59Z
class:
modules/lang-painless/src/test/java/org/elasticsearch/painless/EqualsTests.java
comments:
[Test] Mute EqualsTests..testBranch(Not)EqualsDefAndPrimitive

 It fails regurlarly and it is tracked by https://github.com/elastic/elasticsearch/issues/21801

time:
2016-11-25T13:30:49Z
class:
comments:
Correction of the names of numirals (#21531)

What was called Arabic numerals is actually Hindu - Eastern Arabic notation. And the Latin numerals you refer to is the Arabic numbers.

time:
2016-11-25T09:58:06Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponse.java
comments:
Search shards to print out aliases array together with alias filter (#21784)

With #21738 we added an indices section to the search shards api, that will return the concrete indices hit by the request, and eventually the corresponding alias filter.

The java API returns the AliasFilter object, which holds the filter itself and an array of aliases that pointed to the index in the original request. The REST layer doesn't print out the aliases array though. This commit adds the aliases array as well and tests for this.

time:
2016-11-24T23:17:50Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/search/internal/AliasFilter.java
comments:
Add WIP support for alias filters and additional tests
this method is also called when searching against the shards, I think in that case we don't need to connect and disconnect to get back the updated node? We already got it back from search_shards.
I was contemplating to use the liveness api here and get back the cluster name too, which could be validated. This one is more lightweight though I guess? Thoughts?
Also I wonder if we should connect to the remote seeds when they get registered, and immediately resolve the nodes, or do it only when we search_shards on them. But this should be done once, not all the time?
I think this will not work against 5.0, we need to retrieve the list of filtered aliases name in some other way, e.g. from cluster state api. otherwise we just ignore alias filters.
coudl we handle this in the caller? the alias filter should contain a null query builder (but aliases set) only when we don't get back indicesAndFilters from search_shards.
nice, I planned to add the same test, to make sure that the index name gets enhanced with the remote cluster name.
I pushed a fix for this: https://github.com/elastic/elasticsearch/commit/cb97b91a6037980cd87ec5b6d90c80fea2079ff2
I addressed this: https://github.com/elastic/elasticsearch/commit/8cb2cec0c2af20de914e85e9218e400632866855
I added a TODO about this

time:
2016-11-24T20:56:26Z
class:
core/src/main/java/org/elasticsearch/action/support/AutoCreateIndex.java
core/src/main/java/org/elasticsearch/common/settings/AbstractScopedSettings.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/support/IncludeExclude.java
core/src/test/java/org/elasticsearch/action/support/AutoCreateIndexTests.java
core/src/test/java/org/elasticsearch/common/settings/ScopedSettingsTests.java
core/src/test/java/org/elasticsearch/common/settings/SettingTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DoubleTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/LongTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/StringTermsIT.java
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/storage/AzureStorageSettings.java
test/framework/src/main/java/org/elasticsearch/common/bytes/AbstractBytesReferenceTestCase.java
comments:
Merge branch 'master' into feature/multi_cluster_search

time:
2016-11-24T20:53:04Z
class:
core/src/main/java/org/elasticsearch/common/settings/AbstractScopedSettings.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/test/java/org/elasticsearch/common/settings/ScopedSettingsTests.java
core/src/test/java/org/elasticsearch/common/settings/SettingTests.java
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/storage/AzureStorageSettings.java
comments:
Fix settings diff generation for affix, list and group settings (#21788)

Group, List and Affix settings generate a bogus diff that turns the actual
diff into a string containing a json structure for instance:

```
"action" : {
  "search" : {
    "remote" : {
      "" : "{\"my_remote_cluster\":\"[::1]:60378\"}"
    }
  }
}
```

which make reading the setting impossible. This happens for instance
if a group or affix setting is rendered via `_cluster/settings?include_defaults=true`
This change fixes the issue as well as several minor issues with affix settings that
where not accepted as valid setting today.

time:
2016-11-24T20:43:58Z
class:
core/src/main/java/org/elasticsearch/action/support/AutoCreateIndex.java
core/src/test/java/org/elasticsearch/action/support/AutoCreateIndexTests.java
comments:
Handle spaces in `action.auto_create_index` gracefully (#21790)

Today if a comma-separated list is passed to action.auto_create_index
leading and trailing whitespaces are not trimmed but since the values are
index expressions whitespaces should be removed for convenience.

Closes #21449

time:
2016-11-24T16:11:43Z
class:
comments:
typo fix (it self -> itself) (#21781)

* typo fix.

* apply "stored field value"

* replaced "whereas" with "on the contrary"

time:
2016-11-24T15:47:14Z
class:
comments:
clarify ambiguous sentence. (#21734)

time:
2016-11-24T15:41:05Z
class:
comments:
Add docs for the batch mode of plugin installation (#21700)

* Add docs for the batch mode of plugin installation

Closes https://github.com/elastic/elasticsearch/issues/21490

* Updated to clarify that all permissions are granted automatically in batch mode

time:
2016-11-24T15:10:46Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/support/IncludeExclude.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DoubleTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/LongTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/StringTermsIT.java
comments:
Aggregations - support for partitioning set of terms used in aggregations so that multiple requests can be done without trying to compute everything in one request.

Closes #21487

time:
2016-11-24T15:06:10Z
class:
comments:
clarification on geo distance sorting (#21779)

* clarification on geo distance sorting

* applying the suggested change

time:
2016-11-24T14:44:37Z
class:
comments:
Use GString and closures to delay evaluating remote cluster URL until runtime

time:
2016-11-24T14:35:52Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
comments:
Enable cross cluster search only when at least one remote cluster is configured

If no remote clusters are registered, we shouldn't even try resolving remote clusters as part of indices names. Just go ahead and treat the index as a local one, which may or may not exist. In fact, the character that we use a separator may be part of an alias name, or part of a date math expression. We will go ahead with the remote search only if the prefix before the first occurrence of the separator is an actual registered cluster. Otherwise we will treat the index as a local one.

Previously we would go remotely anytime we'd find the separator in an index name, which caused false positives with aliases and date math expressions. It is also safer to not go remotely unless there is some remote cluster registered. We'd also throw exception whenever an unknown remote cluster was referred to, but this could again conflict with date math expressions or aliases: say we have some remote cluster configured, and we are using the separator in a date math expression, we only want to go remotely when the prefix matches a configured cluster, stay local otherwise, as the index name may still be valid locally.

time:
2016-11-24T14:31:36Z
class:
test/framework/src/main/java/org/elasticsearch/common/bytes/AbstractBytesReferenceTestCase.java
comments:
[TEST] Fix AbstractBytesReferenceTestCase#testSlice to not assert on offset

time:
2016-11-24T13:17:54Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/test/java/org/elasticsearch/action/search/SearchTransportServiceTests.java
comments:
fix usage of forbidden InetAddress constructor, also fix typo built->build

time:
2016-11-24T13:17:53Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/test/java/org/elasticsearch/action/search/SearchTransportServiceTests.java
qa/multi-cluster-search/src/test/java/org/elasticsearch/upgrades/MultiClusterSearchYamlTestSuiteIT.java
comments:
Add a dedicated integ test project for multi-cluster-search

This commit adds `qa/multi-cluster-search` which currently does a
simple search across 2 clusters. This commit also adds support for IPv6
addresses and fixes an issue where all shards of the local cluster are searched
when only a remote index was given.

time:
2016-11-24T10:39:14Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
comments:
add support multi cluster search

Search api looks at indices that the request relates to, if they contain a certain separator ("|" at the moment, to be better defined in the future) the index name is split into two part where the first portion is the name of a remote cluster and the second part is the name of the index expression. Remote clusters are defined as dynamic cluster settings. There are some TODOs and open question but the main functionality works.

time:
2016-11-24T08:46:57Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsGroup.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponse.java
core/src/test/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponseTests.java
core/src/test/java/org/elasticsearch/cluster/shards/ClusterSearchShardsIT.java
comments:
Cluster search shards improvements: expose ShardId, adjust visibility of some members (#21752)

* ClusterSearchShardsGroup to return ShardId rather than the int shard id

This allows more info to be retrieved, like the index uuid which is exposed through the ShardId object but was not available before

* Make ClusterSearchShardsResponse empty constructor public

This allows to receive such responses when sending ClusterSearchShardsRequests directly through TransportService (not using ClusterSearchShardsAction via Client), otherwise an empty response cannot be created unless the class that does it is in org.elasticsearch.action, admin.cluster.shards package

* adjust visibility of ClusterSearchShards members

time:
2016-11-24T08:43:42Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolver.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
comments:
Use index uuid as key in the alias filter map rather than the index name (#21749)

The index uuid is unique across multiple clusters, while the index name is not. Using the index uuid to look up filters in the alias filters map is better and will be needed for multi cluster search.

time:
2016-11-24T08:03:43Z
class:
comments:
Build: Apply license section in poms only to elasticsearch artifacts (#21757)

time:
2016-11-23T22:45:21Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/PainlessScriptEngineService.java
comments:
Wrap VerifyError in ScriptException (#21769)

If a bug occurs in painless compilation (not from a user, but from the
painless infrastructure), a VerifyError may be thrown when compiling the
broken generated class. This commit wraps VerifyErrors in
ScriptException so that useful information is returned to the user,
which can be passed on to the ES team for analysis.

time:
2016-11-23T21:57:14Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EComp.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/EqualsTests.java
comments:
Fix a VerifyError bug in Painless (#21765)

This bug would cause a VerifyError when scripts using the === operator
were comparing a def type against a primitive type since the primitive
type wasn't being appropriately boxed.

time:
2016-11-23T21:25:51Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/PlainShardsIterator.java
core/src/main/java/org/elasticsearch/cluster/routing/ShardsIterator.java
comments:
Remove unused assignedReplicasIncludingRelocating from ShardsIterator interface (#21687)

time:
2016-11-23T21:18:50Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/TransportClearScrollAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java
core/src/main/java/org/elasticsearch/node/Node.java
comments:
Move SearchTransportService and SearchPhaseController creation outside of TransportSearchAction constructor (#21754)

This commit makes sure that there is only one instance of the two services rather than one per transport action that uses it.
Also, we take their initialization out of guice's hands by binding it to a specific instance. Otherwise those two objects would get created within a constructor that is called by guice. That may cause problem for instance when throwing an exception from such constructors as guice tries all over again to re-initialize objects and fills up logs with stacktraces.

time:
2016-11-23T21:18:02Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java
comments:
Don't carry ShardRouting around when not needed in AbstractSearchAsyncAction (#21753)

* replace ShardRouting argument in AbstractSearchAsyncAction#onFirstPhaseResult with more contained String nodeId

There is no need to pass in ShardRouting if the only info read from it is the current node id, the shard id can be read directly from the ShardIterator that's already provided as an argument.

* avoid creating a new ShardId when creating a SearchShardTarget in SnapshotsService

time:
2016-11-23T20:49:05Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java
core/src/main/java/org/elasticsearch/common/transport/TransportAddress.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/main/java/org/elasticsearch/index/store/StoreStats.java
core/src/main/java/org/elasticsearch/monitor/os/OsStats.java
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/search/internal/AliasFilter.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponseTests.java
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/bwcompat/RestoreBackwardsCompatIT.java
core/src/test/java/org/elasticsearch/cluster/routing/RoutingBackwardCompatibilityTests.java
core/src/test/java/org/elasticsearch/codecs/CodecTests.java
core/src/test/java/org/elasticsearch/index/mapper/MultiFieldCopyToMapperTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByScrollRequest.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/BulkByScrollTask.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/BulkByScrollTaskTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RoundTripTests.java
test/framework/src/main/java/org/elasticsearch/test/VersionUtils.java
test/framework/src/test/java/org/elasticsearch/test/test/VersionUtilsTests.java
comments:
Improve handling of unreleased versions

Today when handling unreleased versions for backwards compatilibity
support, we scatted version constants across the code base and add some
asserts to support removing these constants when the version in question
is actually released. This commit improves this situation, enabling us
to just add a single unreleased version constant that can be renamed
when the version is actually released. This should make maintenance of
these versions simpler.

Relates #21760

time:
2016-11-23T19:33:32Z
class:
modules/lang-painless/src/test/java/org/elasticsearch/painless/ElvisTests.java
comments:
Docs and tests for painless lack of boxing for ?: and ?. (#21756)

NOTE: The result of `?.` and `?:` can't be assigned to primitives. So
`int[] someArray = null; int l = someArray?.length` and
`int s = params.size ?: 100` don't work. Do
`def someArray = null; def l = someArray?.length` and
`def s = params.size ?: 100` instead.

Relates to #21748

time:
2016-11-23T16:34:45Z
class:
comments:
Update usage.asciidoc

Reordered parameters for last async call based on implementation

Backport of #21360 in master branch (6.0).

Closes #21360.

time:
2016-11-23T16:13:01Z
class:
comments:
Add missing change for sniffer page

Related to #21737

time:
2016-11-23T16:03:58Z
class:
comments:
Merge branch 'doc/gradle-rest-client'

time:
2016-11-23T16:00:41Z
class:
comments:
Update layout

time:
2016-11-23T15:02:13Z
class:
comments:
Fix markup in Zen discovery docs

This commit fixes a markup issue in the Zen discovery docs where a link
and its referring text were not on the same line tripping the renderer.

time:
2016-11-23T14:34:55Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchLocalRequest.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchTransportRequest.java
core/src/test/java/org/elasticsearch/search/internal/ShardSearchTransportRequestTests.java
comments:
ShardSearchRequest to take ShardId constructor argument rather than the whole ShardRouting (#21750)

ShardSearchRequest was previously taking in the whole ShardRouting as a constructor argument while it only needs the ShardsId, changed that to carry over only the needed bits.

time:
2016-11-23T14:26:53Z
class:
comments:
Revert "it's a `noop` operation, not a `none` operation. (#21736)"

This reverts commit 7f77214cedbc927347241670be140b54185752c6.

`none` is indeed how you trigger the `noop` operation in the `_update`
API.

time:
2016-11-23T10:59:36Z
class:
comments:
Update packaging tests after lang-groovy removal (#21748)

The packaging tests must be adapted since 'lang-groovy' has been removed from master.

time:
2016-11-23T07:12:14Z
class:
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/PluginsService.java
core/src/test/java/org/elasticsearch/plugins/PluginsServiceTests.java
comments:
Plugins: Remove support for onModule (#21416)

All plugin extension points have been converted to pull based
interfaces. This change removes the infrastructure for the black-magic
onModule methods.

time:
2016-11-23T07:06:24Z
class:
comments:
Fix more groovy references in packaging tests

time:
2016-11-23T06:50:11Z
class:
core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/client/transport/FailAndRetryMockTransport.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientNodesServiceTests.java
comments:
Transport client: Fix remove address to actually work (#21743)

* Transport client: Fix remove address to actually work

The removeTransportAddress method of TransportClient removes the address
from the list of nodes that the client pings to sniff for nodes.
However, it does not remove it from the list of existing connected
nodes. This means removing a node is not possible, as long as that node
is still up.

This change removes the node from the connected nodes list before
triggering sampling (ie sniffing).  While the fix is simple, testing was
not because there were no existing tests for sniffing. This change also
modifies the mocks used by transport client unit tests in order to allow
mocking sniffing.

time:
2016-11-23T06:46:04Z
class:
comments:
Remove references to groovy in packaging tests

time:
2016-11-23T04:15:49Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchRequest.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollRequest.java
core/src/main/java/org/elasticsearch/action/support/ToXContentToBytes.java
core/src/main/java/org/elasticsearch/search/fetch/ShardFetchRequest.java
core/src/main/java/org/elasticsearch/search/internal/InternalScrollSearchRequest.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchTransportRequest.java
core/src/main/java/org/elasticsearch/search/query/QuerySearchRequest.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TasksIT.java
comments:
Add search task descriptions

Since we added ability to cancel searches it would be nice to see which searches we are actually cancelling.

time:
2016-11-23T03:24:12Z
class:
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/script/ScriptSettings.java
core/src/test/java/org/elasticsearch/index/query/QueryDSLDocumentationTests.java
core/src/test/java/org/elasticsearch/index/query/QueryRewriteContextTests.java
core/src/test/java/org/elasticsearch/script/ScriptServiceTests.java
core/src/test/java/org/elasticsearch/script/ScriptSettingsTests.java
modules/lang-groovy/src/main/java/org/elasticsearch/script/groovy/GroovyPlugin.java
modules/lang-groovy/src/main/java/org/elasticsearch/script/groovy/GroovyScriptEngineService.java
modules/lang-groovy/src/test/java/org/elasticsearch/script/groovy/GroovyIndexedScriptTests.java
modules/lang-groovy/src/test/java/org/elasticsearch/script/groovy/GroovyScriptTests.java
modules/lang-groovy/src/test/java/org/elasticsearch/script/groovy/GroovySecurityTests.java
modules/lang-groovy/src/test/java/org/elasticsearch/script/groovy/LangGroovyClientYamlTestSuiteIT.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorBackwardsCompatibilityTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/SimpleExecutableScript.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/Features.java
comments:
Remove groovy scripting language (#21607)

* Scripting: Remove groovy scripting language

Groovy was deprecated in 5.0. This change removes it, along with the
legacy default language infrastructure in scripting.

time:
2016-11-23T01:27:14Z
class:
comments:
Move painless yaml tests into painless dir

They were in a directory named "plan_a", the old name for painless.

time:
2016-11-23T00:16:07Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/MatchAssertion.java
comments:
Document `error_trace`

The `error_trace` parameter turns on the `stack_trace` field
in errors which returns stack traces.

Removes documentation for `camelCase` because it hasn't worked
in a while....

Documents the internal parameters used to render stack traces as
internal only.

Closes #21708

time:
2016-11-22T23:40:18Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Security.java
comments:
Mark Security#addBindPermissions as private

This commit marks the method Security#addBindPermissions as private,
it's package-private visibility was not used anywhere.

time:
2016-11-22T23:39:14Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Security.java
comments:
Refactor handling of bind permissions

This commit refactors the handling of bind permissions, which is in need
of a little cleanup. For example, in its current state, the code for
handling permissions for transport profiles is split across two
methods. This commit refactors this code hopefully making it easier to
work with in future changes. This change is mostly mechanical, no
functionality is changed.

Relates #21742

time:
2016-11-22T23:35:57Z
class:
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
comments:
Increase lower bound for random resolve timeout in test

The test UnicastZenPing#testResolveTimeout chooses a random resolve
timeout between 1ms and 100ms. Close to the lower bound, this is far too
short and the test races against the concurrent resolves executing
before the timeout elapses. This commit increases the timeout to
something that is far less likely to race, yet will not slow the test
down since we are not doing resolves against a real DNS service anyway.
Note that we still want a short resolve timeout since we are testing
whether or not timeouts really work here (by latching one of the
resolves to respond slowly).

time:
2016-11-22T22:00:25Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/TransportClusterSearchShardsAction.java
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsRequestTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponseTests.java
comments:
Add indices and filter information to search shards api output (#21738)

Add indices and filter information to search shards api output

The search shards api returns info about which shards are going to be hit by executing a search with provided parameters: indices, routing, preference. Indices can also be aliases, which can also hold filters. The output includes an array of shards and a summary of all the nodes the shards are allocated on. This commit adds a new indices section to the search shards output that includes one entry per index, where each index can be associated with an optional filter in case the index was hit through a filtered alias.

This is relevant since we have moved parsing of alias filters to the coordinating node.

Relates to #20916

time:
2016-11-22T21:23:33Z
class:
core/src/test/java/org/elasticsearch/search/scriptfilter/ScriptQuerySearchIT.java
comments:
Clean up ScriptQuerySearchIT

Shorten line and remove forbidden API.

Relates to #21484

time:
2016-11-22T21:23:23Z
class:
core/src/main/java/org/elasticsearch/index/fielddata/ScriptDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/BytesBinaryDVAtomicFieldData.java
core/src/test/java/org/elasticsearch/search/scriptfilter/ScriptQuerySearchIT.java
comments:
Support binary field type in script values (#21484)

Add ScriptDocValues.BytesRefs for reading binary fieldtype

time:
2016-11-22T19:56:34Z
class:
comments:
test: use the correct number of bwc nodes for old cluster

time:
2016-11-22T19:46:28Z
class:
client/transport/src/main/java/org/elasticsearch/transport/client/PreBuiltTransportClient.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java
core/src/main/java/org/elasticsearch/client/transport/TransportProxyClient.java
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/test/java/org/elasticsearch/client/transport/NodeDisconnectIT.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientNodesServiceTests.java
test/framework/src/main/java/org/elasticsearch/transport/MockTransportClient.java
comments:
Add a HostFailureListener to notify client code if a node got disconnected (#21709)

Today there is no way to get notified if a node is disconnected. Client code
must poll the TransportClient constantly to detect that a node is not connected
anymore in order to react and add new nodes or notify altering etc. For instance
if a hostname  gets resolved to an IP but that host is disconnected clients want
to reconnect by resolving the hostname again which is a common situation in cloud
environments.

Closes #21424

time:
2016-11-22T19:39:59Z
class:
comments:
Fix get-bwc-version for 2.x releases

time:
2016-11-22T19:17:04Z
class:
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/main/java/org/elasticsearch/transport/Transport.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/client/transport/FailAndRetryMockTransport.java
core/src/test/java/org/elasticsearch/cluster/NodeConnectionsServiceTests.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryTests.java
plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedDiscoveryPlugin.java
plugins/discovery-file/src/main/java/org/elasticsearch/discovery/file/FileBasedUnicastHostsProvider.java
plugins/discovery-file/src/test/java/org/elasticsearch/discovery/file/FileBasedUnicastHostsProviderTests.java
test/framework/src/main/java/org/elasticsearch/test/transport/CapturingTransport.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
comments:
Lazy resolve unicast hosts

Today we eagerly resolve unicast hosts. This means that if DNS changes,
we will never find the host at the new address. Moreover, a single host
failng to resolve causes startup to abort. This commit introduces lazy
resolution of unicast hosts. If a DNS entry changes, there is an
opportunity for the host to be discovered. Note that under the Java
security manager, there is a default positive cache of infinity for
resolved hosts; this means that if a user does want to operate in an
environment where DNS can change, they must adjust
networkaddress.cache.ttl in their security policy. And if a host fails
to resolve, we warn log the hostname but continue pinging other
configured hosts.

When doing DNS resolutions for unicast hostnames, we wait until the DNS
lookups timeout. This appears to be forty-five seconds on modern JVMs,
and it is not configurable. If we do these serially, the cluster can be
blocked during ping for a lengthy period of time. This commit introduces
doing the DNS lookups in parallel, and adds a user-configurable timeout
for these lookups.

Relates #21630

time:
2016-11-22T18:45:59Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
Added version 2.4.2 and bwc indices

time:
2016-11-22T18:35:47Z
class:
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/main/java/org/elasticsearch/index/store/Store.java
core/src/test/java/org/elasticsearch/gateway/PrimaryShardAllocatorTests.java
comments:
Allow master to assign primary shard to node that has shard store locked during shard state fetching (#21656)

PR #19416 added a safety mechanism to shard state fetching to only access the store when the shard lock can be acquired. This can lead to the following situation however where a shard has not fully shut down yet while the shard fetching is going on, resulting in a ShardLockObtainFailedException. PrimaryShardAllocator that decides where to allocate primary shards sees this exception and treats the shard as unusable. If this is the only shard copy in the cluster, the cluster stays red and a new shard fetching cycle will not be triggered as shard state fetching treats exceptions while opening the store as permanent failures.

This commit makes it so that PrimaryShardAllocator treats the locked shard as a possible allocation target (although with the least priority).

time:
2016-11-22T18:24:15Z
class:
core/src/main/java/org/elasticsearch/common/cache/Cache.java
core/src/test/java/org/elasticsearch/common/cache/CacheTests.java
comments:
Rethrow ExecutionException from the loader to concurrent callers of Cache#computeIfAbsent

This commit clarifies the contract of Cache#computeIfAbsent so that an exception that occurs during the execution
of the loader is thrown to all callers. Prior to this commit, the first caller would get the ExecutionException
and other callers that called during the load execution would get null, which is confusing.

time:
2016-11-22T18:13:16Z
class:
comments:
Remove a bad callout from the new debugging docs

It was a leftover and doesn't break the usual build but breaks the docs
build.

time:
2016-11-22T17:46:02Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/Debug.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/ScriptImpl.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/DebugTests.java
comments:
Add Debug.explain to painless

You can use `Debug.explain(someObject)` in painless to throw an
`Error` that can't be caught by painless code and contains an
object's class. This is useful because painless's sandbox doesn't
allow you to call `someObject.getClass()`.

Closes #20263

time:
2016-11-22T16:58:17Z
class:
comments:
Build: add the ability to support plugins in BWC tests

This commit adds the ability to support running with plugins in tests that make use of
backwards compatibility nodes. This can be used to test rolling upgrades with plugins
to ensure they do not cause issues during a rolling upgrade of elasticsearch.

time:
2016-11-22T16:22:33Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsRequestBuilder.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterSearchShardsAction.java
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsRequestTests.java
comments:
Remove ignored type parameter in search_shards api (#21688)

The `type` parameter has always been accepted by the search_shards api, probably to make the api and its urls the same as search. Truth is that the type never had any effect, it's been ignored from day one while accepting it may make users think that we actually do something with it.

This commit removes support for the type parameter from the REST layer and the Java API. Backwards compatibility is maintained on the transport layer though.

The new added serialization test also uncovered a bug in the java API where the `ClusterSearchShardsRequest` could be created with no arguments, but the indices were required to be not null otherwise the request couldn't be serialized as `writeTo` would throw NPE. Fixed by setting a default value (empty array) for indices.

time:
2016-11-22T16:21:24Z
class:
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
Die with dignity on the Lucene layer

When a fatal error tragically closes an index writer, such an error
never makes its way to the uncaught exception handler. This prevents the
node from being torn down if an out of memory error or other fatal error
is thrown in the Lucene layer. This commit ensures that such events
bubble their way up to the uncaught exception handler.

Relates #21721

time:
2016-11-22T15:41:24Z
class:
comments:
it's a `noop` operation, not a `none` operation. (#21736)

It works I guess cause it's ignored as an invalid operation.

time:
2016-11-22T15:35:58Z
class:
comments:
fixing an ambiguous sentence. (#21729)

time:
2016-11-22T15:35:57Z
class:
comments:
`force` is deprecated be mentioned at the end. (#21731)

time:
2016-11-22T15:34:23Z
class:
comments:
Add Gradle coordinates for the REST client

time:
2016-11-22T15:26:36Z
class:
core/src/main/java/org/elasticsearch/bootstrap/ESPolicy.java
qa/evil-tests/src/test/java/org/elasticsearch/bootstrap/ESPolicyUnitTests.java
comments:
Refactor handling for bad default permissions

This commit refactors the handling of bad default permissions that come
from the system security policy.

Relates #21735

time:
2016-11-22T14:10:09Z
class:
comments:
Update get-settings.asciidoc

Fix syntax for filtering settings by name

Closes https://github.com/elastic/elasticsearch/issues/21713

time:
2016-11-22T13:17:57Z
class:
comments:
Update index.asciidoc (#21727)

time:
2016-11-22T11:20:53Z
class:
core/src/main/java/org/elasticsearch/cluster/ClusterStateTaskExecutor.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
comments:
Split main ClusterService method into smaller chunks #21666

Splits the main method in ClusterService into smaller chunks so that it's easier to understand and simpler to modify in subsequent PRs.

time:
2016-11-22T11:02:56Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
core/src/test/java/org/elasticsearch/VersionTests.java
comments:
Adapt BWC layer checks for Exceptions to include v5.0.2 support

The PR #21694 was initially planned to go into v6.0.0 and v5.1.0. Due to another PR relying on this one though for backport to v5.0.2, #21694 must go to v5.0.2
as well. As such, the initial backward compatibility rules established by the PR must be changed to include v5.0.2 and above.

time:
2016-11-22T05:10:19Z
class:
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/test/java/org/elasticsearch/search/query/QueryStringIT.java
core/src/test/java/org/elasticsearch/search/query/SimpleQueryStringIT.java
comments:
Merge remote-tracking branch 'dakrone/fix-lenient-overriding'

time:
2016-11-22T04:32:25Z
class:
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/test/java/org/elasticsearch/search/query/QueryStringIT.java
core/src/test/java/org/elasticsearch/search/query/SimpleQueryStringIT.java
comments:
Allow overriding all-field leniency when `lenient` option is specified

As part of #20925 and #21341 we added an "all-fields" mode to the
`query_string` and `simple_query_string`. This would expand the query to
all fields and automatically set `lenient` to true.

However, we should still allow a user to override the `lenient` flag to
whichever value they desire, should they add it in the request. This
commit does that.

time:
2016-11-22T04:02:36Z
class:
core/src/main/java/org/elasticsearch/tribe/TribeService.java
comments:
[FIX] make MergableCustomMetaData public in TribeService

time:
2016-11-22T03:14:30Z
class:
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpRequestHandler.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4MessageChannelHandler.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Utils.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpClient.java
comments:
Die with dignity on the network layer

When a fatal error is thrown on the network layer, such an error never
makes its way to the uncaught exception handler. This prevents the node
from being torn down if an out of memory error or other fatal error is
thrown while handling HTTP or transport traffic. This commit adds logic
to ensure that such errors bubble their way up to the uncaught exception
handler, even though Netty tries really hard to swallow everything.

Relates #21720

time:
2016-11-22T03:13:25Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Security.java
plugins/lang-javascript/src/main/java/org/elasticsearch/plugin/javascript/JavaScriptPlugin.java
plugins/lang-javascript/src/main/java/org/elasticsearch/script/javascript/JavaScriptScriptEngineService.java
plugins/lang-javascript/src/main/java/org/elasticsearch/script/javascript/support/NativeList.java
plugins/lang-javascript/src/main/java/org/elasticsearch/script/javascript/support/NativeMap.java
plugins/lang-javascript/src/main/java/org/elasticsearch/script/javascript/support/ScriptValueConverter.java
plugins/lang-javascript/src/main/java/org/elasticsearch/script/javascript/support/ScriptableLinkedHashMap.java
plugins/lang-javascript/src/main/java/org/elasticsearch/script/javascript/support/ScriptableMap.java
plugins/lang-javascript/src/main/java/org/elasticsearch/script/javascript/support/ScriptableWrappedMap.java
plugins/lang-javascript/src/test/java/org/elasticsearch/script/javascript/JavaScriptScriptEngineTests.java
plugins/lang-javascript/src/test/java/org/elasticsearch/script/javascript/JavaScriptScriptMultiThreadedTests.java
plugins/lang-javascript/src/test/java/org/elasticsearch/script/javascript/JavaScriptSecurityTests.java
plugins/lang-javascript/src/test/java/org/elasticsearch/script/javascript/LangJavascriptClientYamlTestSuiteIT.java
plugins/lang-python/src/main/java/org/elasticsearch/plugin/python/PythonPlugin.java
plugins/lang-python/src/main/java/org/elasticsearch/script/python/PythonScriptEngineService.java
plugins/lang-python/src/test/java/org/elasticsearch/script/python/LangPythonClientYamlTestSuiteIT.java
plugins/lang-python/src/test/java/org/elasticsearch/script/python/PythonScriptEngineTests.java
plugins/lang-python/src/test/java/org/elasticsearch/script/python/PythonScriptMultiThreadedTests.java
plugins/lang-python/src/test/java/org/elasticsearch/script/python/PythonSecurityTests.java
comments:
Remove lang-python and lang-javascript (#20734)

They were deprecated in 5.0. We are concentrating on making
Painless awesome rather than supporting every language possible.

Closes #20698

time:
2016-11-22T01:33:42Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Elasticsearch.java
comments:
Install a security manager on startup

When Elasticsearch starts, we go through some initialization before we
install a security manager. Yet, the JVM makes internal policy decisions
on the basis of whether or not a security manager is present. This
commit installs a security manager immediately on startup so that the
JVM always thinks a security manager is present when making such policy
decisions.

Relates #21716

time:
2016-11-21T21:24:10Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/Operation.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ANode.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EAssignment.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EBinary.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EBool.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EBoolean.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ECallLocal.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ECapturingFunctionRef.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ECast.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EComp.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EConditional.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EConstant.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EDecimal.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EElvis.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EExplicit.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EFunctionRef.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EInstanceof.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ELambda.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EListInit.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EMapInit.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ENewArray.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ENewObj.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ENull.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ENumeric.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ERegex.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EStatic.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EString.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EUnary.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EVariable.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PBrace.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PCallInvoke.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PField.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PSubArrayLength.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PSubBrace.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PSubCallInvoke.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PSubDefArray.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PSubDefCall.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PSubDefField.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PSubField.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PSubListShortcut.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PSubMapShortcut.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PSubNullSafeCallInvoke.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PSubNullSafeField.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PSubShortcut.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SBlock.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SBreak.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SCatch.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SContinue.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SDeclBlock.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SDeclaration.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SDo.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SEach.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SExpression.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SFor.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SFunction.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SIf.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SIfElse.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SReturn.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SSource.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SSubEachArray.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SSubEachIterable.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SThrow.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/STry.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SWhile.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/node/NodeToStringTests.java
comments:
Implement toString in painless's AST

This should make debugging painless' analysis and code generation a
little easier.

The `toString` implementations mirror the AST somewhat, and look like
`(SSource (SReturn (ENumeric 1)))`.

time:
2016-11-21T20:39:21Z
class:
core/src/main/java/org/elasticsearch/common/bytes/BytesReference.java
core/src/main/java/org/elasticsearch/common/bytes/BytesReferenceStreamInput.java
core/src/main/java/org/elasticsearch/common/io/stream/ByteBufferStreamInput.java
core/src/main/java/org/elasticsearch/common/io/stream/FilterStreamInput.java
core/src/main/java/org/elasticsearch/common/io/stream/InputStreamStreamInput.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java
core/src/main/java/org/elasticsearch/index/translog/BufferedChecksumStreamInput.java
core/src/test/java/org/elasticsearch/common/io/stream/BytesStreamsTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/ByteBufStreamInput.java
comments:
Add a StreamInput#readArraySize method that ensures sane array sizes (#21697)

Today we read a vint from the stream to allocate the size of an array up-front
before we start reading the values. This can be dangerous if for instance we read
from a corrupted stream or if some manipulated bytes are send for instance from
an attacker or a fuzzer. In most of the cases we can apply some best effort and
validate the array size to be _sane_ by ensuring we can at read at least N bytes
where N is the expected size of the array.

time:
2016-11-21T17:03:01Z
class:
core/src/main/java/org/elasticsearch/cluster/ClusterChangedEvent.java
core/src/main/java/org/elasticsearch/tribe/TribeService.java
core/src/test/java/org/elasticsearch/cluster/ClusterChangedEventTests.java
core/src/test/java/org/elasticsearch/tribe/TribeIT.java
core/src/test/java/org/elasticsearch/tribe/TribeServiceTests.java
test/framework/src/main/java/org/elasticsearch/test/TestCustomMetaData.java
comments:
Add support for merging custom meta data in tribe node (#21552)

* Add support for merging custom meta data in tribe node

Currently, when any underlying cluster has custom metadata
(via plugin), tribe node does not store custom meta data in its
cluster state. This is because the tribe node has no idea how to
select the appropriate custom metadata from one or many custom
metadata (corresponding to the number of underlying clusters).

This change adds an interface that custom metadata implementations
can extend to add support for merging mulitple custom metadata of
the same type for storing in the tribe state.

Relates to #20544
Supersedes #20791

* Simplify updating tribe state

* Add tests for merging multiple custom metadata types in tribe node

* cleanup merging custom md logic in tribe service

time:
2016-11-21T16:04:53Z
class:
comments:
[DOCS] Show EC2's auto attribute (#21474)

* [DOCS] Show EC2's auto attribute

This documents the `aws_availability_zone` node attribute as part of the `discovery-ec2` plugin. Also fixes outdated usage of "cloud aws".

time:
2016-11-21T14:03:07Z
class:
comments:
Add information about the removal of store throttling to the migration guide.

Relates to #21573

time:
2016-11-21T14:01:36Z
class:
comments:
Add a recommendation against large documents to the docs. (#21652)

time:
2016-11-21T13:52:43Z
class:
comments:
Add indices options tests to search api REST tests (#21701)

This is a followup to #21689 where we removed a misplaced try catch for IndexMissingException and IndexClosedException which was related to #9047 (at least for the index closed case). The code block within the change was moved as part of #20890, which made the catch redundant. It was somehow used before (e.g. in 5.0) but it doesn't seem that this catch had any effect. Added tests to verify that. In fact a specific catch added to the search api only would defeat the purpose of having common indices options that work throughout all our APIs.

Relates to #21689
since this is an enum, aren't we supposed to pass a single value here?
this parameter supports a comma separated list. Each value needs to be one of the declared values in the enum definition (none, open, closed, all). Though when using none and all, a comma separated list makes no sense. And at the moment open,closed is the same as all, but that may change one day (that is what we thought when we introduced support for multiple values)
I see, I assumed anything declared as `enum` takes a single value from the listed choices. Was I wrong? If so does this apply to all `enum` types in the spec?

https://github.com/elastic/elasticsearch/blob/master/rest-api-spec/src/main/resources/rest-api-spec/api/search.json#L65
I think that expand_wildcards is the exception. I quickly went through other enums and I didn't find any that can be provided as multiple values. But there are many and I just skimmed through them.

time:
2016-11-21T12:09:21Z
class:
comments:
Fixing indentation in geospatial querying example. (#21682)

Specifically the example which shows providing an array of an array of values.

time:
2016-11-21T11:52:45Z
class:
comments:
Fix typo in filters aggregation docs (#21690)

