time:
2015-04-03T02:23:43Z
class:
src/main/java/org/elasticsearch/repositories/RepositoriesService.java
src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreTests.java
src/test/java/org/elasticsearch/snapshots/mockstore/MockRepositoryPlugin.java
comments:
Snapshot/Restore: separate repository registration

Separate repository registration to make sure that failure in registering one repository doesn't cause failures to register other repositories.

Closes #10351

time:
2015-04-03T02:11:33Z
class:
src/test/java/org/elasticsearch/indices/IndicesCustomDataPathTests.java
comments:
[TEST] Turn on more logging for testDataPathCanBeChanged

time:
2015-04-02T19:41:52Z
class:
src/main/java/org/elasticsearch/index/mapper/core/AbstractFieldMapper.java
src/test/java/org/elasticsearch/index/mapper/multifield/MultiFieldTests.java
comments:
Mapping: add consistent serialization order for field data settings

Closes #10370
Closes #10318

time:
2015-04-02T17:11:12Z
class:
comments:
Tests: Speed up backward-compatibility tests for 1.1.0

1.1.0 is affected by #5817 which prevents merges from keeping up with the
indexing rate. As a consequence it generates lots of segments and makes bw
compat tests slow. So I added a special case for this version to index fewer
documents.

time:
2015-04-02T16:09:43Z
class:
comments:
Add properties files to configure startup and installation scripts

Many scripts are used to start/stop and install/uninstall elasticsearch. These scripts share a lot of configuration properties like directory paths, max value for a setting, default user etc. Most of the values are identical but some of them are different depending of the platform (Debian-based or Redhat-based OS), depending of the way elasticsearch is started (shell script, systemd, sysv-init...) or the way it is installed (zip, rpm, deb...). Today the values are duplicated in multiple places, making it difficult to maintain the scripts or to update a value.

This pull request make this more uniform: values used in scripts must be defined in a common packaging.properties file. Each value can be overridden in another specific packaging.properties file for Debian or Redhat. All startup and installation scripts are filtered with the common then the custom packaging.properties files before being packaged as a zip/tar.gz/rpm/dpkf archive.

time:
2015-04-02T14:32:20Z
class:
src/main/java/org/elasticsearch/cache/recycler/PageCacheRecycler.java
src/main/java/org/elasticsearch/threadpool/ThreadPool.java
comments:
Internal: reduce the size of the search thread pool.

Follow-up of #9135. We initially decreased the stack size because it would end
up a lot of memory when there are many threads. But we also have some thread
pools that may be oversized, in particular the search thread pool.

This commit proposes to decrease the default search thread pool size from
`3 * num_procs` to `3 * num_procs / 2 + 1`. This is large enough to be sure
that we can use all the machine resources even with a search-only work load
but not too large in order to not consume too much memory because of the stack
size and thread locals.

time:
2015-04-02T14:06:52Z
class:
src/main/java/org/elasticsearch/common/xcontent/XContentBuilder.java
src/main/java/org/elasticsearch/index/fielddata/IndexFieldDataService.java
src/main/java/org/elasticsearch/index/fielddata/IndexNumericFieldData.java
src/main/java/org/elasticsearch/index/fielddata/plain/PackedArrayIndexFieldData.java
src/main/java/org/elasticsearch/index/mapper/core/BooleanFieldMapper.java
src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceParser.java
src/main/java/org/elasticsearch/search/aggregations/support/format/ValueFormat.java
src/main/java/org/elasticsearch/search/aggregations/support/format/ValueFormatter.java
src/main/java/org/elasticsearch/search/aggregations/support/format/ValueFormatterStreams.java
src/main/java/org/elasticsearch/search/aggregations/support/format/ValueParser.java
src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityTests.java
src/test/java/org/elasticsearch/index/mapper/core/BooleanFieldMapperTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/BooleanTermsTests.java
src/test/java/org/elasticsearch/search/fields/SearchFieldsTests.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
comments:
Merge pull request #7961 from jpountz/enhancement/boolean_doc_values

Fielddata: Add doc values support to boolean fields.Close #7961

time:
2015-04-02T13:40:46Z
class:
src/main/java/org/elasticsearch/common/xcontent/XContentBuilder.java
src/main/java/org/elasticsearch/index/fielddata/IndexFieldDataService.java
src/main/java/org/elasticsearch/index/fielddata/IndexNumericFieldData.java
src/main/java/org/elasticsearch/index/fielddata/plain/PackedArrayIndexFieldData.java
src/main/java/org/elasticsearch/index/mapper/core/BooleanFieldMapper.java
src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceParser.java
src/main/java/org/elasticsearch/search/aggregations/support/format/ValueFormat.java
src/main/java/org/elasticsearch/search/aggregations/support/format/ValueFormatter.java
src/main/java/org/elasticsearch/search/aggregations/support/format/ValueFormatterStreams.java
src/main/java/org/elasticsearch/search/aggregations/support/format/ValueParser.java
src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityTests.java
src/test/java/org/elasticsearch/index/mapper/core/BooleanFieldMapperTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/BooleanTermsTests.java
src/test/java/org/elasticsearch/search/fields/SearchFieldsTests.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
comments:
Add doc values support to boolean fields.

This pull request makes boolean handled like dates and ipv4 addresses: things
are stored as as numerics under the hood and aggregations add some special
formatting logic in order to return true/false in addition to 1/0.

For example, here is an output of a terms aggregation on a boolean field:
```
   "aggregations": {
      "top_f": {
         "doc_count_error_upper_bound": 0,
         "buckets": [
            {
               "key": 0,
               "key_as_string": "false",
               "doc_count": 2
            },
            {
               "key": 1,
               "key_as_string": "true",
               "doc_count": 1
            }
         ]
      }
   }
```

Sorted numeric doc values are used under the hood.

Close #4678
Close #7851

time:
2015-04-02T13:34:44Z
class:
comments:
Merge pull request #9532 from nickcanz/master

service.bat file should explicitly use the Windows find command.

time:
2015-04-02T13:34:38Z
class:
src/main/java/org/elasticsearch/Version.java
comments:
Internal: Fix snapshot status of version 1.1.2.

org.elasticsearch.Version mistakenly tags 1.1.2 as a snapshot version while it
has been released.

time:
2015-04-02T13:08:39Z
class:
src/main/java/org/elasticsearch/search/fetch/innerhits/InnerHitsContext.java
src/test/java/org/elasticsearch/search/innerhits/InnerHitsTests.java
comments:
inner hits: Make sure `size` of `0` works on the `inner_hits` level.

Closes #10358

time:
2015-04-02T12:23:31Z
class:
comments:
[DOCS] Add verify parameter to snapshot documentation

Add verify parameter to snapshot documentation and remove 'verify' setting at FS repository level (not supported)

time:
2015-04-02T11:36:07Z
class:
src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreTests.java
comments:
[TEST] more restrictive logging

time:
2015-04-02T10:37:12Z
class:
src/main/java/org/elasticsearch/indices/recovery/RecoveryState.java
src/test/java/org/elasticsearch/indices/recovery/RecoveryStateTest.java
comments:
recovery state: fix concurrent access to file list

A shard recovery response might serialize a shard state at the same time that it is
modified by the recovery process. The test
RelocationTests.testMoveShardsWhileRelocation
failed because of this with a ConcurrentModificationException.

closes #10381

time:
2015-04-02T10:29:47Z
class:
src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java
src/test/java/org/elasticsearch/action/IndicesRequestTests.java
src/test/java/org/elasticsearch/cluster/routing/RoutingTableTest.java
comments:
Remove expansion of empty index arguments in RoutingTable

RoutingTables activePrimaryShardsGrouped(), allActiveShardsGrouped() and
allAssignedShardsGrouped() methods treated empty index array input
parameters as meaning "all" indices and expanded to the routing maps
keyset. However, the expansion of index names is now already done in
MetaData#concreteIndices(). Returning an empty index name list here
when a wildcard pattern didn't match any index name could lead to
problems like #9081 because the RoutingTable still expanded this
list of names to "_all". In case of e.g. the recovery endpoint this
could lead to problems.

Closes #9081
Closes #10148

time:
2015-04-02T10:19:52Z
class:
src/main/java/org/elasticsearch/action/admin/indices/flush/FlushRequest.java
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
src/main/java/org/elasticsearch/index/engine/ShadowEngine.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/main/java/org/elasticsearch/indices/IndicesService.java
src/test/java/org/elasticsearch/index/IndexWithShadowReplicasTests.java
comments:
Merge pull request #10376 from dakrone/misc-addl-logging

Miscellaneous additional logging and cleanups

time:
2015-04-02T09:17:00Z
class:
src/main/java/org/elasticsearch/common/logging/log4j/LogConfigurator.java
comments:
Merge pull request #10373 from djschny/issue10371

Add ability to specify a SizeBasedTriggeringPolicy for log configuration.Close #10371

time:
2015-04-02T08:51:14Z
class:
src/test/java/org/elasticsearch/cluster/allocation/AwarenessAllocationTests.java
comments:
[TEST] set mmn to avoid split brain

time:
2015-04-02T08:51:14Z
class:
src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreTests.java
comments:
[TEST] increase logging for SharedClusterSnapshotRestoreTests.basicWorkFlowTest

time:
2015-04-02T07:33:54Z
class:
comments:
[DOCS] add wait_for_active_shards option to health.asciidoc

time:
2015-04-01T17:49:26Z
class:
src/main/java/org/elasticsearch/action/admin/indices/flush/FlushRequest.java
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
src/main/java/org/elasticsearch/index/engine/ShadowEngine.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/main/java/org/elasticsearch/indices/IndicesService.java
src/test/java/org/elasticsearch/index/IndexWithShadowReplicasTests.java
comments:
Clean up logging and add additional logging regarding shadow engines

This fixes an issue where this was logged:

```
[node_t1] [test][0] flush with org.elasticsearch.action.admin.indices.flush.FlushRequest@65f6f1e
```

by adding a .toString() method to FlushRequest.

It also changes:

```
creating Index [test], shards [1]/[2]
```

to:

```
creating Index [test], shards [1]/[2s]
```

If shadow replicas are being used.

time:
2015-04-01T16:33:02Z
class:
src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreTests.java
comments:
[TEST] don't restrict index to nodes

time:
2015-04-01T16:18:52Z
class:
src/main/java/org/elasticsearch/http/netty/NettyHttpChannel.java
src/main/java/org/elasticsearch/rest/RestController.java
src/test/java/org/elasticsearch/options/jsonp/JsonpOptionDisabledTest.java
src/test/java/org/elasticsearch/options/jsonp/JsonpOptionEnabledTest.java
comments:
Merge pull request #9242 from reuben-sutton/remove_jsonp

Remove jsonp support and associated tests, closes #9108

time:
2015-04-01T15:32:01Z
class:
src/main/java/org/elasticsearch/common/logging/log4j/LogConfigurator.java
comments:
add ability to specify a SizeBasedTriggeringPolicy for log configuration #10371

time:
2015-04-01T15:06:09Z
class:
src/main/java/org/elasticsearch/http/netty/NettyHttpChannel.java
src/main/java/org/elasticsearch/rest/RestController.java
src/test/java/org/elasticsearch/options/jsonp/JsonpOptionDisabledTest.java
src/test/java/org/elasticsearch/options/jsonp/JsonpOptionEnabledTest.java
comments:
Remove jsonp support and associated tests, closes #9108

time:
2015-04-01T13:56:26Z
class:
src/main/java/org/elasticsearch/snapshots/RestoreService.java
src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreTests.java
comments:
[RESTORE] Don't reuse source index UUID on restore

Today we reuse the UUID of the source index on restore. This can create conflicts
with existing shard state on disk. This also causes multiple indices with the same
UUID. This commit preserves the UUID of an existing index or creates a new UUID for
a newly created index.

time:
2015-04-01T12:11:20Z
class:
src/main/java/org/elasticsearch/action/admin/indices/validate/query/ValidateQueryRequest.java
src/main/java/org/elasticsearch/action/admin/indices/validate/query/ValidateQueryRequestBuilder.java
src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java
src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
src/main/java/org/elasticsearch/action/bulk/BulkRequestBuilder.java
src/main/java/org/elasticsearch/action/bulk/BulkShardRequest.java
src/main/java/org/elasticsearch/action/count/CountRequest.java
src/main/java/org/elasticsearch/action/count/CountRequestBuilder.java
src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
src/main/java/org/elasticsearch/action/deletebyquery/DeleteByQueryRequest.java
src/main/java/org/elasticsearch/action/deletebyquery/DeleteByQueryRequestBuilder.java
src/main/java/org/elasticsearch/action/exists/ExistsRequest.java
src/main/java/org/elasticsearch/action/exists/ExistsRequestBuilder.java
src/main/java/org/elasticsearch/action/explain/ExplainRequest.java
src/main/java/org/elasticsearch/action/explain/ExplainRequestBuilder.java
src/main/java/org/elasticsearch/action/index/IndexRequest.java
src/main/java/org/elasticsearch/action/index/IndexRequestBuilder.java
src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
src/main/java/org/elasticsearch/action/indexedscripts/put/PutIndexedScriptRequest.java
src/main/java/org/elasticsearch/action/indexedscripts/put/PutIndexedScriptRequestBuilder.java
src/main/java/org/elasticsearch/action/mlt/MoreLikeThisRequest.java
src/main/java/org/elasticsearch/action/mlt/TransportMoreLikeThisAction.java
src/main/java/org/elasticsearch/action/percolate/MultiPercolateRequest.java
src/main/java/org/elasticsearch/action/percolate/PercolateRequest.java
src/main/java/org/elasticsearch/action/percolate/PercolateRequestBuilder.java
src/main/java/org/elasticsearch/action/search/MultiSearchRequest.java
src/main/java/org/elasticsearch/action/search/SearchRequest.java
src/main/java/org/elasticsearch/action/search/SearchRequestBuilder.java
src/main/java/org/elasticsearch/action/search/type/TransportSearchTypeAction.java
src/main/java/org/elasticsearch/action/suggest/SuggestRequest.java
src/main/java/org/elasticsearch/action/support/broadcast/BroadcastOperationRequest.java
src/main/java/org/elasticsearch/action/support/broadcast/TransportBroadcastOperationAction.java
src/main/java/org/elasticsearch/action/support/replication/ShardReplicationOperationRequest.java
src/main/java/org/elasticsearch/action/support/replication/TransportIndexReplicationOperationAction.java
src/main/java/org/elasticsearch/action/support/replication/TransportShardReplicationOperationAction.java
src/main/java/org/elasticsearch/action/support/single/shard/SingleShardOperationRequest.java
src/main/java/org/elasticsearch/action/support/single/shard/TransportShardSingleOperationAction.java
src/main/java/org/elasticsearch/action/termvectors/dfs/DfsOnlyRequest.java
src/main/java/org/elasticsearch/http/netty/NettyHttpRequest.java
src/main/java/org/elasticsearch/rest/RestRequest.java
src/main/java/org/elasticsearch/rest/action/admin/indices/validate/query/RestValidateQueryAction.java
src/main/java/org/elasticsearch/rest/action/admin/indices/warmer/put/RestPutWarmerAction.java
src/main/java/org/elasticsearch/rest/action/bulk/RestBulkAction.java
src/main/java/org/elasticsearch/rest/action/count/RestCountAction.java
src/main/java/org/elasticsearch/rest/action/deletebyquery/RestDeleteByQueryAction.java
src/main/java/org/elasticsearch/rest/action/exists/RestExistsAction.java
src/main/java/org/elasticsearch/rest/action/explain/RestExplainAction.java
src/main/java/org/elasticsearch/rest/action/index/RestIndexAction.java
src/main/java/org/elasticsearch/rest/action/mlt/RestMoreLikeThisAction.java
src/main/java/org/elasticsearch/rest/action/percolate/RestMultiPercolateAction.java
src/main/java/org/elasticsearch/rest/action/percolate/RestPercolateAction.java
src/main/java/org/elasticsearch/rest/action/script/RestPutIndexedScriptAction.java
src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
src/main/java/org/elasticsearch/rest/action/suggest/RestSuggestAction.java
src/main/java/org/elasticsearch/script/ScriptService.java
src/test/java/org/elasticsearch/action/bulk/BulkIntegrationTests.java
src/test/java/org/elasticsearch/action/bulk/BulkRequestTests.java
src/test/java/org/elasticsearch/action/mlt/MoreLikeThisRequestTests.java
src/test/java/org/elasticsearch/action/percolate/MultiPercolatorRequestTests.java
src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
src/test/java/org/elasticsearch/document/BulkTests.java
src/test/java/org/elasticsearch/index/IndexRequestBuilderTests.java
src/test/java/org/elasticsearch/index/query/TemplateQueryTest.java
src/test/java/org/elasticsearch/rest/RestRequestTests.java
src/test/java/org/elasticsearch/search/geo/GeoFilterTests.java
src/test/java/org/elasticsearch/test/rest/FakeRestRequest.java
comments:
Remove unsafe options
For quite some time now, our networking layer makes sure to create safe messages as in not using the shared buffers. This is great, and we should remove the old support for "unsafe" notion in our codebase.
closes #10360

time:
2015-04-01T10:02:21Z
class:
src/test/java/org/elasticsearch/cluster/metadata/MetaDataTests.java
comments:
Removed unused import

time:
2015-04-01T08:59:09Z
class:
src/main/java/org/elasticsearch/cluster/metadata/MetaData.java
src/test/java/org/elasticsearch/cluster/metadata/MetaDataTests.java
comments:
Core: Remove potential NPE while resolving concrete indices from MetaData

Prevents a current edge case resolving concrete aliases or index names in cluster MetaData
that could potentialy lead to NullPointerException when the IndicesOptions don't allow
wildcard expansion and the method is called with aliasesOrIndices argument null or emtpy list.
This change adds a check for that and introduces randomized test that catches this.

Closes #10342
Closes #10339
@cbuescher I think this is the wrong import here? Should be hamcrest maybe?

You're right, sorry. Thankfully this seems to be an unused import, just needs to be deleted. Should I remove that with subsequent commit or should I do that with any other of my next PRs? #10148 is hopefully also ready to go in soon, what do you think?

don't worry just push a new commit to remove it. doesn't make sense to push it as part of #10148 cause it doesn't touch this class anymore.


time:
2015-04-01T08:40:48Z
class:
comments:
[DOCS] Update readme with direct link to the upgrade section

time:
2015-03-31T20:44:39Z
class:
src/main/java/org/elasticsearch/index/query/NestedQueryParser.java
src/test/java/org/elasticsearch/search/innerhits/InnerHitsTests.java
comments:
inner hits: Fix bug where parse error is thrown if a inner filter is used in a nested filter/query.

Closes #10308

time:
2015-03-31T20:03:04Z
class:
src/main/java/org/elasticsearch/gateway/GatewayService.java
comments:
Merge pull request #10349 from DavidWittman/typo-recovery-after-time

Fix typos for gateway.recover_after_time

time:
2015-03-31T19:00:08Z
class:
src/main/java/org/elasticsearch/gateway/GatewayService.java
comments:
Fix typos for gateway.recover_after_time

There were a few references to the setting
`gateway.recovery_after_time`, which should instead be
`gateway.recover_after_time`.

time:
2015-03-31T18:10:09Z
class:
src/main/java/org/elasticsearch/search/SearchService.java
comments:
Search contexts should not automatically be closed when scrolling.

Related to #9296

time:
2015-03-31T15:59:01Z
class:
comments:
update documentation with release 2.5.0

time:
2015-03-31T14:16:53Z
class:
src/main/java/org/elasticsearch/common/lucene/search/function/FunctionScoreQuery.java
src/main/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryParser.java
src/test/java/org/elasticsearch/search/functionscore/FunctionScoreTests.java
comments:
[function_score] apply min_score to sub query score if no function provided

For optimization pruposes a function score query with an empty function
will just result in the original sub query. However, sometimes one might
want to use function_score query to actually filter out docs within for example
bool clauses by using the min_score functionallity.
Therefore the sub query should only be used without wrapping inside
a function_score query if min_score was also not set.

closes #10253
closes #10326

time:
2015-03-31T13:42:07Z
class:
src/main/java/org/elasticsearch/indices/store/IndicesStore.java
src/test/java/org/elasticsearch/indices/store/IndicesStoreIntegrationTests.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
comments:
[store] make sure shard active request works even if shard is still in post recovery

When deleting a shard th node that deletes th shard first checks if all shard copies are
started on other nodes. A message is sent to each node tand each node checks locally for
STARTED or RELOCATED.
However, it might happen that the shard is still in state POST_RECOVERY, like this:

shard is relocating from node1 to node2
1. relocated shard on node2 goes in POST_RECOVERY and node2 sends shard started to master
2. master updates routing table and sends new cluster state to node1 and node2
3. node1 processes the cluster state and asks node2 if it has the active shard
  before node2 processes the new cluster state (which would cause it to set the shard to started)
4. node2 sends back it does not have the shard started and so node1 does not delete it

This can be avoided by waiting until cluster state that sets the shard to started is actually processed.

closes #10018

time:
2015-03-31T13:00:18Z
class:
src/test/java/org/elasticsearch/indices/cache/query/IndicesQueryCacheTests.java
comments:
Remove leftover println.

time:
2015-03-31T12:41:47Z
class:
src/main/java/org/elasticsearch/index/mapper/attachment/AttachmentMapper.java
comments:
Don't wrap exceptions in `MapperParsingException`

Some exceptions might not be serializable. It would be safer not to wrap them in a `MapperParsingException` but just create the `MapperParsingException`.

Related to #113.
(cherry picked from commit e58878c)
(cherry picked from commit a673185)

time:
2015-03-31T12:17:07Z
class:
src/main/java/org/elasticsearch/gateway/MetaDataStateFormat.java
src/main/java/org/elasticsearch/gateway/MetaStateService.java
src/main/java/org/elasticsearch/gateway/TransportNodesListGatewayStartedShards.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/main/java/org/elasticsearch/index/shard/ShardStateMetaData.java
src/test/java/org/elasticsearch/gateway/MetaDataStateFormatTest.java
src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
comments:
[STATE] Refactor state format to use incremental state IDs

Today there is a chance that the state version for shard, index or cluster
state goes backwards or is reset on a full restart etc. depending on
several factors not related to the state. To prevent any collisions
with already existing state files and to maintain write-once properties
this change introductes an incremental state ID instead of using the plain
state version. This also fixes a bug when the previous legacy state had a
greater version than the current state which causes an exception on node
startup or if left-over files are present.

Closes #10316

time:
2015-03-31T12:05:33Z
class:
src/main/java/org/elasticsearch/action/search/type/TransportSearchHelper.java
src/test/java/org/elasticsearch/search/scroll/SearchScrollTests.java
comments:
[TEST] fix SearchScrollTests, scroll doesn't support searchType count

time:
2015-03-31T11:24:52Z
class:
src/main/java/org/elasticsearch/script/ScriptModes.java
src/main/java/org/elasticsearch/script/ScriptService.java
src/test/java/org/elasticsearch/env/NodeEnvironmentTests.java
src/test/java/org/elasticsearch/script/NativeScriptTests.java
src/test/java/org/elasticsearch/script/ScriptModesTests.java
src/test/java/org/elasticsearch/script/ScriptServiceTests.java
src/test/java/org/elasticsearch/search/functionscore/FunctionScoreBackwardCompatibilityTests.java
comments:
Scripting: remove support for script.disable_dynamic setting

Now that fine-grained script settings are supported (#10116) we can remove support for the script.disable_dynamic setting.

Same result as `script.disable_dynamic: false` can be obtained as follows:

```
script.inline: on
script.indexed: on
```
An exception is thrown at startup when the old setting is set, so we make sure we tell users they have to change it rather than ignoring the setting.

Closes #10286

time:
2015-03-31T10:28:02Z
class:
src/test/java/org/elasticsearch/indices/cache/query/IndicesQueryCacheTests.java
comments:
IndicesQueryCacheTests: Fix test bug.

The query cache is disabled on dfs_query_then_fetch so we need to enforce
query_then_fetch instead of relying on the randomized search type set by the
test framework.
system.out is a leftover no?


time:
2015-03-31T09:36:38Z
class:
src/main/java/org/elasticsearch/action/search/SearchType.java
src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
src/main/java/org/elasticsearch/action/search/type/TransportSearchTypeAction.java
src/main/java/org/elasticsearch/common/lucene/Lucene.java
src/main/java/org/elasticsearch/indices/cache/query/IndicesQueryCache.java
src/main/java/org/elasticsearch/search/SearchService.java
src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHits.java
src/main/java/org/elasticsearch/search/query/QueryPhase.java
src/main/java/org/elasticsearch/search/query/QuerySearchResult.java
src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggester.java
src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
src/test/java/org/elasticsearch/benchmark/breaker/CircuitBreakerBenchmark.java
src/test/java/org/elasticsearch/benchmark/search/aggregations/CardinalityAggregationSearchBenchmark.java
src/test/java/org/elasticsearch/benchmark/search/aggregations/GlobalOrdinalsBenchmark.java
src/test/java/org/elasticsearch/benchmark/search/aggregations/PercentilesAggregationSearchBenchmark.java
src/test/java/org/elasticsearch/benchmark/search/aggregations/QueryFilterAggregationSearchBenchmark.java
src/test/java/org/elasticsearch/benchmark/search/aggregations/SubAggregationSearchCollectModeBenchmark.java
src/test/java/org/elasticsearch/benchmark/search/aggregations/TermsAggregationSearchAndIndexingBenchmark.java
src/test/java/org/elasticsearch/benchmark/search/aggregations/TermsAggregationSearchBenchmark.java
src/test/java/org/elasticsearch/benchmark/search/aggregations/TimeDataHistogramAggregationBenchmark.java
src/test/java/org/elasticsearch/benchmark/search/geo/GeoDistanceSearchBenchmark.java
src/test/java/org/elasticsearch/index/fielddata/FieldDataFilterIntegrationTests.java
src/test/java/org/elasticsearch/indices/cache/query/IndicesQueryCacheTests.java
src/test/java/org/elasticsearch/indices/stats/IndexStatsTests.java
src/test/java/org/elasticsearch/recovery/RecoveryWhileUnderLoadTests.java
src/test/java/org/elasticsearch/recovery/RelocationTests.java
src/test/java/org/elasticsearch/search/CountSearchTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/MinDocCountTests.java
src/test/java/org/elasticsearch/search/geo/GeoDistanceTests.java
src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java
src/test/java/org/elasticsearch/search/scan/SearchScanTests.java
src/test/java/org/elasticsearch/search/scroll/SearchScrollTests.java
src/test/java/org/elasticsearch/search/suggest/SuggestSearchTests.java
comments:
Merge pull request #9296 from jpountz/enhancement/remove_count_search_type

Search: Merge `search_type=count` and `size=0`.Close #9226

time:
2015-03-31T09:31:49Z
class:
src/main/java/org/elasticsearch/action/search/SearchType.java
src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
src/main/java/org/elasticsearch/action/search/type/TransportSearchTypeAction.java
src/main/java/org/elasticsearch/common/lucene/Lucene.java
src/main/java/org/elasticsearch/indices/cache/query/IndicesQueryCache.java
src/main/java/org/elasticsearch/search/SearchService.java
src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHits.java
src/main/java/org/elasticsearch/search/query/QueryPhase.java
src/main/java/org/elasticsearch/search/query/QuerySearchResult.java
src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggester.java
src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
src/test/java/org/elasticsearch/benchmark/breaker/CircuitBreakerBenchmark.java
src/test/java/org/elasticsearch/benchmark/search/aggregations/CardinalityAggregationSearchBenchmark.java
src/test/java/org/elasticsearch/benchmark/search/aggregations/GlobalOrdinalsBenchmark.java
src/test/java/org/elasticsearch/benchmark/search/aggregations/PercentilesAggregationSearchBenchmark.java
src/test/java/org/elasticsearch/benchmark/search/aggregations/QueryFilterAggregationSearchBenchmark.java
src/test/java/org/elasticsearch/benchmark/search/aggregations/SubAggregationSearchCollectModeBenchmark.java
src/test/java/org/elasticsearch/benchmark/search/aggregations/TermsAggregationSearchAndIndexingBenchmark.java
src/test/java/org/elasticsearch/benchmark/search/aggregations/TermsAggregationSearchBenchmark.java
src/test/java/org/elasticsearch/benchmark/search/aggregations/TimeDataHistogramAggregationBenchmark.java
src/test/java/org/elasticsearch/benchmark/search/geo/GeoDistanceSearchBenchmark.java
src/test/java/org/elasticsearch/index/fielddata/FieldDataFilterIntegrationTests.java
src/test/java/org/elasticsearch/indices/cache/query/IndicesQueryCacheTests.java
src/test/java/org/elasticsearch/indices/stats/IndexStatsTests.java
src/test/java/org/elasticsearch/recovery/RecoveryWhileUnderLoadTests.java
src/test/java/org/elasticsearch/recovery/RelocationTests.java
src/test/java/org/elasticsearch/search/CountSearchTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/MinDocCountTests.java
src/test/java/org/elasticsearch/search/geo/GeoDistanceTests.java
src/test/java/org/elasticsearch/search/preference/SearchPreferenceTests.java
src/test/java/org/elasticsearch/search/scan/SearchScanTests.java
src/test/java/org/elasticsearch/search/scroll/SearchScrollTests.java
src/test/java/org/elasticsearch/search/suggest/SuggestSearchTests.java
comments:
Search: Remove the `count` search type.

This commit brings the benefits of the `count` search type to search requests
that have a `size` of 0:
 - a single round-trip to shards (no fetch phase)
 - ability to use the query cache

Since `count` now provides no benefits over `query_then_fetch`, it has been
deprecated.

Close #7630

time:
2015-03-31T09:31:49Z
class:
src/main/java/org/elasticsearch/node/Node.java
src/main/java/org/elasticsearch/search/DefaultSearchServiceModule.java
src/main/java/org/elasticsearch/search/SearchModule.java
src/main/java/org/elasticsearch/search/SearchService.java
src/main/java/org/elasticsearch/search/SearchServiceModule.java
src/test/java/org/elasticsearch/search/scroll/SearchScrollWithFailingNodesTests.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
src/test/java/org/elasticsearch/test/ElasticsearchTestCase.java
src/test/java/org/elasticsearch/test/InternalTestCluster.java
src/test/java/org/elasticsearch/test/search/MockSearchService.java
src/test/java/org/elasticsearch/test/search/MockSearchServiceModule.java
comments:
Tests: Assert that we do not leak SearchContexts.

Even if there is a background thread that periodically closes search contexts
that seem unused (every minute by default), it is important to close search
contexts as soon as possible in order to not keep unnecessary open files or
to prevent segments from being deleted.

This check would help ensure that refactorings of the SearchContext management
like #9296 are correct.

time:
2015-03-31T07:26:40Z
class:
comments:
Update scripting.asciidoc

change description to better fit the flag name

time:
2015-03-31T07:25:15Z
class:
comments:
Update prefix-filter.asciidoc

text said phrase instead of prefix, probably due to copy-paste

time:
2015-03-30T21:39:11Z
class:
src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java
src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java
src/main/java/org/elasticsearch/common/settings/ImmutableSettings.java
src/main/java/org/elasticsearch/index/settings/IndexSettingsService.java
src/main/java/org/elasticsearch/snapshots/RestoreService.java
src/test/java/org/elasticsearch/common/settings/ImmutableSettingsTests.java
src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreTests.java
comments:
Automatically add "index." prefix to the settings are changed on restore if the prefix is missing

Closes #10133

time:
2015-03-30T21:39:41Z
class:
src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
fix test concurrency bug

time:
2015-03-30T17:07:21Z
class:
comments:
Add ability to launch bootstrapped ES using maven

This adds the exec-maven-plugin that allows a developer to run:

```
mvn exec:exec
```

To launch the `Bootstrap` process similar to the way that a Java IDE
would. All the logs go to logs/elasticsearch.log (or wherever
configured)
This `exec` phase does not exist in maven AFAIK. 
I think we should remove this line, right? @dakrone WDYT? 

@dadoonet the `exec` phase is part of this plugin (exec-maven-plugin)

It's the `goal`. A Maven plugin can not define a new phase.


time:
2015-03-30T16:41:57Z
class:
src/main/java/org/elasticsearch/transport/netty/NettyTransportChannel.java
comments:
Netty: add getter for channel in NettyTransportChannel

Adds a getter for the actual netty channel in NettyTransportChannel. The
channel can be used by plugins that need access into netty when processing
requests.

time:
2015-03-30T16:01:44Z
class:
src/test/java/org/elasticsearch/common/settings/SettingsFilterTests.java
src/test/java/org/elasticsearch/rest/BytesRestResponseTests.java
src/test/java/org/elasticsearch/rest/HeadersAndContextCopyClientTests.java
src/test/java/org/elasticsearch/rest/RestFilterChainTests.java
src/test/java/org/elasticsearch/test/rest/FakeRestRequest.java
comments:
[TEST] move FakeRestRequest to org.elasticsearch.test.rest

FakeRestRequest is used by a few tests and can also be leveraged by
tests outside of elasticsearch. Moving the package will mean the class
gets exported as part of the test jar.

time:
2015-03-30T14:25:55Z
class:
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
Core: deletions (alone) should also force a refresh when version map is using too much RAM

We already force a refresh in index/create ops, to clear version map
when it's using too much RAM, but we were failing to do this for
deletes, so an app that does tons of deletes with no indexing, and has
set refresh_interval to -1, would have version map using unbounded
RAM.

Closes #10312

time:
2015-03-30T14:12:37Z
class:
src/main/java/org/elasticsearch/indices/recovery/RecoveryState.java
src/test/java/org/elasticsearch/gateway/RecoveryBackwardsCompatibilityTests.java
comments:
Recovery: RecoveryState.File.toXContent reports file length as recovered bytes

Closes #10310

time:
2015-03-30T13:24:00Z
class:
src/main/java/org/elasticsearch/cluster/action/index/NodeMappingRefreshAction.java
comments:
Internal: don't try to send a mapping refresh if there is no master

After processing mapping updates from the master, we compare the resulting binary representation of them and compare it the one cluster state has. If different, we send a refresh mapping request to master, asking it to reparse the mapping and serialize them again. This mechanism is used to update the mapping after a format change caused by a version upgrade.

The very same process can also be triggered when an old master leaves the cluster, triggering a local cluster state update. If that update contains old mapping format, the local node will again signal the need to refresh, but this time there is no master to accept the request. Instead of failing (which we now do because of #10283, we should just skip the notification and wait for the next elected master to publish a new mapping (triggering another refresh if needed).

Closes #10311

time:
2015-03-30T13:00:50Z
class:
src/main/java/org/elasticsearch/index/mapper/attachment/AttachmentMapper.java
comments:
Cleanup: Remove unsafe field in BytesStreamInput

Related to https://github.com/elastic/elasticsearch/pull/10157

BytesStreamInput does not support anymore `BytesStreamInput(byte[], boolean)`

Closes #120.

time:
2015-03-30T12:53:58Z
class:
comments:
Update owner to elastic

Fix typo in previous commit
(cherry picked from commit 5303bc0)
(cherry picked from commit d3dab9b)
(cherry picked from commit 3ace2bb)

time:
2015-03-30T12:50:18Z
class:
src/main/java/org/elasticsearch/plugin/mapper/attachments/tika/LocaleChecker.java
comments:
parse java.specification.version not java.version, so that it is robust

time:
2015-03-30T12:16:58Z
class:
src/main/java/org/elasticsearch/node/Node.java
src/main/java/org/elasticsearch/search/DefaultSearchServiceModule.java
src/main/java/org/elasticsearch/search/SearchModule.java
src/main/java/org/elasticsearch/search/SearchService.java
src/main/java/org/elasticsearch/search/SearchServiceModule.java
src/test/java/org/elasticsearch/search/scroll/SearchScrollWithFailingNodesTests.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
src/test/java/org/elasticsearch/test/ElasticsearchTestCase.java
src/test/java/org/elasticsearch/test/InternalTestCluster.java
src/test/java/org/elasticsearch/test/search/MockSearchService.java
src/test/java/org/elasticsearch/test/search/MockSearchServiceModule.java
comments:
Merge pull request #9595 from jpountz/test/context_closed

Tests: Assert that we do not leak SearchContexts.Close #9595

time:
2015-03-30T09:36:10Z
class:
comments:
Update owner to elastic

(cherry picked from commit c4d60ed)
(cherry picked from commit 450d088)

time:
2015-03-30T09:35:54Z
class:
comments:
Move parent after artifact coordinates

time:
2015-03-30T09:32:41Z
class:
comments:
[DOCS] Fix multi percolate response sample in percolate.asciidoc

time:
2015-03-30T08:39:08Z
class:
src/main/java/org/elasticsearch/node/Node.java
src/main/java/org/elasticsearch/search/DefaultSearchServiceModule.java
src/main/java/org/elasticsearch/search/SearchModule.java
src/main/java/org/elasticsearch/search/SearchService.java
src/main/java/org/elasticsearch/search/SearchServiceModule.java
src/test/java/org/elasticsearch/search/scroll/SearchScrollWithFailingNodesTests.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
src/test/java/org/elasticsearch/test/ElasticsearchTestCase.java
src/test/java/org/elasticsearch/test/InternalTestCluster.java
src/test/java/org/elasticsearch/test/search/MockSearchService.java
src/test/java/org/elasticsearch/test/search/MockSearchServiceModule.java
comments:
Tests: Assert that we do not leak SearchContexts.

Even if there is a background thread that periodically closes search contexts
that seem unused (every minute by default), it is important to close search
contexts as soon as possible in order to not keep unnecessary open files or
to prevent segments from being deleted.

This check would help ensure that refactorings of the SearchContext management
like #9296 are correct.

time:
2015-03-30T08:08:03Z
class:
src/main/java/org/elasticsearch/action/percolate/MultiPercolateRequest.java
comments:
Merge pull request #10307 from obourgain/fix_parsing_multipercolate

Fix wrong use of currentFieldName outside of a parsing loop.Close #10307

time:
2015-03-29T16:35:21Z
class:
src/main/java/org/elasticsearch/action/percolate/MultiPercolateRequest.java
comments:
fix wrong use of currentFieldName outside of a parsing loop

time:
2015-03-29T09:49:36Z
class:
src/test/java/org/elasticsearch/common/geo/ShapeBuilderTests.java
src/test/java/org/elasticsearch/index/search/geo/GeoPointParsingTests.java
comments:
[TEST] resolved compiler warnings in ShapeBuilderTests and GeoPointParsingTests

time:
2015-03-29T09:43:56Z
class:
src/main/java/org/elasticsearch/common/compress/Compressor.java
src/main/java/org/elasticsearch/common/io/UTF8StreamWriter.java
src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
src/main/java/org/elasticsearch/index/analysis/KeepWordFilterFactory.java
src/main/java/org/elasticsearch/index/analysis/LengthTokenFilterFactory.java
src/main/java/org/elasticsearch/index/analysis/TrimTokenFilterFactory.java
src/main/java/org/elasticsearch/indices/analysis/PreBuiltTokenFilters.java
src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
src/main/java/org/elasticsearch/script/ScriptService.java
src/test/java/org/elasticsearch/cluster/metadata/MetaDataTests.java
src/test/java/org/elasticsearch/common/geo/ShapeBuilderTests.java
src/test/java/org/elasticsearch/index/query/TemplateQueryTest.java
src/test/java/org/elasticsearch/index/search/geo/GeoPointParsingTests.java
comments:
Fix errors reported by error-prone

I compiled elasticsearch with error-prone
(https://github.com/google/error-prone). This commit fixes the 13
errors reported by the tool.

time:
2015-03-29T09:28:50Z
class:
comments:
[DOCS] added table with supported scripting languages to scripting docs

time:
2015-03-28T15:55:00Z
class:
comments:
update documentation with release 2.5.0

time:
2015-03-28T15:48:43Z
class:
comments:
Move to elastic owner

(cherry picked from commit 3d3ce33)
(cherry picked from commit c59f9ce)

time:
2015-03-28T15:48:30Z
class:
comments:
Move parent after artifact coordinates

time:
2015-03-28T13:34:03Z
class:
comments:
update documentation with release 2.5.0

time:
2015-03-28T13:09:46Z
class:
comments:
Update owner to elastic

(cherry picked from commit 283b92f)
(cherry picked from commit 49445b3)

time:
2015-03-28T13:09:16Z
class:
comments:
Move parent after artifact coordinates

time:
2015-03-28T10:43:29Z
class:
comments:
Create branch es-1.5

time:
2015-03-28T10:36:44Z
class:
comments:
Move owner to elastic

(cherry picked from commit d50057a)

time:
2015-03-28T10:36:26Z
class:
comments:
Move parent after artifact coordinates

time:
2015-03-28T07:53:11Z
class:
src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
src/main/java/org/elasticsearch/action/update/UpdateHelper.java
src/main/java/org/elasticsearch/action/update/UpdateRequest.java
src/main/java/org/elasticsearch/rest/action/update/RestUpdateAction.java
comments:
Make sure that the parent option on the update request only is delgated to upsert index request.

Closes #4538

time:
2015-03-28T07:53:11Z
class:
src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
src/main/java/org/elasticsearch/action/update/UpdateRequest.java
src/main/java/org/elasticsearch/action/update/UpdateRequestBuilder.java
src/main/java/org/elasticsearch/rest/action/update/RestUpdateAction.java
src/test/java/org/elasticsearch/document/BulkTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/ChildrenTests.java
comments:
Reverted commit: 20f7be3

time:
2015-03-28T07:52:39Z
class:
src/main/java/org/elasticsearch/search/aggregations/bucket/children/ParentToChildrenAggregator.java
comments:
Added lost comment

time:
2015-03-28T07:43:40Z
class:
src/main/java/org/elasticsearch/search/aggregations/bucket/children/ParentToChildrenAggregator.java
src/test/java/org/elasticsearch/search/aggregations/bucket/ChildrenTests.java
comments:
aggs: Fix 2 bug in `children` agg

1) multiple nested children aggs result in a NPE
2) fixed a counting bug where the same readers where post collected twice

Closes #10158

time:
2015-03-28T07:02:30Z
class:
src/main/java/org/elasticsearch/index/query/support/BaseInnerHitBuilder.java
src/main/java/org/elasticsearch/index/query/support/InnerHitsQueryParserHelper.java
src/main/java/org/elasticsearch/search/fetch/FetchPhase.java
src/test/java/org/elasticsearch/search/innerhits/InnerHitsTests.java
comments:
inner_hits: Fix nested stored field support.

This also fixes a NPE when the nested part has been filtered out of the _source, because of _source filtering.

Closes #9766

time:
2015-03-27T16:35:38Z
class:
src/test/java/org/elasticsearch/index/mapper/update/UpdateMappingOnClusterTests.java
comments:
[TEST] muste test and add issue number

time:
2015-03-27T15:58:24Z
class:
src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java
src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
src/test/java/org/elasticsearch/indices/IndicesLifecycleListenerTests.java
comments:
Fail shard when index service/mappings fails to instantiate
When the index service (which holds shards) fails to be created as a result of a shard being allocated on a node, we should fail the relevant shard, otherwise, it will remain stuck.
Same goes when there is a failure to process updated mappings form the master.

Note, both failures typically happen when the node is misconfigured (i.e. missing plugins, ...), since they get created and processed on the master node before being published.
closes #10283

time:
2015-03-27T14:04:42Z
class:
src/test/java/org/elasticsearch/test/test/GlobalScopeClusterTests.java
comments:
[TEST] remove GlobalScopeClusterTests

We removed the global ClusterScope a while ago, its related test can be removed too.

time:
2015-03-27T08:50:11Z
class:
src/main/java/org/elasticsearch/indices/analysis/HunspellService.java
src/test/java/org/elasticsearch/indices/analyze/HunspellServiceTests.java
comments:
Fix thread leak in Hunspell service

An unchecked exception might be thrown when instantiating the HunspellService, leading to thread leaks in tests.

Closes #9849

time:
2015-03-27T07:43:40Z
class:
src/main/java/org/elasticsearch/common/util/BigLongArray.java
comments:
Fix BigLongArray.fill to account for an empty range

time:
2015-03-27T06:58:13Z
class:
comments:
Updated version in docs to use 1.5.0

time:
2015-03-27T05:42:35Z
class:
src/main/java/org/elasticsearch/index/mapper/core/AbstractFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/core/BooleanFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/geo/GeoPointFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/geo/GeoShapeFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/AllFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/FieldNamesFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/IdFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/IndexFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/ParentFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/RoutingFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/SizeFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/SourceFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/TTLFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/TimestampFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/TypeFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/UidFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/VersionFieldMapper.java
src/test/java/org/elasticsearch/index/fielddata/AbstractFieldDataTests.java
src/test/java/org/elasticsearch/index/fielddata/AbstractStringFieldDataTests.java
src/test/java/org/elasticsearch/index/fielddata/BinaryDVFieldDataTests.java
src/test/java/org/elasticsearch/index/fielddata/IndexFieldDataServiceTests.java
src/test/java/org/elasticsearch/index/fielddata/SortedSetDVStringFieldDataTests.java
src/test/java/org/elasticsearch/index/mapper/all/AllMapperOnCusterTests.java
src/test/java/org/elasticsearch/index/mapper/all/SimpleAllMapperTests.java
src/test/java/org/elasticsearch/index/mapper/copyto/CopyToMapperTests.java
src/test/java/org/elasticsearch/index/mapper/date/SimpleDateMappingTests.java
src/test/java/org/elasticsearch/index/mapper/ip/SimpleIpMappingTests.java
src/test/java/org/elasticsearch/index/mapper/string/SimpleStringMappingTests.java
src/test/java/org/elasticsearch/index/mapper/timestamp/TimestampMappingTests.java
src/test/java/org/elasticsearch/index/search/FieldDataTermsFilterTests.java
src/test/java/org/elasticsearch/index/search/child/AbstractChildTests.java
src/test/java/org/elasticsearch/indices/memory/breaker/RandomExceptionCircuitBreakerTests.java
src/test/java/org/elasticsearch/percolator/PercolatorTests.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
src/test/java/org/elasticsearch/test/hamcrest/ElasticsearchAssertions.java
src/test/java/org/elasticsearch/timestamp/SimpleTimestampTests.java
comments:
Core: Enable doc values by default, when appropriate

Doc values significantly reduced heap usage, which results in faster
GCs. This change makes the default for doc values dynamic: any
field that is indexed but not analyzed now has doc values. This only
affects fields on indexes created with 2.0+.

closes #8312
closes #10209

time:
2015-03-26T23:51:19Z
class:
src/test/java/org/elasticsearch/index/mapper/dynamic/DynamicMappingTests.java
comments:
[TEST] wait for mapping, cluster state might not be up to date yet

time:
2015-03-26T20:06:00Z
class:
src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java
src/main/java/org/elasticsearch/index/mapper/MapperParsingException.java
src/main/java/org/elasticsearch/index/mapper/StrictDynamicMappingException.java
src/main/java/org/elasticsearch/index/mapper/core/AbstractFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/IdFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/object/ObjectMapper.java
src/main/java/org/elasticsearch/index/mapper/object/RootObjectMapper.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/test/java/org/elasticsearch/index/mapper/dynamic/DynamicMappingTests.java
comments:
[mappings] update dynamic fields in mapping on master even if parsing fails for the rest of doc

The local DocumentMapper is updated while parsing and dynamic fields are added before
parsing has finished. If parsing fails after a dynamic field has been added already
then the field was not added to the cluster state but was present in the local mapper of this
node. New documents with the same field would not necessarily cause an update either and
after restarting the node the mapping for these fields were lost. Instead the new fields
should always be updated.

closes #9851
closes #9874

time:
2015-03-26T19:22:20Z
class:
comments:
[DOCS] removed coming tags from scripting docs

time:
2015-03-26T18:56:55Z
class:
src/test/java/org/elasticsearch/search/functionscore/FunctionScoreBackwardCompatibilityTests.java
src/test/java/org/elasticsearch/test/ElasticsearchBackwardsCompatIntegrationTest.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
src/test/java/org/elasticsearch/test/InternalTestCluster.java
comments:
[TEST] enable inline scripts on demand in bw comp tests

We currently have a single bw comp test (FunctionScoreBackwardCompatibilityTests) that requires inline scripts on.
After introducing fine-grained script settings, we moved the internal cluster to use the newer settings, but they are not supported by older nodes started as part of the bw comp tests. Moved script settings out of the default settings, so they won't be part of the ordinary settings when running bw comp tests.
Added logic in FunctionScoreBackwardCompatibilityTests to enable dynamic scripts using the proper setting, depending on the version of the node.

time:
2015-03-26T18:56:55Z
class:
comments:
[TEST] remove needless script settings from create-bwc-index script

dynamic scripts are not needed here, can be disabled.

time:
2015-03-26T18:56:55Z
class:
comments:
[TEST] remove needless script settings from upgrade tests script

dynamic scripts are not needed in our upgrade tests, can be removed.

time:
2015-03-26T18:56:55Z
class:
src/main/java/org/elasticsearch/action/update/UpdateHelper.java
src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java
src/main/java/org/elasticsearch/index/query/ScriptFilterParser.java
src/main/java/org/elasticsearch/index/query/TemplateQueryParser.java
src/main/java/org/elasticsearch/index/query/functionscore/script/ScriptScoreFunctionParser.java
src/main/java/org/elasticsearch/script/ScriptContext.java
src/main/java/org/elasticsearch/script/ScriptMode.java
src/main/java/org/elasticsearch/script/ScriptModes.java
src/main/java/org/elasticsearch/script/ScriptService.java
src/main/java/org/elasticsearch/search/SearchService.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/InternalScriptedMetric.java
src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregator.java
src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceParser.java
src/main/java/org/elasticsearch/search/fetch/script/ScriptFieldsParseElement.java
src/main/java/org/elasticsearch/search/sort/ScriptSortParser.java
src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestParser.java
src/test/java/org/elasticsearch/script/IndexedScriptTests.java
src/test/java/org/elasticsearch/script/NativeScriptTests.java
src/test/java/org/elasticsearch/script/OnDiskScriptTests.java
src/test/java/org/elasticsearch/script/SandboxDisabledTests.java
src/test/java/org/elasticsearch/script/ScriptModesTests.java
src/test/java/org/elasticsearch/script/ScriptServiceTests.java
src/test/java/org/elasticsearch/test/ElasticsearchSingleNodeTest.java
src/test/java/org/elasticsearch/test/InternalTestCluster.java
comments:
Scripting: add support for fine-grained settings

Allow to on/off scripting based on their source (where they get loaded from), the  operation that executes them and their language.

The settings cover the following combinations:

- mode: on, off, sandbox
- source: indexed, dynamic, file
- engine: groovy, expressions, mustache, etc
- operation: update, search, aggs, mapping

The following settings are supported for every engine:

script.engine.groovy.indexed.update:    sandbox/on/off
script.engine.groovy.indexed.search:    sandbox/on/off
script.engine.groovy.indexed.aggs:      sandbox/on/off
script.engine.groovy.indexed.mapping:   sandbox/on/off
script.engine.groovy.dynamic.update:    sandbox/on/off
script.engine.groovy.dynamic.search:    sandbox/on/off
script.engine.groovy.dynamic.aggs:      sandbox/on/off
script.engine.groovy.dynamic.mapping:   sandbox/on/off
script.engine.groovy.file.update:       sandbox/on/off
script.engine.groovy.file.search:       sandbox/on/off
script.engine.groovy.file.aggs:         sandbox/on/off
script.engine.groovy.file.mapping:      sandbox/on/off

For ease of use, the following more generic settings are supported too:

script.indexed: sandbox/on/off
script.dynamic: sandbox/on/off
script.file:    sandbox/on/off

script.update:  sandbox/on/off
script.search:  sandbox/on/off
script.aggs:    sandbox/on/off
script.mapping: sandbox/on/off

These will be used to calculate the more specific settings, using the stricter setting of each combination. Operation based settings have precedence over conflicting source based ones.

Note that the `mustache` engine is affected by generic settings applied to any language, while native scripts aren't as they are static by definition.

Also, the previous `script.disable_dynamic` setting can now be deprecated.

Closes #6418
Closes #10116
Closes #10274

time:
2015-03-26T18:09:04Z
class:
src/main/java/org/elasticsearch/plugin/python/PythonPlugin.java
comments:
Update plugin description

Updates wording to (hopefully) better reflect what it does and removes reference to Javascript.

time:
2015-03-26T14:12:22Z
class:
src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityTests.java
comments:
Tests: improve back compat tests by adding delete-by-query in the transaction log on upgrade

Closes #10266

time:
2015-03-25T21:27:24Z
class:
src/main/java/org/elasticsearch/index/mapper/internal/FieldNamesFieldMapper.java
src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityTests.java
src/test/java/org/elasticsearch/index/mapper/internal/FieldNamesFieldMapperTests.java
comments:
Mappings: Fix _field_names to be disabled on pre 1.3.0 indexes

In #9893, an enabled flag was added for _field_names.  However,
backcompat for indexes created before 1.3.0 (when _field_names
was added) was lost. This change corrects the mapper
to always be disabled when used with older indexes that
cannot have _field_names.

closes #10268

time:
2015-03-25T14:48:59Z
class:
comments:
update documentation with release 2.5.0

time:
2015-03-25T14:41:08Z
class:
comments:
Move to elastic owner

(cherry picked from commit d745edb)
(cherry picked from commit 8231854)

time:
2015-03-25T14:40:58Z
class:
comments:
Move parent after artifact coordinates

time:
2015-03-25T14:37:29Z
class:
src/main/java/org/elasticsearch/cloud/gce/GceComputeServiceImpl.java
src/test/java/org/elasticsearch/discovery/gce/GceComputeEngineTest.java
src/test/java/org/elasticsearch/discovery/gce/mock/GceComputeServiceZeroNodeMock.java
comments:
Discovery NPE when a zone has 0 nodes in it

Closes #43.
(cherry picked from commit b028910)
(cherry picked from commit fa3e157)

time:
2015-03-25T11:00:38Z
class:
src/main/java/org/elasticsearch/rest/action/cat/RestPluginsAction.java
src/main/java/org/elasticsearch/rest/action/cat/RestSegmentsAction.java
comments:
Cat api: added node id column to _cat/plugins response

relates to #10226

time:
2015-03-25T11:00:15Z
class:
src/main/java/org/elasticsearch/rest/action/cat/RestSegmentsAction.java
comments:
Cat api: added node id column to _cat/segments response

Relates to #10226

time:
2015-03-25T10:59:35Z
class:
src/main/java/org/elasticsearch/rest/action/cat/RestShardsAction.java
comments:
Cat api: added node id column to _cat/shards response

closes #10226

time:
2015-03-25T09:58:59Z
class:
comments:
[DOCS] Added explicit "lang" field to documentation of script score definition

time:
2015-03-25T09:35:48Z
class:
comments:
update documentation with release 2.5.0

time:
2015-03-25T09:06:05Z
class:
src/test/java/org/elasticsearch/cloud/aws/AmazonS3Wrapper.java
comments:
Update aws-sdk-java to 1.9.23

Release notes:

* [1.9.23](https://aws.amazon.com/releasenotes/Java/0061646886197506)
* [1.9.22](https://aws.amazon.com/releasenotes/Java/9983269688843537)
* [1.9.21](https://aws.amazon.com/releasenotes/Java/0068314282259743)
* [1.9.20.1](https://aws.amazon.com/releasenotes/Java/1468424988909152)
* [1.9.20](https://aws.amazon.com/releasenotes/Java/4095479451567110)
* [1.9.19](https://aws.amazon.com/releasenotes/Java/7152067748916749)
* [1.9.18](https://aws.amazon.com/releasenotes/Java/8255923333358616)
* [1.9.17](https://aws.amazon.com/releasenotes/Java/7976814583460560)
* [1.9.16](https://aws.amazon.com/releasenotes/Java/7930704610010512)
* [1.9.15](https://aws.amazon.com/releasenotes/Java/7196148869312092)
* [1.9.14](https://aws.amazon.com/releasenotes/Java/5550164873229724)
* [1.9.13](https://aws.amazon.com/releasenotes/Java/4588838060473154)
* [1.9.12](https://aws.amazon.com/releasenotes/Java/4184046784243318)
* [1.9.11](https://aws.amazon.com/releasenotes/Java/4181470878749498)
* [1.9.10](https://aws.amazon.com/releasenotes/Java/7263787800932935)
* [1.9.9](https://aws.amazon.com/releasenotes/Java/1369906126177804)

(cherry picked from commit 16a2f39)
(cherry picked from commit 5e13c68)
(cherry picked from commit 471f755)

time:
2015-03-25T08:57:24Z
class:
comments:
Move to elastic owner

(cherry picked from commit ec9d00f)
(cherry picked from commit 2a4642e)

time:
2015-03-25T08:56:34Z
class:
comments:
Move parent after artifact coordinates

time:
2015-03-25T04:48:05Z
class:
comments:
Fix REST test delete/42_missing_parent to catch a RoutingMissingException

Related to #10136

time:
2015-03-24T17:59:04Z
class:
comments:
update documentation with release 2.5.0

time:
2015-03-24T17:52:58Z
class:
comments:
Move to elastic owner

time:
2015-03-24T17:52:15Z
class:
comments:
update documentation with release 2.5.0

time:
2015-03-24T17:52:15Z
class:
comments:
Move parent bloc after artifact coordinates

time:
2015-03-24T17:45:30Z
class:
comments:
Move to elastic owner

(cherry picked from commit 01acf2f)
(cherry picked from commit 5c93c2b)

time:
2015-03-24T17:43:33Z
class:
comments:
Move parent bloc after artifact coordinates

time:
2015-03-24T17:39:37Z
class:
comments:
update documentation with release 2.5.0

time:
2015-03-24T17:34:02Z
class:
comments:
Move to elastic owner

time:
2015-03-24T17:31:36Z
class:
comments:
Move parent bloc after artifact coordinates

time:
2015-03-24T17:17:46Z
class:
comments:
update documentation with release 2.5.0

time:
2015-03-24T17:13:19Z
class:
comments:
Remove missed references to delete mapping API

See #10231

time:
2015-03-24T17:12:52Z
class:
comments:
Update to elastic owner

We moved elasticsearch to elastic
(cherry picked from commit d71102b)
(cherry picked from commit fca681c)

time:
2015-03-24T17:09:35Z
class:
comments:
Move parent after project artifactid

time:
2015-03-24T16:52:51Z
class:
comments:
Update to elastic owner

We moved elasticsearch to elastic
(cherry picked from commit 500f265)
(cherry picked from commit 583c5b2)

time:
2015-03-24T16:46:02Z
class:
src/main/java/org/elasticsearch/action/ActionModule.java
src/main/java/org/elasticsearch/action/admin/indices/mapping/delete/DeleteMappingAction.java
src/main/java/org/elasticsearch/action/admin/indices/mapping/delete/DeleteMappingClusterStateUpdateRequest.java
src/main/java/org/elasticsearch/action/admin/indices/mapping/delete/DeleteMappingRequest.java
src/main/java/org/elasticsearch/action/admin/indices/mapping/delete/DeleteMappingRequestBuilder.java
src/main/java/org/elasticsearch/action/admin/indices/mapping/delete/DeleteMappingResponse.java
src/main/java/org/elasticsearch/action/admin/indices/mapping/delete/TransportDeleteMappingAction.java
src/main/java/org/elasticsearch/client/IndicesAdminClient.java
src/main/java/org/elasticsearch/client/Requests.java
src/main/java/org/elasticsearch/client/support/AbstractIndicesAdminClient.java
src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java
src/main/java/org/elasticsearch/rest/action/RestActionModule.java
src/main/java/org/elasticsearch/rest/action/admin/indices/mapping/delete/RestDeleteMappingAction.java
src/main/java/org/elasticsearch/river/RiversService.java
src/test/java/org/elasticsearch/action/IndicesRequestTests.java
src/test/java/org/elasticsearch/cluster/BlockClusterStatsTests.java
src/test/java/org/elasticsearch/cluster/ack/AckTests.java
src/test/java/org/elasticsearch/indices/IndicesOptionsIntegrationTests.java
src/test/java/org/elasticsearch/indices/mapping/SimpleDeleteMappingTests.java
src/test/java/org/elasticsearch/operateAllIndices/DestructiveOperationsIntegrationTests.java
src/test/java/org/elasticsearch/percolator/PercolatorTests.java
comments:
Mappings: Remove delete mapping API

Deleting a type from an index is inherently dangerous because
the type can be recreated with new mappings which may conflict
with existing segments still using the old mappings. This
removes the ability to delete a type (similar to how deleting
fields within a type is not allowed, for the same reason).

closes #8877
closes #10231

time:
2015-03-24T16:40:07Z
class:
comments:
update documentation with release 2.5.0

time:
2015-03-24T16:30:32Z
class:
comments:
[API] changed all the links in json specs to the new site

time:
2015-03-24T15:17:45Z
class:
src/main/java/org/elasticsearch/search/aggregations/InternalMultiBucketAggregation.java
src/main/java/org/elasticsearch/search/aggregations/bucket/filters/InternalFilters.java
src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/InternalGeoHashGrid.java
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java
src/main/java/org/elasticsearch/search/aggregations/bucket/range/InternalRange.java
src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/InternalDateRange.java
src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/InternalGeoDistance.java
src/main/java/org/elasticsearch/search/aggregations/bucket/range/ipv4/InternalIPv4Range.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/InternalSignificantTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantLongTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantStringTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/UnmappedSignificantTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/LongTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/StringTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/UnmappedTerms.java
src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeReducer.java
comments:
Aggregations: Added Factory for all MultiBucketAggregations to implement

This allows things like reducers to add aggregations to buckets without needing to know how to construct the aggregation or bucket itself.

time:
2015-03-24T14:54:53Z
class:
comments:
Merge pull request #8856 from drewr/master

Reduce apache (cloud-aws) logging when rootLogger is DEBUG

time:
2015-03-24T14:48:48Z
class:
src/main/java/org/elasticsearch/common/lucene/search/function/BoostScoreFunction.java
src/main/java/org/elasticsearch/common/lucene/search/function/FieldValueFactorFunction.java
src/main/java/org/elasticsearch/common/lucene/search/function/FiltersFunctionScoreQuery.java
src/main/java/org/elasticsearch/common/lucene/search/function/FunctionScoreQuery.java
src/main/java/org/elasticsearch/common/lucene/search/function/RandomScoreFunction.java
src/main/java/org/elasticsearch/common/lucene/search/function/ScoreFunction.java
src/main/java/org/elasticsearch/common/lucene/search/function/ScriptScoreFunction.java
src/main/java/org/elasticsearch/common/lucene/search/function/WeightFactorFunction.java
src/main/java/org/elasticsearch/index/query/functionscore/DecayFunctionParser.java
src/main/java/org/elasticsearch/script/ExplainableSearchScript.java
src/test/java/org/elasticsearch/search/functionscore/ExplainableScriptTests.java
src/test/java/org/elasticsearch/search/functionscore/FunctionScoreTests.java
comments:
function_score: undo "Remove explanation of query score from functions"

This adds the Explanation to the explain score again. It is needed
because the explanation of script functions will otherwise not contain
an explanation of _score if boost mode is set to replace.

closes #9826

time:
2015-03-24T13:15:15Z
class:
src/main/java/org/elasticsearch/index/mapper/geo/GeoPointFieldMapper.java
src/test/java/org/elasticsearch/index/mapper/geo/GeoPointFieldMapperTests.java
src/test/java/org/elasticsearch/index/mapper/geo/LatLonAndGeohashMappingGeoPointTests.java
comments:
[GEO] Fix validate_* merge policy for GeoPointFieldMapper

Fail merge if validate_lat or validate_lon values are not equal. This will prevent inconsistencies between geo_points in a merged index, and parse exceptions for bounding_box and distance filters.

Also merged separate GeoPoint test classes into a single GeoPointFieldMapperTest to be consistent with GeoShapeFieldMapperTests.

closes #10164

time:
2015-03-24T12:04:59Z
class:
src/main/java/org/elasticsearch/action/get/MultiGetShardRequest.java
src/main/java/org/elasticsearch/common/lucene/uid/Versions.java
src/main/java/org/elasticsearch/index/VersionType.java
src/test/java/org/elasticsearch/action/termvectors/GetTermVectorsTests.java
src/test/java/org/elasticsearch/action/termvectors/MultiTermVectorsTests.java
src/test/java/org/elasticsearch/get/GetActionTests.java
src/test/java/org/elasticsearch/index/VersionTypeTests.java
comments:
Remove backward compatibility layer introduced in #6149

Closes #6229

time:
2015-03-24T11:21:06Z
class:
src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsBackwardCompatibilityTests.java
comments:
[TEST] explicitly map fields in SignificantTermsBWCTests

time:
2015-03-24T09:04:32Z
class:
comments:
[TEST] only use perm gen space on java 1.7.x

time:
2015-03-24T08:38:34Z
class:
comments:
[TEST] Add back permGen space tuning for now

time:
2015-03-24T04:29:24Z
class:
src/main/java/org/elasticsearch/common/collect/Iterators2.java
src/main/java/org/elasticsearch/common/inject/Scopes.java
src/main/java/org/elasticsearch/common/inject/util/Modules.java
src/main/java/org/elasticsearch/search/fetch/script/ScriptFieldsFetchSubPhase.java
src/main/java/org/elasticsearch/threadpool/ThreadPool.java
src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/DateRangeTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/GeoDistanceTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/HistogramTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/IPv4RangeTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/RangeTests.java
src/test/java/org/elasticsearch/search/suggest/CustomSuggesterSearchTests.java
comments:
fix build with java 9

* add compiler workarounds for JDK bug JI-9019884
* remove permgen specification during tests (this results in an error on java 9)
* fix threadpool grow/shrink to call methods in the right order (this results in IAE with java 9)

time:
2015-03-23T21:02:46Z
class:
src/test/java/org/elasticsearch/gateway/RecoveryFromGatewayTests.java
comments:
Test: RecoveryFromGatewayTests.testReusePeerRecovery - increase concurrent recoveries

To speed up the test and prevent ensureGreen() from timing out.

time:
2015-03-23T20:34:37Z
class:
comments:
[GEO] fix docs for geo_point "validate" option

Documentation states false as the default for "validate", "validate_lon", and "validate_lat" leading to confusion as described in issue #9539. This simple fix corrects the documentation and communicates that these fields will be deprecated and removed in upcoming versions.

closes #9539

time:
2015-03-23T17:33:24Z
class:
src/main/java/org/elasticsearch/discovery/zen/publish/PublishClusterStateAction.java
comments:
Revert "Internal: change logging from debug to warning in PublishClusterStateAction"

This reverts commit 166fd04239aaa95ed19ad46187deeb8eb0006b15.

Turns out that having log.warn produces a duplicated warn log, as the same message is already logged warn in NettyTranspo
rt#exceptionCaught.

time:
2015-03-23T16:49:19Z
class:
src/main/java/org/elasticsearch/discovery/zen/publish/PublishClusterStateAction.java
comments:
Internal: change logging from debug to warning in PublishClusterStateAction

Closes #9594

time:
2015-03-23T15:29:35Z
class:
src/main/java/org/elasticsearch/Version.java
comments:
Added 1.5.1 version and set 1.5.0 snapshot to false

time:
2015-03-23T15:04:05Z
class:
comments:
Tests: Add static bwc index for 1.5.0

time:
2015-03-23T14:13:28Z
class:
comments:
change elasticsearch.org into elastic.co

time:
2015-03-23T14:13:28Z
class:
comments:
Disable marvel as it may fail the tests, because it creates indices.

time:
2015-03-23T13:40:08Z
class:
src/main/java/org/elasticsearch/transport/TransportService.java
src/main/java/org/elasticsearch/transport/TransportServiceAdapter.java
src/main/java/org/elasticsearch/transport/local/LocalTransport.java
src/main/java/org/elasticsearch/transport/netty/MessageChannelHandler.java
src/test/java/org/elasticsearch/client/transport/FailAndRetryMockTransport.java
comments:
Transport: fix racing condition in timeout handling

If a request comes in at the same moment the timeout handler for it runs, we may leak a timeoutInfoHolder and erroneously log "Transport response handler not found of id" . The same issue could cause the request tracer to fire a traceUnresolvedResponse call instead of traceReceivedResponse , causing a failure of testTracerLog ( see #10187 ) .

This commit makes sure timeoutInfoHolder is visible before removing the corresponding RequestHolder. It also unifies the TransportService.Adapter#remove(requestId) with TransportService.Adapter#onResponseReceived(requestId), as they are always called together to indicate a response was received.

Closes #10187
Closes #10220

time:
2015-03-23T13:24:37Z
class:
src/main/java/org/elasticsearch/action/support/broadcast/TransportBroadcastOperationAction.java
src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
src/main/java/org/elasticsearch/indices/recovery/RecoveriesCollection.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
src/test/java/org/elasticsearch/recovery/RecoveriesCollectionTests.java
src/test/java/org/elasticsearch/recovery/RecoveryWhileUnderLoadTests.java
comments:
Recovery: only cancel when primary completed relocation

When a primary moves to another node, we cancel ongoing recoveries and retry from the primary's new home. At the moment this happens when the primary relocation *starts*. It's a shame as we cancel recoveries that may be close to completion and will finish before the primary has been fully relocated. This commit only triggers the cancelation once the primary relocation is completed.

Next to this, it fixes a race condition between recovery cancellation and the recovery completion. At the moment we may trigger remove a recovered shard just after it was completed. Instead, we should use the recovery cancellation logic to make sure only one code path is followed.

All of the above caused the recoverWhileUnderLoadWithNodeShutdown test to fail (see http://build-us-00.elastic.co/job/es_core_15_debian/32/ ). The test creates an index and then increasingly disallows nodes for it, until only 1 node is left in the allocation filtering rules. Normally, this means we stay in green, but the premature recovery cancellation plus the race condition mentioned above caused a shard to be failed and stay unassigned and the test asserts to fail. This happens due to the following sequence:

- The shard has finished recovering and sent the master a shard started command.
- The recovery is cancelled locally, removing the index shard.
- Master starts shard (deleting it's other copy).
- Local node gets a cluster state with the shard started in it, which cause it to send a shard failed (to make the master aware).
- Shard is failed and can't be re-assigned due to the allocation filter.

The recoverWhileUnderLoadWithNodeShutdown is also adapted a bit to fit the current behavior of allocation filtering (in the past it used to really shut down nodes). Last, all tests in that class are given better names to fit the current terminology.

Clsoes #10218

time:
2015-03-23T13:04:15Z
class:
src/main/java/org/elasticsearch/gateway/GatewayAllocator.java
src/main/java/org/elasticsearch/gateway/TransportNodesListGatewayStartedShards.java
comments:
[ALLOCATION] Verify shards index UUID when fetching started shards

Today we simply fetch the shards metadata without verifying the
index UUID the shard belongs to. We recently added this UUID
to the shard state metadata. This commit adds verification
to the shard metadata fetching to prevent bringing shards
back into an index it doesn't belong to due to name collisions.

time:
2015-03-23T12:13:26Z
class:
comments:
change url to use elastic organization

time:
2015-03-23T11:57:19Z
class:
src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeRequest.java
src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeRequestBuilder.java
src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeSourceBuilder.java
src/main/java/org/elasticsearch/action/admin/indices/analyze/TransportAnalyzeAction.java
src/main/java/org/elasticsearch/action/search/ClearScrollRequest.java
src/main/java/org/elasticsearch/action/search/ClearScrollRequestBuilder.java
src/main/java/org/elasticsearch/action/search/SearchScrollRequest.java
src/main/java/org/elasticsearch/action/search/SearchScrollRequestBuilder.java
src/main/java/org/elasticsearch/action/search/SearchScrollSourceBuilder.java
src/main/java/org/elasticsearch/action/search/TransportClearScrollAction.java
src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java
src/main/java/org/elasticsearch/action/search/type/TransportSearchHelper.java
src/main/java/org/elasticsearch/rest/action/admin/indices/analyze/RestAnalyzeAction.java
src/main/java/org/elasticsearch/rest/action/search/RestClearScrollAction.java
src/main/java/org/elasticsearch/rest/action/search/RestSearchScrollAction.java
src/test/java/org/elasticsearch/action/IndicesRequestTests.java
src/test/java/org/elasticsearch/indices/analyze/AnalyzeActionTests.java
src/test/java/org/elasticsearch/search/scroll/SearchScrollTests.java
comments:
Revert "Rest: Add json in request body to scroll, clear scroll, and analyze API"

This reverts commit 16083d454c0772547bd43dcc549e584c7af3f891.

time:
2015-03-23T10:31:21Z
class:
src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
comments:
Remove unused code

time:
2015-03-23T09:39:08Z
class:
src/main/java/org/elasticsearch/transport/local/LocalTransport.java
src/main/java/org/elasticsearch/transport/netty/MessageChannelHandler.java
comments:
ThreadPool: use `equals` instead of `==` for threadpool names comparisons

Although the current comparisons work, since we rely on the fact that we always use the same constants, `equals` seems safer.

Closes #10204

time:
2015-03-23T09:12:28Z
class:
src/main/java/org/elasticsearch/search/aggregations/AggregatorFactories.java
src/main/java/org/elasticsearch/search/aggregations/AggregatorFactory.java
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregator.java
src/main/java/org/elasticsearch/search/aggregations/reducers/ReducerFactory.java
src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeReducer.java
src/test/java/org/elasticsearch/search/aggregations/reducers/DateDerivativeTests.java
src/test/java/org/elasticsearch/search/aggregations/reducers/DerivativeTests.java
comments:
added validation of reducers

time:
2015-03-23T08:03:27Z
class:
src/main/java/org/elasticsearch/index/mapper/internal/AllFieldMapper.java
src/test/java/org/elasticsearch/action/termvectors/GetTermVectorsTests.java
src/test/java/org/elasticsearch/index/mapper/object/SimpleObjectMappingTests.java
src/test/java/org/elasticsearch/search/aggregations/metrics/GeoBoundsTests.java
comments:
Upgrade to Jackson 2.5.1
Note, Jackson 2.5 is less lenient when it comes to not starting an object before starting to add fields on a fresh builder, fixed where applicable.
closes #10210

time:
2015-03-23T06:35:38Z
class:
src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeRequest.java
src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeRequestBuilder.java
src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeSourceBuilder.java
src/main/java/org/elasticsearch/action/admin/indices/analyze/TransportAnalyzeAction.java
src/main/java/org/elasticsearch/action/search/ClearScrollRequest.java
src/main/java/org/elasticsearch/action/search/ClearScrollRequestBuilder.java
src/main/java/org/elasticsearch/action/search/SearchScrollRequest.java
src/main/java/org/elasticsearch/action/search/SearchScrollRequestBuilder.java
src/main/java/org/elasticsearch/action/search/SearchScrollSourceBuilder.java
src/main/java/org/elasticsearch/action/search/TransportClearScrollAction.java
src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java
src/main/java/org/elasticsearch/action/search/type/TransportSearchHelper.java
src/main/java/org/elasticsearch/rest/action/admin/indices/analyze/RestAnalyzeAction.java
src/main/java/org/elasticsearch/rest/action/search/RestClearScrollAction.java
src/main/java/org/elasticsearch/rest/action/search/RestSearchScrollAction.java
src/test/java/org/elasticsearch/action/IndicesRequestTests.java
src/test/java/org/elasticsearch/indices/analyze/AnalyzeActionTests.java
src/test/java/org/elasticsearch/search/scroll/SearchScrollTests.java
comments:
Rest: Add json in request body to scroll, clear scroll, and analyze API

 Add json support to scroll, clear scroll, and analyze

Closes #5866

time:
2015-03-22T09:26:12Z
class:
comments:
[SPEC] Remove duplicated timeout param from bulk REST spec

Closes #10205

time:
2015-03-21T19:06:43Z
class:
src/main/java/org/elasticsearch/gateway/LocalAllocateDangledIndices.java
comments:
Logging: change logging to warning in LocalAllocateDangledIndices

Closes #9593

time:
2015-03-21T18:08:33Z
class:
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
comments:
TEST: use the random variable
we have to use the variable instead of the static methods to reproduce failing tests

time:
2015-03-21T18:02:20Z
class:
src/main/java/org/elasticsearch/transport/netty/NettyTransport.java
comments:
ping: remove version check

time:
2015-03-21T17:55:10Z
class:
src/main/java/org/elasticsearch/client/transport/TransportClient.java
src/main/java/org/elasticsearch/transport/netty/NettyHeader.java
src/main/java/org/elasticsearch/transport/netty/NettyTransport.java
src/main/java/org/elasticsearch/transport/netty/SizeHeaderFrameDecoder.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
src/test/java/org/elasticsearch/transport/netty/NettyScheduledPingTests.java
comments:
Schedule transport ping interval
Sometimes, when using transport client for example, through a load balancer, there is a need to send a scheduled ping message to keep each channel alive.

Add support for `transport.ping_schedule`, which controls the schedule (-1 for disabled) at which a ping message will be sent. For transport client case, it gets enabled automatically since almost always this is the desired behavior.

We use the same 6 bytes header format for the ping message, with ES header and -1 for data length for ping message, and simply continue to process the next messages once this is encountered.

closes #10189

time:
2015-03-21T13:19:30Z
class:
comments:
[DOCS] removed extra line break from monitoring.asciidoc

time:
2015-03-21T10:10:24Z
class:
comments:
[TEST] add REST test for update index settings api using indices options

Relates to #10030

time:
2015-03-21T09:59:44Z
class:
src/main/java/org/elasticsearch/rest/action/admin/indices/settings/RestUpdateSettingsAction.java
comments:
Update Settings api: fix handling of IndicesOptions parameters in REST layer

The Update Settings API tries to merge the query_string params with the settings sent as body and excluding some "well known params" such as `pretty`, `timeout` etc. Those well known params do not include the params used by IndicesOptions though, so they get merged resulting in invalid settings that get rejected.

Closes #10030

time:
2015-03-21T09:36:05Z
class:
src/main/java/org/elasticsearch/cluster/metadata/BenchmarkMetaData.java
src/main/java/org/elasticsearch/cluster/metadata/MetaData.java
src/main/java/org/elasticsearch/threadpool/ThreadPool.java
src/test/java/org/elasticsearch/test/CompositeTestCluster.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
src/test/java/org/elasticsearch/test/ExternalTestCluster.java
src/test/java/org/elasticsearch/test/InternalTestCluster.java
src/test/java/org/elasticsearch/test/TestCluster.java
src/test/java/org/elasticsearch/test/rest/support/Features.java
src/test/java/org/elasticsearch/test/test/InternalTestClusterTests.java
src/test/java/org/elasticsearch/transport/ActionNamesTests.java
src/test/java/org/elasticsearch/transport/netty/NettyTransportMultiPortIntegrationTests.java
src/test/java/org/elasticsearch/tribe/TribeTests.java
comments:
Benchmark api: removed leftovers

Closes #10182
Closes #10184

time:
2015-03-21T09:36:04Z
class:
src/main/java/org/elasticsearch/action/ActionModule.java
src/main/java/org/elasticsearch/action/bench/AbortBenchmarkAction.java
src/main/java/org/elasticsearch/action/bench/AbortBenchmarkRequest.java
src/main/java/org/elasticsearch/action/bench/AbortBenchmarkRequestBuilder.java
src/main/java/org/elasticsearch/action/bench/AbortBenchmarkResponse.java
src/main/java/org/elasticsearch/action/bench/BenchmarkAction.java
src/main/java/org/elasticsearch/action/bench/BenchmarkCompetitor.java
src/main/java/org/elasticsearch/action/bench/BenchmarkCompetitorBuilder.java
src/main/java/org/elasticsearch/action/bench/BenchmarkExecutionException.java
src/main/java/org/elasticsearch/action/bench/BenchmarkExecutor.java
src/main/java/org/elasticsearch/action/bench/BenchmarkMissingException.java
src/main/java/org/elasticsearch/action/bench/BenchmarkModule.java
src/main/java/org/elasticsearch/action/bench/BenchmarkNodeMissingException.java
src/main/java/org/elasticsearch/action/bench/BenchmarkRequest.java
src/main/java/org/elasticsearch/action/bench/BenchmarkRequestBuilder.java
src/main/java/org/elasticsearch/action/bench/BenchmarkResponse.java
src/main/java/org/elasticsearch/action/bench/BenchmarkService.java
src/main/java/org/elasticsearch/action/bench/BenchmarkSettings.java
src/main/java/org/elasticsearch/action/bench/BenchmarkStatusAction.java
src/main/java/org/elasticsearch/action/bench/BenchmarkStatusNodeResponse.java
src/main/java/org/elasticsearch/action/bench/BenchmarkStatusRequest.java
src/main/java/org/elasticsearch/action/bench/BenchmarkStatusRequestBuilder.java
src/main/java/org/elasticsearch/action/bench/BenchmarkStatusResponse.java
src/main/java/org/elasticsearch/action/bench/CompetitionDetails.java
src/main/java/org/elasticsearch/action/bench/CompetitionIteration.java
src/main/java/org/elasticsearch/action/bench/CompetitionIterationData.java
src/main/java/org/elasticsearch/action/bench/CompetitionNodeResult.java
src/main/java/org/elasticsearch/action/bench/CompetitionResult.java
src/main/java/org/elasticsearch/action/bench/CompetitionSummary.java
src/main/java/org/elasticsearch/action/bench/SinglePassStatistics.java
src/main/java/org/elasticsearch/action/bench/TransportAbortBenchmarkAction.java
src/main/java/org/elasticsearch/action/bench/TransportBenchmarkAction.java
src/main/java/org/elasticsearch/action/bench/TransportBenchmarkStatusAction.java
src/main/java/org/elasticsearch/client/Client.java
src/main/java/org/elasticsearch/client/support/AbstractClient.java
src/main/java/org/elasticsearch/client/transport/TransportClient.java
src/main/java/org/elasticsearch/node/Node.java
src/main/java/org/elasticsearch/rest/action/RestActionModule.java
src/main/java/org/elasticsearch/rest/action/bench/RestBenchAction.java
src/test/java/org/elasticsearch/action/bench/BenchmarkIntegrationTest.java
src/test/java/org/elasticsearch/action/bench/BenchmarkNegativeTest.java
src/test/java/org/elasticsearch/action/bench/BenchmarkTestUtil.java
src/test/java/org/elasticsearch/client/AbstractClientHeadersTests.java
src/test/java/org/elasticsearch/rest/HeadersAndContextCopyClientTests.java
src/test/java/org/elasticsearch/transport/ActionNamesTests.java
comments:
Revert Benchmark API

The benchmark api is being worked on feature/bench branch and will be merged from there when ready.

time:
2015-03-21T09:30:36Z
class:
src/main/java/org/elasticsearch/action/delete/DeleteRequestBuilder.java
src/main/java/org/elasticsearch/action/index/IndexRequestBuilder.java
comments:
Java API: remove duplicated consistency level setters

`setConsistencyLevel` setter is already present in the base class `ShardReplicationOperationRequestBuilder`. It is not needed in `DeleteRequestBuilder` and `IndexRequestBuilder`.

Closes #10188

time:
2015-03-21T09:23:15Z
class:
comments:
[DOCS] Fix typos in percolate.asciidoc

time:
2015-03-21T09:03:56Z
class:
comments:
[DOCS] Add ElasticOcean mobile app to monitoring.asciidoc

time:
2015-03-21T08:25:46Z
class:
src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
comments:
Rest: remove indices_boost _search URL param

Relates to https://github.com/elastic/elasticsearch-ruby/issues/29, the parsing logic is incorrect as comma is used twice as a separator (e.g. indices_boost=index1,5,index,10 in expected but will never be parsed correctly). Anyways `indices_boost` makes more sense in the request body only where properly parsed and supported.

Closes #6281

time:
2015-03-21T07:56:20Z
class:
comments:
[DOCS] add -i flag to more curl HEAD calls

time:
2015-03-21T07:56:12Z
class:
comments:
[DOCS] add -i flag to curl HEAD call

without -i you never see the status:200 or status:404 messages

time:
2015-03-21T06:47:44Z
class:
src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
src/main/java/org/elasticsearch/bootstrap/JVMCheck.java
comments:
[Bootstrap] Throw exception if the JVM will corrupt data.

Detect the worst-offenders, all IBM versions and several known hotspot
versions that can cause index corruption, and fail on startup.

Provide/detect compiler workarounds when they exist, but warn about
performance degradation.

In all cases the check can be bypassed completely with a safety
switch via undocumented system property (es.bypass.vm.check=true)

Closes #7580

time:
2015-03-21T00:09:07Z
class:
src/main/java/org/elasticsearch/common/xcontent/XContentFactory.java
comments:
Read first bytes as ints to respect method contract

time:
2015-03-20T21:38:49Z
class:
src/main/java/org/elasticsearch/rest/action/admin/indices/stats/RestIndicesStatsAction.java
comments:
Filter indices stats for translog

Added the missing call in the RestAction, closes #8262

time:
2015-03-20T21:06:03Z
class:
src/main/java/org/elasticsearch/common/xcontent/XContentFactory.java
src/test/java/org/elasticsearch/common/xcontent/XContentFactoryTests.java
comments:
Better detection of CBOR
CBOR has a special header that is optional, if exists, allows for exact detection. Also, since we know which formats we support in ES, we can support the object major type case.
closes #7640

time:
2015-03-20T20:52:20Z
class:
comments:
Update templates.asciidoc

I've been attempting to programatically verify that adding index templates via the `{path.conf}/templates/` directory works fine although I was never able to validate this via an API call to the `/_template/`.  It seems that these templates do not appear in that API call, which I discovered in the following mail thread:

http://elasticsearch-users.115913.n3.nabble.com/Loading-of-index-settings-template-from-file-in-config-templates-td4024923.html#d1366317284000-912

My question is why wouldn't the `/_template/*` method return these templates?  This tends to complicate things for those that want to perform automated tests to verify that they are in fact being recognized and used by Elasticsearch.

time:
2015-03-20T20:14:02Z
class:
src/main/java/org/elasticsearch/cluster/ClusterState.java
src/main/java/org/elasticsearch/common/bytes/BytesArray.java
src/main/java/org/elasticsearch/common/io/stream/BytesStreamInput.java
src/main/java/org/elasticsearch/common/settings/loader/PropertiesSettingsLoader.java
src/main/java/org/elasticsearch/common/xcontent/XContentHelper.java
src/main/java/org/elasticsearch/index/translog/fs/FsChannelSnapshot.java
src/main/java/org/elasticsearch/index/translog/fs/FsTranslog.java
src/main/java/org/elasticsearch/transport/local/LocalTransport.java
src/test/java/org/elasticsearch/cluster/serialization/ClusterSerializationTests.java
src/test/java/org/elasticsearch/common/io/streams/BytesStreamsTests.java
src/test/java/org/elasticsearch/common/xcontent/XContentFactoryTests.java
comments:
Merge pull request #10157 from spinscale/1503-cleanup-remove-bytesarray-unsafe

Cleanup: Remove unsafe field in BytesStreamInput

time:
2015-03-20T20:09:42Z
class:
src/main/java/org/elasticsearch/indices/recovery/RecoverySettings.java
src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
comments:
Core: increase default rate limiting for snapshot, restore and recovery to 40 MB/sec

This also fixes a possible issue that may cause over-throttling when
there are many small files being copied, which should be rare.

Closed #10185

time:
2015-03-20T18:55:00Z
class:
comments:
Merge pull request #117 from rmuir/exclude-jhighlight

Exclude jhighlight dependency, which contains LGPL-only files

time:
2015-03-20T18:42:55Z
class:
comments:
Exclude jhighlight dependency, which contains LGPL-only files

time:
2015-03-20T15:42:03Z
class:
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
comments:
[RECOVERY] Wipe shard state before switching recovered files live

Today we leave the shard state behind even if a recovery is half finished
this causes in rare conditions shards to be recovered and promoted as
primaries that have never been fully recovered.

Closes #10053

time:
2015-03-20T15:24:36Z
class:
src/test/java/org/elasticsearch/recovery/TruncatedRecoveryTests.java
comments:
Test: testCancelRecoveryAndResume - add network hook before bumping replicas

time:
2015-03-20T15:10:26Z
class:
src/main/java/org/elasticsearch/indices/recovery/RecoveryStatus.java
comments:
remove left over recovery log

time:
2015-03-20T14:58:16Z
class:
comments:
[DOCS] clarify no-master-block docs

Closes #9739

time:
2015-03-20T09:13:40Z
class:
src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStats.java
src/main/java/org/elasticsearch/action/admin/indices/stats/CommonStatsFlags.java
src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsRequest.java
src/main/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsRequestBuilder.java
src/main/java/org/elasticsearch/action/admin/indices/stats/TransportIndicesStatsAction.java
src/main/java/org/elasticsearch/index/recovery/RecoveryStats.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/main/java/org/elasticsearch/indices/IndicesService.java
src/main/java/org/elasticsearch/indices/NodeIndicesStats.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryFileChunkRequest.java
src/main/java/org/elasticsearch/indices/recovery/RecoverySource.java
src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryState.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryStatus.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
src/main/java/org/elasticsearch/rest/action/admin/indices/stats/RestIndicesStatsAction.java
src/test/java/org/elasticsearch/index/store/CorruptedFileTest.java
src/test/java/org/elasticsearch/indices/recovery/IndexRecoveryTests.java
src/test/java/org/elasticsearch/indices/recovery/RecoveryStateTest.java
src/test/java/org/elasticsearch/indices/stats/IndexStatsTests.java
src/test/java/org/elasticsearch/test/rest/section/Assertion.java
src/test/java/org/elasticsearch/test/rest/section/GreaterThanAssertion.java
src/test/java/org/elasticsearch/test/rest/section/GreaterThanEqualToAssertion.java
src/test/java/org/elasticsearch/test/rest/section/LengthAssertion.java
src/test/java/org/elasticsearch/test/rest/section/LessThanAssertion.java
src/test/java/org/elasticsearch/test/rest/section/LessThanOrEqualToAssertion.java
src/test/java/org/elasticsearch/test/rest/section/MatchAssertion.java
comments:
Recovery: add throttle stats

This commit adds throttling statistics to the index stats API and to the recovery state.

Closes #10097

time:
2015-03-20T08:19:43Z
class:
src/main/java/org/elasticsearch/action/ActionModule.java
src/main/java/org/elasticsearch/action/delete/IndexDeleteRequest.java
src/main/java/org/elasticsearch/action/delete/IndexDeleteResponse.java
src/main/java/org/elasticsearch/action/delete/ShardDeleteRequest.java
src/main/java/org/elasticsearch/action/delete/ShardDeleteResponse.java
src/main/java/org/elasticsearch/action/delete/TransportDeleteAction.java
src/main/java/org/elasticsearch/action/delete/TransportIndexDeleteAction.java
src/main/java/org/elasticsearch/action/delete/TransportShardDeleteAction.java
src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
src/main/java/org/elasticsearch/action/support/replication/TransportShardReplicationOperationAction.java
src/test/java/org/elasticsearch/bwcompat/BasicBackwardsCompatibilityTest.java
src/test/java/org/elasticsearch/document/DocumentActionsTests.java
src/test/java/org/elasticsearch/document/ShardInfoTests.java
src/test/java/org/elasticsearch/routing/AliasRoutingTests.java
src/test/java/org/elasticsearch/routing/SimpleRoutingTests.java
comments:
Delete api: remove broadcast delete if routing is missing when required

This commit changes the behaviour of the delete api when processing a delete request that refers to a type that has routing set to required in the mapping, and the routing is missing in the request. Up until now the delete api sent a broadcast delete request to all of the shards that belong to the index, making sure that the document could be found although the routing value wasn't specified. This was probably not the best choice: if the routing is set to required, an error should be thrown instead.

A `RoutingMissingException` gets now thrown instead, like it happens in the same situation with every other api (index, update, get etc.). Last but not least, this change allows to get rid of a couple of `TransportAction`s, `Request`s and `Response`s and simplify the codebase.

Closes #9123
Closes #10136

time:
2015-03-20T06:17:48Z
class:
src/test/java/org/elasticsearch/recovery/TruncatedRecoveryTests.java
comments:
[TEST] Add more logging to TruncatedRecoveryTests

time:
2015-03-20T04:58:49Z
class:
src/test/java/org/elasticsearch/index/store/CorruptedTranslogTests.java
comments:
[TEST] Add additional logging to testCorruptTranslogFiles

time:
2015-03-20T00:12:21Z
class:
src/test/java/org/elasticsearch/index/IndexWithShadowReplicasTests.java
comments:
[TEST] Use less shards in testShadowReplicaNaturalRelocation

This makes the assertion a bit more flexible and removes the
`ensureGreen` in favor of `ensureYellow`, which is really all that is
needed to perform a search. On slow machines the relocations can take a
while and time out the `ensureGreen`.

time:
2015-03-20T00:05:24Z
class:
src/main/java/org/elasticsearch/cluster/ClusterStateObserver.java
comments:
remove unused method. close() is neither needed nor called anywhere

closes #10175

time:
2015-03-19T22:56:28Z
class:
src/main/java/org/elasticsearch/indices/IndicesLifecycle.java
comments:
apply feedback

time:
2015-03-19T22:47:51Z
class:
src/main/java/org/elasticsearch/index/IndexService.java
src/main/java/org/elasticsearch/indices/IndicesLifecycle.java
src/main/java/org/elasticsearch/indices/InternalIndicesLifecycle.java
src/test/java/org/elasticsearch/indices/IndicesLifecycleListenerSingleNodeTests.java
comments:
[LIFECYCLE] Add before/afterIndexShardDelete callback

This commit allows code to be executed before or after a shards content
is deleted from disk. This is only executed if the shard owns the
content ie. on a shard file system only a primary shard will execute
these operations.

time:
2015-03-19T21:48:02Z
class:
src/main/java/org/elasticsearch/cluster/routing/ImmutableShardRouting.java
src/main/java/org/elasticsearch/gateway/Gateway.java
src/main/java/org/elasticsearch/gateway/GatewayMetaState.java
src/main/java/org/elasticsearch/gateway/GatewayModule.java
src/main/java/org/elasticsearch/gateway/GatewayShardsState.java
src/main/java/org/elasticsearch/gateway/ShardStateInfo.java
src/main/java/org/elasticsearch/gateway/TransportNodesListGatewayStartedShards.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/main/java/org/elasticsearch/index/shard/ShadowIndexShard.java
src/main/java/org/elasticsearch/index/shard/ShardStateMetaData.java
src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
src/test/java/org/elasticsearch/gateway/GatewayShardStateTests.java
src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
comments:
[GATEWAY] Move GatewayShardsState logic into IndexShard

The index shard should take care of shard state persistence since it has
all the information and the gateway concept has been removed in master.

time:
2015-03-19T21:44:21Z
class:
src/main/java/org/elasticsearch/action/ActionWriteResponse.java
src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
src/main/java/org/elasticsearch/action/bulk/BulkRequestBuilder.java
src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
src/main/java/org/elasticsearch/action/delete/DeleteRequestBuilder.java
src/main/java/org/elasticsearch/action/delete/IndexDeleteRequest.java
src/main/java/org/elasticsearch/action/delete/ShardDeleteRequest.java
src/main/java/org/elasticsearch/action/deletebyquery/DeleteByQueryRequestBuilder.java
src/main/java/org/elasticsearch/action/deletebyquery/IndexDeleteByQueryRequest.java
src/main/java/org/elasticsearch/action/deletebyquery/ShardDeleteByQueryRequest.java
src/main/java/org/elasticsearch/action/index/IndexRequestBuilder.java
src/main/java/org/elasticsearch/action/support/replication/IndexReplicationOperationRequest.java
src/main/java/org/elasticsearch/action/support/replication/IndicesReplicationOperationRequest.java
src/main/java/org/elasticsearch/action/support/replication/IndicesReplicationOperationRequestBuilder.java
src/main/java/org/elasticsearch/action/support/replication/ReplicationType.java
src/main/java/org/elasticsearch/action/support/replication/ShardReplicationOperationRequest.java
src/main/java/org/elasticsearch/action/support/replication/ShardReplicationOperationRequestBuilder.java
src/main/java/org/elasticsearch/action/support/replication/TransportIndexReplicationOperationAction.java
src/main/java/org/elasticsearch/action/support/replication/TransportShardReplicationOperationAction.java
src/main/java/org/elasticsearch/action/update/UpdateHelper.java
src/main/java/org/elasticsearch/action/update/UpdateRequest.java
src/main/java/org/elasticsearch/action/update/UpdateRequestBuilder.java
src/main/java/org/elasticsearch/action/update/UpdateResponse.java
src/main/java/org/elasticsearch/rest/action/bulk/RestBulkAction.java
src/main/java/org/elasticsearch/rest/action/delete/RestDeleteAction.java
src/main/java/org/elasticsearch/rest/action/deletebyquery/RestDeleteByQueryAction.java
src/main/java/org/elasticsearch/rest/action/index/RestIndexAction.java
src/main/java/org/elasticsearch/rest/action/update/RestUpdateAction.java
src/test/java/org/elasticsearch/deleteByQuery/DeleteByQueryTests.java
src/test/java/org/elasticsearch/document/DocumentActionsTests.java
src/test/java/org/elasticsearch/document/ShardInfoTests.java
comments:
[REPLICATION] Remove `async` replication

Closes #10114

time:
2015-03-19T20:29:34Z
class:
src/main/java/org/elasticsearch/transport/TransportService.java
src/test/java/org/elasticsearch/transport/AbstractSimpleTransportTests.java
comments:
Transport: fix potential NPE in new tracer log if request timeout

Closes #9994

time:
2015-03-19T19:56:25Z
class:
comments:
Merge pull request #10169 from clintongormley/deprecate_thrift_memcached

Remove references to the thrift and memcached transport plugins

time:
2015-03-19T19:49:58Z
class:
comments:
Remove references to the thrift and memcached transport plugins
as they are no longer supported

Closes #10166

time:
2015-03-19T17:00:31Z
class:
src/main/java/org/elasticsearch/action/count/CountResponse.java
src/main/java/org/elasticsearch/action/search/SearchResponse.java
src/main/java/org/elasticsearch/rest/RestStatus.java
src/main/java/org/elasticsearch/rest/action/suggest/RestSuggestAction.java
src/main/java/org/elasticsearch/snapshots/SnapshotInfo.java
comments:
return an HTTP code representing the error when a suggest request failed instead of 200

time:
2015-03-19T16:57:25Z
class:
comments:
Deleted REST test pending shard header

Bug introduced in #10162

time:
2015-03-19T15:52:47Z
class:
comments:
Changed the release notes script to use the category labels instead of title prefix

time:
2015-03-19T14:35:23Z
class:
comments:
Merge pull request #10162 from clintongormley/deprecate_async_master

Remove async replication from the docs and REST spec

time:
2015-03-19T14:34:12Z
class:
comments:
Remove async replication from the docs and REST spec

Relates to #10114

time:
2015-03-19T14:22:39Z
class:
comments:
[DOCS] added note about dynamic scriptings and updated links in getting started page

Closes #10074

time:
2015-03-19T12:05:59Z
class:
src/main/java/org/elasticsearch/cluster/ClusterState.java
src/main/java/org/elasticsearch/common/bytes/BytesArray.java
src/main/java/org/elasticsearch/common/io/stream/BytesStreamInput.java
src/main/java/org/elasticsearch/common/settings/loader/PropertiesSettingsLoader.java
src/main/java/org/elasticsearch/common/xcontent/XContentHelper.java
src/main/java/org/elasticsearch/index/translog/fs/FsChannelSnapshot.java
src/main/java/org/elasticsearch/index/translog/fs/FsTranslog.java
src/main/java/org/elasticsearch/transport/local/LocalTransport.java
src/test/java/org/elasticsearch/cluster/serialization/ClusterSerializationTests.java
src/test/java/org/elasticsearch/common/io/streams/BytesStreamsTests.java
src/test/java/org/elasticsearch/common/xcontent/XContentFactoryTests.java
comments:
Cleanup: Remove unsafe field in BytesStreamInput

It is only used once (otherwise it is set to `false` anyway), so copying the array in that case makes more sense.

time:
2015-03-19T11:43:51Z
class:
comments:
[DOCS] added instructions on how to write parameterized tests

Closes #9423

time:
2015-03-19T08:03:47Z
class:
src/test/java/org/elasticsearch/recovery/TruncatedRecoveryTests.java
comments:
[TEST] Add tests that triggers truncated files on recovery

Several issues where reported showing truncated files where footers
didn't match and checksums read past EOF. This test reproduces the issue
on the latest 1.4 branch but passes on all versions above.

Closes #10155

time:
2015-03-19T02:30:20Z
class:
src/test/java/org/elasticsearch/search/geo/GeoShapeIntegrationTests.java
comments:
[TEST] Fix geo orientation integration test

Pass node name to getInstance method of internalCluster to ensure we return the indexService from a node containing the index.

time:
2015-03-18T23:55:49Z
class:
src/main/java/org/elasticsearch/index/mapper/geo/GeoShapeFieldMapper.java
src/test/java/org/elasticsearch/index/mapper/geo/GeoShapeFieldMapperTests.java
src/test/java/org/elasticsearch/search/geo/GeoShapeIntegrationTests.java
comments:
[GEO] Fix orientation persistence

Fixing geo_shape field mapper to persist the orientation parameter. Also adding parsing and integration tests to ensure persistence across cluster restarts.

time:
2015-03-18T22:31:17Z
class:
src/test/java/org/elasticsearch/test/rest/support/Features.java
comments:
[TEST] Remove 'gtelte' feature from yaml tests

Some yaml tests still used the 'gtelte' feature in their skip section.
Since all language clients support this, the feature skip can be
removed.

time:
2015-03-18T21:49:05Z
class:
src/main/java/org/elasticsearch/http/HttpChannel.java
src/main/java/org/elasticsearch/http/netty/HttpRequestHandler.java
src/main/java/org/elasticsearch/http/netty/NettyHttpChannel.java
src/main/java/org/elasticsearch/http/netty/NettyHttpServerTransport.java
src/main/java/org/elasticsearch/rest/BytesRestResponse.java
src/main/java/org/elasticsearch/rest/RestChannel.java
src/main/java/org/elasticsearch/rest/RestController.java
src/test/java/org/elasticsearch/http/netty/NettyHttpServerPipeliningTest.java
src/test/java/org/elasticsearch/options/detailederrors/DetailedErrorsDisabledTest.java
src/test/java/org/elasticsearch/options/detailederrors/DetailedErrorsEnabledTest.java
src/test/java/org/elasticsearch/rest/BytesRestResponseTests.java
src/test/java/org/elasticsearch/rest/RestFilterChainTests.java
comments:
[HTTP] add option to only return simple exception messages

Adds a setting to disable detailed error messages and full exception stack traces
in HTTP responses. When set to false, the error_trace request parameter will result
in a HTTP 400 response. When the error_trace parameter is not present, the message
of the first ElasticsearchException will be output and no nested exception messages
will be output.

time:
2015-03-18T21:14:00Z
class:
src/test/java/org/elasticsearch/search/aggregations/bucket/significant/SignificanceHeuristicTests.java
comments:
missed file in merge

time:
2015-03-18T21:13:44Z
class:
src/main/java/org/elasticsearch/Build.java
src/main/java/org/elasticsearch/Version.java
src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/RestoreSnapshotRequestBuilder.java
src/main/java/org/elasticsearch/action/search/type/TransportSearchTypeAction.java
src/main/java/org/elasticsearch/action/support/replication/TransportShardReplicationOperationAction.java
src/main/java/org/elasticsearch/cache/recycler/PageCacheRecycler.java
src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java
src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AllocationDecider.java
src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AllocationDeciders.java
src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ClusterRebalanceAllocationDecider.java
src/main/java/org/elasticsearch/cluster/settings/Validator.java
src/main/java/org/elasticsearch/common/http/client/HttpDownloadHelper.java
src/main/java/org/elasticsearch/common/lucene/Lucene.java
src/main/java/org/elasticsearch/common/rounding/TimeZoneRounding.java
src/main/java/org/elasticsearch/common/unit/TimeValue.java
src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
src/main/java/org/elasticsearch/discovery/zen/publish/PublishClusterStateAction.java
src/main/java/org/elasticsearch/gateway/DanglingIndicesState.java
src/main/java/org/elasticsearch/gateway/GatewayMetaState.java
src/main/java/org/elasticsearch/gateway/GatewayModule.java
src/main/java/org/elasticsearch/gateway/LocalAllocateDangledIndices.java
src/main/java/org/elasticsearch/gateway/MetaStateService.java
src/main/java/org/elasticsearch/index/engine/Engine.java
src/main/java/org/elasticsearch/index/engine/EngineConfig.java
src/main/java/org/elasticsearch/index/engine/ForceMergeFailedEngineException.java
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
src/main/java/org/elasticsearch/index/engine/ShadowEngine.java
src/main/java/org/elasticsearch/index/gateway/IndexShardGateway.java
src/main/java/org/elasticsearch/index/gateway/IndexShardGatewayService.java
src/main/java/org/elasticsearch/index/mapper/core/NumberFieldMapper.java
src/main/java/org/elasticsearch/index/merge/scheduler/ConcurrentMergeSchedulerProvider.java
src/main/java/org/elasticsearch/index/query/BoolQueryBuilder.java
src/main/java/org/elasticsearch/index/query/NestedQueryParser.java
src/main/java/org/elasticsearch/index/query/ScriptFilterParser.java
src/main/java/org/elasticsearch/index/query/TemplateQueryBuilder.java
src/main/java/org/elasticsearch/index/query/TemplateQueryParser.java
src/main/java/org/elasticsearch/index/query/functionscore/script/ScriptScoreFunctionParser.java
src/main/java/org/elasticsearch/index/query/support/NestedInnerQueryParseSupport.java
src/main/java/org/elasticsearch/index/query/support/NestedScope.java
src/main/java/org/elasticsearch/index/settings/IndexDynamicSettingsModule.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/main/java/org/elasticsearch/index/snapshots/IndexShardSnapshotAndRestoreService.java
src/main/java/org/elasticsearch/index/translog/TranslogStats.java
src/main/java/org/elasticsearch/index/translog/fs/FsTranslog.java
src/main/java/org/elasticsearch/indices/IndicesService.java
src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
src/main/java/org/elasticsearch/indices/memory/IndexingMemoryController.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryCleanFilesRequest.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryFileChunkRequest.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryFilesInfoRequest.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryPrepareForTranslogOperationsRequest.java
src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryState.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryTranslogOperationsRequest.java
src/main/java/org/elasticsearch/indices/store/IndicesStore.java
src/main/java/org/elasticsearch/node/Node.java
src/main/java/org/elasticsearch/percolator/PercolateContext.java
src/main/java/org/elasticsearch/percolator/PercolatorService.java
src/main/java/org/elasticsearch/rest/action/cat/RestNodesAction.java
src/main/java/org/elasticsearch/rest/action/cat/RestRecoveryAction.java
src/main/java/org/elasticsearch/rest/action/cat/RestShardsAction.java
src/main/java/org/elasticsearch/rest/action/template/RestDeleteSearchTemplateAction.java
src/main/java/org/elasticsearch/rest/action/template/RestGetSearchTemplateAction.java
src/main/java/org/elasticsearch/rest/action/template/RestPutSearchTemplateAction.java
src/main/java/org/elasticsearch/script/NativeScriptEngineService.java
src/main/java/org/elasticsearch/script/ScriptEngineService.java
src/main/java/org/elasticsearch/script/ScriptService.java
src/main/java/org/elasticsearch/script/SearchScript.java
src/main/java/org/elasticsearch/script/expression/ExpressionScriptEngineService.java
src/main/java/org/elasticsearch/script/groovy/GroovyScriptEngineService.java
src/main/java/org/elasticsearch/script/mustache/MustacheScriptEngineService.java
src/main/java/org/elasticsearch/search/SearchService.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/InternalSignificantTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantLongTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantStringTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/SignificanceHeuristic.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/SignificantTermsHeuristicModule.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/TransportSignificantTermsHeuristicModule.java
src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/InternalScriptedMetric.java
src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricParser.java
src/main/java/org/elasticsearch/search/fetch/innerhits/InnerHitsParseElement.java
src/main/java/org/elasticsearch/search/fetch/script/ScriptFieldsParseElement.java
src/main/java/org/elasticsearch/search/sort/ScriptSortParser.java
src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestParser.java
src/main/java/org/elasticsearch/snapshots/SnapshotsService.java
src/main/java/org/elasticsearch/transport/netty/NettyTransport.java
src/main/java/org/elasticsearch/transport/netty/SizeHeaderFrameDecoder.java
src/main/java/org/elasticsearch/tribe/TribeService.java
src/test/java/org/elasticsearch/benchmark/recovery/ReplicaRecoveryBenchmark.java
src/test/java/org/elasticsearch/cluster/NoMasterNodeTests.java
src/test/java/org/elasticsearch/cluster/settings/SettingsValidatorTests.java
src/test/java/org/elasticsearch/common/rounding/TimeZoneRoundingTests.java
src/test/java/org/elasticsearch/common/unit/TimeValueTests.java
src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsTests.java
src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryTests.java
src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTest.java
src/test/java/org/elasticsearch/gateway/DanglingIndicesStateTests.java
src/test/java/org/elasticsearch/gateway/GatewayIndexStateTests.java
src/test/java/org/elasticsearch/gateway/MetaDataStateFormatTest.java
src/test/java/org/elasticsearch/gateway/MetaStateServiceTests.java
src/test/java/org/elasticsearch/gateway/RecoveryFromGatewayTests.java
src/test/java/org/elasticsearch/index/IndexWithShadowReplicasTests.java
src/test/java/org/elasticsearch/index/engine/InternalEngineSettingsTest.java
src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
src/test/java/org/elasticsearch/index/engine/ShadowEngineTests.java
src/test/java/org/elasticsearch/index/mapper/TransformOnIndexMapperIntegrationTest.java
src/test/java/org/elasticsearch/index/mapper/ip/SimpleIpMappingTests.java
src/test/java/org/elasticsearch/index/query/TemplateQueryTest.java
src/test/java/org/elasticsearch/index/store/CorruptedFileTest.java
src/test/java/org/elasticsearch/index/translog/AbstractSimpleTranslogTests.java
src/test/java/org/elasticsearch/indices/IndicesServiceTest.java
src/test/java/org/elasticsearch/indices/memory/breaker/CircuitBreakerServiceTests.java
src/test/java/org/elasticsearch/indices/recovery/RecoveryStateTest.java
src/test/java/org/elasticsearch/indices/settings/UpdateSettingsTests.java
src/test/java/org/elasticsearch/indices/store/IndicesStoreIntegrationTests.java
src/test/java/org/elasticsearch/mlt/MoreLikeThisActionTests.java
src/test/java/org/elasticsearch/percolator/PercolatorTests.java
src/test/java/org/elasticsearch/script/GroovyScriptTests.java
src/test/java/org/elasticsearch/script/NativeScriptTests.java
src/test/java/org/elasticsearch/script/OnDiskScriptTests.java
src/test/java/org/elasticsearch/script/ScriptServiceTests.java
src/test/java/org/elasticsearch/script/expression/ExpressionScriptTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsSignificanceScoreTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/script/NativeSignificanceScoreScriptNoParams.java
src/test/java/org/elasticsearch/search/aggregations/bucket/script/NativeSignificanceScoreScriptWithParams.java
src/test/java/org/elasticsearch/search/aggregations/bucket/script/TestScript.java
src/test/java/org/elasticsearch/search/aggregations/bucket/significant/SignificanceHeuristicTests.java
src/test/java/org/elasticsearch/search/aggregations/metrics/ScriptedMetricTests.java
src/test/java/org/elasticsearch/search/child/SimpleChildQuerySearchTests.java
src/test/java/org/elasticsearch/search/innerhits/InnerHitsTests.java
src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchTests.java
src/test/java/org/elasticsearch/search/suggest/SuggestSearchTests.java
src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreTests.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
src/test/java/org/elasticsearch/test/ElasticsearchTestCase.java
src/test/java/org/elasticsearch/test/ExternalNode.java
src/test/java/org/elasticsearch/test/junit/rule/RepeatOnExceptionRule.java
src/test/java/org/elasticsearch/transport/NettySizeHeaderFrameDecoderTests.java
src/test/java/org/elasticsearch/tribe/TribeUnitTests.java
src/test/java/org/elasticsearch/update/UpdateByNativeScriptTests.java
src/test/java/org/elasticsearch/update/UpdateTests.java
comments:
Merge branch 'master' into feature/aggs_2_0

Conflicts:
	src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregator.java
	src/test/java/org/elasticsearch/search/aggregations/bucket/significant/SignificanceHeuristicTests.java

time:
2015-03-18T18:49:32Z
class:
comments:
Merge pull request #10143 from rmuir/bwcompat1

use bigger back compat indexes

time:
2015-03-18T18:29:41Z
class:
comments:
regenerate 0.90.x indexes without completion suggester

time:
2015-03-18T18:16:16Z
class:
comments:
Create bigger back compat indexes.

time:
2015-03-18T17:17:38Z
class:
src/test/java/org/elasticsearch/indices/store/IndicesStoreIntegrationTests.java
comments:
[TEST] muste test, we have an issue for it and know what is going on

time:
2015-03-18T16:59:28Z
class:
comments:
[release script] Check for //NORELEASE in code before release

Lines in the code that should be removed before a release can be annotated with
//NORELEASE . This can be useful when debugging test failures. For example,
one might want to add additional logging that would be too verbose for production
and therfore should be removed before releasing.

closes #10141

time:
2015-03-18T16:41:13Z
class:
src/main/java/org/elasticsearch/action/support/replication/TransportShardReplicationOperationAction.java
comments:
Fix typo in UnavailableShardsException message

Closes #10140

time:
2015-03-18T13:08:46Z
class:
src/test/java/org/elasticsearch/test/junit/rule/RepeatOnExceptionRule.java
comments:
[TEST] RepeatOnExceptionRule to rethrow unexpected exception

In case an exception was caught by the repeat rule, the retry mechanism would kick in only if the exception was the expected one. If not an NPE got thrown, while we should rather just bubble it up to the caller. This makes `NettyTransportMultiPortTests` run from a plane. An assumption would kick in to make sure that the test gets ignored but the `AssumptionViolationException` was caught and not properly re-thrown.

time:
2015-03-18T05:49:05Z
class:
src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java
src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AllocationDecider.java
src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AllocationDeciders.java
src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ClusterRebalanceAllocationDecider.java
comments:
[ALLOCATION] Early terminate if the cluster can't be rebalanced

By default we won't allow rebalance operation if no all shards are active.
if this is the case we don't need to worry about costly rebalance calculations at all.

time:
2015-03-18T01:26:41Z
class:
src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/RestoreSnapshotRequestBuilder.java
src/test/java/org/elasticsearch/index/IndexWithShadowReplicasTests.java
comments:
[TEST] Add test for restoring into a shadowreplica enabled index

time:
2015-03-17T23:44:09Z
class:
src/main/java/org/elasticsearch/common/http/client/HttpDownloadHelper.java
comments:
[PLUGINS] Always send current ES version when downloading plugins

to enable download servers to send the correct plugin version for the
node that is installing it this PR sends the current version as a header
to the server.

time:
2015-03-17T23:02:47Z
class:
src/main/java/org/elasticsearch/rest/action/cat/RestNodesAction.java
comments:
Merge pull request #9938 from drewr/issue/6297/cat/npe

_cat/nodes: Thread null handling through stats and info

time:
2015-03-17T22:27:39Z
class:
comments:
[BUILD] fix snapshot URL

time:
2015-03-17T21:40:37Z
class:
src/main/java/org/elasticsearch/transport/netty/NettyTransport.java
comments:
[TRANSPORT] Close all resources if doStart fails

Closes #9898

time:
2015-03-17T20:53:34Z
class:
src/test/java/org/elasticsearch/search/aggregations/reducers/DerivativeTests.java
comments:
Add randomiziation to test for derivative aggregation

time:
2015-03-17T18:27:13Z
class:
comments:
Small grammar fix.

time:
2015-03-17T16:47:24Z
class:
src/main/java/org/elasticsearch/transport/netty/NettyTransport.java
src/main/java/org/elasticsearch/transport/netty/SizeHeaderFrameDecoder.java
src/test/java/org/elasticsearch/transport/NettySizeHeaderFrameDecoderTests.java
comments:
Transport: Return useful error message on potential HTTP connect

In case a HTTP client connects to the transport protocol and issues a
HTTP method followed by a space, we can just try to be smart and return
a string back to the client to point the user to the fact that the wrong
port has been used.

Closes #2139
Closes #10108

time:
2015-03-17T14:31:29Z
class:
src/main/java/org/elasticsearch/index/gateway/IndexShardGateway.java
src/main/java/org/elasticsearch/index/gateway/IndexShardGatewayService.java
src/main/java/org/elasticsearch/index/snapshots/IndexShardSnapshotAndRestoreService.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryCleanFilesRequest.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryFileChunkRequest.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryFilesInfoRequest.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryPrepareForTranslogOperationsRequest.java
src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryState.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryTranslogOperationsRequest.java
src/main/java/org/elasticsearch/rest/action/cat/RestRecoveryAction.java
src/test/java/org/elasticsearch/benchmark/recovery/ReplicaRecoveryBenchmark.java
src/test/java/org/elasticsearch/index/store/CorruptedFileTest.java
src/test/java/org/elasticsearch/indices/recovery/RecoveryStateTest.java
comments:
Recovery: add total operations to the `_recovery` API

This commit adds the current total number of translog operations to the recovery reporting API. We also expose the recovered / total percentage:

```
"translog": {
   "recovered": 536,
   "total": 986,
   "percent": "54.3%",
   "total_time": "2ms",
   "total_time_in_millis": 2
},
```

Closes #9368
Closes #10042

time:
2015-03-17T05:59:49Z
class:
comments:
[BUILD] fix snapshot URL

time:
2015-03-17T00:25:55Z
class:
src/main/java/org/elasticsearch/percolator/PercolateContext.java
src/main/java/org/elasticsearch/percolator/PercolatorService.java
src/test/java/org/elasticsearch/percolator/PercolatorTests.java
comments:
percolator: Take filters from index aliases into account when selecting queries to run on a document.

The filter from an indexed alias is as if you would filter on the metadata of a percolator query, but then the filter is defined in the index alias instead of the percolate request.

Closes #6241

time:
2015-03-16T23:52:08Z
class:
comments:
create `es-1.5` branch

time:
2015-03-16T23:47:41Z
class:
comments:
create `es-1.5` branch

time:
2015-03-16T23:34:27Z
class:
comments:
create `es-1.5` branch

time:
2015-03-16T23:32:03Z
class:
comments:
create `es-1.5` branch

time:
2015-03-16T23:31:03Z
class:
src/main/java/org/elasticsearch/index/query/NestedQueryParser.java
src/main/java/org/elasticsearch/index/query/support/NestedInnerQueryParseSupport.java
src/main/java/org/elasticsearch/index/query/support/NestedScope.java
src/main/java/org/elasticsearch/search/fetch/innerhits/InnerHitsParseElement.java
src/test/java/org/elasticsearch/search/innerhits/InnerHitsTests.java
comments:
inner_hits: Nested parent field should be resolved based on the parent inner hit definition, instead of the nested parent field in the mapping.

The behaviour is better in the case someone has multiple levels of nested object fields defined in the mapping and like to define a single inner_hits definition that is two or more levels deep.

If someone wants inner hits on a nested field that is 2 levels deep the following would need to be defined:

```
{
  ...
  "inner_hits" : {
     "path" : {
        "level1" : {
            "inner_hits" : {
               "path" : {
                  "level2" : {
                     "query" : { .... }
                  }
               }
            }
        }
     }
  }
}
```

With this change the above can be defined as:

```
{
  ...
  "inner_hits" : {
     "path" : {
        "level1.level2" : {
            "query" : { .... }
        }
     }
  }
}
```

Closes #9251

time:
2015-03-16T23:27:55Z
class:
comments:
create `es-1.5` branch

time:
2015-03-16T23:25:47Z
class:
comments:
create `es-1.5` branch

time:
2015-03-16T23:21:53Z
class:
comments:
create branch `es-1.5`

time:
2015-03-16T21:19:08Z
class:
comments:
Add license header to signature files

time:
2015-03-16T21:17:51Z
class:
comments:
[TEST] Ban @Seed from test

time:
2015-03-16T20:46:38Z
class:
comments:
Create `es-1.5` branch

time:
2015-03-16T20:43:53Z
class:
src/main/java/org/elasticsearch/index/mapper/core/NumberFieldMapper.java
src/test/java/org/elasticsearch/index/mapper/ip/SimpleIpMappingTests.java
comments:
Fixes ignore_malformed behaviour for ip fields

time:
2015-03-16T19:45:38Z
class:
comments:
Create `es-1.5` branch

time:
2015-03-16T19:42:08Z
class:
comments:
Create `es-1.5` branch

time:
2015-03-16T19:37:08Z
class:
src/main/java/org/elasticsearch/Build.java
src/test/java/org/elasticsearch/test/ExternalNode.java
comments:
Tests: improve logging of external node version and build

The BWC tests also run against a snapshot build of previous release branches. Upon a failure it's important to know what commit exactly was used.

Closes #10111

time:
2015-03-16T17:55:28Z
class:
src/main/java/org/elasticsearch/index/translog/TranslogStats.java
src/test/java/org/elasticsearch/index/translog/AbstractSimpleTranslogTests.java
comments:
Translog: stats fail to serialize size

Closes #10105

time:
2015-03-16T17:26:53Z
class:
src/main/java/org/elasticsearch/Version.java
comments:
[VERSION] Add [1.6.0]-SNAPSHOT

time:
2015-03-16T05:59:44Z
class:
src/main/java/org/elasticsearch/index/engine/ForceMergeFailedEngineException.java
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
src/test/java/org/elasticsearch/indices/settings/UpdateSettingsTests.java
src/test/java/org/elasticsearch/search/child/SimpleChildQuerySearchTests.java
src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchTests.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
comments:
Merge pull request #10102 from s1monw/remove_wait_for_merge

[ENGINE] Remove reflection call to waitForMerges

time:
2015-03-16T05:56:51Z
class:
src/main/java/org/elasticsearch/index/engine/ForceMergeFailedEngineException.java
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
src/test/java/org/elasticsearch/indices/settings/UpdateSettingsTests.java
src/test/java/org/elasticsearch/search/child/SimpleChildQuerySearchTests.java
src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchTests.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
comments:
[ENGINE] Remove reflection call to waitForMerges

Since the index writer is now final we can remove the readlock around
the forceMerge calls and use the official API to wait for merges.

time:
2015-03-16T04:43:55Z
class:
comments:
Docs: revise examples

time:
2015-03-16T04:17:46Z
class:
src/main/java/org/elasticsearch/index/analysis/JapaneseStopTokenFilterFactory.java
src/main/java/org/elasticsearch/plugin/analysis/kuromoji/AnalysisKuromojiPlugin.java
src/test/java/org/elasticsearch/index/analysis/KuromojiAnalysisTests.java
comments:
Add "ja_stop" filter

 * can use a predefined "_japanese_" stop words
 * can not use other predefined stop words
 * upgrade to lucene 5
 * add ja_stop to README

  Closes #45

time:
2015-03-16T03:25:43Z
class:
src/main/java/org/elasticsearch/cache/recycler/PageCacheRecycler.java
comments:
Internal: Fix PageCacheRecycler's max page size computation.

PageCacheRecycler was mistakenly using the maximum number of items per page
instead of the byte size of a page. This could result in higher memory usage
than configured.

Close #10077

time:
2015-03-16T02:57:21Z
class:
src/main/java/org/elasticsearch/common/rounding/TimeZoneRounding.java
src/test/java/org/elasticsearch/common/rounding/TimeZoneRoundingTests.java
comments:
Aggregations: Be lenient when converting local to utc time in time zone roundings

This solves a problem in the time zone rounding classes where time dates that
fall into a DST gap will cause joda time library to throw an exception.
Changing the conversion methods 'strict' option to false prevents this.

Closes #10025

time:
2015-03-16T00:48:17Z
class:
comments:
[TEST] Add `-Pdev` to the TESTING.asciidoc guide

time:
2015-03-15T21:45:41Z
class:
src/main/java/org/elasticsearch/cluster/settings/Validator.java
src/main/java/org/elasticsearch/index/engine/EngineConfig.java
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
src/main/java/org/elasticsearch/index/settings/IndexDynamicSettingsModule.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/main/java/org/elasticsearch/indices/memory/IndexingMemoryController.java
src/test/java/org/elasticsearch/benchmark/recovery/ReplicaRecoveryBenchmark.java
src/test/java/org/elasticsearch/cluster/settings/SettingsValidatorTests.java
src/test/java/org/elasticsearch/index/engine/InternalEngineSettingsTest.java
comments:
Engine: update index buffer size during recovery and allow configuring version map size.

To support real time gets, the engine keeps an in-memory map of recently index docs and their location in the translog. This is needed until documents become visible in Lucene. With 1.3.0, we have improved this map and made tightly integrated with refresh cycles in Lucene in order to keep the memory signature to a bare minimum. On top of that, if the version map grows above a 25% of the index buffer size, we proactively refresh in order to be able to trim the version map back to 0 (see #6363) . In the same release, we have fixed an issue where an update to the indexing buffer could result in an unwanted exception during recovery (#6667) . We solved this by waiting with updating the size of the index buffer until the shard was fully recovered. Sadly this two together can have a negative impact on the speed of translog recovery.

During the second phase of recovery we replay all operations that happened on the shard during the first phase of copying files. In parallel we start indexing new documents into the new created shard. At some point (phase 3 in the recovery), the translog replay starts to send operation which have already been indexed into the shard. The version map is crucial in being able to quickly detect this and skip the replayed operations, without hitting lucene. Sadly #6667 (only updating the index memory buffer once shard is started) means that a shard is using the default 64MB for it's index buffer, and thus only 16MB (25%) for the version map. This much less then the default index buffer size 10% of machine memory (shared between shards).

Since we don't flush anymore when updating the memory buffer, we can remove #6667 and update recovering shards as well. Also, we make the version map max size configurable, with the same default of 25% of the current index buffer.

Closes #10046

time:
2015-03-15T20:57:49Z
class:
src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsTests.java
comments:
Test: testClusterFormingWithASlowNode - make delays less aggressive
thanks!


time:
2015-03-14T21:11:44Z
class:
src/main/java/org/elasticsearch/index/engine/Engine.java
src/main/java/org/elasticsearch/index/engine/EngineConfig.java
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
src/main/java/org/elasticsearch/index/settings/IndexDynamicSettingsModule.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/test/java/org/elasticsearch/index/engine/InternalEngineSettingsTest.java
src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
src/test/java/org/elasticsearch/index/engine/ShadowEngineTests.java
src/test/java/org/elasticsearch/index/store/CorruptedFileTest.java
comments:
Core: remove index.fail_on_corruption setting

Now we always fail the engine if corruption is detected.

Closes #10092

time:
2015-03-14T20:18:10Z
class:
src/test/java/org/elasticsearch/search/suggest/SuggestSearchTests.java
comments:
[TEST] Fix test to use correct type in the mapping

time:
2015-03-14T13:53:42Z
class:
src/main/java/org/elasticsearch/index/engine/EngineConfig.java
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
src/main/java/org/elasticsearch/index/settings/IndexDynamicSettingsModule.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/test/java/org/elasticsearch/index/engine/InternalEngineSettingsTest.java
src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
Core: remove index.fail_on_merge_failure

Always fail the engine if an unexpected exception is hit during merge.

Closes #10088

time:
2015-03-13T19:59:40Z
class:
src/test/java/org/elasticsearch/script/ScriptServiceTests.java
comments:
[TEST] renamed variables in ScriptServiceTests

time:
2015-03-13T19:51:44Z
class:
src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
src/main/java/org/apache/lucene/queryparser/classic/QueryParserSettings.java
src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
src/main/java/org/elasticsearch/index/query/QueryStringQueryParser.java
src/main/java/org/elasticsearch/index/query/SimpleQueryParser.java
src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
src/main/java/org/elasticsearch/index/query/SimpleQueryStringParser.java
src/main/java/org/elasticsearch/rest/action/explain/RestExplainAction.java
src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
src/test/java/org/elasticsearch/count/query/CountQueryTests.java
src/test/java/org/elasticsearch/count/simple/SimpleCountTests.java
src/test/java/org/elasticsearch/exists/SimpleExistsTests.java
src/test/java/org/elasticsearch/search/query/SearchQueryTests.java
src/test/java/org/elasticsearch/search/query/SimpleQueryStringTests.java
src/test/java/org/elasticsearch/search/simple/SimpleSearchTests.java
comments:
Revert "[QUERY] Remove lowercase_expanded_terms and locale options"

This reverts commit d1f7bd97cb989d8d98e009ef71a72c7cac5077dd.

Ryan pointed out that this needs to work with the multi term query, so
additional analysis and tests should be added.

time:
2015-03-13T19:17:27Z
class:
src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
src/main/java/org/apache/lucene/queryparser/classic/QueryParserSettings.java
src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
src/main/java/org/elasticsearch/index/query/QueryStringQueryParser.java
src/main/java/org/elasticsearch/index/query/SimpleQueryParser.java
src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
src/main/java/org/elasticsearch/index/query/SimpleQueryStringParser.java
src/main/java/org/elasticsearch/rest/action/explain/RestExplainAction.java
src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
src/test/java/org/elasticsearch/count/query/CountQueryTests.java
src/test/java/org/elasticsearch/count/simple/SimpleCountTests.java
src/test/java/org/elasticsearch/exists/SimpleExistsTests.java
src/test/java/org/elasticsearch/search/query/SearchQueryTests.java
src/test/java/org/elasticsearch/search/query/SimpleQueryStringTests.java
src/test/java/org/elasticsearch/search/simple/SimpleSearchTests.java
comments:
[QUERY] Remove lowercase_expanded_terms and locale options

The analysis chain should be used instead of relying on this, as it is
confusing when dealing with different per-field analysers.

The `locale` option was only used for `lowercase_expanded_terms`, which,
once removed, is no longer needed, so it was removed as well.

Fixes #9978
Relates to #9973

time:
2015-03-13T17:59:01Z
class:
src/main/java/org/elasticsearch/index/merge/scheduler/ConcurrentMergeSchedulerProvider.java
comments:
Core: don't rethrow merge exceptions

We already 1) log the full exception, and 2) fail the engine.

Closes #10083

time:
2015-03-13T17:42:58Z
class:
src/main/java/org/elasticsearch/index/translog/fs/FsTranslog.java
comments:
Translog: make sure stats's op count and size are in sync

During translog flush there is a very small window where translog stats reports can be inconsistent.

Closes #10041

time:
2015-03-13T06:18:00Z
class:
src/main/java/org/elasticsearch/node/Node.java
src/main/java/org/elasticsearch/script/ScriptEngineService.java
src/main/java/org/elasticsearch/script/ScriptService.java
src/test/java/org/elasticsearch/script/OnDiskScriptTests.java
src/test/java/org/elasticsearch/script/ScriptServiceTests.java
comments:
Scripting: File scripts cache key to include language to prevent conflicts

The file scripts cache key should include the language of the script to prevent conflicts between scripts with same name but different extension (hence lang). Note that script engines can register multiple acronyms that may be used as lang at execution time (e.g. javascript and js are synonyms). We then need to make sure that the same script gets loaded no matter which of the acronyms is used at execution time. The problem didn't exist before this change ad the lang was simply ignored, while now we take it into account.

This change has also some positive effect on inline scripts caching. Up until now, the same script referred to with different acronyms would be compiled and cached multiple times, once per acronym. After this change every script gets compiled and cached only once, as we chose internally the acronym used as part of the cache key, no matter which one the user provides.

Closes #10033

time:
2015-03-12T22:28:50Z
class:
comments:
[DOCS] fix typo in scripting docs

time:
2015-03-12T19:11:20Z
class:
src/main/java/org/elasticsearch/index/shard/IndexShard.java
comments:
[SHARD] make assert less strict to ensure local node is not null

time:
2015-03-11T19:10:48Z
class:
src/main/java/org/elasticsearch/snapshots/SnapshotsService.java
src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreTests.java
comments:
Snapshot/Restore: delete operation should ignore finalizing shards on nodes that no longer exist

Related to #9924

time:
2015-03-10T15:21:34Z
class:
src/main/java/org/elasticsearch/index/query/BoolQueryBuilder.java
comments:
[DOCS] fix typo in BoolQueryBuilder javadocs

time:
2015-03-10T15:21:06Z
class:
comments:
[DOCS] add missing comma in percentile_rank aggregation example

time:
2015-03-10T15:20:20Z
class:
comments:
[DOCS] Adjusted geo_distance aggregation example

unit is not returned in the response, but we have key and an implicit from starting at 0 for the first bucket

time:
2015-03-10T15:19:57Z
class:
comments:
[DOCS] missing curly brace in ip_range aggregation example

time:
2015-03-09T22:45:26Z
class:
comments:
[doc] Cat API: show open and closed indices in _cat/indices

Related to #7936

time:
2015-03-09T21:19:11Z
class:
src/main/java/org/elasticsearch/cloud/aws/AwsEc2Service.java
src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
src/test/java/org/elasticsearch/repositories/s3/S3ProxiedSnapshotRestoreOverHttpsTest.java
comments:
Separate proxy traffic for ec2 and s3

Based on PR #178 by @paul-e-cooley. Thanks Paul!

In addition to:

```yaml
cloud:
    aws:
        protocol: https
        proxy_host: proxy1.company.com
        proxy_port: 8083
```

You can also set different proxies for `ec2` and `s3`:

```yaml
cloud:
    aws:
        s3:
            proxy_host: proxy1.company.com
            proxy_port: 8083
        ec2:
            proxy_host: proxy2.company.com
            proxy_port: 8083
```

PR rebased on master and lastest changes about component settings removal.
Documentation added.
Changes in tests. If a proxy is provided we run the tests, otherwise we ignore the test.

Closes #177.

time:
2015-03-09T18:12:45Z
class:
src/main/java/org/elasticsearch/index/shard/IndexShard.java
comments:
Improve reporting of assert in IndexShard

time:
2015-03-08T23:56:00Z
class:
src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
comments:
Fix extra logging parameter in RecoverySourceHandler

time:
2015-03-08T23:42:18Z
class:
src/test/java/org/elasticsearch/gateway/DanglingIndicesStateTests.java
src/test/java/org/elasticsearch/gateway/MetaStateServiceTests.java
comments:
fix test to close node environment
the resource check only fails on windows for some reason..., need to chase why...

time:
2015-03-08T20:24:07Z
class:
src/main/java/org/elasticsearch/gateway/DanglingIndicesState.java
src/main/java/org/elasticsearch/gateway/GatewayMetaState.java
src/main/java/org/elasticsearch/gateway/GatewayModule.java
src/main/java/org/elasticsearch/gateway/LocalAllocateDangledIndices.java
src/main/java/org/elasticsearch/gateway/MetaStateService.java
src/test/java/org/elasticsearch/gateway/DanglingIndicesStateTests.java
src/test/java/org/elasticsearch/gateway/GatewayIndexStateTests.java
src/test/java/org/elasticsearch/gateway/MetaDataStateFormatTest.java
src/test/java/org/elasticsearch/gateway/MetaStateServiceTests.java
src/test/java/org/elasticsearch/test/ElasticsearchTestCase.java
comments:
Remove dangling indices settings, always import it
Remove the settings around dangling indices, such as no import and timeout for deletion, we always want to import dangling indices for safety, and we should not allow to change the behavior. This also cleans up the code quite a bit.
closes #10016

time:
2015-03-08T17:55:02Z
class:
src/main/java/org/elasticsearch/index/gateway/IndexShardGatewayService.java
comments:
Gateway: improve assertion at the end of shard recovery

we want to make sure the recovery finished all the way to post recovery. Current check, validating the shard is either in POST_RECOVERY or STARTED is not good because the shard could be also closed if things go fast enough (like in our tests). The assertion is changed to check the shard is not left in CREATED or RECOVERING.

Closes #10028

time:
2015-03-07T09:01:34Z
class:
src/main/java/org/elasticsearch/index/query/ScriptFilterParser.java
src/main/java/org/elasticsearch/index/query/TemplateQueryBuilder.java
src/main/java/org/elasticsearch/index/query/TemplateQueryParser.java
src/main/java/org/elasticsearch/index/query/functionscore/script/ScriptScoreFunctionParser.java
src/main/java/org/elasticsearch/rest/action/template/RestDeleteSearchTemplateAction.java
src/main/java/org/elasticsearch/rest/action/template/RestGetSearchTemplateAction.java
src/main/java/org/elasticsearch/rest/action/template/RestPutSearchTemplateAction.java
src/main/java/org/elasticsearch/script/NativeScriptEngineService.java
src/main/java/org/elasticsearch/script/ScriptService.java
src/main/java/org/elasticsearch/script/SearchScript.java
src/main/java/org/elasticsearch/script/expression/ExpressionScriptEngineService.java
src/main/java/org/elasticsearch/script/groovy/GroovyScriptEngineService.java
src/main/java/org/elasticsearch/script/mustache/MustacheScriptEngineService.java
src/main/java/org/elasticsearch/search/SearchService.java
src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/InternalScriptedMetric.java
src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricParser.java
src/main/java/org/elasticsearch/search/fetch/script/ScriptFieldsParseElement.java
src/main/java/org/elasticsearch/search/sort/ScriptSortParser.java
src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestParser.java
src/test/java/org/elasticsearch/cluster/NoMasterNodeTests.java
src/test/java/org/elasticsearch/index/mapper/TransformOnIndexMapperIntegrationTest.java
src/test/java/org/elasticsearch/index/query/TemplateQueryTest.java
src/test/java/org/elasticsearch/script/GroovyScriptTests.java
src/test/java/org/elasticsearch/script/NativeScriptTests.java
src/test/java/org/elasticsearch/script/ScriptServiceTests.java
src/test/java/org/elasticsearch/script/expression/ExpressionScriptTests.java
src/test/java/org/elasticsearch/search/aggregations/metrics/ScriptedMetricTests.java
src/test/java/org/elasticsearch/update/UpdateByNativeScriptTests.java
src/test/java/org/elasticsearch/update/UpdateTests.java
comments:
Scripting: cleanup ScriptService & friends in preparation for #6418

- Added NAME constants for each script language, avoiding to repeat the same strings all over the place.
- Simplified `compile` method signatures by removing a couple of variants. Note that all of these signatures are going to change again with #6418 as in order to compile/execute a script the caller will need to specify which operation is attempting to execute the script, info that will be provided as an additional mandatory argument.
- Removed double call to ScriptService#verifyDynamicScripting for every indexed or dynamic script.
- Decreased ScriptService inner classes visibility to private (CacheKey, IndexedScript, ApplySettings)
- Moved ScriptService inner classes to the bottom of the class, I think it makes it more readable.
- Resolved some compiler warnings

Closes #9992

time:
2015-03-07T08:26:46Z
class:
src/main/java/org/elasticsearch/tribe/TribeService.java
src/test/java/org/elasticsearch/tribe/TribeUnitTests.java
comments:
Tribe node: system properties and configuration settings must not be forwarded to tribe clients

The tribe node, at startup, sets up the tribe clients that will join their corresponding tribes. All of the tribe.* settings are properly forwarded to the corresponding tribe client. System properties and global configuration settings must not be forwarded to the tribe client though or they will end up overriding per tribe settings with same name causing issues.

 For instance if you set the transport.tcp.port to some defined value for the tribe node, via system property or configuration file, that same value must not be forwarded to the tribe clients, otherwise they will try and use the same port, which will be already occupied by the tribe node itself, resulting in startup failed. Same for cluster.name, which will cause the tribe clients not to join their tribes.

Closes #9576
Closes #9721

time:
2015-03-06T21:00:31Z
class:
src/main/java/org/elasticsearch/common/unit/TimeValue.java
src/test/java/org/elasticsearch/common/unit/TimeValueTests.java
comments:
Internal: Fix equality check of timevalue after serialization

closes #9218

time:
2015-03-06T20:21:29Z
class:
src/main/java/org/elasticsearch/rest/action/cat/RestShardsAction.java
comments:
Mark shadow replicas with 's' in _cat/shards output

Fixes #9772

time:
2015-03-06T18:23:41Z
class:
src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java
src/main/java/org/elasticsearch/index/mapper/MapperParsingException.java
src/main/java/org/elasticsearch/index/mapper/StrictDynamicMappingException.java
src/main/java/org/elasticsearch/index/mapper/core/AbstractFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/IdFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/object/ObjectMapper.java
src/main/java/org/elasticsearch/index/mapper/object/RootObjectMapper.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/test/java/org/elasticsearch/index/mapper/dynamic/DynamicMappingTests.java
comments:
Revert "[mappings] update dynamic fields in mapping on master even if parsing fails for the rest of doc"

This reverts commit d9a15409488b0112eb11b5b39dab21b5c0096349.

time:
2015-03-06T17:28:33Z
class:
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsSignificanceScoreTests.java
comments:
[significant terms] Use 'script_file' instead of 'script' if the script is a file

time:
2015-03-06T16:06:04Z
class:
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/InternalSignificantTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantLongTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantStringTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/SignificanceHeuristic.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/SignificantTermsHeuristicModule.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/TransportSignificantTermsHeuristicModule.java
src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsSignificanceScoreTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/script/NativeSignificanceScoreScriptNoParams.java
src/test/java/org/elasticsearch/search/aggregations/bucket/script/NativeSignificanceScoreScriptWithParams.java
src/test/java/org/elasticsearch/search/aggregations/bucket/script/TestScript.java
src/test/java/org/elasticsearch/search/aggregations/bucket/significant/SignificanceHeuristicTests.java
comments:
significant terms: add scriptable significance heuristic

This commit adds scripting capability to significant_terms.
Custom heuristics can be implemented with a script that provides
parameters subset_freq, superset_freq,subset_size, superset_size.

closes #7850

time:
2015-03-06T14:35:23Z
class:
src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java
src/main/java/org/elasticsearch/index/mapper/MapperParsingException.java
src/main/java/org/elasticsearch/index/mapper/StrictDynamicMappingException.java
src/main/java/org/elasticsearch/index/mapper/core/AbstractFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/IdFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/object/ObjectMapper.java
src/main/java/org/elasticsearch/index/mapper/object/RootObjectMapper.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/test/java/org/elasticsearch/index/mapper/dynamic/DynamicMappingTests.java
comments:
[mappings] update dynamic fields in mapping on master even if parsing fails for the rest of doc

The local DocumentMapper is updated while parsing and dynamic fields are added before
parsing has finished. If parsing fails after a dynamic field has been added already
then the field was not added to the cluster state but was present in the local mapper of this
node. New documents with the same field would not necessarily cause an update either and
after restarting the node the mapping for these fields were lost. Instead the new fields
should always be updated.

closes #9851
closes #9874

time:
2015-03-06T12:50:34Z
class:
src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsTests.java
comments:
Tests: wait for discovery to be completed after both majority nodes follow a new master

time:
2015-03-06T12:39:53Z
class:
src/main/java/org/elasticsearch/gateway/GatewayMetaState.java
src/main/java/org/elasticsearch/indices/IndicesService.java
src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
src/main/java/org/elasticsearch/indices/store/IndicesStore.java
src/test/java/org/elasticsearch/indices/IndicesServiceTest.java
comments:
Use provided cluster state for indices service validations
Since the method can be called in an #execute event of the cluster service, we need the ability to use the cluster state that will be provided in the ClusterChangedEvent, have the ClusterState be provided as a parameter

time:
2015-03-06T11:41:53Z
class:
src/main/java/org/elasticsearch/common/lucene/Lucene.java
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
src/main/java/org/elasticsearch/index/engine/ShadowEngine.java
comments:
Fix Java 8 _ variable warning
The _ variable causes a warning when compiling with Java 8, noting that it might be removed in a future version

time:
2015-03-06T10:54:27Z
class:
src/test/java/org/elasticsearch/mlt/MoreLikeThisActionTests.java
comments:
[TEST] Reduce the number of fields in MLT tests

time:
2015-03-06T10:18:24Z
class:
src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsTests.java
comments:
Tests: added more logging

time:
2015-03-06T09:42:29Z
class:
src/test/java/org/elasticsearch/gateway/GatewayIndexStateTests.java
comments:
[TEST] wait until mappings are added to cluster state to make sure they are persisted

time:
2015-03-06T07:47:32Z
class:
src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
src/main/java/org/elasticsearch/discovery/zen/publish/PublishClusterStateAction.java
src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsTests.java
src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryTests.java
src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTest.java
comments:
Zen: Node receiving a cluster state with a wrong master node should reject and throw an error.

Previously it was ignored and the publish cluster state timeout would kick in. In that case a stale master node would just wait for the inevitable and waste valuable time.
This issue was discovered by the DiscoveryWithServiceDisruptionsTests#testStaleMasterNotHijackingMajority test.

Also only perform cluster state versions and wrong master node check inside cluster state update task.

time:
2015-03-06T05:13:05Z
class:
src/test/java/org/elasticsearch/indices/memory/breaker/CircuitBreakerServiceTests.java
comments:
Revert "[TESTS] remove AwaitsFix from CircuitBreakerServiceTests"

This reverts commit 21e246f6a314e75aa753d79709044970a9e21877.

time:
2015-03-05T21:16:21Z
class:
src/main/java/org/elasticsearch/index/engine/ShadowEngine.java
comments:
[ENGINE] Inc store reference before reading segments info

If a tragic even happens while we are reading the segments info from the
store the store might have been closed concurrently. We had this
behavior before and was lost in a refactoring.

time:
2015-03-05T20:41:01Z
class:
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
comments:
[ENGINE] Inc store reference before reading segments info

If a tragic even happens while we are reading the segments info
from the store the store might have been closed concurrently. We had this behavior
before and was lost in a refactoring.

time:
2015-03-05T19:32:23Z
class:
src/test/java/org/elasticsearch/gateway/RecoveryFromGatewayTests.java
comments:
Test: added health call to will hold when wait when there is a cluster block, so that the refresh call doesn't fail if that is the case.

time:
2015-03-05T15:00:47Z
class:
src/main/java/org/elasticsearch/search/aggregations/reducers/BucketHelpers.java
comments:
Add header to BucketHelpers class

time:
2015-03-05T14:50:07Z
class:
src/main/java/org/elasticsearch/search/aggregations/reducers/BucketHelpers.java
src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeBuilder.java
src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeParser.java
src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeReducer.java
src/test/java/org/elasticsearch/search/aggregations/reducers/DerivativeTests.java
comments:
Move GapPolicy and resolveBucketValues() to static helper methods

Will allow many reducers to share the same helper functionality without repeating code.  Chose
to put these in static helpers instead of adding to Reducer base class.  I can imagine other reducers
that aren't time-based (or don't care about contiguous buckets), which would make things like
gap policy useless.

Since these seemed more like helpers than inherent traits of a Reducer, they went into their own
static class.

Closes #9954

time:
2015-03-05T14:48:41Z
class:
src/main/java/org/elasticsearch/indices/IndicesService.java
src/main/java/org/elasticsearch/indices/store/IndicesStore.java
src/test/java/org/elasticsearch/indices/store/IndicesStoreIntegrationTests.java
comments:
Store: Delete index folder if all shards were allocated away from a data only node

If a folder for an index was created that folder is never deleted from that node unless the index is deleted.
Data only nodes therefore can have empty folders for indices that they do not even have shards for.
This commit makes sure empty folders are cleaned up after all shards have moved away from a data only
node. The behavior is unchanged for master eligible nodes.

closes #9985

time:
2015-03-05T11:28:08Z
class:
comments:
 fixing typo in expDecayFunction and adding offset to all dacay functions

closes #9887

time:
2015-03-05T11:09:49Z
class:
comments:
[DOCS] update JAVA API with aggregation changes

The Histogram and Range APIs for the aggregations changed so that there was a common interface between he types of Range/Histogram. This PR reflects that change in the Java API docs

Contributes to #9976

time:
2015-03-05T10:29:22Z
class:
src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramTests.java
comments:
[TEST] removed custom index settings for all DateHistogram tests

In favour of randomising number of shards and replicas and only the extended bounds test sets number of shards and replicas explicitly

time:
2015-03-04T20:25:10Z
class:
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
comments:
Core: throttle delete-by-query when merges are falling behind

Delete-by-query is incredibly costly because it forces a refresh each
time, so if you are also indexing this can cause massive segment
explosion.

This change throttles delete-by-query when merges can't keep up.  It's
likely not enough (#7052 is the long-term solution) but can only
help.

Closes #9986

time:
2015-03-04T14:49:49Z
class:
src/test/java/org/elasticsearch/indices/store/IndicesStoreIntegrationTests.java
comments:
[TEST] make sure update task is actually executed

The update task that was submitted in this test never got executed
if node_2 was not master.

time:
2015-03-04T14:33:28Z
class:
src/test/java/org/elasticsearch/index/IndexWithShadowReplicasTests.java
comments:
Revert "[TEST] Enable trace logging for translog recovery"

This reverts commit 52d53e658f786d1e0717c3f63676de00426599cb.

time:
2015-03-04T14:07:59Z
class:
src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsTests.java
comments:
Test: muted testStaleMasterNotHijackingMajority

time:
2015-03-04T13:50:23Z
class:
src/main/java/org/elasticsearch/action/search/type/TransportSearchTypeAction.java
comments:
Search: fixed log to print throwable correctly

In TransportSearchTypeAction one of the logger calls was passing the throwable in as a parameter for the message rather than a throwable to be printed as a stack trace. This change fixes it so the throwable is printed properly

time:
2015-03-04T10:49:46Z
class:
src/main/java/org/apache/lucene/queries/BlendedTermQuery.java
src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
src/main/java/org/apache/lucene/search/postingshighlight/XPostingsHighlighter.java
src/main/java/org/apache/lucene/search/suggest/analyzing/XAnalyzingSuggester.java
src/main/java/org/apache/lucene/search/vectorhighlight/CustomFieldQuery.java
src/main/java/org/elasticsearch/ElasticsearchException.java
src/main/java/org/elasticsearch/Version.java
src/main/java/org/elasticsearch/action/ActionModule.java
src/main/java/org/elasticsearch/action/ActionRunnable.java
src/main/java/org/elasticsearch/action/ActionWriteResponse.java
src/main/java/org/elasticsearch/action/WriteFailureException.java
src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthResponse.java
src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterIndexHealth.java
src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java
src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoResponse.java
src/main/java/org/elasticsearch/action/admin/cluster/node/restart/NodesRestartAction.java
src/main/java/org/elasticsearch/action/admin/cluster/node/restart/NodesRestartRequest.java
src/main/java/org/elasticsearch/action/admin/cluster/node/restart/NodesRestartRequestBuilder.java
src/main/java/org/elasticsearch/action/admin/cluster/node/restart/NodesRestartResponse.java
src/main/java/org/elasticsearch/action/admin/cluster/node/restart/TransportNodesRestartAction.java
src/main/java/org/elasticsearch/action/admin/cluster/node/shutdown/TransportNodesShutdownAction.java
src/main/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteResponse.java
src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/GetSnapshotsRequest.java
src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/GetSnapshotsRequestBuilder.java
src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/TransportGetSnapshotsAction.java
src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateResponse.java
src/main/java/org/elasticsearch/action/admin/indices/cache/clear/ClearIndicesCacheRequest.java
src/main/java/org/elasticsearch/action/admin/indices/exists/types/TypesExistsRequest.java
src/main/java/org/elasticsearch/action/admin/indices/exists/types/TypesExistsRequestBuilder.java
src/main/java/org/elasticsearch/action/admin/indices/exists/types/TypesExistsResponse.java
src/main/java/org/elasticsearch/action/admin/indices/mapping/get/TransportGetFieldMappingsIndexAction.java
src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java
src/main/java/org/elasticsearch/action/admin/indices/optimize/OptimizeRequest.java
src/main/java/org/elasticsearch/action/admin/indices/recovery/RecoveryResponse.java
src/main/java/org/elasticsearch/action/admin/indices/recovery/ShardRecoveryResponse.java
src/main/java/org/elasticsearch/action/admin/indices/recovery/TransportRecoveryAction.java
src/main/java/org/elasticsearch/action/admin/indices/settings/get/TransportGetSettingsAction.java
src/main/java/org/elasticsearch/action/bench/BenchmarkExecutor.java
src/main/java/org/elasticsearch/action/bench/BenchmarkService.java
src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
src/main/java/org/elasticsearch/action/delete/DeleteRequest.java
src/main/java/org/elasticsearch/action/delete/DeleteRequestBuilder.java
src/main/java/org/elasticsearch/action/deletebyquery/DeleteByQueryRequest.java
src/main/java/org/elasticsearch/action/deletebyquery/DeleteByQueryRequestBuilder.java
src/main/java/org/elasticsearch/action/explain/ExplainAction.java
src/main/java/org/elasticsearch/action/explain/ExplainRequestBuilder.java
src/main/java/org/elasticsearch/action/explain/ExplainResponse.java
src/main/java/org/elasticsearch/action/explain/TransportExplainAction.java
src/main/java/org/elasticsearch/action/get/TransportGetAction.java
src/main/java/org/elasticsearch/action/index/IndexRequest.java
src/main/java/org/elasticsearch/action/index/IndexRequestBuilder.java
src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
src/main/java/org/elasticsearch/action/search/SearchResponse.java
src/main/java/org/elasticsearch/action/search/ShardSearchFailure.java
src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
src/main/java/org/elasticsearch/action/support/AbstractListenableActionFuture.java
src/main/java/org/elasticsearch/action/support/HandledTransportAction.java
src/main/java/org/elasticsearch/action/support/QuerySourceBuilder.java
src/main/java/org/elasticsearch/action/support/master/TransportMasterNodeReadOperationAction.java
src/main/java/org/elasticsearch/action/support/replication/TransportShardReplicationOperationAction.java
src/main/java/org/elasticsearch/action/termvectors/TermVectorsFields.java
src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java
src/main/java/org/elasticsearch/action/termvectors/TermVectorsResponse.java
src/main/java/org/elasticsearch/action/termvectors/TermVectorsWriter.java
src/main/java/org/elasticsearch/action/update/UpdateRequest.java
src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
src/main/java/org/elasticsearch/cache/recycler/PageCacheRecycler.java
src/main/java/org/elasticsearch/client/ClusterAdminClient.java
src/main/java/org/elasticsearch/client/Requests.java
src/main/java/org/elasticsearch/client/support/AbstractClient.java
src/main/java/org/elasticsearch/client/support/AbstractClusterAdminClient.java
src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java
src/main/java/org/elasticsearch/cluster/ClusterService.java
src/main/java/org/elasticsearch/cluster/ClusterState.java
src/main/java/org/elasticsearch/cluster/DiskUsage.java
src/main/java/org/elasticsearch/cluster/ack/ClusterStateUpdateRequest.java
src/main/java/org/elasticsearch/cluster/action/index/NodeIndexDeletedAction.java
src/main/java/org/elasticsearch/cluster/block/ClusterBlock.java
src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java
src/main/java/org/elasticsearch/cluster/routing/ImmutableShardRouting.java
src/main/java/org/elasticsearch/cluster/routing/MutableShardRouting.java
src/main/java/org/elasticsearch/cluster/routing/RoutingNode.java
src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java
src/main/java/org/elasticsearch/cluster/routing/RoutingService.java
src/main/java/org/elasticsearch/cluster/routing/ShardIterator.java
src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationService.java
src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java
src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AllocationDeciders.java
src/main/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDecider.java
src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ReplicaAfterPrimaryActiveAllocationDecider.java
src/main/java/org/elasticsearch/cluster/routing/allocation/decider/SnapshotInProgressAllocationDecider.java
src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ThrottlingAllocationDecider.java
src/main/java/org/elasticsearch/cluster/service/InternalClusterService.java
src/main/java/org/elasticsearch/common/Priority.java
src/main/java/org/elasticsearch/common/blobstore/fs/FsBlobContainer.java
src/main/java/org/elasticsearch/common/blobstore/fs/FsBlobStore.java
src/main/java/org/elasticsearch/common/blobstore/url/URLBlobStore.java
src/main/java/org/elasticsearch/common/breaker/ChildMemoryCircuitBreaker.java
src/main/java/org/elasticsearch/common/breaker/MemoryCircuitBreaker.java
src/main/java/org/elasticsearch/common/cli/CheckFileCommand.java
src/main/java/org/elasticsearch/common/collect/IdentityHashSet.java
src/main/java/org/elasticsearch/common/component/AbstractComponent.java
src/main/java/org/elasticsearch/common/component/AbstractLifecycleComponent.java
src/main/java/org/elasticsearch/common/geo/GeoPoint.java
src/main/java/org/elasticsearch/common/geo/builders/GeometryCollectionBuilder.java
src/main/java/org/elasticsearch/common/http/client/HttpDownloadHelper.java
src/main/java/org/elasticsearch/common/inject/AbstractModule.java
src/main/java/org/elasticsearch/common/inject/AbstractProcessor.java
src/main/java/org/elasticsearch/common/inject/BindingProcessor.java
src/main/java/org/elasticsearch/common/inject/BoundProviderFactory.java
src/main/java/org/elasticsearch/common/inject/ConstantFactory.java
src/main/java/org/elasticsearch/common/inject/ConstructorBindingImpl.java
src/main/java/org/elasticsearch/common/inject/ConstructorInjectorStore.java
src/main/java/org/elasticsearch/common/inject/DefaultConstructionProxyFactory.java
src/main/java/org/elasticsearch/common/inject/DeferredLookups.java
src/main/java/org/elasticsearch/common/inject/EncounterImpl.java
src/main/java/org/elasticsearch/common/inject/ExposedKeyFactory.java
src/main/java/org/elasticsearch/common/inject/FactoryProxy.java
src/main/java/org/elasticsearch/common/inject/InheritingState.java
src/main/java/org/elasticsearch/common/inject/Initializables.java
src/main/java/org/elasticsearch/common/inject/Initializer.java
src/main/java/org/elasticsearch/common/inject/InjectionRequestProcessor.java
src/main/java/org/elasticsearch/common/inject/InjectorBuilder.java
src/main/java/org/elasticsearch/common/inject/InjectorImpl.java
src/main/java/org/elasticsearch/common/inject/InjectorShell.java
src/main/java/org/elasticsearch/common/inject/InternalFactoryToProviderAdapter.java
src/main/java/org/elasticsearch/common/inject/Key.java
src/main/java/org/elasticsearch/common/inject/MembersInjectorImpl.java
src/main/java/org/elasticsearch/common/inject/PrivateBinder.java
src/main/java/org/elasticsearch/common/inject/PrivateModule.java
src/main/java/org/elasticsearch/common/inject/ProviderToInternalFactoryAdapter.java
src/main/java/org/elasticsearch/common/inject/Scope.java
src/main/java/org/elasticsearch/common/inject/Scopes.java
src/main/java/org/elasticsearch/common/inject/SingleFieldInjector.java
src/main/java/org/elasticsearch/common/inject/SingleMethodInjector.java
src/main/java/org/elasticsearch/common/inject/State.java
src/main/java/org/elasticsearch/common/inject/TypeConverterBindingProcessor.java
src/main/java/org/elasticsearch/common/inject/assistedinject/FactoryProvider.java
src/main/java/org/elasticsearch/common/inject/assistedinject/FactoryProvider2.java
src/main/java/org/elasticsearch/common/inject/internal/BindingBuilder.java
src/main/java/org/elasticsearch/common/inject/internal/BindingImpl.java
src/main/java/org/elasticsearch/common/inject/internal/ConstantBindingBuilderImpl.java
src/main/java/org/elasticsearch/common/inject/internal/ConstructionContext.java
src/main/java/org/elasticsearch/common/inject/internal/Errors.java
src/main/java/org/elasticsearch/common/inject/internal/ExposedBindingImpl.java
src/main/java/org/elasticsearch/common/inject/internal/ExposureBuilder.java
src/main/java/org/elasticsearch/common/inject/internal/InstanceBindingImpl.java
src/main/java/org/elasticsearch/common/inject/internal/LinkedBindingImpl.java
src/main/java/org/elasticsearch/common/inject/internal/LinkedProviderBindingImpl.java
src/main/java/org/elasticsearch/common/inject/internal/MoreTypes.java
src/main/java/org/elasticsearch/common/inject/internal/PrivateElementsImpl.java
src/main/java/org/elasticsearch/common/inject/internal/ProviderInstanceBindingImpl.java
src/main/java/org/elasticsearch/common/inject/internal/ProviderMethod.java
src/main/java/org/elasticsearch/common/inject/internal/ProviderMethodsModule.java
src/main/java/org/elasticsearch/common/inject/internal/Scoping.java
src/main/java/org/elasticsearch/common/inject/internal/UniqueAnnotations.java
src/main/java/org/elasticsearch/common/inject/internal/UntargettedBindingImpl.java
src/main/java/org/elasticsearch/common/inject/matcher/AbstractMatcher.java
src/main/java/org/elasticsearch/common/inject/matcher/Matchers.java
src/main/java/org/elasticsearch/common/inject/multibindings/MapBinder.java
src/main/java/org/elasticsearch/common/inject/multibindings/Multibinder.java
src/main/java/org/elasticsearch/common/inject/multibindings/RealElement.java
src/main/java/org/elasticsearch/common/inject/name/NamedImpl.java
src/main/java/org/elasticsearch/common/inject/spi/ConvertedConstantBinding.java
src/main/java/org/elasticsearch/common/inject/spi/DefaultBindingScopingVisitor.java
src/main/java/org/elasticsearch/common/inject/spi/DefaultBindingTargetVisitor.java
src/main/java/org/elasticsearch/common/inject/spi/DefaultElementVisitor.java
src/main/java/org/elasticsearch/common/inject/spi/Elements.java
src/main/java/org/elasticsearch/common/inject/spi/ExposedBinding.java
src/main/java/org/elasticsearch/common/inject/spi/InjectionPoint.java
src/main/java/org/elasticsearch/common/inject/spi/InjectionRequest.java
src/main/java/org/elasticsearch/common/inject/spi/MembersInjectorLookup.java
src/main/java/org/elasticsearch/common/inject/spi/Message.java
src/main/java/org/elasticsearch/common/inject/spi/ProviderLookup.java
src/main/java/org/elasticsearch/common/inject/spi/ScopeBinding.java
src/main/java/org/elasticsearch/common/inject/spi/StaticInjectionRequest.java
src/main/java/org/elasticsearch/common/inject/spi/TypeConverterBinding.java
src/main/java/org/elasticsearch/common/inject/spi/TypeListenerBinding.java
src/main/java/org/elasticsearch/common/inject/util/Modules.java
src/main/java/org/elasticsearch/common/inject/util/Providers.java
src/main/java/org/elasticsearch/common/io/FastCharArrayReader.java
src/main/java/org/elasticsearch/common/io/FastCharArrayWriter.java
src/main/java/org/elasticsearch/common/io/FastStringReader.java
src/main/java/org/elasticsearch/common/io/FileSystemUtils.java
src/main/java/org/elasticsearch/common/io/ReleasableBytesStream.java
src/main/java/org/elasticsearch/common/io/UTF8StreamWriter.java
src/main/java/org/elasticsearch/common/io/stream/BytesStreamOutput.java
src/main/java/org/elasticsearch/common/io/stream/StreamInput.java
src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java
src/main/java/org/elasticsearch/common/jna/Kernel32Library.java
src/main/java/org/elasticsearch/common/joda/DateMathParser.java
src/main/java/org/elasticsearch/common/joda/Joda.java
src/main/java/org/elasticsearch/common/lease/Releasable.java
src/main/java/org/elasticsearch/common/logging/jdk/ESLogRecord.java
src/main/java/org/elasticsearch/common/logging/log4j/ConsoleAppender.java
src/main/java/org/elasticsearch/common/logging/log4j/Log4jESLogger.java
src/main/java/org/elasticsearch/common/lucene/Directories.java
src/main/java/org/elasticsearch/common/lucene/LoggerInfoStream.java
src/main/java/org/elasticsearch/common/lucene/Lucene.java
src/main/java/org/elasticsearch/common/lucene/all/AllEntries.java
src/main/java/org/elasticsearch/common/lucene/all/AllTermQuery.java
src/main/java/org/elasticsearch/common/lucene/index/ElasticsearchDirectoryReader.java
src/main/java/org/elasticsearch/common/lucene/index/FilterableTermsEnum.java
src/main/java/org/elasticsearch/common/lucene/index/FreqTermsEnum.java
src/main/java/org/elasticsearch/common/lucene/search/AndFilter.java
src/main/java/org/elasticsearch/common/lucene/search/EmptyScorer.java
src/main/java/org/elasticsearch/common/lucene/search/FilteredCollector.java
src/main/java/org/elasticsearch/common/lucene/search/LimitFilter.java
src/main/java/org/elasticsearch/common/lucene/search/MatchAllDocsFilter.java
src/main/java/org/elasticsearch/common/lucene/search/MatchNoDocsFilter.java
src/main/java/org/elasticsearch/common/lucene/search/MatchNoDocsQuery.java
src/main/java/org/elasticsearch/common/lucene/search/NoCacheFilter.java
src/main/java/org/elasticsearch/common/lucene/search/NotFilter.java
src/main/java/org/elasticsearch/common/lucene/search/OrFilter.java
src/main/java/org/elasticsearch/common/lucene/search/Queries.java
src/main/java/org/elasticsearch/common/lucene/search/RegexpFilter.java
src/main/java/org/elasticsearch/common/lucene/search/XBooleanFilter.java
src/main/java/org/elasticsearch/common/lucene/search/XMoreLikeThis.java
src/main/java/org/elasticsearch/common/lucene/search/function/CustomBoostFactorScorer.java
src/main/java/org/elasticsearch/common/lucene/search/function/FiltersFunctionScoreQuery.java
src/main/java/org/elasticsearch/common/lucene/search/function/FunctionScoreQuery.java
src/main/java/org/elasticsearch/common/lucene/search/function/ScriptScoreFunction.java
src/main/java/org/elasticsearch/common/lucene/uid/PerThreadIDAndVersionLookup.java
src/main/java/org/elasticsearch/common/netty/OpenChannelsHandler.java
src/main/java/org/elasticsearch/common/network/MulticastChannel.java
src/main/java/org/elasticsearch/common/recycler/AbstractRecycler.java
src/main/java/org/elasticsearch/common/recycler/AbstractRecyclerC.java
src/main/java/org/elasticsearch/common/settings/ImmutableSettings.java
src/main/java/org/elasticsearch/common/settings/Settings.java
src/main/java/org/elasticsearch/common/settings/SettingsFilter.java
src/main/java/org/elasticsearch/common/text/Text.java
src/main/java/org/elasticsearch/common/text/UTF8SortedAsUnicodeComparator.java
src/main/java/org/elasticsearch/common/unit/Percent.java
src/main/java/org/elasticsearch/common/unit/RatioValue.java
src/main/java/org/elasticsearch/common/util/AbstractBigArray.java
src/main/java/org/elasticsearch/common/util/AbstractHash.java
src/main/java/org/elasticsearch/common/util/BigArrays.java
src/main/java/org/elasticsearch/common/util/BigByteArray.java
src/main/java/org/elasticsearch/common/util/BigDoubleArray.java
src/main/java/org/elasticsearch/common/util/BigFloatArray.java
src/main/java/org/elasticsearch/common/util/BigIntArray.java
src/main/java/org/elasticsearch/common/util/BigLongArray.java
src/main/java/org/elasticsearch/common/util/BigObjectArray.java
src/main/java/org/elasticsearch/common/util/MinimalMap.java
src/main/java/org/elasticsearch/common/util/concurrent/AbstractRunnable.java
src/main/java/org/elasticsearch/common/util/concurrent/ConcurrentHashMapLong.java
src/main/java/org/elasticsearch/common/util/concurrent/EsExecutors.java
src/main/java/org/elasticsearch/common/util/concurrent/PrioritizedEsThreadPoolExecutor.java
src/main/java/org/elasticsearch/common/util/concurrent/ThreadBarrier.java
src/main/java/org/elasticsearch/common/xcontent/XContentBuilder.java
src/main/java/org/elasticsearch/discovery/local/LocalDiscovery.java
comments:
Merge branch 'master' into feature/aggs_2_0

Conflicts:
	src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridParser.java
	src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/InternalPercentileRanks.java
	src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/InternalPercentiles.java
	src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHits.java
	src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregator.java
	src/test/java/org/elasticsearch/search/aggregations/bucket/significant/SignificanceHeuristicTests.java

time:
2015-03-04T10:48:10Z
class:
src/test/java/org/elasticsearch/index/IndexWithShadowReplicasTests.java
comments:
[TEST] Enable trace logging for translog recovery

time:
2015-03-03T21:35:22Z
class:
src/test/java/org/elasticsearch/index/IndexWithShadowReplicasTests.java
comments:
[TESTS] Flush and refresh before querying in IndexWithShadowReplicasTests

time:
2015-03-03T19:03:51Z
class:
comments:
Update query-string-syntax.asciidoc

Closes #9965

time:
2015-03-03T18:50:13Z
class:
comments:
Updated the resiliency status page for v1.4.0

Closes #9969

time:
2015-03-03T15:25:03Z
class:
src/main/java/org/elasticsearch/index/gateway/IndexShardGateway.java
src/main/java/org/elasticsearch/index/translog/ChecksummedTranslogStream.java
src/test/java/org/elasticsearch/index/translog/AbstractSimpleTranslogTests.java
src/test/java/org/elasticsearch/index/translog/TranslogVersionTests.java
comments:
[CORE] Handle truncated translog gracefully

We used to handle truncated translogs in a better manner (assuming that
the node was killed halfway through writing an operation and discarding
the last operation). This brings back that behavior by catching an
`EOFException` during the stream reading and throwing a
`TruncatedTranslogException` which can be safely ignored in
`IndexShardGateway`.

Fixes #9699

time:
2015-03-03T14:44:11Z
class:
src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityTests.java
comments:
[TEST] increase suite timeout for OldIndexBackwardsCompatibilityTests

Test suite times out too often and it seems this is not because of actual
failures but becasue it is a long running test.

time:
2015-03-03T14:25:10Z
class:
comments:
Docs: updated resilience page

time:
2015-03-03T13:34:13Z
class:
src/test/java/org/elasticsearch/NamingConventionTests.java
comments:
[TEST] use context classloader to load testclasses

time:
2015-03-03T09:21:23Z
class:
src/test/java/org/elasticsearch/test/rest/client/http/HttpRequestBuilder.java
comments:
[TEST] Work around URI encode limitations in RestClient

We've been relying on URI for url encoding, but it turns out it has some problems. For instance '+' stays as is while it should be encoded to `%2B`. If we go and manually encode query params we have to be careful though not to run into double encoding ('+'=>'%2B'=>'%252B'). The applied solution relies on URI encoding for the url path, but manual url encoding for the query parameters. We prevent URI from double encoding query params by using its single argument constructor that leaves everything as is.

We can also revert back the expression script REST test that revealed this to its original content (which contains an addition).

Closes #9769
Closes #9946

time:
2015-03-03T09:15:11Z
class:
comments:
Docs: Added default value

Added default value to `cluster.routing.allocation.node_initial_primaries_recoveries`

Closes #9955

time:
2015-03-03T07:49:14Z
class:
src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsTests.java
comments:
Test: fix testStaleMasterNotHijackingMajority by waiting for the old master node to step down.

It may take some time for the old master node to step down anf for it to rejoin and that all nodes have it in the nodes list.
By waiting for the old master node to have stepped down, we can again rely on assertDiscoveryCompleted() to make sure that it has joined.

time:
2015-03-02T23:54:15Z
class:
src/test/java/org/elasticsearch/indices/memory/breaker/CircuitBreakerServiceTests.java
comments:
[TESTS] remove AwaitsFix from CircuitBreakerServiceTests

I beasted these tests for a while without failure, I would like to
re-enable them to see if they still fail.

Fixes #8710
Fixes #9270

time:
2015-03-02T21:42:47Z
class:
src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsTests.java
comments:
Test: fix DiscoveryWithServiceDisruptionsTests#isolatedUnicastNodes by starting a 4 node cluster instead of a 3 node cluster.

If the isolated unicast host is also a master node then its local cluster state gets unusable a source for pinging when the disruption stops.
All the nodes in the cluster state node list can be removed and at that time it will only ping itself and never find out about the other nodes.
(these nodes will not ping, because they are already following a new master)

time:
2015-03-02T20:16:24Z
class:
src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsTests.java
comments:
Test: increased logging

time:
2015-03-02T18:07:23Z
class:
src/test/java/org/apache/lucene/util/AbstractRandomizedTest.java
src/test/java/org/elasticsearch/test/AfterTestRule.java
src/test/java/org/elasticsearch/test/CurrentTestFailedMarker.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
src/test/java/org/elasticsearch/test/rest/ElasticsearchRestTests.java
src/test/java/org/elasticsearch/test/rest/RestTestExecutionContext.java
src/test/java/org/elasticsearch/test/rest/client/RestClient.java
comments:
[TEST] Make sure we restart the suite cluster after each test failure

CurrentTestFailedMarker is a RunListener that gets notified whenever a test fails, and we were using it to be able to restart the suite cluster after each failure. We were checking whether a test had failed in the @After method though, which runs before the listener gets notified, so the failed flag would always be false.

This commit makes sure that the suite cluster gets restarted not only when there are problems in the afterInternal method, but also after each test failure. In order to achieve this, we need to reset the cluster afterwards, when we get to know about both of the events (problem in afterInternal and test failure), and before resetting the currentCluster. Introduced a TestRule that keeps track of test failures and allows to execute arbitrary tasks when a test fails and when a test is completed (regardless of its result). Allows also to force the execution of the failure task (used in case of afterInternal issues rather than actual test failure).

Also updated ElasticsearchRestTests to make sure that the RestClient gets re-initialized in case we restart the suite cluster, otherwise all the subsequent tests fail. Improved this mechanism also to relate it directly to the restart of the cluster instead of checking whether the addresses have changed, which doesn't work anyway as the new cluster will use the same addresses but the client needs to be recreated anyway.

Closes #9015

time:
2015-03-02T16:31:19Z
class:
src/test/java/org/elasticsearch/NamingConventionTests.java
src/test/java/org/elasticsearch/common/cli/CliToolTestCase.java
src/test/java/org/elasticsearch/index/fielddata/fieldcomparator/ReplaceMissingTests.java
src/test/java/org/elasticsearch/index/store/LegacyVerificationTests.java
comments:
[TESTS] Make sure test end with ..Tests

This commit adds a simple testcase that ensures all our tests end with the right naming.

Closes #9945

time:
2015-03-02T15:41:19Z
class:
src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsTests.java
comments:
Test: fix npe

time:
2015-03-02T14:53:05Z
class:
src/main/java/org/elasticsearch/search/aggregations/reducers/InternalSimpleValue.java
src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeBuilder.java
src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeParser.java
src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeReducer.java
src/test/java/org/elasticsearch/search/aggregations/reducers/DerivativeTests.java
comments:
Implementation of GapPolicy for derivative

time:
2015-03-02T14:30:39Z
class:
src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsTests.java
comments:
Test: use assertBusy to fix timing issue

time:
2015-03-02T12:46:45Z
class:
src/test/java/org/elasticsearch/bwcompat/ClusterStateBackwardsCompatTests.java
src/test/java/org/elasticsearch/bwcompat/NodesStatsBasicBackwardsCompatTests.java
comments:
[TEST] add Tests suffix

time:
2015-03-02T12:19:23Z
class:
src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsTests.java
comments:
[TEST] add Tests suffix

time:
2015-03-02T12:00:48Z
class:
src/main/java/org/elasticsearch/index/store/Store.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryStatus.java
comments:
Store: renameFilesSafe -> renameTempFilesSafe

relates to #9933

time:
2015-03-02T10:03:39Z
class:
src/main/java/org/elasticsearch/indices/recovery/RecoveryState.java
comments:
Recovery: synchronize RecoveryState.timer methods

Avoids a minor concurrent race condition causing time() to potentially return a negative value

Closes #9943

time:
2015-03-02T09:55:22Z
class:
comments:
Update search-type.asciidoc

Changed search_type docs to reflect that the `(dfs_)query_and_fetch` modes are an internal optimization and should not be specified explicitly by the user.

Relates to #9606

time:
2015-03-02T09:27:05Z
class:
comments:
REST: Fix script-expressions test to work with Perl

Closes #9931

time:
2015-03-02T08:48:18Z
class:
src/main/java/org/elasticsearch/common/jna/Kernel32Library.java
src/test/java/org/elasticsearch/common/jna/NativesTests.java
comments:
[Native] Use direct mapping call in Kernel32Library

This commit modifies the Kernel32Library to use direct mapping instead of a proxy class when doing native calls on Windows platforms. It also adds the "createSecurityManager" permission to the tests.policy file, and adds unit tests that should have failed when the Java security manager is enabled.

Closes #9802

time:
2015-03-01T20:07:09Z
class:
comments:
Update getting-started.asciidoc

Closes #9932

time:
2015-03-01T20:07:07Z
class:
comments:
Added note on max # of docs allowed in a shard

time:
2015-03-01T20:05:52Z
class:
comments:
Spelling out the sort order options

Closes #9768

time:
2015-03-01T16:14:42Z
class:
src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
Test: InternalEngineTests.testEnableGcDeletes missed closing translog

time:
2015-03-01T11:10:35Z
class:
src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
Test: InternalEngineTests.testSegmentsWithMergeFlag should close it's translog

Also improve test suite tearDown to not fail if setUp didn't create engines, translogs etc.

time:
2015-03-01T08:02:23Z
class:
src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityTests.java
comments:
Test: testOldIndexes start nodes async

time:
2015-03-01T07:48:35Z
class:
src/test/java/org/elasticsearch/test/ElasticsearchLuceneTestCase.java
comments:
Test: add LoggingListener to ElasticsearchLuceneTestCase

time:
2015-03-01T07:48:14Z
class:
src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
Test: InternalEngineTests.testSimpleRecover should close snapshot

time:
2015-02-28T23:51:36Z
class:
src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
Test: InternalEngineTests - JVM specific paths + retry to clean up translogs on startUp

Files may still be locked

time:
2015-02-28T18:31:28Z
class:
comments:
REST tests - disable expressions test for now

Java returns floating point but JSON contains integer

time:
2015-02-28T16:19:55Z
class:
comments:
Docs: Minor test change to Perl docs

time:
2015-02-28T16:02:29Z
class:
comments:
REST test: Fixed expressions test

Perl reads the number as a string, so instead mapped the field as a long
specifically.

Also, the value returned in JSON is an integer, not a float

time:
2015-02-28T12:44:02Z
class:
src/main/java/org/elasticsearch/script/javascript/JavaScriptScriptEngineService.java
comments:
Remove component settings from AbstractComponent

Related to elasticsearch/elasticsearch#9919

Closes #35.

time:
2015-02-28T06:05:42Z
class:
src/test/java/org/elasticsearch/index/engine/ShadowEngineTests.java
comments:
Test: ShadowEngineTests - close translogs on tear down here too

time:
2015-02-28T05:25:07Z
class:
src/main/java/org/elasticsearch/rest/action/cat/RestNodesAction.java
comments:
_cat/nodes: Thread null handling through stats and info

Closes #6297

time:
2015-02-28T03:48:57Z
class:
comments:
Update search.asciidoc

Removed operation threading from the docs. Not supported since v1.2.0

Closes #9917

time:
2015-02-28T02:18:45Z
class:
comments:
Updated copyright years to include 2015

time:
2015-02-28T02:05:05Z
class:
comments:
Update span-multi-term-query.asciidoc

Added comma - there is no "term range" query

Closes #9855

time:
2015-02-28T00:45:29Z
class:
comments:
Docs: Default distance unit in geo distance agg is metres, not km

Closes #9812

time:
2015-02-27T21:18:59Z
class:
comments:
[doc] Link mapper-attachment type documentation to its repo

As explained in elasticsearch/elasticsearch-mapper-attachments#101, we should have consistent documentation.

The best option is to link the  documentation in elasticsearch guide to the most recent README in the plugin repo.

Closes #9756

time:
2015-02-27T20:54:14Z
class:
src/main/java/org/elasticsearch/http/netty/NettyHttpServerTransport.java
comments:
Netty HTTP Transport: Change access modifiers to protected

Previously a few methods and many class members were package-private
or private and could not be referenced from overriding classes. This changes
the member variables and a few methods to have protected access, so they
can be referenced or overridden from a subclass.

time:
2015-02-27T20:53:25Z
class:
src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
Test: InternalEngineTests - close translogs on tear down

time:
2015-02-27T20:17:19Z
class:
src/test/java/org/elasticsearch/get/GetActionTests.java
comments:
fix test bug leftover from #9914

time:
2015-02-27T20:09:50Z
class:
src/main/java/org/elasticsearch/index/gateway/IndexShardGateway.java
src/main/java/org/elasticsearch/index/gateway/IndexShardGatewayService.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/main/java/org/elasticsearch/index/snapshots/IndexShardSnapshotAndRestoreService.java
src/main/java/org/elasticsearch/index/snapshots/blobstore/BlobStoreIndexShardRepository.java
src/main/java/org/elasticsearch/indices/recovery/RecoverySource.java
src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryState.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryStatus.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
src/main/java/org/elasticsearch/indices/recovery/SharedFSRecoverySourceHandler.java
src/test/java/org/elasticsearch/indices/recovery/RecoveryStateTest.java
src/test/java/org/elasticsearch/indices/recovery/RecoveryStatusTests.java
src/test/java/org/elasticsearch/recovery/FullRollingRestartTests.java
src/test/java/org/elasticsearch/test/InternalTestCluster.java
comments:
Recovery: unify RecoveryState management to IndexShard and clean up semantics

We keep track of the current stage of recovery using an instance of RecoveryState which is stored on the relevant IndexShard. At the moment changes to this object are made in many places of the code, which are charged of doing it in the right order, keeping track of timers and many more. Also the changes to shard state are decoupled from the recovery stages which caused #9503.

This PR refactors this and brings all of the changes into IndexShard. It also makes all recovery follow the exact same stages and shortcut some. This is in order to keep things simple and always the same (those shortcuts didn't add anything, we ended doing it all anyway).

Also, all timer management is now folded into RecoveryState and unit tests are added.

This closes #9503 by moving the shard to post recovery only once the recovery is done (before they were decoupled), meaning that master promotion of the target shard to started can not cancel the recovery.

Closes #9902

time:
2015-02-27T19:42:12Z
class:
comments:
Docs: Update snapshots.asciidoc

Adds more determiners.

Closes #9673

time:
2015-02-27T19:22:55Z
class:
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
src/main/java/org/elasticsearch/index/translog/Translog.java
src/main/java/org/elasticsearch/index/translog/fs/FsTranslog.java
src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
Engine: close snapshots before recovery counter

#9760 was a fix for translog leaking due to measing a delete flag. This is not needed here as we have a better solution to not loose the flag. This commit takes the changes from 1x in order  to keep the code base similar and enjoy the extra tests.

Closes #9760

time:
2015-02-27T19:20:55Z
class:
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
comments:
fix compilation issue from forward port of #9916

time:
2015-02-27T19:11:04Z
class:
src/main/java/org/elasticsearch/index/mapper/internal/TTLFieldMapper.java
src/test/java/org/elasticsearch/index/mapper/ttl/TTLMappingTests.java
src/test/java/org/elasticsearch/ttl/SimpleTTLTests.java
src/test/java/org/elasticsearch/update/UpdateTests.java
comments:
Mappings: Lock down _ttl field

While the parser allowed changing field type settings, these would never
have been serialized.  So this change simply removes parsing using
parseField. Backcompat will still work if a user uploads old settings
(they just would never have worked anyways, so we continue ignoring
them with 1.x, and 2.x will now error).

see #8143
closes #9914

time:
2015-02-27T19:09:52Z
class:
src/main/java/org/elasticsearch/index/mapper/internal/SizeFieldMapper.java
src/test/java/org/elasticsearch/get/GetActionTests.java
src/test/java/org/elasticsearch/index/mapper/size/SizeMappingTests.java
src/test/java/org/elasticsearch/index/mapper/update/UpdateMappingTests.java
src/test/java/org/elasticsearch/percolator/PercolatorTests.java
src/test/java/org/elasticsearch/search/fields/SearchFieldsTests.java
comments:
Mappings: Lock down _size field

This also changes the stored setting for _size to true (for
indexes created in 2.x).

see #8143
closes #9913

time:
2015-02-27T19:08:24Z
class:
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
comments:
Tests: Add back tests.cluster

This setting is used by the release script to run rest tests against
the version being released.  It used to work only for tests using
the global cluster.  Now it supercedes both SUITE and TEST scope
test clusters.

closes #9916

time:
2015-02-27T17:51:36Z
class:
src/main/java/org/apache/lucene/search/postingshighlight/XPostingsHighlighter.java
src/main/java/org/elasticsearch/common/lucene/Lucene.java
src/main/java/org/elasticsearch/common/lucene/index/ElasticsearchDirectoryReader.java
src/main/java/org/elasticsearch/common/lucene/search/EmptyScorer.java
src/main/java/org/elasticsearch/common/lucene/search/function/CustomBoostFactorScorer.java
src/main/java/org/elasticsearch/common/lucene/search/function/ScriptScoreFunction.java
src/main/java/org/elasticsearch/index/search/child/ChildrenConstantScoreQuery.java
src/main/java/org/elasticsearch/index/search/child/ChildrenQuery.java
src/main/java/org/elasticsearch/index/search/child/ConstantScorer.java
src/main/java/org/elasticsearch/index/search/child/ParentQuery.java
src/main/java/org/elasticsearch/index/search/child/TopChildrenQuery.java
src/main/java/org/elasticsearch/index/search/nested/IncludeNestedDocsQuery.java
src/main/java/org/elasticsearch/percolator/MultiDocumentPercolatorIndex.java
src/main/java/org/elasticsearch/percolator/QueryCollector.java
src/main/java/org/elasticsearch/search/lookup/IndexFieldTerm.java
src/test/java/org/elasticsearch/index/search/child/MockScorer.java
src/test/java/org/elasticsearch/indices/memory/breaker/RandomExceptionCircuitBreakerTests.java
src/test/java/org/elasticsearch/search/basic/SearchWithRandomExceptionsTests.java
src/test/java/org/elasticsearch/test/ElasticsearchLuceneTestCase.java
src/test/java/org/elasticsearch/test/engine/MockInternalEngine.java
comments:
Upgrade to Lucene r1662607

Closes #9915.

Squashed commit of the following:

commit cfa59f5a3f03d9d1b432980dcee6495447c1e7ea
Author: Robert Muir <rmuir@apache.org>
Date:   Fri Feb 27 12:10:16 2015 -0500

    add missing null check

commit 62fe5403068c730c0e0b6fd1ab1a0246eeef6220
Author: Robert Muir <rmuir@apache.org>
Date:   Fri Feb 27 11:31:53 2015 -0500

    Disable ExtrasFS for now, until we hook all this in properly in a separate issue.

commit 822795c57c5cf846423fad443c2327c4ed0094ac
Author: Adrien Grand <jpountz@gmail.com>
Date:   Fri Feb 27 10:12:02 2015 +0100

    Fix PercolatorTests.

commit 98b2a0a7d8298648125c9a367cb7e31b3ec7d51b
Author: Adrien Grand <jpountz@gmail.com>
Date:   Fri Feb 27 09:27:11 2015 +0100

    Fix ChildrenQueryTests.

commit 9b99656fc56bbd01c9afe22baffae3c37bb48a71
Author: Robert Muir <rmuir@apache.org>
Date:   Thu Feb 26 20:50:02 2015 -0500

    cutover apis, no work on test failures yet.

time:
2015-02-27T16:49:54Z
class:
src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptions.java
src/test/java/org/elasticsearch/discovery/ZenUnicastDiscoveryTests.java
src/test/java/org/elasticsearch/test/discovery/ClusterDiscoveryConfiguration.java
comments:
Tests: check node ports availability when using unicast discovery

Some tests failures are seen when a node attempts to use a port that is already bound
by some other process on the test machine. This commit adds a bind to test port availability
and iterates over the port range until an available port is found. This reduces the likelihood
of a test node failing to start up due to the port already being bound.

time:
2015-02-27T15:32:50Z
class:
src/main/java/org/elasticsearch/cloud/aws/AwsEc2Service.java
src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java
src/main/java/org/elasticsearch/discovery/ec2/Ec2Discovery.java
src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
src/test/java/org/elasticsearch/cloud/aws/TestAmazonS3.java
src/test/java/org/elasticsearch/cloud/aws/TestAwsS3Service.java
comments:
Remove component settings from AbstractComponent

Related to elasticsearch/elasticsearch#9919

Closes #182.

time:
2015-02-27T12:58:23Z
class:
src/main/java/org/elasticsearch/action/ActionModule.java
src/main/java/org/elasticsearch/action/admin/cluster/node/restart/NodesRestartAction.java
src/main/java/org/elasticsearch/action/admin/cluster/node/restart/NodesRestartRequest.java
src/main/java/org/elasticsearch/action/admin/cluster/node/restart/NodesRestartRequestBuilder.java
src/main/java/org/elasticsearch/action/admin/cluster/node/restart/NodesRestartResponse.java
src/main/java/org/elasticsearch/action/admin/cluster/node/restart/TransportNodesRestartAction.java
src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
src/main/java/org/elasticsearch/client/ClusterAdminClient.java
src/main/java/org/elasticsearch/client/Requests.java
src/main/java/org/elasticsearch/client/support/AbstractClusterAdminClient.java
src/main/java/org/elasticsearch/common/settings/ImmutableSettings.java
src/main/java/org/elasticsearch/node/Node.java
src/main/java/org/elasticsearch/rest/action/RestActionModule.java
src/main/java/org/elasticsearch/rest/action/admin/cluster/node/restart/RestNodesRestartAction.java
src/main/java/org/elasticsearch/tribe/TribeService.java
src/test/java/org/elasticsearch/benchmark/breaker/CircuitBreakerBenchmark.java
comments:
[CORE] Remove Restart API and remove Node#stop()

The restart API seems pretty esoteric and is entirely untested.
This commit removes it without a replacement.

Closes #9841

time:
2015-02-27T12:01:26Z
class:
src/main/java/org/elasticsearch/action/admin/cluster/node/restart/TransportNodesRestartAction.java
src/main/java/org/elasticsearch/action/admin/cluster/node/shutdown/TransportNodesShutdownAction.java
src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
src/main/java/org/elasticsearch/cache/recycler/PageCacheRecycler.java
src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java
src/main/java/org/elasticsearch/cluster/routing/RoutingService.java
src/main/java/org/elasticsearch/cluster/service/InternalClusterService.java
src/main/java/org/elasticsearch/common/blobstore/fs/FsBlobStore.java
src/main/java/org/elasticsearch/common/blobstore/url/URLBlobStore.java
src/main/java/org/elasticsearch/common/component/AbstractComponent.java
src/main/java/org/elasticsearch/common/component/AbstractLifecycleComponent.java
src/main/java/org/elasticsearch/common/settings/ImmutableSettings.java
src/main/java/org/elasticsearch/common/settings/Settings.java
src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
src/main/java/org/elasticsearch/discovery/zen/ping/ZenPingService.java
src/main/java/org/elasticsearch/discovery/zen/ping/multicast/MulticastZenPing.java
src/main/java/org/elasticsearch/discovery/zen/ping/unicast/UnicastZenPing.java
src/main/java/org/elasticsearch/gateway/GatewayAllocator.java
src/main/java/org/elasticsearch/gateway/GatewayService.java
src/main/java/org/elasticsearch/http/HttpServer.java
src/main/java/org/elasticsearch/http/netty/NettyHttpServerTransport.java
src/main/java/org/elasticsearch/index/AbstractIndexComponent.java
src/main/java/org/elasticsearch/index/analysis/AbstractIndexAnalyzerProvider.java
src/main/java/org/elasticsearch/index/cache/query/parser/resident/ResidentQueryParserCache.java
src/main/java/org/elasticsearch/index/deletionpolicy/AbstractESDeletionPolicy.java
src/main/java/org/elasticsearch/index/deletionpolicy/KeepLastNDeletionPolicy.java
src/main/java/org/elasticsearch/index/gateway/IndexShardGateway.java
src/main/java/org/elasticsearch/index/indexing/slowlog/ShardSlowLogIndexingService.java
src/main/java/org/elasticsearch/index/mapper/MapperService.java
src/main/java/org/elasticsearch/index/merge/policy/LogByteSizeMergePolicyProvider.java
src/main/java/org/elasticsearch/index/merge/policy/LogDocMergePolicyProvider.java
src/main/java/org/elasticsearch/index/merge/policy/TieredMergePolicyProvider.java
src/main/java/org/elasticsearch/index/merge/scheduler/MergeSchedulerProvider.java
src/main/java/org/elasticsearch/index/search/slowlog/ShardSlowLogSearchService.java
src/main/java/org/elasticsearch/index/shard/AbstractIndexShardComponent.java
src/main/java/org/elasticsearch/index/store/fs/FsDirectoryService.java
src/main/java/org/elasticsearch/index/translog/TranslogService.java
src/main/java/org/elasticsearch/index/translog/fs/FsTranslog.java
src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
src/main/java/org/elasticsearch/indices/fielddata/cache/IndicesFieldDataCache.java
src/main/java/org/elasticsearch/indices/memory/IndexingMemoryController.java
src/main/java/org/elasticsearch/indices/recovery/RecoverySettings.java
src/main/java/org/elasticsearch/indices/store/IndicesStore.java
src/main/java/org/elasticsearch/indices/ttl/IndicesTTLService.java
src/main/java/org/elasticsearch/monitor/jvm/JvmMonitorService.java
src/main/java/org/elasticsearch/monitor/jvm/JvmService.java
src/main/java/org/elasticsearch/plugins/PluginsService.java
src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
src/main/java/org/elasticsearch/repositories/fs/FsRepository.java
src/main/java/org/elasticsearch/repositories/uri/URLRepository.java
src/main/java/org/elasticsearch/script/ScriptService.java
src/main/java/org/elasticsearch/search/SearchService.java
src/main/java/org/elasticsearch/search/controller/SearchPhaseController.java
src/main/java/org/elasticsearch/threadpool/ThreadPool.java
src/main/java/org/elasticsearch/transport/netty/NettyTransport.java
src/main/java/org/elasticsearch/watcher/ResourceWatcherService.java
src/test/java/org/elasticsearch/plugins/PluginLuceneCheckerTests.java
src/test/java/org/elasticsearch/plugins/PluginServiceTests.java
comments:
[CORE] Remove component settings from AbstractComponent

Today we have two ways of getting a setting, either with the full settings key or with only
the last part of the key where the prefix is implicit depending on the package the class is in via
component settings. this is trappy as well as confusing for users and can break easily if a class is moved
to a new package since the prefix then implicitly changes.
This commit removes the component settings from the codebase.

time:
2015-02-27T10:21:10Z
class:
src/main/java/org/elasticsearch/cloud/azure/management/AzureComputeService.java
src/main/java/org/elasticsearch/discovery/azure/AzureUnicastHostsProvider.java
comments:
Add keystore.type, deployment.name and deployment.slot settings for discovery

We can now support two new options:

* `deployment.name`: deployment name if any. Defaults to the value set with `cloud.azure.cloud.service.name`.
* `deployment.slot`: either `staging` or `production` (default).

(cherry picked from commit 6d7ee49)
(cherry picked from commit 10beb68)

time:
2015-02-27T09:56:00Z
class:
src/main/java/org/elasticsearch/cloud/azure/AzureServiceDisableException.java
src/main/java/org/elasticsearch/cloud/azure/AzureServiceRemoteException.java
src/main/java/org/elasticsearch/cloud/azure/AzureSettingsFilter.java
src/main/java/org/elasticsearch/cloud/azure/Instance.java
src/main/java/org/elasticsearch/cloud/azure/management/AzureComputeService.java
src/main/java/org/elasticsearch/cloud/azure/management/AzureComputeServiceImpl.java
src/main/java/org/elasticsearch/discovery/azure/AzureUnicastHostsProvider.java
src/test/java/org/elasticsearch/cloud/azure/management/AzureComputeServiceSimpleMock.java
src/test/java/org/elasticsearch/cloud/azure/management/AzureComputeServiceTwoNodesMock.java
src/test/java/org/elasticsearch/discovery/azure/AzureInstanceXmlParserTest.java
src/test/java/org/elasticsearch/discovery/azure/AzureSimpleTest.java
src/test/java/org/elasticsearch/discovery/azure/AzureTwoStartedNodesTest.java
comments:
Use Azure Java Management SDK 0.7.0

This first version adds `azure-management` 0.7.0 instead of using our own XML implementation.
We can now have more control and give more options to the users.

We now support different keystore types using `cloud.azure.management.keystore.type`:

* `pkcs12`
* `jceks`
* `jks`

Closes #38

(cherry picked from commit 72c77d3)
(cherry picked from commit d2541ab)

time:
2015-02-27T09:53:51Z
class:
src/main/java/org/elasticsearch/cloud/azure/AzureComputeService.java
src/main/java/org/elasticsearch/cloud/azure/AzureModule.java
src/main/java/org/elasticsearch/cloud/azure/AzureSettingsFilter.java
src/main/java/org/elasticsearch/cloud/azure/management/AzureComputeService.java
src/main/java/org/elasticsearch/cloud/azure/management/AzureComputeServiceImpl.java
src/main/java/org/elasticsearch/discovery/azure/AzureUnicastHostsProvider.java
src/main/java/org/elasticsearch/plugin/cloud/azure/CloudAzurePlugin.java
src/test/java/org/elasticsearch/cloud/azure/management/AzureComputeServiceAbstractMock.java
src/test/java/org/elasticsearch/cloud/azure/management/AzureComputeServiceSimpleMock.java
src/test/java/org/elasticsearch/cloud/azure/management/AzureComputeServiceTwoNodesMock.java
src/test/java/org/elasticsearch/discovery/azure/AbstractAzureComputeServiceTest.java
src/test/java/org/elasticsearch/discovery/azure/AzureInstanceXmlParserTest.java
src/test/java/org/elasticsearch/discovery/azure/AzureMinimumMasterNodesTest.java
src/test/java/org/elasticsearch/discovery/azure/AzureSimpleTest.java
src/test/java/org/elasticsearch/discovery/azure/AzureTwoStartedNodesTest.java
comments:
Rename settings for discovery

Azure Java SDK follows some conventions about property names and we can use
the same convention. The benefit is that it makes the code cleaner and easier to understand
as components settings relies on package name without the `org.elasticsearch` prefix.

In previous versions, we defined:

```
cloud:
	azure:
		keystore: /path/to/keystore
		password: your_password_for_keystore
		subscription_id: your_azure_subscription_id
		service_name: your_azure_cloud_service_name
		port_name: elasticsearch
		host_type: private_ip
```

We now define:

```
cloud:
	azure:
		management:
			keystore:
				path: /path/to/keystore
				password: your_password_for_keystore
			subscription:
				id: your_azure_subscription_id
			cloud:
				service:
					name: your_azure_cloud_service_name

discovery:
	azure:
		host:
			type: private_ip
		endpoint:
			name: elasticsearch
```

The following are a list of settings (prefixed with `cloud.azure.management`) that can further control the discovery:

* `keystore.path`: /path/to/keystore
* `keystore.password`: your_password for the keystore
* `subscription.id`: your_azure_subscription_id
* `cloud.service.name`: your_azure_cloud_service_name

So basically we deprecate the following properties:

* `cloud.azure.keystore` to `cloud.azure.management.keystore.path`
* `cloud.azure.password` to `cloud.azure.management.keystore.password`
* `cloud.azure.subscription_id` to `cloud.azure.management.subscription.id`
* `cloud.azure.service_name` to `cloud.azure.management.cloud.service.name`
* `cloud.azure.port_name` to `discovery.azure.port.name`
* `cloud.azure.host_type` to `discovery.azure.host.type`

Note that we can still read deprecated settings but it will print a `WARN` with an advice to make sure users don't forget to move.

(cherry picked from commit 04920a8)
(cherry picked from commit 9745826)

time:
2015-02-27T09:52:07Z
class:
src/main/java/org/elasticsearch/cloud/azure/AzureModule.java
src/main/java/org/elasticsearch/cloud/azure/AzureSettingsFilter.java
src/main/java/org/elasticsearch/cloud/azure/blobstore/AzureBlobStore.java
src/main/java/org/elasticsearch/cloud/azure/storage/AzureStorageService.java
src/main/java/org/elasticsearch/cloud/azure/storage/AzureStorageServiceImpl.java
src/main/java/org/elasticsearch/plugin/cloud/azure/CloudAzurePlugin.java
src/main/java/org/elasticsearch/repositories/azure/AzureRepository.java
src/test/java/org/elasticsearch/cloud/azure/storage/AzureStorageServiceMock.java
src/test/java/org/elasticsearch/repositories/azure/AbstractAzureRepositoryServiceTest.java
src/test/java/org/elasticsearch/repositories/azure/AzureSnapshotRestoreITest.java
src/test/java/org/elasticsearch/repositories/azure/AzureSnapshotRestoreTest.java
comments:
Rename settings for repositories

Storage and Management settings are not related in Azure API.
We were using the following convention for storage specific settings:

```yml
cloud:
    azure:
        storage_account: your_azure_storage_account
        storage_key: your_azure_storage_key
```

A better naming (and Java packaging) would be by moving `storage` settings in their own package
`cloud.azure.storage`:

```yml
cloud:
    azure:
        storage:
            account: your_azure_storage_account
            key: your_azure_storage_key
```

Note that we can still read deprecated settings but it will print a `WARN` with an advice to make sure users don't forget to move.

(cherry picked from commit 6b30c62)
(cherry picked from commit 1237be9)

time:
2015-02-27T08:19:45Z
class:
src/test/java/org/elasticsearch/index/analysis/TestIndexableBinaryStringTools.java
comments:
Remove ThreadLeak filter

Due to elasticsearch/elasticsearch#9843

time:
2015-02-27T07:24:56Z
class:
src/test/java/org/elasticsearch/test/ElasticsearchThreadFilter.java
comments:
remove thread leak filter, should have been removed in #9843

time:
2015-02-26T23:15:59Z
class:
src/main/java/org/elasticsearch/index/mapper/internal/FieldNamesFieldMapper.java
src/main/java/org/elasticsearch/index/query/ExistsFilterParser.java
src/main/java/org/elasticsearch/index/query/MissingFilterParser.java
src/test/java/org/elasticsearch/get/GetActionTests.java
src/test/java/org/elasticsearch/index/mapper/internal/FieldNamesFieldMapperTests.java
src/test/java/org/elasticsearch/search/query/ExistsMissingTests.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
comments:
Mappings: Lock down _field_names field

Now that we have an explicit `enabled` flag, we can lock down
the field type so it is not mungeable.

see #8143
closes #9912

time:
2015-02-26T23:07:07Z
class:
src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java
src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java
src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java
src/main/java/org/elasticsearch/index/mapper/MapperBuilders.java
src/main/java/org/elasticsearch/index/mapper/MapperService.java
src/main/java/org/elasticsearch/index/mapper/internal/BoostFieldMapper.java
src/test/java/org/elasticsearch/get/GetActionTests.java
src/test/java/org/elasticsearch/index/mapper/boost/BoostMappingIntegrationTests.java
src/test/java/org/elasticsearch/index/mapper/boost/BoostMappingTests.java
src/test/java/org/elasticsearch/search/basic/TransportSearchFailuresTests.java
src/test/java/org/elasticsearch/search/basic/TransportTwoNodesSearchTests.java
src/test/java/org/elasticsearch/search/sort/SimpleSortTests.java
comments:
Mappings: Remove _boost field

This has been deprecated since 1.0.0.RC1. It is finally removed here.

closes #8875

time:
2015-02-26T22:32:50Z
class:
src/test/java/org/elasticsearch/bwcompat/BasicBackwardsCompatibilityTest.java
comments:
fix bwc test to be more lenient on error message when _field_names is
not supported

time:
2015-02-26T21:09:41Z
class:
src/main/java/org/elasticsearch/index/mapper/internal/RoutingFieldMapper.java
src/test/java/org/elasticsearch/get/GetActionTests.java
src/test/java/org/elasticsearch/index/mapper/routing/RoutingTypeMapperTests.java
comments:
Mappings: Lock down _routing field

`required` is now the only changeable settings (on indexes created after 1.x).

see #8143
closes #9895

time:
2015-02-26T21:01:07Z
class:
src/main/java/org/elasticsearch/index/mapper/internal/FieldNamesFieldMapper.java
src/test/java/org/elasticsearch/index/mapper/internal/FieldNamesFieldMapperTests.java
comments:
Mappings: Add enabled flag for _field_names to replace disabling through index=no

Almost all of our meta fields that allow enabling/disabling have an `enabled`
setting.  However, _field_names is enabled by default, and disabling
requires setting `index=no`.  This change adds a flag similar to that
with other meta fields.

closes #9893

time:
2015-02-26T20:13:55Z
class:
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
comments:
[TEST] Fix NPE in ElasticsearchIntegrationTest if no indexer is provided

Closes #9907

time:
2015-02-26T18:15:55Z
class:
src/test/java/org/elasticsearch/search/geo/GeoShapeIntegrationTests.java
comments:
[TEST] Adding 'AwaitsFix' annotation to randomGeoCollection test

Random geo shape testing periodically fails on a known issue within Spatial4j core. A simple patch in ES will fix the issue.  For now this random test will be disabled until the patch can be applied.

time:
2015-02-26T16:04:31Z
class:
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
comments:
[TEST] resolved a few compiler warnings in ElasticsearchIntegrationTest

Mainly simplified buildTestCluster method now that there is no global cluster anymore.

time:
2015-02-26T13:12:27Z
class:
src/test/java/org/elasticsearch/cluster/ack/AckClusterUpdateSettingsTests.java
comments:
[TEST] filter out unassigned shards

time:
2015-02-26T11:00:30Z
class:
src/test/java/org/elasticsearch/test/CurrentTestFailedMarker.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
src/test/java/org/elasticsearch/test/ElasticsearchThreadFilter.java
src/test/java/org/elasticsearch/test/rest/RestTestExecutionContext.java
comments:
[TEST] Remove global scope mentions

We removed the global cluster with #9781, yet there were still a few mentions of it in comments. Removed them.

time:
2015-02-26T08:40:36Z
class:
src/test/java/org/elasticsearch/transport/AbstractSimpleTransportTests.java
comments:
Test: fix sync issues in AbstractSimpleTransportTests.testTracerLog

time:
2015-02-26T07:27:35Z
class:
src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthResponse.java
comments:
Add ClusterHealthResponse constructor needed for plugin BWC

time:
2015-02-25T21:44:28Z
class:
src/main/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteResponse.java
src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateResponse.java
src/main/java/org/elasticsearch/cluster/ClusterState.java
src/main/java/org/elasticsearch/discovery/local/LocalDiscovery.java
src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
src/main/java/org/elasticsearch/discovery/zen/publish/PublishClusterStateAction.java
src/test/java/org/elasticsearch/cluster/serialization/ClusterSerializationTests.java
comments:
Internal: stop passing default cluster name to cluster state read operations

The default cluster name was needed for backwards compatibility with pre v1.1 nodes. It's no longer needed in 2.0.

time:
2015-02-25T21:04:40Z
class:
src/main/java/org/elasticsearch/cluster/routing/RoutingNode.java
comments:
Add a .toString() method to RoutingNode

Previously this would log:

```
[2015-02-24 11:13:45,105][TRACE][cluster.routing.allocation.allocator] [Poltergeist] Try moving shard [[test][2], node[HFn4dJ7fQAyfSAB8BquaSQ], [R], s[STARTED]] from [org.elasticsearch.cluster.routing.RoutingNode@6df2c498]
```

Now it will log:

```
[2015-02-25 11:32:45,182][TRACE][cluster.routing.allocation.allocator] [Solarr] Try moving shard [[my_index][2], node[HDhbU4D9Rx27MSr_72bmWQ], [P], s[STARTED]] from [routingNode ([Solarr][HDhbU4D9Rx27MSr_72bmWQ][Xanadu.domain][192.168.0.4], [5 assigned shards])]
```

time:
2015-02-25T20:33:57Z
class:
src/main/java/org/elasticsearch/transport/TransportService.java
src/main/java/org/elasticsearch/transport/TransportServiceAdapter.java
src/main/java/org/elasticsearch/transport/local/LocalTransport.java
src/main/java/org/elasticsearch/transport/local/LocalTransportChannel.java
src/main/java/org/elasticsearch/transport/netty/MessageChannelHandler.java
src/main/java/org/elasticsearch/transport/netty/NettyTransport.java
src/main/java/org/elasticsearch/transport/netty/NettyTransportChannel.java
src/test/java/org/elasticsearch/action/IndicesRequestTests.java
src/test/java/org/elasticsearch/benchmark/transport/BenchmarkNettyLargeMessages.java
src/test/java/org/elasticsearch/test/InternalTestCluster.java
src/test/java/org/elasticsearch/test/transport/MockTransportService.java
src/test/java/org/elasticsearch/transport/AbstractSimpleTransportTests.java
src/test/java/org/elasticsearch/transport/netty/NettyTransportTests.java
comments:
Transport: added a simple request tracer, logging incoming and outgoing requests

The request tracer logs in TRACE level under the `transport.tracer` log and is dynamically configurable with include and exclude arrays to filter out unneeded info. By default all requests are logged with the exception of fault detection pings (fired every second).

add the notion of tracers in the MockTransportService for testing purposes

Closes #9286

time:
2015-02-25T20:32:45Z
class:
comments:
fix comment

time:
2015-02-25T20:24:55Z
class:
src/main/java/org/elasticsearch/index/mapper/internal/IndexFieldMapper.java
src/test/java/org/elasticsearch/index/mapper/index/IndexTypeMapperTests.java
src/test/java/org/elasticsearch/index/mapper/update/UpdateMappingTests.java
comments:
Mappings: Lock down _index field

see #8143
closes #9870

time:
2015-02-25T19:35:39Z
class:
comments:
Test: cluster.health rest test should use 0 replicas

Some client test harnesses do not limit the number of replicas based on the number of nodes.

time:
2015-02-25T18:35:33Z
class:
src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
src/main/java/org/elasticsearch/index/query/SimpleQueryStringParser.java
src/test/java/org/elasticsearch/search/query/SimpleQueryStringTests.java
comments:
Add support for `minimum_should_match` to `simple_query_string`

This behaves similar to the way that `minimum_should_match` works for
the `match` query (in fact it is implemented in the exact same way)

Fixes #6449

time:
2015-02-25T18:01:28Z
class:
src/main/java/org/elasticsearch/common/joda/DateMathParser.java
src/test/java/org/elasticsearch/common/joda/DateMathParserTests.java
comments:
DateMath: Fix using time zone when rounding.

Currently rounding in DateMathParser This always done in UTC, even
when another time zone is specified. This is fixed by passing the time zone
down to the rounding logic when it is specified.

Closes #9814
Closes #9885

time:
2015-02-25T16:34:22Z
class:
src/main/java/org/elasticsearch/action/admin/indices/recovery/RecoveryResponse.java
src/main/java/org/elasticsearch/action/admin/indices/recovery/ShardRecoveryResponse.java
src/main/java/org/elasticsearch/action/admin/indices/recovery/TransportRecoveryAction.java
src/main/java/org/elasticsearch/index/gateway/IndexShardGateway.java
src/main/java/org/elasticsearch/index/gateway/IndexShardGatewayService.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/main/java/org/elasticsearch/index/shard/ShadowIndexShard.java
src/main/java/org/elasticsearch/index/snapshots/blobstore/BlobStoreIndexShardRepository.java
src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
src/main/java/org/elasticsearch/indices/recovery/RecoveriesCollection.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryFilesInfoRequest.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryState.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryStatus.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
src/main/java/org/elasticsearch/indices/recovery/ShardRecoveryHandler.java
src/main/java/org/elasticsearch/rest/action/cat/RestRecoveryAction.java
src/test/java/org/elasticsearch/benchmark/recovery/ReplicaRecoveryBenchmark.java
src/test/java/org/elasticsearch/gateway/RecoveryBackwardsCompatibilityTests.java
src/test/java/org/elasticsearch/gateway/RecoveryFromGatewayTests.java
src/test/java/org/elasticsearch/indices/recovery/IndexRecoveryTests.java
src/test/java/org/elasticsearch/indices/recovery/RecoveryStateTest.java
src/test/java/org/elasticsearch/indices/recovery/RecoveryStatusTests.java
src/test/java/org/elasticsearch/recovery/RecoveriesCollectionTests.java
src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreTests.java
src/test/java/org/elasticsearch/test/rest/section/GreaterThanAssertion.java
src/test/java/org/elasticsearch/test/rest/section/GreaterThanEqualToAssertion.java
src/test/java/org/elasticsearch/test/rest/section/IsFalseAssertion.java
src/test/java/org/elasticsearch/test/rest/section/IsTrueAssertion.java
src/test/java/org/elasticsearch/test/rest/section/LengthAssertion.java
src/test/java/org/elasticsearch/test/rest/section/LessThanAssertion.java
src/test/java/org/elasticsearch/test/rest/section/LessThanOrEqualToAssertion.java
src/test/java/org/elasticsearch/test/rest/section/MatchAssertion.java
comments:
Recovery: RecoveryState clean up

To support the `_recovery` API, the recovery process keeps track of current progress in a class called RecoveryState. This class currently have some issues, mostly around concurrency (see #6644 ). This PR cleans it up as well as other issues around it:

- Make the Index subsection API cleaner:
- remove redundant information - all calculation is done based on the underlying file map
- clearer definition of what is what: total files, vs reused files (local files that match the source) vs recovered files (copied over). % based progress is reported based on recovered files only.
- cleaned up json response to match other API (sadly this breaks the structure). We now properly report human values for dates and other units.
- Add more robust unit testing
- Detail flag was passed along as state (it's now a ToXContent param)
- State lookup during reporting is now always done via the IndexShard , no more fall backs to many other classes.
- Cleanup APIs around time and move the little computations to the state class as opposed to doing them out of the API

I also improved error messages out of the REST testing infra for things I run into.

Closes #6644
Closes #9811

time:
2015-02-25T16:22:02Z
class:
comments:
Reduce tests.policy a bit more

Remove some more wildcard permissions and replace with just what we need.

Closes #9868.

time:
2015-02-25T16:06:32Z
class:
src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/GetSnapshotsRequest.java
src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/GetSnapshotsRequestBuilder.java
src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/TransportGetSnapshotsAction.java
src/main/java/org/elasticsearch/rest/action/admin/cluster/snapshots/get/RestGetSnapshotsAction.java
src/main/java/org/elasticsearch/snapshots/SnapshotsService.java
src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreTests.java
comments:
Snapshot/Restore: add ability to retrieve currently running snapshots

Together with #8782 it should help in the situations simliar to #8887 by adding an ability to get information about currently running snapshot without accessing the repository itself.

Closes #8887

time:
2015-02-25T15:17:47Z
class:
comments:
Test: cat health api didn't disable headers

time:
2015-02-25T13:58:44Z
class:
src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterHealthResponse.java
src/main/java/org/elasticsearch/action/admin/cluster/health/ClusterIndexHealth.java
src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java
src/main/java/org/elasticsearch/cluster/ClusterService.java
src/main/java/org/elasticsearch/cluster/service/InternalClusterService.java
src/main/java/org/elasticsearch/common/util/concurrent/PrioritizedEsThreadPoolExecutor.java
src/main/java/org/elasticsearch/rest/action/cat/RestHealthAction.java
src/test/java/org/elasticsearch/cluster/ClusterHealthResponsesTests.java
src/test/java/org/elasticsearch/test/cluster/NoopClusterService.java
comments:
API: add pending tasks count to cluster health

The number of current pending tasks is useful to detect and overloaded master. This commit adds it to the cluster health API. The complete list can be retrieved from the dedicated pending tasks API.

It also adds rest tests for the cluster health variants.

Closes #9877

time:
2015-02-25T13:46:38Z
class:
src/main/java/org/elasticsearch/cluster/routing/MutableShardRouting.java
src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java
src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationService.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/main/java/org/elasticsearch/index/shard/ShadowIndexShard.java
src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
src/test/java/org/elasticsearch/index/IndexWithShadowReplicasTests.java
src/test/java/org/elasticsearch/test/store/MockFSDirectoryService.java
comments:
[CORE] Allow primary promotion on shadow replica without failing the shard

Today we fail the shard if we need to upgrade a replica to a primary on shadow replicas
on shared filesystem. Yet, this commit allows promotion by re-initializing on the master preventing
reallocation of all replicas.

time:
2015-02-25T13:31:18Z
class:
src/main/java/org/elasticsearch/env/NodeEnvironment.java
src/main/java/org/elasticsearch/index/IndexService.java
src/main/java/org/elasticsearch/index/store/Store.java
src/main/java/org/elasticsearch/indices/IndicesService.java
src/test/java/org/elasticsearch/indices/IndicesServiceTest.java
comments:
[INDICES] Schedule pending delete if index store delete fails

We try to lock all shards when an index is deleted but likely not
succeeding since shards are still active. To ensure that shards
that used to be allocated on that node get cleaned up as well we have
to retry or block on the delete until we get the locks. This is not desirable
since the delete happens on the cluster state processing thread. Instead of blocking
this commit schedules a pending delete for the index just like if we can't delete shards.

time:
2015-02-25T13:13:25Z
class:
comments:
Update migrate_2_0.asciidoc

More code formatting in breaking changes

time:
2015-02-25T13:11:57Z
class:
comments:
Update migrate_2_0.asciidoc

Code formatting in breaking changes

time:
2015-02-25T13:10:17Z
class:
comments:
Update migrate_2_0.asciidoc

Fixed bad heading levels in breaking changes

time:
2015-02-25T13:07:19Z
class:
comments:
Update migrate_2_0.asciidoc

Fixed bad asciidoc in breaking changes

time:
2015-02-25T11:00:55Z
class:
comments:
[DOCS] added a note for the default shard_size value

time:
2015-02-25T07:49:30Z
class:
src/main/java/org/elasticsearch/cluster/service/InternalClusterService.java
comments:
ClusterService: improve update thread shutdown logic.

time:
2015-02-25T07:45:58Z
class:
src/test/java/org/elasticsearch/index/store/StoreTest.java
comments:
[TEST] write.lock is a valid file on a cleaned index

time:
2015-02-25T06:37:41Z
class:
src/main/java/org/elasticsearch/index/mapper/internal/TypeFieldMapper.java
src/test/java/org/elasticsearch/count/query/CountQueryTests.java
src/test/java/org/elasticsearch/index/mapper/all/SimpleAllMapperTests.java
src/test/java/org/elasticsearch/search/query/SearchQueryTests.java
src/test/java/org/elasticsearch/search/suggest/ContextSuggestSearchTests.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
comments:
Mappings: Lock down _type field

see #8143
closes #9869

time:
2015-02-25T00:28:35Z
class:
comments:
Tests: make sure that repository is not stored when old index file is created

Otherwise the fs repository metadata that points to non-existing location is stored in the old index cluster state, which causes warnings during OldIndexBackwardsCompatibilityTests.

time:
2015-02-24T22:26:22Z
class:
src/main/java/org/elasticsearch/index/mapper/MapperService.java
src/main/java/org/elasticsearch/index/mapper/internal/IdFieldMapper.java
src/main/java/org/elasticsearch/index/percolator/QueriesLoaderCollector.java
src/main/java/org/elasticsearch/percolator/PercolatorService.java
src/main/java/org/elasticsearch/percolator/QueryCollector.java
src/test/java/org/elasticsearch/count/query/CountQueryTests.java
src/test/java/org/elasticsearch/index/mapper/id/IdMappingTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/ChildrenTests.java
src/test/java/org/elasticsearch/search/query/SearchQueryTests.java
src/test/java/org/elasticsearch/search/sort/SimpleSortTests.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
comments:
Mappings: Lock down _id field

There are two implications to this change.
First, percolator now uses _uid internally, extracting the id portion
when needed. Second, sorting on _id is no longer possible, since you
can no longer index _id. However, _uid can still be used to sort, and
is better anyways as indexing _id just to make it available to
fielddata for sorting is wasteful.

see #8143
closes #9842

time:
2015-02-24T20:15:19Z
class:
src/main/java/org/elasticsearch/common/lucene/Lucene.java
src/main/java/org/elasticsearch/index/store/Store.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
src/test/java/org/elasticsearch/common/lucene/LuceneTest.java
src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
src/test/java/org/elasticsearch/index/engine/ShadowEngineTests.java
src/test/java/org/elasticsearch/index/store/StoreTest.java
src/test/java/org/elasticsearch/indices/recovery/RecoveryStatusTests.java
comments:
[STORE] Improve safety when deleting files from the store

Today if we delete files from the index directory we never acquire the
write lock. Yet, for safety reasons we should get the write lock before
we modify / delete any files. Where we can we should leave the deletion
to the index writer and only delete that are necessary to delete ourself.

time:
2015-02-24T19:31:49Z
class:
src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreTests.java
comments:
Snapshot/Restore: Allow deletion of snapshots with corrupted snapshot files

Improve resiliency of snapshot deletion operation by allowing deletion of snapshot with corrupted snapshot files.

Closes #9534

time:
2015-02-24T19:19:57Z
class:
src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityTests.java
comments:
Tests: Use all found index files instead of static list for static bwc tests

It is a pain to add a new static index, and then have to update the old
index test.  This removes the need for the latter step.

closes #9854

time:
2015-02-24T18:24:02Z
class:
src/main/java/org/elasticsearch/cloud/aws/AwsEc2Service.java
src/main/java/org/elasticsearch/cloud/aws/AwsSettingsFilter.java
src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
src/test/java/org/elasticsearch/cloud/aws/TestAwsS3Service.java
comments:
Update settings filter

Update settings filter to match elasticsearch/elasticsearch#9748

time:
2015-02-24T18:05:47Z
class:
src/main/java/org/elasticsearch/action/admin/cluster/node/info/NodesInfoResponse.java
src/main/java/org/elasticsearch/action/admin/indices/settings/get/TransportGetSettingsAction.java
src/main/java/org/elasticsearch/cluster/ClusterState.java
src/main/java/org/elasticsearch/common/settings/ImmutableSettings.java
src/main/java/org/elasticsearch/common/settings/SettingsFilter.java
src/main/java/org/elasticsearch/rest/action/admin/cluster/node/info/RestNodesInfoAction.java
src/main/java/org/elasticsearch/rest/action/admin/cluster/reroute/RestClusterRerouteAction.java
src/main/java/org/elasticsearch/rest/action/admin/cluster/state/RestClusterStateAction.java
src/test/java/org/elasticsearch/cluster/settings/SettingsFilteringTests.java
src/test/java/org/elasticsearch/common/settings/SettingsFilterTests.java
src/test/java/org/elasticsearch/rest/FakeRestRequest.java
comments:
Internal: refactor settings filtering

Refactor how settings filters are handled. Instead of specifying settings filters as filtering class, settings filters are now specified as list of settings that needs to be filtered out. Regex syntax is supported. This is breaking change and will require small change in plugins that are using settingsFilters. This change is needed in order to simplify cluster state diff implementation.

Contributes to #6295

time:
2015-02-24T16:41:12Z
class:
src/main/java/org/elasticsearch/action/WriteFailureException.java
src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
src/main/java/org/elasticsearch/action/index/TransportIndexAction.java
src/main/java/org/elasticsearch/action/support/replication/TransportShardReplicationOperationAction.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/test/java/org/elasticsearch/index/mapper/dynamic/DynamicMappingIntegrationTests.java
src/test/java/org/elasticsearch/index/mapper/dynamic/DynamicMappingTests.java
comments:
mappings: update cluster state with type mapping also for failed indexing request

When indexing of a document with a type that is not in the mappings fails,
for example because "dynamic": "strict" but doc contains a new field,
then the type is still created on the node that executed the indexing request.
However, the change was never added to the cluster state.
This commit makes sure mapping updates are always added to the cluster state
even if indexing of a document fails.

closes #8692
relates to #8650

time:
2015-02-24T16:06:10Z
class:
src/main/java/org/elasticsearch/indices/recovery/RecoverySettings.java
src/test/java/org/elasticsearch/index/codec/postingformat/ElasticsearchPostingsFormatTest.java
src/test/java/org/elasticsearch/index/store/DistributorDirectoryTest.java
src/test/java/org/elasticsearch/index/store/DistributorInTheWildTest.java
src/test/java/org/elasticsearch/indices/analyze/HunspellServiceTests.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
src/test/java/org/elasticsearch/test/ElasticsearchLuceneTestCase.java
src/test/java/org/elasticsearch/test/ElasticsearchSingleNodeTest.java
src/test/java/org/elasticsearch/test/ElasticsearchTestCase.java
src/test/java/org/elasticsearch/test/ElasticsearchTokenStreamTestCase.java
comments:
Tests: Remove thread leak filter

Now that the global cluster is gone, we shoudln't need to ignore
thread leaks across tests.  We unfortunately still need suite level
scope, since most tests are using suite scope clusters (although
test clope clusters should really switch back to test scope thread
leaks).

closes #9843

time:
2015-02-24T10:07:24Z
class:
src/main/java/org/elasticsearch/node/Node.java
src/main/java/org/elasticsearch/node/NodeBuilder.java
src/main/java/org/elasticsearch/node/internal/InternalNode.java
src/main/java/org/elasticsearch/tribe/TribeService.java
src/test/java/org/elasticsearch/benchmark/search/aggregations/GlobalOrdinalsBenchmark.java
src/test/java/org/elasticsearch/benchmark/search/aggregations/SubAggregationSearchCollectModeBenchmark.java
src/test/java/org/elasticsearch/benchmark/search/aggregations/TermsAggregationSearchAndIndexingBenchmark.java
src/test/java/org/elasticsearch/benchmark/search/aggregations/TermsAggregationSearchBenchmark.java
src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityTests.java
src/test/java/org/elasticsearch/client/transport/TransportClientTests.java
src/test/java/org/elasticsearch/cluster/routing/RoutingBackwardCompatibilityTests.java
src/test/java/org/elasticsearch/cluster/routing/RoutingBackwardCompatibilityUponUpgradeTests.java
src/test/java/org/elasticsearch/http/netty/HttpPublishPortTests.java
src/test/java/org/elasticsearch/http/netty/NettyPipeliningDisabledIntegrationTest.java
src/test/java/org/elasticsearch/http/netty/NettyPipeliningEnabledIntegrationTest.java
src/test/java/org/elasticsearch/network/DirectBufferNetworkTests.java
src/test/java/org/elasticsearch/options/jsonp/JsonpOptionDisabledTest.java
src/test/java/org/elasticsearch/options/jsonp/JsonpOptionEnabledTest.java
src/test/java/org/elasticsearch/rest/CorsRegexDefaultTests.java
src/test/java/org/elasticsearch/rest/CorsRegexTests.java
src/test/java/org/elasticsearch/rest/action/admin/indices/upgrade/UpgradeTest.java
src/test/java/org/elasticsearch/stresstest/leaks/GenericStatsLeak.java
src/test/java/org/elasticsearch/stresstest/rollingrestart/RollingRestartStressTest.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
src/test/java/org/elasticsearch/test/ElasticsearchSingleNodeTest.java
src/test/java/org/elasticsearch/test/InternalTestCluster.java
src/test/java/org/elasticsearch/test/rest/ElasticsearchRestTests.java
comments:
Remove InternalNode interface

time:
2015-02-24T08:40:32Z
class:
src/test/java/org/elasticsearch/test/ElasticsearchSingleNodeTest.java
comments:
Simplify SingleNodeTest and close propperly instead of calling stop

time:
2015-02-24T05:30:05Z
class:
src/main/java/org/elasticsearch/script/groovy/GroovySandboxExpressionChecker.java
src/test/java/org/elasticsearch/script/GroovySandboxScriptTests.java
comments:
Revert "Add String to the default whitelisted receivers"

This reverts commit f493b982597b4e2724f12414f5b1536fd67ac472.

time:
2015-02-24T00:59:30Z
class:
src/main/java/org/elasticsearch/script/groovy/GroovySandboxExpressionChecker.java
src/test/java/org/elasticsearch/script/GroovySandboxScriptTests.java
comments:
Add String to the default whitelisted receivers

Fixes #8866

time:
2015-02-24T00:52:20Z
class:
src/main/java/org/elasticsearch/common/lucene/Directories.java
comments:
remove dead code

time:
2015-02-23T23:54:41Z
class:
src/main/java/org/elasticsearch/index/mapper/core/AbstractFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/IdFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/RoutingFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/UidFieldMapper.java
src/test/java/org/elasticsearch/search/sort/SimpleSortTests.java
comments:
Mappings: Lock down _uid field

Also, cleanup writePre20Settings so it is shared across all field
mappers.

see #8143

time:
2015-02-23T22:08:28Z
class:
src/main/java/org/apache/lucene/queries/BlendedTermQuery.java
src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
src/main/java/org/apache/lucene/search/suggest/analyzing/XAnalyzingSuggester.java
src/main/java/org/elasticsearch/ElasticsearchException.java
src/main/java/org/elasticsearch/action/ActionRunnable.java
src/main/java/org/elasticsearch/action/ActionWriteResponse.java
src/main/java/org/elasticsearch/action/admin/indices/cache/clear/ClearIndicesCacheRequest.java
src/main/java/org/elasticsearch/action/admin/indices/exists/types/TypesExistsRequest.java
src/main/java/org/elasticsearch/action/admin/indices/exists/types/TypesExistsRequestBuilder.java
src/main/java/org/elasticsearch/action/admin/indices/exists/types/TypesExistsResponse.java
src/main/java/org/elasticsearch/action/admin/indices/mapping/get/TransportGetFieldMappingsIndexAction.java
src/main/java/org/elasticsearch/action/admin/indices/optimize/OptimizeRequest.java
src/main/java/org/elasticsearch/action/bench/BenchmarkExecutor.java
src/main/java/org/elasticsearch/action/bench/BenchmarkService.java
src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
src/main/java/org/elasticsearch/action/delete/DeleteRequest.java
src/main/java/org/elasticsearch/action/delete/DeleteRequestBuilder.java
src/main/java/org/elasticsearch/action/deletebyquery/DeleteByQueryRequest.java
src/main/java/org/elasticsearch/action/deletebyquery/DeleteByQueryRequestBuilder.java
src/main/java/org/elasticsearch/action/explain/ExplainAction.java
src/main/java/org/elasticsearch/action/explain/ExplainRequestBuilder.java
src/main/java/org/elasticsearch/action/explain/ExplainResponse.java
src/main/java/org/elasticsearch/action/explain/TransportExplainAction.java
src/main/java/org/elasticsearch/action/index/IndexRequest.java
src/main/java/org/elasticsearch/action/index/IndexRequestBuilder.java
src/main/java/org/elasticsearch/action/search/SearchResponse.java
src/main/java/org/elasticsearch/action/search/ShardSearchFailure.java
src/main/java/org/elasticsearch/action/support/AbstractListenableActionFuture.java
src/main/java/org/elasticsearch/action/support/HandledTransportAction.java
src/main/java/org/elasticsearch/action/support/QuerySourceBuilder.java
src/main/java/org/elasticsearch/action/support/master/TransportMasterNodeReadOperationAction.java
src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java
src/main/java/org/elasticsearch/action/update/UpdateRequest.java
src/main/java/org/elasticsearch/client/support/AbstractClient.java
src/main/java/org/elasticsearch/client/support/AbstractClusterAdminClient.java
src/main/java/org/elasticsearch/cluster/DiskUsage.java
src/main/java/org/elasticsearch/cluster/ack/ClusterStateUpdateRequest.java
src/main/java/org/elasticsearch/cluster/block/ClusterBlock.java
src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java
src/main/java/org/elasticsearch/cluster/routing/ImmutableShardRouting.java
src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java
src/main/java/org/elasticsearch/cluster/routing/ShardIterator.java
src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java
src/main/java/org/elasticsearch/cluster/routing/allocation/decider/AllocationDeciders.java
src/main/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDecider.java
src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ReplicaAfterPrimaryActiveAllocationDecider.java
src/main/java/org/elasticsearch/cluster/routing/allocation/decider/SnapshotInProgressAllocationDecider.java
src/main/java/org/elasticsearch/cluster/routing/allocation/decider/ThrottlingAllocationDecider.java
src/main/java/org/elasticsearch/cluster/service/InternalClusterService.java
src/main/java/org/elasticsearch/common/Priority.java
src/main/java/org/elasticsearch/common/blobstore/fs/FsBlobContainer.java
src/main/java/org/elasticsearch/common/breaker/ChildMemoryCircuitBreaker.java
src/main/java/org/elasticsearch/common/breaker/MemoryCircuitBreaker.java
src/main/java/org/elasticsearch/common/collect/IdentityHashSet.java
src/main/java/org/elasticsearch/common/geo/GeoPoint.java
src/main/java/org/elasticsearch/common/http/client/HttpDownloadHelper.java
src/main/java/org/elasticsearch/common/inject/AbstractModule.java
src/main/java/org/elasticsearch/common/inject/AbstractProcessor.java
src/main/java/org/elasticsearch/common/inject/BindingProcessor.java
src/main/java/org/elasticsearch/common/inject/BoundProviderFactory.java
src/main/java/org/elasticsearch/common/inject/ConstantFactory.java
src/main/java/org/elasticsearch/common/inject/ConstructorBindingImpl.java
src/main/java/org/elasticsearch/common/inject/ConstructorInjectorStore.java
src/main/java/org/elasticsearch/common/inject/DefaultConstructionProxyFactory.java
src/main/java/org/elasticsearch/common/inject/DeferredLookups.java
src/main/java/org/elasticsearch/common/inject/EncounterImpl.java
src/main/java/org/elasticsearch/common/inject/ExposedKeyFactory.java
src/main/java/org/elasticsearch/common/inject/FactoryProxy.java
src/main/java/org/elasticsearch/common/inject/InheritingState.java
src/main/java/org/elasticsearch/common/inject/Initializables.java
src/main/java/org/elasticsearch/common/inject/Initializer.java
src/main/java/org/elasticsearch/common/inject/InjectionRequestProcessor.java
src/main/java/org/elasticsearch/common/inject/InjectorBuilder.java
src/main/java/org/elasticsearch/common/inject/InjectorImpl.java
src/main/java/org/elasticsearch/common/inject/InjectorShell.java
src/main/java/org/elasticsearch/common/inject/InternalFactoryToProviderAdapter.java
src/main/java/org/elasticsearch/common/inject/Key.java
src/main/java/org/elasticsearch/common/inject/MembersInjectorImpl.java
src/main/java/org/elasticsearch/common/inject/PrivateBinder.java
src/main/java/org/elasticsearch/common/inject/PrivateModule.java
src/main/java/org/elasticsearch/common/inject/ProviderToInternalFactoryAdapter.java
src/main/java/org/elasticsearch/common/inject/Scope.java
src/main/java/org/elasticsearch/common/inject/Scopes.java
src/main/java/org/elasticsearch/common/inject/SingleFieldInjector.java
src/main/java/org/elasticsearch/common/inject/SingleMethodInjector.java
src/main/java/org/elasticsearch/common/inject/State.java
src/main/java/org/elasticsearch/common/inject/TypeConverterBindingProcessor.java
src/main/java/org/elasticsearch/common/inject/assistedinject/FactoryProvider.java
src/main/java/org/elasticsearch/common/inject/assistedinject/FactoryProvider2.java
src/main/java/org/elasticsearch/common/inject/internal/BindingBuilder.java
src/main/java/org/elasticsearch/common/inject/internal/BindingImpl.java
src/main/java/org/elasticsearch/common/inject/internal/ConstantBindingBuilderImpl.java
src/main/java/org/elasticsearch/common/inject/internal/ConstructionContext.java
src/main/java/org/elasticsearch/common/inject/internal/Errors.java
src/main/java/org/elasticsearch/common/inject/internal/ExposedBindingImpl.java
src/main/java/org/elasticsearch/common/inject/internal/ExposureBuilder.java
src/main/java/org/elasticsearch/common/inject/internal/InstanceBindingImpl.java
src/main/java/org/elasticsearch/common/inject/internal/LinkedBindingImpl.java
src/main/java/org/elasticsearch/common/inject/internal/LinkedProviderBindingImpl.java
src/main/java/org/elasticsearch/common/inject/internal/MoreTypes.java
src/main/java/org/elasticsearch/common/inject/internal/PrivateElementsImpl.java
src/main/java/org/elasticsearch/common/inject/internal/ProviderInstanceBindingImpl.java
src/main/java/org/elasticsearch/common/inject/internal/ProviderMethod.java
src/main/java/org/elasticsearch/common/inject/internal/ProviderMethodsModule.java
src/main/java/org/elasticsearch/common/inject/internal/Scoping.java
src/main/java/org/elasticsearch/common/inject/internal/UniqueAnnotations.java
src/main/java/org/elasticsearch/common/inject/internal/UntargettedBindingImpl.java
src/main/java/org/elasticsearch/common/inject/matcher/AbstractMatcher.java
src/main/java/org/elasticsearch/common/inject/matcher/Matchers.java
src/main/java/org/elasticsearch/common/inject/multibindings/MapBinder.java
src/main/java/org/elasticsearch/common/inject/multibindings/Multibinder.java
src/main/java/org/elasticsearch/common/inject/multibindings/RealElement.java
src/main/java/org/elasticsearch/common/inject/name/NamedImpl.java
src/main/java/org/elasticsearch/common/inject/spi/ConvertedConstantBinding.java
src/main/java/org/elasticsearch/common/inject/spi/DefaultBindingScopingVisitor.java
src/main/java/org/elasticsearch/common/inject/spi/DefaultBindingTargetVisitor.java
src/main/java/org/elasticsearch/common/inject/spi/DefaultElementVisitor.java
src/main/java/org/elasticsearch/common/inject/spi/Elements.java
src/main/java/org/elasticsearch/common/inject/spi/ExposedBinding.java
src/main/java/org/elasticsearch/common/inject/spi/InjectionPoint.java
src/main/java/org/elasticsearch/common/inject/spi/InjectionRequest.java
src/main/java/org/elasticsearch/common/inject/spi/MembersInjectorLookup.java
src/main/java/org/elasticsearch/common/inject/spi/Message.java
src/main/java/org/elasticsearch/common/inject/spi/ProviderLookup.java
src/main/java/org/elasticsearch/common/inject/spi/ScopeBinding.java
src/main/java/org/elasticsearch/common/inject/spi/StaticInjectionRequest.java
src/main/java/org/elasticsearch/common/inject/spi/TypeConverterBinding.java
src/main/java/org/elasticsearch/common/inject/spi/TypeListenerBinding.java
src/main/java/org/elasticsearch/common/inject/util/Modules.java
src/main/java/org/elasticsearch/common/inject/util/Providers.java
src/main/java/org/elasticsearch/common/io/FastCharArrayReader.java
src/main/java/org/elasticsearch/common/io/FastCharArrayWriter.java
src/main/java/org/elasticsearch/common/io/FastStringReader.java
src/main/java/org/elasticsearch/common/io/ReleasableBytesStream.java
src/main/java/org/elasticsearch/common/io/UTF8StreamWriter.java
src/main/java/org/elasticsearch/common/io/stream/BytesStreamOutput.java
src/main/java/org/elasticsearch/common/io/stream/StreamInput.java
src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java
src/main/java/org/elasticsearch/common/joda/Joda.java
src/main/java/org/elasticsearch/common/lease/Releasable.java
src/main/java/org/elasticsearch/common/logging/jdk/ESLogRecord.java
src/main/java/org/elasticsearch/common/logging/log4j/ConsoleAppender.java
src/main/java/org/elasticsearch/common/logging/log4j/Log4jESLogger.java
src/main/java/org/elasticsearch/common/lucene/LoggerInfoStream.java
src/main/java/org/elasticsearch/common/lucene/all/AllEntries.java
src/main/java/org/elasticsearch/common/lucene/search/FilteredCollector.java
src/main/java/org/elasticsearch/common/lucene/search/XBooleanFilter.java
src/main/java/org/elasticsearch/common/lucene/search/function/CustomBoostFactorScorer.java
src/main/java/org/elasticsearch/common/lucene/search/function/FiltersFunctionScoreQuery.java
src/main/java/org/elasticsearch/common/lucene/search/function/FunctionScoreQuery.java
src/main/java/org/elasticsearch/common/netty/OpenChannelsHandler.java
src/main/java/org/elasticsearch/common/network/MulticastChannel.java
src/main/java/org/elasticsearch/common/recycler/AbstractRecycler.java
src/main/java/org/elasticsearch/common/recycler/AbstractRecyclerC.java
src/main/java/org/elasticsearch/common/settings/ImmutableSettings.java
src/main/java/org/elasticsearch/common/text/Text.java
src/main/java/org/elasticsearch/common/text/UTF8SortedAsUnicodeComparator.java
src/main/java/org/elasticsearch/common/unit/Percent.java
src/main/java/org/elasticsearch/common/unit/RatioValue.java
src/main/java/org/elasticsearch/common/util/AbstractBigArray.java
src/main/java/org/elasticsearch/common/util/AbstractHash.java
src/main/java/org/elasticsearch/common/util/BigArrays.java
src/main/java/org/elasticsearch/common/util/BigByteArray.java
src/main/java/org/elasticsearch/common/util/BigDoubleArray.java
src/main/java/org/elasticsearch/common/util/BigFloatArray.java
src/main/java/org/elasticsearch/common/util/BigIntArray.java
src/main/java/org/elasticsearch/common/util/BigLongArray.java
src/main/java/org/elasticsearch/common/util/BigObjectArray.java
src/main/java/org/elasticsearch/common/util/MinimalMap.java
src/main/java/org/elasticsearch/common/util/concurrent/AbstractRunnable.java
src/main/java/org/elasticsearch/common/util/concurrent/ConcurrentHashMapLong.java
src/main/java/org/elasticsearch/common/util/concurrent/EsExecutors.java
src/main/java/org/elasticsearch/common/util/concurrent/ThreadBarrier.java
src/main/java/org/elasticsearch/common/xcontent/XContentBuilder.java
src/main/java/org/elasticsearch/discovery/local/LocalDiscovery.java
src/main/java/org/elasticsearch/discovery/zen/fd/MasterFaultDetection.java
src/main/java/org/elasticsearch/discovery/zen/fd/NodesFaultDetection.java
src/main/java/org/elasticsearch/discovery/zen/ping/unicast/UnicastZenPing.java
src/main/java/org/elasticsearch/env/NodeEnvironment.java
src/main/java/org/elasticsearch/gateway/MetaDataStateFormat.java
src/main/java/org/elasticsearch/http/netty/NettyHttpServerTransport.java
src/main/java/org/elasticsearch/index/analysis/AnalysisService.java
src/main/java/org/elasticsearch/index/analysis/AnalyzerProvider.java
src/main/java/org/elasticsearch/index/analysis/ShingleTokenFilterFactory.java
src/main/java/org/elasticsearch/index/cache/bitset/BitsetFilterCache.java
src/main/java/org/elasticsearch/index/cache/filter/weighted/WeightedFilterCache.java
src/main/java/org/elasticsearch/index/deletionpolicy/KeepLastNDeletionPolicy.java
src/main/java/org/elasticsearch/index/deletionpolicy/KeepOnlyLastDeletionPolicy.java
src/main/java/org/elasticsearch/index/deletionpolicy/SnapshotDeletionPolicy.java
src/main/java/org/elasticsearch/index/deletionpolicy/SnapshotIndexCommit.java
src/main/java/org/elasticsearch/index/deletionpolicy/SnapshotIndexCommits.java
src/main/java/org/elasticsearch/index/engine/FlushingRecoveryCounter.java
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
src/main/java/org/elasticsearch/index/fielddata/IndexOrdinalsFieldData.java
src/main/java/org/elasticsearch/index/fielddata/IndexParentChildFieldData.java
src/main/java/org/elasticsearch/index/fielddata/ScriptDocValues.java
src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefFieldComparatorSource.java
src/main/java/org/elasticsearch/index/fielddata/ordinals/Ordinals.java
src/main/java/org/elasticsearch/index/fielddata/plain/AbstractAtomicGeoPointFieldData.java
src/main/java/org/elasticsearch/index/fielddata/plain/AbstractIndexFieldData.java
src/main/java/org/elasticsearch/index/fielddata/plain/BinaryDVNumericIndexFieldData.java
src/main/java/org/elasticsearch/index/fielddata/plain/PagedBytesIndexFieldData.java
src/main/java/org/elasticsearch/index/fielddata/plain/SortedSetDVOrdinalsIndexFieldData.java
src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java
src/main/java/org/elasticsearch/index/mapper/ParseContext.java
src/main/java/org/elasticsearch/index/mapper/core/AbstractFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/geo/GeoPointFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/BoostFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/IdFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/TimestampFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/object/ObjectMapper.java
src/main/java/org/elasticsearch/index/merge/scheduler/ConcurrentMergeSchedulerProvider.java
src/main/java/org/elasticsearch/index/merge/scheduler/MergeSchedulerProvider.java
src/main/java/org/elasticsearch/index/percolator/PercolatorQueriesRegistry.java
src/main/java/org/elasticsearch/index/query/BoolQueryBuilder.java
src/main/java/org/elasticsearch/index/query/BoostingQueryBuilder.java
src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java
src/main/java/org/elasticsearch/index/query/ConstantScoreQueryBuilder.java
src/main/java/org/elasticsearch/index/query/DisMaxQueryBuilder.java
src/main/java/org/elasticsearch/index/query/FieldMaskingSpanQueryBuilder.java
src/main/java/org/elasticsearch/index/query/FilteredQueryBuilder.java
src/main/java/org/elasticsearch/index/query/FuzzyLikeThisFieldQueryBuilder.java
src/main/java/org/elasticsearch/index/query/FuzzyLikeThisQueryBuilder.java
src/main/java/org/elasticsearch/index/query/FuzzyQueryBuilder.java
src/main/java/org/elasticsearch/index/query/HasChildQueryBuilder.java
src/main/java/org/elasticsearch/index/query/HasParentQueryBuilder.java
src/main/java/org/elasticsearch/index/query/IdsQueryBuilder.java
src/main/java/org/elasticsearch/index/query/MatchAllQueryBuilder.java
src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java
src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
src/main/java/org/elasticsearch/index/query/MultiMatchQueryBuilder.java
src/main/java/org/elasticsearch/index/query/NestedQueryBuilder.java
src/main/java/org/elasticsearch/index/query/PrefixQueryBuilder.java
src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
src/main/java/org/elasticsearch/index/query/RangeQueryBuilder.java
src/main/java/org/elasticsearch/index/query/RegexpQueryBuilder.java
src/main/java/org/elasticsearch/index/query/SpanFirstQueryBuilder.java
src/main/java/org/elasticsearch/index/query/SpanNearQueryBuilder.java
src/main/java/org/elasticsearch/index/query/SpanNotQueryBuilder.java
src/main/java/org/elasticsearch/index/query/SpanOrQueryBuilder.java
src/main/java/org/elasticsearch/index/query/SpanTermQueryBuilder.java
src/main/java/org/elasticsearch/index/query/TermQueryBuilder.java
src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java
src/main/java/org/elasticsearch/index/query/TopChildrenQueryBuilder.java
src/main/java/org/elasticsearch/index/query/WildcardQueryBuilder.java
src/main/java/org/elasticsearch/index/query/functionscore/DecayFunctionParser.java
src/main/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilder.java
src/main/java/org/elasticsearch/index/search/MultiMatchQuery.java
src/main/java/org/elasticsearch/index/search/child/ChildrenQuery.java
src/main/java/org/elasticsearch/index/search/child/ParentConstantScoreQuery.java
src/main/java/org/elasticsearch/index/search/child/TopChildrenQuery.java
src/main/java/org/elasticsearch/index/search/nested/IncludeNestedDocsQuery.java
src/main/java/org/elasticsearch/index/store/IndexStoreModule.java
src/main/java/org/elasticsearch/index/store/distributor/AbstractDistributor.java
src/main/java/org/elasticsearch/index/store/support/AbstractIndexStore.java
src/main/java/org/elasticsearch/index/translog/TranslogService.java
src/main/java/org/elasticsearch/index/translog/fs/BufferingFsTranslogFile.java
src/main/java/org/elasticsearch/index/translog/fs/SimpleFsTranslogFile.java
src/main/java/org/elasticsearch/indices/InternalIndicesLifecycle.java
src/main/java/org/elasticsearch/indices/analysis/IndicesAnalysisService.java
src/main/java/org/elasticsearch/indices/breaker/CircuitBreakerService.java
src/main/java/org/elasticsearch/indices/cache/filter/terms/TermsLookup.java
src/main/java/org/elasticsearch/indices/fielddata/cache/IndicesFieldDataCache.java
src/main/java/org/elasticsearch/indices/recovery/RecoverySettings.java
src/main/java/org/elasticsearch/indices/recovery/ShardRecoveryHandler.java
src/main/java/org/elasticsearch/indices/ttl/IndicesTTLService.java
src/main/java/org/elasticsearch/monitor/jvm/HotThreads.java
src/main/java/org/elasticsearch/node/Node.java
src/main/java/org/elasticsearch/node/internal/InternalNode.java
src/main/java/org/elasticsearch/percolator/PercolateContext.java
src/main/java/org/elasticsearch/plugins/PluginManager.java
src/main/java/org/elasticsearch/rest/RestResponse.java
src/main/java/org/elasticsearch/script/mustache/MustacheScriptEngineService.java
src/main/java/org/elasticsearch/search/action/SearchServiceTransportAction.java
src/main/java/org/elasticsearch/search/aggregations/AggregatorBase.java
src/main/java/org/elasticsearch/search/aggregations/BucketCollector.java
src/main/java/org/elasticsearch/search/aggregations/InternalAggregation.java
src/main/java/org/elasticsearch/search/aggregations/InternalAggregations.java
src/main/java/org/elasticsearch/search/aggregations/InternalMultiBucketAggregation.java
src/main/java/org/elasticsearch/search/aggregations/bucket/MultiBucketsAggregation.java
src/main/java/org/elasticsearch/search/aggregations/bucket/SingleBucketAggregation.java
src/main/java/org/elasticsearch/search/aggregations/bucket/filters/Filters.java
src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridParser.java
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/Histogram.java
src/main/java/org/elasticsearch/search/aggregations/bucket/range/InternalRange.java
src/main/java/org/elasticsearch/search/aggregations/bucket/range/Range.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsParametersParser.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/GND.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/GlobalOrdinalsStringTermsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalOrder.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/Terms.java
src/main/java/org/elasticsearch/search/aggregations/metrics/InternalNumericMetricsAggregation.java
src/main/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvg.java
src/main/java/org/elasticsearch/search/aggregations/metrics/max/InternalMax.java
src/main/java/org/elasticsearch/search/aggregations/metrics/min/InternalMin.java
src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/InternalPercentileRanks.java
src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/InternalPercentiles.java
src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentileRanksParser.java
src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentilesParser.java
comments:
Add missing @Override annotations.

These help a lot when refactoring, upgrading lucene, etc, and
can prevent code duplication (as you get a compile error for outdated stuff).

Closes #9832.

time:
2015-02-23T20:13:23Z
class:
src/test/java/org/elasticsearch/test/ElasticsearchSingleNodeLuceneTestCase.java
src/test/java/org/elasticsearch/test/ElasticsearchSingleNodeTest.java
comments:
[TEST] Don't reuse single node tests node instance across tests

Similar to the shared cluster we should not reuse the node from
singlenodetest across tests.

time:
2015-02-23T19:56:10Z
class:
src/main/java/org/elasticsearch/index/store/Store.java
comments:
[STORE] add debug logging if delete fails

time:
2015-02-23T19:55:01Z
class:
src/main/java/org/elasticsearch/index/store/Store.java
comments:
remove dead code

time:
2015-02-23T19:09:05Z
class:
comments:
Remove Triple Negative!

Double negatives are confusing, but a triple negative (1 no, 2 non, 3 null)? It takes five minutes to understand this little sentence.  Cleaned that up a bit.

Closes #9789

time:
2015-02-23T18:25:24Z
class:
src/main/java/org/elasticsearch/common/cli/CheckFileCommand.java
src/main/java/org/elasticsearch/common/io/FileSystemUtils.java
src/main/java/org/elasticsearch/index/gateway/IndexShardGateway.java
src/main/java/org/elasticsearch/plugins/PluginManager.java
comments:
some more simple fs cleanups.

the isSameFile() sha1 logic is just flat out buggy, in addition to wasting cpu.

Closes #9827

time:
2015-02-23T18:10:56Z
class:
src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramTests.java
comments:
[Test] Add `date_histogram` test for time zone corner case

Add test case for time zone issue reported in #8209, already fixed
on master by previous changes in TimeZoneRounding classes.

time:
2015-02-23T16:46:28Z
class:
src/test/java/org/elasticsearch/index/mapper/attachment/test/unit/VariousDocTest.java
comments:
[Test] Fix remaining static objects after running tests

Test framework detects when static objects are not released when running tests.
This commit remove usage of static objects when possible.

time:
2015-02-23T15:56:39Z
class:
comments:
update documentation with release 2.4.3

time:
2015-02-23T15:43:45Z
class:
src/test/java/org/elasticsearch/index/mapper/attachment/test/unit/VariousDocTest.java
comments:
Add test for asciidoc format

Related to #29.

time:
2015-02-23T13:49:21Z
class:
src/main/java/org/elasticsearch/script/ScriptService.java
src/test/java/org/elasticsearch/index/query/TemplateQueryTest.java
src/test/java/org/elasticsearch/script/OnDiskScriptTests.java
src/test/java/org/elasticsearch/script/ScriptParameterParserTest.java
comments:
Scripting: Removed deprecated script parameter names

This change removes the deprecated script parameter names ('file', 'id', and 'scriptField').
It also removes the ability to load file scripts using the 'script' parameter. File scripts should be loaded using the 'script_file' parameter only.

time:
2015-02-23T13:49:08Z
class:
src/main/java/org/elasticsearch/index/mapper/attachment/AttachmentMapper.java
src/main/java/org/elasticsearch/plugin/mapper/attachments/tika/LocaleChecker.java
src/main/java/org/elasticsearch/plugin/mapper/attachments/tika/TikaInstance.java
src/test/java/org/elasticsearch/index/mapper/attachment/test/MapperTestUtils.java
src/test/java/org/elasticsearch/index/mapper/attachment/test/integration/AttachmentIntegrationTestCase.java
src/test/java/org/elasticsearch/index/mapper/attachment/test/integration/EncryptedAttachmentIntegrationTests.java
src/test/java/org/elasticsearch/index/mapper/attachment/test/integration/SimpleAttachmentIntegrationTests.java
src/test/java/org/elasticsearch/index/mapper/attachment/test/unit/AttachmentUnitTestCase.java
src/test/java/org/elasticsearch/index/mapper/attachment/test/unit/DateAttachmentMapperTests.java
src/test/java/org/elasticsearch/index/mapper/attachment/test/unit/EncryptedDocMapperTest.java
src/test/java/org/elasticsearch/index/mapper/attachment/test/unit/LanguageDetectionAttachmentMapperTests.java
src/test/java/org/elasticsearch/index/mapper/attachment/test/unit/MetadataMapperTest.java
src/test/java/org/elasticsearch/index/mapper/attachment/test/unit/MultifieldAttachmentMapperTests.java
src/test/java/org/elasticsearch/index/mapper/attachment/test/unit/SimpleAttachmentMapperTests.java
src/test/java/org/elasticsearch/index/mapper/attachment/test/unit/VariousDocTest.java
comments:
Tika might fails depending on the Locale

Tika might fail with some Locale under some JVMs. We now check that won't happen before creating a Tika instance.
That will generate a `WARN` in logs like:

```
Tika can not be initialized with the current Locale [tr] on the current JVM [1.7.0_60]
```

To check that Tika is not initialized, you can run the test suite with:

```sh
mvn test -Dtests.output=always -Dtests.locale=tr
```

Closes #105.
(cherry picked from commit d6d63f7)
(cherry picked from commit 532bdf7)

time:
2015-02-23T11:55:36Z
class:
src/test/java/org/elasticsearch/common/rounding/TimeZoneRoundingTests.java
comments:
Adding tests for timezone rounding:
1. Test using the pre_zone_adjust_large_interval option.
2. Test rounding of ambiguous timestamps in local time (after DST switch)

time:
2015-02-23T11:28:13Z
class:
src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
src/main/java/org/elasticsearch/discovery/zen/fd/NodesFaultDetection.java
src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptions.java
src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTest.java
src/test/java/org/elasticsearch/test/InternalTestCluster.java
src/test/java/org/elasticsearch/test/disruption/IntermittentLongGCDisruption.java
src/test/java/org/elasticsearch/test/disruption/LongGCDisruption.java
comments:
[Discovery] Prevent stale master nodes from sharing dated cluster states to nodes that have moved to a different master node.

If an elected master node goes into a long gc then other nodes' fault detection will notice this and a new master election is started and eventually a new master node is elected. If the previous master nodes goes out of the long gc it can still have pending tasks which can result in new cluster state updates. Nodes that are still in the nodes list of this previous elected master node can get these cluster state updates. This commit makes sure that this dated cluster states are not accepted by these nodes.

This issue can temporary lead to the fact that non elected master nodes switch to the previous elected master node. The new elected master node also gets the same dated cluster state, but rejects it and tells the previous elected master node to step down and rejoin. Because the new elected master is the only master node the previous elected master node will follow the new elected master node. Any nodes that follow the previous elected master node (by accident), will also rejoin and follow the new elected master node because their master fault detection will fail. So all in all this isn't a severe problem, because the problem fixes itself eventually.

Closes #9632

time:
2015-02-23T11:16:28Z
class:
comments:
[DOCS] update script docs to use preferred script parameter names

time:
2015-02-23T10:54:38Z
class:
src/test/java/org/elasticsearch/index/mapper/attachment/test/MapperTestUtils.java
src/test/java/org/elasticsearch/index/mapper/attachment/test/integration/EncryptedAttachmentIntegrationTests.java
src/test/java/org/elasticsearch/index/mapper/attachment/test/integration/SimpleAttachmentIntegrationTests.java
src/test/java/org/elasticsearch/index/mapper/attachment/test/standalone/StandaloneRunner.java
src/test/java/org/elasticsearch/index/mapper/attachment/test/unit/DateAttachmentMapperTests.java
src/test/java/org/elasticsearch/index/mapper/attachment/test/unit/EncryptedDocMapperTest.java
src/test/java/org/elasticsearch/index/mapper/attachment/test/unit/LanguageDetectionAttachmentMapperTests.java
src/test/java/org/elasticsearch/index/mapper/attachment/test/unit/MetadataMapperTest.java
src/test/java/org/elasticsearch/index/mapper/attachment/test/unit/MultifieldAttachmentMapperTests.java
src/test/java/org/elasticsearch/index/mapper/attachment/test/unit/SimpleAttachmentMapperTests.java
src/test/java/org/elasticsearch/index/mapper/attachment/test/unit/VariousDocTest.java
src/test/java/org/elasticsearch/plugin/mapper/attachments/test/HighlightAttachmentIntegrationTests.java
comments:
[Test] move test package to o.e.index.mapper.attachment

Our package naming for tests is inconsistent.
We should move tests from:

* `o.e.index.mapper.xcontent` to  `o.e.index.mapper.attachment.test.unit`
* `o.e.plugin.mapper.attachments.test` to  `o.e.index.mapper.attachment.test.integration`
* `StandaloneRunner` class to  `o.e.index.mapper.attachment.test.standalone`

Also rename resource dirs to match the test name so it's definitely easier to find mappings used for each test.

Closes #110.

time:
2015-02-23T10:10:50Z
class:
comments:
[Doc] highlighting example is incorrect

Closes #107.

time:
2015-02-23T10:10:49Z
class:
src/test/java/org/elasticsearch/plugin/mapper/attachments/test/HighlightAttachmentIntegrationTests.java
comments:
[Test] Add highlighting test

Closes #108.

(cherry picked from commit 2c96550)
(cherry picked from commit 440e534)

time:
2015-02-23T10:04:35Z
class:
src/main/java/org/elasticsearch/index/mapper/attachment/AttachmentMapper.java
comments:
[Internal] Fix field mappers to always pass through index settings

Caused by https://github.com/elasticsearch/elasticsearch/pull/9780 we now need to pass index settings instead of empty settings.

Closes #109.

time:
2015-02-23T09:12:03Z
class:
src/main/java/org/elasticsearch/index/store/fs/DefaultFsDirectoryService.java
comments:
Core: don't listAll twice

In #6636 we switched to a default FileSwitchDirectory that made
.listAll run twice on the same underlying file system directory.

This fixes listAll to do a single directory listing again.

Closes #9666

time:
2015-02-23T08:49:05Z
class:
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
src/test/java/org/elasticsearch/test/ElasticsearchThreadFilter.java
src/test/java/org/elasticsearch/threadpool/SimpleThreadPoolTests.java
comments:
Remove unused constant

time:
2015-02-23T08:41:29Z
class:
src/test/java/org/elasticsearch/indices/state/OpenCloseIndexTests.java
comments:
[TEST] use same type in mapping and for indexing

time:
2015-02-23T06:14:18Z
class:
src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java
src/main/java/org/elasticsearch/index/mapper/core/AbstractFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/core/BinaryFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/geo/GeoShapeFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/AllFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/IndexFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/TypeFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/UidFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/VersionFieldMapper.java
src/test/java/org/elasticsearch/index/mapper/externalvalues/ExternalMapper.java
src/test/java/org/elasticsearch/search/suggest/completion/CompletionPostingsFormatTest.java
comments:
Internal: Fix field mappers to always pass through index settings

Currently many meta field mappers do not take index settings in their
simple constructor that DocumentMapper uses, and instead pass null or
empty settings to the parent abstract mapper.  This change fixes them to
pass through index settings, and adds an assertion in AbstractFieldMapper
that settings are not null.

closes #9780

time:
2015-02-23T06:04:22Z
class:
src/test/java/org/elasticsearch/network/DirectBufferNetworkTests.java
src/test/java/org/elasticsearch/rest/CorsRegexDefaultTests.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
src/test/java/org/elasticsearch/test/discovery/ClusterDiscoveryConfiguration.java
src/test/java/org/elasticsearch/test/rest/ElasticsearchRestTests.java
comments:
Tests: Remove global shared cluster

This was previously attempted in #8854. I revived that branch and did
some performance testing as was suggested in the comments there.

I fixed all the errors, mostly just the rest tests, which
needed to have http enabled on the node settings (the global cluster
previously had this always enabled). I also addressed the comments from
that issue.

My performance tests involved running the entire test suite on my
desktop which has 6 cores, 16GB of ram, and nothing else was being
run on the box at the time. I ran each set of settings 3 times and
took the average time.

| mode    | master | patch | diff |
| ------- | ------ | ----- | ---- |
| local   | 409s   | 417s  | +2%  |
| network | 368s   | 380s  | +3%  |

This increase in average time is clearly worthwhile to pay to achieve
isolation of tests. One caveat is the way I fixed the rest tests
is still to have one cluster for the entire suite, so all the rest
tests can still potentially affect each other, but this is an
issue for another day.

There were some oddities that I noticed while running these tests
that I would like to point out, as they probably deserve some
investigation (but orthogonal to this PR):
* The total test run times are highly variable (more than a minute between the min and max)
* Running in network mode is on average actually *faster* than local mode. How is this possible!?

time:
2015-02-22T22:31:44Z
class:
src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
src/main/java/org/elasticsearch/common/blobstore/fs/FsBlobContainer.java
src/main/java/org/elasticsearch/common/io/FileSystemUtils.java
src/main/java/org/elasticsearch/env/NodeEnvironment.java
src/main/java/org/elasticsearch/gateway/MetaDataStateFormat.java
src/main/java/org/elasticsearch/http/HttpServer.java
src/main/java/org/elasticsearch/plugins/PluginManager.java
src/main/java/org/elasticsearch/plugins/PluginsService.java
src/main/java/org/elasticsearch/watcher/FileWatcher.java
comments:
Remove redundant fs metadata ops.

Files.exists(f) && Files.isDirectory(f) -> Files.exists(f)
if (Files.exists(f)) Files.delete(f) -> Files.deleteIfExists(f)
if (!Files.exists(f)) Files.createDirectories(f) -> Files.createDirectories(f)

In a few places where successive i/o ops are done against the same file, convert
to Files.readAttributes().

Closes #9807.

time:
2015-02-22T22:15:59Z
class:
comments:
Docs: Document that the fielddata loading defaults to eager on the _parent field.

Closes #9804

time:
2015-02-22T22:06:18Z
class:
src/test/java/org/elasticsearch/search/child/SimpleChildQuerySearchTests.java
comments:
Muted testParentFieldToNonExistingType test

time:
2015-02-21T13:26:20Z
class:
src/main/java/org/elasticsearch/index/IndexService.java
comments:
[CORE] close all resources even if #beforeIndexShardClosed throws an exception

Conflicts:
	src/main/java/org/elasticsearch/index/IndexService.java

time:
2015-02-21T08:22:16Z
class:
src/main/java/org/elasticsearch/index/IndexService.java
src/main/java/org/elasticsearch/indices/IndicesService.java
comments:
add more logging and fix pending delete removal

time:
2015-02-20T22:59:17Z
class:
src/test/java/org/elasticsearch/common/jna/Kernel32LibraryTests.java
comments:
set AwaitsFix until we discuss if proxies are needed

time:
2015-02-20T22:16:23Z
class:
src/test/java/org/elasticsearch/env/NodeEnvironmentTests.java
comments:
fix test bug

time:
2015-02-20T21:30:02Z
class:
src/main/java/org/elasticsearch/common/lucene/Lucene.java
comments:
Prune all segment_N files not just newer ones
why are we deleting files here without a write.lock?

well for correctness we should acquire it... at this point the caller knows there is no writer open... but you are right ofcourse

How does it know? its a public method.

And why are we manually deleting lucene files. Please forgive me if i missed a discussion, I'm sure i did, but this does not seem like the right direction.

We could maybe try the idea of letting IW do the deletion, but then afterwards verify it actually removed the "broken too new" segments_N?  This would still throw an exc when we could not delete the broken commits, but would let Lucene (IW) handle all deleting...

yeah, i mean, if ES is deleting files, its gonna totally hose over ideas like this: https://issues.apache.org/jira/browse/LUCENE-6171

if you delete segments_N because its newer than N_1, then when you load up indexwriter, next commit will be segments_N again.


time:
2015-02-20T21:11:10Z
class:
src/main/java/org/elasticsearch/cluster/action/index/NodeIndexDeletedAction.java
src/main/java/org/elasticsearch/env/NodeEnvironment.java
src/main/java/org/elasticsearch/indices/IndicesService.java
src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
src/test/java/org/elasticsearch/env/NodeEnvironmentTests.java
src/test/java/org/elasticsearch/indices/IndicesServiceTest.java
comments:
[ENV] NodeEnv should lock all shards for an index

Today locking all shards only locks the shards that are present on
the node or that still have a shard directory. This can lead to odd
behavior if another shard that doesn't exist yet is allocated while
all shards are supposed to be locked.

time:
2015-02-20T19:18:53Z
class:
src/test/java/org/elasticsearch/script/IndexLookupTests.java
comments:
replace awaitsfix url with underlying lucene issue for index lookup failure

time:
2015-02-20T18:02:43Z
class:
src/main/java/org/elasticsearch/index/mapper/attachment/AttachmentMapper.java
src/test/java/org/elasticsearch/index/mapper/xcontent/VariousDocTest.java
comments:
Indexing docx file fails

I use ElasticSearch 1.4.3 with mapper-attachment plugin 2.4.2 (TIKA 1.7).

I get an error when indexing **specific** docx file:
> "[DEBUG][org.elasticsearch.index.mapper.attachment.AttachmentMapper] Failed to extract [-1] characters of text for [null]: [org.apache.poi.xwpf.usermodel.XWPFSDT.getContent()Lorg/apache/poi/xwpf/usermodel/ISDTContent;]"

But if i use mapper-attachment plugin 2.4.1 (TIKA 1.5) there is no error and content is parsed successfully.

Caused by this change #94.

Closes #104.

time:
2015-02-20T17:18:14Z
class:
src/main/java/org/elasticsearch/common/geo/builders/GeometryCollectionBuilder.java
src/test/java/org/elasticsearch/search/geo/GeoShapeIntegrationTests.java
src/test/java/org/elasticsearch/test/geo/RandomShapeGenerator.java
comments:
[GEO] Adds randomization to geo test suite

Adds RandomShapeGenerator for creating random shape types. This adds a level of randomized testing to the Geospatial logic. An initial randomized GeometryCollection test is added to the GeoShapeIntegrationTest suite for validating and verifying geo_shape filter behavior. The RandomShapeGenerator can/should be used in Unit and Integration testing to avoid biased testing.

closes #9588

time:
2015-02-20T14:01:04Z
class:
src/test/java/org/elasticsearch/script/IndexLookupTests.java
comments:
Mute IndexLookupTests temporarily.

time:
2015-02-20T13:22:08Z
class:
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/PercentageScore.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/SignificanceHeuristic.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/SignificantTermsHeuristicModule.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/TransportSignificantTermsHeuristicModule.java
src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/significant/SignificanceHeuristicTests.java
comments:
New aggregations feature - “PercentageScore” heuristic for significant_terms aggregation provides simple “per-capita” type measures.

Closes #9720

time:
2015-02-20T12:14:35Z
class:
src/main/java/org/elasticsearch/common/lucene/Lucene.java
src/test/java/org/elasticsearch/common/lucene/LuceneTest.java
comments:
Add missing segments file to the lucene file listing

Relates to #9761

time:
2015-02-20T12:11:37Z
class:
comments:
ban deprecated lucene postings apis

time:
2015-02-20T12:02:25Z
class:
src/test/java/org/elasticsearch/search/suggest/completion/CompletionPostingsFormatTest.java
comments:
add missing import

time:
2015-02-20T11:58:43Z
class:
src/main/java/org/apache/lucene/search/postingshighlight/XPostingsHighlighter.java
src/main/java/org/apache/lucene/search/vectorhighlight/CustomFieldQuery.java
src/main/java/org/elasticsearch/action/termvectors/TermVectorsFields.java
src/main/java/org/elasticsearch/action/termvectors/TermVectorsResponse.java
src/main/java/org/elasticsearch/action/termvectors/TermVectorsWriter.java
src/main/java/org/elasticsearch/common/lucene/Lucene.java
src/main/java/org/elasticsearch/common/lucene/all/AllTermQuery.java
src/main/java/org/elasticsearch/common/lucene/index/FilterableTermsEnum.java
src/main/java/org/elasticsearch/common/lucene/index/FreqTermsEnum.java
src/main/java/org/elasticsearch/common/lucene/search/AndFilter.java
src/main/java/org/elasticsearch/common/lucene/search/EmptyScorer.java
src/main/java/org/elasticsearch/common/lucene/search/LimitFilter.java
src/main/java/org/elasticsearch/common/lucene/search/MatchAllDocsFilter.java
src/main/java/org/elasticsearch/common/lucene/search/MatchNoDocsFilter.java
src/main/java/org/elasticsearch/common/lucene/search/MatchNoDocsQuery.java
src/main/java/org/elasticsearch/common/lucene/search/NoCacheFilter.java
src/main/java/org/elasticsearch/common/lucene/search/NotFilter.java
src/main/java/org/elasticsearch/common/lucene/search/OrFilter.java
src/main/java/org/elasticsearch/common/lucene/search/Queries.java
src/main/java/org/elasticsearch/common/lucene/search/RegexpFilter.java
src/main/java/org/elasticsearch/common/lucene/search/XBooleanFilter.java
src/main/java/org/elasticsearch/common/lucene/search/XMoreLikeThis.java
src/main/java/org/elasticsearch/common/lucene/search/function/CustomBoostFactorScorer.java
src/main/java/org/elasticsearch/common/lucene/search/function/FiltersFunctionScoreQuery.java
src/main/java/org/elasticsearch/common/lucene/search/function/FunctionScoreQuery.java
src/main/java/org/elasticsearch/common/lucene/search/function/ScriptScoreFunction.java
src/main/java/org/elasticsearch/common/lucene/uid/PerThreadIDAndVersionLookup.java
src/main/java/org/elasticsearch/index/cache/bitset/BitsetFilterCache.java
src/main/java/org/elasticsearch/index/cache/filter/weighted/WeightedFilterCache.java
src/main/java/org/elasticsearch/index/codec/postingsformat/BloomFilterPostingsFormat.java
src/main/java/org/elasticsearch/index/fielddata/ordinals/OrdinalsBuilder.java
src/main/java/org/elasticsearch/index/fielddata/plain/FSTBytesIndexFieldData.java
src/main/java/org/elasticsearch/index/fielddata/plain/PagedBytesIndexFieldData.java
src/main/java/org/elasticsearch/index/fielddata/plain/ParentChildIndexFieldData.java
src/main/java/org/elasticsearch/index/fielddata/plain/ParentChildIntersectTermsEnum.java
src/main/java/org/elasticsearch/index/mapper/core/DateFieldMapper.java
src/main/java/org/elasticsearch/index/merge/policy/VersionFieldUpgrader.java
src/main/java/org/elasticsearch/index/query/FilteredQueryParser.java
src/main/java/org/elasticsearch/index/query/QueryParseContext.java
src/main/java/org/elasticsearch/index/query/ScriptFilterParser.java
src/main/java/org/elasticsearch/index/search/FieldDataTermsFilter.java
src/main/java/org/elasticsearch/index/search/NumericRangeFieldDataFilter.java
src/main/java/org/elasticsearch/index/search/child/ChildrenConstantScoreQuery.java
src/main/java/org/elasticsearch/index/search/child/ChildrenQuery.java
src/main/java/org/elasticsearch/index/search/child/ConstantScorer.java
src/main/java/org/elasticsearch/index/search/child/CustomQueryWrappingFilter.java
src/main/java/org/elasticsearch/index/search/child/ParentConstantScoreQuery.java
src/main/java/org/elasticsearch/index/search/child/ParentIdsFilter.java
src/main/java/org/elasticsearch/index/search/child/ParentQuery.java
src/main/java/org/elasticsearch/index/search/child/TopChildrenQuery.java
src/main/java/org/elasticsearch/index/search/geo/GeoDistanceFilter.java
src/main/java/org/elasticsearch/index/search/geo/GeoDistanceRangeFilter.java
src/main/java/org/elasticsearch/index/search/geo/GeoPolygonFilter.java
src/main/java/org/elasticsearch/index/search/geo/InMemoryGeoBoundingBoxFilter.java
src/main/java/org/elasticsearch/index/search/nested/IncludeNestedDocsQuery.java
src/main/java/org/elasticsearch/index/search/nested/NonNestedDocsFilter.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregatorFactory.java
src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHits.java
src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregator.java
src/main/java/org/elasticsearch/search/controller/SearchPhaseController.java
src/main/java/org/elasticsearch/search/dfs/CachedDfSource.java
src/main/java/org/elasticsearch/search/fetch/innerhits/InnerHitsContext.java
src/main/java/org/elasticsearch/search/internal/ContextIndexSearcher.java
src/main/java/org/elasticsearch/search/lookup/IndexFieldTerm.java
src/main/java/org/elasticsearch/search/lookup/PositionIterator.java
src/main/java/org/elasticsearch/search/scan/ScanContext.java
src/main/java/org/elasticsearch/search/suggest/completion/AnalyzingCompletionLookupProvider.java
src/test/java/org/elasticsearch/action/termvectors/AbstractTermVectorsTests.java
src/test/java/org/elasticsearch/action/termvectors/GetTermVectorsCheckDocFreqTests.java
src/test/java/org/elasticsearch/action/termvectors/GetTermVectorsTests.java
src/test/java/org/elasticsearch/common/lucene/search/TermsFilterTests.java
src/test/java/org/elasticsearch/common/lucene/search/XBooleanFilterLuceneTests.java
src/test/java/org/elasticsearch/common/lucene/search/XBooleanFilterTests.java
src/test/java/org/elasticsearch/deps/lucene/SimpleLuceneTests.java
src/test/java/org/elasticsearch/index/fielddata/plain/ParentChildFilteredTermsEnumTests.java
src/test/java/org/elasticsearch/index/query/SimpleIndexQueryParserTests.java
src/test/java/org/elasticsearch/index/search/child/ChildrenConstantScoreQueryTests.java
src/test/java/org/elasticsearch/index/search/child/ChildrenQueryTests.java
src/test/java/org/elasticsearch/index/search/child/MockScorer.java
src/test/java/org/elasticsearch/index/search/child/ParentConstantScoreQueryTests.java
src/test/java/org/elasticsearch/index/search/child/ParentQueryTests.java
src/test/java/org/elasticsearch/script/IndexLookupTests.java
src/test/java/org/elasticsearch/search/suggest/completion/AnalyzingCompletionLookupProviderV1.java
src/test/java/org/elasticsearch/search/suggest/completion/CompletionPostingsFormatTest.java
src/test/java/org/elasticsearch/test/engine/ThrowingLeafReaderWrapper.java
comments:
Upgrade to lucene r1660560

Squashed commit of the following:

commit 07391388715ed1f737e8acc391cea0bce5d79db9
Merge: a71cc45 b61b021
Author: Robert Muir <rmuir@apache.org>
Date:   Fri Feb 20 06:58:11 2015 -0500

    Git really sucks

    Merge branch 'lucene_r1660560' of github.com:elasticsearch/elasticsearch into lucene_r1660560

commit b61b02163f62ad8ddd9906cedb3d57fed75eb52d
Author: Adrien Grand <jpountz@gmail.com>
Date:   Wed Feb 18 19:03:49 2015 +0100

    Try to improve TopDocs.merge usage.

commit bf8e4ac46d7fdaf9ae128606d96328a59784f126
Author: Ryan Ernst <ryan@iernst.net>
Date:   Wed Feb 18 07:43:37 2015 -0800

    reenable scripting test for accessing postings pieces.  commented out
    parts that fail because of bad assumptions

commit 6d4d635b1a23b33c437a6bae70beea70ad52d91c
Author: Robert Muir <rmuir@apache.org>
Date:   Wed Feb 18 09:41:46 2015 -0500

    add some protection against broken asserts, but, also disable crappy test

commit c735bbb11f38782dfea9c4200fcf732564126bf5
Author: Robert Muir <rmuir@apache.org>
Date:   Wed Feb 18 02:21:30 2015 -0500

    cutover remaining stuff from old postings api

commit 11c9c2bea3db3ff1cd2807bd43e77b500b167aed
Author: Robert Muir <rmuir@apache.org>
Date:   Wed Feb 18 01:46:04 2015 -0500

    cut over most DocsEnum usage

commit bc18017662f6abddf3f074078f74e582494c88e2
Author: Robert Muir <rmuir@apache.org>
Date:   Wed Feb 18 01:19:35 2015 -0500

    upgrade to lucene_r1660560, modulo one test fail

time:
2015-02-20T11:50:40Z
class:
src/main/java/org/elasticsearch/cluster/action/index/NodeIndexDeletedAction.java
src/main/java/org/elasticsearch/index/IndexService.java
src/main/java/org/elasticsearch/indices/IndicesService.java
src/test/java/org/elasticsearch/indices/IndicesServiceTest.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
comments:
[INDICES] Retry if shard deletes fail due to IOExceptions

Today if a shard deletion fails we simply ignore it and move on. On system like
windows where a virus scanner can hold on to files or any other process ie. the admins
explorer window we fail to delete shards leaving large amout of data behind. We should try
best effort to clean those shards up before we ack the delete.

time:
2015-02-20T08:33:40Z
class:
src/main/java/org/elasticsearch/common/lucene/Lucene.java
src/main/java/org/elasticsearch/index/snapshots/blobstore/BlobStoreIndexShardRepository.java
src/main/java/org/elasticsearch/index/store/Store.java
src/test/java/org/elasticsearch/common/lucene/LuceneTest.java
src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreTests.java
comments:
[RESTORE] Refactor how restore cleans up files after snapshot was restored

Today we restore files by running through the directory removeing all files
not in the snapshot. Some files in that direcotry might belong there even though
we remove them. This commit moves the responsiblity of cleaning up pending files
to lucene by utilizing IndexWriter#IndexFileDeleter

time:
2015-02-19T22:05:10Z
class:
src/test/java/org/elasticsearch/common/io/FileSystemUtilsTests.java
src/test/java/org/elasticsearch/test/ElasticsearchTestCase.java
comments:
Test: Remove use of globalTempDir() and forbid it from future use.

Using this temp dir circumvents test isolation and isn't necessary.

closes #9777

time:
2015-02-19T20:34:03Z
class:
comments:
[doc] secret_key: <access key> should be <secret key>

Closes #168.

time:
2015-02-19T20:34:03Z
class:
src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java
src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefFieldComparatorSource.java
src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/DoubleValuesComparatorSource.java
src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/FloatValuesComparatorSource.java
src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/LongValuesComparatorSource.java
src/main/java/org/elasticsearch/search/MultiValueMode.java
src/main/java/org/elasticsearch/search/sort/GeoDistanceSortParser.java
src/main/java/org/elasticsearch/search/sort/ScriptSortParser.java
src/main/java/org/elasticsearch/search/sort/SortParseElement.java
src/test/java/org/elasticsearch/search/MultiValueModeTests.java
comments:
Don't use the fixed bitset filter cache for child nested level filters, but the regular filter cache instead.

Random access based bitsets are not required for the child level nested level filters.

Closes #8810

time:
2015-02-19T20:26:45Z
class:
src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
comments:
Simplify region setting code

time:
2015-02-19T20:26:38Z
class:
src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
comments:
Fix region settings for s3 snapshot repository in eu-west-1

Closes #169.

time:
2015-02-19T20:18:38Z
class:
src/main/java/org/elasticsearch/search/fetch/FetchPhase.java
src/test/java/org/elasticsearch/search/innerhits/InnerHitsTests.java
comments:
inner hits: Don't fail if an object is specified as a nested value instead of an array.

Closes #9723

time:
2015-02-19T20:10:17Z
class:
src/main/java/org/elasticsearch/monitor/jvm/HotThreads.java
src/test/java/org/elasticsearch/action/admin/HotThreadsTest.java
comments:
Core: include timestamp and params in hot threads

Include the timestamp and params (interval, busiestThreads,
ignoreIdleThreads), when hot threads were collected.

Closes #9773

time:
2015-02-19T18:27:04Z
class:
src/test/java/org/elasticsearch/plugins/PluginManagerTests.java
comments:
tests: minimize tests.policy a bit.

Closes #9765

time:
2015-02-19T18:05:59Z
class:
src/main/java/org/elasticsearch/index/mapper/attachment/AttachmentMapper.java
src/test/java/org/elasticsearch/index/mapper/xcontent/MapperTestUtils.java
comments:
Remove DocValuesFormatService and PostingsFormatService

Related to elasticsearch/elasticsearch#9741

Closes #103.

time:
2015-02-19T17:35:39Z
class:
comments:
Testing: Remove plus sign from YAML test due to encoding issue

The plus sign is not treated correctly in encoding and can lead
to problems, if the search request is encoded as HTTP parameter
instead of the HTTP body.

Relates #9769

time:
2015-02-19T16:37:37Z
class:
src/main/java/org/elasticsearch/common/lucene/Lucene.java
src/main/java/org/elasticsearch/index/gateway/IndexShardGateway.java
comments:
[RECOVERY] Only iterate the files that we recovered from the commit

Today we use Directory#listAll() to find all the files we recovered. Yet,
this is not accurate since there might be leftovers etc. It's better to
only iterate over the known files from the segments info that we recovered.

time:
2015-02-19T15:50:48Z
class:
src/main/java/org/elasticsearch/cloud/aws/AwsEc2Service.java
src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
comments:
Wrong endpoint for  `cn-north-1`

Commit ea9609c642c84309b6df08bc6103cf227719c2ab does not work as expected.

China is not part of the [S3 regions](http://docs.aws.amazon.com/general/latest/gr/rande.html#s3_region) but part of [Isolated Regions](http://docs.aws.amazon.com/general/latest/gr/isolated_regions.html).

The patch uses for S3 `s3-cn-north-1.amazonaws.com` which is wrong because in that case the end point is `s3.cn-north-1.amazonaws.com.cn`.
Same goes for EC2 which was `ec2.cn-north-1.amazonaws.com` but should be `ec2.cn-north-1.amazonaws.com.cn`.

Related documentation:

* http://docs.aws.amazon.com/general/latest/gr/rande.html#s3_region
* http://docs.aws.amazon.com/general/latest/gr/rande.html#ec2_region
* http://docs.aws.amazon.com/general/latest/gr/isolated_regions.html

Closing #156
(cherry picked from commit 491a59b)
(cherry picked from commit f12cacc)

time:
2015-02-19T15:15:14Z
class:
src/main/java/org/elasticsearch/cloud/aws/blobstore/S3BlobStore.java
comments:
Remove an excess quote character in an exception message

time:
2015-02-19T14:47:25Z
class:
src/main/java/org/elasticsearch/index/codec/CodecModule.java
src/main/java/org/elasticsearch/index/codec/CodecService.java
src/main/java/org/elasticsearch/index/codec/PerFieldMappingPostingFormatCodec.java
src/main/java/org/elasticsearch/index/codec/docvaluesformat/AbstractDocValuesFormatProvider.java
src/main/java/org/elasticsearch/index/codec/docvaluesformat/DefaultDocValuesFormatProvider.java
src/main/java/org/elasticsearch/index/codec/docvaluesformat/DocValuesFormatProvider.java
src/main/java/org/elasticsearch/index/codec/docvaluesformat/DocValuesFormatService.java
src/main/java/org/elasticsearch/index/codec/docvaluesformat/DocValuesFormats.java
src/main/java/org/elasticsearch/index/codec/docvaluesformat/PreBuiltDocValuesFormatProvider.java
src/main/java/org/elasticsearch/index/codec/postingsformat/AbstractPostingsFormatProvider.java
src/main/java/org/elasticsearch/index/codec/postingsformat/BloomFilterPostingsFormatProvider.java
src/main/java/org/elasticsearch/index/codec/postingsformat/DefaultPostingsFormatProvider.java
src/main/java/org/elasticsearch/index/codec/postingsformat/PostingFormats.java
src/main/java/org/elasticsearch/index/codec/postingsformat/PostingsFormatProvider.java
src/main/java/org/elasticsearch/index/codec/postingsformat/PostingsFormatService.java
src/main/java/org/elasticsearch/index/codec/postingsformat/PreBuiltPostingsFormatProvider.java
src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java
src/main/java/org/elasticsearch/index/mapper/FieldMapper.java
src/main/java/org/elasticsearch/index/mapper/Mapper.java
src/main/java/org/elasticsearch/index/mapper/MapperService.java
src/main/java/org/elasticsearch/index/mapper/core/AbstractFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/core/BinaryFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/core/BooleanFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/core/ByteFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/core/CompletionFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/core/DateFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/core/DoubleFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/core/FloatFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/core/IntegerFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/core/LongFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/core/Murmur3FieldMapper.java
src/main/java/org/elasticsearch/index/mapper/core/NumberFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/core/ShortFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/core/StringFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/core/TokenCountFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/core/TypeParsers.java
src/main/java/org/elasticsearch/index/mapper/geo/GeoPointFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/geo/GeoShapeFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/AllFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/BoostFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/FieldNamesFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/IdFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/IndexFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/ParentFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/RoutingFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/SizeFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/SourceFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/TTLFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/TimestampFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/TypeFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/UidFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/VersionFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/ip/IpFieldMapper.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/main/java/org/elasticsearch/indices/IndicesService.java
src/main/java/org/elasticsearch/search/suggest/completion/CompletionPostingsFormatProvider.java
src/test/java/org/elasticsearch/codecs/CodecTests.java
src/test/java/org/elasticsearch/index/codec/CodecTests.java
src/test/java/org/elasticsearch/index/mapper/externalvalues/ExternalMapper.java
src/test/java/org/elasticsearch/index/mapper/merge/TestMergeMapperTests.java
src/test/java/org/elasticsearch/index/mapper/timestamp/TimestampMappingTests.java
src/test/java/org/elasticsearch/index/query/TemplateQueryParserTest.java
src/test/java/org/elasticsearch/index/query/plugin/IndexQueryParserPlugin2Tests.java
src/test/java/org/elasticsearch/index/query/plugin/IndexQueryParserPluginTests.java
src/test/java/org/elasticsearch/search/suggest/completion/CompletionPostingsFormatTest.java
comments:
Codecs: Remove the ability to have custom per-field postings and doc values formats.

This commit makes the `postings_format` and `doc_values_format` options of
mappings illegal on 2.0 and ignored on 1.x (meaning that the default postings
and doc values formats from the codec will be used in such a case).

This removes a fair amount of code.

Close #8746 #9741

time:
2015-02-19T14:26:15Z
class:
src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityTests.java
comments:
add static bwc indexes for 1.3.9 and 1.4.4

time:
2015-02-19T13:56:23Z
class:
src/main/java/org/elasticsearch/Version.java
comments:
Versioning: Adding 1.3.9 and 1.4.5 versions

time:
2015-02-19T13:53:01Z
class:
src/test/java/org/elasticsearch/index/store/CorruptedTranslogTests.java
comments:
[TEST] Never flush in the test where we rely on recovering from translog

time:
2015-02-19T12:52:48Z
class:
src/main/java/org/elasticsearch/indices/IndicesService.java
comments:
Use index name rather than Index.java to lookup IndexService

time:
2015-02-19T09:58:15Z
class:
comments:
Build: Check that all packages contain the same jar files

This should ensure, that RPM and DEB packages do not lack dependencies,
that have been included in the tar.gz and zip files

time:
2015-02-19T08:34:02Z
class:
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
comments:
[TEST] Relax path clearing assertion on Windows

time:
2015-02-19T08:15:28Z
class:
comments:
Testing: Added REST tests to check if expression scripting works

time:
2015-02-18T22:34:06Z
class:
src/main/java/org/elasticsearch/action/get/TransportGetAction.java
src/main/java/org/elasticsearch/action/support/replication/TransportShardReplicationOperationAction.java
src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
src/main/java/org/elasticsearch/env/NodeEnvironment.java
src/main/java/org/elasticsearch/gateway/GatewayMetaState.java
src/main/java/org/elasticsearch/index/IndexService.java
src/main/java/org/elasticsearch/index/deletionpolicy/SnapshotIndexCommit.java
src/main/java/org/elasticsearch/index/engine/EngineFactory.java
src/main/java/org/elasticsearch/index/engine/InternalEngineFactory.java
src/main/java/org/elasticsearch/index/engine/ShadowEngine.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/main/java/org/elasticsearch/index/shard/IndexShardModule.java
src/main/java/org/elasticsearch/index/shard/ShadowIndexShard.java
src/main/java/org/elasticsearch/index/store/DirectoryUtils.java
src/main/java/org/elasticsearch/indices/IndicesService.java
src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
src/main/java/org/elasticsearch/indices/recovery/RecoverySource.java
src/main/java/org/elasticsearch/indices/recovery/ShardRecoveryHandler.java
src/main/java/org/elasticsearch/indices/recovery/SharedFSRecoveryHandler.java
src/test/java/org/elasticsearch/index/IndexWithShadowReplicasTests.java
src/test/java/org/elasticsearch/index/engine/ShadowEngineTests.java
src/test/java/org/elasticsearch/index/shard/IndexShardModuleTests.java
src/test/java/org/elasticsearch/index/store/DirectoryUtilsTest.java
src/test/java/org/elasticsearch/indices/IndicesCustomDataPathTests.java
src/test/java/org/elasticsearch/test/ElasticsearchIntegrationTest.java
src/test/java/org/elasticsearch/test/engine/AssertingSearcher.java
src/test/java/org/elasticsearch/test/engine/MockEngineFactory.java
src/test/java/org/elasticsearch/test/engine/MockInternalEngine.java
src/test/java/org/elasticsearch/test/engine/MockShadowEngine.java
src/test/java/org/elasticsearch/test/hamcrest/ElasticsearchAssertions.java
src/test/java/org/elasticsearch/test/store/MockFSDirectoryService.java
comments:
Add shadow replicas for shared filesystems

Squashed commit of the following:

commit 20835037c98e7d2fac4206c372717a05a27c4790
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 18 15:27:17 2015 -0700

    Use Enum for "_primary" preference

commit 325acbe4585179190a959ba3101ee63b99f1931a
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 18 14:32:41 2015 -0700

    Use ?preference=_primary automatically for realtime GET operations

commit edd49434af5de7e55928f27a1c9ed0fddb1fb133
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 18 14:32:06 2015 -0700

    Move engine creation into protected createNewEngine method

commit 67a797a9235d4aa376ff4af16f3944d907df4577
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 18 13:14:01 2015 -0700

    Factor out AssertingSearcher so it can be used by mock Engines

commit 62b0c28df8c23cc0b8205b33f7595c68ff940e2b
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 18 11:43:17 2015 -0700

    Use IndexMetaData.isIndexUsingShadowReplicas helper

commit 1a0d45629457578a60ae5bccbeba05acf5d79ddd
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 18 09:59:31 2015 -0700

    Rename usesSharedFilesystem -> isOnSharedFilesystem

commit 73c62df4fc7da8a5ed557620a83910d89b313aa1
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 18 09:58:02 2015 -0700

    Add MockShadowEngine and hook it up to be used

commit c8e8db473830fce1bdca3c4df80a685e782383bc
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 18 09:45:50 2015 -0700

    Clarify comment about pre-defined mappings

commit 60a4d5374af5262bd415f4ef40f635278ed12a03
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 18 09:18:22 2015 -0700

    Add a test for shadow replicas that uses field data

commit 7346f9f382f83a21cd2445b3386fe67472bc3184
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 18 08:37:14 2015 -0700

    Revert changes to RecoveryTarget.java

commit d90d6980c9b737bd8c0f4339613a5373b1645e95
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 18 08:35:44 2015 -0700

    Rename `ownsShard` to `canDeleteShardContent`

commit 23001af834d66278ac84d9a72c37b5d1f3a10a7b
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 18 08:35:25 2015 -0700

    Remove ShadowEngineFactory, add .newReadOnlyEngine method in EngineFactory

commit b64fef1d2c5e167713e869b22d388ff479252173
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 18 08:25:19 2015 -0700

    Add warning that predefined mappings should be used

commit a1b8b8cf0db49d1bd1aeb84e51491f7f0de43b59
Author: Lee Hinman <lee@writequit.org>
Date:   Tue Feb 17 14:31:50 2015 -0700

    Remove unused import and fix index creation example in docs

commit 0b1b852365ceafc0df86866ac3a4ffb6988b08e4
Merge: b9d1fed a22bd49
Author: Lee Hinman <lee@writequit.org>
Date:   Tue Feb 17 10:56:02 2015 -0700

    Merge remote-tracking branch 'refs/remotes/origin/master' into shadow-replicas

commit b9d1fed25ae472a9dce1904eb806702fba4d9786
Merge: 4473e63 41fd4d8
Author: Lee Hinman <lee@writequit.org>
Date:   Tue Feb 17 09:02:27 2015 -0700

    Merge remote-tracking branch 'refs/remotes/origin/master' into shadow-replicas

commit 4473e630460e2f0ca2a2e2478f3712f39a64c919
Author: Lee Hinman <lee@writequit.org>
Date:   Tue Feb 17 09:00:39 2015 -0700

    Add asciidoc documentation for shadow replicas

commit eb699c19f04965952ae45e2caf107124837c4654
Author: Simon Willnauer <simonw@apache.org>
Date:   Tue Feb 17 16:15:39 2015 +0100

    remove last nocommit

commit c5ece6d16d423fbdd36f5d789bd8daa5724d77b0
Author: Simon Willnauer <simonw@apache.org>
Date:   Tue Feb 17 16:13:12 2015 +0100

    simplify shadow engine

commit 45cd34a12a442080477da3ef14ab2fe7947ea97e
Author: Simon Willnauer <simonw@apache.org>
Date:   Tue Feb 17 11:32:57 2015 +0100

    fix tests

commit 744f228c192602a6737051571e040731d413ba8b
Author: Simon Willnauer <simonw@apache.org>
Date:   Tue Feb 17 11:28:12 2015 +0100

    revert changes to IndexShardGateway - these are leftovers from previous iterations

commit 11886b7653dabc23655ec76d112f291301f98f4a
Author: Simon Willnauer <simonw@apache.org>
Date:   Tue Feb 17 11:26:48 2015 +0100

    Back out non-shared FS code. this will go in in a second iteration

commit 77fba571f150a0ca7fb340603669522c3ed65363
Merge: e8ad614 2e3c6a9
Author: Simon Willnauer <simonw@apache.org>
Date:   Tue Feb 17 11:16:46 2015 +0100

    Merge branch 'master' into shadow-replicas

    Conflicts:
    	src/main/java/org/elasticsearch/index/engine/Engine.java

commit e8ad61467304e6d175257e389b8406d2a6cf8dba
Merge: 48a700d 1b8d8da
Author: Simon Willnauer <simonw@apache.org>
Date:   Tue Feb 17 10:54:20 2015 +0100

    Merge branch 'master' into shadow-replicas

commit 48a700d23cff117b8e4851d4008364f92b8272a0
Author: Simon Willnauer <simonw@apache.org>
Date:   Tue Feb 17 10:50:59 2015 +0100

    add test for failing shadow engine / remove nocommit

commit d77414c5e7b2cde830a8e3f70fe463ccc904d4d0
Author: Simon Willnauer <simonw@apache.org>
Date:   Tue Feb 17 10:27:56 2015 +0100

    remove nocommits in IndexMetaData

commit abb696563a9e418d3f842a790fcb832f91150be2
Author: Simon Willnauer <simonw@apache.org>
Date:   Mon Feb 16 17:05:02 2015 +0100

    remove nocommit and simplify delete logic

commit 82b9f0449108cd4741568d9b4495bf6c10a5b019
Author: Simon Willnauer <simonw@apache.org>
Date:   Mon Feb 16 16:45:27 2015 +0100

    reduce the changes compared to master

commit 28f069b6d99a65e285ac8c821e6a332a1d8eb315
Author: Simon Willnauer <simonw@apache.org>
Date:   Mon Feb 16 16:43:46 2015 +0100

    fix primary relocation

commit c4c999dd61a44a7a0db9798275a622f2b85b1039
Merge: 2ae80f9 455a85d
Author: Simon Willnauer <simonw@apache.org>
Date:   Mon Feb 16 15:04:26 2015 +0100

    Merge branch 'master' into shadow-replicas

commit 2ae80f9689346f8fd346a0d3775a6341874d8bef
Author: Lee Hinman <lee@writequit.org>
Date:   Fri Feb 13 16:25:34 2015 -0700

    throw UnsupportedOperationException on write operations in ShadowEngine

commit 740c28dd9ef987bf56b670fa1a8bcc6de2845819
Merge: e5bc047 305ba33
Author: Lee Hinman <lee@writequit.org>
Date:   Fri Feb 13 15:38:39 2015 -0700

    Merge branch 'master' into shadow-replicas

commit e5bc047d7c872ae960d397b1ae7b4b78d6a1ea10
Author: Lee Hinman <lee@writequit.org>
Date:   Fri Feb 13 11:38:09 2015 -0700

    Don't replicate document request when using shadow replicas

commit 213292e0679d8ae1492ea11861178236f4abd8ea
Author: Simon Willnauer <simonw@apache.org>
Date:   Fri Feb 13 13:58:05 2015 +0100

    add one more nocommit

commit 83d171cf632f9b77cca9de58505f7db8fcda5599
Merge: aea9692 09eb8d1
Author: Simon Willnauer <simonw@apache.org>
Date:   Fri Feb 13 13:52:29 2015 +0100

    Merge branch 'master' into shadow-replicas

commit aea96920d995dacef294e48e719ba18f1ecf5860
Author: Simon Willnauer <simonw@apache.org>
Date:   Fri Feb 13 09:56:41 2015 +0100

    revert unneeded changes on Store

commit ea4e3e58dc6959a92c06d5990276268d586735f3
Author: Lee Hinman <lee@writequit.org>
Date:   Thu Feb 12 14:26:30 2015 -0700

    Add documentation to ShadowIndexShard, remove nocommit

commit 4f71c8d9f706a0c1c39aa3a370efb1604559d928
Author: Lee Hinman <lee@writequit.org>
Date:   Thu Feb 12 14:17:22 2015 -0700

    Add documentation to ShadowEngine

commit 28a9d1842722acba7ea69e0fa65200444532a30c
Author: Lee Hinman <lee@writequit.org>
Date:   Thu Feb 12 14:08:25 2015 -0700

    Remove nocommit, document canDeleteIndexContents

commit d8d59dbf6d0525cd823d97268d035820e5727ac9
Author: Lee Hinman <lee@writequit.org>
Date:   Thu Feb 12 10:34:32 2015 -0700

    Refactor more shared methods into the abstract Engine

commit a7eb53c1e8b8fbfd9281b43ae39eacbe3cd1a0a6
Author: Simon Willnauer <simonw@apache.org>
Date:   Thu Feb 12 17:38:59 2015 +0100

    Simplify shared filesystem recovery by using a dedicated recovery handler that skip
    most phases and enforces shard closing on the soruce before the target opens it's engine

commit a62b9a70adad87d7492c526f4daf868cb05018d9
Author: Simon Willnauer <simonw@apache.org>
Date:   Thu Feb 12 15:59:54 2015 +0100

    fix compile error after upstream changes

commit abda7807bc3328a89fd783ca7ad8c6deac35f16f
Merge: f229719 35f6496
Author: Simon Willnauer <simonw@apache.org>
Date:   Thu Feb 12 15:57:28 2015 +0100

    Merge branch 'master' into shadow-replicas

    Conflicts:
    	src/main/java/org/elasticsearch/index/engine/Engine.java

commit f2297199b7dd5d3f9f1f109d0ddf3dd83390b0d1
Author: Simon Willnauer <simonw@apache.org>
Date:   Thu Feb 12 12:41:32 2015 +0100

    first cut at catchup from primary
    make flush to a refresh
    factor our ShadowIndexShard to have IndexShard be idential to the master and least intrusive

    cleanup abstractions

commit 4a367c07505b84b452807a58890f1cbe21711f27
Author: Simon Willnauer <simonw@apache.org>
Date:   Thu Feb 12 09:50:36 2015 +0100

    fix primary promotion

commit cf2fb807e7e243f1ad603a79bc9d5f31a499b769
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 11 16:45:41 2015 -0700

    Make assertPathHasBeenCleared recursive

commit 5689b7d2f84ca1c41e4459030af56cb9c0151eff
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 11 15:58:19 2015 -0700

    Add testShadowReplicaNaturalRelocation

commit fdbe4133537eaeb768747c2200cfc91878afeb97
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 11 15:28:57 2015 -0700

    Use check for shared filesystem in primary -> primary relocation

    Also adds a nocommit

commit 06e2eb4496762130af87ce68a47d360962091697
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 11 15:21:32 2015 -0700

    Add a test checking that indices with shadow replicas clean up after themselves

commit e4dbfb09a689b449f0edf6ee24222d7eaba2a215
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 11 15:08:18 2015 -0700

    Fix segment info for ShadowEngine, remove test nocommit

commit 80cf0e884c66eda7d59ac5d59235e1ce215af8f5
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 11 14:30:13 2015 -0700

    Remove nocommit in ShadowEngineTests#testFailStart()

commit 5e33eeaca971807b342f9be51a6a566eee005251
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 11 14:22:59 2015 -0700

    Remove overly-complex test

commit 2378fbb917b467e79c0262d7a41c23321bbeb147
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 11 13:45:44 2015 -0700

    Fix missing import

commit 52e9cd1b8334a5dd228d5d68bd03fd0040e9c8e9
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 11 13:45:05 2015 -0700

    Add a test for replica -> primary promotion

commit a95adbeded426d7f69f6ddc4cbd6712b6f6380b4
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 11 12:54:14 2015 -0700

    Remove tests that don't apply to ShadowEngine

commit 1896feda9de69e4f9cf774ef6748a5c50e953946
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 11 10:29:12 2015 -0700

    Add testShadowEngineIgnoresWriteOperations and testSearchResultRelease

commit 67d7df41eac5e10a1dd63ddb31de74e326e9d38b
Author: Lee Hinman <lee@writequit.org>
Date:   Wed Feb 11 10:06:05 2015 -0700

    Add start of ShadowEngine unit tests

commit ca9beb2d93d9b5af9aa6c75dbc0ead4ef57e220d
Merge: 2d42736 57a4646
Author: Simon Willnauer <simonw@apache.org>
Date:   Wed Feb 11 18:03:53 2015 +0100

    Merge branch 'master' into shadow-replicas

commit 2d42736fed3ed8afda7e4aff10b65d292e1c6f92
Author: Simon Willnauer <simonw@apache.org>
Date:   Wed Feb 11 17:51:22 2015 +0100

    shortcut recovery if we are on a shared FS - no need to compare files etc.

commit 24d36c92dd82adce650e7ac8e9f0b43c83b2dc53
Author: Simon Willnauer <simonw@apache.org>
Date:   Wed Feb 11 17:08:08 2015 +0100

    utilize the new delete code

commit 2a2eed10f58825aae29ffe4cf01aefa5743a97c7
Merge: 343dc0b 173cfc1
Author: Simon Willnauer <simonw@apache.org>
Date:   Wed Feb 11 16:07:41 2015 +0100

    Merge branch 'master' into shadow-replicas

    Conflicts:
    	src/main/java/org/elasticsearch/gateway/GatewayMetaState.java

commit 343dc0b527a7052acdc783ac5abcaad1ef78dbda
Author: Simon Willnauer <simonw@apache.org>
Date:   Wed Feb 11 16:05:28 2015 +0100

    long adder is not available in java7

commit be02cabfeebaea74b51b212957a2a466cfbfb716
Author: Lee Hinman <lee@writequit.org>
Date:   Tue Feb 10 22:04:24 2015 -0700

    Add test that restarts nodes to ensure shadow replicas recover

commit 7fcb373f0617050ca1a5a577b8cf32e32dc612b0
Author: Simon Willnauer <simonw@apache.org>
Date:   Tue Feb 10 23:19:21 2015 +0100

    make test more evil

commit 38135af0c1991b88f168ece0efb72ffe9498ff59
Author: Simon Willnauer <simonw@apache.org>
Date:   Tue Feb 10 22:25:11 2015 +0100

    make tests pass

commit 05975af69e6db63cb95f3e40d25bfa7174e006ea
Author: Lee Hinman <lee@writequit.org>
Date:   Mon Jan 12 18:44:29 2015 +0100

    Add ShadowEngine

time:
2015-02-18T19:36:25Z
class:
src/test/java/org/elasticsearch/plugin/mapper/attachments/test/SimpleAttachmentIntegrationTests.java
comments:
[Test] Use now full qualified names for fields

We were asking for short name fields but elasticsearch does not allow anymore using short names but full qualified names.

```java
SearchResponse response = client().prepareSearch("test")
        .addField("content_type")
        .addField("name")
        .execute().get();
```

We need to use now:

```java
SearchResponse response = client().prepareSearch("test")
        .addField("file.content_type")
        .addField("file.name")
        .execute().get();
```

Closes #102.

time:
2015-02-18T15:14:21Z
class:
src/main/java/org/elasticsearch/cloud/azure/AzureStorageServiceImpl.java
comments:
Fix log parameters

time:
2015-02-18T15:06:28Z
class:
src/test/java/org/elasticsearch/percolator/RecoveryPercolatorTests.java
comments:
[TEST] Add percolate type to the mapping

time:
2015-02-18T14:50:58Z
class:
src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java
comments:
Fixed address resolution

time:
2015-02-18T14:49:38Z
class:
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramParser.java
src/main/java/org/elasticsearch/search/aggregations/support/format/ValueFormatter.java
src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramTests.java
comments:
Aggregations: Format bucket key_as_string in `date_histogram` according to `time_zone`

Change bucket key_as_string to reflect `time_zone` parameter. Currently `time_zone`
shifts bucket boundaries to other time zone, but keys are displayed in UTC, so e.g.
daily buckets in "+01:00" time zone have key_as_string like "2014-01-01T23:00:00Z". With this
change the default is to format this dates according to the local time zone, so the
above bucket key would be "2014-01-02T00:00:00+01:00".

Closes #9710
Closes #9744

time:
2015-02-18T13:40:22Z
class:
src/test/java/org/elasticsearch/test/engine/MockInternalEngine.java
comments:
[TEST] prevent stackoverflow in mockInternalEngine

time:
2015-02-18T13:22:22Z
class:
src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java
src/main/java/org/elasticsearch/action/termvectors/TermVectorsResponse.java
src/main/java/org/elasticsearch/action/termvectors/TransportMultiTermVectorsAction.java
src/main/java/org/elasticsearch/action/termvectors/TransportShardMultiTermsVectorAction.java
src/main/java/org/elasticsearch/action/termvectors/TransportTermVectorsAction.java
src/main/java/org/elasticsearch/common/lucene/search/FilteredCollector.java
src/main/java/org/elasticsearch/common/lucene/search/XCollector.java
src/main/java/org/elasticsearch/common/lucene/store/FilterIndexOutput.java
src/main/java/org/elasticsearch/common/rounding/Rounding.java
src/main/java/org/elasticsearch/common/rounding/TimeZoneRounding.java
src/main/java/org/elasticsearch/common/util/SingleObjectCache.java
src/main/java/org/elasticsearch/index/IndexService.java
src/main/java/org/elasticsearch/index/cache/bitset/BitsetFilterCache.java
src/main/java/org/elasticsearch/index/engine/Engine.java
src/main/java/org/elasticsearch/index/engine/EngineConfig.java
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
src/main/java/org/elasticsearch/index/gateway/IndexShardGateway.java
src/main/java/org/elasticsearch/index/query/NestedFilterParser.java
src/main/java/org/elasticsearch/index/query/NestedQueryParser.java
src/main/java/org/elasticsearch/index/query/QueryParseContext.java
src/main/java/org/elasticsearch/index/query/RangeQueryBuilder.java
src/main/java/org/elasticsearch/index/query/support/NestedInnerQueryParseSupport.java
src/main/java/org/elasticsearch/index/query/support/NestedScope.java
src/main/java/org/elasticsearch/index/settings/IndexDynamicSettingsModule.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/main/java/org/elasticsearch/index/store/Store.java
src/main/java/org/elasticsearch/index/store/VerifyingIndexOutput.java
src/main/java/org/elasticsearch/monitor/fs/FsService.java
src/main/java/org/elasticsearch/monitor/network/NetworkService.java
src/main/java/org/elasticsearch/monitor/os/OsService.java
src/main/java/org/elasticsearch/monitor/process/ProcessService.java
src/main/java/org/elasticsearch/percolator/PercolateContext.java
src/main/java/org/elasticsearch/percolator/PercolatorService.java
src/main/java/org/elasticsearch/percolator/QueryCollector.java
src/main/java/org/elasticsearch/search/aggregations/AggregationPhase.java
src/main/java/org/elasticsearch/search/aggregations/BucketCollector.java
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramBuilder.java
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramParser.java
src/main/java/org/elasticsearch/search/fetch/innerhits/InnerHitsParseElement.java
src/main/java/org/elasticsearch/search/internal/ContextIndexSearcher.java
src/main/java/org/elasticsearch/search/internal/DefaultSearchContext.java
src/main/java/org/elasticsearch/search/internal/FilteredSearchContext.java
src/main/java/org/elasticsearch/search/internal/SearchContext.java
src/main/java/org/elasticsearch/search/internal/SubSearchContext.java
src/main/java/org/elasticsearch/search/sort/GeoDistanceSortParser.java
src/main/java/org/elasticsearch/search/sort/ScriptSortParser.java
src/main/java/org/elasticsearch/search/sort/SortParseElement.java
src/test/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsTests.java
src/test/java/org/elasticsearch/action/termvectors/GetTermVectorsCheckDocFreqTests.java
src/test/java/org/elasticsearch/cluster/ClusterInfoServiceTests.java
src/test/java/org/elasticsearch/common/rounding/TimeZoneRoundingTests.java
src/test/java/org/elasticsearch/common/util/SingleObjectCacheTests.java
src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
src/test/java/org/elasticsearch/index/store/CorruptedTranslogTests.java
src/test/java/org/elasticsearch/index/store/StoreTest.java
src/test/java/org/elasticsearch/indices/cache/query/IndicesQueryCacheTests.java
src/test/java/org/elasticsearch/indices/recovery/IndexRecoveryTests.java
src/test/java/org/elasticsearch/indices/settings/UpdateSettingsTests.java
src/test/java/org/elasticsearch/indices/state/OpenCloseIndexTests.java
src/test/java/org/elasticsearch/nested/SimpleNestedTests.java
src/test/java/org/elasticsearch/percolator/RecoveryPercolatorTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramOffsetTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramTests.java
src/test/java/org/elasticsearch/test/TestSearchContext.java
src/test/java/org/elasticsearch/test/engine/MockInternalEngine.java
src/test/java/org/elasticsearch/test/store/MockFSDirectoryService.java
src/test/java/org/elasticsearch/transport/netty/NettyTransportMultiPortTests.java
comments:
Merge branch 'master' into feature/aggs_2_0

time:
2015-02-18T13:02:23Z
class:
src/test/java/org/elasticsearch/indices/settings/UpdateSettingsTests.java
comments:
[TEST] don't cache store stats in tests that ensure stats are correct

time:
2015-02-18T12:54:14Z
class:
src/test/java/org/elasticsearch/index/store/StoreTest.java
comments:
[TEST] remove wrong assertion - stream must be closed to assert the size

time:
2015-02-18T12:41:28Z
class:
src/main/java/org/elasticsearch/index/IndexService.java
src/main/java/org/elasticsearch/index/engine/Engine.java
src/main/java/org/elasticsearch/index/engine/EngineConfig.java
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
src/main/java/org/elasticsearch/index/settings/IndexDynamicSettingsModule.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
src/test/java/org/elasticsearch/index/store/CorruptedTranslogTests.java
src/test/java/org/elasticsearch/indices/state/OpenCloseIndexTests.java
src/test/java/org/elasticsearch/percolator/RecoveryPercolatorTests.java
src/test/java/org/elasticsearch/test/engine/MockInternalEngine.java
comments:
[ENGINE] Flush IndexWriter to disk on close and shutdown

Today we trash everything that has been indexed but not flushed to disk
if the engine is closed. This might not be desired if we shutting down a
node for restart / upgrade or if we close / archive an index. In such a
case we would like to flush the transaction log and commit everything to
disk. This commit adds a flag to the close method that is set on close
and shutdown but not when we remove the shard due to relocations

time:
2015-02-18T11:29:39Z
class:
src/main/java/org/elasticsearch/common/lucene/store/FilterIndexOutput.java
src/main/java/org/elasticsearch/common/util/SingleObjectCache.java
src/main/java/org/elasticsearch/index/store/Store.java
src/main/java/org/elasticsearch/index/store/VerifyingIndexOutput.java
src/main/java/org/elasticsearch/monitor/fs/FsService.java
src/main/java/org/elasticsearch/monitor/network/NetworkService.java
src/main/java/org/elasticsearch/monitor/os/OsService.java
src/main/java/org/elasticsearch/monitor/process/ProcessService.java
src/test/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsTests.java
src/test/java/org/elasticsearch/cluster/ClusterInfoServiceTests.java
src/test/java/org/elasticsearch/common/util/SingleObjectCacheTests.java
src/test/java/org/elasticsearch/index/store/StoreTest.java
src/test/java/org/elasticsearch/indices/recovery/IndexRecoveryTests.java
comments:
[STORE] Add simple cache for StoreStats

this commit tries to reduce the filesystem calls to fetch metadata
by using a simple cache on top of the stats call.

Relates to #9683

time:
2015-02-18T09:31:53Z
class:
src/test/java/org/elasticsearch/test/store/MockFSDirectoryService.java
comments:
Test: include dir listing when check index fails

time:
2015-02-17T19:39:04Z
class:
comments:
Rename Maven repository id

We are using repository ids with spaces in our `pom.xml`. Although it's not forbidden, a common practice is to avoid space in id.

This commit changes codehaus snapshots and lucene snapshots to a consistent naming (using a dash, all lowercase).
We also add a name which is used by Maven when displaying some information about the repository.

This naming is also consistent with [elasticsearch-parent project](https://github.com/elasticsearch/elasticsearch-parent) which will be used in the next future in 1.x and master branch.

**Important note**: If you have trouble to compile elasticsearch or a plugin using `mvn compile` and hit a `Access denied to: [URL_HERE], ReasonPhrase: Forbidden. -> [Help 1]`, you can remove related maven files:

```sh
find ~/.m2/repository -name _remote.repositories -exec rm -v {} \;
find ~/.m2/repository -name _maven.repositories -exec rm -v {} \;
```

Another option is to tell Maven not using those files with `--llr`:

```sh
mvn compile --llr
```

time:
2015-02-17T17:17:12Z
class:
src/main/java/org/elasticsearch/index/engine/Engine.java
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
comments:
[CORE] move InternalEngine.segmentStats() into abstract Engine

time:
2015-02-17T16:53:46Z
class:
src/main/java/org/elasticsearch/index/cache/bitset/BitsetFilterCache.java
src/main/java/org/elasticsearch/index/query/NestedFilterParser.java
src/main/java/org/elasticsearch/index/query/NestedQueryParser.java
src/main/java/org/elasticsearch/index/query/QueryParseContext.java
src/main/java/org/elasticsearch/index/query/support/NestedInnerQueryParseSupport.java
src/main/java/org/elasticsearch/index/query/support/NestedScope.java
src/main/java/org/elasticsearch/percolator/PercolateContext.java
src/main/java/org/elasticsearch/search/fetch/innerhits/InnerHitsParseElement.java
src/main/java/org/elasticsearch/search/internal/DefaultSearchContext.java
src/main/java/org/elasticsearch/search/internal/FilteredSearchContext.java
src/main/java/org/elasticsearch/search/internal/SearchContext.java
src/main/java/org/elasticsearch/search/internal/SubSearchContext.java
src/main/java/org/elasticsearch/search/sort/GeoDistanceSortParser.java
src/main/java/org/elasticsearch/search/sort/ScriptSortParser.java
src/main/java/org/elasticsearch/search/sort/SortParseElement.java
src/test/java/org/elasticsearch/nested/SimpleNestedTests.java
src/test/java/org/elasticsearch/test/TestSearchContext.java
comments:
Added nested scope to query parse context that keeps track the current nested level during search request parsing.

The nested scope is set by any nested feature, so that sub nested queries and filters know about their context and these sub nested queries and filters can construct the right parent filter.
Removed the LateBindingParentFilter workaround in the nested query parser in favour of the nested scope maintained in the query parse context.
Due to this change nested queries and filters can now also be included in nested sorting and inner hits, because those features also now use the nested scope.

This change doesn't fix the usage of nested filters in nested and reverse_nested aggregations. The `nested` filter shouldn't be used inside these aggregations and instead the `nested` and `reverse_nested` aggs should be used to query on the right level. In a different change `nested` inside a `nested` and `reverse_nested` aggregation should result in a parse error.

Closes #9305

time:
2015-02-17T15:40:24Z
class:
src/test/java/org/elasticsearch/discovery/azure/AbstractAzureComputeServiceTest.java
src/test/java/org/elasticsearch/discovery/azure/AzureMinimumMasterNodesTest.java
src/test/java/org/elasticsearch/repositories/azure/AzureSnapshotRestoreITest.java
comments:
Fix failing tests with elasticsearch 1.4.3

(cherry picked from commit 040e96f)
(cherry picked from commit 13c83ce)

time:
2015-02-17T13:49:36Z
class:
src/test/java/org/elasticsearch/azure/itest/AzureSimpleITest.java
comments:
Tests don't pass if elasticsearch.yml does not contain azure discovery settings

For now, we remove forcing discovery settings with `discovery.type: azure`.
So a developer who wants to run this test needs to add it in his `elasticsearch.yml` file.

Due to #50
(cherry picked from commit 6ac4483)
(cherry picked from commit 1a80c4b)

time:
2015-02-17T11:55:48Z
class:
src/main/java/org/elasticsearch/index/gateway/IndexShardGateway.java
comments:
[GATEWAY] Don't rename recovery translog in gateway

we used to reuse files / write them twice in translog. Today we don't
do this anymore so the rename logic is unneeded.

time:
2015-02-17T11:37:28Z
class:
src/test/java/org/elasticsearch/search/aggregations/reducers/DerivativeTests.java
comments:
Added test for second_derivative

time:
2015-02-17T11:34:53Z
class:
src/test/java/org/elasticsearch/azure/itest/AzureSimpleITest.java
src/test/java/org/elasticsearch/cloud/azure/AbstractAzureTest.java
src/test/java/org/elasticsearch/repositories/azure/AzureSnapshotRestoreITest.java
comments:
[Test] use seed in container name and clean all after tests

Until version 2.5.2, our integration tests were using the same `container_name` for all tests but different `base_path` for repositories.
One test uses the default `base_path` so we ended up with conflicts while running at the same time a test from different locations (could be by developers and/or Jenkins itself).

This commit changes this:

* it creates a container name which uses the test seed, eg. `snapshot-itest-b2dbda478ab9da2f`
* for `testMultipleRepositories`, we append `-1` and `-2` to the previous container name
* for `testRemoveAndCreateContainer`, we append `-testremove`
* for `testForbiddenContainerName`, we now remove containers which are supposed to be created: `123456789-123456789-123456789-123456789-123456789-123456789-123`, `elasticsearch-integration` and `elasticsearch-integration-007`. It also means that we wait up to 5 minutes if we launch just after the same test because Azure removes containers in an asynchronous way so it's not possible to create the container right after we send a remove container request.
* After and before the test suite, we make sure that we clean the containers that have been created during the test suite execution.

It means that after a test, no file should remain within the storage account used for those integration tests.

Closes #50.

time:
2015-02-17T11:31:24Z
class:
src/test/java/org/elasticsearch/search/aggregations/reducers/DerivativeTests.java
comments:
Cleaning up NOCOMMITs

time:
2015-02-17T11:31:02Z
class:
src/main/java/org/elasticsearch/search/aggregations/AggregatorFactories.java
comments:
Cleaning up NOCOMMITs which are resolved

time:
2015-02-17T11:15:04Z
class:
src/test/java/org/elasticsearch/search/aggregations/reducers/DateDerivativeTests.java
src/test/java/org/elasticsearch/search/aggregations/reducers/DerivativeTests.java
comments:
updated derivative tests to test _count

time:
2015-02-17T11:14:47Z
class:
src/main/java/org/elasticsearch/search/aggregations/AggregatorFactories.java
comments:
Added support for _count and _key as bucketsPaths

time:
2015-02-17T10:08:25Z
class:
src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeReducer.java
comments:
DerivativeReducer now copies histogram options from old histogram instance

time:
2015-02-17T10:07:56Z
class:
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalOrder.java
comments:
InternalHistogram.Factory.create() can now work from prototype

Another InternalHistogram instance can be passed into the method with the buckets and the name and will be used to set all the options such as minDocCount, formatter, Order etc.

time:
2015-02-17T10:04:46Z
class:
src/main/java/org/elasticsearch/index/engine/Engine.java
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
src/test/java/org/elasticsearch/test/engine/MockInternalEngine.java
comments:
[ENGINE] Move more methods into abstract Engine

time:
2015-02-17T09:47:46Z
class:
src/main/java/org/elasticsearch/index/store/smbmmapfs/SmbMmapFsDirectoryService.java
src/main/java/org/elasticsearch/index/store/smbmmapfs/SmbMmapFsIndexStore.java
src/main/java/org/elasticsearch/index/store/smbmmapfs/SmbMmapFsIndexStoreModule.java
src/main/java/org/elasticsearch/index/store/smbsimplefs/SmbSimpleFsDirectoryService.java
src/main/java/org/elasticsearch/index/store/smbsimplefs/SmbSimpleFsIndexStore.java
src/main/java/org/elasticsearch/index/store/smbsimplefs/SmbSimpleFsIndexStoreModule.java
src/test/java/org/elasticsearch/index/store/AbstractAzureFsTest.java
src/test/java/org/elasticsearch/index/store/SmbMMapFsTest.java
src/test/java/org/elasticsearch/index/store/SmbSimpleFsTest.java
comments:
Simplify  setting index.store.type with smb_simple_fs and smb_mmap_fs

This commit changes work done in #60 by using automatic store type discovery which exists in elasticsearch core.

Instead of writing configuration like:

```yaml
index.store.type: org.elasticsearch.index.store.fs.SmbMmapFsIndexStoreModule
index.store.type: org.elasticsearch.index.store.fs.SmbSimpleFsIndexStoreModule
```

We can now use:

```yaml
index.store.type: smb_mmap_fs
index.store.type: smb_simple_fs
```

Note that we move `org.elasticsearch.index.store.fs.SmbMmapFsIndexStoreModule` to  `org.elasticsearch.index.store.smbmmapfs.SmbMmapFsIndexStoreModule` and `org.elasticsearch.index.store.fs.SmbSimpleFsDirectoryService` to `org.elasticsearch.index.store.smbsimplefs.SmbSimpleFsDirectoryService` instead of deprecating the old classes and add new ones.
It means that if users were using a 2.5.2-SNAPSHOT version, they will need to update their settings.

(cherry picked from commit 613ce5a)
(cherry picked from commit 7831521)

time:
2015-02-17T09:05:24Z
class:
src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeReducer.java
src/test/java/org/elasticsearch/search/aggregations/reducers/DateDerivativeTests.java
src/test/java/org/elasticsearch/search/aggregations/reducers/DerivativeTests.java
comments:
Tests for derivative reducer

Most tests have been marked with @AwaitsFix since they require functionality to be implemented before they will pass

time:
2015-02-17T08:32:50Z
class:
src/test/java/org/elasticsearch/transport/netty/NettyTransportMultiPortTests.java
comments:
[TEST] use util method to propperly shudtown threadpools

time:
2015-02-16T16:32:42Z
class:
src/main/java/org/elasticsearch/search/aggregations/AggregationBuilder.java
src/main/java/org/elasticsearch/search/aggregations/TransportAggregationModule.java
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalOrder.java
src/main/java/org/elasticsearch/search/aggregations/reducers/ReducerBuilder.java
comments:
More update to support Reducer Builders

time:
2015-02-16T15:54:06Z
class:
src/main/java/org/elasticsearch/common/rounding/Rounding.java
src/main/java/org/elasticsearch/common/rounding/TimeZoneRounding.java
src/main/java/org/elasticsearch/index/query/RangeQueryBuilder.java
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramBuilder.java
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramParser.java
src/test/java/org/elasticsearch/common/rounding/TimeZoneRoundingTests.java
src/test/java/org/elasticsearch/indices/cache/query/IndicesQueryCacheTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramOffsetTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramTests.java
comments:
Aggregations: Simplify time zone option in `date_histogram`

Removed the existing `pre_zone` and `post_zone` option in `date_histogram` in favor of
the simpler `time_zone` option. Previously, specifying different values for these could
lead to confusing scenarios where ES would return bucket keys that are not UTC.
Now `time_zone` is the only option setting, the calculation of date buckets to take place in the
preferred time zone, but after rounding converting the bucket key values back to UTC.

Closes #9062
Closes #9637

time:
2015-02-16T13:08:15Z
class:
src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java
src/main/java/org/elasticsearch/action/termvectors/TermVectorsResponse.java
src/main/java/org/elasticsearch/action/termvectors/TransportMultiTermVectorsAction.java
src/main/java/org/elasticsearch/action/termvectors/TransportShardMultiTermsVectorAction.java
src/main/java/org/elasticsearch/action/termvectors/TransportTermVectorsAction.java
src/test/java/org/elasticsearch/action/termvectors/GetTermVectorsCheckDocFreqTests.java
comments:
Term Vectors: requests are now timed

When asking for term statistics, generating term vectors on the fly or with
`dfs` set to `true`, some requests may take a while, so it is useful to know
exactly how long.

Closes #9583

time:
2015-02-16T11:57:01Z
class:
src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeBuilder.java
src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeParser.java
comments:
Added Builder for Derivatives Reducer

time:
2015-02-16T11:56:41Z
class:
src/main/java/org/elasticsearch/search/aggregations/reducers/Reducer.java
src/main/java/org/elasticsearch/search/aggregations/reducers/ReducerBuilder.java
src/main/java/org/elasticsearch/search/aggregations/reducers/ReducerBuilders.java
comments:
Added Builder classes for Reducers

time:
2015-02-16T11:03:54Z
class:
src/main/java/org/elasticsearch/common/lucene/search/FilteredCollector.java
src/main/java/org/elasticsearch/common/lucene/search/XCollector.java
src/main/java/org/elasticsearch/percolator/PercolatorService.java
src/main/java/org/elasticsearch/percolator/QueryCollector.java
src/main/java/org/elasticsearch/search/aggregations/AggregationPhase.java
src/main/java/org/elasticsearch/search/aggregations/BucketCollector.java
src/main/java/org/elasticsearch/search/internal/ContextIndexSearcher.java
comments:
Internal: Remove XCollector.

We don't actually need this interface, we can just run the post-collection
operation once collection is finished on impls that need it.

Close #9677

time:
2015-02-16T10:59:50Z
class:
comments:
Removed 'Master' from names.txt

Fixes #9698

time:
2015-02-16T10:54:37Z
class:
src/main/java/org/elasticsearch/search/aggregations/AggregatorFactories.java
comments:
removed obselete NOCOMMIT and left over sysout call

time:
2015-02-16T10:52:00Z
class:
src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeReducer.java
comments:
Derivative Reducer now supported nth order derivatives

time:
2015-02-16T10:51:31Z
class:
src/main/java/org/elasticsearch/search/aggregations/InternalMultiBucketAggregation.java
src/main/java/org/elasticsearch/search/aggregations/InvalidAggregationPathException.java
comments:
getProperty method in the aggregations framework now throws a specific exception

time:
2015-02-16T10:42:08Z
class:
src/main/java/org/elasticsearch/search/aggregations/AggregatorFactories.java
src/main/java/org/elasticsearch/search/aggregations/reducers/ReducerFactory.java
comments:
First (rough) pass at dependancy resolution for reducers

uses the depth-first algorithm from http://en.wikipedia.org/wiki/Topological_sorting#Algorithms

Needs some cleaning up

time:
2015-02-16T09:27:27Z
class:
src/main/java/org/elasticsearch/action/admin/indices/segments/IndicesSegmentsRequest.java
src/main/java/org/elasticsearch/cluster/action/index/NodeIndexDeletedAction.java
src/main/java/org/elasticsearch/cluster/service/InternalClusterService.java
src/main/java/org/elasticsearch/cluster/service/PendingClusterTask.java
src/main/java/org/elasticsearch/common/rounding/TimeZoneRounding.java
src/main/java/org/elasticsearch/index/engine/Engine.java
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
src/main/java/org/elasticsearch/index/mapper/DocumentFieldMappers.java
src/main/java/org/elasticsearch/index/mapper/FieldMappersLookup.java
src/main/java/org/elasticsearch/index/mapper/MapperService.java
src/main/java/org/elasticsearch/index/store/Store.java
src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
src/main/java/org/elasticsearch/indices/recovery/ShardRecoveryHandler.java
src/main/java/org/elasticsearch/indices/ttl/IndicesTTLService.java
src/main/java/org/elasticsearch/rest/action/admin/indices/template/get/RestGetIndexTemplateAction.java
src/main/java/org/elasticsearch/rest/action/admin/indices/template/head/RestHeadIndexTemplateAction.java
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramParser.java
src/main/java/org/joda/time/base/BaseDateTime.java
src/test/java/org/elasticsearch/action/admin/indices/segments/IndicesSegmentsRequestTests.java
src/test/java/org/elasticsearch/document/DocumentActionsTests.java
src/test/java/org/elasticsearch/index/mapper/simple/SimpleMapperTests.java
src/test/java/org/elasticsearch/index/store/CorruptedFileTest.java
src/test/java/org/elasticsearch/indices/IndicesOptionsIntegrationTests.java
src/test/java/org/elasticsearch/indices/mapping/SimpleGetFieldMappingsTests.java
src/test/java/org/elasticsearch/nested/SimpleNestedTests.java
src/test/java/org/elasticsearch/percolator/PercolatorTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/HistogramTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/ReverseNestedTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/TopHitsTests.java
src/test/java/org/elasticsearch/search/query/ExistsMissingTests.java
src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchTests.java
src/test/java/org/elasticsearch/test/junit/rule/RepeatOnExceptionRule.java
src/test/java/org/elasticsearch/test/rest/ElasticsearchRestTests.java
src/test/java/org/elasticsearch/test/rest/spec/RestSpec.java
src/test/java/org/elasticsearch/test/rest/support/Features.java
src/test/java/org/elasticsearch/transport/netty/NettyTransportMultiPortTests.java
comments:
Merge branch 'master' into feature/aggs_2_0

time:
2015-02-16T08:46:12Z
class:
comments:
[BUILD] Add marvel and license to the release script

time:
2015-02-14T16:53:55Z
class:
comments:
Update README.md

clarify why we wrote the smb dir

time:
2015-02-13T22:55:35Z
class:
comments:
Packaging: Add antlr and asm dependencies

time:
2015-02-13T21:43:58Z
class:
src/main/java/org/elasticsearch/index/engine/Engine.java
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
comments:
[CORE] Move as much as possible into abstract Engine

This paves the way for more shared code between the `InternalEngine` and
`ShadowEngine` by way of the abstract `Engine` class. No actual
functionality has been changed.

time:
2015-02-13T21:21:19Z
class:
comments:
Script examples should escape special chars

time:
2015-02-13T20:11:42Z
class:
comments:
Fixed an invalid query

Closes #9682

time:
2015-02-13T16:26:10Z
class:
src/main/java/org/apache/lucene/store/SmbDirectoryWrapper.java
src/main/java/org/elasticsearch/index/store/fs/SmbMmapFsDirectoryService.java
src/main/java/org/elasticsearch/index/store/fs/SmbMmapFsIndexStore.java
src/main/java/org/elasticsearch/index/store/fs/SmbMmapFsIndexStoreModule.java
src/main/java/org/elasticsearch/index/store/fs/SmbSimpleFsDirectoryService.java
src/main/java/org/elasticsearch/index/store/fs/SmbSimpleFsIndexStore.java
src/main/java/org/elasticsearch/index/store/fs/SmbSimpleFsIndexStoreModule.java
src/test/java/org/apache/lucene/store/SmbMMapDirectoryTest.java
src/test/java/org/apache/lucene/store/SmbSimpleFSDirectoryTest.java
comments:
Open Lucene MMap/SimpleFSDirectory with Read option

This commit adds 2 IndexStoreModule / IndexStore / DirectoryService that open Lucene MMapFSDirectory / SimpleFSDirectory with a "read" option.
It can be activated in configuration with:
index.store.type: org.elasticsearch.index.store.fs.SmbSimpleFsIndexStoreModule
or
index.store.type: org.elasticsearch.index.store.fs.SmbMmapFsIndexStoreModule
(cherry picked from commit 2388ace)
(cherry picked from commit 16014a0)

time:
2015-02-13T15:44:31Z
class:
comments:
Fix doc for es version < 1.4.3

time:
2015-02-13T15:43:39Z
class:
src/main/java/org/elasticsearch/search/aggregations/reducers/Reducer.java
src/main/java/org/elasticsearch/search/aggregations/reducers/ReducerFactory.java
src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeParser.java
src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeReducer.java
comments:
bucketsPath is now in the Reducer class since every Reducer implementation will need it

time:
2015-02-13T15:43:33Z
class:
comments:
Fix doc for es version < 1.4.3

time:
2015-02-13T15:42:52Z
class:
comments:
Fix doc for es version < 1.4.3

time:
2015-02-13T15:42:28Z
class:
comments:
Fix doc for es version < 1.4.3

time:
2015-02-13T15:41:45Z
class:
comments:
Fix doc for es version < 1.4.3

time:
2015-02-13T15:40:23Z
class:
comments:
Fix doc for es version < 1.4.3

time:
2015-02-13T15:05:46Z
class:
src/main/java/org/elasticsearch/common/rounding/TimeZoneRounding.java
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramParser.java
src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/HistogramTests.java
comments:
Aggregations: Prevent negative intervals in date_histogram

Negative settings for interval in date_histogram could lead to OOM errors in conjunction
with min_doc_count=0. This fix raises exceptions in the histogram builder and the
 TimeZoneRounding classes so that the query fails before this can happen.

Closes #9634
Closes #9690

time:
2015-02-13T14:33:44Z
class:
src/main/java/org/elasticsearch/search/aggregations/AggregatorFactories.java
src/main/java/org/elasticsearch/search/aggregations/reducers/ReducerFactory.java
comments:
Validation of the reducer factories is now called from within the AggregatorFactories

time:
2015-02-13T12:43:00Z
class:
src/main/java/org/elasticsearch/index/store/Store.java
comments:
remove dead code

time:
2015-02-13T12:42:11Z
class:
src/main/java/org/elasticsearch/index/store/Store.java
comments:
[STORE] use Directory#fileLength() less during calculating checksums

time:
2015-02-13T11:10:37Z
class:
src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
src/main/java/org/elasticsearch/indices/recovery/ShardRecoveryHandler.java
src/test/java/org/elasticsearch/index/store/CorruptedFileTest.java
comments:
[RECOVERY] Handle corruptions during recovery finalization

Today we sometimes have to transfer files without verifying the checksum
ie. if the file had an old alder32 checksum but was using random access
while writing such that we can only verify they files length. We will likely
not detect corruptions there and with the new checks during recovery finalization
we might run into corrupt index exceptions in that stage. This causes
the primary to be failed as well since we don't handle the exception today. This commit
adds better handling and a test for this scenario.

time:
2015-02-13T10:25:26Z
class:
src/main/java/org/elasticsearch/rest/action/admin/indices/template/get/RestGetIndexTemplateAction.java
src/main/java/org/elasticsearch/rest/action/admin/indices/template/head/RestHeadIndexTemplateAction.java
comments:
Rest: expose `master_timeout` flag on `GET _template` & `HEAD _template`

These are master level operation but we currently don't expose this parameter

Closes #9688

time:
2015-02-13T09:38:41Z
class:
src/main/java/org/elasticsearch/cluster/action/index/NodeIndexDeletedAction.java
comments:
Internal: only ack index store deletion on data nodes

When an index is deleted we wait on all nodes to ack the delete. Data nodes are expected to both ack the remove of the index from their IndicesService and also the deletion of the store from disk. At the moment all nodes sends this ack which causes wrong counting on the master side. On top of this, we currently have an unneeded WARN message in the logs when client nodes try to acquire locks but do not have a data folder.

Relates to #9605

Closes #9672

time:
2015-02-13T09:18:52Z
class:
src/main/java/org/elasticsearch/index/store/Store.java
comments:
Remove obsolet deleteFile call in Store

time:
2015-02-13T05:18:28Z
class:
src/test/java/org/elasticsearch/test/rest/support/Features.java
comments:
[TEST] declare support for groovy-scripting feature in the Java REST tests runner

Groovy was disabled by default, but we turn it on in our test infra. We can then declare support for it so we go and execute script related tests as part of the REST tests suite.

time:
2015-02-13T04:50:34Z
class:
src/test/java/org/elasticsearch/test/rest/ElasticsearchRestTests.java
src/test/java/org/elasticsearch/test/rest/spec/RestSpec.java
comments:
[TEST] allow to disable REST spec validation

With #9629 we introduced REST spec validation, which barfs whenever the REST spec don't follow the defined conventions. That said, we sometimes execute tests against previous branches and tags which have spec that needs fixing but we can't go back and fix them. We now support the `-Dtests.rest.validate_spec` system property that allows to turn off REST spec validation (enabled by default) so that we can still run tests against old branches/tags.

time:
2015-02-12T21:59:59Z
class:
src/test/java/org/elasticsearch/nested/SimpleNestedTests.java
comments:
Fix test failure resulting from #8872 change.

time:
2015-02-12T20:25:32Z
class:
src/main/java/org/elasticsearch/cloud/azure/AzureStorageService.java
src/main/java/org/elasticsearch/cloud/azure/AzureStorageServiceImpl.java
src/main/java/org/elasticsearch/cloud/azure/blobstore/AzureBlobContainer.java
src/main/java/org/elasticsearch/cloud/azure/blobstore/AzureBlobStore.java
src/main/java/org/elasticsearch/repositories/azure/AzureRepository.java
src/test/java/org/elasticsearch/repositories/azure/AbstractAzureRepositoryServiceTest.java
src/test/java/org/elasticsearch/repositories/azure/AzureSnapshotRestoreITest.java
src/test/java/org/elasticsearch/repositories/azure/AzureStorageServiceMock.java
comments:
Use Azure Storage 2.0.0

Microsoft team has released a new specific project to deal with storage with a much cleaner API than the previous version.

See https://github.com/azure/azure-storage-java
Documentation is here: http://azure.microsoft.com/en-us/documentation/articles/storage-java-how-to-use-blob-storage/

Note that the produced ZIP file has been reduced from 5mb to 1.3mb.

Related to #38

(cherry picked from commit 4467254)
(cherry picked from commit b2f1e4d)

time:
2015-02-12T18:59:43Z
class:
comments:
REST Test: Lucene segment format can have two or three numbers: 4.10.2 or 4.9

time:
2015-02-12T17:58:37Z
class:
src/main/java/org/elasticsearch/index/mapper/DocumentFieldMappers.java
src/main/java/org/elasticsearch/index/mapper/FieldMappersLookup.java
src/main/java/org/elasticsearch/index/mapper/MapperService.java
src/main/java/org/elasticsearch/indices/ttl/IndicesTTLService.java
src/test/java/org/elasticsearch/document/DocumentActionsTests.java
src/test/java/org/elasticsearch/index/mapper/simple/SimpleMapperTests.java
src/test/java/org/elasticsearch/indices/mapping/SimpleGetFieldMappingsTests.java
src/test/java/org/elasticsearch/nested/SimpleNestedTests.java
src/test/java/org/elasticsearch/percolator/PercolatorTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/ReverseNestedTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/TopHitsTests.java
src/test/java/org/elasticsearch/search/query/ExistsMissingTests.java
src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchTests.java
comments:
Mappings: Remove support for field access by short name

When multiple fields under object fields share the same name, accessing
by short name is ambiguous.  This removes support for short names,
always requiring the full name when used in queries.

closes #8872

time:
2015-02-12T17:55:51Z
class:
src/main/java/org/elasticsearch/cloud/azure/AzureStorageService.java
src/main/java/org/elasticsearch/cloud/azure/AzureStorageServiceImpl.java
src/main/java/org/elasticsearch/cloud/azure/blobstore/AzureBlobContainer.java
src/test/java/org/elasticsearch/repositories/azure/AzureStorageServiceMock.java
comments:
Support new method `BlobContainer#move()`

This has been added in elasticsearch 2.0.0. See elasticsearch/elasticsearch#8782

Wondering if this PR should be split in two parts:

* one that clean the code and which is portable to 1.4, 1.x and master
* one that simply add move() method for master branch

@imotov WDYT?

Closes #49.

time:
2015-02-12T17:47:34Z
class:
src/main/java/org/elasticsearch/cloud/azure/AzureStorageServiceImpl.java
src/main/java/org/elasticsearch/cloud/azure/blobstore/AzureBlobContainer.java
src/main/java/org/elasticsearch/cloud/azure/blobstore/AzureBlobStore.java
src/main/java/org/elasticsearch/repositories/azure/AzureRepository.java
src/test/java/org/elasticsearch/repositories/azure/AzureSnapshotRestoreITest.java
comments:
Failure when creating a container should raise an exception

When you remove a container from Azure console, even if Azure told you that it has been done, it appears to be an asynchronous deletion so you can hit error like `can not initialize container [elasticsearch-snapshots]: [The specified container is being deleted. Try operation later.]` but this error does not fail the repository creation...

Related to #54.

(cherry picked from commit e483304)
(cherry picked from commit 520444c)

time:
2015-02-12T17:13:59Z
class:
src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeParser.java
src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeReducer.java
comments:
Can now specify a format for the returned derivative values

time:
2015-02-12T17:08:35Z
class:
comments:
REST tests - add feature groovy_scripting to skip tests if groovy not enabled

time:
2015-02-12T16:35:19Z
class:
comments:
Fixed cat.segments and indices.segments tests - bad YAML indenting

time:
2015-02-12T16:07:57Z
class:
comments:
Allow configuration of the GC log file via an environment variable

Enabling GC logging works now by setting the environment variable ES_GC_LOG_FILE
to the full path to the GC log file. Missing directories will be created as needed.

The ES_USE_GC_LOGGING environment variable is no longer used.

Closes #8471
Closes #8479

time:
2015-02-12T15:47:06Z
class:
src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeReducer.java
comments:
can now reference single value metrics directly instead of having to add '.value' to the path

time:
2015-02-12T15:36:38Z
class:
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java
src/main/java/org/elasticsearch/search/aggregations/reducers/ReducerFactory.java
src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeReducer.java
comments:
derivative reducer now works with both date_histogram and histogram

time:
2015-02-12T14:50:54Z
class:
src/main/java/org/elasticsearch/cluster/service/InternalClusterService.java
comments:
Internal: Pending Task listing should account for task being nulled

This caused by #9671 and #9621 working together and cause an NPE

time:
2015-02-12T14:50:11Z
class:
src/main/java/org/elasticsearch/search/aggregations/AggregatorParsers.java
comments:
Minor indentation/validation fix in AggregatorParsers.

time:
2015-02-12T14:12:54Z
class:
src/test/java/org/elasticsearch/test/junit/rule/RepeatOnExceptionRule.java
src/test/java/org/elasticsearch/transport/netty/NettyTransportMultiPortTests.java
comments:
Testing: Ensure RepeatOnExceptionRule is available in test-jar

This moves the rule, so it is made available in the test.jar. In
addition, you can now specify the exception, which triggers a rerun
of the test in order to make it reusable for others.

Also ensured that the NettyTransportTest frees all resources inside
of its testing method instead of pre/post running methods, as those
are still called only once, even though a failed test might be repeated.

time:
2015-02-12T14:06:18Z
class:
src/main/java/org/joda/time/base/BaseDateTime.java
comments:
Dependencies: Update joda-time to v2.7

Closes #9338
Closes #9610

time:
2015-02-12T14:05:34Z
class:
src/main/java/org/elasticsearch/cluster/service/InternalClusterService.java
src/main/java/org/elasticsearch/cluster/service/PendingClusterTask.java
comments:
Internal: Introduce TimedPrioritizedRunnable base class to all commands that go into InternalClusterService.updateTasksExecutor

At the moment we sometime submit generic runnables, which make life slightly harder when generated pending task list which have to account for them. This commit adds an abstract TimedPrioritizedRunnable class which should always be used. This class also automatically measures time in queue, which is needed for the pending task reporting.

Relates to #8077

Closes #9354
Closes #9671

time:
2015-02-12T14:01:34Z
class:
src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeReducer.java
comments:
fix to the name of the injected aggregation for derivatives

time:
2015-02-12T13:52:56Z
class:
src/main/java/org/elasticsearch/search/aggregations/AggregatorBase.java
src/main/java/org/elasticsearch/search/aggregations/AggregatorFactory.java
src/main/java/org/elasticsearch/search/aggregations/bucket/BucketsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/GlobalOrdinalsSignificantTermsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/GlobalOrdinalsStringTermsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorFactory.java
comments:
Fixing compile issues after rebase with master

Mostly due to @jpountz's leaf collector changes

time:
2015-02-12T13:42:15Z
class:
src/main/java/org/elasticsearch/action/admin/indices/segments/IndicesSegmentsRequest.java
src/test/java/org/elasticsearch/action/admin/indices/segments/IndicesSegmentsRequestTests.java
src/test/java/org/elasticsearch/indices/IndicesOptionsIntegrationTests.java
comments:
Change behaviour of indices segments api to allow no indices

Using '_cat/segments' or the indices segments api without matching any index
now returns empty result instead of throwing IndexMissingException.

Closes #9219

time:
2015-02-12T13:37:16Z
class:
src/main/java/org/elasticsearch/search/aggregations/AggregationModule.java
src/main/java/org/elasticsearch/search/aggregations/TransportAggregationModule.java
src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeParser.java
src/main/java/org/elasticsearch/search/aggregations/reducers/derivative/DerivativeReducer.java
comments:
Basic derivative reducer

time:
2015-02-12T13:37:16Z
class:
src/main/java/org/elasticsearch/search/aggregations/AggregationModule.java
src/main/java/org/elasticsearch/search/aggregations/InternalAggregation.java
src/main/java/org/elasticsearch/search/aggregations/InternalAggregations.java
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/UnmappedSignificantTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/UnmappedTerms.java
src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHits.java
src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/reducers/InternalSimpleValue.java
src/main/java/org/elasticsearch/search/aggregations/reducers/Reducer.java
src/main/java/org/elasticsearch/search/aggregations/reducers/ReducerFactory.java
src/main/java/org/elasticsearch/search/aggregations/reducers/ReducerStreams.java
src/main/java/org/elasticsearch/search/aggregations/reducers/SimpleValue.java
comments:
Reducers are now wired end-to-end into the agg framework

time:
2015-02-12T13:37:16Z
class:
src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java
src/main/java/org/elasticsearch/search/aggregations/AggregationModule.java
src/main/java/org/elasticsearch/search/aggregations/AggregatorFactories.java
src/main/java/org/elasticsearch/search/aggregations/AggregatorFactory.java
src/main/java/org/elasticsearch/search/aggregations/AggregatorParsers.java
src/test/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorTest.java
comments:
Reducers are now parsed in AggregatorParsers

time:
2015-02-12T13:36:55Z
class:
src/main/java/org/elasticsearch/search/aggregations/AggregatorFactories.java
src/main/java/org/elasticsearch/search/aggregations/AggregatorFactory.java
comments:
AggregatorFactories now stores reducers as well as aggregators

These reducers will be passed through from the AggregatorParser

time:
2015-02-12T13:36:05Z
class:
src/main/java/org/elasticsearch/search/aggregations/Aggregator.java
src/main/java/org/elasticsearch/search/aggregations/AggregatorFactory.java
src/main/java/org/elasticsearch/search/aggregations/InternalAggregation.java
src/main/java/org/elasticsearch/search/aggregations/InternalMultiBucketAggregation.java
src/main/java/org/elasticsearch/search/aggregations/NonCollectingAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/BucketsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/InternalSingleBucketAggregation.java
src/main/java/org/elasticsearch/search/aggregations/bucket/SingleBucketAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/children/InternalChildren.java
src/main/java/org/elasticsearch/search/aggregations/bucket/children/ParentToChildrenAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/filter/FilterAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/filter/InternalFilter.java
src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/filters/InternalFilters.java
src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridParser.java
src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/InternalGeoHashGrid.java
src/main/java/org/elasticsearch/search/aggregations/bucket/global/GlobalAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/global/InternalGlobal.java
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java
src/main/java/org/elasticsearch/search/aggregations/bucket/missing/InternalMissing.java
src/main/java/org/elasticsearch/search/aggregations/bucket/missing/MissingAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/nested/InternalNested.java
src/main/java/org/elasticsearch/search/aggregations/bucket/nested/InternalReverseNested.java
src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/range/InternalRange.java
src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/InternalDateRange.java
src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceParser.java
src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/InternalGeoDistance.java
src/main/java/org/elasticsearch/search/aggregations/bucket/range/ipv4/InternalIPv4Range.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/GlobalOrdinalsSignificantTermsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/InternalSignificantTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantLongTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantLongTermsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantStringTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantStringTermsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregatorFactory.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/UnmappedSignificantTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/AbstractStringTermsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTermsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/GlobalOrdinalsStringTermsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/LongTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/LongTermsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/StringTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/StringTermsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorFactory.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/UnmappedTerms.java
src/main/java/org/elasticsearch/search/aggregations/metrics/InternalMetricsAggregation.java
src/main/java/org/elasticsearch/search/aggregations/metrics/InternalNumericMetricsAggregation.java
src/main/java/org/elasticsearch/search/aggregations/metrics/MetricsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/NumericMetricsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/avg/AvgAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvg.java
src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityAggregatorFactory.java
src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinality.java
src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/GeoBoundsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/InternalGeoBounds.java
src/main/java/org/elasticsearch/search/aggregations/metrics/max/InternalMax.java
src/main/java/org/elasticsearch/search/aggregations/metrics/max/MaxAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/min/InternalMin.java
src/main/java/org/elasticsearch/search/aggregations/metrics/min/MinAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/AbstractInternalPercentiles.java
src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/AbstractPercentilesAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/InternalPercentileRanks.java
src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/InternalPercentiles.java
src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentileRanksAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentilesAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/InternalScriptedMetric.java
src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/stats/InternalStats.java
src/main/java/org/elasticsearch/search/aggregations/metrics/stats/StatsAggegator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ExtendedStatsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/InternalExtendedStats.java
src/main/java/org/elasticsearch/search/aggregations/metrics/sum/InternalSum.java
src/main/java/org/elasticsearch/search/aggregations/metrics/sum/SumAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/valuecount/InternalValueCount.java
src/main/java/org/elasticsearch/search/aggregations/metrics/valuecount/ValueCountAggregator.java
src/main/java/org/elasticsearch/search/aggregations/reducers/Reducer.java
src/main/java/org/elasticsearch/search/aggregations/reducers/ReducerFactory.java
src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceAggregatorFactory.java
src/test/java/org/elasticsearch/search/aggregations/bucket/significant/SignificanceHeuristicTests.java
comments:
Adds reducers list to InternalAggregation.reduce()

The list of reducers is fed through from the AggregatorFactory

time:
2015-02-12T13:23:12Z
class:
src/main/java/org/elasticsearch/search/aggregations/InternalAggregation.java
src/main/java/org/elasticsearch/search/aggregations/InternalAggregations.java
src/main/java/org/elasticsearch/search/aggregations/bucket/InternalSingleBucketAggregation.java
src/main/java/org/elasticsearch/search/aggregations/bucket/filters/InternalFilters.java
src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/InternalGeoHashGrid.java
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java
src/main/java/org/elasticsearch/search/aggregations/bucket/range/InternalRange.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/InternalSignificantTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/UnmappedSignificantTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalTerms.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/UnmappedTerms.java
src/main/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvg.java
src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinality.java
src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/InternalGeoBounds.java
src/main/java/org/elasticsearch/search/aggregations/metrics/max/InternalMax.java
src/main/java/org/elasticsearch/search/aggregations/metrics/min/InternalMin.java
src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/AbstractInternalPercentiles.java
src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/InternalScriptedMetric.java
src/main/java/org/elasticsearch/search/aggregations/metrics/stats/InternalStats.java
src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/InternalExtendedStats.java
src/main/java/org/elasticsearch/search/aggregations/metrics/sum/InternalSum.java
src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHits.java
src/main/java/org/elasticsearch/search/aggregations/metrics/valuecount/InternalValueCount.java
comments:
make InternalAggregation.reduce(ReduceContext) use template pattern

sub-classes of InternalAggregation now implement doReduce(ReduceContext) that is called from InternalAggregation.reduce(ReduceContext) which is now final

time:
2015-02-12T13:13:31Z
class:
src/main/java/org/elasticsearch/common/geo/GeoDistance.java
src/main/java/org/elasticsearch/common/lucene/Lucene.java
src/main/java/org/elasticsearch/common/lucene/TopReaderContextAware.java
src/main/java/org/elasticsearch/common/util/LongHash.java
src/main/java/org/elasticsearch/index/fielddata/SortingNumericDoubleValues.java
src/main/java/org/elasticsearch/percolator/PercolatorService.java
src/main/java/org/elasticsearch/percolator/QueryCollector.java
src/main/java/org/elasticsearch/search/aggregations/AggregationPhase.java
src/main/java/org/elasticsearch/search/aggregations/Aggregator.java
src/main/java/org/elasticsearch/search/aggregations/AggregatorBase.java
src/main/java/org/elasticsearch/search/aggregations/AggregatorFactories.java
src/main/java/org/elasticsearch/search/aggregations/AggregatorFactory.java
src/main/java/org/elasticsearch/search/aggregations/BucketCollector.java
src/main/java/org/elasticsearch/search/aggregations/FilteringBucketCollector.java
src/main/java/org/elasticsearch/search/aggregations/LeafBucketCollector.java
src/main/java/org/elasticsearch/search/aggregations/LeafBucketCollectorBase.java
src/main/java/org/elasticsearch/search/aggregations/NonCollectingAggregator.java
src/main/java/org/elasticsearch/search/aggregations/RecordingBucketCollector.java
src/main/java/org/elasticsearch/search/aggregations/RecordingPerReaderBucketCollector.java
src/main/java/org/elasticsearch/search/aggregations/bucket/BucketsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/DeferringBucketCollector.java
src/main/java/org/elasticsearch/search/aggregations/bucket/SingleBucketAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/children/ParentToChildrenAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/filter/FilterAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridParser.java
src/main/java/org/elasticsearch/search/aggregations/bucket/global/GlobalAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/missing/MissingAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceParser.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/GlobalOrdinalsSignificantTermsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantLongTermsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantStringTermsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregatorFactory.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/AbstractStringTermsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/AbstractTermsParametersParser.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTermsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/GlobalOrdinalsStringTermsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalOrder.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/LongTermsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/StringTermsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorFactory.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsBuilder.java
src/main/java/org/elasticsearch/search/aggregations/bucket/terms/support/IncludeExclude.java
src/main/java/org/elasticsearch/search/aggregations/metrics/MetricsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/avg/AvgAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityAggregatorFactory.java
src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/GeoBoundsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/max/MaxAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/min/MinAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/AbstractPercentilesAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/stats/StatsAggegator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ExtendedStatsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/sum/SumAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregator.java
src/main/java/org/elasticsearch/search/aggregations/metrics/valuecount/ValueCountAggregator.java
src/main/java/org/elasticsearch/search/aggregations/support/AggregationContext.java
src/main/java/org/elasticsearch/search/aggregations/support/ValuesSource.java
src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceAggregatorFactory.java
src/main/java/org/elasticsearch/search/aggregations/support/values/ScriptBytesValues.java
src/main/java/org/elasticsearch/search/aggregations/support/values/ScriptDoubleValues.java
src/main/java/org/elasticsearch/search/aggregations/support/values/ScriptLongValues.java
src/test/java/org/elasticsearch/benchmark/search/aggregations/SubAggregationSearchCollectModeBenchmark.java
src/test/java/org/elasticsearch/benchmark/search/aggregations/TermsAggregationSearchBenchmark.java
src/test/java/org/elasticsearch/index/fielddata/DisabledFieldDataFormatTests.java
src/test/java/org/elasticsearch/search/aggregations/AggregationCollectorTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/LongTermsTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/NaNSortingTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/TopHitsTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorTest.java
comments:
Aggs: Refactor aggregations to use lucene5-style collectors.

Aggregators now return a new collector instance per segment, like Lucene 5 does
with its oal.search.Collector API. This is important for us because things like
knowing whether the field is single or multi-valued is only known at a segment
level.

In order to do that I had to change aggregators to notify their sub aggregators
of new incoming segments (pretty much in the spirit of #6477) while everything
used to be centralized in the AggregationContext class. While this might slow
down a bit deeply nested aggregation trees, this also makes the children
aggregation and the `breadth_first` collection mode much better options since
they can now only replay what they need while they used to have to replay the
whole aggregation tree.

I also took advantage of this big refactoring to remove some abstractions that
were not really required like ValuesSource.MetaData or BucketAnalysisCollector.
I also splitted Aggregator into Aggregator and AggregatorBase in order to
separate the Aggregator API from implementation helpers.

Close #9544

time:
2015-02-12T12:09:16Z
class:
comments:
Update update-settings.asciidoc

Updating to the fields as mentioned on http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/index-modules-fielddata.html

Closes #9657

time:
2015-02-12T11:46:44Z
class:
comments:
Docs: Fixed explanation of how the query string query is rewritten

time:
2015-02-12T11:25:17Z
class:
src/test/java/org/elasticsearch/test/rest/spec/RestSpec.java
comments:
[TEST] Introduce basic validation of our REST spec

Whenever we have an api that supports GET with a body, we always support the POST method too, as well as providing the body as a query_string parameter called `source`. Our REST spec should reflect this convention. FIxed them and introduced a hard check at parse time in our Java REST tests runner, which will cause the tests to fail if spec are not compliant.

Closes #9629

time:
2015-02-12T11:10:11Z
class:
comments:
Update core-types.asciidoc

Provide an example of how to disable norms

Closes #9641

time:
2015-02-12T10:36:47Z
class:
src/main/java/org/elasticsearch/common/cli/CheckFileCommand.java
comments:
CliTool: CheckFileCommand checks for file existence

As a CliTool command could potentially also delete files, the
CheckFileCommand needs to check if those files exist, before
trying to get permissions/owners/groups from that path.

time:
2015-02-12T09:10:11Z
class:
src/main/java/org/elasticsearch/common/cli/CheckFileCommand.java
src/main/java/org/elasticsearch/common/cli/Terminal.java
src/test/java/org/elasticsearch/common/cli/CheckFileCommandTests.java
comments:
CliTool: Add command to warn on permission/owner change

When using the CLI tool infrastructure, a command can potentially write
a new file. In case it overwrites an existing one, you may want to ensure
that the permissions, the owner and the group are kept the same and do not
accidentally change when overwriting those files.

This PR introduces a command that allows you to execute this check per path.

It also adds a new testing dependency, namely jimfs, which allows you to create
in-memory filesystems with certain properties (like supporting or not posix permissions
on this filesystem), so that you can test those features, without executing
tests on a certain operating system.

time:
2015-02-12T09:08:14Z
class:
src/main/java/org/elasticsearch/common/io/FileSystemUtils.java
src/test/java/org/elasticsearch/common/io/FileSystemUtilsTests.java
src/test/java/org/elasticsearch/test/hamcrest/ElasticsearchAssertions.java
comments:
FileSystemUtils: Only create backup copies if files differ

The FileSystemUtils class has a helper method to create files with
a .new suffix, in case the file, which should be created already
exists. If you install plugins and those have configuration files,
even without changes, you will end up with tons of .new files.

This commit checks the file size and sha-256 sum, and only if those
differ, a .new file is actually being created.

time:
2015-02-12T09:01:13Z
class:
comments:
Fix version number for elasticsearch < 1.3.5

Related to #26

time:
2015-02-12T08:53:28Z
class:
comments:
update documentation with release 2.3.1

time:
2015-02-12T00:11:00Z
class:
src/test/java/org/elasticsearch/cluster/ClusterServiceTests.java
comments:
Test: wait for the cluster to recover in ClusterServiceTests before waiting for update state task results

On CI machines node recovery sometimes takes up to 2 seconds. When it happens an update cluster state task gets stuck behind the recovery and tests fail with 1 second timeout. This commit makes sure that we wait for recovery to complete before starting the clock.

time:
2015-02-11T22:22:02Z
class:
comments:
update documentation with release 2.4.2

time:
2015-02-11T22:13:56Z
class:
src/test/java/org/elasticsearch/plugin/mapper/attachments/test/SimpleAttachmentIntegrationTests.java
comments:
[Doc] copy_to using attachment field type

If you want to use [copy_to](http://www.elasticsearch.org/guide/en/elasticsearch/reference/current/mapping-core-types.html#copy-to)
feature, you need to define it on each sub-field you want to copy to another field:

```javascript
PUT /test/person/_mapping
{
  "person": {
    "properties": {
      "file": {
        "type": "attachment",
        "path": "full",
        "fields": {
          "file": {
            "type": "string",
            "copy_to": "copy"
          }
        }
      },
      "copy": {
        "type": "string"
      }
    }
  }
}
```

In this example, the extracted content will be copy as well to `copy` field.

Closes #97.
(cherry picked from commit f4f6b57)
(cherry picked from commit 5878a62)

time:
2015-02-11T20:51:37Z
class:
comments:
update documentation with release 2.4.2

time:
2015-02-11T20:49:29Z
class:
comments:
update documentation with release 2.4.2

time:
2015-02-11T20:47:47Z
class:
comments:
update documentation with release 2.4.2

time:
2015-02-11T20:47:45Z
class:
comments:
update documentation with release 2.4.3

time:
2015-02-11T20:40:42Z
class:
comments:
update documentation with release 2.4.2

time:
2015-02-11T19:30:27Z
class:
src/main/java/org/elasticsearch/action/admin/indices/optimize/OptimizeRequest.java
src/main/java/org/elasticsearch/action/admin/indices/optimize/OptimizeRequestBuilder.java
src/main/java/org/elasticsearch/index/engine/Engine.java
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/main/java/org/elasticsearch/rest/action/admin/indices/optimize/RestOptimizeAction.java
src/main/java/org/elasticsearch/rest/action/admin/indices/upgrade/RestUpgradeAction.java
src/test/java/org/elasticsearch/gateway/RecoveryFromGatewayTests.java
src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
src/test/java/org/elasticsearch/indices/settings/UpdateSettingsTests.java
src/test/java/org/elasticsearch/indices/stats/IndexStatsTests.java
src/test/java/org/elasticsearch/rest/action/admin/indices/upgrade/UpgradeTest.java
src/test/java/org/elasticsearch/search/child/SimpleChildQuerySearchTests.java
src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreTests.java
src/test/java/org/elasticsearch/snapshots/SnapshotBackwardsCompatibilityTest.java
comments:
Core: Remove ability to run optimize and upgrade async

This has been very trappy. Rather than continue to allow buggy behavior
of having upgrade/optimize requests sidestep the single shard per node
limits optimize is supposed to be subject to, this removes
the ability to run the upgrade/optimize async.

closes #9638

time:
2015-02-11T18:25:10Z
class:
comments:
Updated latest version in docs

time:
2015-02-11T17:02:01Z
class:
src/main/java/org/elasticsearch/Version.java
comments:
Added 1.3.9-SNAPSHOT and 1.4.4-SNAPSHOT versions

time:
2015-02-11T16:54:53Z
class:
comments:
Docs: Added note about groovy sandbox vulnerability to modules/scripting

time:
2015-02-11T16:54:53Z
class:
comments:
Updated doc annotations for 1.4.3

time:
2015-02-11T16:17:41Z
class:
src/main/java/org/elasticsearch/index/mapper/attachment/AttachmentMapper.java
comments:
Upgrade Tika to 1.7

Closes #94.
(cherry picked from commit 0ab38f3)
(cherry picked from commit 96c7bb1)

time:
2015-02-11T15:07:40Z
class:
comments:
Tests: Add forgotten files for static bwc tests

time:
2015-02-11T15:06:17Z
class:
src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityTests.java
comments:
Tests: Add static bwc tests for new releases 1.3.8 and 1.4.3

time:
2015-02-11T14:58:39Z
class:
src/main/java/org/elasticsearch/Version.java
comments:
Marked 1.4.3 as released

time:
2015-02-11T12:21:43Z
class:
src/main/java/org/elasticsearch/script/groovy/GroovyScriptEngineService.java
src/test/java/org/elasticsearch/env/NodeEnvironmentTests.java
src/test/java/org/elasticsearch/script/GroovySandboxScriptTests.java
src/test/java/org/elasticsearch/script/GroovyScriptTests.java
src/test/java/org/elasticsearch/test/ElasticsearchSingleNodeTest.java
comments:
[TEST] make sandbox settings explicit in Tests

time:
2015-02-11T12:17:44Z
class:
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
comments:
[ENGINE] Fix deadlock problems when API flush and finish recovery happens concurrently

Unfortunately the lock order is important in the current flush codehe. We have to acquire the readlock fist otherwise
if we are flushing at the end of the recovery while holding the write lock we can deadlock if:
 * Thread 1: flushes via API and gets the flush lock but blocks on the readlock since Thread 2 has the writeLock
 * Thread 2: flushes at the end of the recovery holding the writeLock and blocks on the flushLock owned by Thread 2

This commit acquires the read lock first which would be done further down anyway for the time of the flush.
As a sideeffect we can now safely flush on calling close() while holding the writeLock.

time:
2015-02-11T08:05:20Z
class:
src/main/java/org/elasticsearch/cluster/action/index/NodeIndexDeletedAction.java
src/main/java/org/elasticsearch/gateway/GatewayMetaState.java
src/main/java/org/elasticsearch/index/IndexService.java
src/main/java/org/elasticsearch/index/store/IndexStore.java
src/main/java/org/elasticsearch/index/store/support/AbstractIndexStore.java
src/main/java/org/elasticsearch/indices/IndicesModule.java
src/main/java/org/elasticsearch/indices/IndicesService.java
src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
src/main/java/org/elasticsearch/indices/store/IndicesStore.java
src/test/java/org/elasticsearch/indices/IndicesServiceTest.java
src/test/java/org/elasticsearch/indices/store/IndicesStoreTests.java
comments:
[CORE] Consolidate index / shard deletion in IndicesService

Today the logic related to deleting an index is spread across several
classes which makes changes to this rather delicate part of the code-base
very difficult. This commit consolidates this logic into the IndicesService
and moves the handling of ack-ing the delete to the master entirely into
`IndicesClusterStateService`.

time:
2015-02-11T08:05:18Z
class:
src/test/java/org/elasticsearch/transport/netty/NettyTransportMultiPortTests.java
comments:
[TEST] Make tests pass while flying

time:
2015-02-11T00:59:51Z
class:
src/test/java/org/elasticsearch/search/sort/SimpleSortTests.java
comments:
Test: testSortMinValueScript - use unmappedType to handle slow propagation of mapping

time:
2015-02-10T21:53:04Z
class:
src/main/java/org/elasticsearch/rest/action/percolate/RestPercolateAction.java
comments:
Percolate api: support encoded body as query string param consistently

The percolate api doesn't parse the encoded body provided as `source` query string parameter, when percolating an existing document. Fixed and added REST test that would have caught this since we randomly use GET + encoded `source` param instead of GET + request body in our java runner (the perl runner does the same too).

Closes #9628

time:
2015-02-10T18:53:44Z
class:
src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/IdFieldMapper.java
src/main/java/org/elasticsearch/index/mapper/internal/RoutingFieldMapper.java
src/test/java/org/elasticsearch/document/BulkTests.java
src/test/java/org/elasticsearch/index/mapper/id/IdMappingTests.java
src/test/java/org/elasticsearch/index/mapper/routing/RoutingTypeMapperTests.java
src/test/java/org/elasticsearch/routing/SimpleRoutingTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsTests.java
src/test/java/org/elasticsearch/search/aggregations/bucket/TermsDocCountErrorTests.java
src/test/java/org/elasticsearch/search/query/SearchQueryTests.java
comments:
Mappings: Remove ability to set path for _id and _routing on 2.0+ indexes

_id and _routing now no longer support the 'path' setting on indexes
created with 2.0.  Indexes created before 2.0 still support this
setting for backcompat.

closes #6730

time:
2015-02-10T18:00:40Z
class:
src/main/java/org/elasticsearch/common/util/concurrent/PrioritizedEsThreadPoolExecutor.java
src/main/java/org/elasticsearch/threadpool/ThreadPool.java
src/test/java/org/elasticsearch/common/util/concurrent/PrioritizedExecutorsTests.java
comments:
Internal: promptly cleanup updateTask timeout handler

Improve cleanup of updateTask timeout handlers. The timeout handlers should be removed as soon as a corresponding update task is processed. Otherwise, timeout handlers might keep old updateTasks and all objects that they are pointing to in memory for the duration of timeout (15 minutes by default).

Fixes #9621

time:
2015-02-10T13:23:00Z
class:
src/main/java/org/elasticsearch/common/geo/XShapeCollection.java
comments:
[GEO] Updating javadoc for XShapeCollection

XShapeCollection has an incorrect description left over from when the relate method was overridden. This one line commit corrects the description.

time:
2015-02-10T11:59:12Z
class:
src/main/java/org/elasticsearch/index/engine/Engine.java
src/main/java/org/elasticsearch/index/engine/EngineConfig.java
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/test/java/org/elasticsearch/index/engine/InternalEngineSettingsTest.java
src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
src/test/java/org/elasticsearch/indices/memory/IndexingMemoryControllerTests.java
comments:
[ENGINE] Factor out settings updates from Engine

The engine is already pretty complex, it's still confulated with
code that doesn't necessarily belong there. Updateing the settings from
the settings service can be done on the level above. This commit cleans up
the settings code in the engine and moves it to the IndexShard.

time:
2015-02-09T23:40:05Z
class:
src/main/java/org/elasticsearch/common/geo/XShapeCollection.java
src/main/java/org/elasticsearch/common/geo/builders/GeometryCollectionBuilder.java
src/main/java/org/elasticsearch/common/geo/builders/MultiPointBuilder.java
src/main/java/org/elasticsearch/common/geo/builders/MultiPolygonBuilder.java
comments:
[GEO] Correct bounding box logic for GeometryCollection type

"The OpenGIS Abstract Specification: An Object Model for Interoperable Geoprocessing" published by the OGC defines "The boundary of a geometric object is a set of geometric objects of the next lower dimension." The bounding box of a GeometryCollection is therefore the set of bounding rectangles derived from the geometric objects of the next lower dimension. This commit updates the computeBoundingBox and relate methods for the ShapeCollection base class to correctly determine the prefixTree detail level used in Lucene's FilterCellIterator.

closes #9360

time:
2015-02-09T22:21:53Z
class:
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
src/main/java/org/elasticsearch/index/shard/IndexShard.java
src/test/java/org/elasticsearch/search/basic/SearchWithRandomExceptionsTests.java
comments:
[ENGINE] Close Engine immediately if a tragic event strikes.

Until lately we couldn't close the engine in a tragic event due to
some the lock order and all it's complications. Now that the engine
is much more simplified in terms of having a single IndexWriter etc.
we don't necessarily need the write-lock on close anymore and can
easily just close and continue.

time:
2015-02-09T20:28:55Z
class:
src/main/java/org/elasticsearch/common/util/concurrent/ReleasableLock.java
src/main/java/org/elasticsearch/index/engine/DeleteVersionValue.java
src/main/java/org/elasticsearch/index/engine/Engine.java
src/main/java/org/elasticsearch/index/engine/EngineSearcher.java
src/main/java/org/elasticsearch/index/engine/EngineSearcherFactory.java
src/main/java/org/elasticsearch/index/engine/FlushingRecoveryCounter.java
src/main/java/org/elasticsearch/index/engine/InternalEngine.java
src/main/java/org/elasticsearch/index/engine/InternalEngineFactory.java
src/main/java/org/elasticsearch/index/engine/LiveVersionMap.java
src/main/java/org/elasticsearch/index/engine/RecoveryCounter.java
src/main/java/org/elasticsearch/index/engine/VersionValue.java
src/main/java/org/elasticsearch/index/shard/IndexShardModule.java
src/main/java/org/elasticsearch/index/snapshots/IndexShardRepository.java
src/main/java/org/elasticsearch/percolator/MultiDocumentPercolatorIndex.java
src/main/java/org/elasticsearch/percolator/SingleDocumentPercolatorIndex.java
src/test/java/org/elasticsearch/cluster/routing/allocation/CatAllocationTestBase.java
src/test/java/org/elasticsearch/index/engine/InternalEngineIntegrationTest.java
src/test/java/org/elasticsearch/index/engine/InternalEngineMergeTests.java
src/test/java/org/elasticsearch/index/engine/InternalEngineSettingsTest.java
src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
src/test/java/org/elasticsearch/index/search/child/ChildrenConstantScoreQueryTests.java
src/test/java/org/elasticsearch/index/search/child/ChildrenQueryTests.java
src/test/java/org/elasticsearch/index/search/child/ParentConstantScoreQueryTests.java
src/test/java/org/elasticsearch/index/search/child/ParentQueryTests.java
src/test/java/org/elasticsearch/test/engine/MockInternalEngine.java
comments:
[CORE] Refactor InternalEngine into AbstractEngine and classes

InternalEngine contains a number of inner classes that it uses, however,
this makes the class overly large and hard to extend. In order to be
able to easily add other Engines (such as the ShadowEngine), these
helping methods have been extracted into an AbstractEngine class. The
classes that were previously in `InternalEngine` have been moved to
separate classes, which will allow for better unit testing as well.

None of the functionality of InternalEngine has been changed, this is
only refactoring.

Note that this is a change I originally made on my shadow-replica
branch, however it is easier to review piecemeal so I extracted it into
a separate PR.

time:
2015-02-09T17:51:48Z
class:
src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreTests.java
comments:
Test: add wait for nodes to restorePersistentSettingsTest

Sometimes by the time update settings is called the second node is not in the cluster yet. As a result change of minimum master node settings to 2 is ignored making this test to fail.

time:
2015-02-09T16:45:07Z
class:
comments:
[test] Add standalone runner

It could be sometime useful to have a stand alone runner to see how exactly Tika extracts content from a given file.

You can run `StandaloneRunner` class using:

*  `-u file://URL/TO/YOUR/DOC`
*  `--size` set extracted size (default to mapper attachment size)
*  `BASE64` encoded binary

Example:

```sh
StandaloneRunner BASE64Text
StandaloneRunner -u /tmp/mydoc.pdf
StandaloneRunner -u /tmp/mydoc.pdf --size 1000000
```

It produces something like:

```
## Extracted text
--------------------- BEGIN -----------------------
This is the extracted text
---------------------- END ------------------------
## Metadata
- author: null
- content_length: null
- content_type: application/pdf
- date: null
- keywords: null
- language: null
- name: null
- title: null
```

Closes #99.
(cherry picked from commit 720b3bf)
(cherry picked from commit 990fa15)

