time:
2017-05-15T13:26:35Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/ParsedFilters.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregationsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/filters/InternalFiltersTests.java
test/framework/src/main/java/org/elasticsearch/test/InternalAggregationTestCase.java
comments:
Add parsing for InternalFilters aggregation (#24648)

This adds parsing to the InternalFilters aggregation.

time:
2017-05-15T13:14:07Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/InternalMappedSignificantTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/InternalSignificantTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantLongTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantStringTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/UnmappedSignificantTerms.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsSignificanceScoreIT.java
comments:
Make SignificantTerms.Bucket an interface rather than an abstract class (#24670)

This commit changes SignificantTerms.Bucket so that it is not an
abstract class anymore but an interface. It will be easier for the Java
High Level Rest Client to provide its own implementation of
SignificantTerms and SignificantTerms.Bucket. Also, it is now more
coherent with the others aggregations.

time:
2017-05-15T13:06:01Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/AggregationsTests.java
modules/parent-join/src/test/java/org/elasticsearch/join/aggregations/InternalChildrenTests.java
test/framework/src/main/java/org/elasticsearch/test/InternalAggregationTestCase.java
comments:
Small improvement in InternalAggregationTestCase test setup after changes in master (#24675)

time:
2017-05-15T11:47:42Z
class:
core/src/test/java/org/elasticsearch/discovery/AbstractDisruptionTestCase.java
core/src/test/java/org/elasticsearch/discovery/ClusterDisruptionIT.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryDisruptionIT.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/discovery/MasterDisruptionIT.java
test/framework/src/main/java/org/elasticsearch/test/disruption/NetworkDisruption.java
test/framework/src/test/java/org/elasticsearch/test/disruption/NetworkDisruptionIT.java
comments:
Split disruption test suite

The disruption tests sit in a single test suite which causes these tests
to be single-threaded. We can split this test suite into multiple suites
(logically, of course) enabling them to be run in parallel reducing the
total run time of all integration tests in core. This commit splits the
discovery with service disruptions test suite into three suites
 - master disruptions
 - discovery disruptions
 - cluster disruptions

The last one could probably be better named, it is meant to represent
performing actions in the cluster (indexing, failing a shard, etc.)
while a disruption is taking place.

Relates #24662

time:
2017-05-15T10:25:07Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java
client/transport/src/main/java/org/elasticsearch/transport/client/PreBuiltTransportClient.java
client/transport/src/test/java/org/elasticsearch/transport/client/PreBuiltTransportClientTests.java
core/src/main/java/org/elasticsearch/action/admin/cluster/repositories/get/GetRepositoriesResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/GetSnapshotsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java
core/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexResponse.java
core/src/main/java/org/elasticsearch/action/support/tasks/BaseTasksResponse.java
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java
core/src/main/java/org/elasticsearch/cluster/block/ClusterBlock.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolver.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterApplier.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterApplierService.java
core/src/main/java/org/elasticsearch/common/inject/ModulesBuilder.java
core/src/main/java/org/elasticsearch/common/inject/assistedinject/AssistedConstructor.java
core/src/main/java/org/elasticsearch/common/lucene/search/MultiPhrasePrefixQuery.java
core/src/main/java/org/elasticsearch/discovery/Discovery.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/TribeDiscovery.java
core/src/main/java/org/elasticsearch/discovery/single/SingleNodeDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenPing.java
core/src/main/java/org/elasticsearch/env/Environment.java
core/src/main/java/org/elasticsearch/gateway/Gateway.java
core/src/main/java/org/elasticsearch/gateway/GatewayService.java
core/src/main/java/org/elasticsearch/index/IndexWarmer.java
core/src/main/java/org/elasticsearch/index/analysis/CustomAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/CustomNormalizerProvider.java
core/src/main/java/org/elasticsearch/index/mapper/DynamicTemplate.java
core/src/main/java/org/elasticsearch/index/query/AbstractQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoPolygonQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java
core/src/main/java/org/elasticsearch/index/query/NestedQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryBuilders.java
core/src/main/java/org/elasticsearch/index/snapshots/blobstore/BlobStoreIndexShardSnapshots.java
core/src/main/java/org/elasticsearch/indices/breaker/HierarchyCircuitBreakerService.java
core/src/main/java/org/elasticsearch/indices/fielddata/cache/IndicesFieldDataCache.java
core/src/main/java/org/elasticsearch/node/InternalSettingsPreparer.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregationBuilders.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorFactories.java
core/src/main/java/org/elasticsearch/search/aggregations/BucketCollector.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/adjacency/AdjacencyMatrixAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/cumulativesum/CumulativeSumPipelineAggregator.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/CustomQueryScorer.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGenerator.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/main/java/org/elasticsearch/transport/Transport.java
core/src/main/java/org/elasticsearch/transport/TransportConnectionListener.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/action/bulk/BulkWithUpdatesIT.java
core/src/test/java/org/elasticsearch/aliases/IndexAliasesIT.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientNodesServiceTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolverTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/WildcardExpressionResolverTests.java
core/src/test/java/org/elasticsearch/discovery/single/SingleNodeDiscoveryIT.java
core/src/test/java/org/elasticsearch/discovery/single/SingleNodeDiscoveryTests.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/gateway/GatewayServiceTests.java
core/src/test/java/org/elasticsearch/index/query/InnerHitBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/NestedQueryBuilderTests.java
core/src/test/java/org/elasticsearch/node/InternalSettingsPreparerTests.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregationsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/filter/InternalFilterTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/global/InternalGlobalTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/missing/InternalMissingTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/InternalNestedTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/InternalReverseNestedTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/sampler/InternalSamplerTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/InnerHitsIT.java
core/src/test/java/org/elasticsearch/test/NoopDiscovery.java
core/src/test/java/org/elasticsearch/transport/TCPTransportTests.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ConvertProcessor.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/DateProcessor.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Def.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ELambda.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PSubDefCall.java
modules/parent-join/src/main/java/org/elasticsearch/join/ParentJoinPlugin.java
modules/parent-join/src/main/java/org/elasticsearch/join/aggregations/Children.java
modules/parent-join/src/main/java/org/elasticsearch/join/aggregations/ChildrenAggregationBuilder.java
modules/parent-join/src/main/java/org/elasticsearch/join/aggregations/ChildrenAggregatorFactory.java
modules/parent-join/src/main/java/org/elasticsearch/join/aggregations/InternalChildren.java
modules/parent-join/src/main/java/org/elasticsearch/join/aggregations/JoinAggregationBuilders.java
modules/parent-join/src/main/java/org/elasticsearch/join/aggregations/ParentToChildrenAggregator.java
modules/parent-join/src/main/java/org/elasticsearch/join/aggregations/ParsedChildren.java
modules/parent-join/src/main/java/org/elasticsearch/join/query/HasChildQueryBuilder.java
modules/parent-join/src/main/java/org/elasticsearch/join/query/HasParentQueryBuilder.java
modules/parent-join/src/main/java/org/elasticsearch/join/query/JoinQueryBuilders.java
modules/parent-join/src/test/java/org/elasticsearch/join/ParentChildClientYamlTestSuiteIT.java
modules/parent-join/src/test/java/org/elasticsearch/join/aggregations/ChildrenIT.java
modules/parent-join/src/test/java/org/elasticsearch/join/aggregations/ChildrenTests.java
modules/parent-join/src/test/java/org/elasticsearch/join/aggregations/InternalChildrenTests.java
modules/parent-join/src/test/java/org/elasticsearch/join/aggregations/ParentToChildrenAggregatorTests.java
modules/parent-join/src/test/java/org/elasticsearch/join/query/ChildQuerySearchIT.java
modules/parent-join/src/test/java/org/elasticsearch/join/query/HasChildQueryBuilderTests.java
modules/parent-join/src/test/java/org/elasticsearch/join/query/HasParentQueryBuilderTests.java
modules/parent-join/src/test/java/org/elasticsearch/join/query/InnerHitsIT.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolatorFieldMapper.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorFieldMapperTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexParentChildTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4InternalESLogger.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java
plugins/repository-gcs/src/main/java/org/elasticsearch/repositories/gcs/GoogleCloudStorageBlobStore.java
qa/smoke-test-reindex-with-all-modules/src/test/java/org/elasticsearch/smoketest/SmokeTestReindexWithPainlessClientYamlTestSuiteIT.java
test/framework/src/main/java/org/elasticsearch/bootstrap/BootstrapForTesting.java
test/framework/src/main/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
test/framework/src/main/java/org/elasticsearch/search/aggregations/BaseAggregationTestCase.java
test/framework/src/main/java/org/elasticsearch/search/aggregations/InternalSingleBucketAggregationTestCase.java
test/framework/src/main/java/org/elasticsearch/test/InternalAggregationTestCase.java
test/framework/src/main/java/org/elasticsearch/test/discovery/MockZenPing.java
test/framework/src/main/java/org/elasticsearch/test/discovery/TestZenDiscovery.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestExecutionContext.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
comments:
Merge branch 'master' into feature/client_aggs_parsing

 Conflicts:
	core/src/test/java/org/elasticsearch/search/aggregations/bucket/filter/InternalFilterTests.java
	core/src/test/java/org/elasticsearch/search/aggregations/bucket/global/InternalGlobalTests.java
	core/src/test/java/org/elasticsearch/search/aggregations/bucket/missing/InternalMissingTests.java
	core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/InternalNestedTests.java
	core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/InternalReverseNestedTests.java
	core/src/test/java/org/elasticsearch/search/aggregations/bucket/sampler/InternalSamplerTests.java
	modules/parent-join/src/test/java/org/elasticsearch/join/aggregations/InternalChildrenTests.java
	test/framework/src/main/java/org/elasticsearch/search/aggregations/InternalSingleBucketAggregationTestCase.java

time:
2017-05-15T09:49:47Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/InternalSampler.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/ParsedSampler.java
test/framework/src/main/java/org/elasticsearch/test/InternalAggregationTestCase.java
comments:
Revert changing the InternalSampler type constant (#24667)

time:
2017-05-15T09:26:51Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolver.java
core/src/test/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolverTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/WildcardExpressionResolverTests.java
comments:
Deprecate use of + in index names (#24585)

Use of '+' in index names is implicit. There is no need to support it. This commit deprecates support for it.

Closes #24515

time:
2017-05-15T09:01:35Z
class:
comments:
Mute packagingTest on CentOS 6

Relates #24645

time:
2017-05-15T07:35:48Z
class:
core/src/main/java/org/elasticsearch/common/inject/ModulesBuilder.java
core/src/main/java/org/elasticsearch/common/lucene/search/MultiPhrasePrefixQuery.java
core/src/main/java/org/elasticsearch/index/IndexWarmer.java
core/src/main/java/org/elasticsearch/indices/fielddata/cache/IndicesFieldDataCache.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGenerator.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PSubDefCall.java
comments:
Replace manual copying an array or collection with static methods calls (#24657)

time:
2017-05-15T00:45:04Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/env/Environment.java
core/src/main/java/org/elasticsearch/node/InternalSettingsPreparer.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapTests.java
core/src/test/java/org/elasticsearch/node/InternalSettingsPreparerTests.java
comments:
Settings: Remove support for yaml and json config files (#24664)

This commit removes the deprecated support for .yaml and .json files. If
the files still exist, the node will fail to start, indicating the file
must be converted or renamed.

closes #19391

time:
2017-05-15T00:40:50Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapTests.java
comments:
Settings: Update settings deprecation from yml to yaml (#24663)

This converts the deprecation added for 5.5 from .yml to .yaml. Note
that this deprecation has not been released yet.

relates #19391

time:
2017-05-12T20:09:52Z
class:
comments:
Clarify disabling swap in docs

Our strong recommendation is disabling swap over any other alternative
to avoid the JVM from landing on disk. This commit clarifies the docs in
this regard.

time:
2017-05-12T20:05:13Z
class:
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4InternalESLogger.java
comments:
Remove Netty logging hack (#24653)

Netty removed a logging guarded we added to prevent a scary logging
message. We added a hack to work around this. They've added the guard
back, so we can remove the hack now.

time:
2017-05-12T19:53:51Z
class:
comments:
Upgrade to Netty 4.1.11.Final

This commit upgrades the Netty dependency from 4.1.10.Final to
4.1.11.Final.

Relates #24652

time:
2017-05-12T19:11:21Z
class:
comments:
Fix msearch rest test using typed_keys

time:
2017-05-12T15:25:34Z
class:
client/transport/src/main/java/org/elasticsearch/transport/client/PreBuiltTransportClient.java
client/transport/src/test/java/org/elasticsearch/transport/client/PreBuiltTransportClientTests.java
comments:
#24638 Add the parent-join plugin in the prebuilt transport client by default

time:
2017-05-12T15:03:26Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java
comments:
[Tests] #24638 Fix rest high level client docs build by restoring hasChild and hasParent in the tests
I wonder if this should actually be a regular `compile` dependency so that users of the high level rest client can use those queries. @javanna, what do you think?
I am confused by this commit. Does the testCompile change have to do with `QueryDSLDocumentationTests`? cause the high level client doesn't support search yet, so I don't see how we would be testing that :) I think that `QueryDSLDocumentationTests` uses the transport client to send requests and test docs snippets?

That said, users of the high level client should have this by default, I agree with you @nik9000 
> I think that QueryDSLDocumentationTests uses the transport client to send requests and test docs snippets?

It doesn't send the requests at all, just build them. They were originally for testing building the queries with the transport client but they looked like they could work for the high level rest client so I bounced them into the rest client's tests assuming we'd clean them up some more once the rest client supported it.
alright, thanks for the explanation! I still agree with you! :)

time:
2017-05-12T14:52:47Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/ParsedMultiBucketAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/ParsedRange.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/date/ParsedDateRange.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/ParsedGeoDistance.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregationsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalMultiBucketAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/InternalRangeTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/InternalRangeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/date/InternalDateRangeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/InternalGeoDistanceTests.java
test/framework/src/main/java/org/elasticsearch/test/InternalAggregationTestCase.java
comments:
Add parsing methods to Range aggregations (#24583)

time:
2017-05-12T14:38:50Z
class:
core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientNodesServiceTests.java
comments:
SniffNodesSampler should close connection after handling responses (#24632)

With the current implementation, SniffNodesSampler might close the
current connection right after a request is sent but before the response
is correctly handled. This causes to timeouts in the transport client
when the sniffing is activated.

closes #24575
closes #24557

time:
2017-05-12T14:36:13Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/repositories/get/GetRepositoriesResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/GetSnapshotsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java
core/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexResponse.java
core/src/main/java/org/elasticsearch/action/support/tasks/BaseTasksResponse.java
core/src/main/java/org/elasticsearch/cluster/block/ClusterBlock.java
core/src/main/java/org/elasticsearch/common/inject/assistedinject/AssistedConstructor.java
core/src/main/java/org/elasticsearch/index/analysis/CustomAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/analysis/CustomNormalizerProvider.java
core/src/main/java/org/elasticsearch/index/mapper/DynamicTemplate.java
core/src/main/java/org/elasticsearch/index/query/AbstractQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoPolygonQueryBuilder.java
core/src/main/java/org/elasticsearch/index/snapshots/blobstore/BlobStoreIndexShardSnapshots.java
core/src/main/java/org/elasticsearch/indices/breaker/HierarchyCircuitBreakerService.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorFactories.java
core/src/main/java/org/elasticsearch/search/aggregations/BucketCollector.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/adjacency/AdjacencyMatrixAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/cumulativesum/CumulativeSumPipelineAggregator.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ConvertProcessor.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/DateProcessor.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Def.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ELambda.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java
plugins/repository-gcs/src/main/java/org/elasticsearch/repositories/gcs/GoogleCloudStorageBlobStore.java
test/framework/src/main/java/org/elasticsearch/bootstrap/BootstrapForTesting.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestExecutionContext.java
comments:
Size lists in advance when known

When constructing an array list, if we know the size of the list in
advance (because we are adding objects to it derived from another list),
we should size the array list to the appropriate capacity in advance (to
avoid resizing allocations). This commit does this in various places.

Relates #24439

time:
2017-05-12T14:32:29Z
class:
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
comments:
Call onClose listener in a finally block

time:
2017-05-12T13:58:06Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java
core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java
core/src/main/java/org/elasticsearch/index/query/NestedQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryBuilders.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregationBuilders.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/CustomQueryScorer.java
core/src/test/java/org/elasticsearch/action/bulk/BulkWithUpdatesIT.java
core/src/test/java/org/elasticsearch/aliases/IndexAliasesIT.java
core/src/test/java/org/elasticsearch/index/query/InnerHitBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/NestedQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/filter/InternalFilterTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/global/InternalGlobalTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/missing/InternalMissingTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/InternalNestedTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/InternalReverseNestedTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/sampler/InternalSamplerTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/InnerHitsIT.java
modules/parent-join/src/main/java/org/elasticsearch/join/ParentJoinPlugin.java
modules/parent-join/src/main/java/org/elasticsearch/join/aggregations/Children.java
modules/parent-join/src/main/java/org/elasticsearch/join/aggregations/ChildrenAggregationBuilder.java
modules/parent-join/src/main/java/org/elasticsearch/join/aggregations/ChildrenAggregatorFactory.java
modules/parent-join/src/main/java/org/elasticsearch/join/aggregations/InternalChildren.java
modules/parent-join/src/main/java/org/elasticsearch/join/aggregations/JoinAggregationBuilders.java
modules/parent-join/src/main/java/org/elasticsearch/join/aggregations/ParentToChildrenAggregator.java
modules/parent-join/src/main/java/org/elasticsearch/join/query/HasChildQueryBuilder.java
modules/parent-join/src/main/java/org/elasticsearch/join/query/HasParentQueryBuilder.java
modules/parent-join/src/main/java/org/elasticsearch/join/query/JoinQueryBuilders.java
modules/parent-join/src/test/java/org/elasticsearch/join/ParentChildClientYamlTestSuiteIT.java
modules/parent-join/src/test/java/org/elasticsearch/join/aggregations/ChildrenIT.java
modules/parent-join/src/test/java/org/elasticsearch/join/aggregations/ChildrenTests.java
modules/parent-join/src/test/java/org/elasticsearch/join/aggregations/InternalChildrenTests.java
modules/parent-join/src/test/java/org/elasticsearch/join/aggregations/ParentToChildrenAggregatorTests.java
modules/parent-join/src/test/java/org/elasticsearch/join/query/ChildQuerySearchIT.java
modules/parent-join/src/test/java/org/elasticsearch/join/query/HasChildQueryBuilderTests.java
modules/parent-join/src/test/java/org/elasticsearch/join/query/HasParentQueryBuilderTests.java
modules/parent-join/src/test/java/org/elasticsearch/join/query/InnerHitsIT.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolatorFieldMapper.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorFieldMapperTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexParentChildTests.java
qa/smoke-test-reindex-with-all-modules/src/test/java/org/elasticsearch/smoketest/SmokeTestReindexWithPainlessClientYamlTestSuiteIT.java
test/framework/src/main/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
test/framework/src/main/java/org/elasticsearch/search/aggregations/BaseAggregationTestCase.java
test/framework/src/main/java/org/elasticsearch/search/aggregations/InternalSingleBucketAggregationTestCase.java
comments:
Add parent-join module (#24638)

* Add parent-join module

This change adds a new module named `parent-join`.
The goal of this module is to provide a replacement for the `_parent` field but as a first step this change only moves the `has_child`, `has_parent` queries and the `children` aggregation to this module.
These queries and aggregations are no longer in core but they are deployed by default as a module.

Relates #20257

time:
2017-05-12T13:44:39Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/ParsedGeoHashGrid.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregationsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/geogrid/InternalGeoHashGridTests.java
test/framework/src/main/java/org/elasticsearch/test/InternalAggregationTestCase.java
comments:
Add parsing method to GeoHashGrid aggregation (#24589)

time:
2017-05-12T13:40:40Z
class:
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/main/java/org/elasticsearch/transport/Transport.java
core/src/main/java/org/elasticsearch/transport/TransportConnectionListener.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/transport/TCPTransportTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
comments:
Notify onConnectionClosed rather than onNodeDisconnect to prune transport handlers (#24639)

Today we prune transport handlers in TransportService when a node is disconnected.
This can cause connections to starve in the TransportService if the connection is
opened as a short living connection ie. without sharing the connection to a node
via registering in the transport itself. This change now moves to pruning based
on the connections cache key to ensure we notify handlers as soon as the connection
is closed for all connections not just for registered connections.

Relates to #24632
Relates to #24575
Relates to #24557

time:
2017-05-12T12:08:14Z
class:
core/src/main/java/org/elasticsearch/cluster/service/ClusterApplier.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterApplierService.java
core/src/main/java/org/elasticsearch/discovery/Discovery.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/TribeDiscovery.java
core/src/main/java/org/elasticsearch/discovery/single/SingleNodeDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenPing.java
core/src/main/java/org/elasticsearch/gateway/Gateway.java
core/src/main/java/org/elasticsearch/gateway/GatewayService.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/test/java/org/elasticsearch/discovery/single/SingleNodeDiscoveryIT.java
core/src/test/java/org/elasticsearch/discovery/single/SingleNodeDiscoveryTests.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/gateway/GatewayServiceTests.java
core/src/test/java/org/elasticsearch/test/NoopDiscovery.java
test/framework/src/main/java/org/elasticsearch/test/discovery/MockZenPing.java
test/framework/src/main/java/org/elasticsearch/test/discovery/TestZenDiscovery.java
comments:
Simplify Discovery interface (#24608)

- Removes clusterState, getInitialClusterState and getMinimumMasterNodes methods from Discovery interface.
- Sets PingContextProvider in ZenPing constructor
- Renames state in ZenDiscovery to committedState

time:
2017-05-12T11:58:30Z
class:
comments:
[TEST] Temporarily disable the secure fixture for hdfs tests (#24643)

This keeps failing the build so I am temporarily disabling it
until #24636 gets merged.

time:
2017-05-12T09:53:38Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/InternalFilters.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/filters/InternalFiltersTests.java
comments:
Merge branch 'master' into feature/client_aggs_parsing

time:
2017-05-12T09:48:44Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/InternalFilters.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/filters/InternalFiltersTests.java
comments:
[Tests] Add unit tests for InternalFilters (#24624)

Relates to #22278

time:
2017-05-12T08:55:05Z
class:
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java
core/src/main/java/org/elasticsearch/common/geo/builders/ShapeBuilder.java
core/src/main/java/org/elasticsearch/common/settings/SecureSetting.java
core/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java
core/src/main/java/org/elasticsearch/env/Environment.java
core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java
core/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByScrollRequest.java
core/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByScrollRequestBuilder.java
core/src/main/java/org/elasticsearch/index/reindex/AbstractBulkIndexByScrollRequest.java
core/src/main/java/org/elasticsearch/index/reindex/AbstractBulkIndexByScrollRequestBuilder.java
core/src/main/java/org/elasticsearch/index/reindex/BulkByScrollResponse.java
core/src/main/java/org/elasticsearch/index/reindex/BulkByScrollTask.java
core/src/main/java/org/elasticsearch/index/reindex/ClientScrollableHitSource.java
core/src/main/java/org/elasticsearch/index/reindex/DeleteByQueryAction.java
core/src/main/java/org/elasticsearch/index/reindex/DeleteByQueryRequest.java
core/src/main/java/org/elasticsearch/index/reindex/DeleteByQueryRequestBuilder.java
core/src/main/java/org/elasticsearch/index/reindex/ParentBulkByScrollTask.java
core/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java
core/src/main/java/org/elasticsearch/index/reindex/ReindexRequestBuilder.java
core/src/main/java/org/elasticsearch/index/reindex/RemoteInfo.java
core/src/main/java/org/elasticsearch/index/reindex/ScrollableHitSource.java
core/src/main/java/org/elasticsearch/index/reindex/SuccessfullyProcessed.java
core/src/main/java/org/elasticsearch/index/reindex/UpdateByQueryAction.java
core/src/main/java/org/elasticsearch/index/reindex/UpdateByQueryRequest.java
core/src/main/java/org/elasticsearch/index/reindex/UpdateByQueryRequestBuilder.java
core/src/main/java/org/elasticsearch/index/reindex/WorkingBulkByScrollTask.java
core/src/main/java/org/elasticsearch/index/reindex/package-info.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/index/translog/TranslogWriter.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
core/src/main/java/org/elasticsearch/node/InternalSettingsPreparer.java
core/src/main/java/org/elasticsearch/script/LeafSearchScript.java
core/src/main/java/org/elasticsearch/script/ScriptEngine.java
core/src/main/java/org/elasticsearch/search/aggregations/BucketOrder.java
core/src/main/java/org/elasticsearch/search/aggregations/InternalOrder.java
core/src/main/java/org/elasticsearch/search/aggregations/KeyComparable.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/MultiBucketsAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/Histogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalOrder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/AbstractStringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/GlobalOrdinalsStringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalMappedTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalOrder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/LongTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/LongTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/ParsedTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/StringTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/StringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/Terms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/UnmappedTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/support/AggregationPath.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/InnerHitsContext.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/InnerHitsFetchSubPhase.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGenerator.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapTests.java
core/src/test/java/org/elasticsearch/index/query/InnerHitBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/reindex/AbstractBulkByScrollRequestTestCase.java
core/src/test/java/org/elasticsearch/index/reindex/BulkByScrollResponseTests.java
core/src/test/java/org/elasticsearch/index/reindex/BulkByScrollTaskStatusTests.java
core/src/test/java/org/elasticsearch/index/reindex/BulkByScrollTaskTests.java
core/src/test/java/org/elasticsearch/index/reindex/DeleteByQueryRequestTests.java
core/src/test/java/org/elasticsearch/index/reindex/ParentBulkByScrollTaskTests.java
core/src/test/java/org/elasticsearch/index/reindex/ReindexRequestTests.java
core/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryRequestTests.java
core/src/test/java/org/elasticsearch/index/reindex/WorkingBulkByScrollTaskTests.java
core/src/test/java/org/elasticsearch/index/replication/IndexLevelReplicationTests.java
core/src/test/java/org/elasticsearch/index/seqno/GlobalCheckpointTrackerTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/node/InternalSettingsPreparerTests.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalOrderTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DiversifiedSamplerIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DoubleTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/HistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/HistogramTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/LongTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/MinDocCountIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/NaNSortingIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/ReverseNestedIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SamplerIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/ShardSizeTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/StringTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/TermsDocCountErrorIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/TermsShardMinDocCountIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/TermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogramTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogramTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/LongTermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/StringTermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/AvgIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ExtendedStatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MaxIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MinIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/StatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/SumIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/AvgBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/ExtendedStatsBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/MaxBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/MinBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/PercentilesBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/StatsBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/SumBucketIT.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MustachePlugin.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TemplateQueryBuilder.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateIT.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/TemplateQueryBuilderTests.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/LambdaBootstrap.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/WriterConstants.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBaseReindexRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByQueryRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AsyncDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/BulkByScrollParallelizationHelper.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/BulkIndexByScrollResponseContentListener.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexPlugin.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportRethrottleAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportUpdateByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuilders.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteResponseParsers.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollActionMetadataTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollActionScriptTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AsyncBulkByScrollActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/BulkByScrollParallelizationHelperTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/BulkIndexByScrollResponseMatcher.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/BulkIndexByScrollResponseTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/CancelTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/DeleteByQueryConcurrentTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexBasicTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFailureTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteBuildRestClientTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteWhitelistTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteWithAuthTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexMetadataTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexParentChildTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexScriptTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexSourceTargetValidationTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexVersioningTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RestReindexActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RethrottleTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RetryTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RoundTripTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/TransportRethrottleActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryMetadataTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryWhileModifyingTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryWithScriptTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteInfoTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuildersTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
plugins/examples/script-expert-scoring/src/main/java/org/elasticsearch/example/expertscript/ExpertScriptPlugin.java
plugins/examples/script-expert-scoring/src/test/java/org/elasticsearch/example/expertscript/ExpertScriptClientYamlTestSuiteIT.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AwsS3ServiceImplTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/RepositorySettingsCredentialsTests.java
qa/reindex-from-old/src/test/java/org/elasticsearch/smoketest/ReindexFromOldRemoteIT.java
test/fixtures/old-elasticsearch/src/main/java/oldes/OldElasticsearch.java
test/framework/src/main/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollActionTestCase.java
test/framework/src/main/java/org/elasticsearch/test/AbstractSerializingTestCase.java
test/framework/src/main/java/org/elasticsearch/test/AbstractWireSerializingTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
Merge branch 'master' into feature/client_aggs_parsing

 Conflicts:
	core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogramTests.java
	core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTermsTests.java
	core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/LongTermsTests.java
	core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/StringTermsTests.java

time:
2017-05-12T07:38:16Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java
core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java
core/src/test/java/org/elasticsearch/index/query/InnerHitBuilderTests.java
comments:
Fix Source filtering in new field collapsing feature 

Update ValueType of FetchSourceContext to OBJECT_ARRAY_BOOLEAN_OR_STRING to be in line with other source_filtering implementations

time:
2017-05-12T02:44:31Z
class:
core/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java
core/src/main/java/org/elasticsearch/common/geo/builders/ShapeBuilder.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGenerator.java
comments:
Make a few class level fields static

This commit converts some final constant instance fields to class
fields.

time:
2017-05-11T22:07:24Z
class:
comments:
Add rest test for sliced scroll (#24630)

time:
2017-05-11T21:36:03Z
class:
comments:
Disable reindex-from-old tests in windows

In windows we can't reliable git the pid so we skip the
reindex-from-remote tests from old versions of elasticsearch. This
is OK because we aren't really testing windows here anyway. It isn't
great, but should be safe.

time:
2017-05-11T20:30:06Z
class:
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuilders.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuildersTests.java
comments:
Reindex: don't duplicate _source parameter (#24629)

If the request asks for the `_source` stored field then don't
duplicate it when forcing the `_source` parameter to onto the
request for reindex-from-remote from versions before 1.0.

Closes #24628

time:
2017-05-11T20:11:18Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/env/Environment.java
core/src/main/java/org/elasticsearch/node/InternalSettingsPreparer.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapTests.java
core/src/test/java/org/elasticsearch/node/InternalSettingsPreparerTests.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
Settings: Deprecate settings in .yml and .json (#24059)

This commit adds a deprecation warning when elasticsearch.yml or
elasticsearch.json is read during startup.

relates #19391

time:
2017-05-11T19:32:31Z
class:
comments:
Skip reindex tests from old es if we can't run it

Two of the versions of Elasticsearch we need to run for these tests
can't run in Java 9 so we skip the entire test if we are running in
java 9. For now. I'd like to reenable it to run against java 8 if
there is one available, but that can wait for another time.

Relates to #24561

time:
2017-05-11T19:15:16Z
class:
core/src/main/java/org/elasticsearch/script/LeafSearchScript.java
core/src/main/java/org/elasticsearch/script/ScriptEngine.java
plugins/examples/script-expert-scoring/src/main/java/org/elasticsearch/example/expertscript/ExpertScriptPlugin.java
plugins/examples/script-expert-scoring/src/test/java/org/elasticsearch/example/expertscript/ExpertScriptClientYamlTestSuiteIT.java
comments:
Scripting: Replace advanced and native scripts with ScriptEngine docs (#24603)

This commit documents how to write a `ScriptEngine` in order to use
expert internal apis, such as using Lucene directly to find index term
statistics. These documents prepare the way to remove both native
scripts and IndexLookup.

The example java code is actually compiled and tested under a new gradle
subproject for example plugins. This change does not yet breakup
jvm-example into the new examples dir, which should be done separately.

relates #19359
relates #19966

time:
2017-05-11T19:14:23Z
class:
core/src/main/java/org/elasticsearch/common/settings/SecureSetting.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AwsS3ServiceImplTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/RepositorySettingsCredentialsTests.java
comments:
S3 Repository: Add back repository level credentials (#24609)

Specifying s3 access and secret keys inside repository settings are not
secure. However, until there is a way to dynamically update secure
settings, this is the only way to dynamically add repositories with
credentials that are not known at node startup time. This commit adds
back `access_key` and `secret_key` s3 repository settings, but protects
it with a required system property `allow_insecure_settings`.

time:
2017-05-11T18:22:30Z
class:
core/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByScrollRequest.java
core/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByScrollRequestBuilder.java
core/src/main/java/org/elasticsearch/index/reindex/AbstractBulkIndexByScrollRequest.java
core/src/main/java/org/elasticsearch/index/reindex/AbstractBulkIndexByScrollRequestBuilder.java
core/src/main/java/org/elasticsearch/index/reindex/BulkByScrollResponse.java
core/src/main/java/org/elasticsearch/index/reindex/BulkByScrollTask.java
core/src/main/java/org/elasticsearch/index/reindex/ClientScrollableHitSource.java
core/src/main/java/org/elasticsearch/index/reindex/DeleteByQueryAction.java
core/src/main/java/org/elasticsearch/index/reindex/DeleteByQueryRequest.java
core/src/main/java/org/elasticsearch/index/reindex/DeleteByQueryRequestBuilder.java
core/src/main/java/org/elasticsearch/index/reindex/ParentBulkByScrollTask.java
core/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java
core/src/main/java/org/elasticsearch/index/reindex/ReindexRequestBuilder.java
core/src/main/java/org/elasticsearch/index/reindex/RemoteInfo.java
core/src/main/java/org/elasticsearch/index/reindex/ScrollableHitSource.java
core/src/main/java/org/elasticsearch/index/reindex/SuccessfullyProcessed.java
core/src/main/java/org/elasticsearch/index/reindex/UpdateByQueryAction.java
core/src/main/java/org/elasticsearch/index/reindex/UpdateByQueryRequest.java
core/src/main/java/org/elasticsearch/index/reindex/UpdateByQueryRequestBuilder.java
core/src/main/java/org/elasticsearch/index/reindex/WorkingBulkByScrollTask.java
core/src/main/java/org/elasticsearch/index/reindex/package-info.java
core/src/test/java/org/elasticsearch/index/reindex/AbstractBulkByScrollRequestTestCase.java
core/src/test/java/org/elasticsearch/index/reindex/BulkByScrollResponseTests.java
core/src/test/java/org/elasticsearch/index/reindex/BulkByScrollTaskStatusTests.java
core/src/test/java/org/elasticsearch/index/reindex/BulkByScrollTaskTests.java
core/src/test/java/org/elasticsearch/index/reindex/DeleteByQueryRequestTests.java
core/src/test/java/org/elasticsearch/index/reindex/ParentBulkByScrollTaskTests.java
core/src/test/java/org/elasticsearch/index/reindex/ReindexRequestTests.java
core/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryRequestTests.java
core/src/test/java/org/elasticsearch/index/reindex/WorkingBulkByScrollTaskTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBaseReindexRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByQueryRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AsyncDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/BulkByScrollParallelizationHelper.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/BulkIndexByScrollResponseContentListener.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexPlugin.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportRethrottleAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportUpdateByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteResponseParsers.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollActionMetadataTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollActionScriptTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AsyncBulkByScrollActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/BulkByScrollParallelizationHelperTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/BulkIndexByScrollResponseMatcher.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/BulkIndexByScrollResponseTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/CancelTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/DeleteByQueryConcurrentTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexBasicTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFailureTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteBuildRestClientTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteWhitelistTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteWithAuthTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexMetadataTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexParentChildTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexScriptTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexSourceTargetValidationTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexVersioningTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RestReindexActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RethrottleTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RetryTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RoundTripTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/TransportRethrottleActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryMetadataTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryWhileModifyingTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryWithScriptTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteInfoTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
test/framework/src/main/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollActionTestCase.java
comments:
Move DeleteByQuery and Reindex requests into core (#24578)

This allows other plugins to use a client to call the functionality
that is in the core modules without duplicating the logic.
Plugins can now safely send the request and response classes via the
client even if the requests are executed locally. All relevant classes
are loaded by the core classloader such that plugins can share them.

This is re-adds this commit that was revered in 952feb58e41bd0220784c44136b840ea4a740e26

time:
2017-05-11T17:58:03Z
class:
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
comments:
Fix runtime class cast exception in TRA

If we fail to acquire the shard lock, need to retry and wait for the new
cluster state, we were sending the wrong kind of request for the replica
action. This commit fixes this issue.

time:
2017-05-11T17:06:26Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/BucketOrder.java
core/src/main/java/org/elasticsearch/search/aggregations/InternalOrder.java
core/src/main/java/org/elasticsearch/search/aggregations/KeyComparable.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/MultiBucketsAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/Histogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalOrder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/AbstractStringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/GlobalOrdinalsStringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalMappedTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalOrder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/LongTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/LongTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/StringTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/StringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/Terms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/UnmappedTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/support/AggregationPath.java
core/src/test/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalOrderTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DiversifiedSamplerIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DoubleTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/HistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/HistogramTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/LongTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/MinDocCountIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/NaNSortingIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/ReverseNestedIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SamplerIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/ShardSizeTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/StringTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/TermsDocCountErrorIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/TermsShardMinDocCountIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/TermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogramTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogramTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/LongTermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/StringTermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/AvgIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ExtendedStatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MaxIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MinIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/StatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/SumIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/AvgBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/ExtendedStatsBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/MaxBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/MinBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/PercentilesBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/StatsBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/SumBucketIT.java
test/framework/src/main/java/org/elasticsearch/test/AbstractSerializingTestCase.java
test/framework/src/main/java/org/elasticsearch/test/AbstractWireSerializingTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
Compound order for histogram aggregations. (#22343)

This commit adds support for histogram and date_histogram agg compound order by refactoring and reusing terms agg order code. The major change is that the Terms.Order and Histogram.Order classes have been replaced/refactored into a new class BucketOrder. This is a breaking change for the Java Transport API. For backward compatibility with previous ES versions the (date)histogram compound order will use the first order. Also the _term and _time aggregation order keys have been deprecated; replaced by _key.

Relates to #20003: now that all these aggregations use the same order code, it should be easier to move validation to parse time (as a follow up PR).

Relates to #14771: histogram and date_histogram aggregation order will now be validated at reduce time.

Closes #23613: if a single BucketOrder that is not a tie-breaker is added with the Java Transport API, it will be converted into a CompoundOrder with a tie-breaker.

time:
2017-05-11T16:26:40Z
class:
core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractAsyncBulkByScrollAction.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractBulkByScrollRequest.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractBulkByScrollRequestBuilder.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/AsyncDeleteByQueryAction.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollParallelizationHelper.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollResponse.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollTask.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/ClientScrollableHitSource.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/DeleteByQueryRequest.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/ParentBulkByScrollTask.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/ScrollableHitSource.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/SuccessfullyProcessed.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/WorkingBulkByScrollTask.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/package-info.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/AsyncBulkByScrollActionTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollParallelizationHelperTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollResponseTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollTaskStatusTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollTaskTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/DeleteByQueryRequestTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/ParentBulkByScrollTaskTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/WorkingBulkByScrollTaskTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBaseReindexRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByQueryRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkIndexByScrollRequest.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkIndexByScrollRequestBuilder.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/BulkIndexByScrollResponseContentListener.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/DeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/DeleteByQueryRequestBuilder.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexPlugin.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexRequestBuilder.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportRethrottleAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportUpdateByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/UpdateByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/UpdateByQueryRequest.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/UpdateByQueryRequestBuilder.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteInfo.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteResponseParsers.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollActionScriptTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/BulkIndexByScrollResponseTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/CancelTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/DeleteByQueryConcurrentTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexBasicTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFailureTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteBuildRestClientTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteWhitelistTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteWithAuthTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexMetadataTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexParentChildTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexRequestTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexScriptTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexSourceTargetValidationTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexVersioningTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RestReindexActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RethrottleTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RetryTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RoundTripTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/TransportRethrottleActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryMetadataTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryRequestTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryWhileModifyingTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryWithScriptTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteInfoTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
test/framework/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractAsyncBulkByScrollActionMetadataTestCase.java
test/framework/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractAsyncBulkByScrollActionTestCase.java
test/framework/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractBulkByScrollRequestTestCase.java
test/framework/src/main/java/org/elasticsearch/action/bulk/byscroll/BulkIndexByScrollResponseMatcher.java
comments:
Revert "Move DeleteByQuery and Reindex requests into core (#24578)"

This reverts commit 6ea2ae32b8b372379fe9e2fbc4365dac03747617.

time:
2017-05-11T16:10:55Z
class:
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
[TEST] Use at least 1ms for FunctionScoreQueryBuilderTests

Previously micros or nanoseconds could be used, which was reduced to 0
milliseconds and `scale` must be higher than 0.

time:
2017-05-11T16:10:27Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/LambdaBootstrap.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/WriterConstants.java
comments:
Painless: Optimize instance creation in LambdaBootstrap (#24618)

Optimize instance creation in LambdaBootstrap to allow Hotspot's escape analysis, preventing us from creating many instances stressing GC

time:
2017-05-11T15:39:33Z
class:
core/src/test/java/org/elasticsearch/index/seqno/GlobalCheckpointTrackerTests.java
comments:
Fix missing active IDs prevent advance test

This commit addresses an issue in the missing active IDs prevent advance
test from the global checkpoint tracker. The assumptions this test was
making about reality were violated when global checkpoints were inlined
(specifically, the component of that change where the tracker's
knowledge of the global checkpoint was updated inline with updates to
the tracker's knowledge of local checkpoints for an allocatio ID). The
point of the test was to ensure that a lagging shard prevents the global
checkpoint from advancing, so this commit rewrites the test with that in
mind.

time:
2017-05-11T14:41:56Z
class:
comments:
Build: move dependency so it works in 5.x

Relates to #24561

time:
2017-05-11T14:20:40Z
class:
core/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByScrollRequest.java
core/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByScrollRequestBuilder.java
core/src/main/java/org/elasticsearch/index/reindex/AbstractBulkIndexByScrollRequest.java
core/src/main/java/org/elasticsearch/index/reindex/AbstractBulkIndexByScrollRequestBuilder.java
core/src/main/java/org/elasticsearch/index/reindex/BulkByScrollResponse.java
core/src/main/java/org/elasticsearch/index/reindex/BulkByScrollTask.java
core/src/main/java/org/elasticsearch/index/reindex/ClientScrollableHitSource.java
core/src/main/java/org/elasticsearch/index/reindex/DeleteByQueryAction.java
core/src/main/java/org/elasticsearch/index/reindex/DeleteByQueryRequest.java
core/src/main/java/org/elasticsearch/index/reindex/DeleteByQueryRequestBuilder.java
core/src/main/java/org/elasticsearch/index/reindex/ParentBulkByScrollTask.java
core/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java
core/src/main/java/org/elasticsearch/index/reindex/ReindexRequestBuilder.java
core/src/main/java/org/elasticsearch/index/reindex/RemoteInfo.java
core/src/main/java/org/elasticsearch/index/reindex/ScrollableHitSource.java
core/src/main/java/org/elasticsearch/index/reindex/SuccessfullyProcessed.java
core/src/main/java/org/elasticsearch/index/reindex/UpdateByQueryAction.java
core/src/main/java/org/elasticsearch/index/reindex/UpdateByQueryRequest.java
core/src/main/java/org/elasticsearch/index/reindex/UpdateByQueryRequestBuilder.java
core/src/main/java/org/elasticsearch/index/reindex/WorkingBulkByScrollTask.java
core/src/main/java/org/elasticsearch/index/reindex/package-info.java
core/src/test/java/org/elasticsearch/index/reindex/AbstractBulkByScrollRequestTestCase.java
core/src/test/java/org/elasticsearch/index/reindex/BulkByScrollResponseTests.java
core/src/test/java/org/elasticsearch/index/reindex/BulkByScrollTaskStatusTests.java
core/src/test/java/org/elasticsearch/index/reindex/BulkByScrollTaskTests.java
core/src/test/java/org/elasticsearch/index/reindex/DeleteByQueryRequestTests.java
core/src/test/java/org/elasticsearch/index/reindex/ParentBulkByScrollTaskTests.java
core/src/test/java/org/elasticsearch/index/reindex/ReindexRequestTests.java
core/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryRequestTests.java
core/src/test/java/org/elasticsearch/index/reindex/WorkingBulkByScrollTaskTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBaseReindexRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByQueryRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AsyncDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/BulkByScrollParallelizationHelper.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/BulkIndexByScrollResponseContentListener.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexPlugin.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportRethrottleAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportUpdateByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteResponseParsers.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollActionMetadataTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollActionScriptTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AsyncBulkByScrollActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/BulkByScrollParallelizationHelperTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/BulkIndexByScrollResponseMatcher.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/BulkIndexByScrollResponseTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/CancelTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/DeleteByQueryConcurrentTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexBasicTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFailureTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteBuildRestClientTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteWhitelistTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFromRemoteWithAuthTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexMetadataTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexParentChildTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexScriptTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexSourceTargetValidationTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexVersioningTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RestReindexActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RethrottleTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RetryTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RoundTripTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/TransportRethrottleActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryMetadataTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryWhileModifyingTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryWithScriptTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteInfoTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
test/framework/src/main/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollActionTestCase.java
comments:
Move DeleteByQuery and Reindex requests into core (#24578)

This allows other plugins to use a client to call the functionality
that is in the core modules without duplicating the logic.
Plugins can now safely send the request and response classes via the
client even if the requests are executed locally. All relevant classes
are loaded by the core classloader such that plugins can share them.

time:
2017-05-11T14:06:20Z
class:
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuilders.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuildersTests.java
qa/reindex-from-old/src/test/java/org/elasticsearch/smoketest/ReindexFromOldRemoteIT.java
test/fixtures/old-elasticsearch/src/main/java/oldes/OldElasticsearch.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
Add qa module that tests reindex-from-remote against pre-5.0 versions of Elasticsearch (#24561)

Adds tests for reindex-from-remote for the latest 2.4, 1.7, and
0.90 releases. 2.4 and 1.7 are fairly popular versions but 0.90
is a point of pride.

This fixes any issues those tests revealed.

Closes #23828
Closes #24520

time:
2017-05-11T13:28:39Z
class:
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/index/translog/TranslogWriter.java
comments:
Add up-to-date javadocs on Translog#syncNeeded

time:
2017-05-11T13:13:09Z
class:
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
comments:
Fix IndexShardIT#testDurableFlagHasEffect to only test if operations have been synced

With global checkpoints we also take into account if a global checkpoint must be fsynced.
Yet, with recent addition of inlining global checkpoints into indexing operations from a
test perspective unnecessary fsyncs might be reported if `Translog#syncNeeded` is checked.
Now the test only check if the last write location triggers an fsync instead.

Closes #24600

time:
2017-05-11T12:56:45Z
class:
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MustachePlugin.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TemplateQueryBuilder.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateIT.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/TemplateQueryBuilderTests.java
comments:
Removed deprecated template query.

Relates to #19390

time:
2017-05-11T12:36:54Z
class:
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFailureTests.java
comments:
Get more information when reindex test fails

It looks like it leaks contexts but it isn't clear why so this
adds a little more logging. This is the failure:
https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+5.4+multijob-intake/94/console

time:
2017-05-11T11:25:11Z
class:
core/src/test/java/org/elasticsearch/index/replication/IndexLevelReplicationTests.java
comments:
Fix checkpoints advance test

This commit fixes an issue in the checkpoints advance test. Namely, when
there zero documents indexed, after the global checkpoint is synced, the
global checkpoint will have advanced to the no ops performed. There is a
larger conceptual problem here, namely that the primary does not update
its knowledge of its own local checkpoint upon recovery which causes the
global checkpoint to initially be unassigned and then advance to no ops
performed, but this will be addressed in a follow-up.

time:
2017-05-11T09:50:35Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/ParsedAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/ParsedSingleBucketAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/children/ParsedChildren.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/ParsedFilter.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/global/ParsedGlobal.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/missing/ParsedMissing.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/ParsedNested.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/ParsedReverseNested.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/InternalSampler.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/ParsedSampler.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregationsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/InternalSingleBucketAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/children/InternalChildrenTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/filter/InternalFilterTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/global/InternalGlobalTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/missing/InternalMissingTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/InternalNestedTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/InternalReverseNestedTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/sampler/InternalSamplerTests.java
test/framework/src/main/java/org/elasticsearch/test/InternalAggregationTestCase.java
comments:
Add parsing for single bucket aggregations (#24564)

This adds parsing to all implementations of SingleBucketAggregations. They are mostly similar, so they share the common
base class `ParsedSingleBucketAggregation` and the shared base test `InternalSingleBucketAggregationTestCase`.

time:
2017-05-11T09:48:13Z
class:
core/src/main/java/org/elasticsearch/search/fetch/subphase/InnerHitsContext.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/InnerHitsFetchSubPhase.java
comments:
inner_hits: Reuse inner hit query weight

Previously query weight was created for each search hit that needed to compute inner hits,
 with this change the weight of the inner hit query is computed once for all search hits.

Closes #23917

time:
2017-05-11T09:20:39Z
class:
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/GetSnapshotsRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/GetSnapshotsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/TransportGetSnapshotsAction.java
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java
core/src/main/java/org/elasticsearch/index/analysis/PreConfiguredTokenFilter.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java
core/src/main/java/org/elasticsearch/indices/analysis/PreBuiltTokenFilters.java
core/src/main/java/org/elasticsearch/repositories/RepositoryData.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestGetSnapshotsAction.java
core/src/main/java/org/elasticsearch/script/ScriptSettings.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotId.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotInfo.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/bwcompat/RestoreBackwardsCompatIT.java
core/src/test/java/org/elasticsearch/index/analysis/AnalysisRegistryTests.java
core/src/test/java/org/elasticsearch/index/analysis/CustomNormalizerTests.java
core/src/test/java/org/elasticsearch/index/mapper/KeywordFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/indices/analysis/AnalysisModuleTests.java
core/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsIT.java
core/src/test/java/org/elasticsearch/recovery/RelocationIT.java
core/src/test/java/org/elasticsearch/repositories/RepositoryDataTests.java
core/src/test/java/org/elasticsearch/repositories/blobstore/BlobStoreRepositoryTests.java
core/src/test/java/org/elasticsearch/script/FileScriptTests.java
core/src/test/java/org/elasticsearch/script/ScriptContextTests.java
core/src/test/java/org/elasticsearch/script/ScriptModesTests.java
core/src/test/java/org/elasticsearch/script/ScriptServiceTests.java
core/src/test/java/org/elasticsearch/script/ScriptSettingsTests.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
modules/analysis-common/src/main/java/org/elasticsearch/analysis/common/CommonAnalysisPlugin.java
modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/CommonAnalysisFactoryTests.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3ClientSettings.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3RepositoryPlugin.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AbstractS3SnapshotRestoreTest.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AwsS3ServiceImplTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3RepositoryTests.java
test/fixtures/hdfs-fixture/src/main/java/hdfs/MiniHDFS.java
test/framework/src/main/java/org/elasticsearch/indices/analysis/AnalysisFactoryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java
test/framework/src/test/java/org/elasticsearch/test/test/VersionUtilsTests.java
comments:
Merge branch 'master' into feature/client_aggs_parsing

time:
2017-05-11T09:06:55Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java
core/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsIT.java
comments:
Validates updated settings on closed indices (#24487)

We allow non-dynamic settings to be updated on closed indices but we don't
check if the updated settings can be used to open/create the index.
This can lead to unrecoverable state where the settings are updated but the index
cannot be reopened since the settings are not valid. Trying to update the invalid settings
is also not possible since the update will fail to validate the current settings.
This change adds the validation of the updated settings for closed indices and make sure that the new settings
do not prevent the reopen of the index.

Fixes #23787

time:
2017-05-11T05:52:34Z
class:
comments:
Machine Permission update on Google Compute

Machine permission can be updated without deleting instances.

Backport of #24607 in master branch

time:
2017-05-11T03:12:17Z
class:
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3ClientSettings.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3RepositoryPlugin.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AbstractS3SnapshotRestoreTest.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AwsS3ServiceImplTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3RepositoryTests.java
comments:
S3 Repository: Remove deprecated settings (#24445)

These settings are deprecated in 5.5. This change removes them for 6.0.

time:
2017-05-11T03:08:59Z
class:
core/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java
comments:
Removes completed snapshot from cluster state on master change (#24605)

Previously, if a master node updated the cluster state to reflect that a
snapshot is completed, but subsequently failed before processing a
cluster state to remove the snapshot from the cluster state, then the
newly elected master would not know that it needed to clean up the
leftover cluster state.

This commit ensures that the newly elected master sees if there is a
snapshot in the cluster state that is in the completed state but has not
yet been removed from the cluster state.

Closes #24452

time:
2017-05-11T02:39:43Z
class:
core/src/main/java/org/elasticsearch/index/analysis/PreConfiguredTokenFilter.java
core/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java
core/src/main/java/org/elasticsearch/indices/analysis/PreBuiltTokenFilters.java
core/src/test/java/org/elasticsearch/index/analysis/AnalysisRegistryTests.java
core/src/test/java/org/elasticsearch/index/analysis/CustomNormalizerTests.java
core/src/test/java/org/elasticsearch/index/mapper/KeywordFieldMapperTests.java
core/src/test/java/org/elasticsearch/indices/analysis/AnalysisModuleTests.java
modules/analysis-common/src/main/java/org/elasticsearch/analysis/common/CommonAnalysisPlugin.java
modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/CommonAnalysisFactoryTests.java
test/framework/src/main/java/org/elasticsearch/indices/analysis/AnalysisFactoryTestCase.java
comments:
Make PreConfiguredTokenFilter harder to misuse (#24572)

There are now three public static method to build instances of
PreConfiguredTokenFilter and the ctor is private. I chose static
methods instead of constructors because those allow us to change
out the implementation returned if we so desire.

Relates to #23658

time:
2017-05-11T02:05:19Z
class:
comments:
Docs: Tiny typo to Painless dispatch justification (#24588)

time:
2017-05-10T22:54:22Z
class:
core/src/test/java/org/elasticsearch/recovery/RelocationIT.java
comments:
Refresh at end of concurrent relocate test

We have to do something to force the global checkpoint to be
synchronized to the replicas or the assertions at the end of the test
that they are in sync will trip. Since the last write operation to hit a
replica shard will only carry the penultimate global checkpoint (it will
advance when the replicas respond with their local checkpoint), and a
background sync will not happen until the primary shard falls idle, we
force a sync through a refresh action.

time:
2017-05-10T22:00:29Z
class:
core/src/test/java/org/elasticsearch/script/ScriptServiceTests.java
comments:
Fixes ScriptServiceTests.testDefaultBehaviourFineGrainedSettings due to
an error with the fine grained settings deprecation.

time:
2017-05-10T21:42:20Z
class:
test/fixtures/hdfs-fixture/src/main/java/hdfs/MiniHDFS.java
comments:
Introduce Kerberos Test Fixture for Repository HDFS Security Tests (#24493)

This PR introduces a subproject in test/fixtures that contains a Vagrantfile used for standing up a 
KRB5 KDC (Kerberos). The PR also includes helper scripts for provisioning principals, a few 
changes to the HDFS Fixture to allow it to interface with the KDC, as well as a new suite of 
integration tests for the HDFS Repository plugin.

The HDFS Repository plugin senses if the local environment can support the HDFS Fixture 
(Windows is generally a restricted environment). If it can use the regular fixture, it then tests if 
Vagrant is installed with a compatible version to determine if the secure test fixtures should be 
enabled. If the secure tests are enabled, then we create a Kerberos KDC fixture, tasks for adding 
the required principals, and an HDFS fixture configured for security. A new integration test task is 
also configured to use the KDC and secure HDFS fixture and to run a testing suite that uses 
authentication. At the end of the secure integration test the fixtures are torn down.

time:
2017-05-10T21:38:23Z
class:
core/src/main/java/org/elasticsearch/snapshots/SnapshotInfo.java
comments:
Updates version for get snapshot API with verbose option to 5.5

time:
2017-05-10T20:09:31Z
class:
core/src/main/java/org/elasticsearch/script/ScriptSettings.java
core/src/test/java/org/elasticsearch/script/FileScriptTests.java
core/src/test/java/org/elasticsearch/script/ScriptContextTests.java
core/src/test/java/org/elasticsearch/script/ScriptModesTests.java
core/src/test/java/org/elasticsearch/script/ScriptServiceTests.java
core/src/test/java/org/elasticsearch/script/ScriptSettingsTests.java
test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java
comments:
Deprecate Fine Grain Settings for Scripts (#24573)

time:
2017-05-10T19:48:40Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/GetSnapshotsRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/GetSnapshotsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/TransportGetSnapshotsAction.java
core/src/main/java/org/elasticsearch/repositories/RepositoryData.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestGetSnapshotsAction.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotId.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotInfo.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java
core/src/test/java/org/elasticsearch/bwcompat/RestoreBackwardsCompatIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/repositories/RepositoryDataTests.java
core/src/test/java/org/elasticsearch/repositories/blobstore/BlobStoreRepositoryTests.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
comments:
Enhances get snapshots API to allow retrieving repository index only (#24477)

Currently, the get snapshots API (e.g. /_snapshot/{repositoryName}/_all)
provides information about snapshots in the repository, including the
snapshot state, number of shards snapshotted, failures, etc.  In order
to provide information about each snapshot in the repository, the call
must read the snapshot metadata blob (`snap-{snapshot_uuid}.dat`) for
every snapshot.  In cloud-based repositories, this can be expensive,
both from a cost and performance perspective.  Sometimes, all the user
wants is to retrieve all the names/uuids of each snapshot, and the
indices that went into each snapshot, without any of the other status
information about the snapshot.  This minimal information can be
retrieved from the repository index blob (`index-N`) without needing to
read each snapshot metadata blob.

This commit enhances the get snapshots API with an optional `verbose`
parameter.  If `verbose` is set to false on the request, then the get
snapshots API will only retrieve the minimal information about each
snapshot (the name, uuid, and indices in the snapshot), and only read
this information from the repository index blob, thereby giving users
the option to retrieve the snapshots in a repository in a more
cost-effective and efficient manner.

Closes #24288

time:
2017-05-10T18:28:07Z
class:
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
comments:
Revert "Add global checkpoint assertion in index shard"

This reverts commit 89b305c09e429228178fe8796dc6a5d39e69459c.

time:
2017-05-10T17:27:57Z
class:
comments:
Fix SocketPermission in test framework for alpha2 bump

It was using the wrong version, which can cause errors like

```
  1> java.security.AccessControlException: access denied ("java.net.SocketPermission" "[0:0:0:0:0:0:0:1]:34221" "connect,resolve")
  1> 	at java.security.AccessControlContext.checkPermission(AccessControlContext.java:472) ~[?:1.8.0_111]
  1> 	at java.security.AccessController.checkPermission(AccessController.java:884) ~[?:1.8.0_111]
  1> 	at java.lang.SecurityManager.checkPermission(SecurityManager.java:549) ~[?:1.8.0_111]
  1> 	at java.lang.SecurityManager.checkConnect(SecurityManager.java:1051) ~[?:1.8.0_111]
  1> 	at sun.nio.ch.SocketChannelImpl.connect(SocketChannelImpl.java:625) ~[?:?]
  1> 	at org.apache.http.impl.nio.reactor.DefaultConnectingIOReactor.processSessionRequests(DefaultConnectingIOReactor.java:273) ~[httpcore-nio-4.4.5.jar:4.4.5]
  1> 	at org.apache.http.impl.nio.reactor.DefaultConnectingIOReactor.processEvents(DefaultConnectingIOReactor.java:139) ~[httpcore-nio-4.4.5.jar:4.4.5]
  1> 	at org.apache.http.impl.nio.reactor.AbstractMultiworkerIOReactor.execute(AbstractMultiworkerIOReactor.java:348) ~[httpcore-nio-4.4.5.jar:4.4.5]
  1> 	at org.apache.http.impl.nio.conn.PoolingNHttpClientConnectionManager.execute(PoolingNHttpClientConnectionManager.java:192) ~[httpasyncclient-4.1.2.jar:4.1.2]
1> at org.apache.http.impl.nio.client.CloseableHttpAsyncClientBase$1.run(CloseableHttpAsyncClientBase.java:64) ~[httpasyncclient-4.1.2.jar:4.1.2]
```

When running tests

time:
2017-05-10T16:18:22Z
class:
core/src/test/java/org/elasticsearch/VersionTests.java
comments:
Tests: Fix VersionTests after version bump

time:
2017-05-10T15:51:58Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/AggregationsTests.java
comments:
[TEST] reset subAggregationsSupplier in AggregationsTests to empty sub-aggs once the maxDepth is reached

If we don't do this, although we don't set the subAggsSupplier again, we will reuse the one set in the previous run, hence we can end up in situations where we keep on generating sub aggregations till a StackOverflowError gets thrown.

time:
2017-05-10T15:36:12Z
class:
test/framework/src/test/java/org/elasticsearch/test/test/VersionUtilsTests.java
comments:
Tests: Fix VersionUtilsTests after version bump

time:
2017-05-10T15:12:56Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
Bumping version to v6.0.0-alpha2

time:
2017-05-10T13:59:14Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
comments:
Avoid race when shutting down controller processes (#24579)

This commit terminates any controller processes plugins might have after
the node has been closed.  This gives the plugins a chance to shut down their
controllers gracefully.

Previously there was a race condition where controller processes could be shut
down gracefully and terminated by two threads running in parallel, leading to
non-deterministic outcomes.

Additionally, controller processes that failed to shut down gracefully were
not forcibly terminated when running as a Windows service; there was a reliance
on the plugin to shut down its controller gracefully in this situation.
This commit also fixes this problem.

time:
2017-05-10T12:05:43Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/ParsedAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/ParsedDateHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/ParsedHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/InternalSampler.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/UnmappedSignificantTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/ParsedDoubleTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/ParsedLongTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/ParsedStringTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/UnmappedTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/ParsedAvg.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/ParsedCardinality.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/ParsedGeoCentroid.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/max/ParsedMax.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/min/ParsedMin.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/ParsedHDRPercentileRanks.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/ParsedHDRPercentiles.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/ParsedTDigestPercentileRanks.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/ParsedTDigestPercentiles.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/ParsedStats.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ParsedExtendedStats.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/sum/ParsedSum.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/valuecount/ParsedValueCount.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/ParsedSimpleValue.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/ParsedBucketMetricValue.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/stats/ParsedStatsBucket.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/stats/extended/ParsedExtendedStatsBucket.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/derivative/ParsedDerivative.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregationsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalMultiBucketAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/ParsedAggregationTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvgTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/AbstractPercentilesTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/InternalTDigestPercentilesRanksTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/InternalBucketMetricValueTests.java
test/framework/src/main/java/org/elasticsearch/test/InternalAggregationTestCase.java
comments:
Fix merging conflicts

time:
2017-05-10T12:05:12Z
class:
comments:
Deprecate the Tribe node

The Tribe node is deprecated in favour of Cross Cluster Search and will be removed in 7.0.

time:
2017-05-10T11:40:39Z
class:
core/src/main/java/org/elasticsearch/index/mapper/StringFieldType.java
core/src/main/java/org/elasticsearch/plugins/ScriptPlugin.java
core/src/main/java/org/elasticsearch/script/NativeScriptEngine.java
core/src/main/java/org/elasticsearch/script/ScriptEngine.java
core/src/main/java/org/elasticsearch/script/ScriptEngineRegistry.java
core/src/main/java/org/elasticsearch/script/ScriptModes.java
core/src/main/java/org/elasticsearch/script/ScriptModule.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/main/java/org/elasticsearch/script/ScriptSettings.java
core/src/main/java/org/elasticsearch/script/ScriptType.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/InternalRange.java
core/src/test/java/org/elasticsearch/script/NativeScriptTests.java
core/src/test/java/org/elasticsearch/script/ScriptModesTests.java
core/src/test/java/org/elasticsearch/script/ScriptServiceTests.java
core/src/test/java/org/elasticsearch/script/ScriptSettingsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/InternalSingleBucketAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/geogrid/InternalGeoHashGridTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogramTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogramTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/InternalBinaryRangeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/InternalRangeTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/InternalRangeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/date/InternalDateRangeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/InternalGeoDistanceTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/significant/InternalSignificantTermsTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/InternalTermsTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/AvgIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalExtendedStatsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalMaxTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalStatsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/SumIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ValueCountIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvgTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinalityTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/geobounds/InternalGeoBoundsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/geocentroid/InternalGeoCentroidTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/min/InternalMinTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/InternalPercentilesTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/InternalHDRPercentilesRanksTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/InternalTDigestPercentilesRanksTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/scripted/InternalScriptedMetricTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/sum/InternalSumTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHitsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/valuecount/InternalValueCountTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/InternalSimpleValueTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/percentile/InternalPercentilesBucketTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/derivative/InternalDerivativeTests.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestSearchIT.java
core/src/test/java/org/elasticsearch/update/UpdateByNativeScriptIT.java
core/src/test/java/org/elasticsearch/update/UpdateIT.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/matrix/stats/InternalMatrixStats.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/matrix/stats/MatrixStatsResults.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/matrix/stats/RunningStats.java
modules/aggs-matrix-stats/src/test/java/org/elasticsearch/search/aggregations/matrix/stats/BaseMatrixStatsTestCase.java
modules/aggs-matrix-stats/src/test/java/org/elasticsearch/search/aggregations/matrix/stats/InternalMatrixStatsTests.java
modules/aggs-matrix-stats/src/test/java/org/elasticsearch/search/aggregations/matrix/stats/MultiPassStats.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/ExpressionPlugin.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/ExpressionScriptEngine.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/ExpressionTests.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/MoreExpressionTests.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/StoredExpressionTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequest.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequestBuilder.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MustachePlugin.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MustacheScriptEngine.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestMultiSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportMultiSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/CustomMustacheFactoryTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequestTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MustacheScriptEngineTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MustacheTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateIT.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Location.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/PainlessPlugin.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/PainlessScript.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/PainlessScriptEngine.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/NeedsScoreTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ScriptTestCase.java
plugins/analysis-icu/src/main/java/org/elasticsearch/index/mapper/ICUCollationKeywordFieldMapper.java
plugins/analysis-icu/src/main/java/org/elasticsearch/plugin/analysis/icu/AnalysisICUPlugin.java
plugins/analysis-icu/src/test/java/org/elasticsearch/index/mapper/CollationFieldTypeTests.java
plugins/analysis-icu/src/test/java/org/elasticsearch/index/mapper/ICUCollationKeywordFieldMapperIT.java
plugins/analysis-icu/src/test/java/org/elasticsearch/index/mapper/ICUCollationKeywordFieldMapperTests.java
qa/smoke-test-ingest-with-all-dependencies/src/test/java/org/elasticsearch/ingest/AbstractScriptTestCase.java
test/framework/src/main/java/org/elasticsearch/index/mapper/FieldTypeTestCase.java
test/framework/src/main/java/org/elasticsearch/script/MockScriptEngine.java
test/framework/src/main/java/org/elasticsearch/script/MockScriptPlugin.java
test/framework/src/main/java/org/elasticsearch/test/InternalAggregationTestCase.java
comments:
Merge remote-tracking branch 'origin/master' into feature/client_aggs_parsing

# Conflicts:
#	core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/InternalTermsTestCase.java
#	core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalExtendedStatsTests.java
#	core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalMaxTests.java
#	core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalStatsTests.java
#	core/src/test/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvgTests.java
#	core/src/test/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinalityTests.java
#	core/src/test/java/org/elasticsearch/search/aggregations/metrics/geobounds/InternalGeoBoundsTests.java
#	core/src/test/java/org/elasticsearch/search/aggregations/metrics/geocentroid/InternalGeoCentroidTests.java
#	core/src/test/java/org/elasticsearch/search/aggregations/metrics/min/InternalMinTests.java
#	core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/InternalPercentilesTestCase.java
#	core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/InternalHDRPercentilesRanksTests.java
#	core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/InternalTDigestPercentilesRanksTests.java
#	core/src/test/java/org/elasticsearch/search/aggregations/metrics/sum/InternalSumTests.java
#	core/src/test/java/org/elasticsearch/search/aggregations/metrics/valuecount/InternalValueCountTests.java
#	core/src/test/java/org/elasticsearch/search/aggregations/pipeline/InternalSimpleValueTests.java
#	core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/percentile/InternalPercentilesBucketTests.java
#	core/src/test/java/org/elasticsearch/search/aggregations/pipeline/derivative/InternalDerivativeTests.java
#	test/framework/src/main/java/org/elasticsearch/test/InternalAggregationTestCase.java

time:
2017-05-10T10:31:28Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/InternalRangeTestCase.java
comments:
[Test] Fix wrong import

time:
2017-05-10T10:22:52Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/InternalRange.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/InternalRangeTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/InternalRangeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/date/InternalDateRangeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/InternalGeoDistanceTests.java
comments:
[Test] Add unit tests for Range aggregations (#24569)

Related to #22278

time:
2017-05-10T09:47:53Z
class:
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequest.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequestBuilder.java
comments:
Rewrite multi search template api to delegate to multi search api instead of to search template api.

The max concurrent searches logic is complex and we shouldn't duplicate that in multi search template api,
so we should template each individual template search request and then delegate to multi search api.

time:
2017-05-10T09:37:20Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/AggregationsTests.java
comments:
[Test] Reference Terms aggregations in AggregationsTests

time:
2017-05-10T09:34:34Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/ParsedMultiBucketAggregation.java
comments:
Fix checkstyle violation

time:
2017-05-10T09:23:24Z
class:
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequest.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportMultiSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
comments:
Rewrite multi search template api to delegate to multi search api instead of to search template api.

The max concurrent searches logic is complex and we shouldn't duplicate that in multi search template api,
so we should template each individual template search request and then delegate to multi search api.

time:
2017-05-10T09:23:24Z
class:
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequest.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequestBuilder.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestMultiSearchTemplateAction.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequestTests.java
comments:
This adds max_concurrent_searches to multi-search-template endpoint.

Closes #20912

time:
2017-05-10T09:06:18Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/bucket/InternalSingleBucketAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/geogrid/InternalGeoHashGridTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogramTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogramTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/InternalBinaryRangeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/significant/InternalSignificantTermsTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/InternalTermsTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalExtendedStatsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalMaxTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalStatsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvgTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinalityTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/geobounds/InternalGeoBoundsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/geocentroid/InternalGeoCentroidTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/min/InternalMinTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/InternalPercentilesTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/InternalHDRPercentilesRanksTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/InternalTDigestPercentilesRanksTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/scripted/InternalScriptedMetricTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/sum/InternalSumTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHitsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/valuecount/InternalValueCountTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/InternalSimpleValueTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/percentile/InternalPercentilesBucketTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/derivative/InternalDerivativeTests.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/matrix/stats/InternalMatrixStats.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/matrix/stats/MatrixStatsResults.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/matrix/stats/RunningStats.java
modules/aggs-matrix-stats/src/test/java/org/elasticsearch/search/aggregations/matrix/stats/BaseMatrixStatsTestCase.java
modules/aggs-matrix-stats/src/test/java/org/elasticsearch/search/aggregations/matrix/stats/InternalMatrixStatsTests.java
modules/aggs-matrix-stats/src/test/java/org/elasticsearch/search/aggregations/matrix/stats/MultiPassStats.java
test/framework/src/main/java/org/elasticsearch/test/InternalAggregationTestCase.java
comments:
Added unit tests for InternalMatrixStats.

Also moved InternalAggregationTestCase to test-framework module in order to make use of it from other modules than core.

Relates to #22278

time:
2017-05-10T08:35:11Z
class:
core/src/main/java/org/elasticsearch/index/mapper/StringFieldType.java
plugins/analysis-icu/src/main/java/org/elasticsearch/index/mapper/ICUCollationKeywordFieldMapper.java
plugins/analysis-icu/src/main/java/org/elasticsearch/plugin/analysis/icu/AnalysisICUPlugin.java
plugins/analysis-icu/src/test/java/org/elasticsearch/index/mapper/CollationFieldTypeTests.java
plugins/analysis-icu/src/test/java/org/elasticsearch/index/mapper/ICUCollationKeywordFieldMapperIT.java
plugins/analysis-icu/src/test/java/org/elasticsearch/index/mapper/ICUCollationKeywordFieldMapperTests.java
test/framework/src/main/java/org/elasticsearch/index/mapper/FieldTypeTestCase.java
comments:
Add ICUCollationFieldMapper (#24126)

Adds a new "icu_collation" field type that exposes lucene's
ICUCollationDocValuesField.  ICUCollationDocValuesField is the replacement
for ICUCollationKeyFilter which has been deprecated since Lucene 5.

time:
2017-05-10T08:17:25Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/Aggregations.java
core/src/main/java/org/elasticsearch/search/aggregations/ParsedMultiBucketAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/ParsedDateHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/ParsedHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/ParsedDoubleTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/ParsedLongTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/ParsedStringTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/ParsedTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/ParsedPercentiles.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/InternalTermsTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/LongTermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/StringTermsTests.java
comments:
Add parsing for String/Long/Double Terms aggregations (#24521)

time:
2017-05-10T08:04:02Z
class:
comments:
fix checkstyle after script engine rename

time:
2017-05-10T07:47:33Z
class:
core/src/main/java/org/elasticsearch/plugins/ScriptPlugin.java
core/src/main/java/org/elasticsearch/script/NativeScriptEngine.java
core/src/main/java/org/elasticsearch/script/ScriptEngine.java
core/src/main/java/org/elasticsearch/script/ScriptEngineRegistry.java
core/src/main/java/org/elasticsearch/script/ScriptModes.java
core/src/main/java/org/elasticsearch/script/ScriptModule.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/main/java/org/elasticsearch/script/ScriptSettings.java
core/src/main/java/org/elasticsearch/script/ScriptType.java
core/src/test/java/org/elasticsearch/script/NativeScriptTests.java
core/src/test/java/org/elasticsearch/script/ScriptModesTests.java
core/src/test/java/org/elasticsearch/script/ScriptServiceTests.java
core/src/test/java/org/elasticsearch/script/ScriptSettingsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/AvgIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/SumIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ValueCountIT.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestSearchIT.java
core/src/test/java/org/elasticsearch/update/UpdateByNativeScriptIT.java
core/src/test/java/org/elasticsearch/update/UpdateIT.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/ExpressionPlugin.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/ExpressionScriptEngine.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/ExpressionTests.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/MoreExpressionTests.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/StoredExpressionTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MustachePlugin.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MustacheScriptEngine.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/CustomMustacheFactoryTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MustacheScriptEngineTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MustacheTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateIT.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Location.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/PainlessPlugin.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/PainlessScript.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/PainlessScriptEngine.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/NeedsScoreTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ScriptTestCase.java
qa/smoke-test-ingest-with-all-dependencies/src/test/java/org/elasticsearch/ingest/AbstractScriptTestCase.java
test/framework/src/main/java/org/elasticsearch/script/MockScriptEngine.java
test/framework/src/main/java/org/elasticsearch/script/MockScriptPlugin.java
comments:
Scripting: Remove "service" from ScriptEngine interface name (#24574)

This commit renames ScriptEngineService to ScriptEngine.  It is often
confusing because we have the ScriptService, and then
ScriptEngineService implementations, but the latter are not services as
we see in other places in elasticsearch.

time:
2017-05-10T07:40:26Z
class:
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationOperation.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/main/java/org/elasticsearch/env/Environment.java
core/src/main/java/org/elasticsearch/index/IndexModule.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/IndexSettings.java
core/src/main/java/org/elasticsearch/index/analysis/AnalysisRegistry.java
core/src/main/java/org/elasticsearch/index/analysis/PreBuiltTokenFilterFactoryFactory.java
core/src/main/java/org/elasticsearch/index/analysis/PreConfiguredTokenFilter.java
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointSyncAction.java
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointTracker.java
core/src/main/java/org/elasticsearch/index/seqno/SequenceNumbersService.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java
core/src/main/java/org/elasticsearch/indices/analysis/PreBuiltCacheFactory.java
core/src/main/java/org/elasticsearch/indices/analysis/PreBuiltTokenFilters.java
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/AnalysisPlugin.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/test/java/org/elasticsearch/action/admin/indices/TransportAnalyzeActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationOperationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/IndexServiceTests.java
core/src/test/java/org/elasticsearch/index/analysis/AnalysisFactoryTests.java
core/src/test/java/org/elasticsearch/index/analysis/AnalysisRegistryTests.java
core/src/test/java/org/elasticsearch/index/analysis/CoreAnalysisFactoryTests.java
core/src/test/java/org/elasticsearch/index/analysis/CustomNormalizerTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/mapper/KeywordFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/query/IdsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/replication/IndexLevelReplicationTests.java
core/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java
core/src/test/java/org/elasticsearch/index/seqno/GlobalCheckpointSyncActionTests.java
core/src/test/java/org/elasticsearch/index/seqno/GlobalCheckpointTrackerTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/indices/IndicesLifecycleListenerSingleNodeTests.java
core/src/test/java/org/elasticsearch/indices/cluster/AbstractIndicesClusterStateServiceTestCase.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
core/src/test/java/org/elasticsearch/recovery/RelocationIT.java
core/src/test/java/org/elasticsearch/script/FileScriptTests.java
core/src/test/java/org/elasticsearch/script/NativeScriptTests.java
core/src/test/java/org/elasticsearch/script/ScriptContextTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorFactoriesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/scripted/InternalScriptedMetricTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregatorTests.java
core/src/test/java/org/elasticsearch/tribe/TribeServiceTests.java
modules/analysis-common/src/main/java/org/elasticsearch/analysis/common/CommonAnalysisPlugin.java
modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/CommonAnalysisFactoryTests.java
plugins/analysis-icu/src/test/java/org/elasticsearch/index/analysis/AnalysisICUFactoryTests.java
plugins/analysis-kuromoji/src/test/java/org/elasticsearch/index/analysis/AnalysisKuromojiFactoryTests.java
plugins/analysis-phonetic/src/test/java/org/elasticsearch/index/analysis/AnalysisPhoneticFactoryTests.java
plugins/analysis-smartcn/src/test/java/org/elasticsearch/index/analysis/AnalysisSmartChineseFactoryTests.java
plugins/analysis-stempel/src/test/java/org/elasticsearch/index/analysis/AnalysisPolishFactoryTests.java
qa/backwards-5.0/src/test/java/org/elasticsearch/backwards/IndexingIT.java
qa/evil-tests/src/test/java/org/elasticsearch/bootstrap/EvilSecurityTests.java
qa/smoke-test-ingest-with-all-dependencies/src/test/java/org/elasticsearch/ingest/AbstractScriptTestCase.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
test/framework/src/main/java/org/elasticsearch/indices/analysis/AnalysisFactoryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
Merge branch 'master' into feature/client_aggs_parsing

time:
2017-05-09T23:53:19Z
class:
core/src/test/java/org/elasticsearch/index/query/IdsQueryBuilderTests.java
comments:
Fix ids query builder test to use the same logic for matchnodocs as the
builder itself

time:
2017-05-09T23:14:57Z
class:
core/src/main/java/org/elasticsearch/env/Environment.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/test/java/org/elasticsearch/script/FileScriptTests.java
core/src/test/java/org/elasticsearch/script/NativeScriptTests.java
core/src/test/java/org/elasticsearch/script/ScriptContextTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorFactoriesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/scripted/InternalScriptedMetricTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregatorTests.java
core/src/test/java/org/elasticsearch/tribe/TribeServiceTests.java
qa/evil-tests/src/test/java/org/elasticsearch/bootstrap/EvilSecurityTests.java
qa/smoke-test-ingest-with-all-dependencies/src/test/java/org/elasticsearch/ingest/AbstractScriptTestCase.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
Scripting: Deprecate file script settings (#24555)

File scripts have 2 related settings: the path of file scripts, and
whether they can be dynamically reloaded. This commit deprecates those
settings.

relates #21798

time:
2017-05-09T22:31:32Z
class:
comments:
fix ingest pipeline timestamp timezone format check to be even more generic

time:
2017-05-09T21:52:28Z
class:
core/src/test/java/org/elasticsearch/index/query/IdsQueryBuilderTests.java
comments:
Fix ids query test when none or ALL type is used

See #24460
Thanks!

time:
2017-05-09T21:33:43Z
class:
comments:
modify ingest timestamp format check to remove timezone

time:
2017-05-09T21:17:09Z
class:
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointTracker.java
core/src/test/java/org/elasticsearch/index/seqno/GlobalCheckpointTrackerTests.java
comments:
Remove global checkpoint constraint

A constraint on the global checkpoint was inadvertently committed from
the inlining global checkpoint work. Namely, the constraint prevents the
global checkpoint from advancing to no ops performed, a situation that
can occur when shards are started but empty.

time:
2017-05-09T19:37:43Z
class:
comments:
Fix handling of spaces in plugin script on Windows

A previous fix for handling spaces in the Windows scripts should also be
applied to the plugin script. This commit does that.

Closes #24750

time:
2017-05-09T19:23:00Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/AggregationsTests.java
comments:
[TEST] add test to verify that no aggs have been forgotten in AggregationsTests

time:
2017-05-09T19:18:43Z
class:
comments:
Docs: Correct description of example (#24541)

Copy and paste error.

time:
2017-05-09T19:08:11Z
class:
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationOperation.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexTemplateService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataMappingService.java
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/main/java/org/elasticsearch/index/IndexModule.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/IndexSettings.java
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointSyncAction.java
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointTracker.java
core/src/main/java/org/elasticsearch/index/seqno/SequenceNumbersService.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationOperationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/IndexServiceTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/replication/IndexLevelReplicationTests.java
core/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java
core/src/test/java/org/elasticsearch/index/seqno/GlobalCheckpointSyncActionTests.java
core/src/test/java/org/elasticsearch/index/seqno/GlobalCheckpointTrackerTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/indices/IndicesLifecycleListenerSingleNodeTests.java
core/src/test/java/org/elasticsearch/indices/cluster/AbstractIndicesClusterStateServiceTestCase.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
core/src/test/java/org/elasticsearch/recovery/RelocationIT.java
qa/backwards-5.0/src/test/java/org/elasticsearch/backwards/IndexingIT.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
comments:
Inline global checkpoints

Today we rely on background syncs to relay the global checkpoint under
the mandate of the primary to its replicas. This means that the global
checkpoint on a replica can lag far behind the primary. The commit moves
to inlining global checkpoints with replication requests. When a
replication operation is performed, the primary will send the latest
global checkpoint inline with the replica requests. This keeps the
replicas closer in-sync with the primary.

However, consider a replication request that is not followed by another
replication request for an indefinite period of time. When the replicas
respond to the primary with their local checkpoint, the primary will
advance its global checkpoint. During this indefinite period of time,
the replicas will not be notified of the advanced global
checkpoint. This necessitates a need for another sync. To achieve this,
we perform a global checkpoint sync when a shard falls idle.

Relates #24513

time:
2017-05-09T19:08:10Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/Aggregations.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregationsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalMultiBucketAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/InternalSingleBucketAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogramTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogramTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalMaxTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinalityTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/geocentroid/InternalGeoCentroidTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/AbstractPercentilesTestCase.java
comments:
[TEST] Add test for Aggregations#fromXContent (#24524)

AggregationsTests#testFromXContent verifies that parsing of aggregations works by combining multiple aggs at the same level, and also adding sub-aggregations to multi bucket and single bucket aggs, up to a maximum depth of 5.

time:
2017-05-09T18:50:49Z
class:
core/src/main/java/org/elasticsearch/index/analysis/AnalysisRegistry.java
core/src/main/java/org/elasticsearch/index/analysis/PreBuiltTokenFilterFactoryFactory.java
core/src/main/java/org/elasticsearch/index/analysis/PreConfiguredTokenFilter.java
core/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java
core/src/main/java/org/elasticsearch/indices/analysis/PreBuiltCacheFactory.java
core/src/main/java/org/elasticsearch/indices/analysis/PreBuiltTokenFilters.java
core/src/main/java/org/elasticsearch/plugins/AnalysisPlugin.java
core/src/test/java/org/elasticsearch/action/admin/indices/TransportAnalyzeActionTests.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/analysis/AnalysisFactoryTests.java
core/src/test/java/org/elasticsearch/index/analysis/AnalysisRegistryTests.java
core/src/test/java/org/elasticsearch/index/analysis/CoreAnalysisFactoryTests.java
core/src/test/java/org/elasticsearch/index/analysis/CustomNormalizerTests.java
core/src/test/java/org/elasticsearch/index/mapper/KeywordFieldMapperTests.java
modules/analysis-common/src/main/java/org/elasticsearch/analysis/common/CommonAnalysisPlugin.java
modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/CommonAnalysisFactoryTests.java
plugins/analysis-icu/src/test/java/org/elasticsearch/index/analysis/AnalysisICUFactoryTests.java
plugins/analysis-kuromoji/src/test/java/org/elasticsearch/index/analysis/AnalysisKuromojiFactoryTests.java
plugins/analysis-phonetic/src/test/java/org/elasticsearch/index/analysis/AnalysisPhoneticFactoryTests.java
plugins/analysis-smartcn/src/test/java/org/elasticsearch/index/analysis/AnalysisSmartChineseFactoryTests.java
plugins/analysis-stempel/src/test/java/org/elasticsearch/index/analysis/AnalysisPolishFactoryTests.java
test/framework/src/main/java/org/elasticsearch/indices/analysis/AnalysisFactoryTestCase.java
comments:
Allow plugins to build pre-configured token filters (#24223)

This changes the way we register pre-configured token filters so that
plugins can declare them and starts to move all of the pre-configured
token filters out of core. It doesn't finish the job because doing
so would make the change unreviewably large. So this PR includes
a shim that keeps the "old" way of registering pre-configured token
filters around.

The Lowercase token filter is special because there is a "special"
interaction between it and the lowercase tokenizer. I'm not sure
exactly what to do about it so for now I'm leaving it alone with
the intent of figuring out what to do with it in a followup.

This also renames these pre-configured token filters from
"pre-built" to "pre-configured" because that seemed like a more
descriptive name.

This is a part of #23658

time:
2017-05-09T17:54:36Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/TransportGetSnapshotsAction.java
core/src/main/java/org/elasticsearch/action/bulk/MappingUpdatePerformer.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/explain/TransportExplainAction.java
core/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/SearchType.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java
core/src/main/java/org/elasticsearch/common/cache/Cache.java
core/src/main/java/org/elasticsearch/common/lucene/uid/PerThreadIDVersionAndSeqNoLookup.java
core/src/main/java/org/elasticsearch/common/lucene/uid/VersionsAndSeqNoResolver.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/common/unit/TimeValue.java
core/src/main/java/org/elasticsearch/index/IndexSettings.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/Segment.java
core/src/main/java/org/elasticsearch/index/fielddata/UidIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractIndexOrdinalsFieldData.java
core/src/main/java/org/elasticsearch/index/fieldvisitor/FieldsVisitor.java
core/src/main/java/org/elasticsearch/index/fieldvisitor/JustUidFieldsVisitor.java
core/src/main/java/org/elasticsearch/index/fieldvisitor/SingleFieldsVisitor.java
core/src/main/java/org/elasticsearch/index/get/ShardGetService.java
core/src/main/java/org/elasticsearch/index/mapper/IdFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/MappedFieldType.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/index/mapper/ParsedDocument.java
core/src/main/java/org/elasticsearch/index/mapper/TypeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/UidFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/IdsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/RandomScoreFunctionBuilder.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/StoreRecovery.java
core/src/main/java/org/elasticsearch/index/shard/TranslogRecoveryPerformer.java
core/src/main/java/org/elasticsearch/index/termvectors/TermVectorsService.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/ingest/IngestDocument.java
core/src/main/java/org/elasticsearch/ingest/IngestService.java
core/src/main/java/org/elasticsearch/ingest/PipelineExecutionService.java
core/src/main/java/org/elasticsearch/ingest/PipelineStore.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/repositories/RepositoryData.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/InnerHitsContext.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchLocalRequest.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchTransportRequest.java
core/src/main/java/org/elasticsearch/search/lookup/LeafDocLookup.java
core/src/main/java/org/elasticsearch/search/lookup/LeafFieldsLookup.java
core/src/main/java/org/elasticsearch/search/slice/SliceBuilder.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotShardsService.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/test/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsTests.java
core/src/test/java/org/elasticsearch/action/bulk/TransportShardBulkActionTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollParallelizationHelperTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/aliases/IndexAliasesIT.java
core/src/test/java/org/elasticsearch/common/cache/CacheTests.java
core/src/test/java/org/elasticsearch/common/lucene/uid/VersionLookupTests.java
core/src/test/java/org/elasticsearch/fieldstats/FieldStatsTests.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/fielddata/UidFieldDataTests.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentParserTests.java
core/src/test/java/org/elasticsearch/index/mapper/FieldNamesFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/IdFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/IdFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/TextFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/UidFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/UidFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/replication/IndexLevelReplicationTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexingOperationListenerTests.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySourceHandlerTests.java
core/src/test/java/org/elasticsearch/ingest/IngestDocumentTests.java
core/src/test/java/org/elasticsearch/ingest/IngestServiceTests.java
core/src/test/java/org/elasticsearch/ingest/PipelineStoreTests.java
core/src/test/java/org/elasticsearch/script/FileScriptTests.java
core/src/test/java/org/elasticsearch/script/ScriptServiceTests.java
core/src/test/java/org/elasticsearch/search/SearchCancellationIT.java
core/src/test/java/org/elasticsearch/search/SearchRequestTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregatorTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/InnerHitsIT.java
core/src/test/java/org/elasticsearch/search/profile/query/QueryProfilerIT.java
core/src/test/java/org/elasticsearch/search/query/MultiMatchQueryIT.java
core/src/test/java/org/elasticsearch/search/slice/SliceBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/FieldSortIT.java
distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
distribution/tools/plugin-cli/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/AppendProcessor.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/DefMath.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EBinary.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
test/framework/src/main/java/org/elasticsearch/search/RandomSearchRequestGenerator.java
test/framework/src/main/java/org/elasticsearch/search/aggregations/metrics/AbstractNumericTestCase.java
test/framework/src/main/java/org/elasticsearch/test/MockLogAppender.java
test/framework/src/main/java/org/elasticsearch/test/disruption/NetworkDisruption.java
test/framework/src/main/java/org/elasticsearch/test/disruption/SingleNodeDisruption.java
comments:
Merge branch 'master' into feature/client_aggs_parsing

time:
2017-05-09T17:33:33Z
class:
core/src/test/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsTests.java
comments:
Tests: Give stats tests long to wait for listener

This test waited 10 seconds for a refresh listener to appear in
the stats. It turns out that in our NFS testing infrastructure this can
take a lot longer than 10 seconds. The error reported here:
https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+nfs/257/consoleFull
has it taking something like 15 seconds. This bumps the timeout
to a solid minute.

Closes #24417

time:
2017-05-09T16:52:53Z
class:
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/test/java/org/elasticsearch/search/SearchRequestTests.java
test/framework/src/main/java/org/elasticsearch/search/RandomSearchRequestGenerator.java
comments:
Fix BWC for query_and_fetch

time:
2017-05-09T16:33:23Z
class:
comments:
Fixed prerelease URLs for RPM and Deb repos in docs

time:
2017-05-09T14:54:44Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/SearchType.java
comments:
Cleanup BWC for single shard optimization

The BWC layer is needed only for pre 5.3 indices.

time:
2017-05-09T14:33:52Z
class:
core/src/main/java/org/elasticsearch/action/bulk/MappingUpdatePerformer.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/explain/TransportExplainAction.java
core/src/main/java/org/elasticsearch/common/lucene/uid/PerThreadIDVersionAndSeqNoLookup.java
core/src/main/java/org/elasticsearch/common/lucene/uid/VersionsAndSeqNoResolver.java
core/src/main/java/org/elasticsearch/index/IndexSettings.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/fielddata/UidIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractIndexOrdinalsFieldData.java
core/src/main/java/org/elasticsearch/index/fieldvisitor/FieldsVisitor.java
core/src/main/java/org/elasticsearch/index/fieldvisitor/JustUidFieldsVisitor.java
core/src/main/java/org/elasticsearch/index/fieldvisitor/SingleFieldsVisitor.java
core/src/main/java/org/elasticsearch/index/get/ShardGetService.java
core/src/main/java/org/elasticsearch/index/mapper/IdFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/MappedFieldType.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/index/mapper/ParsedDocument.java
core/src/main/java/org/elasticsearch/index/mapper/TypeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/UidFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/IdsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/RandomScoreFunctionBuilder.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/TranslogRecoveryPerformer.java
core/src/main/java/org/elasticsearch/index/termvectors/TermVectorsService.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/InnerHitsContext.java
core/src/main/java/org/elasticsearch/search/lookup/LeafFieldsLookup.java
core/src/main/java/org/elasticsearch/search/slice/SliceBuilder.java
core/src/test/java/org/elasticsearch/action/bulk/TransportShardBulkActionTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollParallelizationHelperTests.java
core/src/test/java/org/elasticsearch/aliases/IndexAliasesIT.java
core/src/test/java/org/elasticsearch/common/lucene/uid/VersionLookupTests.java
core/src/test/java/org/elasticsearch/fieldstats/FieldStatsTests.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/fielddata/UidFieldDataTests.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentParserTests.java
core/src/test/java/org/elasticsearch/index/mapper/FieldNamesFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/IdFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/IdFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/TextFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/UidFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/UidFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexingOperationListenerTests.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySourceHandlerTests.java
core/src/test/java/org/elasticsearch/search/SearchCancellationIT.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregatorTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/InnerHitsIT.java
core/src/test/java/org/elasticsearch/search/profile/query/QueryProfilerIT.java
core/src/test/java/org/elasticsearch/search/query/MultiMatchQueryIT.java
core/src/test/java/org/elasticsearch/search/slice/SliceBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/FieldSortIT.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
comments:
Identify documents by their `_id`. (#24460)

Now that indices have a single type by default, we can move to the next step
and identify documents using their `_id` rather than the `_uid`.

One notable change in this commit is that I made deletions implicitly create
types. This helps with the live version map in the case that documents are
deleted before the first type is introduced. Otherwise there would be no way
to differenciate `DELETE index/foo/1` followed by `PUT index/foo/1` from
`DELETE index/bar/1` followed by `PUT index/foo/1`, even though those are
different if versioning is involved.

time:
2017-05-09T13:42:02Z
class:
comments:
Increase compilation limit in ingest tests

These tests are running into the script compilation limit. This commit
increases the limit for these tests.

time:
2017-05-09T12:02:11Z
class:
comments:
Mark 6.0.0-alpha1 as prerelease

time:
2017-05-09T12:01:32Z
class:
comments:
Updated release notes for 6.0.0-alpha1

time:
2017-05-09T07:14:17Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchLocalRequest.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchTransportRequest.java
comments:
Fix single shard scroll within a cluster with nodes in version >= 5.3 and <= 5.3 (#24512)

If a node in version >= 5.3 acts as a coordinating node during a scroll request that targets a single shard, the scroll may return the same documents over and over iff the targeted shard is hosted by a node with a version <= 5.3.
The nodes in this version will advance the scroll only if the search_type has been set to `query_and_fetch` though this search type has been removed in 5.3.
This change handles this situation by adding the removed search_type in the request that targets a node in version <= 5.3.

time:
2017-05-08T22:06:39Z
class:
core/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/ingest/IngestDocument.java
core/src/main/java/org/elasticsearch/ingest/IngestService.java
core/src/main/java/org/elasticsearch/ingest/PipelineExecutionService.java
core/src/main/java/org/elasticsearch/ingest/PipelineStore.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/test/java/org/elasticsearch/ingest/IngestDocumentTests.java
core/src/test/java/org/elasticsearch/ingest/IngestServiceTests.java
core/src/test/java/org/elasticsearch/ingest/PipelineStoreTests.java
comments:
add option for _ingest.timestamp to use new ZonedDateTime (#24030)

Previously, Mustache would call `toString` on the `_ingest.timestamp`
field and return a date format that did not match Elasticsearch's
defaults for date-mapping parsing. The new ZonedDateTime class in Java 8
happens to do format itself in the same way ES is expecting.

This commit adds support for a feature flag that enables the usage of this new date format 
that has more native behavior.

Fixes #23168.

This new fix can be found in the form of a cluster setting called
`ingest.new_date_format`. By default, in 5.x, the existing behavior
will remain the same. One will set this property to `true` in order to
take advantage of this update for ingest-pipeline convenience.

time:
2017-05-08T21:43:01Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/get/TransportGetSnapshotsAction.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java
comments:
Fixes inefficient loading of snapshot repository data (#24510)

This commit fixes inefficient (worst case exponential) loading of 
snapshot repository data when checking for incompatible snapshots,
that was introduced in #22267.  When getting snapshot information,
getRepositoryData() was called on every snapshot, so if there are
a large number of snapshots in the repository and _all snapshots
were requested, the performance degraded exponentially.  This
commit fixes the issue by only calling getRepositoryData once and
using the data from it in all subsequent calls to get snapshot 
information.

Closes #24509

time:
2017-05-08T21:06:45Z
class:
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/test/java/org/elasticsearch/script/FileScriptTests.java
core/src/test/java/org/elasticsearch/script/ScriptServiceTests.java
comments:
Scripting: Deprecate file scripts (#24552)

File scripts will be removed in 6.0. This commit adds a deprecation
warning for 5.5 when the first file script is loaded.

time:
2017-05-08T20:20:58Z
class:
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
comments:
Remove commented code from ESILRTC

This commit removes some commented out code from
ESIndexLevelReplicationTestCase.java that was inadvertently committed.

time:
2017-05-08T20:19:47Z
class:
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/replication/IndexLevelReplicationTests.java
comments:
Ensure test replicas have valid recovery state

When starting a new replication group in an index level replication test
case, a started replica would not have a valid recovery state. This
violates simple assumptions as replicas always have to have recovered
before being started. This commit causes this to be the case that this
assumption is not violated too.

time:
2017-05-08T17:37:28Z
class:
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
comments:
Add global checkpoint assertion in index shard

We previously removed this assertion because it could be violated in
races. This commit adds this assertion back with sampling done more
carefully to avoid failures solely due to race conditions.

time:
2017-05-08T16:32:57Z
class:
core/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java
comments:
Improve bootstrap checks error messages

When multiple bootstrap checks fail, it's not clear where one error
message begins and the next error message ends. This commit numbers the
bootstrap check error messages so they are easier to read.

Relates #24548

time:
2017-05-08T15:00:47Z
class:
core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
comments:
Refactor UpdateHelper into unit-testable pieces

This starts breaking up the `UpdateHelper.prepare` method so that each piece can
be individually unit tested. No actual functionality has changed.

Note however, that I did add a TODO about `ctx.op` leniency, which I'd love to
remove as a separate PR if desired.

time:
2017-05-08T13:49:14Z
class:
core/src/main/java/org/elasticsearch/common/cache/Cache.java
core/src/test/java/org/elasticsearch/common/cache/CacheTests.java
comments:
Fix cache expire after access

This commit fixes a bug in the cache expire after access
implementation. The bug is this: if you construct a cache with an expire
after access of T, put a key, and then touch the key at some time t > T,
the act of getting the key would update the access time for the entry
before checking if the entry was expired. There are situations in which
expire after access would be honored (e.g., if the cache needs to prune
the LRU list to keep the cache under a certain weight, or a manual
refresh was called) but this behavior is otherwise broken.

Relates #24546

time:
2017-05-08T11:34:36Z
class:
comments:
Document work-around for jar hell in idea_rt.jar file (#24523)

time:
2017-05-08T11:02:27Z
class:
test/framework/src/main/java/org/elasticsearch/test/MockLogAppender.java
comments:
Move MockLogAppender to elasticsearch test (#24542)

In order to make MockLogAppender (utility to test logging) available outside
of es-core move MockLogAppender from test core-tests to test framework. As
package names do not change, no need to change clients.

time:
2017-05-08T10:38:28Z
class:
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/shard/StoreRecovery.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
Remove gap skipping when opening engine

Today when opening the engine we skip gaps in the history, advancing the
local checkpoint until it is equal to the maximum sequence number
contained in the commit. This allows history to advance, but it leaves
gaps. A previous change filled these gaps when recovering from store,
but since we were skipping the gaps while opening the engine, this
change had no effect. This commit removes the gap skipping when opening
the engine allowing the gap filling to do its job.

Relates #24535

time:
2017-05-08T10:05:01Z
class:
comments:
documentation of preserve existing settings

time:
2017-05-08T08:36:36Z
class:
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/AppendProcessor.java
comments:
remove duplicated import in AppendProcessor

time:
2017-05-06T17:25:10Z
class:
distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
distribution/tools/plugin-cli/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java
comments:
Fix plugin installation permissions

When installing plugin permissions, we try to set the permissions on all
installed files ourselves because a umask from the user could violate
everything needed to get the permissions right. Sadly, directories were
not handled correctly at all and so we were still left with broken
installations with umasks like 0077. This commit fixes this issue, adds
a thorough unit test for the situation, and most importantly, adds a
test that sets the umask before installing the plugin.

Relates #24527

time:
2017-05-06T04:28:53Z
class:
core/src/main/java/org/elasticsearch/index/engine/Segment.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/repositories/RepositoryData.java
core/src/main/java/org/elasticsearch/search/lookup/LeafDocLookup.java
core/src/main/java/org/elasticsearch/search/lookup/LeafFieldsLookup.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotShardsService.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/DefMath.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EBinary.java
test/framework/src/main/java/org/elasticsearch/search/aggregations/metrics/AbstractNumericTestCase.java
test/framework/src/main/java/org/elasticsearch/test/disruption/NetworkDisruption.java
test/framework/src/main/java/org/elasticsearch/test/disruption/SingleNodeDisruption.java
comments:
Remove unneeded empty string concatentation

This commit removes concatenation by empty string in places where it
is simply not needed to obtain a string representation.

Relates #24411

time:
2017-05-05T22:37:09Z
class:
core/src/main/java/org/elasticsearch/common/unit/TimeValue.java
comments:
TimeValue#parseTimeValue author is bad, feels bad

I stumbled on this code today and I hated it; I wrote it. I did not like
that you could not tell at a glance whether or not the method parameters
were correct. This commit fixes it.

Relates #24522

time:
2017-05-05T19:57:54Z
class:
comments:
Add workaround so path.data can be set in run task

Previously you could set the system property tests.es.path.data and
start the run task with a custom data directory. A change in core to
detect duplicate settings broke this. That change should stay, but we
can work around this easily by only setting path.data to the data
directory if tests.es.path.data is not set.

time:
2017-05-05T19:54:37Z
class:
benchmarks/src/main/java/org/elasticsearch/benchmark/routing/allocation/Allocators.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/TransportClusterSearchShardsAction.java
core/src/main/java/org/elasticsearch/action/fieldcaps/FieldCapabilitiesIndexResponse.java
core/src/main/java/org/elasticsearch/action/fieldcaps/FieldCapabilitiesRequest.java
core/src/main/java/org/elasticsearch/action/fieldcaps/FieldCapabilitiesResponse.java
core/src/main/java/org/elasticsearch/action/fieldcaps/TransportFieldCapabilitiesAction.java
core/src/main/java/org/elasticsearch/action/fieldcaps/TransportFieldCapabilitiesIndexAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/cluster/ClusterModule.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolver.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationService.java
core/src/main/java/org/elasticsearch/common/geo/ShapeRelation.java
core/src/main/java/org/elasticsearch/common/geo/SpatialStrategy.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java
core/src/main/java/org/elasticsearch/common/lucene/search/Queries.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/CombineFunction.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/FieldValueFactorFunction.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/FiltersFunctionScoreQuery.java
core/src/main/java/org/elasticsearch/common/util/ArrayUtils.java
core/src/main/java/org/elasticsearch/discovery/Discovery.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/single/SingleNodeDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/env/ESFileStore.java
core/src/main/java/org/elasticsearch/env/Environment.java
core/src/main/java/org/elasticsearch/env/NodeEnvironment.java
core/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java
core/src/main/java/org/elasticsearch/index/VersionType.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/ConstantIndexFieldData.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IndexFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/index/mapper/RangeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TypeFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/HasChildQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/HasParentQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/Operator.java
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/TypeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/monitor/fs/FsInfo.java
core/src/main/java/org/elasticsearch/monitor/fs/FsProbe.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/DiscoveryPlugin.java
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/main/java/org/elasticsearch/search/MultiValueMode.java
core/src/main/java/org/elasticsearch/search/aggregations/Aggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/children/ChildrenAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/GlobalOrdinalsStringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalMappedTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/LongTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/StringTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/Terms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/UnmappedTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentilesMethod.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/InnerHitsContext.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilder.java
core/src/main/java/org/elasticsearch/search/internal/AliasFilter.java
core/src/main/java/org/elasticsearch/search/rescore/QueryRescoreMode.java
core/src/main/java/org/elasticsearch/search/sort/ScriptSortBuilder.java
core/src/main/java/org/elasticsearch/search/sort/SortMode.java
core/src/main/java/org/elasticsearch/search/sort/SortOrder.java
core/src/main/java/org/elasticsearch/search/suggest/SortBy.java
core/src/main/java/org/elasticsearch/search/suggest/term/TermSuggestionBuilder.java
core/src/main/java/org/elasticsearch/transport/RemoteClusterAware.java
core/src/main/java/org/elasticsearch/transport/RemoteClusterConnection.java
core/src/main/java/org/elasticsearch/transport/RemoteClusterService.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStatsTests.java
core/src/test/java/org/elasticsearch/action/search/TransportSearchActionTests.java
core/src/test/java/org/elasticsearch/cluster/ClusterModuleTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolverTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/BalanceConfigurationTests.java
core/src/test/java/org/elasticsearch/common/io/stream/BytesStreamsTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryModuleTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/index/IndexServiceTests.java
core/src/test/java/org/elasticsearch/index/mapper/FieldNamesFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
core/src/test/java/org/elasticsearch/index/mapper/RangeFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/RangeFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/TypeFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/TypeFieldTypeTests.java
core/src/test/java/org/elasticsearch/indices/recovery/IndexRecoveryIT.java
core/src/test/java/org/elasticsearch/search/aggregations/CombiIT.java
core/src/test/java/org/elasticsearch/search/aggregations/EquivalenceIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DiversifiedSamplerIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DoubleTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/LongTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/MinDocCountIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SamplerIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/ShardSizeTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsSignificanceScoreIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/StringTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/TermsDocCountErrorIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/children/ParentToChildrenAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/AvgIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ExtendedStatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/GeoBoundsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MaxIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MinIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/StatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/SumIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/AvgBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/ExtendedStatsBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/MaxBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/MinBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/PercentilesBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/StatsBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/SumBucketIT.java
core/src/test/java/org/elasticsearch/test/NoopDiscovery.java
core/src/test/java/org/elasticsearch/transport/RemoteClusterConnectionTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4InternalESLogger.java
plugins/discovery-azure-classic/src/main/java/org/elasticsearch/plugin/discovery/azure/classic/AzureDiscoveryPlugin.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/discovery-gce/src/main/java/org/elasticsearch/plugin/discovery/gce/GceDiscoveryPlugin.java
plugins/repository-hdfs/src/main/java/org/elasticsearch/repositories/hdfs/HdfsBlobStore.java
plugins/repository-hdfs/src/main/java/org/elasticsearch/repositories/hdfs/HdfsPlugin.java
plugins/repository-hdfs/src/main/java/org/elasticsearch/repositories/hdfs/HdfsRepository.java
plugins/repository-hdfs/src/main/java/org/elasticsearch/repositories/hdfs/HdfsSecurityContext.java
test/framework/src/main/java/org/elasticsearch/cluster/ESAllocationTestCase.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
test/framework/src/main/java/org/elasticsearch/test/discovery/TestZenDiscovery.java
test/framework/src/main/java/org/elasticsearch/test/gateway/NoopGatewayAllocator.java
test/framework/src/main/java/org/elasticsearch/test/gateway/TestGatewayAllocator.java
comments:
Merge remote-tracking branch 'origin/master' into feature/client_aggs_parsing

time:
2017-05-05T18:00:39Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/GlobalOrdinalsStringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalMappedTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/LongTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/StringTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/Terms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/UnmappedTerms.java
core/src/test/java/org/elasticsearch/search/aggregations/CombiIT.java
core/src/test/java/org/elasticsearch/search/aggregations/EquivalenceIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DiversifiedSamplerIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DoubleTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/LongTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/MinDocCountIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SamplerIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/ShardSizeTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsSignificanceScoreIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/StringTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/TermsDocCountErrorIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/AvgIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ExtendedStatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/GeoBoundsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MaxIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MinIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/StatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/SumIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/AvgBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/ExtendedStatsBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/MaxBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/MinBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/PercentilesBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/StatsBucketIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/SumBucketIT.java
comments:
Change Terms.Bucket to an interface (#24492)

This commit changes the Terms.Bucket abstract class to an interface, so
that it's easier for the Java High Level Rest Client to provide its own
implementation.

In its current state, the Terms.Bucket abstract class inherits from
InternalMultiBucketAggregation.InternalBucket which forces subclasses to
implement Writeable and exposes a public getProperty() method that relies
on InternalAggregation. This two points make it difficult for the Java
High Level Rest Client to implement the Terms and Terms.Bucket correctly.
This is also different from other MultiBucketsAggregation like Range
which are pure interfaces.

Changing Terms.Bucket to an interface causes a method clashes for the
`getBuckets()` method in InternalTerms. This is because:
 - InternalTerms implements Terms which declared a
 `List<Terms.Bucket> getBuckets()` method
 - InternalTerms extends InternalMultiBucketAggregation which declares a
 `List<? extends InternalBucket> getBuckets()` method
 - both overrides the MultiBucketsAggregation
 `List<? extends Bucket> getBuckets()` method

 There was no clashes before this change because Terms.Bucket extends
 InternalBucket and conformed to both declaration. With Terms.Bucket now
 an interface, the getBuckets() method in the Terms interface is changed
 to avoid method clash. This is a breaking change in the Java API but
 it's a straightforward change and the Terms multi bucket aggregation
 interface is also more coherent with the other Range, Histogram,
 Filters, AdjacencyMatrix etc that all return a `List<? extends Bucket>`.

time:
2017-05-05T15:34:41Z
class:
comments:
Update completion-suggest.asciidoc (#24506)

time:
2017-05-05T14:43:42Z
class:
core/src/main/java/org/elasticsearch/index/mapper/RangeFieldMapper.java
core/src/test/java/org/elasticsearch/index/mapper/RangeFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/RangeFieldTypeTests.java
comments:
Add new ip_range field type

This commit adds support for indexing and searching a new ip_range field type. Both IPv4 and IPv6 formats are supported. Tests are updated and docs are added.

time:
2017-05-05T14:40:04Z
class:
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/common/util/ArrayUtils.java
core/src/test/java/org/elasticsearch/action/search/TransportSearchActionTests.java
comments:
Expand cross cluster search indices for search requests to the concrete index or to it's aliases (#24502)

This change will expand the shard level request to the actual concrete index or to the aliases
that expanded to the concrete index to ensure shard level requests won't see wildcard expressions as their original indices

time:
2017-05-05T14:07:20Z
class:
comments:
Fixed docs syntax for for-in loop in painless

time:
2017-05-05T14:02:26Z
class:
comments:
[TEST] Reenable disabled tests for _field_caps and _search_shards (#24505)

time:
2017-05-05T10:39:50Z
class:
comments:
Added release notes for 6.0.0-alpha1

time:
2017-05-05T10:39:50Z
class:
comments:
Added removal of JavaScript and Python to breaking changes

time:
2017-05-05T10:08:00Z
class:
comments:
Temporarily disable tests

time:
2017-05-05T09:56:03Z
class:
core/src/main/java/org/elasticsearch/action/fieldcaps/TransportFieldCapabilitiesIndexAction.java
comments:
Fix NPE if field caps request has a field that exists not in all indices (#24504)

If a field caps request contains a field name that doesn't exist in all indices
the response will be partial and we hide an NPE. The NPE is now fixed but we still
have the problem that we don't pass on errors on the shard level to the user. This will
be fixed in a followup.

time:
2017-05-05T09:08:55Z
class:
comments:
Fixed chunking of breaking changes docs

time:
2017-05-05T07:34:12Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/TransportClusterSearchShardsAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolver.java
core/src/test/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolverTests.java
comments:
Include all aliases including non-filtering in  `_search_shards` response (#24489)

`_search_shards`API today only returns aliases names if there is an alias
filter associated with one of them. Now it can be useful to see which aliases
have been expanded for an index given the index expressions. This change also includes non-filtering aliases even without a filtering alias being present.

time:
2017-05-05T06:39:18Z
class:
benchmarks/src/main/java/org/elasticsearch/benchmark/routing/allocation/Allocators.java
core/src/main/java/org/elasticsearch/cluster/ClusterModule.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationService.java
core/src/main/java/org/elasticsearch/discovery/Discovery.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/single/SingleNodeDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/DiscoveryPlugin.java
core/src/test/java/org/elasticsearch/cluster/ClusterModuleTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/BalanceConfigurationTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryModuleTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/test/NoopDiscovery.java
plugins/discovery-azure-classic/src/main/java/org/elasticsearch/plugin/discovery/azure/classic/AzureDiscoveryPlugin.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/discovery-gce/src/main/java/org/elasticsearch/plugin/discovery/gce/GceDiscoveryPlugin.java
test/framework/src/main/java/org/elasticsearch/cluster/ESAllocationTestCase.java
test/framework/src/main/java/org/elasticsearch/test/discovery/TestZenDiscovery.java
test/framework/src/main/java/org/elasticsearch/test/gateway/NoopGatewayAllocator.java
test/framework/src/main/java/org/elasticsearch/test/gateway/TestGatewayAllocator.java
comments:
Limit AllocationService dependency injection hack (#24479)

Changes the scope of the AllocationService dependency injection hack so that it is at least contained to the AllocationService and does not leak into the Discovery world.

time:
2017-05-05T04:49:18Z
class:
comments:
Remove obsolete JVM options from build

We start the test JVMs with various options. There are two that we
should remove, they do not make sense.
 - we require Java 8 yet there was a conditional build option for Java 7
 - we do not set MaxDirectMemorySize in our default JVM options, we
   should not in the test JVMs either

Relates #24501

time:
2017-05-05T01:04:35Z
class:
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
comments:
Fix typo in comment in IndexShardTestCase

This commit fixes a silly typo in IndexShardTestCase.java.

time:
2017-05-05T01:01:14Z
class:
comments:
CONSOLEify a few more docs

Adds CONSOLE to cross-cluster-search docs but skips them for testing
because we don't have a second cluster set up. This gets us the
`VIEW IN CONSOLE` and `COPY AS CURL` links and makes sure that they
are valid yaml (not json, technically) but doesn't get testing.
Which is better than we had before.

Adds CONSOLE to the dynamic templates docs and ingest-node docs.
The ingest-node docs contain a *ton* of non-console snippets. We
might want to convert them to full examples later, but that can be
a separate thing.

Relates to #18160

time:
2017-05-04T21:57:25Z
class:
comments:
Docs: rewrite the docs/README file

I originally wrote this file when we first added snippets testing
and a lot has changed. We've grown quite fond of the
`// TESTRESPONSE[s/foo/bar/]` construct, for example, but the docs
discouraged its use.

Relates to #18160

time:
2017-05-04T21:30:54Z
class:
comments:
CONSOLEify inner hits docs

Rewrites most of the snippets in the `innert_hits` docs to be
complete examples and enables `VIEW IN CONSOLE`, `COPY AS CURL`,
and automatic testing of the snippets.

time:
2017-05-04T17:11:09Z
class:
comments:
Test: Move flag to painless tests (#24494)

The `-XX:-OmitStackTraceInFastThrow` flag is only required by Painless's
tests so we'll only set it there. This is much simpler.

time:
2017-05-04T16:22:54Z
class:
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java
core/src/main/java/org/elasticsearch/common/geo/ShapeRelation.java
core/src/main/java/org/elasticsearch/common/geo/SpatialStrategy.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamOutput.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/CombineFunction.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/FieldValueFactorFunction.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/FiltersFunctionScoreQuery.java
core/src/main/java/org/elasticsearch/index/VersionType.java
core/src/main/java/org/elasticsearch/index/query/Operator.java
core/src/main/java/org/elasticsearch/search/MultiValueMode.java
core/src/main/java/org/elasticsearch/search/aggregations/Aggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentilesMethod.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilder.java
core/src/main/java/org/elasticsearch/search/rescore/QueryRescoreMode.java
core/src/main/java/org/elasticsearch/search/sort/ScriptSortBuilder.java
core/src/main/java/org/elasticsearch/search/sort/SortMode.java
core/src/main/java/org/elasticsearch/search/sort/SortOrder.java
core/src/main/java/org/elasticsearch/search/suggest/SortBy.java
core/src/main/java/org/elasticsearch/search/suggest/term/TermSuggestionBuilder.java
core/src/test/java/org/elasticsearch/common/io/stream/BytesStreamsTests.java
comments:
Add StreamInput.readEnum and StreamOutput.writeEnum (#24475)

Implements the common enum serialization/deserialization pattern for enumeration on the StreamInput/StreamOutput.

time:
2017-05-04T15:41:21Z
class:
comments:
Rewrote the github issue template to be shorter and more likely to be read (#24486)

time:
2017-05-04T15:19:41Z
class:
core/src/main/java/org/elasticsearch/env/ESFileStore.java
core/src/main/java/org/elasticsearch/env/Environment.java
core/src/main/java/org/elasticsearch/env/NodeEnvironment.java
core/src/main/java/org/elasticsearch/monitor/fs/FsInfo.java
core/src/main/java/org/elasticsearch/monitor/fs/FsProbe.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStatsTests.java
comments:
Simplify file store

Today we go to heroic lengths to workaround bugs in the JDK or around
issues like BSD jails to get information about the underlying file
store. For example, we went to lengths to work around a JDK bug where
the file store returned would incorrectly report whether or not a path
is writable in certain situations in Windows operating
systems. Another bug prevented getting file store information on
Windows on a virtual drive on Windows. We no longer need to work
around these bugs, we could simply try to write to disk and let an I/O
exception arise if we could not write to the disk or take advantage of
the fact that these bugs are fixed in recent releases of the JDK
(e.g., the file store bug is fixed since 8u72). Additionally, we
collected information about all file stores on the system which meant
that if the user had a stale NFS mount, Elasticsearch could hang and
fail on startup if that mount point was not available. Finally, we
collected information through Lucene about whether or not a disk was a
spinning disk versus an SSD, information that we do not need since we
assume SSDs by default. This commit takes into consideration that we
simply do not need this heroic effort, we do not need information
about all file stores, and we do not need information about whether or
not a disk spins to greatly simplfy file store handling.

Relates #24402

time:
2017-05-04T14:51:31Z
class:
plugins/repository-hdfs/src/main/java/org/elasticsearch/repositories/hdfs/HdfsBlobStore.java
plugins/repository-hdfs/src/main/java/org/elasticsearch/repositories/hdfs/HdfsPlugin.java
plugins/repository-hdfs/src/main/java/org/elasticsearch/repositories/hdfs/HdfsRepository.java
plugins/repository-hdfs/src/main/java/org/elasticsearch/repositories/hdfs/HdfsSecurityContext.java
comments:
Fixing permission errors for `KERBEROS` security mode for HDFS Repository (#23439)

Added missing permissions required for authenticating with Kerberos to HDFS. Also implemented 
code to support authentication in the form of using a Kerberos keytab file. In order to support 
HDFS authentication, users must install a Kerberos keytab file on each node and transfer it to the 
configuration directory. When a user specifies a Kerberos principal in the repository settings the 
plugin automatically enables security for Hadoop and begins the login process. There will be a 
separate PR and commit for the testing infrastructure to support these changes.

time:
2017-05-04T14:49:49Z
class:
comments:
Docs: fix list of testing images

Fedora-24 is gone. Long live Fedora-25.

time:
2017-05-04T14:41:20Z
class:
core/src/test/java/org/elasticsearch/index/IndexServiceTests.java
comments:
Fix reschedule async fsync test

This commit fixes the reschedule async fsync test in index service
tests. This test was passing for the wrong reason. Namely, the test was
trying to set translog durability to async, fire off an indexing
request, and then assert that the translog eventually got fsynced. The
problem here is that in the course of issuing the indexing request, a
mapping update is trigger. The mapping update triggers the index
settings to be refreshed. Since the test did not issue a cluster state
update to change the durability from request to async but instead did
this directly through index service, the mapping update flops the
durability back to async. This means that when the indexing request
executes, an fsync is performed after the request and the assertoin that
an fsync is not needed passes but for the wrong reason (in short: the
test wanted it to pass because an async fsync fired, but instead it
passed because a request async fired). This commit fixes this by going
through the index settings API so that a proper cluster state update is
triggered and so the mapping update does not flop the durability back to
request.

time:
2017-05-04T14:33:42Z
class:
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
comments:
Remove global checkpoint assertion in index shard

Due to races, this assertion in index shard can be wrong. This commit
removes that assertion and adjusts the explanatory comment.

time:
2017-05-04T14:29:35Z
class:
core/src/main/java/org/elasticsearch/common/lucene/search/Queries.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/ConstantIndexFieldData.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IndexFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TypeFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/HasChildQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/HasParentQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/TypeQueryBuilder.java
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/children/ChildrenAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/InnerHitsContext.java
core/src/test/java/org/elasticsearch/index/mapper/FieldNamesFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
core/src/test/java/org/elasticsearch/index/mapper/TypeFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/TypeFieldTypeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/children/ParentToChildrenAggregatorTests.java
comments:
Do not index `_type` when there is at most one type. (#24363)

This change makes `_type` behave pretty much like `_index` when
`index.mapping.single_type` is true.

time:
2017-05-04T14:17:55Z
class:
comments:
Add Vagrant based testing fixture (#24249)

time:
2017-05-04T13:57:18Z
class:
comments:
 Add 5.4.0 to bwc versions

time:
2017-05-04T13:23:19Z
class:
core/src/test/java/org/elasticsearch/indices/recovery/IndexRecoveryIT.java
comments:
Change logging level on reroute test

We are still chasing a test failure here and increasing the logging
level stopped the failures. We have a theory as to what is going on so
this commit reduces the logging level to hopefully trigger the failure
again and give us the logging that we need to confirm the theory.

time:
2017-05-04T12:50:05Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
Bump the Lucene version for ES V5_4_1

time:
2017-05-04T12:29:59Z
class:
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/search/internal/AliasFilter.java
comments:
[TEST] Add a test that alias requests are dense for all indices

time:
2017-05-04T12:14:22Z
class:
comments:
[TEST] Rollback temporarily disabled field_caps test (#24483)

time:
2017-05-04T11:29:35Z
class:
comments:
Tests: Switch to fedora-25 in test plugin

Use fedora-25 Vagrant box in VagrantTestPlugin, which was missing from
9a3ab3e8000be059ccf4edeee53b62ddb5913fc6 causing packaging test
failures.

Additionally update TESTING.asciidoc

time:
2017-05-04T11:29:03Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
Add version for 5.4.1 and bwc indices for 5.4.0

time:
2017-05-04T09:52:07Z
class:
core/src/main/java/org/elasticsearch/action/fieldcaps/FieldCapabilitiesResponse.java
comments:
Use V_5_5_UNRELEASED constant consitently on both request and response

time:
2017-05-04T09:44:54Z
class:
core/src/main/java/org/elasticsearch/action/fieldcaps/FieldCapabilitiesIndexResponse.java
core/src/main/java/org/elasticsearch/action/fieldcaps/FieldCapabilitiesRequest.java
core/src/main/java/org/elasticsearch/action/fieldcaps/FieldCapabilitiesResponse.java
core/src/main/java/org/elasticsearch/action/fieldcaps/TransportFieldCapabilitiesAction.java
core/src/main/java/org/elasticsearch/action/fieldcaps/TransportFieldCapabilitiesIndexAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/transport/RemoteClusterAware.java
core/src/main/java/org/elasticsearch/transport/RemoteClusterConnection.java
core/src/main/java/org/elasticsearch/transport/RemoteClusterService.java
core/src/test/java/org/elasticsearch/transport/RemoteClusterConnectionTests.java
comments:
Add cross cluster support to `_field_caps` (#24463)

To support kibana this commit adds an internal optimization
to support the cross cluster syntax for indices on the `_field_caps`
API.

Closes #24334

time:
2017-05-04T09:04:53Z
class:
comments:
Tests: Switch to Fedora-25 for packaging tests

Switch the Fedora Vagrant box for packaging tests to Fedora-25 as
Fedora-24 will become EOL one month after Fedora-26 is out.

Relates #24466

time:
2017-05-04T08:27:50Z
class:
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
comments:
Enforce at most one type. (#24428)

This is a follow-up to #24317, which did the hard work but was merged in such a
way that it exposes the setting while still allowing indices to have multiple
types by default in order to give time to people who test against master to
add this setting to their index settings.

time:
2017-05-04T02:58:43Z
class:
comments:
[DOCS] Fixes the documentation on leading forward slashes in the (#24478)

[DOCS] Fixes the documentation on leading forward slashes in the
base_path of S3 repositories

Closes #23435

time:
2017-05-04T00:59:27Z
class:
comments:
CONSOLEify remaining _cat docs

Relates to #18160

time:
2017-05-04T00:11:41Z
class:
core/src/test/java/org/elasticsearch/indices/recovery/IndexRecoveryIT.java
comments:
Increase logging in IndexRecoveryIT#rerouteTest

This test started failing but the logging here is insufficient to
discern what is happening. This commit increases the logging level on
this test until the failure can be understood.

time:
2017-05-03T22:51:50Z
class:
comments:
Revise issue template

This commit revises the issue template, hoping to make it clearer that
following the guidelines is a really good thing to do.

Relates #24470

time:
2017-05-03T22:49:08Z
class:
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4InternalESLogger.java
comments:
You had one job Netty logging guard

In pre-release versions of Elasticsearch 5.0.0, users were subject to
log messages of the form "your platform does not.*reliably.*potential
system instability". This is because we disable Netty from being unsafe,
and Netty throws up this scary info-level message when unsafe is
unavailable, even if it was unavailable because the user requested that
it be unavailabe. Users were rightly confused, and concerned. So, we
contributed a guard to Netty to prevent this log message from showing up
when unsafe was explicitly disabled. This guard shipped with all
versions of Netty that shipped starting with Elasticsearch
5.0.0. Unfortunately, this guard was lost in an unrelated refactoring
and now with the 4.1.10.Final upgrade, users will again see this
message. This commit is a hack around this until we can get a fix
upstream again.

Relates #24469

time:
2017-05-03T20:04:06Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java
core/src/main/java/org/elasticsearch/action/ActionRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/remote/RemoteInfoResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/remote/TransportRemoteInfoAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/close/CloseIndexRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/open/OpenIndexRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/shards/TransportIndicesShardStoresAction.java
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/DfsQueryPhase.java
core/src/main/java/org/elasticsearch/action/search/FetchSearchPhase.java
core/src/main/java/org/elasticsearch/action/search/InitialSearchPhase.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseContext.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchShardIterator.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/ShardSearchFailure.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/action/support/AbstractListenableActionFuture.java
core/src/main/java/org/elasticsearch/action/support/PlainListenableActionFuture.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/discovery/zen/DiscoveryNodesProvider.java
core/src/main/java/org/elasticsearch/discovery/zen/PingContextProvider.java
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenPing.java
core/src/main/java/org/elasticsearch/gateway/AsyncShardFetch.java
core/src/main/java/org/elasticsearch/gateway/GatewayMetaState.java
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointTracker.java
core/src/main/java/org/elasticsearch/index/seqno/SequenceNumbersService.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/translog/ChannelFactory.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTargetHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTranslogOperationsResponse.java
core/src/main/java/org/elasticsearch/indices/recovery/RemoteRecoveryTargetHandler.java
core/src/main/java/org/elasticsearch/monitor/jvm/JvmInfo.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/MetaDataUpgrader.java
core/src/main/java/org/elasticsearch/plugins/Plugin.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/search/SearchHit.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/SearchShardTarget.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregator.java
core/src/main/java/org/elasticsearch/transport/RemoteClusterAware.java
core/src/main/java/org/elasticsearch/transport/RemoteClusterConnection.java
core/src/main/java/org/elasticsearch/transport/RemoteClusterService.java
core/src/main/java/org/elasticsearch/transport/RemoteConnectionInfo.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/ElasticsearchExceptionTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TasksIT.java
core/src/test/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsTests.java
core/src/test/java/org/elasticsearch/action/search/AbstractSearchAsyncActionTests.java
core/src/test/java/org/elasticsearch/action/search/DfsQueryPhaseTests.java
core/src/test/java/org/elasticsearch/action/search/ExpandSearchPhaseTests.java
core/src/test/java/org/elasticsearch/action/search/FetchSearchPhaseTests.java
core/src/test/java/org/elasticsearch/action/search/MockSearchPhaseContext.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
core/src/test/java/org/elasticsearch/action/search/ShardSearchFailureTests.java
core/src/test/java/org/elasticsearch/action/search/TransportSearchActionTests.java
core/src/test/java/org/elasticsearch/action/support/ActiveShardsObserverIT.java
core/src/test/java/org/elasticsearch/action/support/ListenableActionFutureTests.java
core/src/test/java/org/elasticsearch/action/support/TransportActionFilterChainTests.java
core/src/test/java/org/elasticsearch/client/AbstractClientHeadersTestCase.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientRetryIT.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeServiceTests.java
core/src/test/java/org/elasticsearch/discovery/single/SingleNodeDiscoveryIT.java
core/src/test/java/org/elasticsearch/discovery/zen/PublishClusterStateActionTests.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/gateway/AsyncShardFetchTests.java
core/src/test/java/org/elasticsearch/gateway/GatewayMetaStateTests.java
core/src/test/java/org/elasticsearch/gateway/PrimaryShardAllocatorTests.java
core/src/test/java/org/elasticsearch/gateway/ReplicaShardAllocatorTests.java
core/src/test/java/org/elasticsearch/index/WaitUntilRefreshIT.java
core/src/test/java/org/elasticsearch/index/query/QueryDSLDocumentationTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java
core/src/test/java/org/elasticsearch/index/seqno/GlobalCheckpointTests.java
core/src/test/java/org/elasticsearch/index/seqno/GlobalCheckpointTrackerTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/indices/IndicesOptionsIntegrationIT.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
core/src/test/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetServiceTests.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySourceHandlerTests.java
core/src/test/java/org/elasticsearch/indices/state/OpenCloseIndexIT.java
core/src/test/java/org/elasticsearch/search/SearchCancellationIT.java
core/src/test/java/org/elasticsearch/search/SearchHitTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregatorTests.java
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/MinThreadsSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/transport/RemoteClusterConnectionTests.java
core/src/test/java/org/elasticsearch/transport/RemoteClusterServiceTests.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Def.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ArrayLikeObjectTestCase.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ArrayTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ListTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ScriptTestCase.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/StringTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorQuerySearchIT.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/CancelTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RethrottleTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RetryTests.java
qa/wildfly/src/test/java/org/elasticsearch/wildfly/WildflyIT.java
test/framework/src/main/java/org/elasticsearch/test/gateway/TestGatewayAllocator.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
comments:
Merge branch 'master' into feature/client_aggs_parsing

time:
2017-05-03T16:51:41Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeService.java
core/src/main/java/org/elasticsearch/gateway/GatewayMetaState.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/MetaDataUpgrader.java
core/src/main/java/org/elasticsearch/plugins/Plugin.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeServiceTests.java
core/src/test/java/org/elasticsearch/gateway/GatewayMetaStateTests.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
comments:
Allow plugins to upgrade templates and index metadata on startup (#24379)

The UpgraderPlugin adds two additional extension points called during cluster upgrade and when old indices are introduced into the cluster state during initial recovery, restore from a snapshot or as a dangling index. One extension point allows plugin to update old templates and another extension points allows to update/check index metadata.

time:
2017-05-03T15:30:54Z
class:
core/src/main/java/org/elasticsearch/action/support/AbstractListenableActionFuture.java
core/src/main/java/org/elasticsearch/action/support/PlainListenableActionFuture.java
core/src/test/java/org/elasticsearch/action/support/ListenableActionFutureTests.java
core/src/test/java/org/elasticsearch/action/support/TransportActionFilterChainTests.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientRetryIT.java
comments:
Add non-dispatching listenable action future (#24412)

Currently the only implementation of `ListenableActionFuture` requires
dispatching listener execution to a thread pool. This commit renames
that variant to `DispatchingListenableActionFuture` and converts
`AbstractListenableActionFuture` to be a variant that does not require
dispatching. That class is now named `PlainListenableActionFuture`.

time:
2017-05-03T14:44:14Z
class:
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorQuerySearchIT.java
comments:
Fix PercolatorQuerySearchIT to not create multiple types.

time:
2017-05-03T14:29:51Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/DiscoveryNodesProvider.java
core/src/main/java/org/elasticsearch/discovery/zen/PingContextProvider.java
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenPing.java
core/src/test/java/org/elasticsearch/discovery/single/SingleNodeDiscoveryIT.java
core/src/test/java/org/elasticsearch/discovery/zen/PublishClusterStateActionTests.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
comments:
Remove DiscoveryNodesProvider interface (#24461)

The DiscoveryNodesProvider interface provides an unnecessary abstraction and is just used in conjunction with the existing PingContextProvider interface. This commit removes it.

time:
2017-05-03T14:22:26Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/close/CloseIndexRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/open/OpenIndexRequest.java
core/src/test/java/org/elasticsearch/indices/IndicesOptionsIntegrationIT.java
core/src/test/java/org/elasticsearch/indices/state/OpenCloseIndexIT.java
comments:
Open/Close index api to allow_no_indices by default (#24401)

Open/Close index api have allow_no_indices set to false by default, while delete index has it set to true. The flag controls where a wildcard expression that matches no indices will be ignored or an error will be thrown instead. This commit aligns open/close default behaviour to that of delete index.

time:
2017-05-03T13:22:24Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
comments:
Remove unnecessary field from UnicastZenPing

This field was only ever used in the constructor, where it was set and
then passed around. As such, there's no need for it to be a field and we
can remove it.

time:
2017-05-03T13:00:44Z
class:
comments:
fix typo in migrate_6_0/java.asciidoc

time:
2017-05-03T11:27:31Z
class:
comments:
Docs: Update production notes for Docker

Add info about the base image used and the github repo of
elasticsearch-docker.

Clarify that setting `memlock=-1:-1` is only a requirement when
`bootstrap_memory_lock=true` and the alternatives we document
elsewhere in docs for disabling swap are valid for Docker as well.

Additionally, with latest versions of docker-ce shipping with
unlimited (or high enough) defaults for `nofile` and `nproc`, clarify
that explicitly setting those per ES container is not required, unless
they are not defined in the Docker daemon.

Finally simplify production `docker-compose.yml` example by removing
unneeded options.

Relates #24389

time:
2017-05-03T11:27:20Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/XContentParserUtils.java
core/src/main/java/org/elasticsearch/search/aggregations/ParsedMultiBucketAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/ParsedDateHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/ParsedHistogram.java
core/src/main/java/org/elasticsearch/search/suggest/Suggest.java
core/src/test/java/org/elasticsearch/common/xcontent/XContentParserUtilsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalMultiBucketAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogramTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogramTests.java
comments:
Add parsing methods for InternalDateHistogram and InternalHistogram (#24213)

time:
2017-05-03T10:48:09Z
class:
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointTracker.java
core/src/main/java/org/elasticsearch/index/seqno/SequenceNumbersService.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/translog/ChannelFactory.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTargetHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTranslogOperationsResponse.java
core/src/main/java/org/elasticsearch/indices/recovery/RemoteRecoveryTargetHandler.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java
core/src/test/java/org/elasticsearch/index/seqno/GlobalCheckpointTests.java
core/src/test/java/org/elasticsearch/index/seqno/GlobalCheckpointTrackerTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetServiceTests.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySourceHandlerTests.java
comments:
Block global checkpoint advances when recovering

After a replica shard finishes recovery, it will be marked as active and
its local checkpoint will be considered in the calculation of the global
checkpoint on the primary. If there were operations in flight during
recovery, when the replica is activated its local checkpoint could be
lagging behind the global checkpoint on the primary. This means that
when the replica shard is activated, we can end up in a situtaion where
a global checkpoint update would want to move the global checkpoint
backwards, violating an invariant of the system. This only arises if a
background global checkpoint sync executes, which today is only a
scheduled operation and might be delayed until the in-flight operations
complete and the replica catches up to the primary. Yet, we are going to
move to inlining global checkpoints which will cause this issue to be
more likely to manifest. Additionally, the global checkpoint on the
replica, which is the local knowledge on the replica updated under the
mandate of the primary, could be higher than the local checkpoint on the
replica, again violating an invariant of the system. This commit
addresses these issues by blocking global checkpoint on the primary when
a replica shard is finalizing recovery. While we have blocked global
checkpoint advancement, recovery on the replica shard will not be
considered complete until its local checkpoint advances to the blocked
global checkpoint.

Relates #24404

time:
2017-05-03T10:03:30Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/DfsQueryPhase.java
core/src/main/java/org/elasticsearch/action/search/FetchSearchPhase.java
core/src/main/java/org/elasticsearch/action/search/InitialSearchPhase.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseContext.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchShardIterator.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/ShardSearchFailure.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/search/SearchHit.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/SearchShardTarget.java
core/src/test/java/org/elasticsearch/ElasticsearchExceptionTests.java
core/src/test/java/org/elasticsearch/action/search/AbstractSearchAsyncActionTests.java
core/src/test/java/org/elasticsearch/action/search/DfsQueryPhaseTests.java
core/src/test/java/org/elasticsearch/action/search/ExpandSearchPhaseTests.java
core/src/test/java/org/elasticsearch/action/search/FetchSearchPhaseTests.java
core/src/test/java/org/elasticsearch/action/search/MockSearchPhaseContext.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
core/src/test/java/org/elasticsearch/action/search/ShardSearchFailureTests.java
core/src/test/java/org/elasticsearch/action/search/TransportSearchActionTests.java
core/src/test/java/org/elasticsearch/search/SearchHitTests.java
comments:
Preserve cluster alias throughout search execution to lookup nodes by cluster and ID (#24438)

today we only lookup nodes by their ID but never by the (clusterAlias, nodeId) tuple.
This could in theory lead to lookups on the wrong cluster if there are 2 clusters
with a node that has the same ID. It's very unlikely to happen but we now can clearly
disambiguate between clusters and their nodes.

time:
2017-05-03T09:42:06Z
class:
core/src/test/java/org/elasticsearch/action/support/TransportActionFilterChainTests.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientRetryIT.java
comments:
[TEST] Remove unnecessary usages of ListenableActionFuture

time:
2017-05-03T09:20:53Z
class:
core/src/main/java/org/elasticsearch/action/ActionRequestBuilder.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TasksIT.java
core/src/test/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsTests.java
core/src/test/java/org/elasticsearch/action/support/ActiveShardsObserverIT.java
core/src/test/java/org/elasticsearch/client/AbstractClientHeadersTestCase.java
core/src/test/java/org/elasticsearch/index/WaitUntilRefreshIT.java
core/src/test/java/org/elasticsearch/search/SearchCancellationIT.java
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/MinThreadsSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/CancelTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RethrottleTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RetryTests.java
comments:
Java api: ActionRequestBuilder#execute to return a PlainActionFuture (#24415)

This change makes the request builder code-path same as `Client#execute`. The request builder used to return a `ListenableActionFuture` when calling execute, which allows to associate listeners with the returned future. For async execution though it is recommended to use the `execute` method that accepts an `ActionListener`, like users would do when using `Client#execute`.

Relates to #24412
Relates to #9201

time:
2017-05-03T08:45:31Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchResponse.java
core/src/main/java/org/elasticsearch/action/search/SearchResponseSections.java
core/src/main/java/org/elasticsearch/search/aggregations/Aggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/Aggregations.java
core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregations.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchResponse.java
comments:
Introduce SearchResponseSections base class (#24442)

SearchResponseSections is the common part extracted from InternalSearchResponse that can be shared between high level REST and elasticsearch. The only bits left out are around serialization which is not supported. This way it can accept Aggregations as a constructor argument, without requiring InternalAggregations, as the high level REST client uses its own objects for aggs parsing rather than internal ones.

This change also makes Aggregations implement ToXContent, and Aggregation extend ToXContent. Especially the latter is suboptimal but the best solution that allows to share as much code as possible between core and the client, that doesn't require messing with generics and making the api complicated. Also it doesn't have downsides as all of the current implementations of Aggregation do implement ToXContent already.

time:
2017-05-03T07:47:21Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/shards/TransportIndicesShardStoresAction.java
core/src/main/java/org/elasticsearch/gateway/AsyncShardFetch.java
core/src/test/java/org/elasticsearch/gateway/AsyncShardFetchTests.java
core/src/test/java/org/elasticsearch/gateway/PrimaryShardAllocatorTests.java
core/src/test/java/org/elasticsearch/gateway/ReplicaShardAllocatorTests.java
test/framework/src/main/java/org/elasticsearch/test/gateway/TestGatewayAllocator.java
comments:
Discard stale node responses from async shard fetching (#24434)

Async shard fetching only uses the node id to correlate responses to requests. This can lead to a situation where a response from an earlier request is mistaken as response from a new request when a node is restarted. This commit adds unique round ids to correlate responses to requests.

time:
2017-05-03T02:25:52Z
class:
core/src/main/java/org/elasticsearch/monitor/jvm/JvmInfo.java
comments:
Show JVM arguments

We often want the JVM arguments used for a running instance of
Elasticsearch. It sure would be nice if these came as part of the nodes
API, or any API that includes JVM info. This commit causes these
arguments to be displayed.

Relates #24450

time:
2017-05-03T01:33:24Z
class:
core/src/main/java/org/elasticsearch/node/Node.java
comments:
Log JVM arguments on startup

These can be very useful to have, let's have them at our fingertips in
the logs (in case the JVM dies and we can no longer retrieve them, at
least they are here).

Relates #24451

time:
2017-05-02T23:59:07Z
class:
comments:
Fix JVM test argline (#24448)

* Fix JVM test argline

The argline was being overridden by '-XX:-OmitStackTraceInFastThrow'
which led to test failures that were expecting the JVM to be in a
certain state based on the value of tests.jvm.argline but they were not
since these arguments were never passed to the JVM. Additionally, we
need to respect the provided JVM argline if it is already provided with
a flag for OmitStackTraceInFastThrow. This commit fixes this by only
setting OmitStackTraceInFastThrow if it is not already set.

* Add comment

* Fix comment

* More elaborate comment

* Sigh

time:
2017-05-02T18:25:09Z
class:
comments:
Check index sorting with no replica since we cannot ensure that the replica index is ready when forceMerge is called. Closes #24416

time:
2017-05-02T17:01:30Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java
comments:
Docs: correct indentation on callout

I've aligned them all to 70 characters except this one....

Relates to #24354

time:
2017-05-02T17:00:56Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/QueryDSLDocumentationTests.java
core/src/test/java/org/elasticsearch/index/query/QueryDSLDocumentationTests.java
comments:
Build that java api docs from a test (#24354)

We've had `QueryDSLDocumentationTests` for a while but it had a very
hopeful comment at the top about how we want to make sure that the
example in the query-dsl docs match up with the test but we never
had anything that made *sure* that they did. This changes that!

Now the examples from the query-dsl docs are all built from the
`QueryDSLDocumentationTests`. All except for the percolator example
because that is hard to do as it stands now.

To make this easier this change moves `QueryDSLDocumentationTests`
from core and into the high level rest client. This is useful for
two reasons:
1. We expect the high level rest client to be able to use the builders.
2. The code that builds that docs doesn't check out all of
Elasticsearch. It only checks out certain directories. Since we're
already including snippets from that directory we don't have to
make any changes to that process.

Closes #24320

time:
2017-05-02T16:09:32Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/remote/RemoteInfoResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/remote/TransportRemoteInfoAction.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/transport/RemoteClusterAware.java
core/src/main/java/org/elasticsearch/transport/RemoteClusterConnection.java
core/src/main/java/org/elasticsearch/transport/RemoteClusterService.java
core/src/main/java/org/elasticsearch/transport/RemoteConnectionInfo.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
core/src/test/java/org/elasticsearch/action/search/TransportSearchActionTests.java
core/src/test/java/org/elasticsearch/transport/RemoteClusterConnectionTests.java
core/src/test/java/org/elasticsearch/transport/RemoteClusterServiceTests.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
comments:
Move RemoteClusterService into TransportService (#24424)

TransportService and RemoteClusterService are closely coupled already today
and to simplify remote cluster integration down the road it can be a direct
dependency of TransportService. This change moves RemoteClusterService into
TransportService with the goal to make it a hidden implementation detail
of TransportService in followup changes.

time:
2017-05-02T15:56:49Z
class:
qa/wildfly/src/test/java/org/elasticsearch/wildfly/WildflyIT.java
comments:
Fix license header in WildflyIT.java

The license header in this file was after and on the same line as the
package statement. This commit moves the package statement to be after
the license header.

time:
2017-05-02T15:34:12Z
class:
modules/lang-painless/src/test/java/org/elasticsearch/painless/ArrayLikeObjectTestCase.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ListTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ScriptTestCase.java
comments:
Try not to lose stacktraces (#24426)

This adds `-XX:-OmitStackTraceInFastThrow` to the JVM arguments
which *should* prevent the JVM from omitting stack traces on
common exception sites. Even though these sites are common, we'd
still like the exceptions to debug them.

This also adds the flag when running tests and adapts some tests
that had workarounds for the absense of the flag.

Closes #24376

time:
2017-05-02T15:33:29Z
class:
comments:
[DOCS] Update XPack Reference URL for 5.4 (#24425)

time:
2017-05-02T15:08:51Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/Def.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ArrayTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/StringTests.java
comments:
Painless: Add tests to check for existence and correct detection of the special Java 9 optimizations: Indified String concat and MethodHandles#ArrayLengthHelper() (#24405)

time:
2017-05-02T14:02:36Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterAware.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterServiceTests.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
comments:
Extract a common base class to allow services to listen to remote cluster config updates (#24367)

RemoteClusterService is an internal service that should not necessarily be exposed
to plugins or other parts of the system. Yet, for cluster name parsing for instance
it is crucial to reuse some code that is used for the RemoteClusterService. This
change extracts a base class that allows to share the settings related code as well
as cluster settings updates to `search.remote.*` to be observed by other services.

time:
2017-05-02T13:56:05Z
class:
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
comments:
Adds check to snapshot repository incompatible-snapshots blob to delete
a pre-existing one before attempting to overwrite it.

time:
2017-05-02T12:25:03Z
class:
comments:
Added docs for batched_reduce_size

Relates to #23288

time:
2017-05-02T10:48:30Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/alias/IndicesAliasesRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/TransportIndicesAliasesAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/close/TransportCloseIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/open/TransportOpenIndexAction.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsShardRequest.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java
core/src/main/java/org/elasticsearch/cluster/DiffableUtils.java
core/src/main/java/org/elasticsearch/common/blobstore/BlobPath.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestThreadPoolAction.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotUtils.java
core/src/test/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryIT.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
core/src/test/java/org/elasticsearch/indices/state/OpenCloseIndexIT.java
core/src/test/java/org/elasticsearch/repositories/blobstore/BlobStoreRepositoryTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalExtendedStatsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/HDRPercentilesAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/TDigestPercentilesAggregatorTests.java
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Compiler.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/LambdaBootstrap.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/WriterConstants.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/FunctionRefTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Utils.java
plugins/analysis-phonetic/src/main/java/org/elasticsearch/index/analysis/phonetic/KoelnerPhonetik.java
test/framework/src/main/java/org/elasticsearch/script/MockScriptEngine.java
comments:
Merge branch 'master' into feature/client_aggs_parsing

time:
2017-05-02T10:37:36Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregatorTests.java
comments:
Fixes checkstyle errors

time:
2017-05-02T10:24:23Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregator.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregatorTests.java
comments:
Allow scripted metric agg to access `_score` (#24295)

* Fixes #24259

Corrects the ScriptedMetricAggregator so that the script can have
access to scores during the map stage.

* Restored original tests. Added seperate test.

As requested, I've restored the non-score dependant tests, and added the
score dependent metric as a seperate test.

time:
2017-05-02T08:55:45Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/HDRPercentilesAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/TDigestPercentilesAggregatorTests.java
comments:
[Test] Add unit tests for HDR/TDigest PercentilesAggregators (#24245)

Relates to #22278

time:
2017-05-02T08:14:47Z
class:
comments:
Fix FieldCaps documentation

Fix the expected output for field_caps call.
Fixes #24413

time:
2017-05-02T07:58:21Z
class:
comments:
Upgrade to JUnit 4.12 (#23877)

* Upgrade to JUnit 4.12
* Add permission to junit 4.12 and remove junit4-ant specific permission

time:
2017-05-01T23:27:28Z
class:
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Utils.java
comments:
Set available processors for Netty

Netty uses the number of processors for sizing various resources (e.g.,
thread pools, buffer pools, etc.). However, it uses the runtime number
of available processors which might not match the configured number of
processors as set in Elasticsearch to limit the number of threads (for
example, in Docker containers). A new feature was added to Netty that
enables configuring the number of processors Netty should see for sizing
this various resources. This commit takes advantage of this feature to
set this number of available processors to be equal to the configured
number of processors set in Elasticsearch.

Relates #24420

time:
2017-05-01T23:15:13Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/Compiler.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/LambdaBootstrap.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/WriterConstants.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/FunctionRefTests.java
comments:
Painless: Fix method references to ctor with the new LambdaBootstrap and cleanup code (#24406)

* Fix wrong delegation to constructors when compiling lambdas with method references to ctors. Also remove the get$lambda factory.
* Cleanup code and remove unneeded transformations between binary and internal class names (uses ASM Type class instead)
* Cleanup Exception handling
* Simplification by moving the type adaption to the outside
* Remove STATIC access flag from our Lambda class (not required and also officially not allowed)
* Move the lambda counter to the classloader, so we have a per-script lambda ID
* Change Codesource of generated lambdas to be consistent

time:
2017-05-01T19:49:00Z
class:
comments:
Doc test: use propery regex for file size

The _cat/shards docs asserted that one of the columns looked like
a propery byte size but used a regex like `\d+\.\d+.*` which doesn't
match `0b` which is a possible value. Instead this uses
`\d(\.\d+)?[kmg]?b`.

time:
2017-05-01T19:15:32Z
class:
comments:
[DOCS] Tweak doc test to sync_flush

The response is attempting to illustrate the sync_id marker, but in
the test the index is too "fresh" to have a sync marker. So the test
needs to execute a sync flush behind the scenes so that the marker
is present

time:
2017-05-01T19:09:21Z
class:
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/test/java/org/elasticsearch/repositories/blobstore/BlobStoreRepositoryTests.java
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
comments:
Ensure every repository has an incompatible-snapshots blob (#24403)

In #22267, we introduced the notion of incompatible snapshots in a
repository, and they were stored in a root-level blob named
`incompatible-snapshots`.  If there were no incompatible snapshots in
the repository, then there was no `incompatible-snapshots` blob.

However, this causes a problem for some cloud-based repositories,
because if the blob does not exist, the cloud-based repositories may
attempt to keep retrying the read of a non-existent blob with
expontential backoff until giving up.  This causes performance issues
(and potential timeouts) on snapshot operations because getting the
`incompatible-snapshots` is part of getting the repository data (see
RepositoryData#getRepositoryData()).

This commit fixes the issue by creating an empty
`incompatible-snapshots` blob in the repository if one does not exist.

time:
2017-05-01T18:50:13Z
class:
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
comments:
Test: more logging for refresh listeners many threads test

This test fails from time to time but doesn't give enough information
for me to figure out what caused the assertion to fail.

Relates to #24418

time:
2017-05-01T17:59:06Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/alias/IndicesAliasesRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/alias/TransportIndicesAliasesAction.java
comments:
Move IndicesAliasesRequest#concreteAliases to TransportIndicesAliasesAction (#24400)

This method has to do with how the transport action may or may not resolve wildcards expressions to aliases names. It is only needed in TransportIndicesAliasesAction and for this reason it should be a private method in it rather than part of a request class which is also part of the Java API and later in the high level REST client.

time:
2017-05-01T17:56:39Z
class:
comments:
CONSOLEify some more Indices APIs (#24375)

* CONSOLEify doc testing for some more Indices APIs

Related to #18160

time:
2017-05-01T17:33:24Z
class:
comments:
CONSOLEify Stats Aggregation docs (#24373)

time:
2017-05-01T17:30:51Z
class:
comments:
Re-enable doc testing for Pipeline Aggregations (#24374)

* Re-enable doc testing for Pipeline Aggregations

Also adds a response + test for movavg pipeline

time:
2017-05-01T15:46:55Z
class:
core/src/test/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsTests.java
comments:
Test: extra debugging for refresh listeners stats

This test failed in CI but didn't give us enough information to
debug it:
https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+nfs/223/consoleFull

This turns on more debugging and make the test fail more quickly
if something is obviously wrong.

time:
2017-05-01T14:25:32Z
class:
comments:
Upgrade Netty to 4.1.10.Final

This commit upgrades the Netty dependency from version 4.1.9.Final to
version 4.1.10.Final.

Relates #24414

time:
2017-05-01T12:38:14Z
class:
comments:
[TEST] fix _cat/allocation index size check

The check expected the size of the index to always be returned in bytes, but that can possibly be kb, mb, gb and tb depending on the actual size.

time:
2017-05-01T01:26:51Z
class:
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsShardRequest.java
core/src/main/java/org/elasticsearch/client/transport/TransportClient.java
core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java
core/src/main/java/org/elasticsearch/cluster/DiffableUtils.java
core/src/main/java/org/elasticsearch/common/blobstore/BlobPath.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestThreadPoolAction.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotUtils.java
plugins/analysis-phonetic/src/main/java/org/elasticsearch/index/analysis/phonetic/KoelnerPhonetik.java
test/framework/src/main/java/org/elasticsearch/script/MockScriptEngine.java
comments:
Cleanup collections construction

This commit cleans up some cases where a list or map was being
constructed, and then an existing collection was copied into the new
collection. The clean is to instead use an appropriate constructor to
directly copy the existing collection in during collection
construction. The advantage of this is that the new collection is sized
appropriately.

Relates #24409

time:
2017-04-30T16:43:04Z
class:
comments:
Remove duplicates from checkstyle suppressions

This commit removes a few duplicates from the list of checkstyle
suppressions that accumulated while auto-generating the list of
suppressions based on the files that currently exceed the 140-column
limit.

time:
2017-04-30T16:15:54Z
class:
comments:
Remove errant entry in checkstyle suppressions

The list of checkstyle suppressions was auto-generated based on the list
of files that currently violate the 140-column limit. An errant entry
was committed that did no harm, but this commit removes it.

time:
2017-04-30T16:11:57Z
class:
comments:
Adjust checkstyle suppressions to 140-column limit

We are back to having a 140-column limit. While at some point we will
apply auto-formatting tools to the code base, that is a down-the-road
thing and adjusting the suppressions now shaves minutes off the build
time.

Relates #24408

time:
2017-04-28T18:42:56Z
class:
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryIT.java
comments:
[TEST] Fix race condition in ZenDiscoveryIT.testDiscoveryStats

With #24236, the master now uses the pending queue when publishing to itself. This means that a cluster state update is put into the pending queue,
then sent to the ClusterApplierService to be applied. After it has been applied, it is marked as processed and removed from the pending queue.
ensureGreen is implemented as a cluster health action that waits on certain conditions, which will lead to a cluster state update task to be submitted
on the master. When this task gets to run and the conditions are not satisfied yet, it register a cluster state observer. This observer is registered
on the ClusterApplierService and waits on cluster state change events. ClusterApplierService first notifies the observer and then the discovery
layer. This means that there is a small time frame where ensureGreen can complete and call the node stats to find the pending queue still containing
the last cluster state update.

Closes #24388

time:
2017-04-28T17:52:27Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
comments:
Fix node failure detection race when updating cluster state

Failure detection should only be updated in ZenDiscovery after the current state has been updated to prevent a race condition
with handleLeaveRequest and handleNodeFailure as those check the current state to determine whether the failure is to be handled by this node.

time:
2017-04-28T15:41:05Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/close/TransportCloseIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/open/TransportOpenIndexAction.java
core/src/test/java/org/elasticsearch/indices/state/OpenCloseIndexIT.java
comments:
Open and close index to honour allow_no_indices option (#24222)

Open/close index API when executed providing an index expressions that matched no indices, threw an error even when allow_no_indices was set to true. The APIs should rather honour the option and behave as a no-op in that case.

Closes #24031

time:
2017-04-28T15:12:38Z
class:
comments:
Add missing link for the WordDelimiterGraphFilter

time:
2017-04-28T15:08:48Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/InternalGeoCentroid.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/ParsedGeoCentroid.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/geocentroid/InternalGeoCentroidTests.java
comments:
Add parsing for InternalGeoCentroid (#24371)

time:
2017-04-28T14:55:07Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/InternalGeoCentroid.java
comments:
Don't render InternalGeoCentroid in static helper method

This was introduced by a previous commit but is not necessary.

time:
2017-04-28T14:42:55Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/tasks/TransportPendingClusterTasksAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateObserver.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateTaskExecutor.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateTaskListener.java
core/src/main/java/org/elasticsearch/cluster/LocalClusterUpdateTask.java
core/src/main/java/org/elasticsearch/cluster/routing/DelayedAllocationService.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterApplier.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterApplierService.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/cluster/service/MasterService.java
core/src/main/java/org/elasticsearch/common/Randomness.java
core/src/main/java/org/elasticsearch/common/util/concurrent/BaseFuture.java
core/src/main/java/org/elasticsearch/discovery/Discovery.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/NoneDiscovery.java
core/src/main/java/org/elasticsearch/discovery/TribeDiscovery.java
core/src/main/java/org/elasticsearch/discovery/single/SingleNodeDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/MasterFaultDetection.java
core/src/main/java/org/elasticsearch/discovery/zen/NodeJoinController.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/gateway/GatewayService.java
core/src/main/java/org/elasticsearch/indices/store/IndicesStore.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/node/NodeService.java
core/src/main/java/org/elasticsearch/plugins/DiscoveryPlugin.java
core/src/main/java/org/elasticsearch/repositories/RepositoriesService.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/InternalGeoCentroid.java
core/src/main/java/org/elasticsearch/tribe/TribeService.java
core/src/test/java/org/elasticsearch/action/bulk/BulkRequestTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/cluster/ClusterModuleTests.java
core/src/test/java/org/elasticsearch/cluster/health/ClusterStateHealthTests.java
core/src/test/java/org/elasticsearch/cluster/routing/DelayedAllocationServiceTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterApplierServiceTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceIT.java
core/src/test/java/org/elasticsearch/cluster/service/MasterServiceTests.java
core/src/test/java/org/elasticsearch/cluster/settings/ClusterSettingsIT.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryModuleTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/discovery/ZenFaultDetectionTests.java
core/src/test/java/org/elasticsearch/discovery/single/SingleNodeDiscoveryTests.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeJoinControllerTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryIT.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/gateway/GatewayServiceTests.java
core/src/test/java/org/elasticsearch/indexlifecycle/IndexLifecycleActionIT.java
core/src/test/java/org/elasticsearch/indices/store/IndicesStoreIntegrationIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/GeoCentroidIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/geocentroid/InternalGeoCentroidTests.java
core/src/test/java/org/elasticsearch/snapshots/AbstractSnapshotIntegTestCase.java
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/test/NoopDiscovery.java
core/src/test/java/org/elasticsearch/update/UpdateIT.java
plugins/discovery-azure-classic/src/main/java/org/elasticsearch/plugin/discovery/azure/classic/AzureDiscoveryPlugin.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/discovery-gce/src/main/java/org/elasticsearch/plugin/discovery/gce/GceDiscoveryPlugin.java
test/framework/src/main/java/org/elasticsearch/test/ClusterServiceUtils.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/discovery/TestZenDiscovery.java
test/framework/src/main/java/org/elasticsearch/test/disruption/BlockClusterStateProcessing.java
test/framework/src/main/java/org/elasticsearch/test/disruption/SlowClusterStateProcessing.java
comments:
Merge branch 'master' into feature/client_aggs_parsing

time:
2017-04-28T14:25:22Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/InternalGeoCentroid.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/GeoCentroidIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/geocentroid/InternalGeoCentroidTests.java
comments:
Add `count` value to rest output of `geo_centroid` (#24387)

Currently we don't write the count value to the geo_centroid aggregation rest response,
but it is provided via the java api and the count() method in the GeoCentroid interface. 
We should add this parameter to the rest output and also provide it via the getProperty()
method.

time:
2017-04-28T13:58:53Z
class:
comments:
Docs tests: cat/health can have max_task_wait_time

Make the doc test assertions ok with a non `-` value for
`max_task_wait_time`. These are rare, but possible:
https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=oraclelinux/900/consoleFull

time:
2017-04-28T13:52:14Z
class:
core/src/main/java/org/elasticsearch/discovery/TribeDiscovery.java
comments:
Fix compilation in Ecipse (#24391)

Eclipse doesn't allow extra semicolons after an import statement:
```
import foo.Bar;;   // <-- syntax error!
```

Here is the Eclipse bug:
https://bugs.eclipse.org/bugs/show_bug.cgi?id=425140
which the Eclipse folks closed as "the spec doesn't allow these
semicolons so why should we?" Which is fair. Here is the bug
against javac for allowing them:
https://bugs.openjdk.java.net/browse/JDK-8027682
which hasn't been touched since 2013 without explanation. There
is, however, a rather educations mailing list thread:
http://mail.openjdk.java.net/pipermail/compiler-dev/2013-August/006956.html

which contains gems like, "In general, it is better/simpler to
change javac to conform to the spec. (Except when it is not.)"

I suspect the reason this hasn't been fixed is:
```
FWIW, if we change javac such that the set of programs accepted by javac
is changed, we have an process (currently Oracle internal) to get
approval for such a change.   So, we would not simply change javac on a
whim to meet the spec; we would at least have other eyes looking at the
behavioral change to determine if it is "acceptable".
```
from http://mail.openjdk.java.net/pipermail/compiler-dev/2013-August/006973.html

time:
2017-04-28T13:21:44Z
class:
core/src/main/java/org/elasticsearch/rest/action/cat/RestAliasAction.java
comments:
Handle multiple aliases in _cat/aliases api (#23698)

The alias parameter was documented as a list in our rest-spec, yet only the first value out of a list was getting read and processed. This commit adds support for multiple aliases to _cat/aliases

Closes #23661

time:
2017-04-28T12:43:46Z
class:
comments:
Docs: Upserts no longer support version

Closes #16671

time:
2017-04-28T12:19:00Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/InternalGeoBounds.java
comments:
Fixing checktyle error for modifier order

time:
2017-04-28T12:02:09Z
class:
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/test/java/org/elasticsearch/action/bulk/BulkRequestTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/update/UpdateIT.java
comments:
Added validation for upserd request (#24282)

The version on an update request is a syntactic sugar
for get of a specific version, doc merge and a version
index. This changes it to reject requests with both
upsert and a version.
If the upsert index request is versioned, we also
reject the op.

time:
2017-04-28T10:10:16Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/InternalGeoBounds.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/ParsedGeoBounds.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/geobounds/InternalGeoBoundsTests.java
comments:
Add parsing for InternalGeoBounds (#24365)

time:
2017-04-28T09:33:53Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
comments:
Weaken assertion in ZenDiscovery.publish

The previous commit (35f78d098a) introduced an assertion in ZenDiscovery that was overly restrictive - it could trip when a cluster state that was
successfully published would not be applied locally because a master with a better cluster state came along in the meantime.

time:
2017-04-28T09:09:24Z
class:
comments:
docs: document alternative for nested inner hits source

Closes #24110

time:
2017-04-28T07:34:31Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/health/TransportClusterHealthAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/tasks/TransportPendingClusterTasksAction.java
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateObserver.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateTaskExecutor.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateTaskListener.java
core/src/main/java/org/elasticsearch/cluster/LocalClusterUpdateTask.java
core/src/main/java/org/elasticsearch/cluster/routing/DelayedAllocationService.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterApplier.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterApplierService.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/cluster/service/MasterService.java
core/src/main/java/org/elasticsearch/common/Randomness.java
core/src/main/java/org/elasticsearch/common/util/concurrent/BaseFuture.java
core/src/main/java/org/elasticsearch/discovery/Discovery.java
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/NoneDiscovery.java
core/src/main/java/org/elasticsearch/discovery/TribeDiscovery.java
core/src/main/java/org/elasticsearch/discovery/single/SingleNodeDiscovery.java
core/src/main/java/org/elasticsearch/discovery/zen/MasterFaultDetection.java
core/src/main/java/org/elasticsearch/discovery/zen/NodeJoinController.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/gateway/GatewayService.java
core/src/main/java/org/elasticsearch/indices/store/IndicesStore.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/node/NodeService.java
core/src/main/java/org/elasticsearch/plugins/DiscoveryPlugin.java
core/src/main/java/org/elasticsearch/repositories/RepositoriesService.java
core/src/main/java/org/elasticsearch/tribe/TribeService.java
core/src/test/java/org/elasticsearch/cluster/ClusterModuleTests.java
core/src/test/java/org/elasticsearch/cluster/health/ClusterStateHealthTests.java
core/src/test/java/org/elasticsearch/cluster/routing/DelayedAllocationServiceTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterApplierServiceTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceIT.java
core/src/test/java/org/elasticsearch/cluster/service/MasterServiceTests.java
core/src/test/java/org/elasticsearch/cluster/settings/ClusterSettingsIT.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryModuleTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/discovery/ZenFaultDetectionTests.java
core/src/test/java/org/elasticsearch/discovery/single/SingleNodeDiscoveryTests.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeJoinControllerTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryIT.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryUnitTests.java
core/src/test/java/org/elasticsearch/gateway/GatewayServiceTests.java
core/src/test/java/org/elasticsearch/indexlifecycle/IndexLifecycleActionIT.java
core/src/test/java/org/elasticsearch/indices/store/IndicesStoreIntegrationIT.java
core/src/test/java/org/elasticsearch/snapshots/AbstractSnapshotIntegTestCase.java
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/test/NoopDiscovery.java
plugins/discovery-azure-classic/src/main/java/org/elasticsearch/plugin/discovery/azure/classic/AzureDiscoveryPlugin.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/discovery-gce/src/main/java/org/elasticsearch/plugin/discovery/gce/GceDiscoveryPlugin.java
test/framework/src/main/java/org/elasticsearch/test/ClusterServiceUtils.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/discovery/TestZenDiscovery.java
test/framework/src/main/java/org/elasticsearch/test/disruption/BlockClusterStateProcessing.java
test/framework/src/main/java/org/elasticsearch/test/disruption/SlowClusterStateProcessing.java
comments:
Separate publishing from applying cluster states (#24236)

Separates cluster state publishing from applying cluster states:

- ClusterService is split into two classes MasterService and ClusterApplierService. MasterService has the responsibility to calculate cluster state updates for actions that want to change the cluster state (create index, update shard routing table, etc.). ClusterApplierService has the responsibility to apply cluster states that have been successfully published and invokes the cluster state appliers and listeners.
- ClusterApplierService keeps track of the last applied state, but MasterService is stateless and uses the last cluster state that is provided by the discovery module to calculate the next prospective state. The ClusterService class is still kept around, which now just delegates actions to ClusterApplierService and MasterService.
- The discovery implementation is now responsible for managing the last cluster state that is used by the consensus layer and the master service. It also exposes the initial cluster state which is used by the ClusterApplierService. The discovery implementation is also responsible for adding the right cluster-level blocks to the initial state.
- NoneDiscovery has been renamed to TribeDiscovery as it is exclusively used by TribeService. It adds the tribe blocks to the initial state.
- ZenDiscovery is synchronized on state changes to the last cluster state that is used by the consensus layer and the master service, and does not submit cluster state update tasks anymore to make changes to the disco state (except when becoming master).

Control flow for cluster state updates is now as follows:

- State updates are sent to MasterService
- MasterService gets the latest committed cluster state from the discovery implementation and calculates the next cluster state to publish
- MasterService submits the new prospective cluster state to the discovery implementation for publishing
- Discovery implementation publishes cluster states to all nodes and, once the state is committed, asks the ClusterApplierService to apply the newly committed state.
- ClusterApplierService applies state to local node.

time:
2017-04-28T04:48:52Z
class:
core/src/main/java/org/elasticsearch/node/Node.java
comments:
Fix typo in node environment exception message

This commit fixes a typo in an exception message when trying to create a
node environment.

Relates #24381

time:
2017-04-27T22:41:16Z
class:
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/main/java/org/elasticsearch/common/xcontent/ConstructingObjectParser.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoverySourceService.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTargetHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RemoteRecoveryTargetHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/StartRecoveryRequest.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/plugins/Platforms.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/FilterAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregationBuilder.java
core/src/test/java/org/elasticsearch/action/admin/indices/create/ShrinkIndexIT.java
core/src/test/java/org/elasticsearch/action/bulk/BulkWithUpdatesIT.java
core/src/test/java/org/elasticsearch/aliases/IndexAliasesIT.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataMappingServiceTests.java
core/src/test/java/org/elasticsearch/cluster/routing/RoutingTableTests.java
core/src/test/java/org/elasticsearch/common/xcontent/ConstructingObjectParserTests.java
core/src/test/java/org/elasticsearch/fieldstats/FieldStatsTests.java
core/src/test/java/org/elasticsearch/gateway/RecoveryFromGatewayIT.java
core/src/test/java/org/elasticsearch/get/GetActionIT.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractFieldDataTestCase.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingIT.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
core/src/test/java/org/elasticsearch/index/mapper/NestedObjectMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ParentFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/UpdateMappingTests.java
core/src/test/java/org/elasticsearch/indices/IndicesOptionsIntegrationIT.java
core/src/test/java/org/elasticsearch/indices/exists/types/TypesExistsIT.java
core/src/test/java/org/elasticsearch/indices/mapping/SimpleGetFieldMappingsIT.java
core/src/test/java/org/elasticsearch/indices/mapping/SimpleGetMappingsIT.java
core/src/test/java/org/elasticsearch/indices/mapping/UpdateMappingIntegrationIT.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySourceHandlerTests.java
core/src/test/java/org/elasticsearch/indices/recovery/StartRecoveryRequestTests.java
core/src/test/java/org/elasticsearch/indices/stats/IndexStatsIT.java
core/src/test/java/org/elasticsearch/indices/template/SimpleIndexTemplateIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/ChildrenIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DoubleTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/LongTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/ReverseNestedIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/StringTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java
core/src/test/java/org/elasticsearch/search/basic/TransportSearchFailuresIT.java
core/src/test/java/org/elasticsearch/search/basic/TransportTwoNodesSearchIT.java
core/src/test/java/org/elasticsearch/search/child/ChildQuerySearchIT.java
core/src/test/java/org/elasticsearch/search/child/ParentFieldLoadingIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/InnerHitsIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java
core/src/test/java/org/elasticsearch/search/fields/SearchFieldsIT.java
core/src/test/java/org/elasticsearch/search/morelikethis/MoreLikeThisIT.java
core/src/test/java/org/elasticsearch/search/nested/SimpleNestedIT.java
core/src/test/java/org/elasticsearch/search/query/SearchQueryIT.java
core/src/test/java/org/elasticsearch/search/slice/SearchSliceIT.java
core/src/test/java/org/elasticsearch/search/sort/FieldSortIT.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestSearchIT.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/tribe/TribeIT.java
core/src/test/java/org/elasticsearch/update/UpdateIT.java
distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
distribution/tools/plugin-cli/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/MoreExpressionTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/CandidateQueryTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorFieldMapperTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorQuerySearchIT.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexBasicTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexParentChildTests.java
plugins/discovery-azure-classic/src/test/java/org/elasticsearch/discovery/azure/classic/AzureDiscoveryClusterFormationTests.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/disruption/IntermittentLongGCDisruption.java
test/framework/src/main/java/org/elasticsearch/test/disruption/LongGCDisruption.java
test/framework/src/test/java/org/elasticsearch/test/disruption/LongGCDisruptionTests.java
comments:
Merge branch 'master' into feature/client_aggs_parsing

time:
2017-04-27T20:50:59Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/AggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/FilterAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregationBuilder.java
comments:
Agg builder accessibility fixes (#24323)

- Getters for DateHisto `interval` and `offset` should return a
long, not double
- Add getter for the filter in a FilterAgg
- Add getters for subaggs / pipelines in base AggregationBuilder

time:
2017-04-27T18:27:29Z
class:
core/src/main/java/org/elasticsearch/plugins/Platforms.java
distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
distribution/tools/plugin-cli/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java
comments:
Plugins: Add support for platform specific plugins (#24265)

This commit adds support for plugins having a platform specific variant.
It also adds unit tests for all official and maven urls.

time:
2017-04-27T15:29:33Z
class:
comments:
Run gradle vagrantUpdateVersions to add version 5.3.2

time:
2017-04-27T14:36:28Z
class:
comments:
Docs: remove experimental tag from update-by-query

We meant to remove it in #23621 but we removed it from the
documentation for the java client but not the rest documetnaiton.

time:
2017-04-27T13:36:26Z
class:
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
comments:
 Change snapshot status error to use generic SnapshotException (#24355)

Changes the snapshot status read exception from the (misleading)
IndexShardRestoreFailedException to the generic SnapshotException

Closes #24225

time:
2017-04-27T12:45:44Z
class:
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoverySourceService.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTargetHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RemoteRecoveryTargetHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/StartRecoveryRequest.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySourceHandlerTests.java
core/src/test/java/org/elasticsearch/indices/recovery/StartRecoveryRequestTests.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
comments:
Provide target allocation id as part of start recovery request (#24333)

This makes it possible for the recovery source to verify that it is talking to the shard it thinks it is talking to.

Closes #24167

time:
2017-04-27T10:26:10Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/ConstructingObjectParser.java
core/src/test/java/org/elasticsearch/common/xcontent/ConstructingObjectParserTests.java
comments:
Pass Context to ConstructingObjectParser's function (#24230)

Allow the `Context` to be used in the builder function used within ConstructingObjectParser.
This facilitates scenarios where a constructor argument comes from a URL parameter, or from document id.

time:
2017-04-27T09:04:57Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/ParsedPercentiles.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/percentile/ParsedPercentilesBucket.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/AbstractPercentilesTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/InternalHDRPercentilesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/percentile/InternalPercentilesBucketTests.java
comments:
Add parsing for InternalPercentilesBucket (#24330)

time:
2017-04-27T08:30:53Z
class:
comments:
Added bwc indices for v2.4.5

time:
2017-04-27T07:59:54Z
class:
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/node/Node.java
plugins/discovery-azure-classic/src/test/java/org/elasticsearch/discovery/azure/classic/AzureDiscoveryClusterFormationTests.java
comments:
Test: Write node ports file before starting tribe service (#24351)

The tribe service can take a while to initialize, depending on how many cluster it needs to connect to. This change moves writing the ports file used by tests to before the tribe service is started.

time:
2017-04-27T06:43:20Z
class:
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/test/java/org/elasticsearch/action/admin/indices/create/ShrinkIndexIT.java
core/src/test/java/org/elasticsearch/action/bulk/BulkWithUpdatesIT.java
core/src/test/java/org/elasticsearch/aliases/IndexAliasesIT.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataMappingServiceTests.java
core/src/test/java/org/elasticsearch/fieldstats/FieldStatsTests.java
core/src/test/java/org/elasticsearch/gateway/RecoveryFromGatewayIT.java
core/src/test/java/org/elasticsearch/get/GetActionIT.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractFieldDataTestCase.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingIT.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
core/src/test/java/org/elasticsearch/index/mapper/NestedObjectMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ParentFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/UpdateMappingTests.java
core/src/test/java/org/elasticsearch/indices/IndicesOptionsIntegrationIT.java
core/src/test/java/org/elasticsearch/indices/exists/types/TypesExistsIT.java
core/src/test/java/org/elasticsearch/indices/mapping/SimpleGetFieldMappingsIT.java
core/src/test/java/org/elasticsearch/indices/mapping/SimpleGetMappingsIT.java
core/src/test/java/org/elasticsearch/indices/mapping/UpdateMappingIntegrationIT.java
core/src/test/java/org/elasticsearch/indices/stats/IndexStatsIT.java
core/src/test/java/org/elasticsearch/indices/template/SimpleIndexTemplateIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/ChildrenIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DoubleTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/LongTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/ReverseNestedIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/StringTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java
core/src/test/java/org/elasticsearch/search/basic/TransportSearchFailuresIT.java
core/src/test/java/org/elasticsearch/search/basic/TransportTwoNodesSearchIT.java
core/src/test/java/org/elasticsearch/search/child/ChildQuerySearchIT.java
core/src/test/java/org/elasticsearch/search/child/ParentFieldLoadingIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/InnerHitsIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java
core/src/test/java/org/elasticsearch/search/fields/SearchFieldsIT.java
core/src/test/java/org/elasticsearch/search/morelikethis/MoreLikeThisIT.java
core/src/test/java/org/elasticsearch/search/nested/SimpleNestedIT.java
core/src/test/java/org/elasticsearch/search/query/SearchQueryIT.java
core/src/test/java/org/elasticsearch/search/slice/SearchSliceIT.java
core/src/test/java/org/elasticsearch/search/sort/FieldSortIT.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestSearchIT.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/tribe/TribeIT.java
core/src/test/java/org/elasticsearch/update/UpdateIT.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/MoreExpressionTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/CandidateQueryTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorFieldMapperTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorQuerySearchIT.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexBasicTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexParentChildTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
comments:
Only allow one type on 7.0 indices (#24317)

This adds the `index.mapping.single_type` setting, which enforces that indices
have at most one type when it is true. The default value is true for 6.0+ indices
and false for old indices.

Relates #15613

time:
2017-04-27T01:23:19Z
class:
test/framework/src/main/java/org/elasticsearch/test/disruption/IntermittentLongGCDisruption.java
test/framework/src/main/java/org/elasticsearch/test/disruption/LongGCDisruption.java
test/framework/src/test/java/org/elasticsearch/test/disruption/LongGCDisruptionTests.java
comments:
Fix inconsistencies in long GC disruption

This commit fixes some inconsistencies in long GC disruption where we
mixed stopping and suspending when the action we are performing on
threads is suspending which is distinct from stopping a thread.

time:
2017-04-26T22:54:23Z
class:
core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java
comments:
The parseObject method in DocumentParse can be void. There is no point in the code that actually expects the return, plus the variable created for it was never actually used. (#24350)

time:
2017-04-26T22:39:26Z
class:
core/src/test/java/org/elasticsearch/cluster/routing/RoutingTableTests.java
comments:
[TEST] fixes NPE in RoutingTableTests

time:
2017-04-26T22:02:08Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ParsedExtendedStats.java
comments:
Fixed another sneaky LineLength violation

time:
2017-04-26T21:09:45Z
class:
buildSrc/src/main/java/org/elasticsearch/test/NamingConventionsCheck.java
buildSrc/src/main/java/org/elasticsearch/test/NamingConventionsCheckInMainIT.java
buildSrc/src/main/java/org/elasticsearch/test/NamingConventionsCheckInMainTests.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RequestTests.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/OriginalIndices.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/TransportClusterSearchShardsAction.java
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/DfsQueryPhase.java
core/src/main/java/org/elasticsearch/action/search/FetchSearchPhase.java
core/src/main/java/org/elasticsearch/action/search/InitialSearchPhase.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/main/java/org/elasticsearch/action/search/SearchActionListener.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseContext.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchShardIterator.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/ShardSearchFailure.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/action/support/broadcast/TransportBroadcastAction.java
core/src/main/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeAction.java
core/src/main/java/org/elasticsearch/action/termvectors/TransportTermVectorsAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java
core/src/main/java/org/elasticsearch/cluster/routing/GroupShardsIterator.java
core/src/main/java/org/elasticsearch/cluster/routing/IndexRoutingTable.java
core/src/main/java/org/elasticsearch/cluster/routing/OperationRouting.java
core/src/main/java/org/elasticsearch/cluster/routing/PlainShardIterator.java
core/src/main/java/org/elasticsearch/cluster/routing/PlainShardsIterator.java
core/src/main/java/org/elasticsearch/cluster/routing/RecoverySource.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java
core/src/main/java/org/elasticsearch/cluster/routing/ShardsIterator.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocateUnassignedDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/FilterAllocationDecider.java
core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java
core/src/main/java/org/elasticsearch/common/logging/DeprecationLogger.java
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/main/java/org/elasticsearch/common/settings/SecureSetting.java
core/src/main/java/org/elasticsearch/common/unit/TimeValue.java
core/src/main/java/org/elasticsearch/index/analysis/CharFilterFactory.java
core/src/main/java/org/elasticsearch/index/cache/bitset/BitsetFilterCache.java
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/functionscore/ScoreFunctionBuilders.java
core/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java
core/src/main/java/org/elasticsearch/ingest/IngestDocument.java
core/src/main/java/org/elasticsearch/ingest/InternalTemplateService.java
core/src/main/java/org/elasticsearch/plugins/AnalysisPlugin.java
core/src/main/java/org/elasticsearch/rest/action/search/RestClearScrollAction.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/main/java/org/elasticsearch/script/ScriptSettings.java
core/src/main/java/org/elasticsearch/search/SearchHit.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/SearchShardTarget.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/percentile/InternalPercentilesBucket.java
core/src/main/java/org/elasticsearch/search/fetch/ShardFetchSearchRequest.java
core/src/main/java/org/elasticsearch/search/internal/SearchContext.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchTransportRequest.java
core/src/main/java/org/elasticsearch/search/query/QuerySearchRequest.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java
core/src/main/java/org/elasticsearch/template/CompiledTemplate.java
core/src/test/java/org/elasticsearch/ElasticsearchExceptionTests.java
core/src/test/java/org/elasticsearch/action/search/AbstractSearchAsyncActionTookTests.java
core/src/test/java/org/elasticsearch/action/search/MockSearchPhaseContext.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterConnectionTests.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterServiceTests.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
core/src/test/java/org/elasticsearch/action/search/ShardSearchFailureTests.java
core/src/test/java/org/elasticsearch/action/search/TransportSearchActionTests.java
core/src/test/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeActionTests.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/action/shard/ShardFailedClusterStateTaskExecutorTests.java
core/src/test/java/org/elasticsearch/cluster/routing/GroupShardsIteratorTests.java
core/src/test/java/org/elasticsearch/cluster/routing/RoutingTableTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/FilterAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/structure/RoutingIteratorTests.java
core/src/test/java/org/elasticsearch/common/lucene/search/function/ScriptScoreFunctionTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/index/analysis/AnalysisRegistryTests.java
core/src/test/java/org/elasticsearch/index/analysis/CharFilterTests.java
core/src/test/java/org/elasticsearch/index/analysis/CustomNormalizerTests.java
core/src/test/java/org/elasticsearch/index/store/CorruptedFileIT.java
core/src/test/java/org/elasticsearch/index/suggest/stats/SuggestStatsIT.java
core/src/test/java/org/elasticsearch/indices/analysis/AnalysisModuleTests.java
core/src/test/java/org/elasticsearch/indices/analyze/AnalyzeActionIT.java
core/src/test/java/org/elasticsearch/search/SearchHitTests.java
core/src/test/java/org/elasticsearch/search/SearchServiceTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/BaseAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/TermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedAggregationBuilderTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/AbstractNumericMetricTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/GeoCentroidTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MissingTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/PercentileRanksTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/PercentilesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ScriptedMetricTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ValueCountTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/InternalPercentilesTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketScriptTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketSelectorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/percentile/InternalPercentilesBucketTests.java
core/src/test/java/org/elasticsearch/search/internal/ShardSearchTransportRequestTests.java
core/src/test/java/org/elasticsearch/search/sort/ScriptSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/stats/SearchStatsIT.java
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
modules/analysis-common/src/main/java/org/elasticsearch/analysis/common/CommonAnalysisPlugin.java
modules/analysis-common/src/main/java/org/elasticsearch/analysis/common/MappingCharFilterFactory.java
modules/analysis-common/src/main/java/org/elasticsearch/analysis/common/PatternReplaceCharFilterFactory.java
modules/analysis-common/src/main/java/org/elasticsearch/index/analysis/HtmlStripCharFilterFactory.java
modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/CommonAnalysisFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Compiler.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Def.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/FeatureTest.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/FunctionRef.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/LambdaBootstrap.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/WriterConstants.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/Walker.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ECapturingFunctionRef.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EFunctionRef.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ELambda.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SFunction.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/AugmentationTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/FunctionRefTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/LambdaTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/node/NodeToStringTests.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorQuerySearchIT.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollActionScriptTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexRequestTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryRequestTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4InternalESLogger.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3ClientSettings.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3RepositoryPlugin.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AwsS3ServiceImplTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3RepositoryTests.java
test/framework/src/main/java/org/elasticsearch/AnalysisFactoryTestCase.java
test/framework/src/main/java/org/elasticsearch/cluster/ESAllocationTestCase.java
test/framework/src/main/java/org/elasticsearch/search/RandomSearchRequestGenerator.java
test/framework/src/main/java/org/elasticsearch/test/ClusterServiceUtils.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/main/java/org/elasticsearch/test/PosixPermissionsResetter.java
test/framework/src/main/java/org/elasticsearch/test/disruption/LongGCDisruption.java
test/framework/src/test/java/org/elasticsearch/test/disruption/LongGCDisruptionTests.java
test/framework/src/test/java/org/elasticsearch/test/disruption/NetworkDisruptionIT.java
test/framework/src/test/java/org/elasticsearch/test/disruption/NetworkDisruptionTests.java
comments:
Merge branch 'master' into feature/client_aggs_parsing

time:
2017-04-26T21:07:49Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ParsedExtendedStats.java
comments:
Fix order of static field declarations for parser

time:
2017-04-26T20:34:53Z
class:
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
comments:
[TEST] fixes shard count of source shard index in a restore shrink index
test

time:
2017-04-26T20:32:30Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ParsedExtendedStats.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/stats/ParsedStatsBucket.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/stats/extended/ParsedExtendedStatsBucket.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalExtendedStatsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalStatsBucketTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalStatsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/stats/extended/InternalExtendedStatsBucketTests.java
comments:
Add parsing for InternalStatsBucket and InternalExtendedStatsBucket (#24312)

time:
2017-04-26T20:04:38Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/RequestTests.java
core/src/main/java/org/elasticsearch/index/query/functionscore/ScoreFunctionBuilders.java
core/src/test/java/org/elasticsearch/common/lucene/search/function/ScriptScoreFunctionTests.java
core/src/test/java/org/elasticsearch/search/aggregations/BaseAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/TermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedAggregationBuilderTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/AbstractNumericMetricTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/GeoCentroidTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MissingTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/PercentileRanksTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/PercentilesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ScriptedMetricTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ValueCountTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketScriptTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketSelectorTests.java
core/src/test/java/org/elasticsearch/search/sort/ScriptSortBuilderTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollActionScriptTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexRequestTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryRequestTests.java
test/framework/src/main/java/org/elasticsearch/search/RandomSearchRequestGenerator.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
Remove most usages of 1-arg Script ctor (#24325)

The one argument ctor for `Script` creates a script with the
default language but most usages of are for testing and either
don't care about the language or are for use with
`MockScriptEngine`. This replaces most usages of the one argument
ctor on `Script` with calls to `ESTestCase#mockScript` to make
it clear that the tests don't need the default scripting language.

I've also factored out some copy and pasted script generation
code into a single place. I would have had to change that code
to use `mockScript` anyway, so it was easier to perform the
refactor.

Relates to #16314

time:
2017-04-26T19:45:49Z
class:
core/src/main/java/org/elasticsearch/action/OriginalIndices.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/TransportClusterSearchShardsAction.java
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/DfsQueryPhase.java
core/src/main/java/org/elasticsearch/action/search/FetchSearchPhase.java
core/src/main/java/org/elasticsearch/action/search/InitialSearchPhase.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/main/java/org/elasticsearch/action/search/SearchActionListener.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseContext.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchShardIterator.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/ShardSearchFailure.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/action/support/broadcast/TransportBroadcastAction.java
core/src/main/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeAction.java
core/src/main/java/org/elasticsearch/action/termvectors/TransportTermVectorsAction.java
core/src/main/java/org/elasticsearch/cluster/routing/GroupShardsIterator.java
core/src/main/java/org/elasticsearch/cluster/routing/IndexRoutingTable.java
core/src/main/java/org/elasticsearch/cluster/routing/OperationRouting.java
core/src/main/java/org/elasticsearch/cluster/routing/PlainShardIterator.java
core/src/main/java/org/elasticsearch/cluster/routing/PlainShardsIterator.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java
core/src/main/java/org/elasticsearch/cluster/routing/ShardsIterator.java
core/src/main/java/org/elasticsearch/search/SearchHit.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/SearchShardTarget.java
core/src/main/java/org/elasticsearch/search/fetch/ShardFetchSearchRequest.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchTransportRequest.java
core/src/main/java/org/elasticsearch/search/query/QuerySearchRequest.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java
core/src/test/java/org/elasticsearch/ElasticsearchExceptionTests.java
core/src/test/java/org/elasticsearch/action/search/AbstractSearchAsyncActionTookTests.java
core/src/test/java/org/elasticsearch/action/search/MockSearchPhaseContext.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterConnectionTests.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterServiceTests.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
core/src/test/java/org/elasticsearch/action/search/ShardSearchFailureTests.java
core/src/test/java/org/elasticsearch/action/search/TransportSearchActionTests.java
core/src/test/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeActionTests.java
core/src/test/java/org/elasticsearch/cluster/action/shard/ShardFailedClusterStateTaskExecutorTests.java
core/src/test/java/org/elasticsearch/cluster/routing/GroupShardsIteratorTests.java
core/src/test/java/org/elasticsearch/cluster/structure/RoutingIteratorTests.java
core/src/test/java/org/elasticsearch/index/store/CorruptedFileIT.java
core/src/test/java/org/elasticsearch/index/suggest/stats/SuggestStatsIT.java
core/src/test/java/org/elasticsearch/search/SearchHitTests.java
core/src/test/java/org/elasticsearch/search/SearchServiceTests.java
core/src/test/java/org/elasticsearch/search/internal/ShardSearchTransportRequestTests.java
core/src/test/java/org/elasticsearch/search/stats/SearchStatsIT.java
comments:
Cross Cluster Search: propagate original indices per cluster (#24328)

In case of a Cross Cluster Search, the coordinating node should split the original indices per cluster, and send over to each cluster only its own set of original indices, rather than the set taken from the original search request which contains all the indices.

In fact, each remote cluster should not be aware of the indices belonging to other remote clusters.

time:
2017-04-26T19:26:36Z
class:
test/framework/src/main/java/org/elasticsearch/test/disruption/LongGCDisruption.java
test/framework/src/test/java/org/elasticsearch/test/disruption/LongGCDisruptionTests.java
comments:
Avoid leaks in Long GC disruption tests

We can leak disrupted threads here since we never wait for them to
complete after freeing them from their loops. This commit addresses this
by joining on disrupted threads, and addresses fallout from trying to
join here.

Relates #24338

time:
2017-04-26T19:13:27Z
class:
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
comments:
[TEST] Fix cluster forming in testDynamicUpdateMinimumMasterNodes

This test can run into a split-brain situation as minimum_master_nodes is not properly set. To prevent this, make sure that at least one of the two
master nodes that are initially started has minimum_master_nodes correctly set.

time:
2017-04-26T19:07:56Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregatorTests.java
comments:
test: don't randomly wrap index reader

time:
2017-04-26T18:48:10Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/routing/IndexRoutingTable.java
core/src/main/java/org/elasticsearch/cluster/routing/RecoverySource.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/FilterAllocationDecider.java
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/test/java/org/elasticsearch/cluster/routing/RoutingTableTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/FilterAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
comments:
Fixes restore of a shrunken index when initial recovery node is gone (#24322)

When an index is shrunk using the shrink APIs, the shrink operation adds
some internal index settings to the shrink index, for example
`index.shrink.source.name|uuid` to denote the source index, as well as
`index.routing.allocation.initial_recovery._id` to denote the node on
which all shards for the source index resided when the shrunken index
was created.  However, this presents a problem when taking a snapshot of
the shrunken index and restoring it to a cluster where the initial
recovery node is not present, or restoring to the same cluster where the
initial recovery node is offline or decomissioned.  The restore
operation fails to allocate the shard in the shrunken index to a node
when the initial recovery node is not present, and a restore type of
recovery will *not* go through the PrimaryShardAllocator, meaning that
it will not have the chance to force allocate the primary to a node in
the cluster.  Rather, restore initiated shard allocation goes through
the BalancedShardAllocator which does not attempt to force allocate a
primary.

This commit fixes the aforementioned problem by not requiring allocation
to occur on the initial recovery node when the recovery type is a
restore of a snapshot.  This commit also ensures that the internal
shrink index settings are recognized and not archived (which can trip an
assertion in the restore scenario).

Closes #24257

time:
2017-04-26T18:44:03Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregationBuilder.java
comments:
Removal of dead code in ScriptedMetricAggregationBuilder (#24346)

This code removes a few lines of dead code from ScriptedMetricAggregationBuilder. 
Just completely dead code, it adds things to a Set that is then not used in any way.

time:
2017-04-26T18:32:35Z
class:
core/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java
comments:
Removal of dead code from SnapshotsService (#24347)

This code removes a few lines of dead code from SnapshotsService. 
Looks like a forgotten remnant of a past implementation.

time:
2017-04-26T18:09:26Z
class:
comments:
Rewrite description of `bool`'s `should` (#24342)

Docs: rewrite description of `bool`'s `should`

Rewrites the description of the `bool` query's `should`
clauses so it is (hopefully) more clear what the defaults
for `minimum_should_match` are.

There is still an `[IMPORTANT]` section about `minimum_should_match`
in a filter context. I think it is worth keeping because it is, well,
important.

Closes #23831

time:
2017-04-26T17:25:34Z
class:
core/src/main/java/org/elasticsearch/index/analysis/CharFilterFactory.java
core/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java
core/src/main/java/org/elasticsearch/plugins/AnalysisPlugin.java
core/src/test/java/org/elasticsearch/index/analysis/AnalysisRegistryTests.java
core/src/test/java/org/elasticsearch/index/analysis/CharFilterTests.java
core/src/test/java/org/elasticsearch/index/analysis/CustomNormalizerTests.java
core/src/test/java/org/elasticsearch/indices/analysis/AnalysisModuleTests.java
core/src/test/java/org/elasticsearch/indices/analyze/AnalyzeActionIT.java
modules/analysis-common/src/main/java/org/elasticsearch/analysis/common/CommonAnalysisPlugin.java
modules/analysis-common/src/main/java/org/elasticsearch/analysis/common/MappingCharFilterFactory.java
modules/analysis-common/src/main/java/org/elasticsearch/analysis/common/PatternReplaceCharFilterFactory.java
modules/analysis-common/src/main/java/org/elasticsearch/index/analysis/HtmlStripCharFilterFactory.java
modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/CommonAnalysisFactoryTests.java
test/framework/src/main/java/org/elasticsearch/AnalysisFactoryTestCase.java
comments:
Move char filters into analysis-common (#24261)

Another step down the road to dropping the
lucene-analyzers-common dependency from core.

Note that this removes some tests that no longer compile from
core. I played around with adding them to the analysis-common
module where they would compile but we already test these in
the tests generated from the example usage in the documentation.

I'm not super happy with the way that `requriesAnalysisSettings`
works with regards to plugins. I think it'd be fairly bug-prone
for plugin authors to use. But I'm making it visible as is for
now and I'll rethink later.

A part of #23658

time:
2017-04-26T17:15:48Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/percentile/InternalPercentilesBucket.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/InternalPercentilesTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/percentile/InternalPercentilesBucketTests.java
comments:
InternalPercentilesBucket should not rely on ordered percents array (#24336)

Currently InternalPercentilesBucket#percentile() relies on the percent array passed in
to be in sorted order. This changes the aggregation to store an internal lookup table that
is constructed from the percent/percentiles arrays passed in that can be used to look up 
the percentile values.

Closes #24331

time:
2017-04-26T14:40:35Z
class:
comments:
Make bats tests refuse to start on non-VMs (#24315)

The bats tests are descructive and must be run as root. This is a
horrible combination on any sane system but perfectly fine to do
in a VM. This change modifies the tests so they revuse to start
unless they are in an environment with an `/etc/is_vagrant_vm`
file. The Vagrantfile creates it on startup.

Closes #24137

time:
2017-04-26T14:08:16Z
class:
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
comments:
[TEST] Do a reroute with retry_failed after a bridge partition on testAckedIndexing

In case of a bridge partition, shard allocation can fail "index.allocation.max_retries" times if the master is the super-connected node and recovery
source and target are on opposite sides of the bridge. This commit adds a reroute with retry_failed after healing the network partition so that the
ensureGreen check succeeds.

time:
2017-04-26T11:23:07Z
class:
core/src/main/java/org/elasticsearch/common/io/stream/StreamInput.java
comments:
StreamInput throws exceptions instead of using assertions (#24294)

StreamInput has methods such as readVInt that perform sanity checks on the data using assertions,
which will catch bad data in tests but provide no safety when running as a node without assertions
enabled. The use of assertions also make testing with invalid data difficult since we would need
to handle assertion errors in the code using the stream input and errors like this should not be
something we try to catch. This commit introduces a flag that will throw an IOException instead of
using an assertion.

time:
2017-04-26T09:08:15Z
class:
core/src/main/java/org/elasticsearch/index/cache/bitset/BitsetFilterCache.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregatorTests.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorQuerySearchIT.java
comments:
[percolator] Fix memory leak when percolator uses bitset or field data cache.

The percolator doesn't close the IndexReader of the memory index any more.
Prior to 2.x the percolator had its own SearchContext (PercolatorContext) that did this,
but that was removed when the percolator was refactored as part of the 5.0 release.

I think an alternative way to fix this is to let percolator not use the bitset and fielddata caches,
that way we prevent the memory leak.

Closes #24108

time:
2017-04-26T09:04:33Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ParsedExtendedStats.java
comments:
Correcting 140 character line length

time:
2017-04-26T06:43:20Z
class:
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3ClientSettings.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3RepositoryPlugin.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AwsS3ServiceImplTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3RepositoryTests.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
S3 Repository: Deprecate remaining `repositories.s3.*` settings (#24144)

Most of these settings should always be pulled from the repository
settings. A couple were leftover that should be moved to client
settings. The path style access setting should be removed altogether.
This commit adds deprecations for all of these existing settings, as
well as adding new client specific settings for max retries and
throttling.

relates #24143

time:
2017-04-26T02:15:00Z
class:
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/common/logging/DeprecationLogger.java
comments:
Replace alternating regex with character classes

This commit replaces two alternating regular expressions (that is,
regular expressions that consist of the form a|b where a and b are
characters) with the equivalent regular expression rewritten as a
character class (that is, [ab]) The reason this is an improvement is
because a|b involves backtracking while [ab] does not.

Relates #24316

time:
2017-04-26T01:11:47Z
class:
buildSrc/src/main/java/org/elasticsearch/test/NamingConventionsCheck.java
buildSrc/src/main/java/org/elasticsearch/test/NamingConventionsCheckInMainIT.java
buildSrc/src/main/java/org/elasticsearch/test/NamingConventionsCheckInMainTests.java
test/framework/src/main/java/org/elasticsearch/AnalysisFactoryTestCase.java
test/framework/src/test/java/org/elasticsearch/test/disruption/LongGCDisruptionTests.java
test/framework/src/test/java/org/elasticsearch/test/disruption/NetworkDisruptionIT.java
test/framework/src/test/java/org/elasticsearch/test/disruption/NetworkDisruptionTests.java
comments:
Add task to look for tests in src/main (#24298)

Creates a new task `namingConventionsMain`, that runs on the
`buildSrc` and `test:framework` projects and fails the build if
any of the classes in the main artifacts are named like tests or
are non-abstract subclasses of ESTestCase.

It also fixes the three tests that would cause it to fail.

time:
2017-04-25T21:55:24Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/ParsedStats.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/InternalExtendedStats.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ParsedExtendedStats.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalExtendedStatsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalStatsTests.java
comments:
Add parsing for InternalExtendedStats (#24284)

time:
2017-04-25T20:53:05Z
class:
comments:
Link to minimum master nodes docs from Zen docs

This commit adds a link to the minimum master nodes section of the
important settings docs from the Zen discovery docs to clarify the
meaning and importance of setting minimum master nodes to a quorum of
master-eligible nodes.

Relates #24311

time:
2017-04-25T20:25:52Z
class:
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4InternalESLogger.java
comments:
Fix incorrect logger invocation

It looks like auto-complete gave us a nasty surprise here with
Logger#equals being invoked instead of Logger#error swallowing the
absolute worst-possible level of a log message. This commit fixes the
invocation.

time:
2017-04-25T16:49:50Z
class:
comments:
Drop `search_analyzer` parameter from keyword.asciidoc (#24221)

`search_analyzer` isn't supported by `keyword` fields so this removes
it from the documentation for them.

time:
2017-04-25T15:34:25Z
class:
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
comments:
Add support for `tests.enable_mock_modules` to ESIntegTestCase (#24309)

`tests.enable_mock_modules` is a documented but unrespected / unused
option to disable all mock modules / pluings during test runs. This
will basically site-step mock assertions like check-index on shard closing.
This can speed up test-execution dramatically on nodes with slow disks etc.

Relates to #24304

time:
2017-04-25T12:43:55Z
class:
comments:
Add newly open-sourced Scala REST client "escalar" (#24174)

Workday recently open-sourced our internal Scala wrapper for the Elasticsearch REST API. We plan to continue maintaining the library and use it in our products. Thought it would be a good idea to link it here in case anyone else is interested in using it!

time:
2017-04-25T11:43:21Z
class:
core/src/main/java/org/elasticsearch/rest/action/search/RestClearScrollAction.java
comments:
Allow passing single scrollID in clear scroll API body (#24242)

* Allow single scrollId in string format

Closes #24233

time:
2017-04-25T11:42:15Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/ParsedAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/ParsedSingleValueNumericMetricsAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/InternalStats.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/ParsedStats.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/InternalExtendedStats.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/derivative/ParsedDerivative.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalStatsTests.java
comments:
Add parsing for InternalStats (#24239)

time:
2017-04-25T11:13:55Z
class:
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocateUnassignedDecision.java
core/src/main/java/org/elasticsearch/common/settings/SecureSetting.java
core/src/main/java/org/elasticsearch/common/unit/TimeValue.java
core/src/main/java/org/elasticsearch/ingest/IngestDocument.java
core/src/main/java/org/elasticsearch/script/ScriptSettings.java
core/src/main/java/org/elasticsearch/search/internal/SearchContext.java
test/framework/src/main/java/org/elasticsearch/AnalysisFactoryTestCase.java
test/framework/src/main/java/org/elasticsearch/cluster/ESAllocationTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ClusterServiceUtils.java
test/framework/src/main/java/org/elasticsearch/test/PosixPermissionsResetter.java
comments:
Minor changes to collection creation from enums (#24274)

These changes are mainly cosmetic with minor perf advantages drawn from checkstyle.

time:
2017-04-25T10:04:02Z
class:
comments:
Revert "[TEST] mute failing docs test"

This reverts commit f2e31cdeefc4e03f5202951643b1c6e746817d10.

time:
2017-04-25T09:30:08Z
class:
comments:
[TEST] mute failing docs test

time:
2017-04-24T22:45:20Z
class:
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/ingest/InternalTemplateService.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/main/java/org/elasticsearch/template/CompiledTemplate.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
comments:
Templates: Add compileTemplate method to ScriptService for template consumers (#24280)

This commit adds a compileTemplate method to the ScriptService.
Eventually this will be used to easily cutover all consumers to a new
TemplateService.

relates #16314

time:
2017-04-24T21:22:37Z
class:
comments:
Docs test: Be ok with different _seq_nos

The test wanted specific _primary_terms and _seq_nos but there is
no need to specify that.

time:
2017-04-24T21:06:54Z
class:
comments:
CONSOLEify some of the docs documentation

delete, index, and update.

Relates to #18160

time:
2017-04-24T20:08:19Z
class:
comments:
CONSOLEify some more docs

Relates to #18160

time:
2017-04-24T18:22:39Z
class:
comments:
Allow painless to load stored fields (#24290)

We document that painless can load stored fields but it can't
because the classes that make that work aren't whitelisted.

time:
2017-04-24T16:58:02Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/Compiler.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Def.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/FeatureTest.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/FunctionRef.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/LambdaBootstrap.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/WriterConstants.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/Walker.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ECapturingFunctionRef.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EFunctionRef.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ELambda.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SFunction.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/AugmentationTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/FunctionRefTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/LambdaTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/node/NodeToStringTests.java
comments:
Fix Painless Lambdas for Java 9 (#24070)

Replaces LambdaMetaFactory with LambdaBootstrap, a custom solution for lambdas in Painless using a design similar to LambdaMetaFactory, but allows for custom adaptation of types which recent changes to LambdaMetaFactory no longer allowed.

time:
2017-04-24T16:42:41Z
class:
core/src/main/java/org/elasticsearch/cluster/SnapshotsInProgress.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/InternalGeoCentroid.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/InternalStats.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/Stats.java
core/src/main/java/org/elasticsearch/search/internal/AliasFilter.java
core/src/main/java/org/elasticsearch/search/suggest/completion/context/ContextMappings.java
core/src/test/java/org/elasticsearch/cluster/SnapshotsInProgressTests.java
core/src/test/java/org/elasticsearch/node/NodeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ExtendedStatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/StatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/geocentroid/InternalGeoCentroidTests.java
core/src/test/java/org/elasticsearch/search/internal/AliasFilterTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/CategoryContextMappingTests.java
qa/evil-tests/src/test/java/org/elasticsearch/node/EvilNodeTests.java
comments:
Merge branch 'master' into feature/client_aggs_parsing

time:
2017-04-24T16:40:57Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/InternalStats.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/Stats.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ExtendedStatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/StatsIT.java
comments:
Remove getCountAsString() from InternalStats and Stats interface (#24291)

The `count` value in the stats aggregation represents a simple doc count
that doesn't require a formatted version. We didn't render an "as_string"
version for count in the rest response, so the method should also be
removed in favour of just using String.valueOf(getCount()) if a string
version of the count is needed.

Closes #24287

time:
2017-04-24T15:04:58Z
class:
qa/evil-tests/src/test/java/org/elasticsearch/node/EvilNodeTests.java
comments:
Only test hard linking to directory on macOS

This skips trying to create a hard link to a directory in the evil node
tests on non-macOS operating systems.

time:
2017-04-24T14:59:08Z
class:
core/src/main/java/org/elasticsearch/cluster/SnapshotsInProgress.java
core/src/test/java/org/elasticsearch/cluster/SnapshotsInProgressTests.java
comments:
Fixes maintaining the shards a snapshot is waiting on (#24289)

There was a bug in the calculation of the shards that a snapshot must
wait on, due to their relocating or initializing, before the snapshot
can proceed safely to snapshot the shard data.  In this bug, an
incorrect key was used to look up the index of the waiting shards,
resulting in the fact that each index would have at most one shard in
the waiting state causing the snapshot to pause.  This could be
problematic if there are more than one shard in the relocating or
initializing state, which would result in a snapshot prematurely
starting because it thinks its only waiting on one relocating or
initializing shard (when in fact there could be more than one).  While
not a common case and likely rare in practice, it is still problematic.

This commit fixes the issue by ensuring the correct key is used to look
up the waiting indices map as it is being built up, so the list of
waiting shards for each index (those shards that are relocating or
initializing) are aggregated for a given index instead of overwritten.

time:
2017-04-24T14:57:25Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/InternalGeoCentroid.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/geocentroid/InternalGeoCentroidTests.java
comments:
[TEST] Added unittests for InternalGeoCentroid

Relates to #22278

time:
2017-04-24T14:35:14Z
class:
core/src/main/java/org/elasticsearch/search/suggest/completion/context/ContextMappings.java
core/src/test/java/org/elasticsearch/search/suggest/completion/CategoryContextMappingTests.java
comments:
Provide informative error message in case of unknown suggestion context. (#24241)

Provide a list of available contexts when you send an unknown context to the completion suggester.

time:
2017-04-24T14:29:49Z
class:
comments:
Document that painless doesn't support the "advanced text scoring"  (#24271)

I just spent ages debugging a script I wrote after following the documentation. It was not clear to me that _index is not defined when using painless; if it was mentioned on this page I would have saved myself a lot of time.

time:
2017-04-24T13:31:54Z
class:
core/src/main/java/org/elasticsearch/node/Node.java
core/src/test/java/org/elasticsearch/node/NodeTests.java
qa/evil-tests/src/test/java/org/elasticsearch/node/EvilNodeTests.java
comments:
Check for default.path.data included in path.data

If the user explicitly configured path.data to include
default.path.data, then we should not fail the node if we find indices
in default.path.data. This commit addresses this.

Relates #24285

time:
2017-04-24T13:06:36Z
class:
core/src/main/java/org/elasticsearch/search/internal/AliasFilter.java
core/src/test/java/org/elasticsearch/search/internal/AliasFilterTests.java
comments:
Fix hash code for AliasFilter

This commit fixes the hash code for AliasFilter as the previous
implementation was neglecting to take into consideration the fact that
the aliases field is an array and thus a deep hash code of it should be
computed rather than a shallow hash code on the reference.

Relates #24286

time:
2017-04-24T12:48:20Z
class:
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractAsyncBulkByScrollAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/EngineConfig.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/mapper/SourceToParse.java
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/StoreRecovery.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryPrepareForTranslogOperationsRequest.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTargetHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RemoteRecoveryTargetHandler.java
core/src/main/java/org/elasticsearch/plugins/PluginSecurity.java
core/src/main/java/org/elasticsearch/plugins/PluginsService.java
core/src/main/java/org/elasticsearch/script/ExecutableScript.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/main/java/org/elasticsearch/script/StoredScriptSource.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/ScriptFieldsFetchSubPhase.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionIndicesThatCannotBeCreatedTests.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionIngestTests.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionTookTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingDisabledTests.java
core/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
core/src/test/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetServiceTests.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySourceHandlerTests.java
core/src/test/java/org/elasticsearch/plugins/PluginsServiceTests.java
core/src/test/java/org/elasticsearch/script/NativeScriptTests.java
core/src/test/java/org/elasticsearch/script/ScriptServiceTests.java
core/src/test/java/org/elasticsearch/script/StoredScriptSourceTests.java
core/src/test/java/org/elasticsearch/script/StoredScriptTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/SumIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ValueCountIT.java
core/src/test/java/org/elasticsearch/search/aggregations/support/ScriptValuesTests.java
core/src/test/java/org/elasticsearch/tribe/TribeIT.java
distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/ListPluginsCommand.java
distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/PluginCli.java
distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/ProgressInputStream.java
distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/RemovePluginCommand.java
distribution/tools/plugin-cli/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java
distribution/tools/plugin-cli/src/test/java/org/elasticsearch/plugins/ListPluginsCommandTests.java
distribution/tools/plugin-cli/src/test/java/org/elasticsearch/plugins/ProgressInputStreamTests.java
distribution/tools/plugin-cli/src/test/java/org/elasticsearch/plugins/RemovePluginCommandTests.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ScriptProcessor.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/SimpleExecutableScript.java
qa/wildfly/src/main/java/org/elasticsearch/wildfly/model/Employee.java
qa/wildfly/src/main/java/org/elasticsearch/wildfly/transport/TransportClientActivator.java
qa/wildfly/src/main/java/org/elasticsearch/wildfly/transport/TransportClientEmployeeResource.java
qa/wildfly/src/main/java/org/elasticsearch/wildfly/transport/TransportClientProducer.java
qa/wildfly/src/main/java/org/elasticsearch/wildfly/transport/TransportJacksonJsonProvider.java
qa/wildfly/src/test/java/org/elasticsearch/wildfly/WildflyIT.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
test/framework/src/main/java/org/elasticsearch/search/aggregations/bucket/script/TestScript.java
comments:
Merge branch 'master' into feature/client_aggs_parsing

time:
2017-04-24T11:30:37Z
class:
comments:
Docs: Replace deprecated pluginList with Arrays.asList (#24270)

ESIntegTestCase#pluginList was remove removed in ES 5.0. We are using Arrays.asList instead.

time:
2017-04-24T10:27:41Z
class:
core/src/test/java/org/elasticsearch/tribe/TribeIT.java
comments:
[TEST] Wait for tribe node to be fully connected before shutting it down

The tribe was being shutdown by the test while a publishing round (that adds the tribe node to a cluster) is not completed yet (i.e. the node itself
knows that it became part of the cluster, and the test shuts the tribe node down, but another node has not applied the cluster state yet, which makes
that node hang while trying to connect to the node that is shutting down (due to connect_timeout being 30 seconds), delaying publishing for 30
seconds, and subsequently tripping an assertion when another tribe instance wants to join.

Relates to #23695

time:
2017-04-24T09:20:15Z
class:
core/src/main/java/org/elasticsearch/script/StoredScriptSource.java
comments:
Makes StoredScriptSource implement ToXContentObject

time:
2017-04-23T18:40:24Z
class:
comments:
Update docs to include index sorting link

time:
2017-04-23T15:40:45Z
class:
comments:
Revert "Temporarily change Wildfly artifact location"

This reverts commit 8c0329d915191961344d972227bc7ae8e70f3658.

time:
2017-04-22T17:37:13Z
class:
comments:
Test search templates during rolling upgrade test (#24258)

In #24251 we fix an issue with stored search templates that
this test would have discovered: stored search templates cause
the node to refuse to start. Technically a "restart" test would
have caught this as well and would have caught it more quickly.
But we already *have* an upgrade test and we don't have restart tests.
And testing this on upgrade is a good thing too.

time:
2017-04-22T17:37:04Z
class:
core/src/main/java/org/elasticsearch/script/StoredScriptSource.java
core/src/test/java/org/elasticsearch/script/StoredScriptSourceTests.java
core/src/test/java/org/elasticsearch/script/StoredScriptTests.java
comments:
No longer add illegal content type option to stored search templates (#24251)

When parsing StoredSearchScript we were adding a Content type option that was forbidden (by a check that threw an exception) by the parser thats used to parse the template when we read it from the cluster state. This was stopping Elastisearch from starting after stored search templates had been added.

This change no longer adds the content type option to the StoredScriptSource object when parsing from the put search template request.  This is safe because the StoredScriptSource content is always JSON when its stored in the cluster state since we do a conversion to JSON before this point.

Also removes the check for the content type in the options when parsing StoredScriptSource so users who already have stored scripts can start Elasticsearch.

Closes #24227

time:
2017-04-22T14:42:44Z
class:
comments:
Skip Wildfly tests on JDK 9

It seems that Wildfly 10 can not be made to start in a fully-functional
form on JDK 9, so this commit skips running the Wildfly integration
tests on JDK 9.

time:
2017-04-22T02:18:33Z
class:
distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/RemovePluginCommand.java
comments:
Remove extra newline in RemovePluginCommand.java

This commit removes an extra newline in RemovePluginCommand.java because
it drives the OCD among us insane.

time:
2017-04-22T02:15:29Z
class:
distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/RemovePluginCommand.java
comments:
Fix delete of plugin directory on remove plugin

This commit fixes an issue when deleting the plugin directory while
executing the remove plugin command. Namely, we take out a file
descriptor on the plugin directory to traverse its contents to obtain
the list of files to delete. We leaked this file descriptor. On
Unix-based filesystems, this is not a problem, deleting the plugin
directory deletes the plugin directory. On Windows though, a delete is
not executed until the last file descriptor is closed. Since we leaked
this file descriptor, the plugin was not actually deleted. This led to
test failures that tried to cleanup left behind temporary directories
but these test failures were just exposing this bug. This commit fixes
this issue by ensuring that we close the file descriptor to the plugin
directory when we are finished with it.

Relates #24266

time:
2017-04-22T00:53:03Z
class:
core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java
core/src/main/java/org/elasticsearch/index/query/QueryRewriteContext.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
core/src/test/java/org/elasticsearch/script/NativeScriptTests.java
core/src/test/java/org/elasticsearch/script/ScriptServiceTests.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ScriptProcessor.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
comments:
Scripts: Remove unnecessary executable shortcut (#24264)

ScriptService has two executable methods, one which takes a
CompiledScript, which is similar to search, and one that takes a raw
Script and both compiles and returns an ExecutableScript for it. The
latter is not needed, and the call sites which used one or the other
were mixed. This commit removes the extra executable method in favor of
callers first calling compile, then executable.

time:
2017-04-22T00:50:22Z
class:
core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractAsyncBulkByScrollAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java
core/src/main/java/org/elasticsearch/script/ExecutableScript.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/ScriptFieldsFetchSubPhase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/SumIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ValueCountIT.java
core/src/test/java/org/elasticsearch/search/aggregations/support/ScriptValuesTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/SimpleExecutableScript.java
test/framework/src/main/java/org/elasticsearch/search/aggregations/bucket/script/TestScript.java
comments:
Scripts: Remove unwrap method from executable scripts (#24263)

The unwrap method was leftover from support javascript and python. Since
those languages are removed in 6.0, this commit removes the unwrap
feature from scripts.

time:
2017-04-21T22:56:04Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionIndicesThatCannotBeCreatedTests.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionIngestTests.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionTookTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingDisabledTests.java
comments:
Fix _bulk response when it can't create an index (#24048)

Before #22488 when an index couldn't be created during a `_bulk`
operation we'd do all the *other* actions and return the index
creation error on each failing action. In #22488 we accidentally
changed it so that we now reject the entire bulk request if a single
action cannot create an index that it must create to run. This
gets reverts to the old behavior while still keeping the nicer
error messages. Instead of failing the entire request we now only
fail the portions of the request that can't work because the index
doesn't exist.

Closes #24028

time:
2017-04-21T22:22:55Z
class:
comments:
Add note to docs regarding JAVA_HOME on Windows

For the Windows service, JAVA_HOME should be set to the path to the
JDK. We should make this clear in the docs to help users avoid
frustrating startup problems.

Relates #24260

time:
2017-04-21T20:46:35Z
class:
comments:
Temporarily change Wildfly artifact location

This commit temporarily changes the Wildfly artifact location to prevent
builds from failing due to a Red Hat datacenter outage.

time:
2017-04-21T19:50:44Z
class:
core/src/main/java/org/elasticsearch/plugins/PluginsService.java
core/src/test/java/org/elasticsearch/plugins/PluginsServiceTests.java
distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/RemovePluginCommand.java
distribution/tools/plugin-cli/src/test/java/org/elasticsearch/plugins/RemovePluginCommandTests.java
comments:
Use a marker file when removing a plugin

Today when removing a plugin, we attempt to move the plugin directory to
a temporary directory and then delete that directory from the
filesystem. We do this to avoid a plugin being in a half-removed
state. We previously tried an atomic move, and fell back to a non-atomic
move if that failed. Atomic moves can fail on union filesystems when the
plugin directory is not in the top layer of the
filesystem. Interestingly, the regular move can fail as well. This is
because when the JDK is executing such a move, it first tries to rename
the source directory to the target directory and if this fails with
EXDEV (as in the case of an atomic move failing), it falls back to
copying the source to the target, and then attempts to rmdir the
source. The bug here is that the JDK never deleted the contents of the
source so the rmdir will always fail (except in the case of an empty
directory).

Given all this silliness, we were inspired to find a different
strategy. The strategy is simple. We will add a marker file to the
plugin directory that indicates the plugin is in a state of
removal. This file will be the last file out the door during removal. If
this file exists during startup, we fail startup.

Relates #24252

time:
2017-04-21T18:28:00Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/mapper/SourceToParse.java
core/src/main/java/org/elasticsearch/index/shard/StoreRecovery.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetServiceTests.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
comments:
Fill missing sequence IDs up to max sequence ID when recovering from store (#24238)

Today we might promote a primary and recover from store where after translog
recovery the local checkpoint is still behind the maximum sequence ID seen.
To fill the holes in the sequence ID history this PR adds a utility method
that fills up all missing sequence IDs up to the maximum seen sequence ID
with no-ops.

Relates to #10708

time:
2017-04-21T16:51:14Z
class:
qa/wildfly/src/main/java/org/elasticsearch/wildfly/model/Employee.java
qa/wildfly/src/main/java/org/elasticsearch/wildfly/transport/TransportClientActivator.java
qa/wildfly/src/main/java/org/elasticsearch/wildfly/transport/TransportClientEmployeeResource.java
qa/wildfly/src/main/java/org/elasticsearch/wildfly/transport/TransportClientProducer.java
qa/wildfly/src/main/java/org/elasticsearch/wildfly/transport/TransportJacksonJsonProvider.java
qa/wildfly/src/test/java/org/elasticsearch/wildfly/WildflyIT.java
comments:
Add Wildfly integration test

An important use case for our users is deploying our clients inside of
applications containers like Wildly. Sometimes, we make changes that
unintentionally break this use case. We need to know before we ship a
release that we have broken such use cases. As Wildfly is one of the
bigger application containers, this commit starts by adding an
integration test that deploys an application using the transport client
to Wildfly and ensures that all is well. Future work can add similar
integration tests for the low-level and high-level REST clients.

Relates #24147

time:
2017-04-21T16:25:58Z
class:
core/src/main/java/org/elasticsearch/plugins/PluginSecurity.java
distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/ListPluginsCommand.java
distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/PluginCli.java
distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/ProgressInputStream.java
distribution/tools/plugin-cli/src/main/java/org/elasticsearch/plugins/RemovePluginCommand.java
distribution/tools/plugin-cli/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java
distribution/tools/plugin-cli/src/test/java/org/elasticsearch/plugins/ListPluginsCommandTests.java
distribution/tools/plugin-cli/src/test/java/org/elasticsearch/plugins/ProgressInputStreamTests.java
distribution/tools/plugin-cli/src/test/java/org/elasticsearch/plugins/RemovePluginCommandTests.java
comments:
Build: Move plugin cli and tests to distribution tool (#24220)

The plugin cli currently resides inside the elasticsearch jar. This
commit moves it into a plugin-cli jar. This is change alone is a no-op;
it does not change anything about what is loaded at runtime. But it will
allow easier testing (with fixtures in the future to test ES or maven
installation), as well as eventually not loading these classes when
starting elasticsearch.

time:
2017-04-21T15:31:50Z
class:
core/src/main/java/org/elasticsearch/index/engine/EngineConfig.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/StoreRecovery.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryPrepareForTranslogOperationsRequest.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTargetHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RemoteRecoveryTargetHandler.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySourceHandlerTests.java
comments:
Peer Recovery: remove maxUnsafeAutoIdTimestamp hand off (#24243)

With #24149 , it is now stored in the Lucene commit and is implicitly transferred in the file phase of the recovery.

time:
2017-04-21T14:48:41Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
Adds version 5.3.2 and backwards compatibility indices for 5.3.1

time:
2017-04-21T13:46:18Z
class:
core/src/main/java/org/elasticsearch/common/util/concurrent/PrioritizedEsThreadPoolExecutor.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentParserUtils.java
core/src/main/java/org/elasticsearch/search/aggregations/InternalMultiBucketAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/MultiBucketsAggregation.java
core/src/main/java/org/elasticsearch/search/suggest/Suggest.java
core/src/test/java/org/elasticsearch/common/xcontent/XContentParserUtilsTests.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestionTests.java
comments:
Merge remote-tracking branch 'origin/master' into feature/client_aggs_parsing

time:
2017-04-21T13:41:27Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/XContentParserUtils.java
core/src/main/java/org/elasticsearch/search/suggest/Suggest.java
core/src/test/java/org/elasticsearch/common/xcontent/XContentParserUtilsTests.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestionTests.java
comments:
Add utility method to parse named XContent objects with typed prefix (#24240)

This commit adds a XContentParserUtils.parseTypedKeysObject() method
that can be used to parse named XContent objects identified by a field
name containing a type identifier, a delimiter and the name of the
object to parse.

time:
2017-04-21T13:29:53Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/InternalMultiBucketAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/MultiBucketsAggregation.java
comments:
MultiBucketsAggregation.Bucket should not extend Writeable (#24216)

The MultiBucketsAggregation.Bucket interface extends Writeable, forcing
all implementation classes to implement writeTo(). This commit removes
the Writeable from the interface and move it down to the InternalBucket
implementation.

time:
2017-04-21T13:25:19Z
class:
core/src/main/java/org/elasticsearch/common/util/concurrent/PrioritizedEsThreadPoolExecutor.java
comments:
Don't expose cleaned-up tasks as pending in PrioritizedEsThreadPoolExecutor (#24237)

Changes in #24102 exposed the following oddity: PrioritizedEsThreadPoolExecutor.getPending() can return Pending entries where pending.task == null. This can happen for example when tasks are added to the pending list while they are in the clean up phase, i.e. TieBreakingPrioritizedRunnable#runAndClean has run already, but afterExecute has not removed the task yet. Instead of safeguarding consumers of the API (as was done before #24102) this changes the executor to not count these tasks as pending at all.

time:
2017-04-21T10:18:06Z
class:
core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
core/src/main/java/org/elasticsearch/common/xcontent/AbstractObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ConstructingObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java
core/src/main/java/org/elasticsearch/index/mapper/KeywordFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TokenCountFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/indices/IndicesQueryCache.java
core/src/test/java/org/elasticsearch/common/xcontent/ConstructingObjectParserTests.java
core/src/test/java/org/elasticsearch/index/mapper/KeywordFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/TokenCountFieldMapperIntegrationIT.java
core/src/test/java/org/elasticsearch/index/mapper/TokenCountFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
core/src/test/java/org/elasticsearch/indices/IndicesQueryCacheTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalStatsTests.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
comments:
Merge branch 'master' into feature/client_aggs_parsing

time:
2017-04-21T08:50:30Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/AbstractObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ConstructingObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java
core/src/test/java/org/elasticsearch/common/xcontent/ConstructingObjectParserTests.java
comments:
Adds declareNamedObjects methods to ConstructingObjectParser (#24219)

* Adds declareNamedObjects methods to ConstructingObjectParser

* Addresses review comments

time:
2017-04-21T08:38:36Z
class:
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
comments:
ESIntegTestCase.indexRandom should not introduce types. (#24202)

Since we plan on removing types, `indexRandom` should not introduce new types.
This commit refactors `indexRandom` to reuse existing types.

time:
2017-04-21T08:38:09Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalStatsTests.java
comments:
Tests: Extend InternalStatsTests (#24212)

Currently we don't test for count = 0 which will make a difference when adding
tests for parsing for the high level rest client. Also min/max/sum should also
be tested with negative values and on a larger range.

time:
2017-04-21T08:33:02Z
class:
core/src/main/java/org/elasticsearch/indices/IndicesQueryCache.java
core/src/test/java/org/elasticsearch/indices/IndicesQueryCacheTests.java
comments:
IndicesQueryCache should delegate the scorerSupplier method. (#24209)

Otherwise the range improvements that we did on range queries would not work.
This is similar to https://issues.apache.org/jira/browse/LUCENE-7749.

time:
2017-04-21T08:32:33Z
class:
core/src/main/java/org/elasticsearch/index/mapper/KeywordFieldMapper.java
core/src/test/java/org/elasticsearch/index/mapper/KeywordFieldTypeTests.java
comments:
Speed up parsing of large `terms` queries. (#24210)

The addition of the normalization feature on keywords slowed down the parsing
of large `terms` queries since all terms now have to go through normalization.
However this can be avoided in the default case that the analyzer is a
`keyword` analyzer since all that normalization will do is a UTF8 conversion.
Using `Analyzer.normalize` for that is a bit overkill and could be skipped.

time:
2017-04-21T00:56:26Z
class:
core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
comments:
[TEST] make sure that the random query_string query generator defines a default_field or a list of fields

time:
2017-04-20T22:53:28Z
class:
core/src/main/java/org/elasticsearch/index/mapper/TokenCountFieldMapper.java
core/src/test/java/org/elasticsearch/index/mapper/TokenCountFieldMapperIntegrationIT.java
core/src/test/java/org/elasticsearch/index/mapper/TokenCountFieldMapperTests.java
comments:
token_count type : add an option to count tokens (fix #23227) (#24175)

Add option "enable_position_increments" with default value true.
If option is set to false, indexed value is the number of tokens
(not position increments count)

time:
2017-04-20T21:03:58Z
class:
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/cluster/service/SourcePrioritizedRunnable.java
core/src/main/java/org/elasticsearch/cluster/service/TaskBatcher.java
core/src/main/java/org/elasticsearch/common/util/concurrent/EsExecutors.java
core/src/main/java/org/elasticsearch/common/util/concurrent/PrioritizedEsThreadPoolExecutor.java
core/src/main/java/org/elasticsearch/search/aggregations/Aggregations.java
core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregations.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
core/src/test/java/org/elasticsearch/cluster/service/TaskBatcherTests.java
core/src/test/java/org/elasticsearch/cluster/service/TaskExecutorTests.java
core/src/test/java/org/elasticsearch/common/util/concurrent/PrioritizedExecutorsTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
Merge branch 'master' into feature/client_aggs_parsing

time:
2017-04-20T20:12:20Z
class:
core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
comments:
Query string default field (#24214)

Currently any `query_string` query that use a wildcard field with no matching field is rewritten with the `_all` field.

For instance:
````
#creating test doc
PUT testing/t/1
{
  "test": {
    "field_one": "hello",
    "field_two": "world"
  }
}
#searching abc.* (does not exist) -> hit
GET testing/t/_search
{
  "query": {
    "query_string": {
      "fields": [
        "abc.*"
      ],
      "query": "hello"
    }
  }
}
````

This bug first appeared in 5.0 after the query refactoring and impacts only users that use `_all` as default field.
Indices created in 6.x will not have this problem since `_all` is deactivated in this version.

This change fixes this bug by returning a MatchNoDocsQuery for any term that expand to an empty list of field.

time:
2017-04-20T19:31:34Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/Aggregations.java
core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregations.java
comments:
Make Aggregations an abstract class rather than an interface (#24184)

Some of the base methods that don't have to do with reduce phase and serialization can be moved to the base class which is no longer an interface. This will be reusable by the high level REST client further on the road. Also it simplify things as having an interface with a single implementor is not that helpful.

time:
2017-04-20T17:38:52Z
class:
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
[TEST] ensure expected sequence no and version are set when index/delete engine operation has a document failure

time:
2017-04-20T15:28:43Z
class:
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/cluster/service/SourcePrioritizedRunnable.java
core/src/main/java/org/elasticsearch/cluster/service/TaskBatcher.java
core/src/main/java/org/elasticsearch/common/util/concurrent/EsExecutors.java
core/src/main/java/org/elasticsearch/common/util/concurrent/PrioritizedEsThreadPoolExecutor.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
core/src/test/java/org/elasticsearch/cluster/service/TaskBatcherTests.java
core/src/test/java/org/elasticsearch/cluster/service/TaskExecutorTests.java
core/src/test/java/org/elasticsearch/common/util/concurrent/PrioritizedExecutorsTests.java
comments:
Extract batch executor out of cluster service (#24102)

Refactoring that extracts the task batching functionality from ClusterService and makes it a reusable component that can be tested in isolation.

time:
2017-04-20T15:09:18Z
class:
comments:
Add 5.3.1 to bwc versions

time:
2017-04-20T13:04:20Z
class:
comments:
Added "release-state" support to plugin docs

time:
2017-04-20T13:02:52Z
class:
comments:
Added examples to cross cluster search of using cluster settings

time:
2017-04-20T11:36:16Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/AbstractPercentilesTestCase.java
comments:
[Test] Expose AbstractPercentilesTestCase.randomPercents()

time:
2017-04-20T11:35:21Z
class:
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/DeleteResponse.java
core/src/main/java/org/elasticsearch/action/index/IndexResponse.java
core/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateResponse.java
core/src/main/java/org/elasticsearch/index/analysis/EdgeNGramTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/TokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/InternalHDRPercentiles.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/FragmentBuilderHelper.java
core/src/test/java/org/elasticsearch/action/DocWriteResponseTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/TransportAnalyzeActionTests.java
core/src/test/java/org/elasticsearch/action/bulk/BulkRequestModifierTests.java
core/src/test/java/org/elasticsearch/action/bulk/TransportShardBulkActionTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/AsyncBulkByScrollActionTests.java
core/src/test/java/org/elasticsearch/action/delete/DeleteResponseTests.java
core/src/test/java/org/elasticsearch/action/index/IndexRequestTests.java
core/src/test/java/org/elasticsearch/action/index/IndexResponseTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateResponseTests.java
core/src/test/java/org/elasticsearch/index/analysis/AnalysisFactoryTests.java
core/src/test/java/org/elasticsearch/index/analysis/AnalysisRegistryTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/InternalHDRPercentilesTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java
core/src/test/java/org/elasticsearch/search/query/SearchQueryIT.java
modules/analysis-common/src/main/java/org/elasticsearch/analysis/common/ASCIIFoldingTokenFilterFactory.java
modules/analysis-common/src/main/java/org/elasticsearch/analysis/common/CommonAnalysisPlugin.java
modules/analysis-common/src/main/java/org/elasticsearch/analysis/common/WordDelimiterGraphTokenFilterFactory.java
modules/analysis-common/src/main/java/org/elasticsearch/analysis/common/WordDelimiterTokenFilterFactory.java
modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/ASCIIFoldingTokenFilterFactoryTests.java
modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/BaseWordDelimiterTokenFilterFactoryTestCase.java
modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/CommonAnalysisClientYamlTestSuiteIT.java
modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/CommonAnalysisFactoryTests.java
modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/HighlighterWithAnalyzersTests.java
modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/QueryStringWithAnalyzersTests.java
modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/WordDelimiterGraphTokenFilterFactoryTests.java
modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/WordDelimiterTokenFilterFactoryTests.java
plugins/analysis-stempel/src/test/java/org/elasticsearch/index/analysis/AnalysisPolishFactoryTests.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2Service.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2ServiceImpl.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsSigner.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/AWSSignersTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/AwsEc2ServiceImplTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryClusterFormationTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoverySettingsTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryUpdateSettingsTests.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java
test/framework/src/main/java/org/elasticsearch/AnalysisFactoryTestCase.java
test/framework/src/main/java/org/elasticsearch/index/analysis/AnalysisTestsHelper.java
test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java
comments:
Merge remote-tracking branch 'origin/master' into feature/client_aggs_parsing

# Conflicts:
#	core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/InternalPercentilesTestCase.java
#	core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/InternalHDRPercentilesTests.java

time:
2017-04-20T11:34:30Z
class:
comments:
Reword note on whitespace in Log4j settings

This commit rewords the note on whitespace in Log4j settings to not
refer to only of the examples on the page, but instead be clear that the
note applies to all the examples on the page.

time:
2017-04-20T11:29:21Z
class:
comments:
Add note to docs on whitespace in Log4j settings

A confusing thing that can happen when configuring Log4j is that
extraneous whitespace throws off its configuration parsing yet the error
messages that arise give no indication that this is the problem. This
commit adds a note to the docs.

Relates #24198

time:
2017-04-20T11:22:50Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/AbstractPercentilesTestCase.java
comments:
 [Test] Always check the XContent equivalent when parsing aggregations (#24208)

In InternalAggregationTestCase, we can check that the internal aggregation and the parsed aggregation always produce the same XContent even if the original internal aggregation has been shuffled or not.

time:
2017-04-20T10:37:33Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/InternalHDRPercentiles.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/InternalPercentilesTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/InternalHDRPercentilesTests.java
comments:
Align behavior or HDR percentiles iterator with percentile() method (#24206)

time:
2017-04-20T09:49:09Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/InternalBucketMetricValue.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/ParsedBucketMetricValue.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/InternalBucketMetricValueTests.java
comments:
Add parsing for InternalBucketMetricValue (#24182)

time:
2017-04-20T08:44:12Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/AbstractPercentilesTestCase.java
comments:
Remove @Repeat(iterations = 1000) in tests

time:
2017-04-20T08:35:35Z
class:
comments:
Update TransportClient java documentation (#24205)

We are using now in master `TransportAddress` instead of `InetSocketTransportAddress`.

time:
2017-04-20T08:16:51Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/ParsedPercentileRanks.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/ParsedPercentiles.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/ParsedHDRPercentileRanks.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/ParsedHDRPercentiles.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/ParsedTDigestPercentileRanks.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/ParsedTDigestPercentiles.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/AbstractPercentilesTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/InternalPercentilesRanksTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/InternalPercentilesTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/InternalHDRPercentilesRanksTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/InternalHDRPercentilesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/InternalTDigestPercentilesRanksTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/InternalTDigestPercentilesTests.java
comments:
Add parsing methods for Percentiles aggregations (#24183)

time:
2017-04-19T22:51:34Z
class:
core/src/main/java/org/elasticsearch/index/analysis/EdgeNGramTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/TokenFilterFactory.java
core/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/FragmentBuilderHelper.java
core/src/test/java/org/elasticsearch/action/admin/indices/TransportAnalyzeActionTests.java
core/src/test/java/org/elasticsearch/index/analysis/AnalysisFactoryTests.java
core/src/test/java/org/elasticsearch/index/analysis/AnalysisRegistryTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java
core/src/test/java/org/elasticsearch/search/query/SearchQueryIT.java
modules/analysis-common/src/main/java/org/elasticsearch/analysis/common/ASCIIFoldingTokenFilterFactory.java
modules/analysis-common/src/main/java/org/elasticsearch/analysis/common/CommonAnalysisPlugin.java
modules/analysis-common/src/main/java/org/elasticsearch/analysis/common/WordDelimiterGraphTokenFilterFactory.java
modules/analysis-common/src/main/java/org/elasticsearch/analysis/common/WordDelimiterTokenFilterFactory.java
modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/ASCIIFoldingTokenFilterFactoryTests.java
modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/BaseWordDelimiterTokenFilterFactoryTestCase.java
modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/CommonAnalysisClientYamlTestSuiteIT.java
modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/CommonAnalysisFactoryTests.java
modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/HighlighterWithAnalyzersTests.java
modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/QueryStringWithAnalyzersTests.java
modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/WordDelimiterGraphTokenFilterFactoryTests.java
modules/analysis-common/src/test/java/org/elasticsearch/analysis/common/WordDelimiterTokenFilterFactoryTests.java
plugins/analysis-stempel/src/test/java/org/elasticsearch/index/analysis/AnalysisPolishFactoryTests.java
test/framework/src/main/java/org/elasticsearch/AnalysisFactoryTestCase.java
test/framework/src/main/java/org/elasticsearch/index/analysis/AnalysisTestsHelper.java
comments:
Start building analysis-common module (#23614)

Start moving built in analysis components into the new analysis-common
module. The goal of this project is:
1. Remove core's dependency on lucene-analyzers-common.jar which should
shrink the dependencies for transport client and high level rest client.
2. Prove that analysis plugins can do all the "built in" things by moving all
"built in" behavior to a plugin.
3. Force tests not to depend on any oddball analyzer behavior. If tests
need anything more than the standard analyzer they can use the mock
analyzer provided by Lucene's test infrastructure.

time:
2017-04-19T19:06:10Z
class:
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2Service.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2ServiceImpl.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsSigner.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/AWSSignersTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/AwsEc2ServiceImplTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryClusterFormationTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoverySettingsTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryUpdateSettingsTests.java
comments:
Ec2 Discovery: Cleanup deprecated settings (#24150)

This commit removes the deprecated cloud.aws.* settings. It also removes
backcompat for specifying `discovery.type: ec2`, and unused aws signer
code which was removed in a previous PR.

time:
2017-04-19T18:44:22Z
class:
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/DeleteResponse.java
core/src/main/java/org/elasticsearch/action/index/IndexResponse.java
core/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateResponse.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/test/java/org/elasticsearch/action/DocWriteResponseTests.java
core/src/test/java/org/elasticsearch/action/bulk/BulkRequestModifierTests.java
core/src/test/java/org/elasticsearch/action/bulk/TransportShardBulkActionTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/AsyncBulkByScrollActionTests.java
core/src/test/java/org/elasticsearch/action/delete/DeleteResponseTests.java
core/src/test/java/org/elasticsearch/action/index/IndexRequestTests.java
core/src/test/java/org/elasticsearch/action/index/IndexResponseTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateResponseTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
comments:
Add primary term to doc write response

This commit adds the primary term to the doc write response.

Relates #24171

time:
2017-04-19T17:50:47Z
class:
comments:
Build: Add jstack output when starting integ test cluster if timeout occurs (#24193)

This commit adds a call to jstack to see where each node is stuck when
starting up, if a timeout occurs. This also decreases the timeout back
to 30 seconds.

time:
2017-04-19T17:17:09Z
class:
test/framework/src/main/java/org/elasticsearch/test/rest/ESRestTestCase.java
comments:
Wait for cluster to become quiescent between REST tests (#24148)

[TEST] ensures REST tests wait for cluster state updates to finish
processing before moving to the next test

time:
2017-04-19T16:09:34Z
class:
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java
comments:
Plugins: Remove leniency for missing plugins dir (#24173)

This leniency was left in after plugin installer refactoring for 2.0
because some tests still relied on it. However, the need for this
leniency no longer exists.

time:
2017-04-19T14:49:13Z
class:
comments:
Changing some grammar in docs (#24164)

time:
2017-04-19T14:37:22Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/segments/IndicesSegmentResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/shrink/ShrinkRequest.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/IndexSettings.java
core/src/main/java/org/elasticsearch/index/IndexSortConfig.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/EngineConfig.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/Segment.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/StoreRecovery.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/BucketMetricValue.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/InternalBucketMetricValue.java
core/src/test/java/org/elasticsearch/action/admin/indices/create/ShrinkIndexIT.java
core/src/test/java/org/elasticsearch/index/IndexSortIT.java
core/src/test/java/org/elasticsearch/index/IndexSortSettingsTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/engine/SegmentTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
core/src/test/java/org/elasticsearch/index/shard/StoreRecoveryTests.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
comments:
Merge branch 'master' into feature/client_aggs_parsing

time:
2017-04-19T14:27:33Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/BucketMetricValue.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/InternalBucketMetricValue.java
comments:
Add BucketMetricValue interface (#24188)

Unlike other implementations of InternalNumericMetricsAggregation.SingleValue,
the InternalBucketMetricValue aggregation currently doesn't implement a
specialized interface that exposes the `keys()` method. This change adds this so
that clients can access the keys via the interface.

time:
2017-04-19T12:36:11Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/segments/IndicesSegmentResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/shrink/ShrinkRequest.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/IndexSettings.java
core/src/main/java/org/elasticsearch/index/IndexSortConfig.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/EngineConfig.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/Segment.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/StoreRecovery.java
core/src/test/java/org/elasticsearch/action/admin/indices/create/ShrinkIndexIT.java
core/src/test/java/org/elasticsearch/index/IndexSortIT.java
core/src/test/java/org/elasticsearch/index/IndexSortSettingsTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/engine/SegmentTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
core/src/test/java/org/elasticsearch/index/shard/StoreRecoveryTests.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
comments:
Enable index-time sorting (#24055)

This change adds an index setting to define how the documents should be sorted inside each Segment.
It allows any numeric, date, boolean or keyword field inside a mapping to be used to sort the index on disk.
It is not allowed to use a `nested` fields inside an index that defines an index sorting since `nested` fields relies on the original sort of the index.
This change does not add early termination capabilities in the search layer. This will be added in a follow up.

Relates #6720

time:
2017-04-19T12:12:46Z
class:
comments:
Clarify elasticsearch user uid:gid mapping in Docker docs

Elasticsearch runs as user elasticsearch with uid:gid 1000:1000 inside
the Docker container. Clarify that bind mounted local directories need
to be accessible by this user.

Relates #24092

time:
2017-04-19T10:58:26Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/ParsedSingleValueNumericMetricsAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/ParsedAvg.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/max/ParsedMax.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/min/ParsedMin.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/sum/ParsedSum.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/ParsedSimpleValue.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/derivative/ParsedDerivative.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/InternalSimpleValueTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/derivative/InternalDerivativeTests.java
comments:
Add parsing for InternalSimpleValue and InternalDerivative (#24162)

time:
2017-04-19T09:57:37Z
class:
comments:
Update field-names-field.asciidoc (#24178)

fix typo in field name

time:
2017-04-19T08:23:25Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/ParsedSingleValueNumericMetricsAggregation.java
comments:
Fix checkstyle violation

time:
2017-04-19T08:12:11Z
class:
core/src/main/java/org/apache/lucene/queries/BlendedTermQuery.java
core/src/main/java/org/apache/lucene/queries/ExtendedCommonTermsQuery.java
core/src/main/java/org/apache/lucene/queries/MinDocQuery.java
core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
core/src/main/java/org/apache/lucene/search/grouping/CollapsingDocValuesSource.java
core/src/main/java/org/apache/lucene/search/grouping/CollapsingTopDocsCollector.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/main/java/org/elasticsearch/common/geo/GeoHashUtils.java
core/src/main/java/org/elasticsearch/common/geo/GeoPoint.java
core/src/main/java/org/elasticsearch/common/geo/GeoUtils.java
core/src/main/java/org/elasticsearch/common/lucene/Lucene.java
core/src/main/java/org/elasticsearch/common/lucene/ShardCoreKeyMap.java
core/src/main/java/org/elasticsearch/common/lucene/all/AllTermQuery.java
core/src/main/java/org/elasticsearch/common/lucene/index/ElasticsearchDirectoryReader.java
core/src/main/java/org/elasticsearch/common/lucene/index/ElasticsearchLeafReader.java
core/src/main/java/org/elasticsearch/common/lucene/search/Queries.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/FieldValueFactorFunction.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/FiltersFunctionScoreQuery.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/FunctionScoreQuery.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/LeafScoreFunction.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/RandomScoreFunction.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/WeightFactorFunction.java
core/src/main/java/org/elasticsearch/common/lucene/uid/PerThreadIDVersionAndSeqNoLookup.java
core/src/main/java/org/elasticsearch/common/lucene/uid/VersionsAndSeqNoResolver.java
core/src/main/java/org/elasticsearch/discovery/zen/ElectMasterService.java
core/src/main/java/org/elasticsearch/index/cache/bitset/BitsetFilterCache.java
core/src/main/java/org/elasticsearch/index/codec/CodecService.java
core/src/main/java/org/elasticsearch/index/codec/PerFieldMappingPostingFormatCodec.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/fielddata/AbstractBinaryDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/AbstractNumericDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/AbstractSortedDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/AbstractSortedNumericDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/AbstractSortedSetDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/AbstractSortingNumericDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/AtomicOrdinalsFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/FieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/GeoPointValues.java
core/src/main/java/org/elasticsearch/index/fielddata/MultiGeoPointValues.java
core/src/main/java/org/elasticsearch/index/fielddata/NumericDoubleValues.java
core/src/main/java/org/elasticsearch/index/fielddata/ScriptDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SingletonMultiGeoPointValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SingletonSortedBinaryDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SingletonSortedNumericDoubleValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SortableLongBitsNumericDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SortableLongBitsSortedNumericDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SortableLongBitsToNumericDoubleValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SortableLongBitsToSortedNumericDoubleValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SortedBinaryDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SortedNumericDoubleValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SortingBinaryDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SortingNumericDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SortingNumericDoubleValues.java
core/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefFieldComparatorSource.java
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/GlobalOrdinalMapping.java
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/GlobalOrdinalsBuilder.java
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/InternalGlobalOrdinalsIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/MultiOrdinals.java
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/Ordinals.java
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/OrdinalsBuilder.java
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/SinglePackedOrdinals.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractAtomicGeoPointFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractAtomicOrdinalsFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractAtomicParentChildFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractGeoPointDVIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractIndexGeoPointFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractLatLonPointDVIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AtomicDoubleFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/BinaryDVAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/BytesBinaryDVAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/DocValuesIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/GeoPointDVAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/IndexIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/LatLonPointDVAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/PagedBytesAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/ParentChildIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/SortedNumericDVIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/SortedSetDVBytesAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/SortedSetDVOrdinalsIndexFieldData.java
core/src/main/java/org/elasticsearch/index/mapper/CustomDocValuesField.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java
core/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/GeoShapeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IpFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/BoolQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryParser.java
core/src/main/java/org/elasticsearch/index/query/functionscore/DecayFunctionBuilder.java
core/src/main/java/org/elasticsearch/index/search/ESToParentBlockJoinQuery.java
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
core/src/main/java/org/elasticsearch/index/search/MultiMatchQuery.java
core/src/main/java/org/elasticsearch/index/shard/FilterDocValuesProducer.java
core/src/main/java/org/elasticsearch/index/shard/IndexSearcherWrapper.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/TranslogRecoveryPerformer.java
core/src/main/java/org/elasticsearch/index/similarity/SimilarityService.java
core/src/main/java/org/elasticsearch/indices/IndicesQueryCache.java
core/src/main/java/org/elasticsearch/indices/IndicesRequestCache.java
core/src/main/java/org/elasticsearch/indices/fielddata/cache/IndicesFieldDataCache.java
core/src/main/java/org/elasticsearch/search/DocValueFormat.java
core/src/main/java/org/elasticsearch/search/MultiValueMode.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/children/ParentToChildrenAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoGridAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/BinaryRangeAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedBytesHashSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedMapSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedNumericSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedOrdinalsSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/GlobalOrdinalsSignificantTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/GlobalOrdinalsStringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/LongTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/StringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/support/IncludeExclude.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/AvgAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/GeoBoundsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/GeoCentroidAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/InternalGeoCentroid.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/max/MaxAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/min/MinAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/AbstractHDRPercentilesAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/AbstractTDigestPercentilesAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/StatsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ExtendedStatsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/sum/SumAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/valuecount/ValueCountAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/support/MissingValues.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSource.java
core/src/main/java/org/elasticsearch/search/aggregations/support/values/ScriptBytesValues.java
core/src/main/java/org/elasticsearch/search/aggregations/support/values/ScriptDoubleValues.java
core/src/main/java/org/elasticsearch/search/aggregations/support/values/ScriptLongValues.java
core/src/main/java/org/elasticsearch/search/fetch/FetchPhase.java
core/src/main/java/org/elasticsearch/search/fetch/FetchSubPhase.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/DocValueFieldsFetchSubPhase.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/InnerHitsContext.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/ParentFieldSubFetchPhase.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/VersionFetchSubPhase.java
core/src/main/java/org/elasticsearch/search/internal/ContextIndexSearcher.java
core/src/main/java/org/elasticsearch/search/lookup/LeafDocLookup.java
core/src/main/java/org/elasticsearch/search/profile/query/ProfileWeight.java
core/src/main/java/org/elasticsearch/search/slice/DocValuesSliceQuery.java
core/src/main/java/org/elasticsearch/search/slice/TermsSliceQuery.java
core/src/main/java/org/elasticsearch/search/sort/ScriptSortBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggester.java
core/src/test/java/org/apache/lucene/queries/BlendedTermQueryTests.java
core/src/test/java/org/elasticsearch/action/bulk/TransportShardBulkActionTests.java
core/src/test/java/org/elasticsearch/common/lucene/LuceneTests.java
core/src/test/java/org/elasticsearch/common/lucene/ShardCoreKeyMapTests.java
core/src/test/java/org/elasticsearch/common/lucene/index/ESDirectoryReaderTests.java
core/src/test/java/org/elasticsearch/deps/lucene/SimpleLuceneTests.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/codec/CodecTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractFieldDataImplTestCase.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractGeoFieldDataTestCase.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractStringFieldDataTestCase.java
core/src/test/java/org/elasticsearch/index/fielddata/BinaryDVFieldDataTests.java
core/src/test/java/org/elasticsearch/index/fielddata/FieldDataTests.java
core/src/test/java/org/elasticsearch/index/fielddata/FilterFieldDataTests.java
core/src/test/java/org/elasticsearch/index/fielddata/ParentChildFieldDataTests.java
core/src/test/java/org/elasticsearch/index/fielddata/ScriptDocValuesDatesTests.java
core/src/test/java/org/elasticsearch/index/fielddata/ScriptDocValuesGeoPointsTests.java
core/src/test/java/org/elasticsearch/index/fielddata/ScriptDocValuesLongsTests.java
core/src/test/java/org/elasticsearch/index/fielddata/fieldcomparator/ReplaceMissingTests.java
core/src/test/java/org/elasticsearch/index/fielddata/ordinals/MultiOrdinalsTests.java
core/src/test/java/org/elasticsearch/index/fielddata/ordinals/SingleOrdinalsTests.java
core/src/test/java/org/elasticsearch/index/fielddata/plain/HalfFloatFielddataTests.java
core/src/test/java/org/elasticsearch/index/mapper/BooleanFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/FakeStringFieldMapper.java
core/src/test/java/org/elasticsearch/index/mapper/ScaledFloatFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/CommonTermsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MultiMatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/NestedQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryParserTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryStringBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreTests.java
core/src/test/java/org/elasticsearch/index/query/plugin/DummyQueryParserPlugin.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/replication/IndexLevelReplicationTests.java
core/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java
core/src/test/java/org/elasticsearch/index/search/MultiMatchQueryTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexSearcherWrapperTests.java
core/src/test/java/org/elasticsearch/index/store/StoreTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
core/src/test/java/org/elasticsearch/indices/IndicesQueryCacheTests.java
core/src/test/java/org/elasticsearch/indices/memory/breaker/RandomExceptionCircuitBreakerIT.java
core/src/test/java/org/elasticsearch/search/DocValueFormatTests.java
core/src/test/java/org/elasticsearch/search/MultiValueModeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/InternalSingleBucketAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/global/InternalGlobalTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/BinaryRangeAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalMaxTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvgTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/min/InternalMinTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/InternalPercentilesTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/InternalHDRPercentilesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/InternalTDigestPercentilesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/InternalSimpleValueTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/derivative/InternalDerivativeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/support/IncludeExcludeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/support/MissingValuesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/support/ScriptValuesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/support/ValuesSourceConfigTests.java
core/src/test/java/org/elasticsearch/search/basic/SearchWithRandomExceptionsIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/PlainHighlighterTests.java
core/src/test/java/org/elasticsearch/search/functionscore/QueryRescorerIT.java
core/src/test/java/org/elasticsearch/search/query/SimpleQueryStringIT.java
distribution/deb/src/test/java/org/elasticsearch/test/rest/DebClientYamlTestSuiteIT.java
distribution/integ-test-zip/src/test/java/org/elasticsearch/test/rest/IntegTestZipClientYamlTestSuiteIT.java
distribution/rpm/src/test/java/org/elasticsearch/test/rest/RpmClientYamlTestSuiteIT.java
distribution/tar/src/test/java/org/elasticsearch/test/rest/TarClientYamlTestSuiteIT.java
distribution/zip/src/test/java/org/elasticsearch/test/rest/ZipClientYamlTestSuiteIT.java
docs/src/test/java/org/elasticsearch/smoketest/DocsClientYamlTestSuiteIT.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/matrix/stats/MatrixStatsAggregator.java
modules/aggs-matrix-stats/src/test/java/org/elasticsearch/search/aggregations/matrix/MatrixStatsClientYamlTestSuiteIT.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/IngestCommonClientYamlTestSuiteIT.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/CountMethodValueSource.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/DateMethodValueSource.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/DateObjectValueSource.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/EmptyMemberValueSource.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/FieldDataValueSource.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/GeoEmptyValueSource.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/GeoLatitudeValueSource.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/GeoLongitudeValueSource.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/LangExpressionClientYamlTestSuiteIT.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/LangMustacheClientYamlTestSuiteIT.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Compiler.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/CompilerSettings.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Def.java
comments:
Merge remote-tracking branch 'origin/master' into feature/client_aggs_parsing

# Conflicts:
#	core/src/main/java/org/elasticsearch/search/DocValueFormat.java
#	core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
#	core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalMaxTests.java
#	core/src/test/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvgTests.java
#	core/src/test/java/org/elasticsearch/search/aggregations/metrics/min/InternalMinTests.java

time:
2017-04-19T07:52:06Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/ElectMasterService.java
comments:
ElectMasterService.hasEnoughMasterNodes should return false if no masters were found

This is a regression introduced in #20063

time:
2017-04-19T07:39:42Z
class:
comments:
Remove Ubuntu 12.04 (#24161)

Ubuntu 12.04 will be EOL on April 28, 2017.

time:
2017-04-19T07:37:01Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/InternalPercentilesTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/InternalHDRPercentilesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/InternalTDigestPercentilesTests.java
comments:
[Test] Add unit tests for InternalHDRPercentilesTests (#24157)

Related to #22278

time:
2017-04-19T05:23:54Z
class:
core/src/main/java/org/elasticsearch/action/bulk/BulkItemRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/TranslogRecoveryPerformer.java
core/src/test/java/org/elasticsearch/action/bulk/TransportShardBulkActionTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/replication/IndexLevelReplicationTests.java
core/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java
qa/backwards-5.0/src/test/java/org/elasticsearch/backwards/IndexingIT.java
comments:
Replicate write failures (#23314)

* Replicate write failures

Currently, when a primary write operation fails after generating
a sequence number, the failure is not communicated to the replicas.
Ideally, every operation which generates a sequence number on primary
should be recorded in all replicas.

In this change, a sequence number is associated with write operation
failure. When a failure with an assinged seqence number arrives at a
replica, the failure cause and sequence number is recorded in the translog
and the sequence number is marked as completed via executing `Engine.noOp`
on the replica engine.

* use zlong to serialize seq_no

* Incorporate feedback

* track write failures in translog as a noop in primary

* Add tests for replicating write failures.

Test that document failure (w/ seq no generated) are recorded
as no-op in the translog for primary and replica shards

* Update to master

* update shouldExecuteOnReplica comment

* rename indexshard noop to markSeqNoAsNoOp

* remove redundant conditional

* Consolidate possible replica action for bulk item request
depanding on it's primary execution

* remove bulk shard result abstraction

* fix failure handling logic for bwc

* add more tests

* minor fix

* cleanup

* incorporate feedback

* incorporate feedback

* add assert to remove handling noop primary response when 5.0 nodes are not supported

time:
2017-04-19T03:43:25Z
class:
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
comments:
Rename variable in translog simple commit test

This commit renames a variable for clarity in the translog simple commit
test.

time:
2017-04-19T03:41:55Z
class:
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
comments:
Strengthen translog commit with open view test

This commit strengthens an assertion in the translog commit with open
view test.

time:
2017-04-19T03:37:54Z
class:
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
comments:
Stronger check in translog prepare and commit test

This commit strengthens an assertion in the translog prepare commit and
commit test.

time:
2017-04-19T03:32:47Z
class:
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
comments:
Fix translog prepare commit and commit test

This test was terribly, horribly, no goodly, and badly broken it's
amazing it ever passed so this commit fixes it.

time:
2017-04-19T03:27:26Z
class:
comments:
ingest-node.asciidoc - Clarify json processor (#21876)

Add examples for the json processor.

time:
2017-04-19T02:52:59Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/CompilerSettings.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ArrayLikeObjectTestCase.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/BasicExpressionTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ImplementInterfacesTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/LambdaTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/RegexTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ScriptTestCase.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/StringTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/WhenThingsGoWrongTests.java
comments:
Painless: more testing for script_stack (#24168)

`script_stack` is super useful when debugging Painless scripts
because it skips all the "weird" stuff involved that obfuscates
where the actual error is. It skips Painless's internals and
call site bootstrapping.

It works fine, but it didn't have many tests. This converts a
test that we had for line numbers into a test for the
`script_stack`. The line numbers test was an indirect test
for `script_stack`.

time:
2017-04-19T00:26:40Z
class:
comments:
Test: Fix plugin integ test to depend on bundling plugin (#24170)

This was broken in the recent refactoring to add dependsOn directly to
cluster configuration.

time:
2017-04-18T22:07:08Z
class:
distribution/deb/src/test/java/org/elasticsearch/test/rest/DebClientYamlTestSuiteIT.java
distribution/integ-test-zip/src/test/java/org/elasticsearch/test/rest/IntegTestZipClientYamlTestSuiteIT.java
distribution/rpm/src/test/java/org/elasticsearch/test/rest/RpmClientYamlTestSuiteIT.java
distribution/tar/src/test/java/org/elasticsearch/test/rest/TarClientYamlTestSuiteIT.java
distribution/zip/src/test/java/org/elasticsearch/test/rest/ZipClientYamlTestSuiteIT.java
docs/src/test/java/org/elasticsearch/smoketest/DocsClientYamlTestSuiteIT.java
modules/aggs-matrix-stats/src/test/java/org/elasticsearch/search/aggregations/matrix/MatrixStatsClientYamlTestSuiteIT.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/IngestCommonClientYamlTestSuiteIT.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/LangExpressionClientYamlTestSuiteIT.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/LangMustacheClientYamlTestSuiteIT.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/LangPainlessClientYamlTestSuiteIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorClientYamlTestSuiteIT.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexClientYamlTestSuiteIT.java
modules/repository-url/src/test/java/org/elasticsearch/repositories/url/RepositoryURLClientYamlTestSuiteIT.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4ClientYamlTestSuiteIT.java
plugins/analysis-icu/src/test/java/org/elasticsearch/index/analysis/IcuClientYamlTestSuiteIT.java
plugins/analysis-kuromoji/src/test/java/org/elasticsearch/index/analysis/KuromojiClientYamlTestSuiteIT.java
plugins/analysis-phonetic/src/test/java/org/elasticsearch/index/analysis/PhoneticClientYamlTestSuiteIT.java
plugins/analysis-smartcn/src/test/java/org/elasticsearch/index/analysis/SmartCNClientYamlTestSuiteIT.java
plugins/analysis-stempel/src/test/java/org/elasticsearch/index/analysis/StempelClientYamlTestSuiteIT.java
plugins/analysis-ukrainian/src/test/java/org/elasticsearch/index/analysis/UkrainianClientYamlTestSuiteIT.java
plugins/discovery-azure-classic/src/test/java/org/elasticsearch/discovery/azure/classic/DiscoveryAzureClassicClientYamlTestSuiteIT.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/CloudAwsClientYamlTestSuiteIT.java
plugins/discovery-file/src/test/java/org/elasticsearch/discovery/file/FileBasedDiscoveryClientYamlTestSuiteIT.java
plugins/discovery-gce/src/test/java/org/elasticsearch/discovery/gce/DiscoveryGceClientYamlTestSuiteIT.java
plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/IngestAttachmentClientYamlTestSuiteIT.java
plugins/ingest-geoip/src/test/java/org/elasticsearch/ingest/geoip/IngestGeoIpClientYamlTestSuiteIT.java
plugins/ingest-user-agent/src/test/java/org/elasticsearch/ingest/useragent/IngestUserAgentClientYamlTestSuiteIT.java
plugins/jvm-example/src/test/java/org/elasticsearch/plugin/example/JvmExampleClientYamlTestSuiteIT.java
plugins/mapper-murmur3/src/test/java/org/elasticsearch/index/mapper/murmur3/MapperMurmur3ClientYamlTestSuiteIT.java
plugins/mapper-size/src/test/java/org/elasticsearch/index/mapper/size/MapperSizeClientYamlTestSuiteIT.java
plugins/repository-azure/src/test/java/org/elasticsearch/repositories/azure/RepositoryAzureClientYamlTestSuiteIT.java
plugins/repository-gcs/src/test/java/org/elasticsearch/repositories/gcs/RepositoryGcsClientYamlTestSuiteIT.java
plugins/repository-hdfs/src/test/java/org/elasticsearch/repositories/hdfs/RepositoryHdfsClientYamlTestSuiteIT.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/RepositoryS3ClientYamlTestSuiteIT.java
plugins/store-smb/src/test/java/org/elasticsearch/index/store/StoreSmbClientYamlTestSuiteIT.java
qa/backwards-5.0/src/test/java/org/elasticsearch/backwards/Backwards50ClientYamlTestSuiteIT.java
qa/multi-cluster-search/src/test/java/org/elasticsearch/upgrades/MultiClusterSearchYamlTestSuiteIT.java
qa/rolling-upgrade/src/test/java/org/elasticsearch/upgrades/UpgradeClusterClientYamlTestSuiteIT.java
qa/smoke-test-ingest-disabled/src/test/java/org/elasticsearch/smoketest/SmokeTestIngestDisabledClientYamlTestSuiteIT.java
qa/smoke-test-ingest-with-all-dependencies/src/test/java/org/elasticsearch/smoketest/SmokeTestIngestWithAllDepsClientYamlTestSuiteIT.java
qa/smoke-test-multinode/src/test/java/org/elasticsearch/smoketest/SmokeTestMultiNodeClientYamlTestSuiteIT.java
qa/smoke-test-plugins/src/test/java/org/elasticsearch/smoketest/SmokeTestPluginsClientYamlTestSuiteIT.java
qa/smoke-test-reindex-with-painless/src/test/java/org/elasticsearch/smoketest/SmokeTestReindexWithPainlessClientYamlTestSuiteIT.java
qa/smoke-test-tribe-node/src/test/java/org/elasticsearch/tribe/TribeClientYamlTestSuiteIT.java
test/framework/src/main/java/org/elasticsearch/test/junit/listeners/ReproduceInfoPrinter.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ESClientYamlSuiteTestCase.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/FileUtils.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/restspec/ClientYamlSuiteRestSpec.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/ESClientYamlSuiteTestCaseTests.java
comments:
Tests: Clean up rest test file handling (#21392)

This change simplifies how the rest test runner finds test files and
removes all leniency.  Previously multiple prefixes and suffixes would
be tried, and tests could exist inside or outside of the classpath,
although outside of the classpath never quite worked. Now only classpath
tests are supported, and only one resource prefix is supported,
`/rest-api-spec/tests`.

closes #20240

time:
2017-04-18T18:11:32Z
class:
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
Engine: store maxUnsafeAutoIdTimestamp in commit (#24149)

The `maxUnsafeAutoIdTimestamp` timestamp is a safety marker guaranteeing that no retried-indexing operation with a higher auto gen id timestamp was process by the engine. This allows us to safely process documents without checking if they were seen before.

Currently this property is maintained in memory and is handed off from the primary to any replica during the recovery process.

This commit takes a more natural approach and stores it in the lucene commit, using the same semantics (no retry op with a higher time stamp is part of this commit). This means that the knowledge is transferred during the file copy and also means that we don't need to worry about crazy situations where an original append only request arrives at the engine after a retry was processed *and* the engine was restarted.

time:
2017-04-18T16:09:45Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/ParsedCardinality.java
comments:
Minor changes in ParsedCardinality

time:
2017-04-18T16:09:39Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/valuecount/ParsedValueCount.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/valuecount/InternalValueCountTests.java
comments:
Adding parsing for InternalValueCount

time:
2017-04-18T15:48:11Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/ParsedAvg.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvgTests.java
comments:
Adding parsing for InternalAvg

time:
2017-04-18T15:44:05Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/sum/ParsedSum.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/sum/InternalSumTests.java
comments:
Adding parsing for InternalSum

time:
2017-04-18T15:38:44Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/ObjectParser.java
core/src/main/java/org/elasticsearch/search/aggregations/ParsedAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/ParsedSingleValueNumericMetricsAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/ParsedCardinality.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/max/ParsedMax.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/min/ParsedMin.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/AbstractParsedPercentiles.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/ParsedAggregationTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalMaxTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/min/InternalMinTests.java
comments:
Adding parsing for InternalMax and InternalMin

time:
2017-04-18T15:19:57Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
comments:
Remove leniency when merging fetched hits in a search response phase (#24158)

Today when we merge hits we have a hard check to prevent AIOOB exceptions
that simply skips an expected search hit. This can only happen if there is a
bug in the code which should be turned into a hard exception or an assertion
triggered. This change adds an assertion an removes the lenient check for the
fetched hits.

time:
2017-04-18T15:03:32Z
class:
core/src/main/java/org/elasticsearch/search/DocValueFormat.java
core/src/test/java/org/elasticsearch/search/DocValueFormatTests.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/InternalSingleBucketAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalMaxTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvgTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/min/InternalMinTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/InternalSimpleValueTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/derivative/InternalDerivativeTests.java
comments:
[Test] Use appropriate DocValueFormats in Aggregations tests (#24155)

Some aggregations (like Min, Max etc) use a wrong DocValueFormat in
tests (like IP or GeoHash). We should not test aggregations that expect
a numeric value with a DocValueFormat like IP. Such wrong DocValueFormat
can also prevent the aggregation to be rendered as ToXContent, and this
will be an issue for the High Level Rest Client tests which expect to be
able to parse back aggregations.

time:
2017-04-18T14:54:17Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/AbstractParsedPercentiles.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/ParsedHDRPercentileRanks.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/ParsedTDigestPercentileRanks.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/InternalPercentilesRanksTestCase.java
comments:
AbstractParsedPercentiles should use Percentile class (#24160)

Now the Percentile interface has been merged with the InternalPercentile
class in core (#24154) the AbstractParsedPercentiles should use it.

This commit also changes InternalPercentilesRanksTestCase so that it now
tests the iterator obtained from parsed percentiles ranks aggregations.

Adding this new test raised an issue in the iterators where key and
value are "swapped" in internal implementations when building the
iterators (see InternalTDigestPercentileRanks.Iter constructor that
accepts the `keys` as the first parameter named `values`, each key
being mapped to the `value` field of Percentile class). This is because
 percentiles ranks aggs inverts percentiles/values compared to the
 percentiles aggs.

* Add assume in InternalAggregationTestCase

* Update after Luca review

time:
2017-04-18T14:39:42Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/Compiler.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Def.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/DefBootstrap.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Definition.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/FunctionRef.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Locals.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/PainlessExplainError.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/ScriptInterface.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/WriterConstants.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/EnhancedPainlessLexer.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/Walker.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ECapturingFunctionRef.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EExplicit.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EFunctionRef.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EInstanceof.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ELambda.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EListInit.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EMapInit.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ENewArray.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ENewObj.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/EStatic.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PCallInvoke.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/PSubBrace.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SCatch.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SDeclaration.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SEach.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SFunction.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SSource.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SSubEachArray.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SSubEachIterable.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/DebugTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/DefBootstrapTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ScriptTestCase.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/node/NodeToStringTests.java
comments:
Start on custom whitelists for Painless (#23563)

We'd like to be able to support context-sensitive whitelists in
Painless but we can't now because the whitelist is a static thing.
This begins to de-static the whitelist, in particular removing
the static keyword from most of the methods on `Definition` and
plumbing the static instance into the appropriate spots as though
it weren't static. Once we de-static all the methods we should be
able to fairly simply build context-sensitive whitelists.

The only "fun" bit of this is that I added another layer in the
chain of methods that bootstraps `def` calls. Instead of running
`invokedynamic` directly on `DefBootstrap` we now `invokedynamic`
`$bootstrapDef` on the script itself loads the `Definition` that
the script was compiled against and then calls `DefBootstrap`.

I chose to put `Definition` into `Locals` so I didn't have to
change the signature of all the `analyze` methods. I could have
do it another way, but that seems ok for now.

time:
2017-04-18T14:27:15Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/bucket/global/InternalGlobalTests.java
comments:
Tests: Fixing typo in class name of InternalGlobalTests

Renaming from InternalGlogbalTests -> InternalGlobalTests

time:
2017-04-18T13:57:50Z
class:
comments:
Update aggs reference documentation for 'keyed' options (#23758)


Add 'keyed' parameter documentation for following:
 - Date Histogram Aggregation
 - Date Range Aggregation
 - Geo Distance Aggregation
 - Histogram Aggregation
 - IP range aggregation
 - Percentiles Aggregation
 - Percentile Ranks Aggregation

time:
2017-04-18T13:17:21Z
class:
core/src/main/java/org/apache/lucene/queries/BlendedTermQuery.java
core/src/main/java/org/apache/lucene/queries/ExtendedCommonTermsQuery.java
core/src/main/java/org/apache/lucene/queries/MinDocQuery.java
core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
core/src/main/java/org/apache/lucene/search/grouping/CollapsingDocValuesSource.java
core/src/main/java/org/apache/lucene/search/grouping/CollapsingTopDocsCollector.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/common/geo/GeoHashUtils.java
core/src/main/java/org/elasticsearch/common/geo/GeoPoint.java
core/src/main/java/org/elasticsearch/common/geo/GeoUtils.java
core/src/main/java/org/elasticsearch/common/lucene/Lucene.java
core/src/main/java/org/elasticsearch/common/lucene/ShardCoreKeyMap.java
core/src/main/java/org/elasticsearch/common/lucene/all/AllTermQuery.java
core/src/main/java/org/elasticsearch/common/lucene/index/ElasticsearchDirectoryReader.java
core/src/main/java/org/elasticsearch/common/lucene/index/ElasticsearchLeafReader.java
core/src/main/java/org/elasticsearch/common/lucene/search/Queries.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/FieldValueFactorFunction.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/FiltersFunctionScoreQuery.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/FunctionScoreQuery.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/LeafScoreFunction.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/RandomScoreFunction.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/WeightFactorFunction.java
core/src/main/java/org/elasticsearch/common/lucene/uid/PerThreadIDVersionAndSeqNoLookup.java
core/src/main/java/org/elasticsearch/common/lucene/uid/VersionsAndSeqNoResolver.java
core/src/main/java/org/elasticsearch/index/cache/bitset/BitsetFilterCache.java
core/src/main/java/org/elasticsearch/index/codec/CodecService.java
core/src/main/java/org/elasticsearch/index/codec/PerFieldMappingPostingFormatCodec.java
core/src/main/java/org/elasticsearch/index/fielddata/AbstractBinaryDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/AbstractNumericDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/AbstractSortedDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/AbstractSortedNumericDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/AbstractSortedSetDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/AbstractSortingNumericDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/AtomicOrdinalsFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/FieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/GeoPointValues.java
core/src/main/java/org/elasticsearch/index/fielddata/MultiGeoPointValues.java
core/src/main/java/org/elasticsearch/index/fielddata/NumericDoubleValues.java
core/src/main/java/org/elasticsearch/index/fielddata/ScriptDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SingletonMultiGeoPointValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SingletonSortedBinaryDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SingletonSortedNumericDoubleValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SortableLongBitsNumericDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SortableLongBitsSortedNumericDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SortableLongBitsToNumericDoubleValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SortableLongBitsToSortedNumericDoubleValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SortedBinaryDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SortedNumericDoubleValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SortingBinaryDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SortingNumericDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/SortingNumericDoubleValues.java
core/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefFieldComparatorSource.java
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/GlobalOrdinalMapping.java
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/GlobalOrdinalsBuilder.java
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/InternalGlobalOrdinalsIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/MultiOrdinals.java
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/Ordinals.java
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/OrdinalsBuilder.java
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/SinglePackedOrdinals.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractAtomicGeoPointFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractAtomicOrdinalsFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractAtomicParentChildFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractGeoPointDVIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractIndexGeoPointFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractLatLonPointDVIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AtomicDoubleFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/BinaryDVAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/BytesBinaryDVAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/DocValuesIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/GeoPointDVAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/IndexIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/LatLonPointDVAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/PagedBytesAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/ParentChildIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/SortedNumericDVIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/SortedSetDVBytesAtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/SortedSetDVOrdinalsIndexFieldData.java
core/src/main/java/org/elasticsearch/index/mapper/CustomDocValuesField.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java
core/src/main/java/org/elasticsearch/index/mapper/FieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/GeoShapeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IpFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/BoolQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/CommonTermsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryParser.java
core/src/main/java/org/elasticsearch/index/query/functionscore/DecayFunctionBuilder.java
core/src/main/java/org/elasticsearch/index/search/ESToParentBlockJoinQuery.java
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
core/src/main/java/org/elasticsearch/index/search/MultiMatchQuery.java
core/src/main/java/org/elasticsearch/index/shard/FilterDocValuesProducer.java
core/src/main/java/org/elasticsearch/index/shard/IndexSearcherWrapper.java
core/src/main/java/org/elasticsearch/index/similarity/SimilarityService.java
core/src/main/java/org/elasticsearch/indices/IndicesQueryCache.java
core/src/main/java/org/elasticsearch/indices/IndicesRequestCache.java
core/src/main/java/org/elasticsearch/indices/fielddata/cache/IndicesFieldDataCache.java
core/src/main/java/org/elasticsearch/search/MultiValueMode.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/children/ParentToChildrenAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoGridAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/BinaryRangeAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/RangeAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedBytesHashSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedMapSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedNumericSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedOrdinalsSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/GlobalOrdinalsSignificantTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/GlobalOrdinalsStringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/LongTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/StringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/support/IncludeExclude.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/AvgAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/GeoBoundsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/GeoCentroidAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/InternalGeoCentroid.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/max/MaxAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/min/MinAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/AbstractHDRPercentilesAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/AbstractTDigestPercentilesAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/StatsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ExtendedStatsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/sum/SumAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/valuecount/ValueCountAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/support/MissingValues.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSource.java
core/src/main/java/org/elasticsearch/search/aggregations/support/values/ScriptBytesValues.java
core/src/main/java/org/elasticsearch/search/aggregations/support/values/ScriptDoubleValues.java
core/src/main/java/org/elasticsearch/search/aggregations/support/values/ScriptLongValues.java
core/src/main/java/org/elasticsearch/search/fetch/FetchPhase.java
core/src/main/java/org/elasticsearch/search/fetch/FetchSubPhase.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/DocValueFieldsFetchSubPhase.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/InnerHitsContext.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/ParentFieldSubFetchPhase.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/VersionFetchSubPhase.java
core/src/main/java/org/elasticsearch/search/internal/ContextIndexSearcher.java
core/src/main/java/org/elasticsearch/search/lookup/LeafDocLookup.java
core/src/main/java/org/elasticsearch/search/profile/query/ProfileWeight.java
core/src/main/java/org/elasticsearch/search/slice/DocValuesSliceQuery.java
core/src/main/java/org/elasticsearch/search/slice/TermsSliceQuery.java
core/src/main/java/org/elasticsearch/search/sort/ScriptSortBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggester.java
core/src/test/java/org/apache/lucene/queries/BlendedTermQueryTests.java
core/src/test/java/org/elasticsearch/common/lucene/LuceneTests.java
core/src/test/java/org/elasticsearch/common/lucene/ShardCoreKeyMapTests.java
core/src/test/java/org/elasticsearch/common/lucene/index/ESDirectoryReaderTests.java
core/src/test/java/org/elasticsearch/deps/lucene/SimpleLuceneTests.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/codec/CodecTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractFieldDataImplTestCase.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractGeoFieldDataTestCase.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractStringFieldDataTestCase.java
core/src/test/java/org/elasticsearch/index/fielddata/BinaryDVFieldDataTests.java
core/src/test/java/org/elasticsearch/index/fielddata/FieldDataTests.java
core/src/test/java/org/elasticsearch/index/fielddata/FilterFieldDataTests.java
core/src/test/java/org/elasticsearch/index/fielddata/ParentChildFieldDataTests.java
core/src/test/java/org/elasticsearch/index/fielddata/ScriptDocValuesDatesTests.java
core/src/test/java/org/elasticsearch/index/fielddata/ScriptDocValuesGeoPointsTests.java
core/src/test/java/org/elasticsearch/index/fielddata/ScriptDocValuesLongsTests.java
core/src/test/java/org/elasticsearch/index/fielddata/fieldcomparator/ReplaceMissingTests.java
core/src/test/java/org/elasticsearch/index/fielddata/ordinals/MultiOrdinalsTests.java
core/src/test/java/org/elasticsearch/index/fielddata/ordinals/SingleOrdinalsTests.java
core/src/test/java/org/elasticsearch/index/fielddata/plain/HalfFloatFielddataTests.java
core/src/test/java/org/elasticsearch/index/mapper/BooleanFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/FakeStringFieldMapper.java
core/src/test/java/org/elasticsearch/index/mapper/ScaledFloatFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/query/BoolQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/CommonTermsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MultiMatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/NestedQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryParserTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryStringBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreTests.java
core/src/test/java/org/elasticsearch/index/query/plugin/DummyQueryParserPlugin.java
core/src/test/java/org/elasticsearch/index/search/MultiMatchQueryTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexSearcherWrapperTests.java
core/src/test/java/org/elasticsearch/index/store/StoreTests.java
core/src/test/java/org/elasticsearch/indices/IndicesQueryCacheTests.java
core/src/test/java/org/elasticsearch/indices/memory/breaker/RandomExceptionCircuitBreakerIT.java
core/src/test/java/org/elasticsearch/search/MultiValueModeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/BinaryRangeAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/support/IncludeExcludeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/support/MissingValuesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/support/ScriptValuesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/support/ValuesSourceConfigTests.java
core/src/test/java/org/elasticsearch/search/basic/SearchWithRandomExceptionsIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/PlainHighlighterTests.java
core/src/test/java/org/elasticsearch/search/functionscore/QueryRescorerIT.java
core/src/test/java/org/elasticsearch/search/query/SimpleQueryStringIT.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/matrix/stats/MatrixStatsAggregator.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/CountMethodValueSource.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/DateMethodValueSource.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/DateObjectValueSource.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/EmptyMemberValueSource.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/FieldDataValueSource.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/GeoEmptyValueSource.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/GeoLatitudeValueSource.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/GeoLongitudeValueSource.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQuery.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java
modules/percolator/src/test/java/org/elasticsearch/percolator/CandidateQueryTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/QueryAnalyzerTests.java
test/framework/src/main/java/org/elasticsearch/AnalysisFactoryTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/main/java/org/elasticsearch/test/FieldMaskingReader.java
test/framework/src/main/java/org/elasticsearch/test/engine/MockEngineSupport.java
test/framework/src/main/java/org/elasticsearch/test/engine/ThrowingLeafReaderWrapper.java
comments:
Upgrade to a Lucene 7 snapshot (#24089)

We want to upgrade to Lucene 7 ahead of time in order to be able to check whether it causes any trouble to Elasticsearch before Lucene 7.0 gets released. From a user perspective, the main benefit of this upgrade is the enhanced support for sparse fields, whose resource consumption is now function of the number of docs that have a value rather than the total number of docs in the index.

Some notes about the change:
 - it includes the deprecation of the `disable_coord` parameter of the `bool` and `common_terms` queries: Lucene has removed support for coord factors
 - it includes the deprecation of the `index.similarity.base` expert setting, since it was only useful to configure coords and query norms, which have both been removed
 - two tests have been marked with `@AwaitsFix` because of #23966, which we intend to address after the merge

time:
2017-04-18T12:55:58Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/CrudIT.java
core/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequestHandler.java
core/src/main/java/org/elasticsearch/action/bulk/Retry.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractAsyncBulkByScrollAction.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/bootstrap/Security.java
core/src/main/java/org/elasticsearch/common/bytes/ReleasablePagedBytesReference.java
core/src/main/java/org/elasticsearch/common/compress/Compressor.java
core/src/main/java/org/elasticsearch/common/compress/DeflateCompressor.java
core/src/main/java/org/elasticsearch/common/io/ReleasableBytesStream.java
core/src/main/java/org/elasticsearch/common/io/Streams.java
core/src/main/java/org/elasticsearch/common/io/stream/BytesStream.java
core/src/main/java/org/elasticsearch/common/io/stream/BytesStreamOutput.java
core/src/main/java/org/elasticsearch/common/io/stream/ReleasableBytesStreamOutput.java
core/src/main/java/org/elasticsearch/common/logging/DeprecationLogger.java
core/src/main/java/org/elasticsearch/common/lucene/uid/PerThreadIDVersionAndSeqNoLookup.java
core/src/main/java/org/elasticsearch/common/lucene/uid/VersionsAndSeqNoResolver.java
core/src/main/java/org/elasticsearch/common/lucene/uid/VersionsResolver.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentBuilder.java
core/src/main/java/org/elasticsearch/discovery/zen/ElectMasterService.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/env/Environment.java
core/src/main/java/org/elasticsearch/env/NodeEnvironment.java
core/src/main/java/org/elasticsearch/index/engine/DeleteVersionValue.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/LiveVersionMap.java
core/src/main/java/org/elasticsearch/index/engine/VersionValue.java
core/src/main/java/org/elasticsearch/index/get/ShardGetService.java
core/src/main/java/org/elasticsearch/index/mapper/ParseContext.java
core/src/main/java/org/elasticsearch/index/mapper/ParsedDocument.java
core/src/main/java/org/elasticsearch/index/mapper/SeqNoFieldMapper.java
core/src/main/java/org/elasticsearch/index/termvectors/TermVectorsService.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/node/InternalSettingsPreparer.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/rest/AbstractRestChannel.java
core/src/main/java/org/elasticsearch/rest/BytesRestResponse.java
core/src/main/java/org/elasticsearch/rest/RestController.java
core/src/main/java/org/elasticsearch/rest/action/cat/AbstractCatAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTable.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/GeoCentroidAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/GeoCentroidAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/InternalGeoCentroid.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/InternalPercentile.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/Percentile.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/InternalHDRPercentileRanks.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/InternalHDRPercentiles.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/InternalTDigestPercentileRanks.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/InternalTDigestPercentiles.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/percentile/InternalPercentilesBucket.java
core/src/main/java/org/elasticsearch/tasks/TaskInfo.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/test/java/org/elasticsearch/action/bulk/RetryTests.java
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/common/io/stream/ReleasableBytesStreamOutputTests.java
core/src/test/java/org/elasticsearch/common/lucene/uid/VersionLookupTests.java
core/src/test/java/org/elasticsearch/common/lucene/uid/VersionsTests.java
core/src/test/java/org/elasticsearch/common/settings/SettingsTests.java
core/src/test/java/org/elasticsearch/discovery/zen/ElectMasterServiceTests.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeRemovalClusterStateTaskExecutorTests.java
core/src/test/java/org/elasticsearch/env/EnvironmentTests.java
core/src/test/java/org/elasticsearch/index/IndexingSlowLogTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/engine/LiveVersionMapTests.java
core/src/test/java/org/elasticsearch/index/engine/VersionValueTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/replication/IndexLevelReplicationTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
core/src/test/java/org/elasticsearch/indices/cluster/AbstractIndicesClusterStateServiceTestCase.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySourceHandlerTests.java
core/src/test/java/org/elasticsearch/node/InternalSettingsPreparerTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/sampler/InternalSamplerTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/geocentroid/GeoCentroidAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/InternalTDigestPercentilesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHitsTests.java
core/src/test/java/org/elasticsearch/search/child/ChildQuerySearchIT.java
core/src/test/java/org/elasticsearch/tasks/TaskResultTests.java
core/src/test/java/org/elasticsearch/versioning/SimpleVersioningIT.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/EqualsTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexParentChildTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RetryTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpChannel.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpChannelTests.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/AwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/AwsSigner.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3ClientSettings.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3RepositoryPlugin.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AWSSignersTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AbstractS3SnapshotRestoreTest.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AwsS3ServiceImplTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3RepositoryTests.java
qa/evil-tests/src/test/java/org/elasticsearch/bootstrap/EvilJNANativesTests.java
test/framework/src/main/java/org/elasticsearch/common/bytes/AbstractBytesReferenceTestCase.java
test/framework/src/main/java/org/elasticsearch/node/NodeTests.java
comments:
Merge remote-tracking branch 'origin/master' into feature/client_aggs_parsing

time:
2017-04-18T12:47:18Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/InternalPercentile.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/Percentile.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/InternalHDRPercentileRanks.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/InternalHDRPercentiles.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/InternalTDigestPercentileRanks.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/InternalTDigestPercentiles.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/percentile/InternalPercentilesBucket.java
comments:
Merge Percentile class with interface (#24154)

This commit merges the Percentile interface with the InternalPercentile
class, as we don't need to maintain both.

time:
2017-04-18T12:31:58Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/bucket/sampler/InternalSamplerTests.java
comments:
[TEST] Added unittests for InternalSampler

time:
2017-04-18T12:27:54Z
class:
core/src/test/java/org/elasticsearch/indices/cluster/AbstractIndicesClusterStateServiceTestCase.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
comments:
[TEST] Randomly add and remove no_master blocks in IndicesClusterStateServiceRandomUpdatesTests

Checks that IndicesClusterStateService stays consistent with incoming cluster states that contain no_master blocks (especially
discovery.zen.no_master_block=all which disables state persistence). In particular this checks that active shards which have no in-memory data
structures on a node are failed.

time:
2017-04-18T11:54:31Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/GeoCentroidAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/GeoCentroidAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/InternalGeoCentroid.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/geocentroid/GeoCentroidAggregatorTests.java
comments:
[TEST] Added test for GeoCentroidAggregator and
made constructors of GeoCentroidAggregator, GeoCentroidAggregatorFactory and InternalGeoCentroid package protected.

time:
2017-04-18T08:31:35Z
class:
comments:
Include missing field-caps docs in search

time:
2017-04-18T08:19:30Z
class:
core/src/main/java/org/elasticsearch/search/DocValueFormat.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/AbstractParsedPercentiles.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/ParsedPercentileRanks.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/ParsedHDRPercentileRanks.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/ParsedTDigestPercentileRanks.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinalityTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/InternalPercentilesRanksTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/InternalHDRPercentilesRanksTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/InternalTDigestPercentilesRanksTests.java
comments:
Add parsing for percentiles ranks (#23974)

This commit adds the logic for parsing the percentiles ranks aggregations.

time:
2017-04-18T08:19:25Z
class:
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/AwsSigner.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AWSSignersTests.java
comments:
S3 Repository: Remove unused files (#24145)

These were leftover from the removal of the signer type setting in

time:
2017-04-18T07:48:35Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/InternalTDigestPercentilesTests.java
comments:
[Test] Add unit tests for InternalTDigestPercentilesTests (#24090)

time:
2017-04-18T02:19:47Z
class:
comments:
docs: fix search info in transport API docs (#22045)

fix some error!

time:
2017-04-18T02:18:28Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/ElectMasterService.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/test/java/org/elasticsearch/discovery/zen/ElectMasterServiceTests.java
core/src/test/java/org/elasticsearch/discovery/zen/NodeRemovalClusterStateTaskExecutorTests.java
comments:
Warn on not enough masters during election (#20063)

This changes the trace level logging to warn, and adds the needed number to the message as well.

My fear is that it may get noisy, but this is an issue that you want to be noisy.

time:
2017-04-18T01:52:29Z
class:
comments:
doc: highlight that doc counts come from lucene (#23522)

The docs don't clearly explain that the deleted doc count also comes from lucene.
IMHO, it is worth highlighting this information separately, as a Note.
Apart from that, there should be an official recommended alternative as well.

time:
2017-04-18T01:45:19Z
class:
comments:
Docs: fix some case problems in aliases.asciidoc (#23657)

Make more things uppercase.

time:
2017-04-18T01:31:11Z
class:
comments:
Fixing typo in spelling of rollover (#24146)

rolllover -> rollover

time:
2017-04-18T01:27:43Z
class:
comments:
Update reference docs for geocentroid aggregation. (#24141)

This includes a link to the Wikipedia page explaining what a centroid
is.

Closes #24140

time:
2017-04-17T23:02:46Z
class:
comments:
Tests: Move cluster dependencies from runner to cluster (#24142)

After splitting integ tests into cluster configuration and the test
runner task, we still have dependencies of the test runner added as deps
of the cluster. This commit adds dependencies directly to the cluster,
so that the runner can have other dependencies independent of what is
needed for the cluster.

time:
2017-04-17T22:46:13Z
class:
comments:
Update filter-aggregation.asciidoc (#24138)

Fix a discrepancy between the example and the prose.

time:
2017-04-17T21:18:49Z
class:
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/AwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3ClientSettings.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3RepositoryPlugin.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AbstractS3SnapshotRestoreTest.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AwsS3ServiceImplTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3RepositoryTests.java
comments:
S3 Repository: Cleanup deprecated settings (#24097)

This commit removes all deprecated settings which start with
`cloud.aws`, `repositories.s3` and repository level client settings.

time:
2017-04-17T20:56:12Z
class:
comments:
Docs: Be ok with long recovery times

The _cat docs were asserting that an index took only some number of
milliseconds to recovery. In this build it took a whole second:
https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+5.3+multijob-intake/192/consoleFull

So this changes the assertion to be ok with a second.

time:
2017-04-17T20:36:32Z
class:
comments:
Add package test to catch leaking default.data.path setting (#24029)

Adds a packaging test that would have detected #23981. The test configures path.data and validates that nothing ends up in default.path.data.

time:
2017-04-17T18:00:24Z
class:
comments:
Update reference docs for Highlighter fragmenter (#23754)

Explain the fragmenter and add examples.

time:
2017-04-17T17:44:05Z
class:
modules/lang-painless/src/test/java/org/elasticsearch/painless/EqualsTests.java
comments:
Harden painless test against "fun" caching (#24077)

The JVM caches `Integer` objects. This is known. A test in Painless
was relying on the JVM not caching the particular integer `1000`.
It turns out that when you provide `-XX:+AggressiveOpts` the JVM
*does* cache `1000`, causing the test to fail when that is
specified.

This replaces `1000` with a randomly selected integer that we test
to make sure *isn't* cached by the JVM. *Hopefully* this test is
good enough. It relies on the caching not changing in between when
we check that the value isn't cached and when we run the painless
code. The cache now is a simple array but there is nothing
preventing it from changing. If it does change in a way that thwarts
this test then the test fail fail again. At least when that happens
the next person can see the comment about how it is important
that the integer isn't cached and can follow that line of inquiry.

Closes #24041

time:
2017-04-17T14:43:13Z
class:
core/src/main/java/org/elasticsearch/env/Environment.java
core/src/test/java/org/elasticsearch/env/EnvironmentTests.java
comments:
Do not set path.data in environment if not set

When preparing the final settings in the environment, we unconditionally
set path.data even if path.data was not explicitly set. This confounds
detection for whether or not path.data was explicitly set, and this is
trappy. This commit adds logic to only set path.data in the final
settings if path.data was explicitly set, and provides a test case that
fails without this logic.

Relates #24132

time:
2017-04-17T12:51:54Z
class:
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
comments:
Preserve multiple translog generations

Today when a flush is performed, the translog is committed and if there
are no outstanding views, only the current translog generation is
preserved. Yet for the purpose of sequence numbers, we need stronger
guarantees than this. This commit migrates the preservation of translog
generations to keep the minimum generation that would be needed to
recover after the local checkpoint.

Relates #24015

time:
2017-04-17T11:03:46Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Security.java
core/src/main/java/org/elasticsearch/env/NodeEnvironment.java
core/src/main/java/org/elasticsearch/node/Node.java
test/framework/src/main/java/org/elasticsearch/node/NodeTests.java
comments:
Detect remnants of path.data/default.path.data bug

In Elasticsearch 5.3.0 a bug was introduced in the merging of default
settings when the target setting existed as an array. When this bug
concerns path.data and default.path.data, we ended up in a situation
where the paths specified in both settings would be used to write index
data. Since our packaging sets default.path.data, users that configure
multiple data paths via an array and use the packaging are subject to
having shards land in paths in default.path.data when that is very
likely not what they intended.

This commit is an attempt to rectify this situation. If path.data and
default.path.data are configured, we check for the presence of indices
there. If we find any, we log messages explaining the situation and fail
the node.

Relates #24099

time:
2017-04-15T18:57:00Z
class:
core/src/main/java/org/elasticsearch/rest/action/cat/AbstractCatAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTable.java
comments:
Cat APIs should not close the stream obtained from the channel

The cat APIs and rest tables would obtain a stream from the RestChannel, which happened to be a
ReleasableBytesStreamOutput. These APIs used the stream to write content to, closed the stream,
and then tried to send a response. After #23941 was merged, closing the stream meant that the bytes
were released for use elsewhere. This caused occasional corruption of the response when the bytes
were used prior to the response being sent.

This commit changes these two usages to wrap the stream obtained from the channel in a flush on
close stream so that the bytes are still reserved until the message is sent.

time:
2017-04-15T17:54:01Z
class:
comments:
Revert "Ensure output for createClone task"

This reverts commit 2620200ff7d945c5bc17d2b854b4a6a92fd2120e.

time:
2017-04-15T16:15:45Z
class:
core/src/test/java/org/elasticsearch/versioning/SimpleVersioningIT.java
comments:
Do not produce empty IDs in simple versioning test

Empty IDs are rejected during indexing, so we should not randomly
produce them during tests. This commit modifies the simple versioning
tests to no longer produce empty IDs.

time:
2017-04-15T14:36:03Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/CrudIT.java
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/test/java/org/elasticsearch/search/child/ChildQuerySearchIT.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexParentChildTests.java
comments:
Reject empty IDs

When indexing a document via the bulk API where IDs can be explicitly
specified, we currently accept an empty ID. This is problematic because
such a document can not be obtained via the get API. Instead, we should
rejected these requets as accepting them could be a dangerous form of
leniency. Additionally, we already have a way of specifying
auto-generated IDs and that is to not explicitly specify an ID so we do
not need a second way. This commit rejects the individual requests where
ID is specified but empty.

Relates #24118

time:
2017-04-14T19:46:17Z
class:
core/src/main/java/org/elasticsearch/common/lucene/uid/PerThreadIDVersionAndSeqNoLookup.java
core/src/main/java/org/elasticsearch/common/lucene/uid/VersionsAndSeqNoResolver.java
core/src/main/java/org/elasticsearch/common/lucene/uid/VersionsResolver.java
core/src/main/java/org/elasticsearch/index/engine/DeleteVersionValue.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/LiveVersionMap.java
core/src/main/java/org/elasticsearch/index/engine/VersionValue.java
core/src/main/java/org/elasticsearch/index/get/ShardGetService.java
core/src/main/java/org/elasticsearch/index/mapper/ParseContext.java
core/src/main/java/org/elasticsearch/index/mapper/ParsedDocument.java
core/src/main/java/org/elasticsearch/index/mapper/SeqNoFieldMapper.java
core/src/main/java/org/elasticsearch/index/termvectors/TermVectorsService.java
core/src/test/java/org/elasticsearch/common/lucene/uid/VersionLookupTests.java
core/src/test/java/org/elasticsearch/common/lucene/uid/VersionsTests.java
core/src/test/java/org/elasticsearch/index/IndexingSlowLogTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/engine/LiveVersionMapTests.java
core/src/test/java/org/elasticsearch/index/engine/VersionValueTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/replication/IndexLevelReplicationTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySourceHandlerTests.java
comments:
Use sequence numbers to identify out of order delivery in replicas & recovery (#24060)

Internal indexing requests in Elasticsearch may be processed out of order and repeatedly. This is important during recovery and due to concurrency in replicating requests between primary and replicas. As such, a replica/recovering shard needs to be able to identify that an incoming request contains information that is old and thus need not be processed. The current logic is based on external version. This is sadly not sufficient. This PR moves the logic to rely on sequences numbers and primary terms which give the semantics we need.

Relates to #10708

time:
2017-04-14T19:24:21Z
class:
comments:
Remove customization of ES_USER and ES_GROUP

This removes the ability to configure Elasticsearch to use custom username
and/or group when it is run.

Resolves #23848

time:
2017-04-14T16:18:00Z
class:
core/src/main/java/org/elasticsearch/common/logging/DeprecationLogger.java
comments:
Improve performance of extracting warning value

When building headers for a REST response, we de-duplicate the warning
headers based on the actual warning value. The current implementation of
this uses a capturing regular expression that is prone to excessive
backtracking. In cases a request involves a large number of warnings,
this extraction can be a severe performance penalty. An example where
this can arise is a bulk indexing request that utilizes a deprecated
feature (e.g., using deprecated forms of boolean values). This commit is
an attempt to address this performance regression. We already know the
format of the warning header, so we do not need to use a regular
expression to parse it but rather can parse it by hand to extract the
warning value. This gains back the vast majority of the performance lost
due to the usage of a deprecated feature. There is still a performance
loss due to logging the deprecation message but we do not address that
concern in this commit.

Relates #24114

time:
2017-04-14T14:50:53Z
class:
comments:
Go back to 140 column limit in .dir-locals.el

time:
2017-04-14T14:50:31Z
class:
core/src/main/java/org/elasticsearch/common/bytes/ReleasablePagedBytesReference.java
core/src/main/java/org/elasticsearch/common/compress/Compressor.java
core/src/main/java/org/elasticsearch/common/compress/DeflateCompressor.java
core/src/main/java/org/elasticsearch/common/io/ReleasableBytesStream.java
core/src/main/java/org/elasticsearch/common/io/Streams.java
core/src/main/java/org/elasticsearch/common/io/stream/BytesStream.java
core/src/main/java/org/elasticsearch/common/io/stream/BytesStreamOutput.java
core/src/main/java/org/elasticsearch/common/io/stream/ReleasableBytesStreamOutput.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentBuilder.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/rest/AbstractRestChannel.java
core/src/main/java/org/elasticsearch/rest/BytesRestResponse.java
core/src/main/java/org/elasticsearch/rest/RestController.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/test/java/org/elasticsearch/common/io/stream/ReleasableBytesStreamOutputTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpChannel.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpChannelTests.java
comments:
Closing a ReleasableBytesStreamOutput closes the underlying BigArray (#23941)

This commit makes closing a ReleasableBytesStreamOutput release the underlying BigArray so
that we can use try-with-resources with these streams and avoid leaking memory by not returning
the BigArray. As part of this change, the ReleasableBytesStreamOutput adds protection to only
release the BigArray once.

In order to make some of the changes cleaner, the ReleasableBytesStream interface has been
removed. The BytesStream interface is changed to a abstract class so that we can use it as a
useable return type for a new method, Streams#flushOnCloseStream. This new method wraps a
given stream and overrides the close method so that the stream is simply flushed and not closed.
This behavior is used in the TcpTransport when compression is used with a
ReleasableBytesStreamOutput as we need to close the compressed stream to ensure all of the data
is written from this stream. Closing the compressed stream will try to close the underlying stream
but we only want to flush so that all of the written bytes are available.

Additionally, an error message method added in the BytesRestResponse did not use a builder
provided by the channel and instead created its own JSON builder. This changes that method to use
the channel builder and in turn the bytes stream output that is managed by the channel.

Note, this commit differs from 6bfecdf921a1941b48273d76551872df4062cfae in that it updates
ReleasableBytesStreamOutput to handle the case of the BigArray decreasing in size, which changes
the reference to the BigArray. When the reference is changed, the releasable needs to be updated
otherwise there could be a leak of bytes and corruption of data in unrelated streams.

This reverts commit afd45c14327cd0f8d155e5ac9740f48e8e39b09c, which reverted #23572.

time:
2017-04-14T09:22:49Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/ParsedCardinality.java
comments:
fix typo in ParsedCardinality comment and add //norelease comment on DocValueFormat dep

time:
2017-04-14T09:02:55Z
class:
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
comments:
[TEST] Wait in OldIndexBackwardsCompatibilityIT for cluster to be fully initialized

There are test failures that suggest that the import of dangling indices is happening too early, before the dangling indices are ready to be consumed.
This commit adds an ensureGreen() at the end of cluster initialization to make sure that no cluster state updates are happening while the dangling
indices are prepared on-disk.

time:
2017-04-14T08:36:46Z
class:
comments:
[TEST] Increase node startup timeouts

Tests are periodically failing on CI as the wait conditions are not met. This commit increases the timeouts.

time:
2017-04-14T03:19:07Z
class:
comments:
Use jvm.options where needed in packaging tests

We have some packaging tests where we use a custom jvm.options file. The
flags we use here are barebones, just enough to exercise that using a
custom jvm.options files actually works. Due to this, we are missing a
Log4j flag that prevents Log4j from trying to use JMX. If Log4j tries to
use JMX, it hits a security manager exception and tries to log
this. This attempt to log happens before we've configured
logging. Previously, Elasticsearch was lenient here so this was treated
as harmless and the test could march on. Now, we fail startup if we
detect an attempt to log before logging is configured so this prevents
Elasticsearch from starting if we do not have jvm.options files in place
that prevent these log messages from being written before logging is
being configured. This commit adds jvm.options files in the places need
to prevent this.

time:
2017-04-13T22:27:42Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHitsTests.java
comments:
[TEST] fixes InternalTopHitsTests test to initialize the SearchHits
maxScore to Float.NaN if there is no max score, as that is what Lucene's
TopDocs does

time:
2017-04-13T21:17:11Z
class:
comments:
Test: Fix repro line for platformTest (#24095)

This was accidentally being added to packagingTest, which then had two
repro lines.

time:
2017-04-13T20:16:53Z
class:
test/framework/src/main/java/org/elasticsearch/common/bytes/AbstractBytesReferenceTestCase.java
comments:
[TEST] fix BytesReference tests to never have a negative slice offset

time:
2017-04-13T20:16:01Z
class:
core/src/main/java/org/elasticsearch/tasks/TaskInfo.java
core/src/test/java/org/elasticsearch/tasks/TaskResultTests.java
comments:
Task Management: Make TaskInfo parsing forwards compatible (#24073)

TaskInfo is stored as a part of TaskResult and therefore can be read by nodes with an older version. If we add any additional information to TaskInfo (for #23250, for example), nodes with an older version should be able to ignore it, otherwise they will not be able to read TaskResults stored by newer nodes.

time:
2017-04-13T19:48:52Z
class:
core/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequestHandler.java
core/src/main/java/org/elasticsearch/action/bulk/Retry.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractAsyncBulkByScrollAction.java
core/src/test/java/org/elasticsearch/action/bulk/RetryTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RetryTests.java
comments:
Simplify BulkProcessor handling and retry logic (#24051)

This commit collapses the SyncBulkRequestHandler and
AsyncBulkRequestHandler into a single BulkRequestHandler. The new
handler executes a bulk request and awaits for the completion if the
BulkProcessor was configured with a concurrentRequests setting of 0.
Otherwise the execution happens asynchronously.

As part of this change the Retry class has been refactored.
withSyncBackoff and withAsyncBackoff have been replaced with two
versions of withBackoff. One method takes a listener that will be
called on completion. The other method returns a future that will been
complete on request completion.

time:
2017-04-13T18:25:45Z
class:
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/main/java/org/elasticsearch/env/Environment.java
core/src/main/java/org/elasticsearch/node/InternalSettingsPreparer.java
core/src/test/java/org/elasticsearch/env/EnvironmentTests.java
core/src/test/java/org/elasticsearch/node/InternalSettingsPreparerTests.java
comments:
Remove support for default settings

Today Elasticsearch allows default settings to be used only if the
actual setting is not set. These settings are trappy, and the complexity
invites bugs. This commit removes support for default settings with the
exception of default.path.data, default.path.conf, and default.path.logs
which are maintainted to support packaging. A follow-up will remove
support for these as well.

Relates #24093

time:
2017-04-13T10:53:02Z
class:
qa/evil-tests/src/test/java/org/elasticsearch/bootstrap/EvilJNANativesTests.java
comments:
Remove awaits fix from evil JNA native tests

These tests were marked as awaits fix due to JNA requiring a version of
glibc greater than or equal to version 2.14. Since we still support
systems that would not have this version, we have released our own JNA
dependency that is built to support earlier versions of glibc. This
commit removes some await fixes that were added to tests that failed as
a result of this situation.

time:
2017-04-13T10:34:58Z
class:
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/main/java/org/elasticsearch/node/InternalSettingsPreparer.java
core/src/test/java/org/elasticsearch/common/settings/SettingsTests.java
core/src/test/java/org/elasticsearch/node/InternalSettingsPreparerTests.java
comments:
Correct handling of default and array settings

In Elasticsearch 5.3.0 a bug was introduced in the merging of default
settings when the target setting existed as an array. This arose due to
the fact that when a target setting is an array, the setting key is
broken into key.0, key.1, ..., key.n, one for each element of the
array. When settings are replaced by default.key, we are looking for the
target key but not the target key.0. This leads to key, and key.0, ...,
key.n being present in the constructed settings object. This commit
addresses two issues here. The first is that we fix the merging of the
keys so that when we try to merge default.key, we also check for the
presence of the flattened keys. The second is that when we try to get a
setting value as an array from a settings object, we check whether or
not the backing map contains the top-level key as well as the flattened
keys. This latter check would have caught the first bug. For kicks, we
add some tests.

Relates #24074

time:
2017-04-13T07:24:03Z
class:
core/src/main/java/org/elasticsearch/Build.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/WorkingBulkByScrollTask.java
core/src/main/java/org/elasticsearch/bootstrap/Elasticsearch.java
core/src/main/java/org/elasticsearch/common/logging/LogConfigurator.java
core/src/main/java/org/elasticsearch/index/mapper/CompletionFieldMapper.java
core/src/main/java/org/elasticsearch/node/InternalSettingsPreparer.java
core/src/main/java/org/elasticsearch/plugins/PluginsService.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/InternalNested.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/suggest/completion/context/CategoryContextMapping.java
core/src/main/java/org/elasticsearch/search/suggest/completion/context/CategoryQueryContext.java
core/src/main/java/org/elasticsearch/search/suggest/completion/context/ContextMapping.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/WorkingBulkByScrollTaskTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/CategoryContextMappingTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportRethrottleAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/CancelTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/TransportRethrottleActionTests.java
qa/evil-tests/src/test/java/org/elasticsearch/common/logging/EvilLoggerConfigurationTests.java
qa/evil-tests/src/test/java/org/elasticsearch/common/logging/EvilLoggerTests.java
comments:
Merge remote-tracking branch 'origin/master' into feature/client_aggs_parsing

time:
2017-04-13T07:17:50Z
class:
comments:
Build: Switch jna dependency to an elastic version (#24081)

This new version of jna is rebuilt from the official release of jna, but
with native libs linked against older glibc in order to support all
platforms elasticsearch supports.

closes #23640

time:
2017-04-13T07:15:10Z
class:
core/src/test/java/org/elasticsearch/search/suggest/completion/CategoryContextMappingTests.java
comments:
fix CategoryContextMappingTests compilation bugs

time:
2017-04-13T07:03:09Z
class:
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
testConcurrentGetAndSetOnPrimary - fix a race condition between indexing and updating value map

Currently the map can be lagging behind what's actually in lucene causes assertions about adding/removing values to fail

time:
2017-04-13T06:43:29Z
class:
core/src/main/java/org/elasticsearch/index/mapper/CompletionFieldMapper.java
core/src/main/java/org/elasticsearch/search/suggest/completion/context/CategoryContextMapping.java
core/src/main/java/org/elasticsearch/search/suggest/completion/context/CategoryQueryContext.java
core/src/main/java/org/elasticsearch/search/suggest/completion/context/ContextMapping.java
core/src/test/java/org/elasticsearch/search/suggest/completion/CategoryContextMappingTests.java
comments:
Allow different data types for category in Context suggester (#23491)

The "category" in context suggester could be String, Number or Boolean. However with the changes in version 5 this is failing and only accepting String. This will have problem for existing users of Elasticsearch if they choose to migrate to higher version; as their existing Mapping and query will fail as mentioned in a bug #22358

This PR fixes the above mentioned issue and allows user to migrate seamlessly.

Closes #22358

time:
2017-04-13T06:22:43Z
class:
core/src/main/java/org/elasticsearch/Build.java
comments:
Restrict build info loading to ES jar, not any jar (#24049)

This change makes the build info initialization only try to load a jar
manifest if it is the elasticsearch jar. Anything else (eg a repackaged
ES for use of transport client in an uber jar) will contain "Unknown"
for the build info as it does for tests currently.

fixes #21955

time:
2017-04-13T02:23:42Z
class:
core/src/main/java/org/elasticsearch/plugins/PluginsService.java
comments:
Remove more hidden file leniency from plugins

This commit removes one more instance of leniency from the plugin
service which skips hidden files in the plugins directory.

Relates #23982

time:
2017-04-13T01:23:05Z
class:
core/src/main/java/org/elasticsearch/common/logging/LogConfigurator.java
qa/evil-tests/src/test/java/org/elasticsearch/common/logging/EvilLoggerTests.java
comments:
Register error listener in evil logger tests

This test needs an error listener registered since we configure logging
here.

time:
2017-04-13T01:13:08Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Elasticsearch.java
core/src/main/java/org/elasticsearch/common/logging/LogConfigurator.java
core/src/main/java/org/elasticsearch/node/InternalSettingsPreparer.java
qa/evil-tests/src/test/java/org/elasticsearch/common/logging/EvilLoggerConfigurationTests.java
comments:
Detect using logging before configuration

It can easily happen that we touch a logger before logging is configured
due to chains of static intializers and other such scenarios. This
commit adds detection for this mechanism that will fail startup if we
touch a logger before logging is configured. This is a bug that will
cause builds to fail.

Relates #24076

time:
2017-04-13T00:57:03Z
class:
comments:
[DOCS] Added note about Elastic Cloud to improve 'elastic aws' SERP results.

time:
2017-04-12T20:29:47Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
Add version constant for 5.5 (#24075)

This is required in master now that #24071 is in or else we fail during BWC testing because the 5.x branch contains 5.5 but the build thinks it should contain 5.4.

time:
2017-04-12T19:59:51Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/InternalNested.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorFactory.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorTests.java
comments:
Add unit tests for NestedAggregator (#24054)

Add unit tests for NestedAggregator, change class visibilities

Relates to #22278

time:
2017-04-12T12:37:31Z
class:
core/src/main/java/org/elasticsearch/action/bulk/byscroll/WorkingBulkByScrollTask.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/WorkingBulkByScrollTaskTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportRethrottleAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/CancelTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/TransportRethrottleActionTests.java
comments:
Add more debugging information to rethrottles

I'm still trying to track down failures like:
https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+dockeralpine-periodic/1180/console

It looks like a task is hanging but I'm not sure why. So this
adds more logging for next time.

time:
2017-04-12T10:00:40Z
class:
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/action/admin/cluster/remote/RemoteInfoAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/remote/RemoteInfoRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/remote/RemoteInfoRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/remote/RemoteInfoResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/remote/TransportRemoteInfoAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportShardFlushAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportShardRefreshAction.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractAsyncBulkByScrollAction.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/WorkingBulkByScrollTask.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsRequest.java
core/src/main/java/org/elasticsearch/action/fieldstats/IndexConstraint.java
core/src/main/java/org/elasticsearch/action/get/TransportGetAction.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/main/java/org/elasticsearch/action/search/RemoteConnectionInfo.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/action/support/GroupedActionListener.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationOperation.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/cli/EnvironmentAwareCommand.java
core/src/main/java/org/elasticsearch/cluster/InternalClusterInfoService.java
core/src/main/java/org/elasticsearch/cluster/metadata/ClusterNameExpressionResolver.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/routing/IndexRoutingTable.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingChangesObserver.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java
core/src/main/java/org/elasticsearch/cluster/routing/ShardRouting.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationService.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RoutingNodesChangedObserver.java
core/src/main/java/org/elasticsearch/common/settings/AddFileKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/main/java/org/elasticsearch/common/settings/KeyStoreCli.java
core/src/main/java/org/elasticsearch/common/settings/KeyStoreWrapper.java
core/src/main/java/org/elasticsearch/common/settings/SecureSetting.java
core/src/main/java/org/elasticsearch/common/settings/SecureSettings.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/main/java/org/elasticsearch/env/NodeEnvironment.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/IndexSettings.java
core/src/main/java/org/elasticsearch/index/analysis/CustomAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/engine/EngineFactory.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngineFactory.java
core/src/main/java/org/elasticsearch/index/engine/ShadowEngine.java
core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/ShadowIndexShard.java
core/src/main/java/org/elasticsearch/index/snapshots/blobstore/BlobStoreIndexShardSnapshot.java
core/src/main/java/org/elasticsearch/index/store/FsDirectoryService.java
core/src/main/java/org/elasticsearch/index/store/Store.java
core/src/main/java/org/elasticsearch/index/store/StoreFileMetaData.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoverySourceService.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/recovery/SharedFSRecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/store/IndicesStore.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestRemoteClusterInfoAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestShardsAction.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/InnerHitsContext.java
core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/AsyncBulkByScrollActionTests.java
core/src/test/java/org/elasticsearch/action/main/MainResponseTests.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterConnectionTests.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterServiceTests.java
core/src/test/java/org/elasticsearch/action/support/GroupedActionListenerTests.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationOperationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/bootstrap/ElasticsearchCliTests.java
core/src/test/java/org/elasticsearch/bwcompat/IpFieldBwCompatIT.java
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/cluster/DiskUsageTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/ClusterNameExpressionResolverTests.java
core/src/test/java/org/elasticsearch/cluster/routing/RoutingBackwardCompatibilityTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/StartedShardsRoutingTests.java
core/src/test/java/org/elasticsearch/common/settings/AddFileKeyStoreCommandTests.java
core/src/test/java/org/elasticsearch/common/settings/AddStringKeyStoreCommandTests.java
core/src/test/java/org/elasticsearch/common/settings/CreateKeyStoreCommandTests.java
core/src/test/java/org/elasticsearch/common/settings/KeyStoreCommandTestCase.java
core/src/test/java/org/elasticsearch/common/settings/KeyStoreWrapperTests.java
core/src/test/java/org/elasticsearch/common/util/IndexFolderUpgraderTests.java
core/src/test/java/org/elasticsearch/env/NodeEnvironmentTests.java
core/src/test/java/org/elasticsearch/gateway/GatewayIndexStateIT.java
core/src/test/java/org/elasticsearch/gateway/PrimaryShardAllocatorTests.java
core/src/test/java/org/elasticsearch/gateway/ReplicaShardAllocatorTests.java
core/src/test/java/org/elasticsearch/index/IndexServiceTests.java
core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java
core/src/test/java/org/elasticsearch/index/analysis/AnalysisRegistryTests.java
core/src/test/java/org/elasticsearch/index/analysis/PreBuiltAnalyzerTests.java
core/src/test/java/org/elasticsearch/index/engine/ShadowEngineTests.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractFieldDataTestCase.java
core/src/test/java/org/elasticsearch/index/mapper/AbstractNumericFieldMapperTestCase.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MultiMatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/ShardPathTests.java
core/src/test/java/org/elasticsearch/index/similarity/SimilarityServiceTests.java
core/src/test/java/org/elasticsearch/index/similarity/SimilarityTests.java
core/src/test/java/org/elasticsearch/index/snapshots/blobstore/FileInfoTests.java
core/src/test/java/org/elasticsearch/index/store/FsDirectoryServiceTests.java
core/src/test/java/org/elasticsearch/index/store/StoreTests.java
core/src/test/java/org/elasticsearch/indices/IndicesServiceTests.java
core/src/test/java/org/elasticsearch/indices/analysis/AnalysisModuleTests.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoveryStatusTests.java
core/src/test/java/org/elasticsearch/plugins/PluginInfoTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/GeoDistanceIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/GeoHashGridIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/NestedChildrenFilterTests.java
core/src/test/java/org/elasticsearch/search/geo/GeoBoundingBoxIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoDistanceIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoFilterIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoPolygonIT.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceIT.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderIT.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/EqualsTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorFieldMapperTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuilders.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuildersTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
plugins/mapper-murmur3/src/test/java/org/elasticsearch/index/mapper/murmur3/Murmur3FieldMapperTests.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/AwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3ClientSettings.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3RepositoryPlugin.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AWSSignersTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AbstractS3SnapshotRestoreTest.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AwsS3ServiceImplTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3RepositoryTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/TestAwsS3Service.java
test/framework/src/main/java/org/elasticsearch/common/settings/MockSecureSettings.java
test/framework/src/main/java/org/elasticsearch/test/engine/MockEngineFactory.java
test/framework/src/main/java/org/elasticsearch/test/engine/MockEngineSupport.java
test/framework/src/main/java/org/elasticsearch/test/engine/MockInternalEngine.java
test/framework/src/main/java/org/elasticsearch/test/engine/MockShadowEngine.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestExecutionContext.java
test/framework/src/main/java/org/elasticsearch/test/store/MockFSIndexStore.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/ClientYamlTestExecutionContextTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/ClientYamlTestSectionTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/ClientYamlTestSuiteTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/SetupSectionTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/SkipSectionTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/TeardownSectionTests.java
test/framework/src/test/java/org/elasticsearch/test/test/VersionUtilsTests.java
comments:
Merge branch 'master' into feature/client_aggs_parsing

time:
2017-04-12T09:58:57Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/ParsedAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinality.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/ParsedCardinality.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/ParsedAggregationTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinalityTests.java
comments:
Adding ParsedCardinality (#23973)

Adding parsing of InternalCardinality xContent output. Parsing method will return a new
implementation of the Cardinality interface, ParsedCardinality.

time:
2017-04-12T09:32:48Z
class:
core/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MultiMatchQueryBuilderTests.java
comments:
Tests: Use random analyzer only on string fields in Match/MultiMatchBuilderTests

Currently we can run into test errors by accidently using e.g. a "simple"
analyzer on a numeric field which might lead to number parsing errors. While
these errors are correct, we should avoid these combinations in our regular
tests.

time:
2017-04-12T06:15:30Z
class:
comments:
Cleanup outdated comments for fixing up pom dependencies (#24056)

time:
2017-04-11T22:42:56Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3ClientSettings.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3RepositoryPlugin.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AWSSignersTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AwsS3ServiceImplTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/TestAwsS3Service.java
comments:
S3 Repository: Eagerly load static settings (#23910)

The S3 repostiory has many levels of settings it looks at to create a
repository, and these settings were read at repository creation time.
This meant secure settings like access and secret keys had to be
available after node construction. This change makes setting loading for
every except repository level settings eager, so that secure settings
can be stashed, and the keystore can once again be closed after
bootstrapping the node is complete.

time:
2017-04-11T22:30:05Z
class:
core/src/main/java/org/elasticsearch/cli/EnvironmentAwareCommand.java
core/src/test/java/org/elasticsearch/bootstrap/ElasticsearchCliTests.java
comments:
Reject duplicate settings on the command line

Today Elasticsearch and other CLI tools that rely on environment aware
command leniently accept duplicate settings with the last one
winning. This commit removes this leniency.

Relates #24053

time:
2017-04-11T18:56:26Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/main/java/org/elasticsearch/cluster/metadata/ClusterNameExpressionResolver.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterServiceTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/ClusterNameExpressionResolverTests.java
comments:
Wildcard cluster names for cross cluster search (#23985)

This is related to #23893. This commit allows users to use wilcards for
cluster names when executing a cross cluster search.

So instead of defining every cluster such as:

GET one:*,two:*,three:*/_search

A user could just search:

GET *:*/_search

As ":" characters are currently allowed in index names, if the text
up to the first ":" does not match a defined cluster name, the entire
string is treated as an index name.

time:
2017-04-11T18:55:57Z
class:
comments:
Update scripts/security docs for sandboxed world (#23977)

Drops any mention of non-sandboxed scripting languages other than a
brief "we don't support them and we shouldn't because A and B"
statement.

Relates to #23930

time:
2017-04-11T17:26:26Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/flush/TransportShardFlushAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/refresh/TransportShardRefreshAction.java
core/src/main/java/org/elasticsearch/action/get/TransportGetAction.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationOperation.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/cluster/InternalClusterInfoService.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/routing/IndexRoutingTable.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/main/java/org/elasticsearch/env/NodeEnvironment.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/IndexSettings.java
core/src/main/java/org/elasticsearch/index/engine/EngineFactory.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngineFactory.java
core/src/main/java/org/elasticsearch/index/engine/ShadowEngine.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/ShadowIndexShard.java
core/src/main/java/org/elasticsearch/index/store/FsDirectoryService.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoverySourceService.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/recovery/SharedFSRecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/store/IndicesStore.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestShardsAction.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationOperationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/cluster/DiskUsageTests.java
core/src/test/java/org/elasticsearch/common/util/IndexFolderUpgraderTests.java
core/src/test/java/org/elasticsearch/env/NodeEnvironmentTests.java
core/src/test/java/org/elasticsearch/gateway/GatewayIndexStateIT.java
core/src/test/java/org/elasticsearch/gateway/PrimaryShardAllocatorTests.java
core/src/test/java/org/elasticsearch/index/IndexServiceTests.java
core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java
core/src/test/java/org/elasticsearch/index/engine/ShadowEngineTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java
core/src/test/java/org/elasticsearch/index/shard/ShardPathTests.java
core/src/test/java/org/elasticsearch/index/store/FsDirectoryServiceTests.java
core/src/test/java/org/elasticsearch/indices/IndicesServiceTests.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
test/framework/src/main/java/org/elasticsearch/test/engine/MockEngineFactory.java
test/framework/src/main/java/org/elasticsearch/test/engine/MockEngineSupport.java
test/framework/src/main/java/org/elasticsearch/test/engine/MockInternalEngine.java
test/framework/src/main/java/org/elasticsearch/test/engine/MockShadowEngine.java
test/framework/src/main/java/org/elasticsearch/test/store/MockFSIndexStore.java
comments:
Remove shadow replicas

Resolves #22024

time:
2017-04-11T17:23:03Z
class:
comments:
Move line split in eclipse back to 140 characters

Now that we've moved checkstyle back to 140 we should move the
split.

time:
2017-04-11T13:15:51Z
class:
comments:
Packaging: Get more info when `[INIT.D] don't mkdir when it contains a comma` fails

time:
2017-04-11T13:02:38Z
class:
comments:
Update aggregation.asciidoc (#24042)

There are four kinds of aggregations now, not three.

time:
2017-04-11T12:40:37Z
class:
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/action/admin/cluster/remote/RemoteInfoAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/remote/RemoteInfoRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/remote/RemoteInfoRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/remote/RemoteInfoResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/remote/TransportRemoteInfoAction.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
core/src/main/java/org/elasticsearch/action/search/RemoteConnectionInfo.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestRemoteClusterInfoAction.java
core/src/test/java/org/elasticsearch/action/ActionModuleTests.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterConnectionTests.java
comments:
Add a dedicated TransportRemoteInfoAction for consistency (#24040)

All our actions that are invoked from rest actions have corresponding
transport actions. This adds the transport action for RestRemoteClusterInfoAction
for consistency.

Relates to #23969

time:
2017-04-11T11:30:45Z
class:
comments:
[TEST] Enable new REST test for 5.4 and BWC against 5.4.x

time:
2017-04-11T10:19:42Z
class:
modules/lang-painless/src/test/java/org/elasticsearch/painless/EqualsTests.java
comments:
Skip two Painless branch tests on Windows

This commit skips the two Painless tests
EqualsTests#testBranchEqualsDefAndPrimitive and
EqualsTests#testBranchNotEqualsDefAndPrimitive on Windows as the tests
are repeatedly failing there.

time:
2017-04-11T09:21:57Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/RoutingChangesObserver.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingNodes.java
core/src/main/java/org/elasticsearch/cluster/routing/ShardRouting.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationService.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/RoutingNodesChangedObserver.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/StartedShardsRoutingTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
comments:
Trigger replica recovery restarts by master when primary relocation completes (#23926)

When a primary relocation completes while there are ongoing replica recoveries, the recoveries for these replicas need to be restarted (as a new primary is in charge of replicating changes). Before this commit, the need for a recovery restart was detected by the data nodes that had the replicas, by checking on each cluster state update if the recovery process had completed before the recovery source changed. That code had a race, however, which could lead to a not-fully recovered shard exposing itself as started (see #23904).

This commit takes a different approach: When the primary relocation completes and the master updates the cluster state to move the primary shard from relocating to started, it will reinitialize all initializing replica shards, by giving them a fresh allocation id. Data nodes that have the replica shard will simply detect that the allocation id changed and restart the recovery process (instead of trying to determine the need to restart based on ongoing recoveries).

Note: Removal of the code in IndicesClusterStateService that checks whether the recovery source has changed will not be backported to the 5.x branch. This ensures backward compatibility for the situation where the master node is older and does not have the code changes that have been introduced in this PR.

Closes #23904

time:
2017-04-11T07:31:22Z
class:
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeResponse.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsRequest.java
core/src/main/java/org/elasticsearch/action/fieldstats/IndexConstraint.java
core/src/main/java/org/elasticsearch/index/analysis/CustomAnalyzerProvider.java
core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java
core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/action/main/MainResponseTests.java
core/src/test/java/org/elasticsearch/bwcompat/IpFieldBwCompatIT.java
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/cluster/routing/RoutingBackwardCompatibilityTests.java
core/src/test/java/org/elasticsearch/common/util/IndexFolderUpgraderTests.java
core/src/test/java/org/elasticsearch/index/analysis/AnalysisRegistryTests.java
core/src/test/java/org/elasticsearch/index/analysis/PreBuiltAnalyzerTests.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractFieldDataTestCase.java
core/src/test/java/org/elasticsearch/index/mapper/AbstractNumericFieldMapperTestCase.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/similarity/SimilarityServiceTests.java
core/src/test/java/org/elasticsearch/index/similarity/SimilarityTests.java
core/src/test/java/org/elasticsearch/indices/analysis/AnalysisModuleTests.java
core/src/test/java/org/elasticsearch/plugins/PluginInfoTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/GeoDistanceIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/GeoHashGridIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoBoundingBoxIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoDistanceIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoFilterIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoPolygonIT.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceIT.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorFieldMapperTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuilders.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuildersTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
plugins/mapper-murmur3/src/test/java/org/elasticsearch/index/mapper/murmur3/Murmur3FieldMapperTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/ClientYamlTestSectionTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/ClientYamlTestSuiteTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/SetupSectionTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/SkipSectionTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/TeardownSectionTests.java
test/framework/src/test/java/org/elasticsearch/test/test/VersionUtilsTests.java
comments:
Removes version 2.x constants from Version (#24011)

* Removes version 2.x constants from Version

Closes #21887

* Addresses review comments

time:
2017-04-11T07:24:40Z
class:
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/main/java/org/elasticsearch/action/search/RemoteConnectionInfo.java
core/src/main/java/org/elasticsearch/action/support/GroupedActionListener.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestRemoteClusterInfoAction.java
core/src/test/java/org/elasticsearch/action/ActionModuleTests.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterConnectionTests.java
core/src/test/java/org/elasticsearch/action/support/GroupedActionListenerTests.java
comments:
Add cross-cluster search remote cluster info API (#23969)

This commit adds an API to discover information like seed nodes,
http addresses and connection status of a configured remote cluster.

Closes #23925

time:
2017-04-11T03:04:18Z
class:
comments:
Build: Support offline build of bwc zip (#24037)

The bwc checkout for backcompat tests currently always tries to fetch
the latest from the upstream remote. This change makes fetching from
upstream conditional on not running an offline build.

time:
2017-04-10T21:55:02Z
class:
core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractAsyncBulkByScrollAction.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/WorkingBulkByScrollTask.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/AsyncBulkByScrollActionTests.java
comments:
Remove real time from tests (#24025)

The `AsyncBulkByScrollActionTests` were brittle because they used the
current time. That was a mistake. This removes the current time from
the test, instead adding it to the parameters passed in to the
appropriate methods. This means that we take the current time slightly
earlier in all cases, but that shouldn't make a difference.

Closes #24005

Example failure:
https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+nfs/161/consoleFull

time:
2017-04-10T21:43:34Z
class:
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/AwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AbstractS3SnapshotRestoreTest.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3RepositoryTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/TestAwsS3Service.java
comments:
Repository S3: Simplify client method (#24034)

This commit removes passing the repository metadata object through to
s3 client creation. It is not needed, and in fact in tests was confusing
because you could create the metadata but have it contain different
settings than were passed in as repository settings.

time:
2017-04-10T20:10:42Z
class:
core/src/main/java/org/elasticsearch/common/settings/AddFileKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/KeyStoreCli.java
core/src/main/java/org/elasticsearch/common/settings/KeyStoreWrapper.java
core/src/main/java/org/elasticsearch/common/settings/SecureSetting.java
core/src/main/java/org/elasticsearch/common/settings/SecureSettings.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/test/java/org/elasticsearch/common/settings/AddFileKeyStoreCommandTests.java
core/src/test/java/org/elasticsearch/common/settings/AddStringKeyStoreCommandTests.java
core/src/test/java/org/elasticsearch/common/settings/CreateKeyStoreCommandTests.java
core/src/test/java/org/elasticsearch/common/settings/KeyStoreCommandTestCase.java
core/src/test/java/org/elasticsearch/common/settings/KeyStoreWrapperTests.java
test/framework/src/main/java/org/elasticsearch/common/settings/MockSecureSettings.java
comments:
Settings: Add secure file setting to keystore (#24001)

Some systems like GCE rely on a plaintext file containing credentials.
Rather than extract the information out of that credentials file and
store each peace individually in the keystore, it is cleaner to just
store the entire file.

This commit adds support to the keystore wrapper for secure file
settings. These are settings that contain an entire file that would
normally be stored on the local filesystem. Retrieving the file returns
an input stream to the file contents. This also adds a `add-file`
command to the keystore cli.

In order to support both strings and files as values for settings, the
metadata format of the keystore has also been updated (with backcompat)
to keep a map of setting name to type.

time:
2017-04-10T16:16:34Z
class:
core/src/main/java/org/elasticsearch/index/snapshots/blobstore/BlobStoreIndexShardSnapshot.java
core/src/main/java/org/elasticsearch/index/store/Store.java
core/src/main/java/org/elasticsearch/index/store/StoreFileMetaData.java
core/src/test/java/org/elasticsearch/gateway/ReplicaShardAllocatorTests.java
core/src/test/java/org/elasticsearch/index/snapshots/blobstore/FileInfoTests.java
core/src/test/java/org/elasticsearch/index/store/StoreTests.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoveryStatusTests.java
comments:
Remote support for lucene versions without checksums (#24021)

We are still carrying some legacy code that deals with lucene indices
that don't have checksums. Yet, we do not support these indices
for a while now, in fact since version 5.0 such an index is not supported
anymore. This commit removes all the special handling and leniency involved.

time:
2017-04-10T16:10:01Z
class:
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestExecutionContext.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/ClientYamlTestExecutionContextTests.java
comments:
Test: add support for replacing stashed values within headers of REST tests (#24014)

This commit adds support for replacing a stashed value within a header of a REST test. This is
useful for requests that may want to use a value previously obtained within a header.

time:
2017-04-10T15:36:45Z
class:
core/src/main/java/org/elasticsearch/search/fetch/subphase/InnerHitsContext.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/NestedChildrenFilterTests.java
comments:
inner_hits: Replace `NestedChildrenQuery` with `ParentChildrenBlockJoinQuery`.

Closes #24009

time:
2017-04-10T15:32:20Z
class:
core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java
comments:
Mark IndexWithShadowReplicasIT as AwaitsFix

Relates to #24007 and #23906

time:
2017-04-10T15:09:21Z
class:
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
comments:
Set shard count limit to unlimited (#24012)

Now that we have incremental reduce functions for topN and aggregations
we can set the default for `action.search.shard_count.limit` to unlimited.
This still allows users to restrict these settings while by default we executed
across all shards matching the search requests index pattern.

time:
2017-04-10T15:07:18Z
class:
comments:
Move back to 140 chars line length (#24013)

This reverts the line limit change in #23623 - this PR doesn't touch the suppression file since we are moving towards automatic code formatting which makes it mainly obsolete.

time:
2017-04-10T14:58:59Z
class:
comments:
Add note to docs on duplicate keys in config

This commit adds a note to the migration docs that duplicate keys in the
configuration file are no longer permitted.

Relates #24022

time:
2017-04-10T12:46:57Z
class:
client/rest/src/main/java/org/elasticsearch/client/HttpAsyncResponseConsumerFactory.java
client/rest/src/test/java/org/elasticsearch/client/HeapBufferedAsyncResponseConsumerTests.java
core/src/main/java/org/elasticsearch/action/search/FetchSearchPhase.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/bootstrap/Spawner.java
core/src/main/java/org/elasticsearch/client/Client.java
core/src/main/java/org/elasticsearch/common/settings/SecureSetting.java
core/src/main/java/org/elasticsearch/common/util/concurrent/AtomicArray.java
core/src/main/java/org/elasticsearch/common/xcontent/NamedXContentRegistry.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/plugins/PluginsService.java
core/src/main/java/org/elasticsearch/rest/action/RestFieldStatsAction.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/aggregations/Aggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/Aggregations.java
core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregations.java
core/src/main/java/org/elasticsearch/search/aggregations/InternalMultiBucketAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/MultiBucketsAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGrid.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/InternalGeoHashGrid.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/Histogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/InternalBinaryRange.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/UnmappedSampler.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/BucketHelpers.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/BucketMetricsPipelineAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketscript/BucketScriptPipelineAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketselector/BucketSelectorPipelineAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/cumulativesum/CumulativeSumPipelineAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/derivative/DerivativePipelineAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/MovAvgPipelineAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/serialdiff/SerialDiffPipelineAggregator.java
core/src/main/java/org/elasticsearch/search/fetch/FetchPhase.java
core/src/main/java/org/elasticsearch/search/query/QueryPhase.java
core/src/main/java/org/elasticsearch/search/query/QuerySearchResult.java
core/src/main/java/org/elasticsearch/search/suggest/Suggest.java
core/src/test/java/org/elasticsearch/action/search/SearchPhaseControllerTests.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/common/settings/ScopedSettingsTests.java
core/src/test/java/org/elasticsearch/common/settings/SettingsTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/node/internal/InternalSettingsPreparerTests.java
core/src/test/java/org/elasticsearch/plugins/PluginsServiceTests.java
core/src/test/java/org/elasticsearch/search/SearchServiceTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramOffsetIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/GeoHashGridIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/HistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/GeoCentroidIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/DateDerivativeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/DerivativeIT.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/MoreExpressionTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuilders.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuildersTests.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2Service.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2ServiceImpl.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/AwsEc2ServiceImplTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoverySettingsTests.java
plugins/repository-gcs/src/main/java/org/elasticsearch/repositories/gcs/GoogleCloudStorageBlobContainer.java
plugins/repository-gcs/src/main/java/org/elasticsearch/repositories/gcs/GoogleCloudStorageBlobStore.java
plugins/repository-gcs/src/main/java/org/elasticsearch/repositories/gcs/GoogleCloudStoragePlugin.java
plugins/repository-gcs/src/main/java/org/elasticsearch/repositories/gcs/GoogleCloudStorageRepository.java
plugins/repository-gcs/src/main/java/org/elasticsearch/repositories/gcs/GoogleCloudStorageService.java
plugins/repository-gcs/src/main/java/org/elasticsearch/repositories/gcs/SocketAccess.java
plugins/repository-gcs/src/test/java/org/elasticsearch/repositories/gcs/GoogleCloudStorageBlobStoreContainerTests.java
plugins/repository-gcs/src/test/java/org/elasticsearch/repositories/gcs/GoogleCloudStorageBlobStoreRepositoryTests.java
plugins/repository-gcs/src/test/java/org/elasticsearch/repositories/gcs/GoogleCloudStorageBlobStoreTests.java
plugins/repository-gcs/src/test/java/org/elasticsearch/repositories/gcs/MockHttpTransport.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/AwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3RepositoryPlugin.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AwsS3ServiceImplTests.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/main/java/org/elasticsearch/test/RandomObjects.java
comments:
Merge branch 'master' into feature/client_aggs_parsing

time:
2017-04-10T11:37:42Z
class:
comments:
Add the ability to include extra notices in a plugin's NOTICES file (#23898)

Adds the option for a plugin to specify extra directories containing notices
and licenses files to be incorporated into the overall notices file that is
generated for the plugin.

This can be useful, for example, where the plugin has a non-Java dependency
that itself incorporates many 3rd party components.

time:
2017-04-10T11:35:01Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/InternalMultiBucketAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/MultiBucketsAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGrid.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/InternalGeoHashGrid.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/Histogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/InternalBinaryRange.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/BucketHelpers.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/BucketMetricsPipelineAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketscript/BucketScriptPipelineAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketselector/BucketSelectorPipelineAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/cumulativesum/CumulativeSumPipelineAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/derivative/DerivativePipelineAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/movavg/MovAvgPipelineAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/serialdiff/SerialDiffPipelineAggregator.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramOffsetIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/GeoHashGridIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/HistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/GeoCentroidIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/DateDerivativeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/DerivativeIT.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/MoreExpressionTests.java
comments:
Move getProperty method out of MultiBucketsAggregation.Bucket interface (#23988)

The getProperty method is an internal method needed to run pipeline aggregations and retrieve info by path from the aggs tree. It is not needed in the MultiBucketsAggregation.Bucket interface, which is returned to users running aggregations from the transport client. The method is moved to the InternalMultiBucketAggregation class as that's where it belongs.

time:
2017-04-10T10:40:37Z
class:
comments:
Fix BWC tests for field_stats now that the deprecation has been back ported to 5.4

time:
2017-04-10T10:31:45Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/Aggregations.java
core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregations.java
comments:
Remove getProperty method from Aggregations interface and impl (#23972)

The `getProperty` method is an internal method needed to run pipeline aggregations and retrieve info by path from the aggs tree. It is not needed in the `Aggregations` interface, which is returned to users running aggregations from the transport client. Furthermore, the method is currenty unused by pipeline aggs too, as only InternalAggregation#getProperty is used. It can then be removed

time:
2017-04-10T10:30:02Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/Aggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/UnmappedSampler.java
core/src/main/java/org/elasticsearch/search/suggest/Suggest.java
comments:
Move aggs CommonFields and TYPED_KEYS_DELIMITER from InternalAggregation to Aggregation (#23987)

These will be shared between internal objects and objects exposed through high level REST client, so they should be moved from internal classes.

time:
2017-04-10T10:28:56Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/NamedXContentRegistry.java
comments:
Un-deprecate NamedXContentRegistry.Entry constructor that takes a context (#23986)

We deprecated this method in the past because we thought it was a temporary thing that could go away over time. We radically trimmed down the usages of a context while parsing when we got rid of the ParseFieldMatcher, but the usages that are left are legit and we will hardly get rid of them. Also, working on aggs parsing we will need a context to carry around the aggregation name that gets parsed through XContentParser#namedObject .

time:
2017-04-10T10:27:42Z
class:
client/rest/src/main/java/org/elasticsearch/client/HttpAsyncResponseConsumerFactory.java
client/rest/src/test/java/org/elasticsearch/client/HeapBufferedAsyncResponseConsumerTests.java
comments:
Make buffer limit configurable in HeapBufferedConsumerFactory (#23970)

The buffer limit should have been configurable already, but the factory constructor is package private so it is truly configurable only from the org.elasticsearch.client package. Also the HttpAsyncResponseConsumerFactory interface was package private, so it could only be implemented from the org.elasticsearch.client package.

Closes #23958

time:
2017-04-10T09:38:56Z
class:
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
comments:
[TEST] Fix wait condition on testMultipleNodesShutdownNonMasterNodes

After two nodes are being stopped and two more are joining the cluster, we first have to wait on the cluster to consist of the right nodes before
waiting on green status, otherwise we might get a green status for a cluster with dead nodes.

time:
2017-04-10T09:32:23Z
class:
test/framework/src/main/java/org/elasticsearch/test/RandomObjects.java
comments:
[TEST] increase minimum length of randomly generated fields in RandomObjects

We had a couple of unfortunate field name collisions in our CI, where the json duplicate check tripped. Increasing the minimum length of randomly generated field names should decrease the chance of this issue happening again.

time:
2017-04-10T08:10:16Z
class:
core/src/main/java/org/elasticsearch/client/Client.java
core/src/main/java/org/elasticsearch/rest/action/RestFieldStatsAction.java
comments:
Deprecate _field_stats endpoint (#23914)

_field_stats has evolved quite a lot to become a multi purpose API capable of retrieving the field capabilities and the min/max value for a field.
In the mean time a more focused API called `_field_caps` has been added, this enpoint is a good replacement for _field_stats since he can
retrieve the field capabilities by just looking at the field mapping (no lookup in the index structures).
Also the recent improvement made to range queries makes the _field_stats API obsolete since this queries are now rewritten per shard based on the min/max found for the field.
This means that a range query that does not match any document in a shard can return quickly and can be cached efficiently.
For these reasons this change deprecates _field_stats. The deprecation should happen in 5.4 but we won't remove this API in 6.x yet which is why
 this PR is made directly to 6.0.
 The rest tests have also been adapted to not throw an error while this change is backported to 5.4.

time:
2017-04-10T07:37:52Z
class:
core/src/main/java/org/elasticsearch/action/search/FetchSearchPhase.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/common/util/concurrent/AtomicArray.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/fetch/FetchPhase.java
core/src/main/java/org/elasticsearch/search/query/QueryPhase.java
core/src/main/java/org/elasticsearch/search/query/QuerySearchResult.java
core/src/test/java/org/elasticsearch/action/search/SearchPhaseControllerTests.java
core/src/test/java/org/elasticsearch/search/SearchServiceTests.java
comments:
Introduce incremental reduction of TopDocs (#23946)

This commit adds support for incremental top N reduction if the number of
expected shards in the search request is high enough. The changes here
also clean up more code in SearchPhaseController to make the separation
between values that are the same on each search result and values that
are per response. The reduced search phase result doesn't hold an arbitrary
result to obtain values like `from`, `size` or sort values which is now
cleanly encapsulated.

time:
2017-04-09T20:04:12Z
class:
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
Engine: version logic on replicas should not be hard coded (#23998)

The refactoring in #23711 hardcoded version logic for replica to assume monotonic versions. Sadly that's wrong for `FORCE` and `VERSION_GTE`. Instead we should use the methods in VersionType to detect conflicts.

Note - once replicas use sequence numbers for out of order delivery, this logic goes away.

time:
2017-04-09T19:21:00Z
class:
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
comments:
InternalEngineTests: fix a potential NPE in assertOpsOnPrimary

assertOpsOnPrimary may inherit a situation where the document exist but it doesn't the last indexed value.
This cloud cause an NPE.

time:
2017-04-09T11:19:16Z
class:
comments:
Upgrade to Log4j 2.8.2

This commit upgrades the Log4j dependencies from version 2.7 to version
2.8.2. This release includes a fix for a case where Log4j could lose
exceptions in the presence of a security manager.

Relates #23995

time:
2017-04-09T00:42:18Z
class:
core/src/test/java/org/elasticsearch/plugins/PluginsServiceTests.java
comments:
Suppress ExtrasFS in plugins service tests

The ExtrasFS filesystem creates extra directories when creating temp
directories during tests to ensure that Lucene does not care about extra
files. These extra files get in our way in the plugins service tests
because some of these tests are counting only on certain directories
existing. This commit suppresses the ExtrasFS filesystem for the plugins
service tests, and fixes a test that was passing for the wrong reason
(because of the existence of an extra directory from ExtrasFS).

time:
2017-04-08T22:22:44Z
class:
core/src/main/java/org/elasticsearch/plugins/PluginsService.java
core/src/test/java/org/elasticsearch/plugins/PluginsServiceTests.java
comments:
Remove hidden file leniency from plugin service

This commit removes some leniency from the plugin service which skips
hidden files in the plugins directory. We really want to ensure the
integrity of the plugin folder, so hasta la vista leniency.

Relates #23982

time:
2017-04-08T05:06:40Z
class:
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2Service.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2ServiceImpl.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/AwsEc2ServiceImplTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoverySettingsTests.java
comments:
Discovery EC2: Remove region setting (#23991)

We have both endpoint and region settings. Region was removed from s3 to
simplify configuration. This is the ec2 equivalent.

closes #22758

time:
2017-04-07T23:46:17Z
class:
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2Service.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2ServiceImpl.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/AwsEc2ServiceImplTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoverySettingsTests.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/AwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3RepositoryPlugin.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AwsS3ServiceImplTests.java
comments:
AWS Plugins: Remove signer type setting (#23984)

This commit removes support for s3 signer type in 6.0, and adds a note
to the migration guide.

closes #22599

time:
2017-04-07T22:41:32Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/ParsedAggregation.java
comments:
remove some more TODOs from ParsedAggregation

time:
2017-04-07T22:28:49Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/ParsedAggregationTests.java
comments:
Remove TODO on un-deprecating NamedContentRegistry.Entry ctor that takes a context

time:
2017-04-07T22:18:56Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/ParsedAggregationTests.java
comments:
[TEST] replace FareRestRequest usage with ToXContent.MapParams

time:
2017-04-07T21:18:06Z
class:
core/src/main/java/org/elasticsearch/common/settings/SecureSetting.java
core/src/test/java/org/elasticsearch/common/settings/ScopedSettingsTests.java
core/src/test/java/org/elasticsearch/common/settings/SettingsTests.java
core/src/test/java/org/elasticsearch/node/internal/InternalSettingsPreparerTests.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
comments:
Settings: Disallow secure setting to exist in normal settings (#23976)

This commit removes the "legacy" feature of secure settings, which setup
a parallel setting that was a fallback in the insecure
elasticsearch.yml. This was previously used to allow the new secure
setting name to be that of the old setting name, but is now not in use
due to other refactorings. It is much cleaner to just have all secure
settings use new setting names. If in the future we want to reuse the
previous setting name, once support for the insecure settings have been
removed, we can then rename the secure setting.  This also adds a test
for the behavior.

time:
2017-04-07T21:07:59Z
class:
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryPlugin.java
comments:
Add registration of new discovery settings

This was forgotten as part of #23961

time:
2017-04-07T20:28:15Z
class:
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2Service.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2ServiceImpl.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/AwsEc2ServiceImplTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoverySettingsTests.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
Settings: Migrate ec2 discovery sensitive settings to elasticsearch keystore (#23961)

This change adds secure settings for access/secret keys and proxy
username/password to ec2 discovery.  It adds the new settings with the
prefix `discovery.ec2`, copies other relevant ec2 client settings to the
same prefix, and deprecates all other settings (`cloud.aws.*` and
`cloud.aws.ec2.*`).  Note that this is simpler than the client configs
in repository-s3 because discovery is only initialized once for the
entire node, so there is no reason to complicate the configuration with
the ability to have multiple sets of client settings.

relates #22475

time:
2017-04-07T19:56:52Z
class:
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuilders.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuildersTests.java
comments:
Fix throttled reindex_from_remote (#23953)

reindex_from_remote was using `TimeValue#toString` to generate the
scroll timeout which is bad because that generates fractional
time values that are useful for people but bad for Elasticsearch
which doesn't like to parse them. This switches it to using
`TimeValue#getStringRep` which spits out whole time values.

Closes to #23945

Makes #23828 even more desirable

time:
2017-04-07T19:54:46Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/ParsedAggregation.java
core/src/test/java/org/elasticsearch/search/aggregations/ParsedAggregationTests.java
comments:
Align ParsedAggregation meta to InternalAggregation behaviour

Empty meta gets printed out, which means that if the request contains an empty meta object, that is returned with the response as well. On the other hand null, meaning when the object is not in the request, is not printed out. ParsedAggregation used to not print out empty metadata, and didn't allow the null value. Aligned behaviour to the existing behaviour from InternalAggregation.

time:
2017-04-07T19:00:19Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
comments:
Add comment why we check for null fetch results during merge

time:
2017-04-07T18:52:22Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Spawner.java
comments:
Fix import order in Spawner

The imports are not in alphabetical order in Spawner.java and this is a
crime that is rectified by this commit.

time:
2017-04-07T18:27:26Z
class:
plugins/repository-gcs/src/main/java/org/elasticsearch/repositories/gcs/GoogleCloudStorageBlobContainer.java
plugins/repository-gcs/src/main/java/org/elasticsearch/repositories/gcs/GoogleCloudStorageBlobStore.java
plugins/repository-gcs/src/main/java/org/elasticsearch/repositories/gcs/GoogleCloudStoragePlugin.java
plugins/repository-gcs/src/main/java/org/elasticsearch/repositories/gcs/GoogleCloudStorageRepository.java
plugins/repository-gcs/src/main/java/org/elasticsearch/repositories/gcs/GoogleCloudStorageService.java
plugins/repository-gcs/src/main/java/org/elasticsearch/repositories/gcs/SocketAccess.java
plugins/repository-gcs/src/test/java/org/elasticsearch/repositories/gcs/GoogleCloudStorageBlobStoreContainerTests.java
plugins/repository-gcs/src/test/java/org/elasticsearch/repositories/gcs/GoogleCloudStorageBlobStoreRepositoryTests.java
plugins/repository-gcs/src/test/java/org/elasticsearch/repositories/gcs/GoogleCloudStorageBlobStoreTests.java
plugins/repository-gcs/src/test/java/org/elasticsearch/repositories/gcs/MockHttpTransport.java
comments:
Collapse repository gcs classes into a single java package (#23975)

This is a single reorge of the classes to simplify making them mostly
package protected.

time:
2017-04-07T15:46:41Z
class:
comments:
Rewrite the scripting security docs (#23930)

They needed to be updated now that Painless is the default and
the non-sandboxed scripting languages are going away or gone.

I dropped the entire section about customizing the classloader
whitelists. In master this barely does anything (exposes more
things to expressions).

time:
2017-04-07T13:43:32Z
class:
core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryIT.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsTests.java
qa/no-bootstrap-tests/src/test/java/org/elasticsearch/bootstrap/SpawnerNoBootstrapTests.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
comments:
Merge branch 'master' into feature/client_aggs_parsing

time:
2017-04-07T13:26:21Z
class:
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
comments:
[TEST] Fix testMultipleNodesShutdownNonMasterNodes to wait for the right nodes to rejoin the cluster

This test was sporadically failing for the following reason:
- 4 nodes (nodes 0, 1, 2, and 3) running with `minimum_master_nodes` set to 3
- we stop 2 nodes (node 0 and 3)
- wait for cluster block to be in place on all nodes
- start 2 nodes (node 4 and node 5) and do a `prepareHealth().setWaitForNodes("4")`
- then do a search request

The search request runs into the `ClusterBlockException` as the `prepareHealth().setWaitForNodes("4")` check succeeds on a cluster state that has
nodes 1, 2, 3, and 4, i.e., only one of the two new nodes has joined the cluster and only one of the two dead nodes was removed by the master
(removing the dead nodes only happens after there are again `minimum_master_nodes` nodes in the cluster).

This commit fixes the issue by reusing a method from InternalTestCluster that checks that the right nodes have rejoined the cluster.

time:
2017-04-07T13:15:43Z
class:
core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
comments:
Restore special case for wilcard on _all query to rewrite to a match all query (#23967)

This change restores the rewrite to a match all query that we used to apply on wildcard query * on the query_string parser before #23433.

time:
2017-04-07T13:08:44Z
class:
comments:
add class to suppressions list for line length check

time:
2017-04-07T12:43:38Z
class:
core/src/test/java/org/elasticsearch/discovery/zen/ZenDiscoveryIT.java
comments:
[TEST] Take cluster state batching into account in testNodeFailuresAreProcessedOnce

The test assumes that two nodes leaving the cluster results in two cluster state updates on the master, which is invalidated by cluster state
batching.

time:
2017-04-07T12:24:32Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsTests.java
comments:
Tests: Fix highlighter fields order in TopHitsTests (#23968)

Shuffling xContent breaks the order of the highlighter fields in the
internal list if the highlighter doesn't use the array syntax. In other tests we
avoid shuffling this json level, but since this is done in the base test for
aggregations we should ensure the highlight builder uses the array syntax here.

time:
2017-04-07T10:25:24Z
class:
qa/no-bootstrap-tests/src/test/java/org/elasticsearch/bootstrap/SpawnerNoBootstrapTests.java
comments:
Fix permissions handling on Windows spawner test

This commit fixes the handling of POSIX permissions on Windows in the
spawner tests. Since POSIX permissions do not exist there, we first have
to check if we are on a filesystem that supports POSIX or not before
attempting to set the permissions.

time:
2017-04-07T09:11:06Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/ParsedAggregation.java
core/src/test/java/org/elasticsearch/search/aggregations/ParsedAggregationTests.java
comments:
Add ParsedAggregation as base Aggregation impl for high level client

ParsedAggregation is the base Aggregation implementation for the high level client, which parses aggs responses into java objects.

time:
2017-04-07T08:55:35Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/Aggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregation.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/AdjacencyMatrixIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/ChildrenIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateRangeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DoubleTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/FilterIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/FiltersIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/GeoDistanceIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/GeoHashGridIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/GlobalIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/HistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/LongTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/MissingIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/NestedIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/RangeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/ReverseNestedIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/StringTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/AvgIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/CardinalityIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ExtendedStatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/GeoBoundsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/GeoCentroidIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/HDRPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MaxIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/MinIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ScriptedMetricIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/StatsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/SumIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentileRanksIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TDigestPercentilesIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ValueCountIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/DateDerivativeIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/DerivativeIT.java
comments:
Move getProperty method out of Aggregation interface (#23949)

The `getProperty` method is an internal method needed to run pipeline aggregations and retrieve info by path from the aggs tree. It is not needed in the `Aggregation` interface, which is  returned to users running aggregations from the transport client. The method is moved to the InternalAggregation class as that's where it belongs.

time:
2017-04-07T08:20:32Z
class:
core/src/test/java/org/elasticsearch/index/query/InnerHitBuilderTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilderTests.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/main/java/org/elasticsearch/test/RandomObjects.java
test/framework/src/test/java/org/elasticsearch/test/test/ESTestCaseTests.java
comments:
[TEST] fix shuffling of xContent keys (#23929)

ESTestCase has methods to shuffle xContent keys given a builder or a parser. Shuffling wasn't actually doing what was expected but rather reordering the keys in their natural ordering, hence the output was always the same at every run. Corrected that and added tests, also fixed a couple of tests that were affected by this fix.

time:
2017-04-07T06:44:43Z
class:
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQuery.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolatorFieldMapper.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolateQueryBuilderTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorFieldMapperTests.java
comments:
[PERCOLATOR] Allowing range queries with now ranges inside percolator queries.

Before now ranges where forbidden, because the percolator query itself could get cached and then the percolator queries with now ranges that should no longer match, incorrectly will continue to match.
By disabling caching when the `percolator` is being used, the percolator can now correctly support range queries with now based ranges.

 I think this is the right tradeoff. The percolator query is likely to not be the same between search requests and disabling range queries with now ranges really disabled people using the percolator for their use cases.

 Also fixed an issue that existed in the percolator fieldmapper, it was unable to find forbidden queries inside `dismax` queries.

 Closes #23859

time:
2017-04-07T00:58:12Z
class:
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3BlobStore.java
comments:
Removes unused S3BlobStore#shouldRetry() method

time:
2017-04-07T00:54:21Z
class:
core/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
comments:
Fixes snapshot status on failed snapshots (#23833)

If a snapshot is taken on multiple indices, and some of them are "good"
indices that don't contain any corruption or failures, and some of them
are "bad" indices that contain missing shards or corrupted shards, and
if the snapshot request is set to partial=false (meaning don't take a
snapshot if there are any failures), then the good indices will not be
snapshotted either.  Previously, when getting the status of such a
snapshot, a 500 error would be thrown, because the snap-*.dat blob for
the shards in the good index could not be found.

This commit fixes the problem by reporting shards of good indices as
failed due to a failed snapshot, instead of throwing the
NoSuchFileException.

Closes #23716

time:
2017-04-07T00:40:55Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/CrudIT.java
comments:
Fix compilation in Eclipse (#23954)

Eclipse seems to have trouble with CrudIT. It throws an NPE back
to the user. I've filed a bug:
https://bugs.eclipse.org/bugs/show_bug.cgi?id=514884
but for now we should work around it.

time:
2017-04-06T23:58:53Z
class:
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/AwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/DefaultS3OutputStream.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3BlobContainer.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3BlobStore.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3OutputStream.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AbstractS3SnapshotRestoreTest.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AwsS3ServiceImplTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/MockDefaultS3OutputStream.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3BlobStoreContainerTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3RepositoryTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/TestAwsS3Service.java
comments:
Removes the retry mechanism from the S3 blob store (#23952)

Currently, both the Amazon S3 client provides a retry mechanism, and the
S3 blob store also attempts retries for failed read/write requests.
Both retry mechanisms are controlled by the
`repositories.s3.max_retries` setting.  However, the S3 blob store retry
mechanism is unnecessary because the Amazon S3 client provided by the
Amazon SDK already handles retries (with exponential backoff) based on
the provided max retry configuration setting (defaults to 3) as long as
the request is retryable.  Hence, this commit removes the unneeded retry
logic in the S3 blob store and the S3OutputStream.

Closes #22845

time:
2017-04-06T19:50:08Z
class:
comments:
Test: remove test that will never run on master

This test was added in #23950 for backporting and review, but it is always skipped on master so
this commit deletes it.

time:
2017-04-06T19:38:09Z
class:
core/src/main/java/org/elasticsearch/action/support/ContextPreservingActionListener.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java
core/src/test/java/org/elasticsearch/action/support/ContextPreservingActionListenerTests.java
comments:
Preserve response headers when creating an index (#23950)

This commit preserves the response headers when creating an index and updating settings for an
index.

Closes #23947

time:
2017-04-06T12:37:04Z
class:
comments:
Ensure output for createClone task

This commit changes the task type from LoggedExec to Exec for the BWC
createClone task to ensure that we can get some debug output.

time:
2017-04-06T12:13:56Z
class:
comments:
CONSOLEify highlighting a function_score docs

Converts many of the partial examples into full search requests.

Relates #18160

time:
2017-04-06T08:03:17Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
update Version.V_5_3_1_UNRELEASED to the latest bugfix release of Lucene:6_4_2

time:
2017-04-06T06:55:00Z
class:
core/src/main/java/org/apache/lucene/analysis/miscellaneous/DisableGraphAttribute.java
core/src/main/java/org/apache/lucene/analysis/miscellaneous/DisableGraphAttributeImpl.java
core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
core/src/main/java/org/elasticsearch/index/analysis/CJKBigramFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/ShingleTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryParser.java
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
core/src/test/java/org/elasticsearch/index/analysis/CJKFilterFactoryTests.java
core/src/test/java/org/elasticsearch/index/analysis/ShingleTokenFilterFactoryTests.java
core/src/test/java/org/elasticsearch/index/query/DisableGraphQueryTests.java
comments:
Disable graph analysis at query time for shingle and cjk filters producing tokens of different size (#23920)

This change disables graph analysis of token streams containing a shingle or a cjk filters that produce shingle or ngram of different size. The graph analysis is disabled for phrase and boolean queries.

Closes #23918

time:
2017-04-06T06:51:49Z
class:
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2Service.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2ServiceImpl.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsSigner.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/Ec2NameResolver.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/SocketAccess.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/AWSSignersTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/AbstractAwsTestCase.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/AwsEc2ServiceImplTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/AwsEc2ServiceMock.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/CloudAwsClientYamlTestSuiteIT.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryClusterFormationTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryPluginTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoverySettingsTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryUpdateSettingsTests.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2NetworkTests.java
comments:
Collapse packages in ec2 discovery plugin (#23909)

This commit collapses all the classes inside ec2 discovery to a single
package name.

time:
2017-04-05T20:03:49Z
class:
comments:
Docs: fix response object name

In #22810 I renamed a response object used by reindex and friends
but didn't update the java-api documentation that uses it. This
makes that update.

time:
2017-04-05T19:31:11Z
class:
comments:
Docs test: defend against round numbers

If a shard has a nice, round number the test in the `_cat/shards`
reference file would fail. They should be ok with it. A failure:
https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+5.3+multijob-unix-compatibility/os=fedora/93/console

time:
2017-04-05T19:11:03Z
class:
comments:
Tests: Extend rest test timeout to 30 minutes for windows (#23912)

Windows rest tests consistenly fail because the filesystem appears to be
an order of magnitude slower than that of *nix, at least in the context
of our rest tests. This commit overrides the suite timeout to 30 mins
for windows. From past failures, it appears this should be enough, as
the tests seem to fail when they are almost complete. The default suite
timeout for ESTestCase is 20 mins, so this leaves ample buffer for
windows shenanigans.

time:
2017-04-05T17:12:43Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/CrudIT.java
core/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequestHandler.java
core/src/main/java/org/elasticsearch/action/bulk/Retry.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractAsyncBulkByScrollAction.java
core/src/test/java/org/elasticsearch/action/bulk/BulkProcessorIT.java
core/src/test/java/org/elasticsearch/action/bulk/BulkProcessorRetryIT.java
core/src/test/java/org/elasticsearch/action/bulk/RetryTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/AsyncBulkByScrollActionTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportUpdateByQueryAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexMetadataTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexScriptTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RetryTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryMetadataTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryWithScriptTests.java
comments:
Decouple BulkProcessor from client implementation (#23373)

This commit modifies the BulkProcessor to be decoupled from the
client implementation. Instead it just takes a
BiConsumer<BulkRequest, ActionListener<BulkResponse>> that executes
the BulkRequest.

time:
2017-04-05T15:29:44Z
class:
core/src/main/java/org/elasticsearch/action/bulk/MappingUpdatePerformer.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/test/java/org/elasticsearch/action/bulk/TransportShardBulkActionTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/MultiFieldCopyToMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/MultiFieldIncludeInAllMapperTests.java
test/framework/src/main/java/org/elasticsearch/index/MapperTestUtils.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
comments:
Only re-parse operation if a mapping update was needed

When executing an index operation on the primary shard,
`TransportShardBulkAction` first parses the document, sees if there are any
mapping updates that needs to be applied, and then updates the mapping on the
master node. It then re-parses the document to make sure that the mappings have
been applied and propagated.

This adds a check that skips the second parsing of the document in the event
there was not a mapping update applied in the first case.

Fixes a performance regression introduced in #23665

time:
2017-04-05T14:46:21Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/FilterAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregatorFactory.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/filter/FilterAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/filters/FiltersAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTermsAggregatorTests.java
comments:
The `filter` and `significant_terms` aggregations should parse the `filter` as a filter, not as a query. (#23797)

This is important for some queries like `bool`, which are parsed differently
depending on whether we want to get a query or a filter.

time:
2017-04-05T12:49:35Z
class:
core/src/main/java/org/elasticsearch/action/search/FetchSearchPhase.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryThenFetchAsyncAction.java
core/src/test/java/org/elasticsearch/action/search/SearchPhaseControllerTests.java
comments:
Simplify sorted top docs merging in SearchPhaseController (#23881)

Today we have several code paths to merge top docs based on the number of
search results returned from the shards. If there is a only a single shard
holding any hits we go a different code path with quite some complexity while
if there are more than one the code is basically duplicated to safe the
creation of a dense array of top docs which can be large if there are many results.
This commit removes the need of the dense array and in-turn the justification for
the optimization. This commit introduces a single code path to merge top docs.

time:
2017-04-05T12:43:01Z
class:
core/src/main/java/org/elasticsearch/common/lucene/uid/PerThreadIDAndVersionLookup.java
core/src/main/java/org/elasticsearch/common/lucene/uid/Versions.java
core/src/main/java/org/elasticsearch/common/lucene/uid/VersionsResolver.java
core/src/main/java/org/elasticsearch/index/engine/DeleteVersionValue.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/LiveVersionMap.java
core/src/main/java/org/elasticsearch/index/engine/VersionConflictEngineException.java
core/src/main/java/org/elasticsearch/index/engine/VersionValue.java
core/src/main/java/org/elasticsearch/index/get/ShardGetService.java
core/src/main/java/org/elasticsearch/index/mapper/ParseContext.java
core/src/main/java/org/elasticsearch/index/mapper/SeqNoFieldMapper.java
core/src/main/java/org/elasticsearch/index/termvectors/TermVectorsService.java
core/src/test/java/org/elasticsearch/common/lucene/uid/VersionLookupTests.java
core/src/test/java/org/elasticsearch/common/lucene/uid/VersionsTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/engine/VersionValueTests.java
core/src/test/java/org/elasticsearch/index/replication/IndexLevelReplicationTests.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySourceHandlerTests.java
comments:
Refactor InternalEngine's index/delete flow for better clarity (#23711)

The InternalEngine Index/Delete methods (plus satellites like version loading from Lucene) have accumulated some cruft over the years making it hard to clearly the code flows for various use cases (primary indexing/recovery/replicas etc). This PR refactors those methods for better readability. The methods are broken up into smaller sub methods, albeit at the price of less code I reused.

To support the refactoring I have considerably beefed up the versioning tests.

This PR is a spin-off from #23543 , which made it clear this is needed.

time:
2017-04-05T12:31:32Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
comments:
ZenDiscovery - only validate min_master_nodes values if local node is master (#23915)

The purpose of this validation is to make sure that the master doesn't step down
due to a change in master nodes, which also means that there is no way to revert
an accidental change. Since we validate using the current cluster state (and
not the one from which the settings come from) we have to be careful and only
validate if the local node is already a master. Doing so all the time causes
subtle issues. For example, a node that joins a cluster has no nodes in its
current cluster state. When it receives a cluster state from the master with
a dynamic minimum master nodes setting int it, we must make sure we don't reject it.

Closes #23695

time:
2017-04-05T12:17:33Z
class:
core/src/test/java/org/elasticsearch/discovery/single/SingleNodeDiscoveryIT.java
comments:
Remove hardcoded ports from SingleNodeDiscoveryIT

SingleNodeDiscoveryIT uses a hardcoded port for the purpose of binding
two nodes within the limited port range that an unconfigured unicast zen
ping hosts list would try to discover another node on. This commit at
least removes this hardcoding for the first node to come up, although
still tries to bind the second node to the limited port range after the
first node has bound.

time:
2017-04-05T10:39:37Z
class:
comments:
Correct documentation for Min Bucket Aggregation (#23867)

time:
2017-04-05T09:18:23Z
class:
comments:
Update secure-settings.asciidoc (#23891)

time:
2017-04-05T09:12:34Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/XContentHelper.java
core/src/test/java/org/elasticsearch/ElasticsearchExceptionTests.java
core/src/test/java/org/elasticsearch/action/bulk/BulkItemResponseTests.java
core/src/test/java/org/elasticsearch/action/bulk/BulkResponseTests.java
core/src/test/java/org/elasticsearch/action/delete/DeleteResponseTests.java
core/src/test/java/org/elasticsearch/action/get/GetResponseTests.java
core/src/test/java/org/elasticsearch/action/index/IndexResponseTests.java
core/src/test/java/org/elasticsearch/action/main/MainResponseTests.java
core/src/test/java/org/elasticsearch/action/search/SearchPhaseExecutionExceptionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationResponseTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateResponseTests.java
core/src/test/java/org/elasticsearch/index/get/GetFieldTests.java
core/src/test/java/org/elasticsearch/index/get/GetResultTests.java
core/src/test/java/org/elasticsearch/search/SearchHitTests.java
core/src/test/java/org/elasticsearch/search/SearchHitsTests.java
core/src/test/java/org/elasticsearch/search/SearchSortValuesTests.java
core/src/test/java/org/elasticsearch/search/profile/ProfileResultTests.java
core/src/test/java/org/elasticsearch/search/profile/SearchProfileShardResultsTests.java
core/src/test/java/org/elasticsearch/search/profile/aggregation/AggregationProfileShardResultTests.java
core/src/test/java/org/elasticsearch/search/profile/query/CollectorResultTests.java
core/src/test/java/org/elasticsearch/search/profile/query/QueryProfileShardResultTests.java
core/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestionOptionTests.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestionEntryTests.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestionOptionTests.java
core/src/test/java/org/elasticsearch/search/suggest/TermSuggestionOptionTests.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
[TEST] make sure that fromXContent doesn't rely on keys ordering (#23901)

We shuffle the keys before we parse our responses for the high level client so that we make sure we never rely on keys ordering.

time:
2017-04-05T00:33:51Z
class:
core/src/main/java/org/elasticsearch/common/bytes/ReleasablePagedBytesReference.java
core/src/main/java/org/elasticsearch/common/compress/Compressor.java
core/src/main/java/org/elasticsearch/common/compress/DeflateCompressor.java
core/src/main/java/org/elasticsearch/common/io/BytesStream.java
core/src/main/java/org/elasticsearch/common/io/ReleasableBytesStream.java
core/src/main/java/org/elasticsearch/common/io/Streams.java
core/src/main/java/org/elasticsearch/common/io/stream/BytesStreamOutput.java
core/src/main/java/org/elasticsearch/common/io/stream/ReleasableBytesStreamOutput.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentBuilder.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/rest/AbstractRestChannel.java
core/src/main/java/org/elasticsearch/rest/BytesRestResponse.java
core/src/main/java/org/elasticsearch/rest/RestController.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/test/java/org/elasticsearch/common/io/stream/ReleasableBytesStreamOutputTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpChannel.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpChannelTests.java
comments:
Revert "Closing a ReleasableBytesStreamOutput closes the underlying BigArray (#23572)"

This reverts commit 6bfecdf921a1941b48273d76551872df4062cfae.

time:
2017-04-04T22:15:25Z
class:
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/AwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/AwsSigner.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/DefaultS3OutputStream.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3BlobContainer.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3BlobStore.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3OutputStream.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3RepositoryPlugin.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/SocketAccess.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AWSSignersTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AbstractAwsTestCase.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AbstractS3SnapshotRestoreTest.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AmazonS3Wrapper.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AwsS3ServiceImplTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/MockAmazonS3.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/MockDefaultS3OutputStream.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3BlobStoreContainerTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3BlobStoreTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3OutputStreamTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3RepositoryTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/TestAmazonS3.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/TestAwsS3Service.java
comments:
Collapse packages in repository-s3 (#23907)

This commit puts all the classes in the repository-s3 plugin into a
single package.  In addition to simplifying the plugin, it will make it
easier to test as things that should be package private will not be
difficult to use inside tests alone.

time:
2017-04-04T20:58:32Z
class:
comments:
Add a missing apostrophe (let us ~> let's) (#23905)

time:
2017-04-04T16:01:30Z
class:
core/src/main/java/org/elasticsearch/common/bytes/ReleasablePagedBytesReference.java
core/src/main/java/org/elasticsearch/common/compress/Compressor.java
core/src/main/java/org/elasticsearch/common/compress/DeflateCompressor.java
core/src/main/java/org/elasticsearch/common/io/ReleasableBytesStream.java
core/src/main/java/org/elasticsearch/common/io/Streams.java
core/src/main/java/org/elasticsearch/common/io/stream/BytesStream.java
core/src/main/java/org/elasticsearch/common/io/stream/BytesStreamOutput.java
core/src/main/java/org/elasticsearch/common/io/stream/ReleasableBytesStreamOutput.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentBuilder.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/rest/AbstractRestChannel.java
core/src/main/java/org/elasticsearch/rest/BytesRestResponse.java
core/src/main/java/org/elasticsearch/rest/RestController.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/test/java/org/elasticsearch/common/io/stream/ReleasableBytesStreamOutputTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpChannel.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpChannelTests.java
comments:
Closing a ReleasableBytesStreamOutput closes the underlying BigArray (#23572)

This commit makes closing a ReleasableBytesStreamOutput release the underlying BigArray so
that we can use try-with-resources with these streams and avoid leaking memory by not returning
the BigArray. As part of this change, the ReleasableBytesStreamOutput adds protection to only release the BigArray once.

In order to make some of the changes cleaner, the ReleasableBytesStream interface has been
removed. The BytesStream interface is changed to a abstract class so that we can use it as a
useable return type for a new method, Streams#flushOnCloseStream. This new method wraps a
given stream and overrides the close method so that the stream is simply flushed and not closed.
This behavior is used in the TcpTransport when compression is used with a
ReleasableBytesStreamOutput as we need to close the compressed stream to ensure all of the data
is written from this stream. Closing the compressed stream will try to close the underlying stream
but we only want to flush so that all of the written bytes are available.

Additionally, an error message method added in the BytesRestResponse did not use a builder
provided by the channel and instead created its own JSON builder. This changes that method to use the channel builder and in turn the bytes stream output that is managed by the channel.

time:
2017-04-04T15:04:18Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/RequestTests.java
core/src/test/java/org/apache/lucene/search/uhighlight/BoundedBreakIteratorScannerTests.java
core/src/test/java/org/elasticsearch/BuildTests.java
core/src/test/java/org/elasticsearch/ElasticsearchExceptionTests.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
core/src/test/java/org/elasticsearch/action/OriginalIndicesTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainRequestTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/stats/NodeStatsTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TaskTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteRequestTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsRequestTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponseTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/alias/AliasActionsTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/rollover/RolloverRequestTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/rollover/TransportRolloverActionTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/shrink/TransportShrinkActionTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/stats/IndicesStatsResponseTests.java
core/src/test/java/org/elasticsearch/action/bulk/BulkItemResponseTests.java
core/src/test/java/org/elasticsearch/action/bulk/BulkResponseTests.java
core/src/test/java/org/elasticsearch/action/bulk/RetryTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollParallelizationHelperTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollResponseTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollTaskStatusTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollTaskTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/DeleteByQueryRequestTests.java
core/src/test/java/org/elasticsearch/action/delete/DeleteResponseTests.java
core/src/test/java/org/elasticsearch/action/fieldcaps/FieldCapabilitiesRequestTests.java
core/src/test/java/org/elasticsearch/action/fieldcaps/FieldCapabilitiesResponseTests.java
core/src/test/java/org/elasticsearch/action/fieldcaps/FieldCapabilitiesTests.java
core/src/test/java/org/elasticsearch/action/get/MultiGetRequestTests.java
core/src/test/java/org/elasticsearch/action/get/MultiGetShardRequestTests.java
core/src/test/java/org/elasticsearch/action/index/IndexRequestTests.java
core/src/test/java/org/elasticsearch/action/index/IndexResponseTests.java
core/src/test/java/org/elasticsearch/action/ingest/SimulatePipelineRequestParsingTests.java
core/src/test/java/org/elasticsearch/action/ingest/SimulatePipelineRequestTests.java
core/src/test/java/org/elasticsearch/action/ingest/SimulatePipelineResponseTests.java
core/src/test/java/org/elasticsearch/action/ingest/SimulateProcessorResultTests.java
core/src/test/java/org/elasticsearch/action/ingest/WriteableIngestDocumentTests.java
core/src/test/java/org/elasticsearch/action/main/MainActionTests.java
core/src/test/java/org/elasticsearch/action/main/MainResponseTests.java
core/src/test/java/org/elasticsearch/action/search/SearchPhaseControllerTests.java
core/src/test/java/org/elasticsearch/action/search/SearchScrollRequestTests.java
core/src/test/java/org/elasticsearch/action/search/ShardSearchFailureTests.java
core/src/test/java/org/elasticsearch/action/support/ActiveShardCountTests.java
core/src/test/java/org/elasticsearch/action/support/AutoCreateIndexTests.java
core/src/test/java/org/elasticsearch/action/support/TransportActionFilterChainTests.java
core/src/test/java/org/elasticsearch/action/support/nodes/TransportNodesActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationOperationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateResponseTests.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapChecksTests.java
core/src/test/java/org/elasticsearch/bootstrap/ElasticsearchUncaughtExceptionHandlerTests.java
core/src/test/java/org/elasticsearch/client/AbstractClientHeadersTestCase.java
core/src/test/java/org/elasticsearch/client/ParentTaskAssigningClientTests.java
core/src/test/java/org/elasticsearch/cluster/ClusterChangedEventTests.java
core/src/test/java/org/elasticsearch/cluster/ClusterInfoTests.java
core/src/test/java/org/elasticsearch/cluster/ClusterStateDiffIT.java
core/src/test/java/org/elasticsearch/cluster/health/ClusterStateHealthTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/DateMathExpressionResolverTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/IndexGraveyardTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexServiceTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataDeleteIndexServiceTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataIndexAliasesServiceTests.java
core/src/test/java/org/elasticsearch/cluster/node/DiscoveryNodesTests.java
core/src/test/java/org/elasticsearch/cluster/routing/OperationRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/RandomShardRoutingMutator.java
core/src/test/java/org/elasticsearch/cluster/routing/ShardRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/UnassignedInfoTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/AllocateUnassignedDecisionTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/BalancedSingleShardTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/NodeAllocationResultTests.java
core/src/test/java/org/elasticsearch/common/cache/CacheTests.java
core/src/test/java/org/elasticsearch/common/io/stream/BytesStreamsTests.java
core/src/test/java/org/elasticsearch/common/logging/DeprecationLoggerTests.java
core/src/test/java/org/elasticsearch/common/lucene/index/FreqTermsEnumTests.java
core/src/test/java/org/elasticsearch/common/settings/SecureStringTests.java
core/src/test/java/org/elasticsearch/common/settings/SettingsTests.java
core/src/test/java/org/elasticsearch/common/unit/TimeValueTests.java
core/src/test/java/org/elasticsearch/common/util/BytesRefHashTests.java
core/src/test/java/org/elasticsearch/common/util/IndexFolderUpgraderTests.java
core/src/test/java/org/elasticsearch/common/xcontent/ConstructingObjectParserTests.java
core/src/test/java/org/elasticsearch/common/xcontent/UnknownNamedObjectExceptionTests.java
core/src/test/java/org/elasticsearch/common/xcontent/support/filtering/FilterPathTests.java
core/src/test/java/org/elasticsearch/discovery/ZenFaultDetectionTests.java
core/src/test/java/org/elasticsearch/discovery/zen/PublishClusterStateActionTests.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/fieldstats/FieldStatsTests.java
core/src/test/java/org/elasticsearch/gateway/GatewayMetaStateTests.java
core/src/test/java/org/elasticsearch/gateway/MetaDataStateFormatTests.java
core/src/test/java/org/elasticsearch/gateway/PrimaryShardAllocatorTests.java
core/src/test/java/org/elasticsearch/index/IndexTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/get/GetFieldTests.java
core/src/test/java/org/elasticsearch/index/get/GetResultTests.java
core/src/test/java/org/elasticsearch/index/mapper/MultiFieldTests.java
core/src/test/java/org/elasticsearch/index/mapper/RangeFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/query/AbstractTermQueryTestCase.java
core/src/test/java/org/elasticsearch/index/query/CommonTermsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/ExistsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/FieldMaskingSpanQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/FuzzyQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoShapeQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/HasChildQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/HasParentQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/IdsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/InnerHitBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchPhrasePrefixQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchPhraseQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/NestedQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/ParentIdQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/PrefixQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/RangeQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/RegexpQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryStringBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SpanTermQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/TermQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/TermsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/WildcardQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/seqno/GlobalCheckpointTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexingOperationListenerTests.java
core/src/test/java/org/elasticsearch/index/shard/ShardIdTests.java
core/src/test/java/org/elasticsearch/index/snapshots/blobstore/FileInfoTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
core/src/test/java/org/elasticsearch/indexing/IndexActionIT.java
core/src/test/java/org/elasticsearch/indices/NodeIndicesStatsTests.java
core/src/test/java/org/elasticsearch/indices/TermsLookupTests.java
core/src/test/java/org/elasticsearch/indices/analysis/PreBuiltAnalyzerIntegrationIT.java
core/src/test/java/org/elasticsearch/indices/cluster/IndicesClusterStateServiceRandomUpdatesTests.java
core/src/test/java/org/elasticsearch/indices/recovery/IndexRecoveryIT.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoveryTargetTests.java
core/src/test/java/org/elasticsearch/indices/store/IndicesStoreTests.java
core/src/test/java/org/elasticsearch/ingest/IngestDocumentTests.java
core/src/test/java/org/elasticsearch/monitor/fs/DeviceStatsTests.java
core/src/test/java/org/elasticsearch/monitor/jvm/JvmGcMonitorServiceSettingsTests.java
core/src/test/java/org/elasticsearch/monitor/jvm/JvmGcMonitorServiceTests.java
core/src/test/java/org/elasticsearch/monitor/os/OsProbeTests.java
core/src/test/java/org/elasticsearch/monitor/os/OsStatsTests.java
core/src/test/java/org/elasticsearch/nodesinfo/NodeInfoStreamingTests.java
core/src/test/java/org/elasticsearch/repositories/IndexIdTests.java
core/src/test/java/org/elasticsearch/repositories/RepositoryDataTests.java
core/src/test/java/org/elasticsearch/repositories/blobstore/BlobStoreRepositoryTests.java
core/src/test/java/org/elasticsearch/rest/BaseRestHandlerTests.java
core/src/test/java/org/elasticsearch/rest/BytesRestResponseTests.java
core/src/test/java/org/elasticsearch/rest/DeprecationRestHandlerTests.java
core/src/test/java/org/elasticsearch/rest/RestControllerTests.java
core/src/test/java/org/elasticsearch/rest/RestRequestTests.java
core/src/test/java/org/elasticsearch/rest/action/RestMainActionTests.java
core/src/test/java/org/elasticsearch/rest/action/admin/cluster/RestNodesStatsActionTests.java
core/src/test/java/org/elasticsearch/rest/action/admin/indices/RestIndicesStatsActionTests.java
core/src/test/java/org/elasticsearch/rest/action/cat/RestIndicesActionTests.java
core/src/test/java/org/elasticsearch/rest/action/cat/RestRecoveryActionTests.java
core/src/test/java/org/elasticsearch/script/ScriptMetaDataTests.java
core/src/test/java/org/elasticsearch/script/ScriptModesTests.java
core/src/test/java/org/elasticsearch/script/ScriptServiceTests.java
core/src/test/java/org/elasticsearch/script/ScriptTests.java
core/src/test/java/org/elasticsearch/script/StoredScriptTests.java
core/src/test/java/org/elasticsearch/script/StoredScriptsIT.java
core/src/test/java/org/elasticsearch/search/AbstractSearchTestCase.java
core/src/test/java/org/elasticsearch/search/NestedIdentityTests.java
core/src/test/java/org/elasticsearch/search/SearchHitTests.java
core/src/test/java/org/elasticsearch/search/SearchRequestTests.java
core/src/test/java/org/elasticsearch/search/SearchSortValuesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorFactoriesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/BaseAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/BasePipelineAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/ChildrenTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateRangeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/FilterAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/FiltersAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/GeoDistanceRangeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/GeoHashGridTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/GlobalTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/IpRangeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/RangeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/StringTermsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/TermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/NestedTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/InternalBinaryRangeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantStringTermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/StringTermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/AdjacencyMatrixTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/FilterTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/FiltersTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/GeoBoundsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/GeoCentroidTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/PercentileRanksTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/PercentilesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ScriptedMetricIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ScriptedMetricTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/scripted/InternalScriptedMetricTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHitsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketScriptTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketSelectorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/CumulativeSumTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/DerivativeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/SerialDifferenceTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/AbstractBucketMetricsTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/moving/avg/MovAvgTests.java
core/src/test/java/org/elasticsearch/search/basic/SearchWhileCreatingIndexIT.java
core/src/test/java/org/elasticsearch/search/collapse/CollapseBuilderTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilderTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightFieldTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java
core/src/test/java/org/elasticsearch/search/internal/ShardSearchTransportRequestTests.java
core/src/test/java/org/elasticsearch/search/profile/ProfileResultTests.java
core/src/test/java/org/elasticsearch/search/profile/SearchProfileShardResultsTests.java
core/src/test/java/org/elasticsearch/search/profile/aggregation/AggregationProfilerIT.java
core/src/test/java/org/elasticsearch/search/profile/query/CollectorResultTests.java
core/src/test/java/org/elasticsearch/search/query/MultiMatchQueryIT.java
core/src/test/java/org/elasticsearch/search/rescore/QueryRescoreBuilderTests.java
core/src/test/java/org/elasticsearch/search/searchafter/SearchAfterBuilderTests.java
core/src/test/java/org/elasticsearch/search/searchafter/SearchAfterIT.java
core/src/test/java/org/elasticsearch/search/slice/SearchSliceIT.java
core/src/test/java/org/elasticsearch/search/slice/SliceBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
core/src/test/java/org/elasticsearch/search/sort/FieldSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/ScriptSortBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/SortBuilderTests.java
core/src/test/java/org/elasticsearch/search/suggest/AbstractSuggestionBuilderTestCase.java
core/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestionOptionTests.java
core/src/test/java/org/elasticsearch/search/suggest/ContextCompletionSuggestSearchIT.java
core/src/test/java/org/elasticsearch/search/suggest/CustomSuggesterSearchIT.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestBuilderTests.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestTests.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestionEntryTests.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestionOptionTests.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestionTests.java
core/src/test/java/org/elasticsearch/search/suggest/TermSuggestionOptionTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/CategoryQueryContextTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/CompletionSuggesterBuilderTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/CompletionSuggestionTests.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/DirectCandidateGeneratorTests.java
core/src/test/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionBuilderTests.java
core/src/test/java/org/elasticsearch/search/suggest/term/TermSuggestionBuilderTests.java
core/src/test/java/org/elasticsearch/snapshots/BlobStoreFormatIT.java
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/MinThreadsSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/RepositoriesMetaDataSerializationTests.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/SnapshotTests.java
core/src/test/java/org/elasticsearch/snapshots/SnapshotsInProgressSerializationTests.java
core/src/test/java/org/elasticsearch/tasks/TaskResultTests.java
core/src/test/java/org/elasticsearch/transport/TransportServiceHandshakeTests.java
core/src/test/java/org/elasticsearch/tribe/TribeIT.java
core/src/test/java/org/elasticsearch/update/UpdateNoopIT.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/AppendProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/AppendProcessorTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ConvertProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ConvertProcessorTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/DateFormatTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/DateProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/DateProcessorTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/FailProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/FailProcessorTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/GrokProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/GrokProcessorTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/GsubProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/GsubProcessorTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/JoinProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/JoinProcessorTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/JsonProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/JsonProcessorTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/KeyValueProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/KeyValueProcessorTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/LowercaseProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/LowercaseProcessorTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/RemoveProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/RemoveProcessorTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/RenameProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/RenameProcessorTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/SetProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/SetProcessorTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/SortProcessorTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/SplitProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/SplitProcessorTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/TrimProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/TrimProcessorTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/UppercaseProcessorFactoryTests.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/UppercaseProcessorTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MustacheTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ImplementInterfacesTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolateQueryBuilderTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorFieldMapperTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorQuerySearchIT.java
modules/percolator/src/test/java/org/elasticsearch/percolator/QueryAnalyzerTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/BulkIndexByScrollResponseTests.java
comments:
Rename random ASCII helper methods

This commit renames the random ASCII helper methods in ESTestCase. This
is because this method ultimately uses the random ASCII methods from
randomized runner, but these methods actually only produce random
strings generated from [a-zA-Z].

Relates #23886

time:
2017-04-04T13:42:19Z
class:
core/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java
comments:
Fix Javadocs for BootstrapChecks#enforceLimits

This commit adds a description for a parameter that was added to
BootstrapChecks#enforceLimits(BoundTransportAddress, String) without the
Javadocs having been updated.

time:
2017-04-04T13:39:04Z
class:
core/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapChecksTests.java
comments:
Disable bootstrap checks for single-node discovery

While there are use-cases where a single-node is in production, there
are also use-cases for starting a single-node that binds transport to an
external interface where the node is not in production (for example, for
testing the transport client against a node started in a Docker
container). It's tricky to balance the desire to always enforce the
bootstrap checks when a node might be in production with the need for
the community to perform testing in situations that would trip the
bootstrap checks. This commit enables some flexibility for these
users. By setting the discovery type to "single-node", we disable the
bootstrap checks independently of how transport is bound. While this
sounds like a hole in the bootstrap checks, the bootstrap checks can
already be avoided in the single-node use-case by binding only HTTP but
not transport. For users that are genuinely in production on a
single-node use-case with transport bound to an external use-case, they
can set the system property "es.enable.bootstrap.checks" to force
running the bootstrap checks. It would be a mistake for them not to do
this.

Relates #23598

time:
2017-04-04T12:37:33Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/missing/MissingAggregatorTests.java
comments:
Add unit tests for the missing aggregator (#23895)

* Add unit tests for the missing aggregator

Relates #22278

time:
2017-04-04T10:35:48Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java
core/src/main/java/org/elasticsearch/common/settings/AbstractScopedSettings.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/test/java/org/elasticsearch/cluster/ClusterModuleTests.java
core/src/test/java/org/elasticsearch/common/settings/ScopedSettingsTests.java
core/src/test/java/org/elasticsearch/common/settings/SettingTests.java
core/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsIT.java
comments:
Add a property to mark setting as final (#23872)

This change adds a setting property that sets the value of a setting as final.
Updating a final setting is prohibited in any context, for instance an index setting
marked as final must be set at index creation and will refuse any update even if the index is closed.
This change also marks the setting `index.number_of_shards` as Final and the special casing for refusing the updates on this setting has been removed.

time:
2017-04-04T09:03:44Z
class:
test/framework/src/test/java/org/elasticsearch/test/test/InternalTestClusterTests.java
comments:
testDifferentRolesMaintainPathOnRestart - fix broken comment

time:
2017-04-04T08:36:09Z
class:
test/framework/src/test/java/org/elasticsearch/test/test/InternalTestClusterTests.java
comments:
testDifferentRolesMaintainPathOnRestart - lower join timeout as split elections are likely

the test reduce the wait for initial cluster state to 0, causing multiple nodes to be start while elections are going on. This means there is a chance of a split election which shouldn't cause the test to time out.

time:
2017-04-04T07:02:58Z
class:
core/src/main/java/org/elasticsearch/discovery/DiscoveryModule.java
core/src/main/java/org/elasticsearch/discovery/single/SingleNodeDiscovery.java
core/src/test/java/org/elasticsearch/discovery/single/SingleNodeDiscoveryIT.java
core/src/test/java/org/elasticsearch/discovery/single/SingleNodeDiscoveryTests.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
comments:
Introduce single-node discovery

This commit adds a single node discovery type. With this discovery type,
a node will elect itself as master and never form a cluster with another
node.

Relates #23595

time:
2017-04-04T07:01:00Z
class:
core/src/main/java/org/elasticsearch/threadpool/ThreadPool.java
comments:
Await termination after shutting down executors

When terminating an executor service or a thread pool, we first
shutdown. Then, we do a timed await termination. If the await
termination fails because there are still tasks running, we then
shutdown now. However, this method does not wait for actively executing
tasks to terminate, so we should again wait for termination of these
tasks before returning. This commit does that.

Relates #23889

time:
2017-04-04T04:33:00Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
comments:
Fix initialization issue in ElasticsearchException

If a test touches ElasticsearchExceptionHandle before the class
initialzer for ElasticsearchException has run, a circular class
initialization problem can arise. Namely, the class initializer for
ElasticsearchExceptionHandle depends on the class initializer for
ElasticsearchExceptionHandle which depends on the class initializer for
all the classes that extend ElasticsearchException, but these classes
can not be loaded because ElasticsearchException has not finished its
class initializer. There are tests that can trigger this before
ElasticsearchException has been loaded due to an unlucky ordering of
test execution. This commit addresses this issue by making
ElasticsearchExceptionHandle private, and then exposing methods that
provide the necessary values from ElasticsearchExceptionHandle. Touching
these methods will force the class initializer for
ElasticsearchException to run first.

time:
2017-04-04T02:39:24Z
class:
comments:
Fix bulk queue size in thread pool docs

This commit fixes an incorrect specification for the default queue size
for the bulk thread pool in the thread pool docs.

Relates #23870

time:
2017-04-03T18:56:21Z
class:
comments:
[DOCS] Remove line about eager loading global ordinals

Fielddata can no longer be configured to be loaded eagerly (it only accepts
`true` and `false`), so this line is a little misleading because it talks about
a procedure we can no longer do.

time:
2017-04-03T14:50:40Z
class:
plugins/discovery-gce/src/test/java/org/elasticsearch/discovery/gce/GceDiscoverTests.java
comments:
GceDiscoverTests - remove intitial_state_timeout

time:
2017-04-03T14:23:17Z
class:
core/src/test/java/org/elasticsearch/cluster/SpecificMasterNodesIT.java
comments:
SpecificMasterNodesIT shouldn't use autoMinMasterNodes

as it tweaks the `discovery.initial_state_timeout` setting.

time:
2017-04-03T14:23:17Z
class:
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
comments:
testRestorePersistentSettings doesn't to mess with discovery settings

time:
2017-04-03T14:23:17Z
class:
test/framework/src/main/java/org/elasticsearch/test/InternalTestCluster.java
test/framework/src/test/java/org/elasticsearch/test/test/InternalTestClusterTests.java
comments:
testDifferentRolesMaintainPathOnRestart shouldn't use auto managing of min master nodes

It starts nodes in any order and thus it disabled the wait for first cluster state at node start up time
the later is required for the auto management logic.

Closes #23728

time:
2017-04-03T14:15:29Z
class:
comments:
CONSOLEify the "using scripts" documentation

I found an error in one of the Painless scripts as part of
the conversion.

Relates to #18160

time:
2017-04-03T09:09:27Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/HyperLogLogPlusPlus.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinality.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/FilterAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/CardinalityAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinalityTests.java
comments:
Adds tests for cardinality and filter aggregations

Relates to #22278

time:
2017-04-03T08:54:03Z
class:
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/storage/AzureStorageServiceImpl.java
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/storage/AzureStorageSettings.java
plugins/repository-azure/src/test/java/org/elasticsearch/cloud/azure/storage/AzureStorageServiceTests.java
comments:
Merge branch 'pr/22728-azure-backoff'

time:
2017-04-03T08:52:44Z
class:
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/storage/AzureStorageServiceImpl.java
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/storage/AzureStorageSettings.java
plugins/repository-azure/src/test/java/org/elasticsearch/cloud/azure/storage/AzureStorageServiceTests.java
comments:
Add Backoff policy to azure repository

With this commit, Azure repositories are now using an Exponential Backoff policy before failing the backup.
It uses Azure SDK default values for this policy:

* `30s` delta backoff base with
   * `3s` min
   * `90s` max
* `3` retries max

Users can define the number of retries they wish by setting `cloud.azure.storage.xxx.max_retries` where `xxx` is the azure named account.

Closes #22728.

time:
2017-04-03T08:45:16Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/HyperLogLogPlusPlus.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinality.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/FilterAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/CardinalityAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinalityTests.java
comments:
Revert "Adds tests for cardinality and filter aggregations (#23826)"

This reverts commit 058869ed549deb080522d873e3891425d377cc48.

time:
2017-04-03T08:39:03Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/HyperLogLogPlusPlus.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinality.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/FilterAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/CardinalityAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinalityTests.java
comments:
Adds tests for cardinality and filter aggregations (#23826)

* Adds tests for cardinality and filter aggregations

Relates to #22278

* addresses review comments

time:
2017-04-03T08:23:04Z
class:
test/framework/src/test/java/org/elasticsearch/test/test/InternalTestClusterTests.java
comments:
mute testDifferentRolesMaintainPathOnRestart

See https://github.com/elastic/elasticsearch/issues/23728

time:
2017-04-03T07:57:26Z
class:
core/src/main/java/org/elasticsearch/common/lucene/Lucene.java
core/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/GlobalOrdinalsIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractGeoPointDVIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractIndexGeoPointFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractIndexOrdinalsFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractLatLonPointDVIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/BinaryDVIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/BytesBinaryDVIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/IndexIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/PagedBytesIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/ParentChildIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/SortedNumericDVIndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/SortedSetDVOrdinalsIndexFieldData.java
core/src/main/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapper.java
core/src/main/java/org/elasticsearch/search/searchafter/SearchAfterBuilder.java
core/src/main/java/org/elasticsearch/search/sort/FieldSortBuilder.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractFieldDataImplTestCase.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractStringFieldDataTestCase.java
core/src/test/java/org/elasticsearch/index/fielddata/NoOrdinalsStringFieldDataTests.java
core/src/test/java/org/elasticsearch/index/fielddata/ParentChildFieldDataTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreTests.java
core/src/test/java/org/elasticsearch/index/search/nested/NestedSortingTests.java
core/src/test/java/org/elasticsearch/search/sort/FieldSortBuilderTests.java
comments:
Replace custom sort field with SortedSetSortField and SortedNumericSortField when possible (#23827)

Currently for field sorting we always use a custom sort field and a custom comparator source.
Though for numeric fields this custom sort field could be replaced with a standard SortedNumericSortField unless
the field is nested especially since we removed the FieldData for numerics.
We can also use a SortedSetSortField for string sort based on doc_values when the field is not nested.

This change replaces IndexFieldData#comparatorSource with IndexFieldData#sortField that returns a Sorted{Set,Numeric}SortField when possible or a custom
 sort field when the field sort spec is not handled by the SortedSortFields.

time:
2017-04-03T07:52:09Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/MembershipAction.java
core/src/main/java/org/elasticsearch/discovery/zen/NodeJoinController.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/test/java/org/elasticsearch/discovery/zen/MembershipActionTests.java
comments:
Prevent nodes from joining if newer indices exist in the cluster (#23843)

Today we prevent nodes from joining when indices exists that are too old.
Yet, the opposite can happen too since lucene / elasticsearch is not forward
compatible when it gets to indices we won't let nodes join the cluster once
there are indices in the clusterstate that are newer than the nodes version.
This prevents forward compatibility issues which we never test against. Yet,
this will not prevent rolling restarts or anything like this since indices
are always created with the minimum node version in the cluster such that an index
can only get the version of the higher nodes once all nodes are upgraded to this version.

time:
2017-04-03T07:50:44Z
class:
core/src/main/java/org/apache/lucene/search/grouping/CollapseTopFieldDocs.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/test/java/org/apache/lucene/grouping/CollapsingTopDocsCollectorTests.java
comments:
Synchronized CollapseTopFieldDocs with lucenes relatives (#23854)

TopDocs et.al. got additional parameters to incrementally reduce
top docs. In order to add incremental reduction `CollapseTopFieldDocs`
needs to have the same properties.

time:
2017-04-02T15:17:14Z
class:
comments:
CONSOLEify analysis docs

Converts the analysis docs to that were marked as json into `CONSOLE`
format. A few of them were in yaml but marked as json for historical
reasons. I added more complete examples for a few of the less obvious
sounding ones.

Relates to #18160

time:
2017-04-02T10:52:34Z
class:
comments:
Adapted search_shards rest test to work with Perl

Because of the way Perl treats numbers, the boost is represented
as 1 instead of 1.0, which caused this test to fail.

time:
2017-04-02T10:52:30Z
class:
comments:
To examine an exception in rest tests, the exception should be caught, not ignored

time:
2017-04-02T10:52:23Z
class:
comments:
Fixed bad YAML in rest tests

time:
2017-04-01T21:49:40Z
class:
test/framework/src/main/java/org/elasticsearch/bootstrap/BootstrapForTesting.java
comments:
Fix BootstrapForTesting blowup

This commit fixes an issue with BootstrapForTesting where the common
case was to invoke a method with a null parameter that does not accept
null.

time:
2017-04-01T21:02:19Z
class:
test/framework/src/main/java/org/elasticsearch/bootstrap/BootstrapForTesting.java
comments:
Ban Boolean#getBoolean

The method Boolean#getBoolean is dangerous. It is too easy to mistakenly
invoke this method thinking that it is parsing a string as a
boolean. However, what it actually does is get a system property with
the specified string, and then attempts to use usual crappy boolean
parsing in the JDK to parse that system property as boolean with
complete leniency (it parses every input value into either true or
false); that is, this method amounts to invoking
Boolean#parseBoolean(String) on the result of
System#getProperty(String). Boo. This commit bans usage of this method.

Relates #23864

time:
2017-04-01T18:45:44Z
class:
comments:
Fix language in some docs

The pattern-analyzer docs contained a snippet that was an expanded
regex that was marked as `[source,js]`. This changes it to
`[source,regex]`.

The htmlstrip-charfilter and pattern-replace-charfilter docs had
examples that were actually a list of tokens but marked `[source,js]`.
This marks them as `[source,text]` so they don't count as unconverted
CONSOLE snippets.

The pattern-replace-charfilter also had a doc who's test was
skipped because of funny interaction with the test framework. This
fixes the test.

Three more down, eighty-two to go.

Relates to #18160

time:
2017-04-01T18:21:58Z
class:
comments:
CONSOLEify lang-analyzer docs

CONSOLEifies the lang-analyzer docs and replaces the (invalid)
empty `keyword_marker` setups that were on the page with one
that contains the word "example" translated into the appropriate
language.

Relates to #18160

time:
2017-04-01T17:18:46Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
comments:
Stricter parsing of remote node attribute

This commit enables stricter parsing of the remote node attribute,
instead of leniently parsing values that are not "true" as false.

time:
2017-04-01T17:04:51Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterConnectionTests.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterServiceTests.java
comments:
Fix cross-cluster remote node gateway attributes

Remote nodes in cross-cluster search can be marked as eligible for
acting a gateway node via a remote node attribute setting. For example,
if search.remote.node.attr is set to "gateway", only nodes that have
node.attr.gateway set to "true" can be connected to for cross-cluster
search. Unfortunately, there is a bug in the handling of these
attributes due to the use of a dangerous method
Boolean#getBoolean(String) which obtains the system property with
specified name as a boolean. We are not looking at system properties
here, but node settings. This commit fixes this situation, and adds a
test. A follow-up will ban the use of Boolean#getBoolean.

Relates #23863

time:
2017-03-31T18:21:06Z
class:
core/src/main/java/org/elasticsearch/action/fieldcaps/FieldCapabilitiesRequest.java
comments:
FieldCapabilitiesRequest should implements Replaceable since it accepts index patterns

time:
2017-03-31T16:26:59Z
class:
core/src/main/java/org/elasticsearch/index/mapper/FieldMappers.java
comments:
Cleanup: Remove unused FieldMappers class (#23851)

This class is unused, so it can be removed.

time:
2017-03-31T16:10:15Z
class:
core/src/main/java/org/elasticsearch/action/fieldcaps/FieldCapabilities.java
comments:
Fix FieldCapabilities compilation in Eclipse (#23855)

Eclipse can't deal with the generics, maybe the fixed but
unreleased https://bugs.eclipse.org/bugs/show_bug.cgi?id=511750

time:
2017-03-31T15:17:06Z
class:
modules/reindex/src/test/java/org/elasticsearch/index/reindex/CancelTests.java
comments:
Add extra debugging to reindex cancel tests

Adds more diagnostics when reindex's cancel tests fail. It fails
every once in a while and didn't have useful failure messages:
https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+5.3+multijob-unix-compatibility/os=amazon/86/consoleFull

time:
2017-03-31T15:13:27Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodes.java
core/src/test/java/org/elasticsearch/action/admin/cluster/stats/ClusterStatsNodesTests.java
comments:
Cluster stats should not render empty http/transport types (#23735)

This commit changes the ClusterStatsNodes.NetworkTypes so that is does
not print out empty field names when no Transport or HTTP type is defined:

```
{
"network_types": {
        ...
        "http_types": {
          "": 2
        }
      }
}
```

is now rendered as:

```
{
"network_types": {
        ...
        "http_types": {
        }
      }
}
```

time:
2017-03-31T14:25:15Z
class:
core/src/main/java/org/elasticsearch/action/search/FetchSearchPhase.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryThenFetchAsyncAction.java
core/src/test/java/org/elasticsearch/action/search/SearchPhaseControllerTests.java
comments:
Cleanup SearchPhaseController interface (#23844)

SearchPhaseController is tighly coupled to AtomicArray which makes
non-dense representations of results very difficult. This commit removes
the coupling and cuts over to Collection rather than List to ensure no
order or random access lookup is implied.

time:
2017-03-31T13:34:46Z
class:
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/action/fieldcaps/FieldCapabilities.java
core/src/main/java/org/elasticsearch/action/fieldcaps/FieldCapabilitiesAction.java
core/src/main/java/org/elasticsearch/action/fieldcaps/FieldCapabilitiesIndexRequest.java
core/src/main/java/org/elasticsearch/action/fieldcaps/FieldCapabilitiesIndexResponse.java
core/src/main/java/org/elasticsearch/action/fieldcaps/FieldCapabilitiesRequest.java
core/src/main/java/org/elasticsearch/action/fieldcaps/FieldCapabilitiesRequestBuilder.java
core/src/main/java/org/elasticsearch/action/fieldcaps/FieldCapabilitiesResponse.java
core/src/main/java/org/elasticsearch/action/fieldcaps/TransportFieldCapabilitiesAction.java
core/src/main/java/org/elasticsearch/action/fieldcaps/TransportFieldCapabilitiesIndexAction.java
core/src/main/java/org/elasticsearch/client/Client.java
core/src/main/java/org/elasticsearch/client/IndicesAdminClient.java
core/src/main/java/org/elasticsearch/client/support/AbstractClient.java
core/src/main/java/org/elasticsearch/index/mapper/MappedFieldType.java
core/src/main/java/org/elasticsearch/rest/action/RestFieldCapabilitiesAction.java
core/src/test/java/org/elasticsearch/action/fieldcaps/FieldCapabilitiesRequestTests.java
core/src/test/java/org/elasticsearch/action/fieldcaps/FieldCapabilitiesResponseTests.java
core/src/test/java/org/elasticsearch/action/fieldcaps/FieldCapabilitiesTests.java
comments:
Add FieldCapabilities (_field_caps) API (#23007)

This change introduces a new API called `_field_caps` that allows to retrieve the capabilities of specific fields.

Example:

````
GET t,s,v,w/_field_caps?fields=field1,field2
````
... returns:
````
{
   "fields": {
      "field1": {
         "string": {
            "searchable": true,
            "aggregatable": true
         }
      },
      "field2": {
         "keyword": {
            "searchable": false,
            "aggregatable": true,
            "non_searchable_indices": ["t"]
            "indices": ["t", "s"]
         },
         "long": {
            "searchable": true,
            "aggregatable": false,
            "non_aggregatable_indices": ["v"]
            "indices": ["v", "w"]
         }
      }
   }
}
````

In this example `field1` have the same type `text` across the requested indices `t`, `s`, `v`, `w`.
Conversely `field2` is defined with two conflicting types `keyword` and `long`.
Note that `_field_caps` does not treat this case as an error but rather return the list of unique types seen for this field.

time:
2017-03-31T13:29:01Z
class:
comments:
Doc values can no longer be updated

Closes #23820

time:
2017-03-31T13:11:54Z
class:
comments:
CONSOLEify geo-shape docs

`CONSOLE`ify geo-shape type and geo-shape query docs.

Relates to #18160

time:
2017-03-31T10:33:12Z
class:
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/blobstore/AzureBlobStore.java
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/storage/AzureStorageService.java
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/storage/AzureStorageSettings.java
plugins/repository-azure/src/main/java/org/elasticsearch/plugin/repository/azure/AzureRepositoryPlugin.java
plugins/repository-azure/src/main/java/org/elasticsearch/repositories/azure/AzureRepository.java
comments:
Merge branch 'pr/remove-repositories-azure-settings'

time:
2017-03-31T09:01:07Z
class:
core/src/main/java/org/elasticsearch/index/mapper/TextFieldMapper.java
comments:
Improves disabled fielddata error message (#23841)

Closes #22768

time:
2017-03-31T08:47:10Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
core/src/main/java/org/elasticsearch/common/util/concurrent/ThreadContext.java
core/src/main/java/org/elasticsearch/transport/TransportActionProxy.java
core/src/test/java/org/elasticsearch/common/util/concurrent/ThreadContextTests.java
core/src/test/java/org/elasticsearch/transport/TransportActionProxyTests.java
comments:
Add infrastructure to mark contexts as system contexts (#23830)

Today we have no way to mark an execution as internal. This commit adds
a simple thread context header that allows executing code in a system context.
This allows intercepting code can make better decisions down the road when
it gets to authentication.

time:
2017-03-31T07:07:43Z
class:
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuilders.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuildersTests.java
comments:
Fix reindex with a remote source on a version before 2.0.0 (#23805)

Send the scroll id in the body as plain text when the remote version is before 2.0.0

time:
2017-03-31T02:26:10Z
class:
comments:
Fix exists query doc

I managed to push the last one without testing it because I'd changed
the way I run tests locally and hadn't picked it up. Ooops. This one
works better.

time:
2017-03-31T02:01:07Z
class:
comments:
Mark exists-query dsl doc properly

All the docs for the `exists` query that aren't marked as `CONSOLE`
aren't actually `CONSOLE`-worthy so this marks them as `NOTCONSOLE`.

It also rewrites the text around `missing` query. Since it was
removed in 5.0 we don't need to talk about it in the 6.0 docs.

Relates to #18160

time:
2017-03-31T01:28:52Z
class:
comments:
CONSOLEify geo aggregation docs

Turns the top example in each of the geo aggregation docs into a working
example that can be opened in CONSOLE. Subsequent examples can all also
be opened in console and will work after you've run the first example.
All examples are tested as part of the build.

time:
2017-03-30T20:08:23Z
class:
core/src/main/java/org/elasticsearch/action/ActionListener.java
core/src/main/java/org/elasticsearch/action/NotifyOnceListener.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/test/java/org/elasticsearch/action/NotifyOnceListenerTests.java
core/src/test/java/org/elasticsearch/transport/TCPTransportTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
comments:
Pass exception from sendMessage to listener (#23559)

This commit changes the listener passed to sendMessage from a Runnable
to a ActionListener.

This change also removes IOException from the sendMessage signature.
That signature is misleading as it allows implementers to assume an
exception will be thrown in case of failure. That does not happen due
to Netty's async nature.

time:
2017-03-30T18:38:34Z
class:
core/src/main/java/org/elasticsearch/action/update/UpdateHelper.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
test/framework/src/main/java/org/elasticsearch/script/MockScriptEngine.java
comments:
Honor update request timeout

When executing an update request, the request timeout is not transferred
to the index/delete request executed on behalf of the update
request. This leads to update requests not timing out when they should
(e.g., if not all shards are available when the request specifies
wait_for_shards=all with a small timeout). This commit causes the
index/delete requests to honor the update request timeout.

Relates #23825

time:
2017-03-30T18:23:49Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/InternalSimpleValue.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/derivative/InternalDerivative.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/InternalSimpleValueTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/derivative/InternalDerivativeTests.java
comments:
Tests: Add base tests for InternalSimpleValue and InternalDerivative (#23799)

As an addition to #22278 we should probably also have base tests for InternalSimpleValue
and InternalDerivative.

time:
2017-03-30T18:21:21Z
class:
comments:
Clarify task cancellation command (#23667)

Makes it explicit that the node_id has to be included when canceling a task.

time:
2017-03-30T17:08:41Z
class:
comments:
[DOCS] Multiple clusters connected to the same repository (#23807)

time:
2017-03-30T16:40:16Z
class:
comments:
Merge branch 'pr/23448-update-azure-storage'

time:
2017-03-30T12:32:42Z
class:
core/src/main/java/org/elasticsearch/action/bulk/byscroll/ParentBulkByScrollTask.java
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/CountedCollector.java
core/src/main/java/org/elasticsearch/action/search/DfsQueryPhase.java
core/src/main/java/org/elasticsearch/action/search/FetchSearchPhase.java
core/src/main/java/org/elasticsearch/action/search/InitialSearchPhase.java
core/src/main/java/org/elasticsearch/action/search/SearchActionListener.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseContext.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchHelper.java
core/src/main/java/org/elasticsearch/action/support/tasks/TransportTasksAction.java
core/src/main/java/org/elasticsearch/common/util/concurrent/AtomicArray.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/search/SearchPhaseResult.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/dfs/DfsSearchResult.java
core/src/main/java/org/elasticsearch/search/fetch/FetchSearchResult.java
core/src/main/java/org/elasticsearch/search/fetch/QueryFetchSearchResult.java
core/src/main/java/org/elasticsearch/search/fetch/ScrollQueryFetchSearchResult.java
core/src/main/java/org/elasticsearch/search/query/QuerySearchResult.java
core/src/main/java/org/elasticsearch/search/query/QuerySearchResultProvider.java
core/src/main/java/org/elasticsearch/search/query/ScrollQuerySearchResult.java
core/src/test/java/org/elasticsearch/action/search/AbstractSearchAsyncActionTookTests.java
core/src/test/java/org/elasticsearch/action/search/CountedCollectorTests.java
core/src/test/java/org/elasticsearch/action/search/DfsQueryPhaseTests.java
core/src/test/java/org/elasticsearch/action/search/FetchSearchPhaseTests.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
core/src/test/java/org/elasticsearch/action/search/SearchPhaseControllerTests.java
core/src/test/java/org/elasticsearch/search/SearchServiceTests.java
comments:
Streamline shard index availability in all SearchPhaseResults (#23788)

Today we have the shard target and the target request ID available in SearchPhaseResults.
Yet, the coordinating node maintains a shard index to reference the request, response tuples
internally which is also used in many other classes to reference back from fetch results to
query results etc. Today this shard index is implicitly passed via the index in AtomicArray
which causes an undesirable dependency on this interface.
This commit moves the shard index into the SearchPhaseResult and removes some dependencies
on AtomicArray. Further removals will follow in the future. The most important refactoring here
is the removal of AtomicArray.Entry which used to be created for every element in the atomic array
to maintain the shard index during result processing. This caused an unnecessary indirection, dependency
and potentially thousands of unnecessary objects in every search phase.

time:
2017-03-30T10:27:32Z
class:
comments:
Update compound-word-tokenfilter.asciidoc (#23817)

Updated URL to OFFO Sourceforge project

time:
2017-03-30T08:14:41Z
class:
core/src/main/java/org/elasticsearch/search/slice/TermsSliceQuery.java
core/src/test/java/org/elasticsearch/search/slice/TermsSliceQueryTests.java
comments:
Fixed sliced search tests that rely on BytesRef.hashCode output

time:
2017-03-30T08:10:32Z
class:
core/src/main/java/org/elasticsearch/search/slice/TermsSliceQuery.java
comments:
Use a fixed seed for computing term hashCode in TermsSliceQuery (#23795)

I think this query should not use the hashCode provided BytesRef#hashCode().
It uses StringHelper#GOOD_FAST_HASH_SEED which is initialized in a static
block to System.currentTimeMillis().
Running this query on different replicas may return inconsistent results.

Using a fixed seed should guaranty that the docs are sliced consistently
accross replicas.

Fixes #23096

time:
2017-03-30T04:55:48Z
class:
comments:
Build: Remove exclusions hack used for gradle 2.13 (#23809)

Now that we are on gradle 3.3, we can take advantage of a fix that was
made in 2.14 which properly handles disabling transitive dependencies in
pom generation.  As it was currently, we actually ended up generated two
exclusions sections in the generated pom. This is yet another example of
why we need validation on the pom files with our generation here, but I
leave that for another day because I still don't know a good way to do
it.

time:
2017-03-29T21:37:32Z
class:
comments:
Remove outdated comment

time:
2017-03-29T20:42:47Z
class:
comments:
Build: Ensure upstream check works even when using info logging (#23804)

The LoggedExec task does not capture output when info logging is
enabled. This commit changes the upstream check to use Exec directly,
so as not to break when info logging is enabled.

time:
2017-03-29T20:13:09Z
class:
comments:
Build: Use filesystem agnostic printing of bwc dir path (#23803)

This will use File.toString() for the `git clone` command, which will
automatically be correct for whatever system the build is running on.

closes #23784

time:
2017-03-29T19:11:38Z
class:
comments:
Build: Find bwc version during build (#23801)

We currently have the last minor version of the previous major hardcoded
in tests like rolling upgrade. This change programatically finds this
during gradle initialization by parsing versions from Version.java.

time:
2017-03-29T16:56:51Z
class:
core/src/main/java/org/elasticsearch/action/bulk/MappingUpdatePerformer.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/test/java/org/elasticsearch/action/bulk/TransportShardBulkActionTests.java
comments:
Further refactor and extend testing for `TransportShardBulkAction`

This moves `updateReplicaRequest` to `createPrimaryResponse` and separates the
translog updating to be a separate function so that the function purpose is more
easily understood (and testable).

It also separates the logic for `MappingUpdatePerformer` into two functions,
`updateMappingsIfNeeded` and `verifyMappings` so they don't do too much in a
single function. This allows finer-grained error testing for when a mapping
fails to parse or be applied.

Finally, it separates parsing and version validation for
`executeIndexRequestOnReplica` into a separate
method (`prepareIndexOperationOnReplica`) and adds a test for it.

Relates to #23359

time:
2017-03-29T16:55:47Z
class:
comments:
Clarify preference docs

This commit clarifies the preference docs regarding the explanation of
how operations are routed by default. In particular, the previous use of
"shard replicas" was confusing as it could imply an operation would only
be routed to replicas by default.

Relates #23794

time:
2017-03-28T18:11:50Z
class:
core/src/main/java/org/elasticsearch/index/IndexSettings.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
comments:
Add lower bound for translog generation threshold

The translog already occupies 43 bytes on disk when empty. If the
translog generation threshold is below this, the flush thread can get
stuck in an infinite loop repeatedly rolling the generation. This commit
adds a lower bound on the translog generation to avoid this problem,
however we keep the lower bound small for convenience in testing.

Relates #23779

time:
2017-03-28T18:02:07Z
class:
comments:
Adds backwards compatibility index and repository for v5.3.0

time:
2017-03-28T17:04:28Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
Adds v5.3.1 to the version constants

time:
2017-03-28T15:13:34Z
class:
core/src/main/java/org/elasticsearch/index/analysis/KeywordMarkerTokenFilterFactory.java
core/src/test/java/org/elasticsearch/index/analysis/KeywordMarkerFilterFactoryTests.java
comments:
Adds pattern keyword marker filter support (#23600)

This commit adds support for the pattern keyword marker filter in
Lucene.  Previously, the keyword marker filter in Elasticsearch
supported specifying a keywords set or a path to a set of keywords.
This commit exposes the regular expression pattern based keyword marker
filter also available in Lucene, so that any token matching the pattern
specified by the `keywords_pattern` setting is excluded from being
stemmed by any stemming filters.

Closes #4877

time:
2017-03-28T14:51:18Z
class:
comments:
Add 5.3.0 version for packaging tests

This commit adds the 5.3.0 version constant needed for the packaging
test that tests upgraded versions.

time:
2017-03-28T14:44:57Z
class:
core/src/main/java/org/elasticsearch/action/bulk/byscroll/DeleteByQueryRequest.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/DeleteByQueryRequestTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/CancelTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/DeleteByQueryBasicTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RethrottleTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RetryTests.java
comments:
Require explicit query in _delete_by_query API (#23632)

As the query of a search request defaults to match_all,
calling _delete_by_query without an explicit query may
result in deleting all data.

In order to protect users against falling into that
pitfall, this commit adds a check to require the explicit
setting of a query.

Closes #23629

time:
2017-03-28T14:17:23Z
class:
core/src/main/java/org/elasticsearch/index/similarity/BooleanSimilarityProvider.java
core/src/main/java/org/elasticsearch/index/similarity/SimilarityService.java
core/src/test/java/org/elasticsearch/index/similarity/SimilarityTests.java
comments:
Adds boolean similarity to Elasticsearch (#23637)

This commit adds the boolean similarity scoring from Lucene to
Elasticsearch.  The boolean similarity provides a means to specify that
a field should not be scored with typical full-text ranking algorithms,
but rather just whether the query terms match the document or not.
Boolean similarity scores a query term equal to its query boost only.
Boolean similarity is available as a default similarity option and thus
a field can be specified to have boolean similarity by declaring in its
mapping:
    "similarity": "boolean"

Closes #6731

time:
2017-03-28T13:06:00Z
class:
comments:
Revert "Skip 5.4 bwc test for new name for now"

This reverts commit 490d29f4fc15d8d156d814a49194e619b687b96a.
We should be able to run the 5.4 tests now that we have
8c53555b2896f5ecbe583209baec300b066d65bb.

time:
2017-03-28T12:45:20Z
class:
core/src/main/java/org/elasticsearch/common/joda/Joda.java
core/src/test/java/org/elasticsearch/deps/joda/SimpleJodaTests.java
comments:
Improve error handling for epoch format parser with time zone (#23689)

Change the error response when using a non UTF timezone for range queries with epoch_millis
or epoch_second formats to an illegal argument exception. The goal is to provide a better 
explanation of why the query has failed. The current behavior is to respond with a parse exception.

Closes #22621

time:
2017-03-28T12:29:10Z
class:
comments:
Docs: fix health response test

I managed to test the wrong snippet before pushing the last
commit.... This fixes the error in it.

time:
2017-03-28T12:29:10Z
class:
comments:
Docs: Clean up response test in getting_started

It had drifted from a fix applied to 5.x. The 5.x fix was more
readable. This applies the 5.x fix.

time:
2017-03-28T12:27:31Z
class:
core/src/main/java/org/elasticsearch/action/get/MultiGetRequest.java
core/src/test/java/org/elasticsearch/action/get/MultiGetRequestTests.java
comments:
Validate top-level keys when parsing mget requests

Today, when parsing mget requests, we silently ignore keys in the top
level that do not match "docs" or "ids". This commit addresses this
situation by throwing an exception if any other key occurs here, and
providing the names of valid keys.

Relates #23746

time:
2017-03-28T03:14:34Z
class:
comments:
Reflect cross-cluster search in "dedicated" terminology (#23771)

* Reflects cross-cluster search in dedicated node settings

* Fix space issue

time:
2017-03-28T01:04:31Z
class:
core/src/main/java/org/elasticsearch/plugins/PluginInfo.java
comments:
Fix serialization for plugin info

This commit fixes the serialization for plugin info. Namely, the
serialization incorrectly specified the backwards compatibility version
as strictly after version 5.4.0, whereas it should be on or after
version 5.4.0.

time:
2017-03-28T00:01:52Z
class:
comments:
Update contributing docs for line-length change

The line-length standard has changed from 140 columns to 100
columns. This commit updates the contributing docs to reflect this
change.

time:
2017-03-27T23:59:48Z
class:
qa/smoke-test-client/src/test/java/org/elasticsearch/smoketest/SmokeTestClientIT.java
comments:
Remove line-length violations in SmokeTestClientIT

This commit removes the line-length violations in SmokeTestClientIT.java
and removes this file from the list of suppressions.

time:
2017-03-27T23:58:56Z
class:
qa/smoke-test-client/src/test/java/org/elasticsearch/smoketest/SmokeTestClientIT.java
comments:
Reenable smoke test client tests on JDK 9

These tests were disabled due to an issue in Netty which has since been
resolved and integrated into Elasticsearch.

Relates elastic/elasticsearch#20260

time:
2017-03-27T22:02:18Z
class:
comments:
Build: Use GradleBuild task for invoking 5.x checkout build (#23770)

This commit switches from executing gradle when building the bwc testing
zip through Exec, to using GradleBuild. In addition to not depending on
gradle being in the PATH, it also has the added benefit of much better
logging while the bwc build is going on (the actual tasks show up as
tasks of a subproject within the current build).

time:
2017-03-27T20:43:54Z
class:
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/main/java/org/elasticsearch/index/IndexSettings.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/test/java/org/elasticsearch/index/IndexSettingsTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
core/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsIT.java
comments:
Introduce translog generation rolling

This commit introduces a maximum size for a translog generation and
automatically rolls the translog when a generation exceeds the threshold
into a new generation. This threshold is configurable per index and
defaults to sixty-four megabytes. We introduce this constraint as
sequence numbers will require keeping around more than the current
generation (to ensure that we can rollback to the global
checkpoint). Without keeping the size of generations under control,
having to keep old generations around could consume excessive disk
space. A follow-up will enable commits to trim previous generations
based on the global checkpoint.

Relates #23606

time:
2017-03-27T19:52:45Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Spawner.java
core/src/main/java/org/elasticsearch/plugins/DummyPluginInfo.java
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
core/src/main/java/org/elasticsearch/plugins/ListPluginsCommand.java
core/src/main/java/org/elasticsearch/plugins/Platforms.java
core/src/main/java/org/elasticsearch/plugins/PluginInfo.java
core/src/main/java/org/elasticsearch/plugins/PluginSecurity.java
core/src/main/java/org/elasticsearch/plugins/PluginsService.java
core/src/test/java/org/elasticsearch/nodesinfo/NodeInfoStreamingTests.java
core/src/test/java/org/elasticsearch/plugins/PluginInfoTests.java
core/src/test/java/org/elasticsearch/plugins/PluginsTests.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/ListPluginsCommandTests.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/PluginSecurityTests.java
qa/no-bootstrap-tests/src/test/java/org/elasticsearch/bootstrap/SpawnerNoBootstrapTests.java
comments:
Modify permissions dialog for plugins

This commit modifies the handling of plugins that require special
permissions to cover a case that was not previously covered.

Relates #23742

time:
2017-03-27T15:02:01Z
class:
core/src/main/java/org/elasticsearch/index/query/FuzzyQueryBuilder.java
core/src/test/java/org/elasticsearch/index/query/FuzzyQueryBuilderTests.java
comments:
FuzzyQueryBuilder should error when parsing array of values (#23762)

Closes #23759

time:
2017-03-27T13:59:48Z
class:
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java
core/src/main/java/org/elasticsearch/snapshots/RestoreService.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexServiceTests.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataIndexUpgradeServiceTests.java
comments:
Remove obsolete index setting `index.version.minimum_compatible`. (#23593)

time:
2017-03-27T13:57:54Z
class:
core/src/main/java/org/apache/lucene/index/OneMergeHelper.java
core/src/main/java/org/elasticsearch/index/engine/ElasticsearchConcurrentMergeScheduler.java
core/src/main/java/org/elasticsearch/index/mapper/RangeFieldMapper.java
core/src/test/java/org/elasticsearch/index/mapper/RangeFieldTypeTests.java
comments:
Upgrade to Lucene 6.5.0 (#23750)

time:
2017-03-27T11:40:11Z
class:
comments:
Fix docs for plugin install via proxy on Windows

This commit addresses an issue with the docs for plugin install via a
proxy on Windows where the HTTP proxy options were incorrectly
specified.

Relates #23757

time:
2017-03-24T18:52:50Z
class:
core/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapChecksTests.java
comments:
Add early-access check

The OpenJDK project provides early-access builds of upcoming
releases. These early-access builds are not suitable for
production. These builds sometimes end up on systems due to aggressive
packaging (e.g., Ubuntu). This commit adds a bootstrap check to ensure
these early-access builds are not being used in production.

Relates #23743

time:
2017-03-24T16:44:53Z
class:
comments:
Build: Rewrite antlr regeneration in gradle (#23733)

This change ports the regeneration of antlr parser/lexer into gradle
(but does still take advantage of ant calls where appropriate).

time:
2017-03-24T16:43:38Z
class:
comments:
Build: Use targetConfiguration to remove gradle deprecation warning (#23734)

In gradle 3.3 use of getConfiguration on a ModuleDependency was
deprecated. This commit changes it to use getTargetConfiguration.

time:
2017-03-24T11:18:07Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvgTests.java
comments:
Tests: Lower expected precision for InternalAvgTests

Closes #23723

time:
2017-03-24T09:31:10Z
class:
comments:
Fetch all upstream refs for bwc checkout

time:
2017-03-24T09:22:59Z
class:
comments:
Fix bwc checkout upstream remote check

time:
2017-03-24T09:14:52Z
class:
core/src/main/java/org/elasticsearch/search/SearchHit.java
core/src/test/java/org/elasticsearch/search/SearchHitTests.java
comments:
Test: Check that parsing SearchHit without _type/_id works (#23715)

The hit object can be very small e.g. when using "stored_fields": ["_none_"],
this adds a test that checks that we can still parse back the object.

* also check type/id null

time:
2017-03-24T05:32:13Z
class:
comments:
Tests: Use local clone build of 5.x with bwc tests (#22946)

The current rest backcompat tests, which run against a mixed cluster of
5.x and 6.0 nodes, depend on snapshot builds of 5.x. However, this has
the potential for inconsistency that results in CI failures, and happens
quite often, whenever some backcompat logic is added to 5.x, but the bwc
test on master fails because the 5.x code has not yet been published as
a snapshot.

This change creates a git clone of the 5.x branch,
builds the zip distribution, and ties that into gradle substitutions for
the 5.x version.

time:
2017-03-23T19:20:38Z
class:
comments:
Docs: add description of possible snapshot states

time:
2017-03-23T16:20:40Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/InternalSingleBucketAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/adjacency/InternalAdjacencyMatrix.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filters/InternalFilters.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/InternalGeoHashGrid.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/InternalBinaryRange.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/InternalRange.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/UnmappedSampler.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantLongTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantStringTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/UnmappedSignificantTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/LongTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/StringTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvg.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/InternalCardinality.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/max/InternalMax.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/min/InternalMin.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/AbstractInternalHDRPercentiles.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/AbstractInternalTDigestPercentiles.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/sum/InternalSum.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/valuecount/InternalValueCount.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/InternalSimpleValue.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketmetrics/InternalBucketMetricValue.java
comments:
Use ParseField for aggs CommonFields rather than String (#23717)

With this change we remove a TODO from CommonFields. Also this will be useful when parsing aggs response for the high level REST client.

time:
2017-03-23T15:01:09Z
class:
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java
core/src/test/java/org/elasticsearch/index/fielddata/BinaryDVFieldDataTests.java
core/src/test/java/org/elasticsearch/index/mapper/BinaryFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/BooleanFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/CamelCaseFieldNameTests.java
core/src/test/java/org/elasticsearch/index/mapper/CompletionFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/CopyToMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentMapperMergeTests.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentParserTests.java
core/src/test/java/org/elasticsearch/index/mapper/DoubleIndexingDocTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicTemplatesTests.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/FieldNamesFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/GenericStoreDynamicTemplateTests.java
core/src/test/java/org/elasticsearch/index/mapper/GeoPointFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/IdFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/IndexFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/IpFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/JavaMultiFieldMergeTests.java
core/src/test/java/org/elasticsearch/index/mapper/KeywordFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/MultiFieldTests.java
core/src/test/java/org/elasticsearch/index/mapper/NestedObjectMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/NullValueObjectMappingTests.java
core/src/test/java/org/elasticsearch/index/mapper/NumberFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ObjectMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/PathMatchDynamicTemplateTests.java
core/src/test/java/org/elasticsearch/index/mapper/RangeFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/RoutingFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/SourceFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/StoredNumericValuesTests.java
core/src/test/java/org/elasticsearch/index/mapper/TextFieldMapperTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/CategoryContextMappingTests.java
core/src/test/java/org/elasticsearch/search/suggest/completion/GeoContextMappingTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorFieldMapperTests.java
plugins/mapper-murmur3/src/test/java/org/elasticsearch/index/mapper/murmur3/Murmur3FieldMapperTests.java
comments:
Remove DocumentMapper#parse(String index, String type, String id, BytesReference source)  (#23706)

Removed `parse(String index, String type, String id, BytesReference source)` in DocumentMapper.java and replaced all of its use in Test files with `parse(SourceToParse source)`.

`parse(String index, String type, String id, BytesReference source)` was only used in test files and never in the main code so it was removed. All of the test files that used it was then modified to use `parse(SourceToParse source)` method that existing in DocumentMapper.java

time:
2017-03-23T08:00:38Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
comments:
AbstractSearchAsyncAction: fix potential NPE in debug logging

time:
2017-03-23T01:34:15Z
class:
plugins/discovery-gce/src/main/java/org/elasticsearch/cloud/gce/util/Access.java
comments:
Fix line-length violations in gce/util/Access

This commit addresses all 100-column line-length violations in
gce/util/Access.java and removes this file from the suppressions list.

time:
2017-03-23T01:02:23Z
class:
core/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java
comments:
Fixes snapshot deletion handling on in-progress snapshot failure (#23703)

This commit fixes an issue manifested in the
SharedClusterSnapshotRestoreIT#testGetSnapshotsRequest where a delete
request on a snapshot encounters an in-progress snapshot, so it first
tries to abort the snapshot.  During the aborting process, an exception
is thrown which is handled by the snapshot listener's onSnapshotFailure
method.  This method retries the delete snapshot request, only to
encounter that the snapshot is missing, throwing an exception.  It is
possible that the snapshot failure resulted in the snapshot never having
been written to the repository, and hence, there is nothing to delete.
This commit handles the SnapshotMissingException by logging it and
notifying the listener of the missing snapshot.

Closes #23663

time:
2017-03-22T21:58:06Z
class:
comments:
CONSOLEify some more docs

And expand on the `stemmer_override` examples, including the
file on disk and an example of specifying the rules inline.

Relates to #18160

time:
2017-03-22T21:39:21Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/QueryExplanation.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/TransportValidateQueryAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/ValidateQueryRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/validate/query/ValidateQueryRequestBuilder.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestValidateQueryAction.java
core/src/test/java/org/elasticsearch/validate/SimpleValidateQueryIT.java
comments:
Make it possible to validate a query on all shards instead of a single random shard (#23697)

This is especially useful when we rewrite the query because the result of the rewrite can be very different on different shards. See #18254 for example.

time:
2017-03-22T21:15:14Z
class:
comments:
CONSOLEify some more docs

Relates to #18160

time:
2017-03-22T20:30:52Z
class:
comments:
Docs: CONSOLEify synonym tokenfiler docs

Relates to #18160

time:
2017-03-22T19:57:28Z
class:
comments:
Docs: Fix language on a few snippets

They aren't `js`, they are their own thing.

Relates to #18160

time:
2017-03-22T19:56:17Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/PainlessLexer.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/ERegex.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/RegexTests.java
comments:
Painless: Fix regex lexer and error messages (#23634)

Without this change, if write a script with multiple regexes
*sometimes* the lexer will decide to look at them like one
big regex and then some trailing garbage. Like this discuss post:
https://discuss.elastic.co/t/error-with-the-split-function-in-painless-script/79021

```
def val = /\\\\/.split(ctx._source.event_data.param17);
if (val[2] =~ /\\./) {
  def val2 = /\\./.split(val[2]);
  ctx._source['user_crash'] = val2[0]
} else {
  ctx._source['user_crash'] = val[2]
}
```

The error message you get from the lexer is `lexer_no_viable_alt_exception`
right after the *second* regex.

With this change each regex is just a single regex like it ought to be.

As a bonus, while looking into this issue I found that the error
reporting for regexes wasn't very nice. If you specify an invalid
pattern then you get an error marker on the start of the pattern
with the JVM's regex error message which attempts to point you to the
location in the regex but is totally unreadable in the JSON response.

This change fixes the location to point to the appropriate spot
inside the pattern and removes the portion of the JVM's error message
that doesn't render well. It is no longer needed now that we point
users to the appropriate spot in the pattern.

time:
2017-03-22T19:19:02Z
class:
comments:
Skip 5.4 bwc test for new name for now

We have to wait for a clean snapshot build.

time:
2017-03-22T15:00:14Z
class:
comments:
Count through the primary in list of strings test

A previous attempt to address a race condition in this test set wait for
active shards to all. However, there might not be any replicas if the
test is only running with one node so we end up waiting
forever. Instead, to address the intial race condition, we just count
through the primary.

time:
2017-03-22T14:56:03Z
class:
comments:
Skip testing new name if it isn't known

In #23638 we renamed `request_cache` to `request` in the
`_cache/clear` API. But it is only going to be committed back to
5.x so we can't test with the new name in a mixed version
cluster.

time:
2017-03-22T13:35:12Z
class:
comments:
Wait for all shards in list of strings test

This test executes a bulk indexing operation with two documents. If this
test is running against multiple nodes, there are no guarantees that all
shards are green before we execute a search operation which might hit a
replica shard. This commit creates the index in advance, and waits for
all shards to be active before proceeding with the indexing request.

time:
2017-03-22T12:28:04Z
class:
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestClearIndicesCacheAction.java
core/src/test/java/org/elasticsearch/rest/action/admin/indices/RestClearIndicesCacheActionTests.java
comments:
Deprecate request_cache for clear-cache (#23638)

It is called `request` now.

time:
2017-03-22T11:53:47Z
class:
comments:
[API] change wait_for_completion defaults according to docs (#23672)

time:
2017-03-22T11:28:13Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/GlobalOrdinalsStringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalMappedTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/LongTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/StringTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/UnmappedTerms.java
comments:
Share XContent rendering code in terms aggs (#23680)

The output of the different implementations of terms aggs is always very similar. The toXContent methods for each of those classes though was duplicating almost the same code multiple times. This commit centralizes the code for rendering XContent to a single place, which can be reused from the different terms aggs implementations.

time:
2017-03-22T09:44:11Z
class:
comments:
Update ingest-node.asciidoc

Fixed docs typo

time:
2017-03-22T09:39:39Z
class:
comments:
[DOCS] Update the docs about the fact that global ordinals for _parent field are loaded eagerly instead of lazily by default.

Relates to #8053

time:
2017-03-22T06:32:40Z
class:
comments:
Build: remove progress logger hack for gradle 2.13 (#23679)

We are now on minimum gradle 3.3, so we no longer need the groovy/gradle
hacks used to support both 2.13 and 2.14+.

time:
2017-03-22T06:26:07Z
class:
comments:
Test: Add dump of integ test cluster logs on failure (#23688)

This commit adds a build listener to the integ test runner which will
print out an excerpt of the logs from the integ test cluster if the test
run fails.  There are future improvements that can be made (for example,
to dump excerpts from dependent clusters like in tribe node tests), but
this is a start, and would help with simple rest tests failures that we
currently don't know what actually happened on the node.

time:
2017-03-21T20:56:00Z
class:
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java
comments:
Plugins: Add plugin cli specific exit codes (#23599)

We currently use POSIX exit codes in all of our CLIs. However, posix
only suggests these exit codes are standard across tools. It does not
prescribe particular uses for codes outside of that range. This commit
adds 2 exit codes specific to plugin installation to make distinguishing
an incorrectly built plugin and a plugin already existing easier.

closes #15295

time:
2017-03-21T20:45:27Z
class:
core/src/main/java/org/elasticsearch/plugins/ListPluginsCommand.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/ListPluginsCommandTests.java
comments:
Plugins: Output better error message when existing plugin is incompatible (#23562)

This commit catches the underlying failure when trying to list plugin
information when a plugin is incompatible with the current version of
elasticsearch. This could happen when elasticsearch is upgraded but old
plugins still exist. With this change, all plugins will be output,
instead of failing at the first out of date plugin.

closes #20691

time:
2017-03-21T19:33:39Z
class:
core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractAsyncBulkByScrollAction.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/ClientScrollableHitSource.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/ScrollableHitSource.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
comments:
Reindex: wait for cleanup before responding (#23677)

Changes reindex and friends to wait until the entire request has
been "cleaned up" before responding. "Clean up" in this context
is clearing the scroll and (for reindex-from-remote) shutting
down the client. Failures to clean up are still only logged, not
returned to the user.

Closes #23653

time:
2017-03-21T19:12:16Z
class:
core/src/main/java/org/elasticsearch/bootstrap/ESPolicy.java
core/src/main/java/org/elasticsearch/bootstrap/JarHell.java
core/src/main/java/org/elasticsearch/bootstrap/Security.java
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
core/src/main/java/org/elasticsearch/plugins/PluginsService.java
core/src/test/java/org/elasticsearch/bootstrap/JarHellTests.java
plugins/ingest-attachment/src/main/java/org/elasticsearch/ingest/attachment/TikaImpl.java
test/framework/src/main/java/org/elasticsearch/bootstrap/BootstrapForTesting.java
comments:
Packaging: Remove classpath ordering hack (#23596)

After the removal of the joda time hack we used to have, we can cleanup
the codebase handling in security, jarhell and plugins to be more picky
about uniqueness. This was originally in #18959 which was never merged.

closes #18959

time:
2017-03-21T18:59:21Z
class:
comments:
Docs: Add note about updating plugins requiring removal and reinstallation (#23597)

closes #20321

time:
2017-03-21T18:56:48Z
class:
comments:
Build: Make plugin list for smoke tester dynamic (#23601)

This commit removes the hardcoded list of plugins used by the smoke
tester and instead loads this list the same way the build does: by
looking for directories under the `plugins` dir.

closes #13096

time:
2017-03-21T18:02:42Z
class:
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
comments:
[TEST] Propertly cleans up failing restore test

The SharedClusterSnapshotRestoreIT#testDataFileCorruptionDuringRestore
would fail sporadically because it tried to simulate restoring a
corrupted index.  The test would wait until the restore is finished (and
marked as failed) before exiting.  However, in the background, the
cluster still continues to retry allocation of the failed shards,
despite the restore operation being marked as completed, which in turn
generates cluster states to process.  The end of every ESIntegTestCase
verifies that none of the nodes have any pending cluster states to
process.  Hence, this check sometimes fails on this particular test.

This commit solves the issue by ensuring the index is deleted before
exiting the test.

time:
2017-03-21T12:41:54Z
class:
comments:
Fix typo in allocation explain API docs

This commit addresses a simple typo in the application explain API docs.

Relates #23669

time:
2017-03-21T12:11:25Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregatorTests.java
comments:
Add unit tests for ReverseNestedAggregator (#23651)

Relates to #22278

time:
2017-03-21T10:20:04Z
class:
comments:
Revert "Revert "Build: Upgrade min gradle to 3.3 (#23544)""

This reverts commit f926a717eda34fa188219597fbb7502d930a0f25.

time:
2017-03-21T09:34:07Z
class:
comments:
Revert "Build: Upgrade min gradle to 3.3 (#23544)"

This reverts commit 5d5815416de0c275a2c110743e12944b98503bec.

time:
2017-03-21T04:15:17Z
class:
comments:
Build: Upgrade min gradle to 3.3 (#23544)

This will allow us to get rid of deprecation warnings that appear when
using 3.3, and also get rid of extra logic for 2.13 required because of
the progress logger.

time:
2017-03-21T01:11:20Z
class:
comments:
Fix took assertion in response filter test

This test asserts that the took time exists by using the is_true
assertion. This assertion fails if the took time was zero as is_true
asserts that the field is not the empty string, not the string "false",
and not 0. If the search returns quickly, and took time is measured
using a high-precision monotonic clock, the took time can be zero. This
commit changes the assertion to use gte.

time:
2017-03-20T22:48:51Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/test/java/org/elasticsearch/action/search/AbstractSearchAsyncActionTookTests.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
Search took time should use a relative clock

Search took time uses an absolute clock to measure elapsed time, and
then tries to deal with the complexities of using an absolute clock for
this purpose. Instead, we should use a high-precision monotonic relative
clock that is designed exactly for measuring elapsed time. This commit
modifies the search infrastructure to use a relative clock for measuring
took time, but still provides an absolute clock for the components of
search that require a real clock (e.g., index name expression
resolution, etc.).

Relates #23662

time:
2017-03-20T20:45:23Z
class:
core/src/main/java/org/elasticsearch/cluster/RestoreInProgress.java
core/src/main/java/org/elasticsearch/cluster/SnapshotDeletionsInProgress.java
core/src/main/java/org/elasticsearch/cluster/SnapshotsInProgress.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
comments:
Adds toString() to snapshot operations in progress

A better toString() is added for snapshot operations in progress in the
cluster state and logging has been increased to help debug
SharedClusterSnapshotRestoreIT tests.

time:
2017-03-20T19:05:40Z
class:
comments:
Docs: fix a typo in transport client's put-mapping.asciidoc (#23607)

It was talking about the wrong type.

time:
2017-03-20T18:50:19Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/DeleteDocumentationIT.java
comments:
Use include-tagged macro for high level client docs (#23438)

This should make it simpler to include example snippets from
tests.

time:
2017-03-20T17:54:44Z
class:
comments:
Update fill-column in .dir-locals.el to 100 characters

time:
2017-03-20T15:56:17Z
class:
comments:
Setup keystore during integration tests (#22966)

This commit creates a keystore and adds settings to it during the
cluster formation for integration tests. Users can define a
`keyStoreSetting` in build files for settings that need to be placed in
the keystore.

time:
2017-03-20T14:07:59Z
class:
comments:
Fix typo 'Elastisearch' -> 'Elasticsearch' (#23633)

Corrects `Elastisearch` to `Elasticsearch` in some docs and a packaging test utility.

time:
2017-03-20T13:36:33Z
class:
core/src/main/java/org/elasticsearch/index/store/Store.java
comments:
Comment and blank line cleanups (#23647)

time:
2017-03-20T13:29:26Z
class:
comments:
docs: guidelines for students and teachers (#23648)

Short summary: contributing code you wrote for a class is fine, just
don't make the contribution process part of a class.

time:
2017-03-20T10:53:35Z
class:
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
comments:
Fix MapperService StackOverflowError (#23605)

MapperService#parentTypes is rewrapped in an UnmodifiableSet in MapperService#internalMerge every time the cluster state is updated. After thousands of updates the collection is wrapped so deeply that calling a method on it generates a StackOverflowError.

Closes #23604

time:
2017-03-20T02:50:13Z
class:
core/src/main/java/org/elasticsearch/plugins/RemovePluginCommand.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/RemovePluginCommandTests.java
comments:
Format RemovePluginCommand to 100-column limit

This commit formats RemovePluginCommand.java to the 100-column limit and
removes this file from the list of suppressions.

time:
2017-03-20T02:11:50Z
class:
core/src/main/java/org/elasticsearch/plugins/RemovePluginCommand.java
comments:
Add Javadocs for RemovePluginCommand#execute

This commit adds Javadocs for RemovePluginCommand#execute, the actual
implementation of the remove plugin command.

Relates #23644

time:
2017-03-19T00:02:18Z
class:
core/src/main/java/org/elasticsearch/monitor/fs/FsInfo.java
core/src/test/java/org/elasticsearch/monitor/fs/FsProbeTests.java
comments:
Avoid overflow when computing total FS stats

When adding filesystem stats from individual filesystems, free and
available can overflow. This commit guards against this by adjusting
these situations to Long.MAX_VALUE.

Relates #23641

time:
2017-03-18T15:29:15Z
class:
qa/evil-tests/src/test/java/org/elasticsearch/bootstrap/EvilJNANativesTests.java
comments:
Mark EvilJNANativesTests as awaiting fixes

This commit marks the EvilJNANativesTests as awaiting fixes due to these
tests failing on platforms that do not provide at least version 2.14 of
glibc.

time:
2017-03-18T15:13:59Z
class:
qa/evil-tests/src/test/java/org/elasticsearch/bootstrap/EvilJNANativesTests.java
comments:
Format EvilJNANativesTests to 100-column limit

This commit formats EvilJNANativesTests.java to the 100-column limit and
removes this file from the list of suppressions.

time:
2017-03-18T01:06:16Z
class:
comments:
Upgrade from JNA 4.2.2 to JNA 4.4.0

This commit upgrades the JNA dependency from version 4.2.2 to version
4.4.0.

Relates #23636

time:
2017-03-17T23:29:18Z
class:
core/src/main/java/org/elasticsearch/tasks/TaskAwareRequest.java
core/src/main/java/org/elasticsearch/tasks/TaskManager.java
core/src/main/java/org/elasticsearch/transport/TransportRequest.java
test/framework/src/main/java/org/elasticsearch/test/tasks/MockTaskManager.java
comments:
Task Manager should be able to support non-transport tasks (#23619)

Currently the task manager is tied to the transport and can only create tasks based on TransportRequests. This commit enables task manager to support tasks created by non-transport services such as the persistent tasks service.

time:
2017-03-17T20:15:44Z
class:
comments:
Eclipse: move print margin to 100 columns

This comes "for free" when you run `gradle eclipse`.

time:
2017-03-17T17:10:13Z
class:
core/src/main/java/org/apache/lucene/search/uhighlight/BoundedBreakIteratorScanner.java
core/src/main/java/org/apache/lucene/search/uhighlight/CustomFieldHighlighter.java
core/src/main/java/org/apache/lucene/search/uhighlight/CustomUnifiedHighlighter.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/FastVectorHighlighter.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilder.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/UnifiedHighlighter.java
core/src/test/java/org/apache/lucene/search/uhighlight/BoundedBreakIteratorScannerTests.java
core/src/test/java/org/apache/lucene/search/uhighlight/CustomUnifiedHighlighterTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java
comments:
Add support for fragment_length in the unified highlighter (#23431)

* Add support for fragment_length in the unified highlighter

This commit introduce a new break iterator (a BoundedBreakIterator) designed for the unified highlighter
 that is able to limit the size of fragments produced by generic break iterator like `sentence`.
The `unified` highlighter now supports `boundary_scanner` which can `words` or `sentence`.
The `sentence` mode will use the bounded break iterator in order to limit the size of the sentence to `fragment_length`.
When sentences bigger than `fragment_length` are produced, this mode will break the sentence at the next word boundary **after**
 `fragment_length` is reached.

time:
2017-03-17T16:46:23Z
class:
core/src/test/java/org/elasticsearch/action/support/AdapterActionFutureTests.java
comments:
Clear the interrupt flag before joining

This commit changes the method for checking the interrupt status of a
thread that is intentionally interrupted during
AdapterActionFutureTests#testInteruption. Namely, we want to check and
clear the interrupt status before joining on the interrupting thread. If
we do not clear the status, when we lose a race where the interrupting
thread is not yet finished, an interrupted exception will be thrown when
we try to join on it. Clearing the interrupted status on the main thread
addresses this issue.

time:
2017-03-17T15:19:58Z
class:
comments:
Migrate to max line length of 100

This commit moves the checkstyle rule of max line length from 140
characters to 100 characters. We whitelist all existing violations and
will address them in follow-ups.

Relates #23623

time:
2017-03-17T14:57:58Z
class:
comments:
Docs: Corrected path to elasticsearch-plugin (#23622)

time:
2017-03-17T13:07:18Z
class:
comments:
Docs: Add comma to reverse nested agg snippet

time:
2017-03-17T09:05:46Z
class:
comments:
Fix third-party audit task for Gradle 3.4 (#23612)

In Gradle 3.4, the buildSrc plugin seems to be packaged into a jar before it is accessed by the rest of the build and the signatures file for the third-party audit task cannot be accessed as
getClass().getResource('/forbidden/third-party-audit.txt') then points to a file entry in a JAR, which cannot be loaded directly as a File object. This commit changes the third-party audit task to pass the content of the signatures file as a String instead.

time:
2017-03-17T05:05:48Z
class:
core/src/main/java/org/elasticsearch/action/support/AdapterActionFuture.java
core/src/test/java/org/elasticsearch/action/support/AdapterActionFutureTests.java
comments:
Adapter action future should restore interrupts

When a thread blocking on an adapter action future is interrupted, we
throw an illegal state exception. This is documented, but it is rude to
not restore the interrupt flag. This commit restores the interrupt flag
in this situation, and adds a test.

Relates #23618

time:
2017-03-17T02:37:38Z
class:
comments:
Update scripting.asciidoc

Fixed bad asciidoc

time:
2017-03-17T02:02:15Z
class:
comments:
Unmark reindex as experimental

The reindex API is mature now, and we will work to maintain backwards
compatibility in accordance with our backwards compatibility
policy. This commit unmarks the reindex API as experimental.

Relates #23621

time:
2017-03-16T20:36:18Z
class:
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestionContext.java
core/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchIT.java
comments:
CompletionSuggestionContext#toQuery() should also consider text if prefix/regex missing (#23451)

In cases where the user specifies only the `text` option on the top level
suggest element (either via REST or the java api), this gets transferred to the
`text` property in the SuggestionSearchContext. CompletionSuggestionContext
currently requires prefix or regex to be specified, otherwise errors. We should
use the global `text` property as a fallback if neither prefix nor regex is provided.

Closes to #23340

time:
2017-03-16T16:39:45Z
class:
comments:
Docs: Specify that byte units use powers of 1024 (#23574)

In SI units, "kilobyte" or "kB" would mean 1000 bytes, whereas "KiB" is
used for 1024. Add a note in `api-conventions.asciidoc` to clarify the
meaning in Elasticsearch.

time:
2017-03-16T10:20:42Z
class:
comments:
Remove Settings.settingsBuilder (#23575)

In this repository, `Settings.builder` is used everywhere although it does exactly same as `Settings.settingsBuilder`. With the reference of the commit https://github.com/elastic/elasticsearch/commit/42526ac28e07da0055faafca1de6f8c5ec96cd85 , I think mistakenly this `Settings.settingsBuilder` remains in.

time:
2017-03-16T00:29:31Z
class:
comments:
Change params._source to params['_source'] in example.

time:
2017-03-16T00:18:34Z
class:
comments:
Fix example in documentation for Painless using _source. (#21322)

time:
2017-03-15T23:33:46Z
class:
qa/evil-tests/src/test/java/org/elasticsearch/bootstrap/EvilBootstrapChecksTests.java
comments:
Remove extra line from license header

This commit removes an extra line from the license header on the file
EvilBootstrapCheckTests.java.

time:
2017-03-15T22:43:07Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/bucket/BestBucketsDeferringCollectorTests.java
comments:
Fix num docs to be positive in bucket deferring collector test

time:
2017-03-15T22:14:32Z
class:
core/src/main/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapper.java
core/src/test/java/org/elasticsearch/index/mapper/ScaledFloatFieldTypeTests.java
comments:
Mapping: Fix NPE with scaled floats stats when field is not indexed (#23528)

This fixes an NPE in finding scaled float stats. The type of min/max
methods on the wrapped long stats returns a boxed type, but in the case
this is null, the unbox done for the FieldStats.Double ctor primitive
types will cause the NPE. These methods would have null for min/max when
the field exists, but does not actually have points values.

fixes #23487

time:
2017-03-15T17:36:17Z
class:
core/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapChecksTests.java
qa/evil-tests/src/test/java/org/elasticsearch/bootstrap/EvilBootstrapChecksTests.java
comments:
Enable explicitly enforcing bootstrap checks

This commit adds a system property that enables end-users to explicitly
enforce the bootstrap checks, independently of the binding of the
transport protocol. This can be useful for single-node production
systems that do not bind the transport protocol (and thus the bootstrap
checks would not be enforced).

Relates #23585

time:
2017-03-15T17:20:18Z
class:
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
comments:
Minor spelling corrections in documentation of ClusterState (#23592)

time:
2017-03-14T14:02:42Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/UnicastZenPing.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
plugins/discovery-file/src/test/java/org/elasticsearch/discovery/file/FileBasedUnicastHostsProviderTests.java
comments:
UnicastZenPing shouldn't ping the address of the local node (#23567)

Pinging the local node address doesn't really add to discovering other nodes. It just pollutes the logs with unneeded information.

time:
2017-03-14T02:50:55Z
class:
core/src/main/java/org/elasticsearch/common/settings/SecureSetting.java
core/src/main/java/org/elasticsearch/common/settings/SecureString.java
core/src/test/java/org/elasticsearch/common/settings/ScopedSettingsTests.java
core/src/test/java/org/elasticsearch/common/settings/SecureStringTests.java
comments:
Provide a method to retrieve a closeable char[] from a SecureString (#23389)

This change adds a new method that returns the underlying char[] of a SecureString and the ability
to clone the SecureString so that the original SecureString is not vulnerable to modification.
Closing the cloned SecureString will wipe the char[] that backs the clone but the original SecureString remains unaffected.

Additionally, while making a separate change I found that SecureSettings will fail when diff is called on them and there
is no fallback setting. Given the idea behind SecureSetting, I think that diff should just be a no-op and I have
implemented this here as well.

time:
2017-03-13T16:54:50Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridAggregatorTests.java
comments:
Tests: fix GeoHashGridAggregatorTests expectations (#23556)

Currently GeoHashGridAggregatorTests#testWithSeveralDocs increases the expected
document count per hash for each geo point added to a document. When points
added to the same doc fall into one bucket (one hash cell) the document should
only be counted once.

Closes #23555

time:
2017-03-13T16:54:29Z
class:
core/src/test/java/org/elasticsearch/action/get/GetResponseTests.java
comments:
Tests: Check that GetResponse.toString() outputs json xcontent (#23545)

time:
2017-03-13T15:41:18Z
class:
comments:
Docs: Fix indentation in has-child-query.asciidoc (#23565)

time:
2017-03-13T15:17:11Z
class:
comments:
Docs: Fix indentation in has-parent-query.asciidoc

time:
2017-03-13T00:08:06Z
class:
comments:
Fix indentation in sort docs

This commit fixes the indentation in an example query in the sort docs.

Relates #23561

time:
2017-03-12T23:21:03Z
class:
core/src/main/java/org/elasticsearch/index/query/DisMaxQueryBuilder.java
core/src/test/java/org/elasticsearch/index/query/InnerHitBuilderTests.java
comments:
[INNER HITS] Changed DisMaxQueryBuilder to extract inner hits from leaf queries.

Closes #23482

time:
2017-03-12T23:14:47Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/BestDocsDeferringCollector.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedBytesHashSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedMapSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedNumericSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedOrdinalsSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/UnmappedSampler.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/BestBucketsDeferringCollectorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/sampler/BestDocsDeferringCollectorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedAggregationBuilderTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedSamplerTests.java
comments:
[TEST] Added unit tests for diversified sampler aggregator.

time:
2017-03-12T15:20:32Z
class:
comments:
Build: Split output for jrunscript to stdout and stderr (#23553)

While trying to improve the failure output in #23547, the stderr was
also captured from jrunscript. This was under the assumption that stderr
is only written to in case of an error. However, with java 9, when
JAVA_TOOL_OPTIONS are set, they are output to stderr. And our CI sets
JAVA_TOOL_OPTIONS for some reason. This commit fixes the jrunscript call
to use a separate buffer for stderr.

time:
2017-03-12T08:45:40Z
class:
core/src/main/java/org/elasticsearch/action/search/TransportMultiSearchAction.java
core/src/test/java/org/elasticsearch/action/search/TransportMultiSearchActionTests.java
comments:
Honor max concurrent searches in multi-search

A previous change to the multi-search request execution to avoid stack
overflows regressed on limiting the number of concurrent search requests
from a batched multi-search request. In particular, the replacement of
the tail-recursive call with a loop could asynchronously fire off all of
the remaining search requests in the batch while max concurrent search
requests are already executing. This commit attempts to address this
issue by taking a more careful approach to the initial problem of
recurisve calls. The cause of the initial problem was due to possibility
of individual requests completing on the same thread as invoked the
search action execution. This can happen, for example, in cases when an
individual request does not resolve to any shards. To address this
problem, when an individual request completes we check if it completed
on the same thread as fired off the request. In this case, we loop and
otherwise safely recurse. Sadly, there was a unit test to check that the
maximum number of concurrent search requests was not exceeded, but that
test was broken while modifying the test to reproduce a case that led to
the possibility of stack overflow. As such, we randomize whether or not
search actions execute on the same thread as the thread that invoked the
action.

Relates #23538

time:
2017-03-12T06:12:48Z
class:
comments:
Build: Give better output for java version introspection (#23547)

This commit improves the output when jrunscript fails to include the
full output of the command. It also makes the quoting that is needed for
windows only happen on windows (which worked on java 8, but for some
reason does not work with java 9)

time:
2017-03-12T03:46:01Z
class:
core/src/main/java/org/elasticsearch/plugins/RemovePluginCommand.java
comments:
Fall back to non-atomic move when removing plugins

When plugins are installed on a union filesystem (for example, inside a
Docker container), removing them can fail because we attempt an atomic
move which will not work if the plugin is not installed in the top
layer. This commit modifies removing a plugin to fall back to a
non-atomic move in cases when the underlying filesystem does not support
atomic moves.

Relates #23548

time:
2017-03-12T02:28:31Z
class:
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerTransportTests.java
comments:
Upgrade to Netty 4.1.9

This commit upgrades the Netty dependencies from version 4.1.8 to
version 4.1.9. This commit picks up a few bug fixes that impacted us:
 - Netty was incorrectly ignoring interfaces with self-assigned MAC
   addresses (e.g., instances running in Docker containers or on EC2)
 - incorrect handling of the Expect: 100-continue header

Relates #23540

time:
2017-03-12T01:32:35Z
class:
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
comments:
Adjust default Netty receive predictor size to 64k (#23542)

With this commit we change the default receive predictor size for Netty
from 32kB to 64kB as our testing has shown that this leads to less
allocations on smaller heaps like the default out of the box
configuration and this value also works reasonably well for larger
heaps.

Closes #23185

time:
2017-03-11T18:15:51Z
class:
comments:
Build: Fix jrunscript command to quote correctly on windows (#23539)

As noted
in https://github.com/elastic/elasticsearch/issues/22898#issuecomment-277192425

time:
2017-03-09T23:19:05Z
class:
core/src/main/java/org/elasticsearch/action/search/TransportMultiSearchAction.java
core/src/test/java/org/elasticsearch/action/search/TransportMultiSearchActionTests.java
comments:
Avoid stack overflow in multi-search

Today when handling a multi-search request, we asynchornously execute as
many search requests as the minimum of the number of search requests in
the multi-search request and the maximum number of concurrent
requests. When these search requests return, we poll more search
requests from a queue of search requests from the original multi-search
request. The implementation of this was recursive, and if the number of
requests in the multi-search request was large, a stack overflow could
arise due to the recursive invocation. This commit replaces this
recursive implementation with a simple iterative implementation.

Relates #23527

time:
2017-03-09T20:05:36Z
class:
comments:
Build: Set vagrant group for gradle install in vagrant (#23514)

We previously removed setting the vagrant group because sles-12 and
opensuse-13 did not have this group. Now that those images have the
group, we can go back to setting both user and group to vagrant.

time:
2017-03-09T19:56:43Z
class:
comments:
Test: Upgrade randomized runner to 2.5.0 (#23513)

This commit upgrades to the newest version of randomized runner. There
is a new additional check that allows ensuring the working directory
for each child jvm is empty. By default, this check will fail the test
run. However, for elasticsearch, we default to wipe the directory. For
example, if you previously told the runner to not wipe the directory, in
order to investigate a failure, the wipe option will delete this data
upon re-running the test.

time:
2017-03-09T10:52:19Z
class:
comments:
Fix settingsBuilder() with builder()

time:
2017-03-09T05:56:19Z
class:
comments:
Update to Azure Storage 5.0.0

Closes #23448.

time:
2017-03-08T16:38:12Z
class:
comments:
[TEST] Fixed the "Msearch" typed keys YAML test

* Added the YAML document separator to the beginning of the file
* Fixed the incorrect JSON syntax in the query

Closes #23500

time:
2017-03-07T19:25:23Z
class:
comments:
Add note regarding out-of-sync replicas

This commit adds a note to the resiliency status page regarding the fact
that replicas can fall out of sync with the primary shard after primary
promotion occurs due to a failing primary shard.

Relates #23503

time:
2017-03-06T22:41:30Z
class:
comments:
Fix link to Debian install instructions

The link for the Debian install instructions was mistakenly pointing to
the RPM instructions. This commit fixes the reference.

Relates #23485

time:
2017-03-06T22:12:26Z
class:
core/src/main/java/org/elasticsearch/monitor/os/OsProbe.java
core/src/test/java/org/elasticsearch/monitor/os/OsProbeTests.java
comments:
Handle existence of cgroup version 2 hierarchy

When parsing the control groups to which the Elasticsearch process
belongs, we extract a map from subsystems to paths by parsing
/proc/self/cgroup. This file contains colon-delimited entries of the
form hierarchy-ID:subsystem-list:cgroup-path. For control group version
1 hierarchies, the subsystem-list is a comma-delimited list of the
subsystems for that hierarchy. For control group version 2 hierarchies
(which can only exist on Linux kernels since version 4.5), the
subsystem-list is an empty string. The previous parsing of
/proc/self/cgroup incorrectly accounted for this possibility (a +
instead of a * in a regular expression). This commit addresses this
issue, adds a test case that covers this possibility, and simplifies the
code that parses /proc/self/cgroup.

Relates #23493

time:
2017-03-03T22:01:51Z
class:
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/blobstore/AzureBlobContainer.java
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/blobstore/AzureBlobStore.java
plugins/repository-azure/src/test/java/org/elasticsearch/repositories/azure/AzureSnapshotRestoreListSnapshotsTests.java
plugins/repository-azure/src/test/java/org/elasticsearch/repositories/azure/AzureSnapshotRestoreTests.java
comments:
Azure blob store's readBlob() method first checks if the blob exists (#23483)

Previously, the Azure blob store would depend on a 404 StorageException
coming back from Azure if trying to open an input stream to a
non-existent blob. This works for Azure repositories which access a
primary location path. For those configured to access a secondary
location path, the Azure SDK keeps trying for a long while before
returning a 404 StorageException, causing potential delays in the
snapshot APIs. This commit makes an initial check if the blob exists in
Azure and returns immediately with a NoSuchFileException, instead of
trying to open the input stream to the blob.

Closes #23480

time:
2017-03-03T10:22:00Z
class:
comments:
Fix sles vagrant image to no longer use custom repositories.

These are no longer necessary now that the jdk is packaged with the
image.

time:
2017-03-03T08:34:10Z
class:
core/src/test/java/org/elasticsearch/action/bulk/BulkResponseTests.java
comments:
[Test] Fix BulkResponseTests

time:
2017-03-03T03:36:26Z
class:
modules/lang-painless/src/test/java/org/elasticsearch/painless/AugmentationTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/FunctionRefTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/LambdaTests.java
comments:
Mute Painless lambda tests on JDK 9

This commit mutes a ton of Painless lambda tests on JDK 9. This commit
did not attempt to discover exactly which tests are failing, but instead
just blanket muted all tests in LambdaTests, FunctionRefTests, and
AugmentationTests.

Relates #23473

time:
2017-03-03T03:02:43Z
class:
comments:
Build: Fix notice generation to use configured notice file (#23472)

While the esplugin extension already had an input for the base notice
file of the plugin, the NoticeTask did not actually know how to use
that, and always used the base notice file from Elasticsearch.

time:
2017-03-03T00:52:09Z
class:
comments:
Fix notice generation to use configured notice file

time:
2017-03-03T00:49:20Z
class:
comments:
Build: Allow ignoring sha checks for dependencies (#23471)

This commit adds an `ignoreSha` configuration to the `dependencyLicense`
task, which allows to not check for a sha for a given dependency jar.
This is useful for locally built jars, which will constantly change.

time:
2017-03-02T19:44:01Z
class:
core/src/main/java/org/elasticsearch/rest/RestController.java
core/src/test/java/org/elasticsearch/rest/RestControllerTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerTransportTests.java
comments:
HTTP transport stashes the ThreadContext instead of the RestController (#23456)

Previously, the RestController would stash the context prior to copying headers. However, there could be deprecation
log messages logged and in turn warning headers being added to the context prior to the stashing of the context. These
headers in the context would then be removed from the request and also leaked back into the calling thread's context.

This change moves the stashing of the context to the HttpTransport so that the network threads' context isn't
accidentally populated with warning headers and to ensure the headers added early on in the RestController are not
excluded from the response.

time:
2017-03-02T19:20:29Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/state/TransportClusterStateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterStateAction.java
core/src/test/java/org/elasticsearch/action/search/RemoteClusterConnectionTests.java
core/src/test/java/org/elasticsearch/client/transport/FailAndRetryMockTransport.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientHeadersTests.java
core/src/test/java/org/elasticsearch/cluster/GetClusterStateTests.java
comments:
Adds cluster state size to /_cluster/state response (#23440)

This commit adds the size of the cluster state to the response for the
get cluster state API call (GET /_cluster/state).  The size that is
returned is the size of the full cluster state in bytes when compressed.
This is the same size of the full cluster state when serialized to
transmit over the network.  Specifying the ?human flag displays the
compressed size in a more human friendly manner.  Note that even if the
cluster state request filters items from the cluster state (so a subset
of the cluster state is returned), the size that is returned is the
compressed size of the entire cluster state.

Closes #3415

time:
2017-03-02T18:36:39Z
class:
comments:
Add documentation for Bash requirement

This commit adds a note to the docs regarding the requirements for Bash.

Relates #23464

time:
2017-03-02T17:42:51Z
class:
comments:
Install Gradle quietly

When downloading Gradle to install inside the VMs used for testing, the
download progress logs do not play well with the Gradle progress logger
so we see garbage like:

==> centos-6: ==> Installing gradle
==> centos-6:
==> centos-6:
==> centos-6: %
==> centos-6:
==> centos-6: T
==> centos-6: o
==> centos-6: t
==> centos-6: a
==> centos-6: l
==> centos-6:
==> centos-6:
==> centos-6:
==> centos-6:
==> centos-6: %
==> centos-6:
==> centos-6: R
==> centos-6: e
==> centos-6: c
==> centos-6: e
==> centos-6: i
==> centos-6: v
==> centos-6: e
==> centos-6: d
==> centos-6:
==> centos-6: %
==> centos-6:
==> centos-6: X
==> centos-6: f
==> centos-6: e
==> centos-6: r
==> centos-6: d
==> centos-6:
==> centos-6:
==> centos-6: A
==> centos-6: v
==> centos-6: e
==> centos-6: r
==> centos-6: a
==> centos-6: g
==> centos-6: e
==> centos-6:
==> centos-6: S
==> centos-6: p
==> centos-6: e
==> centos-6: e
==> centos-6: d
==> centos-6:
==> centos-6:

This commit addresses this by setting curl to be silent and only show
errors. This instead gives:

==> centos-6: ==> Installing gradle
==> centos-6: Archive:  /tmp/gradle.zip

Relates #23460

time:
2017-03-02T17:27:30Z
class:
core/src/test/java/org/elasticsearch/index/query/ExistsQueryBuilderTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractQueryTestCase.java
comments:
Tests: Adapt ExistsQueryBuilderTests to changes in ExistQueryBuilder#toQuery() (#23462)

Recent changes in the Lucene query that the ExistsQueryBuilder creates broke
this test.

time:
2017-03-02T15:52:21Z
class:
core/src/main/java/org/elasticsearch/action/bulk/byscroll/DeleteByQueryRequest.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/DeleteByQueryRequestTests.java
comments:
Added types options to DeleteByQueryRequest (#23265)

Add types setter and getter to `DeleteByQueryRequest`, which delegate to the inner `SearchRequest`.

time:
2017-03-02T15:26:27Z
class:
core/src/main/java/org/apache/lucene/queryparser/classic/ExistsFieldQueryExtension.java
core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java
core/src/main/java/org/elasticsearch/index/query/ExistsQueryBuilder.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
comments:
Fix query_string_query to transform "foo:*" in an exists query on the field name (#23433)

Currently "foo:*" is parsed as prefix query on the field `foo` unless the field is defined in `default_field` or `fields`.
This commit fixes this behavior, "foo:*" is now rewritten to an exists query on the field name.
This change also removes the assumption that "_all:*" should return all docs.

relates #23356

time:
2017-03-02T11:43:20Z
class:
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/ClientYamlTestSection.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/DoSection.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/SetupSection.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/SkipSection.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/TeardownSection.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/ClientYamlTestSectionTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/SkipSectionTests.java
comments:
[TEST] improve yaml test sections parsing (#23407)

Throw error when skip or do sections are malformed, such as they don't start with the proper token (START_OBJECT). That signals bad indentation, which would be ignored otherwise. Thanks (or due to) our pull parsing code, we were still able to properly parse the sections, yet other runners weren't able to.

Closes #21980

* [TEST] fix indentation in matrix_stats yaml tests

* [TEST] fix indentation in painless yaml test

* [TEST] fix indentation in analysis yaml tests

* [TEST] fix indentation in generated docs yaml tests

* [TEST] fix indentation in multi_cluster_search yaml tests

time:
2017-03-02T11:37:07Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/CrudIT.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/test/java/org/elasticsearch/action/bulk/BulkItemResponseTests.java
comments:
Correctly parse BulkItemResponse.Failure's status (#23432)

Today the status is lost when parsing back a BulkItemResponse.Failure. This commit changes the BulkItemResponse.Failure parsing method so that it correctly instantiates a failure with the parsed status instead of realying on the parsed ElasticsearchException (that always return an internal server error status).

time:
2017-03-02T10:27:04Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/InternalTDigestPercentileRanks.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/TDigestState.java
comments:
Fix centroids equality tests in TDigestState#equals

time:
2017-03-02T09:48:29Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/InternalMappedSignificantTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/InternalSignificantTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantLongTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantStringTerms.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/significant/InternalSignificantTermsTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantLongTermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantStringTermsTests.java
comments:
 Tests: Add unit test for SignificantLongTerms and SignificantStringTerms (#23428)

Relates to #22278

time:
2017-03-02T09:38:16Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/valuecount/InternalValueCountTests.java
comments:
Fix tests on InternalAggregation that rely on equals/hashCode.

time:
2017-03-02T07:37:03Z
class:
core/src/main/java/org/elasticsearch/ingest/ConfigurationUtils.java
core/src/main/java/org/elasticsearch/ingest/PipelineStore.java
core/src/test/java/org/elasticsearch/ingest/ConfigurationUtilsTests.java
core/src/test/java/org/elasticsearch/ingest/IngestProcessorNotInstalledOnAllNodesIT.java
core/src/test/java/org/elasticsearch/ingest/PipelineStoreTests.java
comments:
[INGEST] Added processor type and tag header to error when processor type isn't available on node.

[INGEST] Accumulate any potential other processor parse errors before failing instead of failing upon first processor parsing error.

time:
2017-03-01T21:50:52Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/InternalSingleBucketAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/filter/InternalFilter.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/missing/InternalMissing.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/InternalReverseNested.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/InternalSingleBucketAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/children/InternalChildrenTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/filter/InternalFilterTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/global/InternalGlogbalTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/missing/InternalMissingTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/InternalNestedTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/nested/InternalReverseNestedTests.java
comments:
Tests InternalSingleBucketAggregation subclasses (#23388)

Adds a common base class for testing subclasses of
`InternalSingleBucketAggregation`. They are so similar they
call into question the utility of having all of these classes.
We maybe could just use `InternalSingleBucketAggregation` in
all those cases.... But for now, let's test the classes!

Relates to #22278

time:
2017-03-01T21:34:10Z
class:
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
Properly clean up thread context after tests

Today when resetting the deprecation logger after a test is torn down,
we attach a new thread context to the deprecation logger. This thread
context is never cleared and we are left with a thread context attached
to the deprecation logger for every test method that ran in the same
JVM. This commit adds a flag when resetting the deprecation logger to
not attach a new thread context when the test is being torn down.

Relates #23441

time:
2017-03-01T21:29:06Z
class:
comments:
Correct version on repository-hdfs Guava dependency

This commit sets the version on the repository-hdfs Guava dependency to
version 11.0.2. This change is made to align the version here with the
version that is defined in the POM for Hadoop 2.7.1, the version of
Hadoop that the repository-hdfs plugin is based on. See HADOOP-10101 and
HADOOP-11319 for the ridiculous history of trying to upgrade Guava past
this version in the Hadoop project.

Relates #23420

time:
2017-03-01T19:54:27Z
class:
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MustachePlugin.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MustacheScriptEngineService.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/CustomMustacheFactoryTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MustacheScriptEngineTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MustacheTests.java
qa/smoke-test-ingest-with-all-dependencies/src/test/java/org/elasticsearch/ingest/AbstractScriptTestCase.java
comments:
Mustache: don't extend AbstractComponent (#23419)

Don't extend `AbstractComponent` in `MustacheScriptEngine` because
it doesn't buy anything.

time:
2017-03-01T15:08:16Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogramTests.java
comments:
 Tests: Add unit test for InternalDateHistogram (#23402)

Relates to #22278

time:
2017-03-01T14:22:26Z
class:
comments:
Fixed typo in documentation (#23406)

* Fixed typo in documentation

The option in "gap_policy" "insert_zeros" was missing a trailing "s"

* Update movavg-aggregation.asciidoc

time:
2017-03-01T13:47:21Z
class:
comments:
Docs: Fixed Parameters tables to use defaults col (#23396)

Occurred in a few places for pipeline aggregates.

time:
2017-03-01T13:34:59Z
class:
core/src/main/java/org/elasticsearch/index/search/NestedHelper.java
core/src/test/java/org/elasticsearch/index/search/NestedHelperTests.java
comments:
Avoid adding unnecessary nested filters when ranges are used. (#23427)

The code was testing `PointRangeQuery` however we now use the
`IndexOrDocValuesQuery` in field mappers. This makes the test generate queries
through mappers so that we test the actual queries that would be generated.

time:
2017-03-01T13:22:02Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/DeleteDocumentationIT.java
comments:
Fix checkstyle violation in delete docs test

This commit addresses a checkstyle violation in
DeleteDocumentationIT.java.

time:
2017-03-01T13:13:00Z
class:
comments:
fix typo (#23424)

time:
2017-03-01T12:57:40Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/AbstractInternalHDRPercentiles.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/AbstractInternalTDigestPercentiles.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/InternalTDigestPercentileRanks.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/TDigestState.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/HDRPercentileRanksAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/InternalHDRPercentilesRanksTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/InternalTDigestPercentilesRanksTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/TDigestPercentileRanksAggregatorTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractWireSerializingTestCase.java
comments:
Add unit tests to percentile ranks aggregations. (#23240)

Relates #22278

time:
2017-03-01T12:57:14Z
class:
comments:
Set build hash to Unknown when unavailable

This commit changes the build hash to be the string "Unknown" when for
some reason this build hash is not available. This aligns the value with
the value we use when the hash is not available from the jar
manifest. This situation can occur when running tests from a worktree
which is not currently handled correctly by JGit, the upstream
dependency that is used to acquire the hash. This causes problems when
running tests locally because the warning header pattern expects a hash
or the string "Unknown". While the warning header pattern be changed to
allow "N/A" as well, it seemed more sensible to align the value here
with the value when the hash is not available from the jar manifest.

Relates #23421

time:
2017-03-01T12:39:32Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/DeleteDocumentationIT.java
comments:
Merge branch 'doc/hlclient-delete'

time:
2017-03-01T12:33:12Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/DeleteDocumentationIT.java
comments:
Bad rendering of docs

time:
2017-03-01T12:21:37Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/DeleteDocumentationIT.java
comments:
Missing dot and parenthesis

time:
2017-03-01T10:55:48Z
class:
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/indices/store/IndicesStoreIntegrationIT.java
comments:
[TEST] Fix race condition when blocking cluster state processing during primary relocation

Two tests were periodically failing. What both tests are doing is starting a relocation of a shard from one node to another. Once the
recovery process is started, the test blocks cluster state processing on the relocation target using the BlockClusterStateProcessing disruption. The test then indefinitely
waits for the relocation to complete. The stack dump shows that the relocation is stuck in the PeerRecoveryTargetService.waitForClusterState method, waiting for the relocation target node to have at least the same cluster state
version as the relocation source.

The reason why it gets stuck is the following race:
1) The test code executes a reroute command that relocates a shard from one node to another
2) Relocation target node starts applying the clusterstate with relocation info, starting the recovery process.
4) Recovery is super fast and quickly goes to the waitForClusterState method, which wants to ensure that the cluster state that is
applied on the relocation target is at least as new as the one on the relocation source. The relocation source has already applied the
cluster state but the relocation target is still in the process of applying it. The waitForClusterState method thus uses a
ClusterObserver to wait for the next cluster state. Internally this means submitting a task with priority HIGH to the cluster service.
5) Cluster state application is about to finish on the relocation target. As one of the last steps, it acks to the master which makes the
reroute command return successfully.
6) The test code then blocks cluster state processing on the relocation target by submitting a cluster state update task (with priority
IMMEDIATE) that blocks execution.

If the task that is submitted in step 6 is handled before the one in step 4 by ClusterService's thread executor, cluster state
processing becomes blocked and prevents the cluster state observer from observing the applied cluster state.

time:
2017-03-01T10:51:06Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/DocumentationIT.java
client/rest-high-level/src/test/java/org/elasticsearch/client/documentation/DeleteDocumentationIT.java
comments:
Adapt per Nik's comments

time:
2017-03-01T10:28:13Z
class:
comments:
Don't mention cluster compatibility

time:
2017-03-01T10:26:36Z
class:
client/rest-high-level/src/main/java/org/elasticsearch/client/Request.java
client/rest-high-level/src/main/java/org/elasticsearch/client/RestHighLevelClient.java
client/rest-high-level/src/test/java/org/elasticsearch/client/ESRestHighLevelClientTestCase.java
client/rest-high-level/src/test/java/org/elasticsearch/client/PingAndInfoIT.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RequestTests.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RestHighLevelClientTests.java
client/rest/src/main/java/org/elasticsearch/client/RestClient.java
client/rest/src/test/java/org/elasticsearch/client/RestClientTests.java
core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/TaskOperationFailure.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResultHolder.java
core/src/main/java/org/elasticsearch/action/bulk/MappingUpdatePerformer.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/main/MainResponse.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/cli/Terminal.java
core/src/main/java/org/elasticsearch/cluster/ClusterModule.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/SameShardAllocationDecider.java
core/src/main/java/org/elasticsearch/common/logging/DeprecationLogger.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/util/concurrent/ThreadContext.java
core/src/main/java/org/elasticsearch/index/MergeSchedulerConfig.java
core/src/main/java/org/elasticsearch/index/analysis/PatternReplaceCharFilterFactory.java
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
core/src/main/java/org/elasticsearch/index/shard/IndexShardOperationsLock.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/InternalScriptedMetric.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHits.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/main/java/org/elasticsearch/search/profile/query/ProfileScorer.java
core/src/main/java/org/elasticsearch/search/suggest/Suggest.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggester.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestion.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestion.java
core/src/main/java/org/elasticsearch/search/suggest/term/TermSuggestion.java
core/src/test/java/org/elasticsearch/action/bulk/TransportShardBulkActionTests.java
core/src/test/java/org/elasticsearch/action/main/MainResponseTests.java
core/src/test/java/org/elasticsearch/action/search/SearchPhaseControllerTests.java
core/src/test/java/org/elasticsearch/cli/TerminalTests.java
core/src/test/java/org/elasticsearch/client/transport/NodeDisconnectIT.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/FilterAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/RandomAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/SameShardRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/EnableAllocationDeciderIT.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/UpdateShardAllocationSettingsIT.java
core/src/test/java/org/elasticsearch/common/logging/DeprecationLoggerTests.java
core/src/test/java/org/elasticsearch/common/util/concurrent/ThreadContextTests.java
core/src/test/java/org/elasticsearch/gateway/ReplicaShardAllocatorTests.java
core/src/test/java/org/elasticsearch/index/MergeSchedulerSettingsTests.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryParserTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/search/ESToParentBlockJoinQueryTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardOperationsLockTests.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
core/src/test/java/org/elasticsearch/indices/recovery/IndexPrimaryRelocationIT.java
core/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/FiltersAggsRewriteIT.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/TermsDocCountErrorIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/scripted/InternalScriptedMetricTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregatorTests.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestTests.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestionEntryTests.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestionTests.java
docs/src/test/java/org/elasticsearch/smoketest/DocsClientYamlTestSuiteIT.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/rest/Netty4BadRequestIT.java
plugins/discovery-azure-classic/src/main/java/org/elasticsearch/plugin/discovery/azure/classic/AzureDiscoveryPlugin.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/plugin/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/repository-azure/src/test/java/org/elasticsearch/repositories/azure/AzureRepositorySettingsTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/AwsS3ServiceImplTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3RepositoryTests.java
qa/backwards-5.0/src/test/java/org/elasticsearch/backwards/Backwards50ClientYamlTestSuiteIT.java
qa/backwards-5.0/src/test/java/org/elasticsearch/backwards/IndexingIT.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/DeprecationHttpIT.java
test/framework/src/main/java/org/elasticsearch/AnalysisFactoryTestCase.java
test/framework/src/main/java/org/elasticsearch/cli/MockTerminal.java
test/framework/src/main/java/org/elasticsearch/cluster/ESAllocationTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestExecutionContext.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestResponse.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ESClientYamlSuiteTestCase.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ObjectPath.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/ApiCallSection.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/DoSection.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/ObjectPathTests.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/DoSectionTests.java
comments:
Merge branch 'master' into doc/hlclient-delete

time:
2017-03-01T09:33:57Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridParams.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/InternalGeoHashGrid.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/geogrid/InternalGeoHashGridTests.java
comments:
[TEST] Added unit tests for GeoHashGridAggregator and InternalGeoHashGrid

Part of #22278

time:
2017-03-01T09:00:38Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/support/IncludeExclude.java
comments:
Remove support for the include/pattern syntax. (#23141)

Relates #22933

time:
2017-03-01T02:53:18Z
class:
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResultHolder.java
core/src/main/java/org/elasticsearch/action/bulk/MappingUpdatePerformer.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/test/java/org/elasticsearch/action/bulk/TransportShardBulkActionTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
comments:
Refactor TransportShardBulkAction and add unit tests

This refactors the `TransportShardBulkAction` to split it appart and make it
unit-testable, and then it also adds unit tests that use these methods.

In particular, this makes `executeBulkItemRequest` shorter and more readable

time:
2017-03-01T01:28:07Z
class:
core/src/main/java/org/elasticsearch/common/logging/DeprecationLogger.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/DoSectionTests.java
comments:
Fix date format in warning headers

This commit fixes the date format in warning headers. There is some
confusion around whether or not RFC 1123 requires two-digit
days. However, the warning header specification very clearly relies on a
format that requires two-digit days. This commit removes the usage of
RFC 1123 date/time format from Java 8, which allows for one-digit days,
in favor of a format that forces two-digit days (it's otherwise
identical to RFC 1123 format, it is just fixed width).

Relates #23418

time:
2017-02-28T23:24:39Z
class:
plugins/repository-azure/src/test/java/org/elasticsearch/repositories/azure/AzureRepositorySettingsTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/AwsS3ServiceImplTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3RepositoryTests.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
Add convenience method for asserting deprecations

This commit adds a convenience method for simultaneously asserting
settings deprecations and other warnings and fixes some tests where
setting deprecations and general warnings were present.

time:
2017-02-28T22:45:13Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeResponse.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractBulkByScrollRequest.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollTask.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStats.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsResponse.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsShardResponse.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/cluster/SnapshotDeletionsInProgress.java
core/src/main/java/org/elasticsearch/cluster/SnapshotsInProgress.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/NodeAllocationResult.java
core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/RangeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/main/java/org/elasticsearch/index/refresh/RefreshStats.java
core/src/main/java/org/elasticsearch/monitor/os/OsStats.java
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/support/IncludeExclude.java
core/src/main/java/org/elasticsearch/search/internal/AliasFilter.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchLocalRequest.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotInfo.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponseTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/storedscripts/PutStoredScriptRequestTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequestTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequestTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollTaskStatusTests.java
core/src/test/java/org/elasticsearch/action/fieldstats/FieldStatsRequestTests.java
core/src/test/java/org/elasticsearch/action/index/IndexRequestTests.java
core/src/test/java/org/elasticsearch/action/ingest/PutPipelineRequestTests.java
core/src/test/java/org/elasticsearch/action/ingest/SimulatePipelineRequestTests.java
core/src/test/java/org/elasticsearch/action/termvectors/TermVectorsUnitTests.java
core/src/test/java/org/elasticsearch/common/io/stream/BytesStreamsTests.java
core/src/test/java/org/elasticsearch/fieldstats/FieldStatsTests.java
core/src/test/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/refresh/RefreshStatsTests.java
core/src/test/java/org/elasticsearch/ingest/PipelineConfigurationTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolateQueryBuilderTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteInfo.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RoundTripTests.java
comments:
Revert "Internal: Change version constant names for already released versions (#23416)"

This reverts commit dc0e93ed6238e5df6c66206b9f31cdc162db166a.

time:
2017-02-28T21:05:44Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeResponse.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractBulkByScrollRequest.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollTask.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStats.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsResponse.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStatsShardResponse.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/cluster/SnapshotDeletionsInProgress.java
core/src/main/java/org/elasticsearch/cluster/SnapshotsInProgress.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/NodeAllocationResult.java
core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/RangeQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/main/java/org/elasticsearch/index/refresh/RefreshStats.java
core/src/main/java/org/elasticsearch/monitor/os/OsStats.java
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/support/IncludeExclude.java
core/src/main/java/org/elasticsearch/search/internal/AliasFilter.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchLocalRequest.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotInfo.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
core/src/test/java/org/elasticsearch/VersionTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/shards/ClusterSearchShardsResponseTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/storedscripts/PutStoredScriptRequestTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequestTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequestTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollTaskStatusTests.java
core/src/test/java/org/elasticsearch/action/fieldstats/FieldStatsRequestTests.java
core/src/test/java/org/elasticsearch/action/index/IndexRequestTests.java
core/src/test/java/org/elasticsearch/action/ingest/PutPipelineRequestTests.java
core/src/test/java/org/elasticsearch/action/ingest/SimulatePipelineRequestTests.java
core/src/test/java/org/elasticsearch/action/termvectors/TermVectorsUnitTests.java
core/src/test/java/org/elasticsearch/common/io/stream/BytesStreamsTests.java
core/src/test/java/org/elasticsearch/fieldstats/FieldStatsTests.java
core/src/test/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/refresh/RefreshStatsTests.java
core/src/test/java/org/elasticsearch/ingest/PipelineConfigurationTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolateQueryBuilderTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteInfo.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RoundTripTests.java
comments:
Internal: Change version constant names for already released versions (#23416)

We have many version constants in master that have already been
released, but are still marked (by naming convention) as unreleased.
This commit renames those version constants.

time:
2017-02-28T19:31:35Z
class:
comments:
Add 5.2.2 to vagrant pool of bwc versions to test

time:
2017-02-28T19:14:28Z
class:
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/UpdateShardAllocationSettingsIT.java
comments:
Fix checkstyle LineLength issues in UpdateShardAllocationSettingsIT

time:
2017-02-28T18:11:48Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
Create version constants for next bug fix version v5.2.3

time:
2017-02-28T17:58:27Z
class:
core/src/test/java/org/elasticsearch/cluster/routing/allocation/SameShardRoutingTests.java
comments:
[TEST] removes unused SameShardRouting test

time:
2017-02-28T17:48:54Z
class:
core/src/main/java/org/elasticsearch/cluster/ClusterModule.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/decider/SameShardAllocationDecider.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/FilterAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/RandomAllocationDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/SameShardRoutingTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/DiskThresholdDeciderTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/decider/UpdateShardAllocationSettingsIT.java
core/src/test/java/org/elasticsearch/gateway/ReplicaShardAllocatorTests.java
core/src/test/java/org/elasticsearch/indices/cluster/ClusterStateChanges.java
test/framework/src/main/java/org/elasticsearch/cluster/ESAllocationTestCase.java
comments:
Makes the same_shard host dyanamically updatable (#23397)

Previously, cluster.routing.allocation.same_shard.host was not a dynamic
setting and could not be updated after startup.  This commit changes the
behavior to allow the setting to be dynamically updatable.  The
documentation already states that the setting is dynamic so no
documentation changes are required.

Closes #22992

time:
2017-02-28T15:56:43Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregatorTests.java
comments:
Tests: fixing line length limit in ScriptedMetricAggregatorTests

time:
2017-02-28T15:43:12Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregationBuilder.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregatorTests.java
comments:
Tests: Add unit test for InternalScriptedMetricAggregator (#23404)

Relates to #22278

time:
2017-02-28T15:33:09Z
class:
comments:
Typo (#23344)

time:
2017-02-28T13:56:35Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalTerms.java
comments:
Fixes the per term error in the terms aggregation

When multiple reduce phases were needed the per term error got lost in subsequent reduces in some situations:

When a previous reduce phase had calculated a non-zero error for a particular bucket we were not accounting for this error in subsequent reduce phases and instead were relying on the overall error for the agg which meant we were implicitly assuming that all shards that made up that aggregation had returned the term. This is plainly not true so we need to make sure the per term error for the aggregation is used when calcualting the error for that term in the new reduced aggregation.

time:
2017-02-28T10:43:35Z
class:
core/src/test/java/org/elasticsearch/index/MergeSchedulerSettingsTests.java
comments:
Fix merge scheduler test that depends on the number of processors

time:
2017-02-28T10:34:02Z
class:
core/src/main/java/org/elasticsearch/common/settings/Setting.java
comments:
#23391: simplify setting fallback (missing in the squash commit)

time:
2017-02-28T10:30:33Z
class:
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
comments:
 Tests: Fix RemoteScrollableHitSourceTests

 With  #23307, the expected exception is wrapped two times into a RuntimeException instead of being thrown directly.

time:
2017-02-28T09:21:27Z
class:
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/index/MergeSchedulerConfig.java
core/src/test/java/org/elasticsearch/index/MergeSchedulerSettingsTests.java
core/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsIT.java
comments:
Fix merge scheduler config settings (#23391)

Change Setting#get(Settings, Settings) to fallback only if the setting is present in the secondary.
This is needed to fix setting that relies on other settings.
Replace IT with uts.

time:
2017-02-28T08:40:11Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/InternalScriptedMetric.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/scripted/InternalScriptedMetricTests.java
comments:
Tests: Add unit test for InternalScriptedMetric (#23330)

Relates to #22278

time:
2017-02-28T08:38:59Z
class:
client/rest/src/test/java/org/elasticsearch/client/RestClientTests.java
comments:
[Tests] Fix RestClientTests

time:
2017-02-28T08:33:51Z
class:
client/rest/src/main/java/org/elasticsearch/client/RestClient.java
client/rest/src/test/java/org/elasticsearch/client/RestClientTests.java
comments:
RestClient asynchronous execution should not throw exceptions (#23307)

The current implementation of RestClient.performAsync() methods can throw exceptions before the request is asynchronously executed. Since it only throws unchecked exceptions, it's easy for the user/dev to forget to catch them. Instead I think async methods should never throw exceptions and should always call the listener onFailure() method.

time:
2017-02-28T00:13:00Z
class:
comments:
Only set vagrant user for gradle installation

The vagrant group is not available on all systems the packaging and
platform tests run on.

time:
2017-02-27T22:19:13Z
class:
core/src/test/java/org/elasticsearch/common/logging/DeprecationLoggerTests.java
comments:
Fix deprecation escaping tests

This commit fixes an off-by-one error in the deprecation escaping tests.

time:
2017-02-27T22:14:57Z
class:
qa/smoke-test-http/src/test/java/org/elasticsearch/http/DeprecationHttpIT.java
comments:
Fix deprecation HTTP tests

This commit adapts the deprecation HTTP tests for the RFC 7234
specification compliant warning headers.

time:
2017-02-27T20:31:19Z
class:
core/src/main/java/org/elasticsearch/action/TaskOperationFailure.java
comments:
Changed TaskOperationFailure#getCause() return type from Trowable to Exception.

time:
2017-02-27T19:38:29Z
class:
comments:
Docs: corrected "and" --> "an" (#23376)

time:
2017-02-27T19:38:28Z
class:
comments:
Docs: Corrected definition of type param of children agg (#23377)

time:
2017-02-27T17:39:04Z
class:
core/src/main/java/org/apache/lucene/queryparser/classic/MapperQueryParser.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/index/analysis/PatternReplaceCharFilterFactory.java
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHits.java
core/src/main/java/org/elasticsearch/search/profile/query/ProfileScorer.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggester.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryParserTests.java
core/src/test/java/org/elasticsearch/index/search/ESToParentBlockJoinQueryTests.java
test/framework/src/main/java/org/elasticsearch/AnalysisFactoryTestCase.java
comments:
Upgrade to lucene-6.5.0-snapshot-d00c5ca (#23385)

Lucene upgrade

time:
2017-02-27T17:21:28Z
class:
comments:
Tests: Add platformTest to vagrant (#23339)

This change adds a new test task, platformTest, which runs `gradle test
integTest` within a vagrant host. This will allow us to still test on
all the supported platforms, but be able to standardize on the tools
provided in the host system, for example, with a modern version of git
that can allow #22946.

In order to have sufficient memory and cpu to run the tests, the
vagrantfile has been updated to use 8GB and 4 cpus by default. This can
be customized with the `VAGRANT_MEMORY` and `VAGRANT_CPUS` environment
variables.  Also, to save time to show this can work, it currently uses
the same Vagrantfile the packaging tests do. There are a lot of cleanups
we can do to how the gradle-vagrant tasks work, including generating
Vagrantfile altogether, but I think this is fine for now as the same
machines that would run platformTest run packagingTest, and they are
relatively beefy machines, so the higher memory and cpu for them, with
either task, should not be an issue.

time:
2017-02-27T17:14:21Z
class:
core/src/main/java/org/elasticsearch/common/logging/DeprecationLogger.java
core/src/main/java/org/elasticsearch/common/util/concurrent/ThreadContext.java
core/src/test/java/org/elasticsearch/common/logging/DeprecationLoggerTests.java
core/src/test/java/org/elasticsearch/common/util/concurrent/ThreadContextTests.java
plugins/discovery-azure-classic/src/main/java/org/elasticsearch/plugin/discovery/azure/classic/AzureDiscoveryPlugin.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/plugin/discovery/ec2/Ec2DiscoveryPlugin.java
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/AwsS3ServiceImplTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3RepositoryTests.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/DoSection.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/section/DoSectionTests.java
comments:
Correct warning header to be compliant

The warning header used by Elasticsearch for delivering deprecation
warnings has a specific format (RFC 7234, section 5.5). The format
specifies that the warning header should be of the form

    warn-code warn-agent warn-text [warn-date]

Here, the warn-code is a three-digit code which communicates various
meanings. The warn-agent is a string used to identify the source of the
warning (either a host:port combination, or some other identifier). The
warn-text is quoted string which conveys the semantic meaning of the
warning. The warn-date is an optional quoted date that can be in a few
different formats.

This commit corrects the warning header within Elasticsearch to follow
this specification. We use the warn-code 299 which means a
"miscellaneous persistent warning." For the warn-agent, we use the
version of Elasticsearch that produced the warning. The warn-text is
unchanged from what we deliver today, but is wrapped in quotes as
specified (this is important as a problem that exists today is that
multiple warnings can not be split by comma to obtain the individual
warnings as the warnings might themselves contain commas). For the
warn-date, we use the RFC 1123 format.

Relates #23275
This changed our test behavior. We have now to give the exact message instead of a substring.
It fails in repositoty-s3 tests for instance. 

time:
2017-02-27T14:42:25Z
class:
core/src/main/java/org/elasticsearch/search/suggest/Suggest.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestion.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestion.java
core/src/main/java/org/elasticsearch/search/suggest/term/TermSuggestion.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestTests.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestionEntryTests.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestionTests.java
comments:
Convert suggestion response parsing to use NamedXContentRegistry (#23355)

We recently added parsing code to parse suggesters responses into java api objects. This was done using a switch based on the type of the returned suggestion. We can now replace the switch with using NamedXContentRegistry, which will also be used for aggs parsing.

time:
2017-02-27T13:44:18Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalTerms.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/TermsDocCountErrorIT.java
comments:
Fixes terms error count for multiple reduce phases

Previously when multiple reduces occured for the terms aggregation we would add up the errors for the aggregations but would not take into account the errors that had already been calculated for the previous reduce phases.

This change corrects that by adding the previously created errors to the new error value.

Closes #23286

time:
2017-02-27T11:27:03Z
class:
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/ApiCallSection.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/DoSection.java
comments:
[TEST]  make headers case-insensitive when running yaml tests

time:
2017-02-27T11:27:03Z
class:
docs/src/test/java/org/elasticsearch/smoketest/DocsClientYamlTestSuiteIT.java
qa/backwards-5.0/src/test/java/org/elasticsearch/backwards/Backwards50ClientYamlTestSuiteIT.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestExecutionContext.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ESClientYamlSuiteTestCase.java
comments:
[TEST] randomize request content_type between all of the supported formats

time:
2017-02-27T11:27:03Z
class:
modules/transport-netty4/src/test/java/org/elasticsearch/rest/Netty4BadRequestIT.java
qa/backwards-5.0/src/test/java/org/elasticsearch/backwards/IndexingIT.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestResponse.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ObjectPath.java
test/framework/src/test/java/org/elasticsearch/test/rest/yaml/ObjectPathTests.java
comments:
[TEST] add support for binary responses to REST tests infra

time:
2017-02-27T11:27:03Z
class:
comments:
[TEST] don't check exact size in mapper-size yaml test

Rather test that the size is present and greather than zero. The actual size depends on the content-type, which is randomized.

time:
2017-02-27T11:27:03Z
class:
comments:
[TEST] move test for binary field to specific test file that sets Content-Type header explicitly

time:
2017-02-27T11:27:03Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/FiltersAggsRewriteIT.java
comments:
[TEST] move filters aggs wrapper query builder rewriting test to integ tests

This test makes little sense when sent from the REST layer, as WrapperQueryBuilder is supposed to be used from the Java api. Also, providing the inner query as base64 string will work only for string formats and break for binary formats like SMILE and CBOR, whcih doesn't play well with randomizing content type in our REST tests

time:
2017-02-27T11:27:03Z
class:
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestExecutionContext.java
comments:
[TEST] create HttpEntity earlier in REST tests

This allows to set content-type together with the body itself. At the moment it is always json, but this change allows makes it easier to randomize it later

time:
2017-02-27T11:27:03Z
class:
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/DoSection.java
comments:
[TEST] Remove content type auto-detection while parsing request body in REST tests

time:
2017-02-27T10:44:41Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/test/java/org/elasticsearch/action/search/SearchPhaseControllerTests.java
comments:
Factor out filling of TopDocs in SearchPhaseController (#23380)

Previously this code was duplicated across the 3 different topdocs variants
we have. It also had no real unittest (where we tested with holes in the results)
which caused a sneaky bug where the comparison used `result.size()` vs `results.size()`
causing several NPEs downstream. This change adds a static method to fill the top docs
that is shared across all variants and adds a unittest that would have caught the issue
very quickly.

Closes #19356
Closes #23357

time:
2017-02-27T10:43:56Z
class:
client/rest-high-level/src/main/java/org/elasticsearch/client/Request.java
client/rest-high-level/src/main/java/org/elasticsearch/client/RestHighLevelClient.java
client/rest-high-level/src/test/java/org/elasticsearch/client/ESRestHighLevelClientTestCase.java
client/rest-high-level/src/test/java/org/elasticsearch/client/PingAndInfoIT.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RequestTests.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RestHighLevelClientTests.java
comments:
Add info method to High Level Rest client (#23350)

This commit adds support for an info() method to the High Level Rest
client that returns the cluster information usually obtained by performing a
`GET hostname:9200` request.

time:
2017-02-27T08:45:10Z
class:
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
comments:
Prevent negative `from` parameter in SearchSourceBuilder (#23358)

This prevents later errors like the one reported in #23324 and throws an
IllegalArgumentException early instead.

time:
2017-02-26T18:15:33Z
class:
core/src/test/java/org/elasticsearch/indices/recovery/IndexPrimaryRelocationIT.java
comments:
reduce the number of iterations in testPrimaryRelocationWhileIndexing and flush every 5

Without flushing the translog doubles it's size on every recovery

time:
2017-02-26T11:30:57Z
class:
core/src/test/java/org/elasticsearch/client/transport/NodeDisconnectIT.java
comments:
rollback unneeded change in testNotifyOnDisconnect

time:
2017-02-26T11:20:34Z
class:
core/src/test/java/org/elasticsearch/client/transport/NodeDisconnectIT.java
comments:
disable sampling in testNotifyOnDisconnect

the background activity confuses the test

time:
2017-02-25T04:20:17Z
class:
core/src/main/java/org/elasticsearch/cli/Terminal.java
core/src/test/java/org/elasticsearch/cli/TerminalTests.java
test/framework/src/main/java/org/elasticsearch/cli/MockTerminal.java
comments:
CLI: Fix prompting for yes/no to handle console returning null (#23320)

Console.readText may return null in certain cases. This commit fixes a
bug in Terminal.promptYesNo which assumed a non-null return value.  It
also adds a test for this, and modifies mock terminal to be able to
handle null input values.

time:
2017-02-25T03:40:28Z
class:
comments:
Tests: Fix reproduce line for packagingTest (#23365)

This commit fixes the reproduce line output when the vagrant packagingTest
fails. Before only the `gradle packagingTest` would be output, but the
seed and list of versions was swallowed by groovy with an ancillary
failure (due to the `+` being on the wrong line for a string
continuation).  With the new reproduce line, it is now output next to
the task right after failure, contains the actual task (specific to the
box that fails), and contains the seed. It also no longer contains the
upgrade versions list, as the seed is used to determine which of those
to use, and the same file would be read when testing a failure on a
particular git commit. Finally, this also ties bats test setup directly
to packagingTest, instead of to the vagrant up command.

time:
2017-02-24T22:40:07Z
class:
comments:
Build: Remove extra copies of netty license (#23361)

The dependencyLicenses check has the ability to map multiple jar files
to the same license file. However, netty was not taking advantage of
this, and had duplicate copies of its license/notice files for each jar.
This commit reduces the copies to one and uses the mapping feature.

time:
2017-02-24T19:55:42Z
class:
comments:
[TEST] Removes timeout based wait_for_active_shards REST test (#23360)

This commit removes an necessary test that ensures if
wait_for_active_shards cannot be fulfilled on index creation, that the
response returns shardsAcknowledged=false.  However, this is already
tested in WaitForActiveShardsIT and it would improve the speed of the
test runs to get rid of any unnecessary tests, especially those that
depend on timeouts.

time:
2017-02-24T17:51:45Z
class:
comments:
[TEST] increase timeout slightly in wait_for_active_shards test to allow
for index creation cluster state update to be processed before ensuring
the wait times out

time:
2017-02-24T16:38:18Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/DocumentationIT.java
comments:
Extract documentation from test code

time:
2017-02-24T15:14:22Z
class:
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
comments:
Handle snapshot repository's missing index.latest

If index.latest does not exist, the repository is on an older
version so simply return the empty repository's generation id.

time:
2017-02-24T13:58:03Z
class:
core/src/main/java/org/elasticsearch/action/main/MainResponse.java
core/src/test/java/org/elasticsearch/action/main/MainResponseTests.java
comments:
Adding equals/hashCode to MainResponse (#23352)

time:
2017-02-24T13:21:04Z
class:
core/src/main/java/org/elasticsearch/index/shard/IndexShardOperationsLock.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardOperationsLockTests.java
comments:
Always restore the ThreadContext for operations delayed due to a block (#23349)

The IndexShardOperationsLock has a mechanism to delay operations if there is currently a block on the lock. These
delayed operations are executed when the block is released and are executed by a different thread. When the different
thread executes the operations, the ThreadContext is that of the thread that was blocking operations. In order to
preserve the ThreadContext, we need to store it and wrap the listener when the operation is delayed.

time:
2017-02-24T12:52:36Z
class:
comments:
Add first High level client documentation

The REST Client is split into 2 parts:

* Low level
* High level

The High level client has a main common section and the document delete API documentation as a start.

time:
2017-02-24T10:52:56Z
class:
client/rest-high-level/src/main/java/org/elasticsearch/client/RestHighLevelClient.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RestHighLevelClientExtTests.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RestHighLevelClientTests.java
comments:
Merge remote-tracking branch 'origin/master'

# Conflicts:
#	client/rest-high-level/src/main/java/org/elasticsearch/client/RestHighLevelClient.java

time:
2017-02-24T10:47:28Z
class:
client/rest-high-level/src/main/java/org/elasticsearch/client/Request.java
client/rest-high-level/src/main/java/org/elasticsearch/client/RestHighLevelClient.java
client/rest-high-level/src/test/java/org/elasticsearch/client/CrudIT.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RequestTests.java
comments:
Merge branch 'hlclient/add-delete-method'

time:
2017-02-24T10:46:59Z
class:
client/rest-high-level/src/main/java/org/elasticsearch/client/RestHighLevelClient.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RestHighLevelClientExtTests.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RestHighLevelClientTests.java
comments:
Add support for named xcontent parsers to high level REST client (#23328)

NamedXContentRegistry will be used by the high level REST client to parse aggregation responses, and any section whose class type depends on a json key. There are currently on entries in the standard registry, but soon aggs and most likely suggesters will be added. Also it is possible for subclasses to provide additional named xcontent parsers.

time:
2017-02-24T09:29:31Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/children/ParentToChildrenAggregatorTests.java
comments:
Add unit tests for ParentToChildAggregator (#23305)

Adds unit tests for the `children` aggregation.
This change also add the ability to mock Mapperservice in subtests of
AggregatorTestCase.

time:
2017-02-24T08:23:03Z
class:
core/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java
core/src/main/java/org/elasticsearch/indices/analysis/PreBuiltTokenFilters.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/AbstractHighlighterBuilder.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/FastVectorHighlighter.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilder.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/SearchContextHighlight.java
core/src/test/java/org/apache/lucene/analysis/synonym/SynonymGraphFilterTests.java
core/src/test/java/org/elasticsearch/index/analysis/BaseWordDelimiterTokenFilterFactoryTestCase.java
core/src/test/java/org/elasticsearch/index/analysis/WordDelimiterGraphTokenFilterFactoryTests.java
core/src/test/java/org/elasticsearch/index/analysis/WordDelimiterTokenFilterFactoryTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilderTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java
plugins/ingest-geoip/src/main/java/org/elasticsearch/ingest/geoip/DatabaseReaderLazyLoader.java
plugins/ingest-geoip/src/main/java/org/elasticsearch/ingest/geoip/GeoIpProcessor.java
plugins/ingest-geoip/src/main/java/org/elasticsearch/ingest/geoip/IngestGeoIpPlugin.java
plugins/ingest-geoip/src/test/java/org/elasticsearch/ingest/geoip/GeoIpProcessorFactoryTests.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/AwsS3ServiceImplTests.java
comments:
Merge branch 'master' into hlclient/add-delete-method

time:
2017-02-24T08:19:39Z
class:
client/rest-high-level/src/main/java/org/elasticsearch/client/RestHighLevelClient.java
client/rest-high-level/src/test/java/org/elasticsearch/client/CrudIT.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RequestTests.java
comments:
Fix after last merge with master and apply last comments

time:
2017-02-24T07:58:22Z
class:
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/search/TransportNoopSearchAction.java
client/rest-high-level/src/main/java/org/elasticsearch/client/Request.java
client/rest-high-level/src/main/java/org/elasticsearch/client/RestHighLevelClient.java
client/rest-high-level/src/test/java/org/elasticsearch/client/CrudIT.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RequestTests.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RestHighLevelClientTests.java
client/rest/src/test/java/org/elasticsearch/client/HeapBufferedAsyncResponseConsumerTests.java
client/rest/src/test/java/org/elasticsearch/client/RequestLoggerTests.java
client/rest/src/test/java/org/elasticsearch/client/ResponseExceptionTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostIntegTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostTests.java
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/repositories/put/PutRepositoryRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/repositories/put/PutRepositoryRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/settings/ClusterUpdateSettingsRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/settings/ClusterUpdateSettingsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/create/CreateSnapshotRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/create/CreateSnapshotRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/RestoreSnapshotRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/RestoreSnapshotRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/PutStoredScriptRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/PutStoredScriptRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/put/UpdateSettingsRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/put/UpdateSettingsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestBuilder.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequestBuilder.java
core/src/main/java/org/elasticsearch/action/bulk/BulkResponse.java
core/src/main/java/org/elasticsearch/action/bulk/BulkShardRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkShardResponse.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/delete/DeleteResponse.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/index/IndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/index/IndexResponse.java
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/CountedCollector.java
core/src/main/java/org/elasticsearch/action/search/DfsQueryPhase.java
core/src/main/java/org/elasticsearch/action/search/FetchSearchPhase.java
core/src/main/java/org/elasticsearch/action/search/InitialSearchPhase.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseContext.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchRequest.java
core/src/main/java/org/elasticsearch/action/search/SearchRequestBuilder.java
core/src/main/java/org/elasticsearch/action/search/SearchResponse.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicatedWriteRequest.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationResponse.java
core/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequestBuilder.java
core/src/main/java/org/elasticsearch/action/update/UpdateResponse.java
core/src/main/java/org/elasticsearch/cluster/action/index/MappingUpdatedAction.java
core/src/main/java/org/elasticsearch/common/Strings.java
core/src/main/java/org/elasticsearch/common/blobstore/BlobPath.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentHelper.java
core/src/main/java/org/elasticsearch/discovery/zen/MembershipAction.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/http/HttpTransportSettings.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/EngineConfig.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/mapper/GeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IdFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IpFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/StringFieldType.java
core/src/main/java/org/elasticsearch/index/mapper/TermBasedFieldType.java
core/src/main/java/org/elasticsearch/index/mapper/TypeFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/IdsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/seqno/SequenceNumbers.java
core/src/main/java/org/elasticsearch/index/translog/BaseTranslogReader.java
core/src/main/java/org/elasticsearch/index/translog/Checkpoint.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/index/translog/TranslogReader.java
core/src/main/java/org/elasticsearch/index/translog/TranslogSnapshot.java
core/src/main/java/org/elasticsearch/index/translog/TranslogWriter.java
core/src/main/java/org/elasticsearch/index/translog/TruncateTranslogCommand.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/monitor/fs/FsInfo.java
core/src/main/java/org/elasticsearch/monitor/fs/FsProbe.java
core/src/main/java/org/elasticsearch/monitor/os/OsProbe.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/rest/RestController.java
core/src/main/java/org/elasticsearch/rest/RestHandler.java
core/src/main/java/org/elasticsearch/rest/RestRequest.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestThreadPoolAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestBulkAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestDeleteAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestGetAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestHeadAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestUpdateAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestClearScrollAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchScrollAction.java
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/script/StoredScriptSource.java
core/src/main/java/org/elasticsearch/search/SearchHit.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/InternalSingleBucketAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/InternalGeoHashGrid.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/BinaryRangeAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/InternalBinaryRange.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/InternalSampler.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/InternalSignificantTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalMappedTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/LongTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/StringTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/InternalNumericMetricsAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/InternalGeoBounds.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/InternalGeoCentroid.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/InternalScriptedMetric.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/InternalStats.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ExtendedStatsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/InternalExtendedStats.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHits.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchResponse.java
core/src/main/java/org/elasticsearch/search/suggest/Suggest.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestion.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestion.java
core/src/main/java/org/elasticsearch/search/suggest/term/TermSuggestion.java
core/src/main/java/org/elasticsearch/tasks/TaskResultsService.java
core/src/main/java/org/elasticsearch/threadpool/ThreadPool.java
core/src/test/java/org/elasticsearch/ElasticsearchExceptionTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/get/GetIndexIT.java
core/src/test/java/org/elasticsearch/action/bulk/BulkItemResponseTests.java
core/src/test/java/org/elasticsearch/action/bulk/BulkRequestTests.java
core/src/test/java/org/elasticsearch/action/bulk/BulkResponseTests.java
core/src/test/java/org/elasticsearch/action/bulk/BulkWithUpdatesIT.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/AsyncBulkByScrollActionTests.java
core/src/test/java/org/elasticsearch/action/delete/DeleteResponseTests.java
core/src/test/java/org/elasticsearch/action/index/IndexRequestTests.java
core/src/test/java/org/elasticsearch/action/index/IndexResponseTests.java
core/src/test/java/org/elasticsearch/action/search/CountedCollectorTests.java
core/src/test/java/org/elasticsearch/action/search/DfsQueryPhaseTests.java
core/src/test/java/org/elasticsearch/action/search/ExpandSearchPhaseTests.java
core/src/test/java/org/elasticsearch/action/search/FetchSearchPhaseTests.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
core/src/test/java/org/elasticsearch/action/search/SearchPhaseControllerTests.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationResponseTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateResponseTests.java
core/src/test/java/org/elasticsearch/cluster/SpecificMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataMappingServiceTests.java
core/src/test/java/org/elasticsearch/common/blobstore/BlobPathTests.java
core/src/test/java/org/elasticsearch/common/lucene/index/FreqTermsEnumTests.java
core/src/test/java/org/elasticsearch/gateway/GatewayIndexStateIT.java
core/src/test/java/org/elasticsearch/gateway/RecoveryFromGatewayIT.java
core/src/test/java/org/elasticsearch/get/GetActionIT.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/mapper/CamelCaseFieldNameTests.java
core/src/test/java/org/elasticsearch/index/mapper/CopyToMapperIntegrationIT.java
core/src/test/java/org/elasticsearch/index/mapper/CopyToMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentParserTests.java
core/src/test/java/org/elasticsearch/index/mapper/DoubleIndexingDocTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicTemplatesTests.java
core/src/test/java/org/elasticsearch/index/mapper/GenericStoreDynamicTemplateTests.java
core/src/test/java/org/elasticsearch/index/mapper/GeoPointFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/KeywordFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
core/src/test/java/org/elasticsearch/index/mapper/PathMatchDynamicTemplateTests.java
core/src/test/java/org/elasticsearch/index/mapper/TextFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/UpdateMappingOnClusterIT.java
core/src/test/java/org/elasticsearch/index/query/HasChildQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/IdsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/TermsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java
core/src/test/java/org/elasticsearch/index/seqno/SequenceNumbersTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogVersionTests.java
core/src/test/java/org/elasticsearch/indices/mapping/ConcurrentDynamicTemplateIT.java
core/src/test/java/org/elasticsearch/indices/mapping/UpdateMappingIntegrationIT.java
core/src/test/java/org/elasticsearch/indices/memory/breaker/RandomExceptionCircuitBreakerIT.java
core/src/test/java/org/elasticsearch/indices/state/OpenCloseIndexIT.java
core/src/test/java/org/elasticsearch/indices/stats/IndexStatsIT.java
core/src/test/java/org/elasticsearch/indices/store/IndicesStoreIntegrationIT.java
core/src/test/java/org/elasticsearch/indices/template/SimpleIndexTemplateIT.java
core/src/test/java/org/elasticsearch/monitor/fs/FsProbeTests.java
core/src/test/java/org/elasticsearch/monitor/os/OsProbeTests.java
core/src/test/java/org/elasticsearch/rest/RestControllerTests.java
core/src/test/java/org/elasticsearch/rest/RestRequestTests.java
core/src/test/java/org/elasticsearch/routing/PartitionedRoutingIT.java
core/src/test/java/org/elasticsearch/script/IndexLookupIT.java
core/src/test/java/org/elasticsearch/script/ScriptTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/MinDocCountIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/TermsDocCountErrorIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/children/InternalChildrenTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/InternalBinaryRangeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/IpRangeAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/significant/SignificanceHeuristicTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/InternalTermsTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/LongTermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/StringTermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ExtendedStatsAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalExtendedStatsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalStatsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/StatsAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvgTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/geobounds/GeoBoundsAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/geobounds/InternalGeoBoundsTests.java
core/src/test/java/org/elasticsearch/search/basic/SearchWithRandomExceptionsIT.java
core/src/test/java/org/elasticsearch/search/basic/SearchWithRandomIOExceptionsIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java
core/src/test/java/org/elasticsearch/search/fields/SearchFieldsIT.java
core/src/test/java/org/elasticsearch/search/functionscore/DecayFunctionScoreIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoFilterIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoShapeIntegrationIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoShapeQueryTests.java
core/src/test/java/org/elasticsearch/search/morelikethis/MoreLikeThisIT.java
core/src/test/java/org/elasticsearch/search/query/SimpleQueryStringIT.java
core/src/test/java/org/elasticsearch/search/slice/SearchSliceIT.java
core/src/test/java/org/elasticsearch/search/sort/SimpleSortIT.java
core/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchIT.java
core/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestionOptionTests.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestTests.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestionEntryTests.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestionTests.java
core/src/test/java/org/elasticsearch/threadpool/ThreadPoolTests.java
distribution/integ-test-zip/src/test/java/org/elasticsearch/test/rest/WaitForRefreshAndCloseTests.java
distribution/tools/java-version-checker/src/main/java/org/elasticsearch/tools/JavaVersionChecker.java
distribution/tools/java-version-checker/src/main/java/org/elasticsearch/tools/SuppressForbidden.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/matrix/stats/InternalMatrixStats.java
comments:
Merge branch 'master' into hlclient/add-delete-method

# Conflicts:
#	client/rest-high-level/src/main/java/org/elasticsearch/client/Request.java
#	client/rest-high-level/src/main/java/org/elasticsearch/client/RestHighLevelClient.java
#	client/rest-high-level/src/test/java/org/elasticsearch/client/CrudIT.java
#	client/rest-high-level/src/test/java/org/elasticsearch/client/RequestTests.java

time:
2017-02-24T07:52:27Z
class:
plugins/ingest-geoip/src/main/java/org/elasticsearch/ingest/geoip/DatabaseReaderLazyLoader.java
plugins/ingest-geoip/src/main/java/org/elasticsearch/ingest/geoip/GeoIpProcessor.java
plugins/ingest-geoip/src/main/java/org/elasticsearch/ingest/geoip/IngestGeoIpPlugin.java
plugins/ingest-geoip/src/test/java/org/elasticsearch/ingest/geoip/GeoIpProcessorFactoryTests.java
comments:
[INGEST] Lazy load the geoip databases.

Load the geoip database the first time a pipeline gets created that has a geoip processor.
This saves memory (measured ~150MB for the city db) in cases when the plugin is installed, but not used.

time:
2017-02-24T07:50:39Z
class:
comments:
disable BWC tests for the highlighters, need a new 5.x build to make it work

time:
2017-02-23T23:53:38Z
class:
core/src/main/java/org/elasticsearch/indices/analysis/AnalysisModule.java
core/src/main/java/org/elasticsearch/indices/analysis/PreBuiltTokenFilters.java
core/src/test/java/org/apache/lucene/analysis/synonym/SynonymGraphFilterTests.java
core/src/test/java/org/elasticsearch/index/analysis/BaseWordDelimiterTokenFilterFactoryTestCase.java
core/src/test/java/org/elasticsearch/index/analysis/WordDelimiterGraphTokenFilterFactoryTests.java
core/src/test/java/org/elasticsearch/index/analysis/WordDelimiterTokenFilterFactoryTests.java
comments:
Expose WordDelimiterGraphTokenFilter (#23327)

This change exposes the new Lucene graph based word delimiter token filter in the analysis filters.
Unlike the `word_delimiter` this token filter named `word_delimiter_graph` correctly handles multi terms expansion at query time.

Closes #23104

time:
2017-02-23T23:33:15Z
class:
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/AwsS3ServiceImplTests.java
comments:
Test that buildCredentials returns correct clazz (#23334)

This is fallout from #23297. That commit wrapped
`InstanceProfileCredentialsProvider` to ensure that the `getCredentials`
and `refresh` methods had privileged access. However, it looks like
there was a test ensuring that `buildCredentials` returned the correct
clazz type. This commit adjusts that test to check that the correct
wrapper is returned.

time:
2017-02-23T22:32:22Z
class:
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/AbstractHighlighterBuilder.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/FastVectorHighlighter.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilder.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/SearchContextHighlight.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightBuilderTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java
comments:
Add BreakIteratorBoundaryScanner support for FVH (#23248)

This commit adds a boundary_scanner property to the search highlight
request so the user can specify different boundary scanners:

* `chars` (default,  current behavior)
* `word` Use a WordBreakIterator
* `sentence` Use a SentenceBreakIterator

This commit also adds "boundary_scanner_locale" to define which locale
should be used when scanning the text.

time:
2017-02-23T20:44:12Z
class:
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
comments:
Prioritize listing index-N blobs over index.latest in reading snapshots (#23333)

There are two ways to determine the latest index-N blob that contains
the truth of the contents of the repository: (1) list all index-N blobs
and figure out what the latest value of N is, and (2) read the
index.latest blob, which contains the latest value of N explicitely.
Note that the index.latest blob is not written atomically and can be
re-written, as opposed to the index-N blobs which are never re-written
(to create an updated index blob, index-{N+1} is written).

Previously, the latest index-N was determined by first trying to read
the index.latest blob and if that blob was missing (it was deleted
before being re-written and in between deleting it and re-writing it,
the system crashed), then all index-N blobs were listed to pick the
highest N value.

For non-read-only repositories, this could produce race conditions with
the file system.  In particular, it is possible that the index.latest
blob is being read in order to serve a read request (e.g. get snapshots)
and while doing so, an attempt is made to delete the index.latest blob
and re-write it in order to finalize a snapshot operation.  On some file
systems (e.g. Windows), it is forbidden to delete a file while it is
open for reading by another process/thread.

This commit changes the priority so that figuring out the latest index-N
blob is first done by listing all index-N blobs and determining the
latest N value.  If that values because the repository does not
support listing blobs (e.g. the URL repository), then the index.latest
blob is read.  This is safe because in read-only repositories that do
not support listing blobs, the index.latest blob is never deleted and
then re-written, so the aforementioned issue does not arise.

time:
2017-02-23T19:20:41Z
class:
comments:
Test: Fix hdfs test fixture setup on windows

The test setup for hdfs is a little complicated for windows, needing to
check if the hdfs fixture can be run at all. This was unfortunately not
updated when the integ tests were reorganized into separate runner and
cluster setups.

time:
2017-02-23T19:17:46Z
class:
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/pipelining/HttpPipeliningHandler.java
comments:
Keep the pipeline handler queue small initially

This commit sets the intial size of the pipeline handler queue small to
prevent waste if pipelined requests are never sent. Since the queue will
grow quickly if pipeline requests are indeed set, this should not be
problematic.

Relates #23335

time:
2017-02-23T18:57:34Z
class:
core/src/main/java/org/elasticsearch/common/Strings.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerTransportTests.java
comments:
Do not create String instances in 'Strings' methods accepting StringBuilder (#22907)

time:
2017-02-23T18:06:35Z
class:
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/AwsS3ServiceImplTests.java
comments:
Tests: fix AwsS3ServiceImplTests

time:
2017-02-23T17:03:40Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/InternalMetricsAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/InternalNumericMetricsAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/InternalGeoBounds.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geocentroid/InternalGeoCentroid.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/InternalScriptedMetric.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHits.java
modules/aggs-matrix-stats/src/main/java/org/elasticsearch/search/aggregations/matrix/stats/InternalMatrixStats.java
comments:
Remove abstract InternalMetricsAggregation class (#23326)

This class doesn't seem to do much other than to group together
certain types of aggregations.

time:
2017-02-23T15:37:26Z
class:
client/rest-high-level/src/main/java/org/elasticsearch/client/Request.java
client/rest-high-level/src/main/java/org/elasticsearch/client/RestHighLevelClient.java
client/rest-high-level/src/test/java/org/elasticsearch/client/CrudIT.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RequestTests.java
comments:
Add BulkRequest support to High Level Rest client (#23312)

This commit adds support for BulkRequest execution in the High Level Rest client.

time:
2017-02-23T14:59:42Z
class:
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
comments:
Wrap getCredentials() in a doPrivileged() block (#23297)

This commit fixes an issue that was missed in #22534.
`AWSCredentialsProvider.getCredentials()` appears to potentially open a
socket connect. This operation needed to be wrapped in `doPrivileged()`.

This should fix issue #23271.

time:
2017-02-23T14:32:43Z
class:
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpChannel.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/pipelining/HttpPipelinedRequest.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/pipelining/HttpPipelinedResponse.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/pipelining/HttpPipeliningHandler.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerPipeliningTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/pipelining/Netty4HttpPipeliningHandlerTests.java
comments:
Respect promises on pipelined responses

When pipelined responses are sent to the pipeline handler for writing,
they are not necessarily written immediately. They must be held in a
priority queue until all responses preceding the given response are
written. This means that when write is invoked on the handler, the
promise that is attached to the write invocation will not necessarily be
the promise associated with the responses that are written while the
queue is drained. To address this, the promise associated with a
pipelined response must be held with the response and then used when the
channel context is actually written to. This was introduced when
ensuring that the releasing promise is always chained through on write
calls lest the releasing promise never be invoked. This leads to many
failing test cases, so no new test cases are needed here.

Relates #23317

time:
2017-02-23T13:55:13Z
class:
comments:
Align REST specs for HEAD requests

Previous changes aligned HEAD requests to be consistent with GET
requests to the same endpoint. This commit aligns the REST spec for the
impacted endpoints.

Relates #23313
Hey @jasontedor i think `required` here needs to be `true` or if its really optional `"/template"` needs to be added to to `paths`

Happy to do the PR just double checking.
@jasontedor I agree the `HEAD` request on the removed path here does not make a whole lot of sense but on `5.x` this will constitute a breaking change for me as it removed one of my overloads, impeding on binary backwards compatibility. I can hack around this in my code generator but `get_alias` still has this endpoint too, in the spirit of making `GET` and `HEAD` equal should we add this back in?

time:
2017-02-23T12:48:54Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/test/java/org/elasticsearch/action/search/SearchPhaseControllerTests.java
comments:
Remove unnecessary result sorting in SearchPhaseController (#23321)

In oder to use lucene's utilities to merge top docs the results
need to be passed in a dense array where the index corresponds to the shard index in
the result list. Yet, we were sorting results before merging them just to order them
in the incoming order again for the above mentioned reason. This change removes the
obsolet sort and prevents unnecessary materializing of results.

time:
2017-02-23T07:08:38Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregatorTests.java
comments:
Fix SamplerAggregatorTests to have stable and predictable docIds

Closes #23315

time:
2017-02-23T04:54:58Z
class:
comments:
Tests: Ensure multi node integ tests wait on first node

When a rest integ test has multiple nodes, each node is supposed to not
start configuring itself until the first node has been started, so that
the unicast host information can be written. However, this was never
explicitly setup to occur, and we were just very lucky with the current
gradle version and stability of the code always produced a task graph
that had node0 starting first. With the recent refactorings to integ
tests, the order has changed. This commit fixes the ordering by adding
an explicit dependency between the first node and the other nodes.

time:
2017-02-23T01:51:18Z
class:
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/pipelining/HttpPipeliningHandler.java
comments:
Relocate a comment in HttpPipeliningHandler

This commit moves a comment in HttpPipeliningHandler as it makes more
sense for this comment to be where the field that it is explaining is
declared.

time:
2017-02-23T01:47:34Z
class:
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/pipelining/HttpPipeliningHandler.java
comments:
Add comments to HttpPipeliningHandler

This commit adds some comments explaining the design of
HttpPipeliningHandler.

time:
2017-02-23T00:18:11Z
class:
comments:
[TEST] Fix incorrect test cluster name in cluster health doc tests

time:
2017-02-23T00:13:50Z
class:
comments:
Build: Change location in zip of license and notice inclusion for plugins (#23316)

This commit moves the LICENSE.txt and NOTICE.txt files for each plugin
to be alongside the other plugin files, inside the elasticsearch subdir.
This ensures those files are installed alongside the plugin.

time:
2017-02-22T23:11:02Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java
core/src/main/java/org/elasticsearch/index/engine/EngineConfig.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/threadpool/ThreadPool.java
core/src/test/java/org/elasticsearch/threadpool/ThreadPoolTests.java
comments:
Script: Fix value of `ctx._now` to be current epoch time in milliseconds (#23175)

In update scripts, `ctx._now` uses the same milliseconds value used by the
rest of the system to calculate deltas. However, that time is not
actually epoch milliseconds, as it is derived from `System.nanoTime()`.
This change reworks the estimated time thread in ThreadPool which this
time is based on to make available both the relative time, as well as
absolute milliseconds (epoch) which may be used with calendar system. It
also renames the EstimatedTimeThread to a more apt CachedTimeThread.

closes #23169

time:
2017-02-22T20:43:15Z
class:
comments:
Build: Rework integ test setup and shutdown to ensure stop runs when desired (#23304)

Gradle's finalizedBy on tasks only ensures one task runs after another,
but not immediately after. This is problematic for our integration tests
since it allows multiple project's integ test clusters to be
simultaneously. While this has not been a problem thus far (gradle 2.13
happened to keep the finalizedBy tasks close enough that no clusters
were running in parallel), with gradle 3.3 the task graph generation has
changed, and numerous clusters may be running simultaneously, causing
memory pressure, and thus generally slower tests, or even failure if the
system has a limited amount of memory (eg in a vagrant host).

This commit reworks how integ tests are configured. It adds an
`integTestCluster` extension to gradle which is equivalent to the current
`integTest.cluster` and moves the rest test runner task to
`integTestRunner`.  The `integTest` task is then just a dummy task,
which depends on the cluster runner task, as well as the cluster stop
task. This means running `integTest` in one project will both run the
rest tests, and shut down the cluster, before running `integTest` in
another project.

time:
2017-02-22T20:04:34Z
class:
core/src/main/java/org/elasticsearch/monitor/fs/FsInfo.java
core/src/main/java/org/elasticsearch/monitor/fs/FsProbe.java
core/src/test/java/org/elasticsearch/monitor/fs/FsProbeTests.java
comments:
Handle long overflow when adding paths' totals

From #23093, we fixed the issue where a filesystem can be so large that it
overflows and returns a negative number. However, there is another issue when
adding a path as a sub-path to another `FsInfo.Path` object, when adding the
totals the values can still overflow.

This adds the same safety to return `Long.MAX_VALUE` instead of the negative
number, as well as a test exercising the logic.

time:
2017-02-22T19:27:27Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/MembershipAction.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
comments:
Don't set local node on cluster state used for node join validation (#23311)

When a node wants to join a cluster, it sends a join request to the master. The master then sends a join validation request to the node. This checks that the node can deserialize the current cluster state that exists on the master and that it can thus handle all the indices that are currently in the cluster (see #21830).

The current code can trip an assertion as it does not take the cluster state as is but sets itself as the local node on the cluster state. This can result in an inconsistent DiscoveryNodes object as the local node is not yet part of the cluster state and a node with same id but different address can still exist in the cluster state. Also another node with the same address but different id can exist in the cluster state if multiple nodes are run on the same machine and ports have been swapped after node crashes/restarts.

time:
2017-02-22T18:54:17Z
class:
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpChannel.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/pipelining/HttpPipelinedRequest.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/pipelining/HttpPipelinedResponse.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/pipelining/HttpPipeliningHandler.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpChannelTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerPipeliningTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/pipelining/Netty4HttpPipeliningHandlerTests.java
comments:
Ensure that releasing listener is called

When sending a response to a client, we attach a releasing listener to
the channel promise. If the client disappears before the response is
sent, the releasing listener was never notified. The reason the
listeners were never notified was due to a mistaken invocation of write
and flush on the channel which has two overrides: one that takes an
existing promise, and one that does not and instead creates a new
promise. When the client disappears, it is this latter promise that is
notified, which does not contain the releasing listener. This commit
addreses this issue by invoking the override that passes our channel
promise through.

Relates #23310

time:
2017-02-22T17:11:05Z
class:
core/src/test/java/org/elasticsearch/indices/store/IndicesStoreIntegrationIT.java
comments:
[TEST] Add additional logging to IndicesStoreIntegrationIT.testIndexCleanup

time:
2017-02-22T16:51:10Z
class:
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestUpdateSettingsAction.java
comments:
Update indices settings api to support CBOR and SMILE format (#23309)

Also expand testing on the different ways to provide index settings and remove dead code around ability to provide settings as query string parameters

Closes #23242

time:
2017-02-22T15:20:53Z
class:
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/SearchTemplateResponse.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TransportSearchTemplateAction.java
comments:
Remove content type auto-detection from search templates

Now that search templates always get converted to json, we don't need to try and auto-detect their content-type, which anyways didn't work as expected before given that only json was really working.

time:
2017-02-22T15:20:53Z
class:
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/script/StoredScriptSource.java
core/src/test/java/org/elasticsearch/script/ScriptTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestSearchTemplateAction.java
comments:
Convert script/template objects to json format

Elasticsearch accepts multiple content-type formats, hence scripts can be stored/provided in json, yaml, cbor or smile. Yet the format that should be used internally is json. This is a problem mainly around search templates, as they only support json out of the four content-types, so instead of maintaining the content-type of the request we should rather convert the scripts/templates to json.

 Binary formats were not previously supported. If you stored a template in yaml format, you'd get back an error "No encoder found for MIME type [application/yaml]" when trying to execute it. With this commit the request content-type is independent from the template, which always gets converted to json internally. That is transparent to users and doesn't affect the content type of the response obtained when executing the template.

time:
2017-02-22T15:20:53Z
class:
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/CustomMustacheFactory.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/MustacheScriptEngineService.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/CustomMustacheFactoryTests.java
comments:
Replace CustomMustacheFactory constant with same constant from Script (CONTENT_TYPE_OPTION)

time:
2017-02-22T14:03:09Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchRequest.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchResponse.java
comments:
Remove BWC layer for number of reduce phases (#23303)

Both PRs below have been backported to 5.4 such that we can enable
BWC tests of this feature as well as remove version dependend serialization
for search request / responses.

Relates to #23288
Relates to #23253

time:
2017-02-22T10:54:54Z
class:
client/rest-high-level/src/main/java/org/elasticsearch/client/Request.java
client/rest-high-level/src/main/java/org/elasticsearch/client/RestHighLevelClient.java
client/rest-high-level/src/test/java/org/elasticsearch/client/CrudIT.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RequestTests.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RestHighLevelClientTests.java
comments:
Add UpdateRequest support to High Level Rest client (#23266)

This commit adds support for UpdateRequest to the High Level Rest client

time:
2017-02-22T10:06:27Z
class:
comments:
Update getting-started.asciidoc (#23296)

time:
2017-02-22T08:18:10Z
class:
comments:
Documentation: Consoleify cat shards/recovery API docs (#23116)

Relates #23001

time:
2017-02-22T08:04:55Z
class:
core/src/main/java/org/elasticsearch/common/blobstore/BlobPath.java
core/src/test/java/org/elasticsearch/common/blobstore/BlobPathTests.java
comments:
Handle BlobPath's trailing separator case (#23091)

time:
2017-02-21T22:41:22Z
class:
core/src/main/java/org/elasticsearch/action/bulk/BulkItemRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkShardRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkShardResponse.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicatedWriteRequest.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java
qa/backwards-5.0/src/test/java/org/elasticsearch/backwards/IndexingIT.java
comments:
Make document write requests immutable (#23038)

* Make document write requests immutable

Previously, write requests were mutated at the
transport level to update request version, version type
and sequence no before replication.
Now that all write requests go through the shard bulk
transport action, we can use the primary response stored
in item level bulk requests to pass the updated version,
seqence no. to replicas.

* incorporate feedback

* minor cleanup

* Add bwc test to ensure correct index version propagates to replica

* Fix bwc for propagating write operation versions

* Add assertion on replica request version type

* fix tests using internal version type for replica op

* Fix assertions to assert version type in replica and recovery

* add bwc tests for version checks in concurrent indexing

* incorporate feedback

time:
2017-02-21T22:10:55Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/Locals.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/ScriptInterface.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SSource.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ImplementInterfacesTests.java
comments:
Fix Painless's implementation of interfaces returning primitives (#23298)

Fixes Painless to properly implement scripts that return primitives
and void. Adds some simple tests that we emit sane opcodes and some
other tests that we implement primitives as expected.

Mostly this is just a fix following up from #22983 but there is one
thing I did really worth talking about, I think. So, before this script
Painless scripts could only ever return Object and they did would always
return null for paths that didn't return any values. Now that they
can return primitives the question is "what should Painless return
from paths that don't return any values?" And I answered that with
"whatever the JLS default value is". So 0/0L/0f/0d/false.

time:
2017-02-21T21:41:49Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
comments:
Remote assertion that relies on all shards being successful

The assertion that if there are buffered aggs at least one incremental
reduce phase should have happened doens't hold if there are shard failure.
This commit removes this assertion.

Relates to #23288

time:
2017-02-21T20:10:55Z
class:
modules/percolator/src/main/java/org/elasticsearch/percolator/QueryAnalyzer.java
modules/percolator/src/test/java/org/elasticsearch/percolator/QueryAnalyzerTests.java
comments:
percolator: add support for term extraction for MultiPhraseQuery

time:
2017-02-21T19:08:57Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/Compiler.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Executable.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/GenericElasticsearchScript.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Locals.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Location.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/PainlessExplainError.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/PainlessScript.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/PainlessScriptEngineService.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/ScriptImpl.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/ScriptInterface.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/WriterConstants.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/antlr/Walker.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SFunction.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/node/SSource.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/Debugger.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ImplementInterfacesTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/ScriptTestCase.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/node/NodeToStringTests.java
comments:
Allow painless to implement more interfaces (#22983)

Generalizes three previously hard coded things in painless into
generic concepts:

1. The "main method" is no longer hardcoded to:
```
public abstract Object execute(Map<String, Object> params,
        Scorer scorer, LeafDocLookup doc, Object value);
```
Instead Painless's compiler takes an interface and implements it. It looks like:
```
public interface SomeScript {
    // Argument names we expose to Painless scripts
    String[] ARGUMENTS = new String[] {"a", "b"};
    // Method implemented by Painless script. Must be named execute but can have any parameters or return any value.
    Object execute(String a, int b);
    // Is the "a" argument used by the script?
    boolean uses$a();
}
SomeScript script = scriptEngine.compile(SomeScript.class, null, "the_script_here", emptyMap());
Object result = script.execute("a", 1);
```

`PainlessScriptEngine` now compiles all scripts to the new
`GenericElasticsearchScript` interface by default for compatibility
with the rest of Elasticsearch until it is able to use this new
ability.

2. `_score` and `ctx` are no longer hardcoded to be extracted from
`#score` and `params` respectively. Instead Painless's default
implementation of Elasticsearch scripts uses the `uses$_score` and
`uses$ctx` methods to determine if it is used and gives them
dummy values if they are not used.

3. Throwing the `ScriptException` is now handled by the Painless
script itself. That way Painless doesn't have to leak the metadata
that is required to build the fancy stack trace. And all painless scripts
get the fancy stack trace.

time:
2017-02-21T18:23:27Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/AnalyzerCaster.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Definition.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/MethodWriter.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/CastTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/FunctionTests.java
comments:
Fix certain bad casts in Painless due to boxing/unboxing. (#23282)

time:
2017-02-21T17:51:47Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregatorTests.java
comments:
Adds unit test for sampler aggregation (#23243)

* Adds unit test for sampler aggregation

Relates to #22278

time:
2017-02-21T17:48:28Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
comments:
Revert "Never reduce the same agg twice"

This change reverts 5e4ba4a60ecc1169e86c1dd517ed05a225c5278b
Incremental reduction of aggs should also work with a single aggregation now that InternalTopHits.equals
 is fixed.

time:
2017-02-21T17:36:59Z
class:
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/search/TransportNoopSearchAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchRequest.java
core/src/main/java/org/elasticsearch/action/search/SearchRequestBuilder.java
core/src/main/java/org/elasticsearch/action/search/SearchResponse.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchResponse.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/AsyncBulkByScrollActionTests.java
core/src/test/java/org/elasticsearch/action/search/ExpandSearchPhaseTests.java
core/src/test/java/org/elasticsearch/action/search/SearchPhaseControllerTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/TermsDocCountErrorIT.java
test/framework/src/main/java/org/elasticsearch/test/client/RandomizingClient.java
comments:
Expose `batched_reduce_size` via `_search` (#23288)

In #23253 we added an the ability to incrementally reduce search results.
This change exposes the parameter to control the batch since and therefore
the memory consumption of a large search request.

time:
2017-02-21T17:18:44Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHits.java
comments:
Fix comparaison of double in InternalTopHits

InternalTopHits uses "==" to compare hit scores and fails when score is NaN.
This commit changes the comparaison to always use Double.compare.

Relates #23253

time:
2017-02-21T16:55:44Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
comments:
Never reduce the same agg twice

Some randomization caused reduction of the same agg multiple times
which causes issues on some aggregations.

Relates to #23253

time:
2017-02-21T16:13:46Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalExtendedStatsTests.java
comments:
Fix incremental reduce randomization in base tests cases

We can and should randomly reduce down to a single result before
we passing the aggs to the final reduce. This commit changes the logic
to do that and ensures we don't trip the assertions the previous imple tripped.

Relates to #23253

time:
2017-02-21T15:43:29Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
comments:
Comment

time:
2017-02-21T15:31:42Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/DeferringBucketCollector.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregatorTests.java
comments:
Remove closeAgg

time:
2017-02-21T14:20:15Z
class:
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
test/framework/src/main/java/org/elasticsearch/test/RandomObjects.java
comments:
UpdateRequest implements ToXContent (#23289)

This commit changes UpdateRequest so that it implements the ToXContentObject interface.

time:
2017-02-21T14:14:54Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/InternalStats.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ExtendedStatsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/InternalExtendedStats.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ExtendedStatsAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalExtendedStatsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/InternalStatsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/StatsAggregatorTests.java
comments:
Add unit tests for stats and extended stats aggregations (#23287)

Add tests for InternalStats, InternalExtendedStats and StatsAggregator/ExtendedStatsAggregator

Relates #22278

time:
2017-02-21T13:45:33Z
class:
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/Netty4Plugin.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
comments:
Set network receive predictor size to 32kb (#23284)

Previously we calculated Netty' receive predictor size for HTTP and transport
traffic based on available memory and worker nodes. This resulted in a receive
predictor size between 64kb and 512kb. In our benchmarks this leads to increased
GC pressure.

With this commit we set Netty's receive predictor size to 32kb. This value is in
a sweet spot between heap memory waste (-> GC pressure) and effect on request
metrics (achieved throughput and latency numbers).

Closes #23185

time:
2017-02-21T12:02:48Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/CountedCollector.java
core/src/main/java/org/elasticsearch/action/search/DfsQueryPhase.java
core/src/main/java/org/elasticsearch/action/search/FetchSearchPhase.java
core/src/main/java/org/elasticsearch/action/search/InitialSearchPhase.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseContext.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchRequest.java
core/src/main/java/org/elasticsearch/action/search/SearchRequestBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/InternalGeoHashGrid.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalDateHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/InternalSignificantTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/InternalScriptedMetric.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHits.java
core/src/test/java/org/elasticsearch/action/search/CountedCollectorTests.java
core/src/test/java/org/elasticsearch/action/search/DfsQueryPhaseTests.java
core/src/test/java/org/elasticsearch/action/search/FetchSearchPhaseTests.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
core/src/test/java/org/elasticsearch/action/search/SearchPhaseControllerTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/MinDocCountIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/TermsDocCountErrorIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/significant/SignificanceHeuristicTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/TermsAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvgTests.java
test/framework/src/main/java/org/elasticsearch/test/client/RandomizingClient.java
comments:
First step towards incremental reduction of query responses (#23253)

Today all query results are buffered up until we received responses of
all shards. This can hold on to a significant amount of memory if the number of
shards is large. This commit adds a first step towards incrementally reducing
aggregations results if a, per search request, configurable amount of responses
are received. If enough query results have been received and buffered all so-far
received aggregation responses will be reduced and released to be GCed.

time:
2017-02-21T09:49:40Z
class:
core/src/main/java/org/elasticsearch/action/bulk/BulkResponse.java
core/src/main/java/org/elasticsearch/rest/action/document/RestBulkAction.java
core/src/test/java/org/elasticsearch/action/bulk/BulkResponseTests.java
comments:
Add parsing method to bulk response (#23234)

This commit adds the `fromXContent()` parsing method to BulkResponse.

time:
2017-02-21T09:19:01Z
class:
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/main/java/org/elasticsearch/action/delete/DeleteResponse.java
core/src/main/java/org/elasticsearch/action/index/IndexResponse.java
core/src/main/java/org/elasticsearch/action/update/UpdateResponse.java
comments:
Add javadoc for DocWriteResponse.Builders (#23267)

time:
2017-02-21T07:50:26Z
class:
comments:
Upgrade HDRHistogram to 2.1.9 (#23254)

time:
2017-02-21T07:49:43Z
class:
core/src/main/java/org/elasticsearch/index/mapper/IdFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/StringFieldType.java
core/src/main/java/org/elasticsearch/index/mapper/TermBasedFieldType.java
core/src/main/java/org/elasticsearch/index/mapper/TypeFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/IdsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java
core/src/test/java/org/elasticsearch/common/lucene/index/FreqTermsEnumTests.java
core/src/test/java/org/elasticsearch/index/mapper/KeywordFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/TextFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/query/HasChildQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/IdsQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/TermsQueryBuilderTests.java
comments:
Migrate TermsQuery to TermInSetQuery (#23229)

time:
2017-02-20T21:15:52Z
class:
comments:
Add another content-type header in packaging tests

In the packaging tests we make some requests to Elasticsearch as part of
the tests. These requests were not setting the content-type header. This
commit addresses this.

time:
2017-02-20T20:56:09Z
class:
comments:
Send content-type header in packaging tests

In the packaging tests we make some requests to Elasticsearch as part of
the tests. These requests were not setting the content-type header. This
commit addresses this.

time:
2017-02-20T20:16:14Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/IpRangeAggregatorTests.java
comments:
Fix for IpRangeAggregatorTests#testRanges

Handle null from/to ranges.

Closes #23272

time:
2017-02-20T20:05:24Z
class:
core/src/main/java/org/elasticsearch/index/seqno/SequenceNumbers.java
core/src/main/java/org/elasticsearch/index/translog/BaseTranslogReader.java
core/src/main/java/org/elasticsearch/index/translog/Checkpoint.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/index/translog/TranslogReader.java
core/src/main/java/org/elasticsearch/index/translog/TranslogSnapshot.java
core/src/main/java/org/elasticsearch/index/translog/TranslogWriter.java
core/src/main/java/org/elasticsearch/index/translog/TruncateTranslogCommand.java
core/src/test/java/org/elasticsearch/index/seqno/SequenceNumbersTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogVersionTests.java
comments:
Introduce sequence-number-aware translog

Today, the relationship between Lucene and the translog is rather
simple: every document not in Lucene is guaranteed to be in the
translog. We need a stronger guarantee from the translog though, namely
that it can replay all operations after a certain sequence number. For
this to be possible, the translog has to made sequence-number aware. As
a first step, we introduce the min and max sequence numbers into the
translog so that each generation knows the possible range of operations
contained in the generation. This will enable future work to keep around
all generations containing operations after a certain sequence number
(e.g., the global checkpoint).

Relates #22822

time:
2017-02-20T19:42:16Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/IpRangeAggregatorTests.java
comments:
Mark IP range aggregator test as awaits fix

This test reliably fails with the seed 4AC319F8A6B0329B.

time:
2017-02-20T19:31:19Z
class:
comments:
Add note and link to 'tune for disk usage' (#23252)

* Add note and link to 'tune for disk usage'

* Changed formatting as suggested

Thanks, @ clintongormley!

time:
2017-02-20T14:45:10Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/XContentHelper.java
core/src/main/java/org/elasticsearch/search/suggest/Suggest.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestion.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestion.java
core/src/main/java/org/elasticsearch/search/suggest/term/TermSuggestion.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestTests.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestionTests.java
comments:
Adding fromXContent to Suggest and Suggestion class (#23226)

A follow up to #23202, this adds parsing from xContent and tests to the four Suggestion implementations
and the top level suggest element to be used later when parsing the entire SearchResponse.

time:
2017-02-20T13:02:56Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/InternalSingleBucketAggregation.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/children/InternalChildrenTests.java
comments:
Tests: Add unit test for InternalChildren (#23261)

Relates to #22278

time:
2017-02-20T11:22:54Z
class:
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/blobstore/AzureBlobStore.java
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/storage/AzureStorageService.java
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/storage/AzureStorageSettings.java
plugins/repository-azure/src/main/java/org/elasticsearch/plugin/repository/azure/AzureRepositoryPlugin.java
plugins/repository-azure/src/main/java/org/elasticsearch/repositories/azure/AzureRepository.java
comments:
Remove global `repositories.azure` settings

Today we have multiple ways to define settings when a user needs to create a repository:

* in `elasticsearch.yml` file using `repositories.azure` prefix
* when creating the repository itself with `PUT _snaphot/repo`

The plan is to:

* Deprecate `repositories.azure` settings in 5.x (done with #22856)
* Remove in 6.x (this PR)

Related to #22800

time:
2017-02-20T11:04:30Z
class:
core/src/main/java/org/elasticsearch/index/mapper/GeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/InternalGeoBounds.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/geobounds/GeoBoundsAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/geobounds/InternalGeoBoundsTests.java
comments:
Add unit tests for GeoBoundsAggregator/InternalGeoBounds (#23259)

* Add unit tests for GeoBoundsAggregator/InternalGeoBounds

Relates #22278

time:
2017-02-20T10:55:48Z
class:
core/src/main/java/org/elasticsearch/index/mapper/IpFieldMapper.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/BinaryRangeAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/InternalBinaryRange.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/InternalBinaryRangeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/range/IpRangeAggregatorTests.java
comments:
Add unit tests for BinaryRangeAggregator/InternalBinaryRange (#23255)

* Add unit tests for BinaryRangeAggregator/InternalBinaryRange

Relates #22278

time:
2017-02-20T09:43:28Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/RequestTests.java
comments:
delete and index tests can share some part of the code

time:
2017-02-20T09:33:19Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/CrudIT.java
comments:
Remove createSampleDocument method and use the sync'ed index method

time:
2017-02-20T09:09:44Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/CrudIT.java
comments:
Remove createSampleIndexRequest method and provide ids

time:
2017-02-20T08:56:42Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/RequestTests.java
comments:
Check that we correctly propagate delete request parameters

time:
2017-02-20T08:45:33Z
class:
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationResponse.java
core/src/test/java/org/elasticsearch/action/bulk/BulkItemResponseTests.java
core/src/test/java/org/elasticsearch/action/delete/DeleteResponseTests.java
core/src/test/java/org/elasticsearch/action/index/IndexResponseTests.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationResponseTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateResponseTests.java
test/framework/src/main/java/org/elasticsearch/test/RandomObjects.java
comments:
[Tests] Cleans up DocWriteResponse parsing tests (#23233)

This commit cleans up some parsing tests added from the High Level Rest Client: IndexResponseTests, DeleteResponseTests, UpdateResponseTests, BulkItemResponseTests.

These tests are now more uniform with the others test-from-to-XContent tests we have, they now shuffle the XContent fields before parsing, the asserting method for parsed objects does not used a Map<String, Object> anymore, and buggy equals/hasCode methods in ShardInfo and ShardInfo.Failure have been removed.

time:
2017-02-20T08:36:47Z
class:
client/rest-high-level/src/main/java/org/elasticsearch/client/Request.java
comments:
Remove a non needed comment

time:
2017-02-17T22:58:20Z
class:
comments:
Update bwc test to 5.4 snapshot

time:
2017-02-17T21:16:04Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/DeferringBucketCollector.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregatorTests.java
comments:
Adds unit test for sampler aggregation

Relates to #22278

time:
2017-02-17T20:03:57Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/InternalSampler.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/SamplerAggregator.java
comments:
Checkstyle: Fix link lengths in sampler aggregation

time:
2017-02-17T19:45:41Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/RestHighLevelClientTests.java
client/rest/src/test/java/org/elasticsearch/client/HeapBufferedAsyncResponseConsumerTests.java
client/rest/src/test/java/org/elasticsearch/client/RequestLoggerTests.java
client/rest/src/test/java/org/elasticsearch/client/ResponseExceptionTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostIntegTests.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostTests.java
core/src/main/java/org/elasticsearch/action/admin/cluster/repositories/put/PutRepositoryRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/repositories/put/PutRepositoryRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/settings/ClusterUpdateSettingsRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/settings/ClusterUpdateSettingsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/create/CreateSnapshotRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/create/CreateSnapshotRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/RestoreSnapshotRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/RestoreSnapshotRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/PutStoredScriptRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/PutStoredScriptRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/put/UpdateSettingsRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/put/UpdateSettingsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestBuilder.java
core/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequestBuilder.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/index/IndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequestBuilder.java
core/src/main/java/org/elasticsearch/cluster/action/index/MappingUpdatedAction.java
core/src/main/java/org/elasticsearch/http/HttpTransportSettings.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/rest/RestController.java
core/src/main/java/org/elasticsearch/rest/RestHandler.java
core/src/main/java/org/elasticsearch/rest/RestRequest.java
core/src/main/java/org/elasticsearch/rest/action/search/RestClearScrollAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchScrollAction.java
core/src/main/java/org/elasticsearch/tasks/TaskResultsService.java
core/src/test/java/org/elasticsearch/action/admin/indices/get/GetIndexIT.java
core/src/test/java/org/elasticsearch/action/bulk/BulkRequestTests.java
core/src/test/java/org/elasticsearch/action/bulk/BulkWithUpdatesIT.java
core/src/test/java/org/elasticsearch/action/index/IndexRequestTests.java
core/src/test/java/org/elasticsearch/cluster/SpecificMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/metadata/MetaDataMappingServiceTests.java
core/src/test/java/org/elasticsearch/gateway/GatewayIndexStateIT.java
core/src/test/java/org/elasticsearch/gateway/RecoveryFromGatewayIT.java
core/src/test/java/org/elasticsearch/get/GetActionIT.java
core/src/test/java/org/elasticsearch/index/mapper/CamelCaseFieldNameTests.java
core/src/test/java/org/elasticsearch/index/mapper/CopyToMapperIntegrationIT.java
core/src/test/java/org/elasticsearch/index/mapper/CopyToMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentParserTests.java
core/src/test/java/org/elasticsearch/index/mapper/DoubleIndexingDocTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicTemplatesTests.java
core/src/test/java/org/elasticsearch/index/mapper/GenericStoreDynamicTemplateTests.java
core/src/test/java/org/elasticsearch/index/mapper/GeoPointFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
core/src/test/java/org/elasticsearch/index/mapper/PathMatchDynamicTemplateTests.java
core/src/test/java/org/elasticsearch/index/mapper/UpdateMappingOnClusterIT.java
core/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java
core/src/test/java/org/elasticsearch/indices/mapping/ConcurrentDynamicTemplateIT.java
core/src/test/java/org/elasticsearch/indices/mapping/UpdateMappingIntegrationIT.java
core/src/test/java/org/elasticsearch/indices/memory/breaker/RandomExceptionCircuitBreakerIT.java
core/src/test/java/org/elasticsearch/indices/state/OpenCloseIndexIT.java
core/src/test/java/org/elasticsearch/indices/stats/IndexStatsIT.java
core/src/test/java/org/elasticsearch/indices/template/SimpleIndexTemplateIT.java
core/src/test/java/org/elasticsearch/rest/RestControllerTests.java
core/src/test/java/org/elasticsearch/rest/RestRequestTests.java
core/src/test/java/org/elasticsearch/routing/PartitionedRoutingIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/TermsDocCountErrorIT.java
core/src/test/java/org/elasticsearch/search/basic/SearchWithRandomExceptionsIT.java
core/src/test/java/org/elasticsearch/search/basic/SearchWithRandomIOExceptionsIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java
core/src/test/java/org/elasticsearch/search/fields/SearchFieldsIT.java
core/src/test/java/org/elasticsearch/search/functionscore/DecayFunctionScoreIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoFilterIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoShapeIntegrationIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoShapeQueryTests.java
core/src/test/java/org/elasticsearch/search/morelikethis/MoreLikeThisIT.java
core/src/test/java/org/elasticsearch/search/query/SimpleQueryStringIT.java
core/src/test/java/org/elasticsearch/search/slice/SearchSliceIT.java
core/src/test/java/org/elasticsearch/search/sort/SimpleSortIT.java
core/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchIT.java
distribution/integ-test-zip/src/test/java/org/elasticsearch/test/rest/WaitForRefreshAndCloseTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportUpdateByQueryAction.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexParentChildTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/rest/Netty4HeadBodyIsEmptyIT.java
qa/backwards-5.0/src/test/java/org/elasticsearch/backwards/IndexingIT.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/ContextAndHeaderTransportIT.java
test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestResponse.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestResponseException.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ESClientYamlSuiteTestCase.java
comments:
Enforce Content-Type requirement on the rest layer and remove deprecated methods (#23146)

This commit enforces the requirement of Content-Type for the REST layer and removes the deprecated methods in transport
requests and their usages.

While doing this, it turns out that there are many places where *Entity classes are used from the apache http client
libraries and many of these usages did not specify the content type. The methods that do not specify a content type
explicitly have been added to forbidden apis to prevent more of these from entering our code base.

Relates #19388

time:
2017-02-17T17:01:40Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalMappedTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/LongTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/StringTerms.java
core/src/test/java/org/elasticsearch/search/aggregations/InternalAggregationTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/InternalTermsTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/LongTermsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/terms/StringTermsTests.java
comments:
Add unit tests for terms aggregation objects. (#23149)

Relates #22278

time:
2017-02-17T16:10:53Z
class:
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/rest/action/document/RestDeleteAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestGetAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestUpdateAction.java
comments:
Remove stale comment about setting routing before parent

Order does not matter anymore since we merged #15371

time:
2017-02-17T10:46:02Z
class:
client/rest-high-level/src/main/java/org/elasticsearch/client/Request.java
client/rest-high-level/src/main/java/org/elasticsearch/client/RestHighLevelClient.java
client/rest-high-level/src/test/java/org/elasticsearch/client/CrudIT.java
comments:
Fix after 1st review

* Sort alphabetically method names
* Add javadoc link to the ref guide
* Add more tests about routing, version and version type

time:
2017-02-17T09:46:20Z
class:
core/src/main/java/org/elasticsearch/rest/action/cat/RestThreadPoolAction.java
comments:
Minor fix of _cat output (#23211) (#23213)

One line was missing a trailing "\n"

time:
2017-02-17T03:32:12Z
class:
comments:
Tests: Remove java installation from vagrant provisioning (#23223)

The elastic images used for testing different systems now have java
installed in the base image. This commit removes the installation of
java, which should make the packagingTest runs more stable, as they will
not depend on flaky system repository mirrors.

time:
2017-02-17T01:48:37Z
class:
comments:
Fix packaging test to only run lsb_release if it exists

time:
2017-02-17T00:00:49Z
class:
comments:
Fix more missing markup in configuration docs

This commit fixes some missing markup in the configuration docs in the
logging configuration section.

time:
2017-02-16T21:43:07Z
class:
comments:
Fix plugin properties generation to be exact about the file to copy to
the output zip

time:
2017-02-16T20:31:18Z
class:
core/src/main/java/org/elasticsearch/monitor/os/OsProbe.java
core/src/test/java/org/elasticsearch/monitor/os/OsProbeTests.java
comments:
Fix control group pattern

The file /proc/self/cgroup lists the control groups to which the process
belongs. This file is a colon separated list of three fields:
 1. a hierarchy ID number
 2. a comma-separated list of hierarchies
 3. the pathname of the control group in the hierarchy

The regex pattern for this contains a bug for the second field. It
allows one or two entries in the comma-separated list, but not
more. This commit fixes the pattern to allow one or more entires in the
comma-separated list.

Relates #23219

time:
2017-02-16T19:41:42Z
class:
comments:
[DOCS] Fixed various typos in the 'cat APIs' section (#23216)

time:
2017-02-16T19:26:46Z
class:
comments:
Tests: Re-enable debian-8 and fedora-24 packaging tests (#23217)

These images have been rebuilt to be preloaded with java 8 installed.
This change re-enables the systems. It also removes some redundancy in
the rpm checks I found while testing the new images, and fixes a
potential issue with generated resources in plugins where a stale dir
can cause junk to get into the distribution.

time:
2017-02-16T17:56:11Z
class:
comments:
Disable javadoc for java vesion checker

time:
2017-02-16T17:19:30Z
class:
comments:
Replace HTTP link with HTTPS link

This commit replaces an HTTP link in the configuration docs with an
HTTPS link.

time:
2017-02-16T17:19:30Z
class:
comments:
Fix missing markup in configuration docs

This commit adds a missing backtick in the configuration docs.

time:
2017-02-16T16:59:55Z
class:
core/src/main/java/org/elasticsearch/search/suggest/Suggest.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestion.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestion.java
core/src/main/java/org/elasticsearch/search/suggest/term/TermSuggestion.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestionEntryTests.java
comments:
Adding fromXContent to Suggestion.Entry and subclasses (#23202)

This adds parsing from xContent to Suggestion.Entry and its subclasses for Terms-, Phrase-
and CompletionSuggestion.Entry.

time:
2017-02-16T14:49:04Z
class:
plugins/ingest-attachment/src/main/java/org/elasticsearch/ingest/attachment/TikaImpl.java
plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java
comments:
Merge branch 'fix/22077-ingest-attachment'

time:
2017-02-16T14:06:49Z
class:
distribution/tools/java-version-checker/src/main/java/org/elasticsearch/tools/JavaVersionChecker.java
distribution/tools/java-version-checker/src/main/java/org/elasticsearch/tools/SuppressForbidden.java
comments:
Introduce Java version checker

Today when users start Elasticsearch with their Java configuration
pointing to a pre-Java 8 install, they encounter a cryptic message:

    Exception in thread "main" java.lang.UnsupportedClassVersionError:
    org/elasticsearch/bootstrap/Elasticsearch : Unsupported major.minor
    version 52.0

They often think that they have Java 8 installed but if their JAVA_HOME
or other configuration is causing them to start with a pre-Java 8
install, this error message does not help them.

We introduce a Java version checker that runs on Java 6 as part of the
startup scripts. If the Java version is pre-Java 8, we can display a
helpful error message to the user informing them of the Java version
that the runtime was started with. Otherwise, Elasticsearch starts as it
does today.

time:
2017-02-16T14:06:49Z
class:
comments:
Add version checker tool to distributions

time:
2017-02-16T13:56:38Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/CrudIT.java
comments:
Fix REST spec for exists

A previous change aligned the handling of the GET document and HEAD
document APIs. This commit aligns the specification for these two APIs
as well, and fixes a failing test.

Relates #23196

time:
2017-02-16T13:48:17Z
class:
core/src/test/java/org/elasticsearch/script/IndexLookupIT.java
comments:
Test fix - faulty assumptions about when exceptions are thrown in relation to number of failing shards. (#23205)

Search exceptions are thrown only when all shards report failure. Fix changes assertion logic to reflect this.

Closes #23203

time:
2017-02-16T12:36:15Z
class:
comments:
Update stop-analyzer.asciidoc (#23195)

Clarified where the stopwords file needs to live

time:
2017-02-16T03:56:52Z
class:
client/rest-high-level/src/test/java/org/elasticsearch/client/CrudIT.java
comments:
Mark CrudIT#testExists as awaits fix

This commit marks the test CrudIT#testExists as awaiting a fix due to a
behavior change from aligning the GET and HEAD document APIs.

time:
2017-02-16T00:18:07Z
class:
comments:
Console-ify curl statements for allocation explain API docs (#23190)

* Console-ify curl statements for allocation explain API docs

Relates to #23001

* Fix tests

* Remove exclusion from build.gradle

* Call out index creation in prose

* Add console back and skip test

time:
2017-02-15T23:14:25Z
class:
comments:
Add content-type header to curl in getting-started

Relates to #23001

time:
2017-02-15T23:13:27Z
class:
comments:
Consolify snapshot documentation (#23189)

This commit brings the snapshot documentation in conformity
with the CONSOLE format, and fixes the docs so that the documentation
tests can be run against them.

time:
2017-02-15T19:23:12Z
class:
comments:
Plugins: Include license and notice files in zip (#23191)

This commit adds the elasticsearch LICENSE.txt to all plugins that
released with elasticsearch, as well as a generated NOTICE.txt specific
to the dependencies of each plugin.

time:
2017-02-15T18:58:53Z
class:
comments:
[DOCS] Console-ify shadow replica documentation

Relates to #23001

time:
2017-02-15T18:36:07Z
class:
comments:
Docs: CONSOLEify multi-get.asciidoc (#23122)

* Docs: CONSOLEify multi-get.asciidoc

relates #23001

* incorporate feedback

time:
2017-02-15T18:07:29Z
class:
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/rest/action/document/RestGetAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestHeadAction.java
modules/transport-netty4/src/test/java/org/elasticsearch/rest/Netty4HeadBodyIsEmptyIT.java
comments:
Fix get HEAD requests

Get HEAD requests incorrectly return a content-length header of 0. This
commit addresses this by removing the special handling for get HEAD
requests, and just relying on the general mechanism that exists for
handling HEAD requests in the REST layer.

Relates #23186

time:
2017-02-15T17:40:16Z
class:
comments:
Build: Add notice file generation (#23170)

This change improves the notice file present in our distributions to
include notice and license files from each included dependency.

closes #22546

time:
2017-02-15T16:53:39Z
class:
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
comments:
Fix checkstyle issue with modifier order in DocWriteResponse

time:
2017-02-15T16:33:10Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
core/src/main/java/org/elasticsearch/action/delete/DeleteResponse.java
core/src/main/java/org/elasticsearch/action/index/IndexResponse.java
core/src/main/java/org/elasticsearch/action/update/UpdateResponse.java
core/src/test/java/org/elasticsearch/ElasticsearchExceptionTests.java
core/src/test/java/org/elasticsearch/action/bulk/BulkItemResponseTests.java
core/src/test/java/org/elasticsearch/action/delete/DeleteResponseTests.java
core/src/test/java/org/elasticsearch/action/index/IndexResponseTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateResponseTests.java
comments:
Add parsing methods to BulkItemResponse (#22859)

This commit adds a parsing method to the BulkItemResponse class. In order to do that, the way DocWriteResponses are parsed has to be changed: ConstructingObjectParser/ObjectParser is removed in favor of a simpler and more readable way to parse these objects.

DocWriteResponse now provides the parseInnerToXContent() method that can be used by subclasses (IndexResponse, UpdateReponse and DeleteResponse) to parse the current token/field and potentially update a DocWriteResponseBuilder. The DocWriteResponseBuilder is a simple POJO used
to contain parsed values. It can be passed around from one parsing method to another parsing method. For example, this is what is done in IndexResponse: a IndexResponseBuilder is created in IndexResponse.fromXContent(), it get passed to IndexResponse.parseXContentFields() that
parses fields specific to IndexResponse (like "created") and updates the context, delegating to DocWriteResponse.parseInnerToXContent() the parsing of any other field. Once all XContent is parsed, IndexResponse.fromXContent() uses the method
IndexResponseBuilder.build() to create the new instance of IndexResponse.

This behavior allow to reuse parsing code among the class hierarchy while keeping the current behavior. It also allows other objects like BulkItemResponse to reuse the same parsing code to parse DocWriteResponses.

Finally, IndexResponseTests, UpdateResponseTests and DeleteResponseTests have been updated to introduce some random shuffling of fields before the XContent is parsed in order to ensure that the parsing code does not rely on field order.

time:
2017-02-15T15:59:24Z
class:
comments:
[TEST] bumps rolling upgrade test version to 5.4.0-snapshot

time:
2017-02-15T15:52:17Z
class:
core/src/main/java/org/elasticsearch/search/SearchHit.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestion.java
core/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestionOptionTests.java
comments:
Add xcontent parsing to completion suggestion option (#23071)

This adds parsing from xContent to the CompletionSuggestion.Entry.Option.
The completion suggestion option also inlines the xContent rendering of the
containes SearchHit, so in order to reuse the SearchHit parser this also changes
the way SearchHit is parsed from using a loop-based parser to using a
ConstructingObjectParser that creates an intermediate map representation and
then later uses this output to create either a single SearchHit or use it with
additional fields defined in the parser for the completion suggestion option.

time:
2017-02-15T15:14:33Z
class:
client/rest-high-level/src/main/java/org/elasticsearch/client/Request.java
comments:
Merge with master

time:
2017-02-15T15:08:29Z
class:
client/rest-high-level/src/main/java/org/elasticsearch/client/Request.java
client/rest-high-level/src/main/java/org/elasticsearch/client/RestHighLevelClient.java
client/rest-high-level/src/test/java/org/elasticsearch/client/CrudIT.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RequestTests.java
comments:
Merge branch 'master' into hlclient/add-delete-method

# Conflicts:
#	client/rest-high-level/src/main/java/org/elasticsearch/client/Request.java
#	client/rest-high-level/src/test/java/org/elasticsearch/client/CrudIT.java

time:
2017-02-15T15:00:50Z
class:
client/rest-high-level/src/main/java/org/elasticsearch/client/Request.java
client/rest-high-level/src/main/java/org/elasticsearch/client/RestHighLevelClient.java
client/rest-high-level/src/test/java/org/elasticsearch/client/CrudIT.java
comments:
Add delete API to the High Level Rest Client

time:
2017-02-15T14:04:38Z
class:
comments:
Restore BWC tests for field collapsing

time:
2017-02-15T12:53:41Z
class:
client/rest-high-level/src/main/java/org/elasticsearch/client/Request.java
client/rest-high-level/src/main/java/org/elasticsearch/client/RestHighLevelClient.java
client/rest-high-level/src/test/java/org/elasticsearch/client/CrudIT.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RequestTests.java
comments:
Add Index API to High Level Rest Client (#23040)

This commit adds support for the Index API in the High Level Rest Client.

time:
2017-02-15T10:14:37Z
class:
comments:
Add BWC index for new released version 5.2.1

time:
2017-02-15T10:13:09Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
Create version constants for next bug fix version v5.2.2

time:
2017-02-15T09:55:09Z
class:
comments:
Update getting-started.asciidoc (#23180)

The "sort" and "_score" fields are contained within the "hits" field.

time:
2017-02-15T09:10:06Z
class:
comments:
Typo (#23179)

autoGeneratePhraseQueries should be auto_generate_phrase_queries

time:
2017-02-15T09:04:52Z
class:
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/disruption/NetworkDisruption.java
test/framework/src/main/java/org/elasticsearch/test/disruption/NetworkDisruptionIT.java
comments:
Ensure network connections are restored after disruptions (#23135)

With #22977, network disruption also disconnects nodes from the transport service. That has the side effect that when the disruption is healed, the disconnected node stay disconnected until the `NodeConnectionsService` restores the connection. This can take too long for the tests. This PR adds logic to the cluster healing to restore connections immediately. 

See https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-unix-compatibility/os=debian/611/console for an example failure.

time:
2017-02-15T08:38:10Z
class:
comments:
Fix typo (#23171)

time:
2017-02-15T08:35:02Z
class:
comments:
Fix tests that check for deprecation message

time:
2017-02-15T05:33:13Z
class:
core/src/main/java/org/elasticsearch/common/settings/Setting.java
comments:
Improve setting deprecation message (#23156)

This change modifies the deprecation log message emitted when a setting
is found which is deprecated. The new message indicates docs for the
deprecated settings can be found in the breaking changes docs for the
next major version.

closes #22849

time:
2017-02-15T05:31:56Z
class:
comments:
Build: Support mavenLocal flag in buildSrc (#23157)

When configuring which repositories to pull from, we currently add
mavenLocal() when the `repos.mavenLocal` flag is set. However, this is
only done in normal projects, but not the special buildSrc project. This
change adds that support. Note that this was not possible before gradle
2.13, as there was a bug which prevented sys props from reaching the
buildSrc project (https://issues.gradle.org/browse/GRADLE-2475).
However, we already require 2.13+.

time:
2017-02-15T05:27:21Z
class:
comments:
Add 5.2.1 to versions vagrant tests

time:
2017-02-15T05:23:21Z
class:
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerTransportTests.java
comments:
Fix line length

time:
2017-02-15T00:24:22Z
class:
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerTransportTests.java
comments:
Add failing tests for expect header violations

This commit adds unit tests for two cases where Elasticsearch violates
expect header handling. These tests are marked as awaits fix.

Relates #23173

time:
2017-02-14T21:51:27Z
class:
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetIndicesAction.java
comments:
Cleanup RestGetIndicesAction.java

This commit is just a code cleanup of RestGetIndicesAction.java. For
example, we remove an unnecessary class, remove some unnecessary local
variables, and simplify some code flow.

Relates #23129

time:
2017-02-14T21:37:22Z
class:
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/rest/action/document/RestGetSourceAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestHeadAction.java
modules/transport-netty4/src/test/java/org/elasticsearch/rest/Netty4HeadBodyIsEmptyIT.java
comments:
Fix get source HEAD requests

Get source HEAD requests incorrectly return a content-length header of
0. This commit addresses this by removing the special handling for get
source HEAD requests, and just relying on the general mechanism that
exists for handling HEAD requests in the REST layer.

Relates #23151

time:
2017-02-14T21:17:17Z
class:
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java
comments:
[percolator] Removed old 2.x bwc logic.

time:
2017-02-14T20:40:55Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
comments:
Add request version asserting during replica operation (#23167)

time:
2017-02-14T16:14:17Z
class:
core/src/main/java/org/elasticsearch/action/search/ExpandSearchPhase.java
core/src/main/java/org/elasticsearch/action/search/FetchSearchPhase.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/test/java/org/elasticsearch/action/search/ExpandSearchPhaseTests.java
core/src/test/java/org/elasticsearch/action/search/MockSearchPhaseContext.java
comments:
Add ExpandSearchPhase as a successor for the FetchSearchPhase (#23165)

Now that we have more flexible search phases we should move the rather
hacky integration of the collapse feature as a real search phase that can
be tested and used by itself. This commit adds a new ExpandSearchPhase
including a unittest for the phase. It's integrated into the fetch phase
as an optional successor.

time:
2017-02-14T15:59:34Z
class:
comments:
Normalising REST spec query param types

integer -> number
filter_path: string -> list

time:
2017-02-14T15:05:19Z
class:
core/src/main/java/org/apache/lucene/search/vectorhighlight/CustomFieldQuery.java
core/src/main/java/org/elasticsearch/common/lucene/search/Queries.java
core/src/main/java/org/elasticsearch/index/query/NestedQueryBuilder.java
core/src/main/java/org/elasticsearch/index/search/ESToParentBlockJoinQuery.java
core/src/main/java/org/elasticsearch/index/search/NestedHelper.java
core/src/main/java/org/elasticsearch/search/DefaultSearchContext.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregationPhase.java
core/src/main/java/org/elasticsearch/search/internal/FilteredSearchContext.java
core/src/main/java/org/elasticsearch/search/internal/SearchContext.java
core/src/main/java/org/elasticsearch/search/internal/SubSearchContext.java
core/src/test/java/org/apache/lucene/search/QueriesTests.java
core/src/test/java/org/elasticsearch/index/query/NestedQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/search/ESToParentBlockJoinQueryTests.java
core/src/test/java/org/elasticsearch/index/search/NestedHelperTests.java
core/src/test/java/org/elasticsearch/search/DefaultSearchContextTests.java
core/src/test/java/org/elasticsearch/search/nested/SimpleNestedIT.java
test/framework/src/main/java/org/elasticsearch/test/TestSearchContext.java
comments:
Nested queries should avoid adding unnecessary filters when possible. (#23079)

When nested objects are present in the mappings, many queries get deoptimized
due to the need to exclude documents that are not in the right space. For
instance, a filter is applied to all queries that prevents them from matching
non-root documents (`+*:* -_type:__*`). Moreover, a filter is applied to all
child queries of `nested` queries in order to make sure that the child query
only matches child documents (`_type:__nested_path`), which is required by
`ToParentBlockJoinQuery` (the Lucene query behing Elasticsearch's `nested`
queries).

These additional filters slow down `nested` queries. In 1.7-, the cost was
somehow amortized by the fact that we cached filters very aggressively. However,
this has proven to be a significant source of slow downs since 2.0 for users
of `nested` mappings and queries, see #20797.

This change makes the filtering a bit smarter. For instance if the query is a
`match_all` query, then we need to exclude nested docs. However, if the query
is `foo: bar` then it may only match root documents since `foo` is a top-level
field, so no additional filtering is required.

Another improvement is to use a `FILTER` clause on all types rather than a
`MUST_NOT` clause on all nested paths when possible since `FILTER` clauses
are more efficient.

Here are some examples of queries and how they get rewritten:

```
"match_all": {}
```

This query gets rewritten to `ConstantScore(+*:* -_type:__*)` on master and
`ConstantScore(_type:AutomatonQuery {\norg.apache.lucene.util.automaton.Automaton@4371da44})`
with this change. The automaton is the complement of `_type:__*` so it matches
the same documents, but is faster since it is now a positive clause. Simplistic
performance testing on a 10M index where each root document has 5 nested
documents on average gave a latency of 420ms on master and 90ms with this change
applied.

```
"term": {
  "foo": {
    "value": "0"
  }
}
```

This query is rewritten to `+foo:0 #(ConstantScore(+*:* -_type:__*))^0.0` on
master and `foo:0` with this change: we do not need to filter nested docs out
since the query cannot match nested docs. While doing performance testing in
the same conditions as above, response times went from 250ms to 50ms.

```
"nested": {
  "path": "nested",
  "query": {
    "term": {
      "nested.foo": {
        "value": "0"
      }
    }
  }
}
```

This query is rewritten to
`+ToParentBlockJoinQuery (+nested.foo:0 #_type:__nested) #(ConstantScore(+*:* -_type:__*))^0.0`
on master and `ToParentBlockJoinQuery (nested.foo:0)` with this change. The
top-level filter (`-_type:__*`) could be removed since `nested` queries only
match documents of the parent space, as well as the child filter
(`#_type:__nested`) since the child query may only match nested docs since the
`nested` object has both `include_in_parent` and `include_in_root` set to
`false`. While doing performance testing in the same conditions as above,
response times went from 850ms to 270ms.

time:
2017-02-14T14:57:12Z
class:
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/NumberFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ScaledFloatFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java
core/src/test/java/org/elasticsearch/index/mapper/DateFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/NumberFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/mapper/ScaledFloatFieldTypeTests.java
core/src/test/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoDistanceQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchPhrasePrefixQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchPhraseQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/MultiMatchQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/RangeQueryBuilderTests.java
comments:
Integrate IndexOrDocValuesQuery. (#23119)

This gives Lucene the choice to use index/point-based queries or
doc-values-based queries depending on which one is more efficient. This commit
integrates this feature for:
 - long/integer/short/byte/double/float/half_float/scaled_float ranges,
 - date ranges,
 - geo bounding box queries,
 - geo distance queries.

time:
2017-02-14T14:22:32Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/TransportAnalyzeAction.java
core/src/test/java/org/elasticsearch/indices/analyze/AnalyzeActionIT.java
comments:
Merge pull request #23161 from johtani/support_keyword_to_analyze_api

[Analyze]Support Keyword type in Analyze API

time:
2017-02-14T13:08:38Z
class:
core/src/main/java/org/elasticsearch/search/SearchHit.java
comments:
Remove unused sourceAsBytes field in SearchHit

time:
2017-02-14T12:14:41Z
class:
comments:
Add a note about `cluster.routing.allocation.node_concurrent_recoveries` (#23160)

Closes #23152

time:
2017-02-14T11:34:25Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/CountedCollector.java
core/src/main/java/org/elasticsearch/action/search/DfsQueryPhase.java
core/src/main/java/org/elasticsearch/action/search/FetchSearchPhase.java
core/src/main/java/org/elasticsearch/action/search/InitialSearchPhase.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhase.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseContext.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/cluster/routing/GroupShardsIterator.java
core/src/main/java/org/elasticsearch/search/dfs/DfsSearchResult.java
core/src/test/java/org/elasticsearch/action/search/CountedCollectorTests.java
core/src/test/java/org/elasticsearch/action/search/DfsQueryPhaseTests.java
core/src/test/java/org/elasticsearch/action/search/FetchSearchPhaseTests.java
core/src/test/java/org/elasticsearch/action/search/MockSearchPhaseContext.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
core/src/test/java/org/elasticsearch/cluster/routing/GroupShardsIteratorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/AdjacencyMatrixIT.java
core/src/test/java/org/elasticsearch/search/searchafter/SearchAfterIT.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestSearchIT.java
comments:
Detach SearchPhases from AbstractSearchAsyncAction (#23118)

Today all search phases are inner classes of AbstractSearchAsyncAction or one of it's
subclasses. This makes unit testing of these classes practically impossible. This commit
Extracts `DfsQueryPhase` and `FetchSearchPhase` or of the code that composes the actual
query execution types and moves most of the fan-out and collect code into an `InitialSearchPhase`
class that can be used to build initial search phases (phases that retry on shards). This will
make modification to these classes simpler and allows to easily compose or add new search phases
down the road if additional roundtrips are required.

time:
2017-02-14T10:31:37Z
class:
test/framework/src/main/java/org/elasticsearch/test/RandomObjects.java
comments:
[Tests] increase minimal field name when creating random objects

I encountered several cases of duplicate field names when generating random
fields using the RandomObjects helper. This leads to invalid json in some tests,
so increasing the minimum field name length to four to make this less likely to
happen.

time:
2017-02-14T08:56:36Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/TransportAnalyzeAction.java
comments:
 [Analyze]Support Keyword type in Analyze API

 Add comment and clarify

time:
2017-02-14T07:41:16Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/TransportAnalyzeAction.java
core/src/test/java/org/elasticsearch/indices/analyze/AnalyzeActionIT.java
comments:
[Analyze]Support Keyword type in Analyze API

time:
2017-02-13T22:39:25Z
class:
core/src/main/java/org/elasticsearch/http/HttpServerTransport.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/rest/RestController.java
core/src/main/java/org/elasticsearch/rest/RestRequest.java
core/src/test/java/org/elasticsearch/common/network/NetworkModuleTests.java
core/src/test/java/org/elasticsearch/rest/RestControllerTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpRequestHandler.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpChannelTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerPipeliningTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpServerTransportTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/rest/Netty4BadRequestIT.java
test/framework/src/main/java/org/elasticsearch/http/NullDispatcher.java
comments:
Handle bad HTTP requests

When Netty decodes a bad HTTP request, it marks the decoder result on
the HTTP request as a failure, and reroutes the request to GET
/bad-request. This either leads to puzzling responses when a bad request
is sent to Elasticsearch (if an index named "bad-request" does not exist
then it produces an index not found exception and otherwise responds
with the index settings for the index named "bad-request"). This commit
addresses this by inspecting the decoder result on the HTTP request and
dispatching the request to a bad request handler preserving the initial
cause of the bad request and providing an error message to the client.

Relates #23153

time:
2017-02-13T22:30:08Z
class:
comments:
Update to forbiddenapis 2.3 (improves Gradle configuration time) (#23154)

time:
2017-02-13T20:15:57Z
class:
core/src/main/java/org/elasticsearch/transport/DelegatingTransportChannel.java
core/src/main/java/org/elasticsearch/transport/TcpTransportChannel.java
core/src/main/java/org/elasticsearch/transport/TransportChannel.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
modules/transport-netty4/src/test/java/org/elasticsearch/transport/netty4/SimpleNetty4TransportTests.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
comments:
Make the version of the remote node accessible on a transport channel (#23019)

This commit adds a new method to the TransportChannel that provides access to the version of the
remote node that the response is being sent on and that the request came from. This is helpful
for serialization of data attached as headers.

time:
2017-02-13T18:20:15Z
class:
core/src/main/java/org/elasticsearch/monitor/fs/FsProbe.java
core/src/test/java/org/elasticsearch/monitor/fs/FsProbeTests.java
comments:
Fix total disk bytes returning negative value (#23093)

* Fix total disk bytes returning negative value

This adds a workaround for JDK-8162520 -
https://bugs.openjdk.java.net/browse/JDK-8162520

Some filesystems can be so large that they return a negative value for their
free/used/available disk bytes due to being larger than `Long.MAX_VALUE`.

This adds protection for our `FsProbe` implementation and adds a test that it
does the right thing.

time:
2017-02-13T18:15:51Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/PutStoredScriptRequest.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/ingest/PutPipelineRequest.java
core/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java
core/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/ingest/PipelineConfiguration.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestResponse.java
comments:
Fix communication with 5.3.0 nodes

This commit fixes communication with 5.3.0 nodes to send XContentType to these nodes since #22691 was backported to the
5.3 branch.

time:
2017-02-13T15:23:25Z
class:
comments:
Update redirects.asciidoc (#23148)

time:
2017-02-13T14:34:52Z
class:
core/src/main/java/org/elasticsearch/action/DocWriteResponse.java
core/src/main/java/org/elasticsearch/rest/action/RestStatusToXContentListener.java
core/src/main/java/org/elasticsearch/rest/action/document/RestIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestUpdateAction.java
core/src/test/java/org/elasticsearch/action/DocWriteResponseTests.java
comments:
Properly encode location header

Today when trying to encode the location header to ASCII, we rely on the
Java URI API. This API requires a proper URI which blows up whenever the
URI contains, for example, a space (which can happen if the type, ID, or
routing contain a space). This commit addresses this issue by properly
encoding the URI. Additionally, we remove the need to create a URI
simplifying the code flow.

Relates #23133

time:
2017-02-13T12:39:11Z
class:
comments:
[Tests] Fix msearch/typed_keys test

This test uses index_patterns which has been introduced in 6.0 and does not exist in 5.4.0, making the Bwc test fails. Instead of using index templates, it now uses explicitly create the required indices. Also, it fixes unmapped aggregations tests.

time:
2017-02-13T11:15:01Z
class:
comments:
Add note about min_score filtering efficiency (#23109)

* Add note about min_score filtering efficiency

* Reword to mention 'HAVING'

* Remove reference to HAVING

time:
2017-02-13T10:00:12Z
class:
comments:
Consolify docs/reference/analysis/tokenfilters/pattern-capture-tokenfilter.asciidoc. (#23050)

time:
2017-02-13T09:49:46Z
class:
core/src/main/java/org/elasticsearch/action/support/WriteRequest.java
core/src/test/java/org/elasticsearch/action/support/RefreshPolicyTests.java
comments:
Expose WriteRequest.RefreshPolicy string representation (#23106)

This commit changes the RefreshPolicy enum so that string representation are exposed. This will help the high level rest client to simply use  refreshPolicy.getValue() to get the corresponding parameter value of a given refresh policy.

time:
2017-02-13T08:54:08Z
class:
comments:
back wards tests should run against 5.4.0-SNAP

time:
2017-02-12T12:58:22Z
class:
core/src/main/java/org/elasticsearch/cluster/ClusterStateObserver.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
comments:
Allow a cluster state applier to register an observer and wait for a better state (#23132)

#21817 introduced the notion of a cluster state applier and banned those for sampling the cluster state directly (as it is not applied yet). Testing has exposed one exceptional use case - if the appliers want to spawn off a follow up it may require waiting for specific new cluster state (for example, the shard started action, called by the IndicesClusterStateService, may run into trouble connecting to the master and wait for a new master to be elected). This requires creating an observer which, in turn, samples the cluster state. 

An example failure can be seen at https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+periodic/1701/console

This commit allows creating an observer from a cluster state applier. The observer is adapted to exclude any potential old cluster state in its logic.

time:
2017-02-12T07:20:18Z
class:
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
comments:
Traces in testAdapterSendReceiveCallbacks should only listen the relevant actions

The traces callback is only called after responses are set. This can lead to concurrent issues where the trace is notified of previously sent responses if it was added after the response was sent (enabling further execution of the test) but before the tracer call backs are called.

time:
2017-02-11T23:30:16Z
class:
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetIndexTemplateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestHeadIndexTemplateAction.java
modules/transport-netty4/src/test/java/org/elasticsearch/rest/Netty4HeadBodyIsEmptyIT.java
comments:
Fix template HEAD requests

Template HEAD requests incorrectly return a content-length header of
0. This commit addresses this by removing the special handling for
template HEAD requests, and just relying on the general mechanism that
exists for handling HEAD requests in the REST layer.

Relates #23130

time:
2017-02-11T17:41:19Z
class:
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
comments:
log extra information on failure of testAdapterSendReceiveCallbacks

time:
2017-02-10T22:57:43Z
class:
comments:
Docs: Consoleify cluster and indices settings docs (#23030)

relates #23001

time:
2017-02-10T21:04:40Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportBulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/test/java/org/elasticsearch/action/index/IndexRequestTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
comments:
Remove action.allow_id_generation setting (#23120)

This was an undocumented and unsettable setting that allowed id generation.

Resolves #23088

time:
2017-02-10T17:20:00Z
class:
core/src/main/java/org/elasticsearch/common/lucene/search/Queries.java
core/src/main/java/org/elasticsearch/index/query/MatchQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringBuilder.java
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
core/src/test/java/org/elasticsearch/index/search/MatchQueryIT.java
comments:
Fix GraphQuery expectation after Lucene upgrade to 6.5 (#23117)

GraphQueries are now generated as simple clauses in BooleanQuery. So for instance a multi terms synonym will generate
 a GraphQuery but only for the side paths, the other part of the query will not be impacted. This means that we cannot apply
 `minimum_should_match` or `cutoff_frequency` on GraphQuery anymore (only ES 5.3 does that because we generate all possible paths if a query has at least one multi terms synonym).
Starting in 5.4 multi terms synonym will now be treated as a single term when `minimum_should_match` is computed and will be ignored when `cutoff_frequency` is set.
Fixes #23102

time:
2017-02-10T15:42:08Z
class:
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/test/java/org/elasticsearch/action/index/IndexRequestTests.java
comments:
Limit IndexRequest toString() length (#22832)

Limits the length of `IndexRequest#toString` which also limits the size of the task description generated for `IndexRequest`s. If the document being written is larger than 2kb we skip logging the _source entirely. This is because truncating the source is tricky and it isn't worth it.

time:
2017-02-10T14:53:30Z
class:
core/src/main/java/org/apache/lucene/search/suggest/analyzing/XAnalyzingSuggester.java
core/src/main/java/org/elasticsearch/action/admin/cluster/repositories/put/PutRepositoryRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/SnapshotsStatusRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/state/ClusterStateRequestBuilder.java
core/src/main/java/org/elasticsearch/action/fieldstats/FieldStats.java
core/src/main/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeAction.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationOperation.java
core/src/main/java/org/elasticsearch/action/termvectors/TermVectorsFields.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequestBuilder.java
core/src/main/java/org/elasticsearch/bootstrap/Security.java
core/src/main/java/org/elasticsearch/client/ClusterAdminClient.java
core/src/main/java/org/elasticsearch/client/IndicesAdminClient.java
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateObserver.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNodes.java
core/src/main/java/org/elasticsearch/cluster/routing/IndexRoutingTable.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocationService.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/common/geo/GeoUtils.java
core/src/main/java/org/elasticsearch/common/inject/Binder.java
core/src/main/java/org/elasticsearch/common/inject/TypeLiteral.java
core/src/main/java/org/elasticsearch/common/inject/internal/Errors.java
core/src/main/java/org/elasticsearch/common/lucene/Lucene.java
core/src/main/java/org/elasticsearch/common/network/NetworkUtils.java
core/src/main/java/org/elasticsearch/common/xcontent/NamedXContentRegistry.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentHelper.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/EngineConfig.java
core/src/main/java/org/elasticsearch/index/query/QueryBuilders.java
core/src/main/java/org/elasticsearch/index/query/SpanMultiTermQueryBuilder.java
core/src/main/java/org/elasticsearch/index/seqno/SequenceNumbersService.java
core/src/main/java/org/elasticsearch/index/shard/TranslogRecoveryPerformer.java
core/src/main/java/org/elasticsearch/index/store/Store.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/indices/IndicesRequestCache.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTargetHandler.java
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/script/ScriptType.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregatorBase.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/UnmappedSignificantTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/UnmappedTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/slice/SliceBuilder.java
core/src/main/java/org/elasticsearch/transport/BytesTransportRequest.java
core/src/main/java/org/elasticsearch/transport/Transport.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/main/java/org/joda/time/format/StrictISODateTimeFormat.java
comments:
Fix some Javadoc typos (#23111)

time:
2017-02-10T14:44:01Z
class:
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetIndicesAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestIndicesExistsAction.java
modules/transport-netty4/src/test/java/org/elasticsearch/rest/Netty4HeadBodyIsEmptyIT.java
comments:
Fix index HEAD requests

Index HEAD requests incorrectly return a content-length header of
0. This commit addresses this by removing the special handling for index
HEAD requests, and just relying on the general mechanism that exists for
handling HEAD requests in the REST layer.

Relates #23112

time:
2017-02-10T14:42:58Z
class:
comments:
Temporary disable bwc tests on field collapsing that fail because snapshot build of 5.3 is broken

time:
2017-02-10T14:19:35Z
class:
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestAliasesExistAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java
modules/transport-netty4/src/test/java/org/elasticsearch/rest/Netty4HeadBodyIsEmptyIT.java
comments:
Fix alias HEAD requests

Alias HEAD requests incorrectly return a content-length header of
0. This commit addresses this by removing the special handling for alias
HEAD requests, and just relying on the general mechanism that exists for
handling HEAD requests in the REST layer.

Relates #23094

time:
2017-02-10T14:08:47Z
class:
core/src/main/java/org/elasticsearch/Version.java
core/src/main/java/org/elasticsearch/index/analysis/FlattenGraphTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/WordDelimiterGraphTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/analysis/WordDelimiterTokenFilterFactory.java
core/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/BytesRefFieldComparatorSource.java
core/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/DoubleValuesComparatorSource.java
core/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/FloatValuesComparatorSource.java
core/src/main/java/org/elasticsearch/index/fielddata/fieldcomparator/LongValuesComparatorSource.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHits.java
core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java
core/src/test/java/org/elasticsearch/index/query/HasChildQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/search/MatchQueryIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHitsTests.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolatorFieldMapper.java
modules/percolator/src/main/java/org/elasticsearch/percolator/QueryAnalyzer.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorFieldMapperTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/QueryAnalyzerTests.java
test/framework/src/main/java/org/elasticsearch/AnalysisFactoryTestCase.java
comments:
Upgrade to lucene-6.5.0-snapshot-f919485. (#23087)

time:
2017-02-10T13:59:37Z
class:
core/src/main/java/org/elasticsearch/action/bulk/BulkProcessor.java
core/src/test/java/org/elasticsearch/action/bulk/BulkProcessorIT.java
comments:
Add BulkProcessor methods with XContentType parameter (#23078)

This commit adds methods to the BulkProcessor that accept bytes and a XContentType to avoid content type detection. The
methods that do not accept XContentType with bytes have been deprecated by this commit.

Relates #22691

time:
2017-02-10T13:37:05Z
class:
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetAliasesAction.java
comments:
Cleanup RestGetAliasesAction.java

This commit is just a code cleanup of RestGetAliasesAction.java. For
example, we remove an unnecessary class, simplify a convenience method,
and simplify some code flow.

Relates #23095

time:
2017-02-10T09:53:38Z
class:
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregation.java
core/src/main/java/org/elasticsearch/search/suggest/Suggest.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestion.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestion.java
core/src/main/java/org/elasticsearch/search/suggest/term/TermSuggestion.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestMultiSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestSearchTemplateAction.java
comments:
Use `typed_keys` parameter to prefix suggester names by type in search responses (#23080)

This pull request reuses the typed_keys parameter added in #22965, but this time it applies it to suggesters. When set to true, the suggester names in the search response will be prefixed with a prefix that reflects their type.

time:
2017-02-10T09:08:24Z
class:
comments:
[Docs] Remove unnecessary // TEST[continued] in search-template doc

It has been explained in https://github.com/elastic/elasticsearch/commit/e39b96f257214ebcef3286df472fa9727edb88c1

time:
2017-02-09T21:48:40Z
class:
comments:
Fix reindex test after toString change

Weakens the assertion on wait_for_active_shards so that we don't
check the toString of the bulk request because it isn't important.

Relates to #22900

time:
2017-02-09T21:17:14Z
class:
comments:
Fix confusing section in docs/README

It looked like it was telling you to add both `// TEST[continued]`
and `// TESTRESPONSE` to the same snippet which doesn't do anything.
Instead it was trying to say that you can have many snippets included
into the same test by doing:

```
request1
```
// CONSOLE

```
response1
```
// TESTRESPONSE

``
request2
```
// CONSOLE
// TEST[continued]

```
response2
```
// TESTRESPONSE
Thanks Nik, makes more sense now

time:
2017-02-09T21:14:09Z
class:
core/src/test/java/org/elasticsearch/action/support/WaitActiveShardCountIT.java
comments:
Relax WaitActiveShardCountIT check of exception messages

So ti wouldn't depend on BulkShardRequest.toString()

time:
2017-02-09T21:02:42Z
class:
comments:
Docs: Deleted redundant word in scripting

time:
2017-02-09T20:34:22Z
class:
core/src/test/java/org/elasticsearch/action/support/WaitActiveShardCountIT.java
comments:
fix failing tests for BulkShardRequest.tostring

time:
2017-02-09T20:14:30Z
class:
comments:
Adding `ansible-elasticsearch` to list of CM tools (#23058)

time:
2017-02-09T19:14:56Z
class:
comments:
Fixed bad asciidoc in delete-by-query

time:
2017-02-09T19:05:21Z
class:
core/src/test/java/org/elasticsearch/action/bulk/BulkShardRequestTests.java
comments:
fix BulkShardRequestTests after changes to BulkShardRequest.toString

time:
2017-02-09T18:14:03Z
class:
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/indices/recovery/EvilPeerRecoveryIT.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
comments:
Move EvilPeerRecoveryIT to a unit test in RecoveryDuringReplicationTests (#22900)

EvillPeerRecoveryIT checks scenario where recovery is happening while there are on going indexing operation that already have been assigned a seq# . This is fairly hard to achieve and the test goes through a couple of hoops via the plugin infra to achieve that. This PR extends the unit tests infra to allow for those hoops to happen in unit tests. This allows the test to be moved to RecoveryDuringReplicationTests

Relates to #22484

time:
2017-02-09T17:06:10Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/node/Node.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/collapse/CollapseBuilder.java
core/src/main/java/org/elasticsearch/search/collapse/ExpandCollapseSearchResponseListener.java
core/src/test/java/org/elasticsearch/search/ResponseListenerPluginIT.java
core/src/test/java/org/elasticsearch/search/SearchModuleTests.java
core/src/test/java/org/elasticsearch/search/collapse/CollapseBuilderTests.java
comments:
Removes ExpandCollapseSearchResponseListener, search response listeners and blocking calls

This changes removes the SearchResponseListener that was used by the ExpandCollapseSearchResponseListener to expand collapsed hits.
The removal of SearchResponseListener is not a breaking change because it was never released.
This change also replace the blocking call in ExpandCollapseSearchResponseListener by a single asynchronous multi search request. The parallelism of the expand request can be set via CollapseBuilder#max_concurrent_group_searches

Closes #23048

time:
2017-02-09T16:59:49Z
class:
core/src/main/java/org/elasticsearch/action/bulk/BulkShardRequest.java
comments:
Improve BulkShardRequest.toString when it has only 1 internal request

Now that we use bulk for single item indexing, this is often the case. Having an indicator of the id of the indexed document helps debugging.

It now looks like this `BulkShardRequest to [[test][0]] containing [index {[test][type][AVojzy9ZxfWASZ-ysmN7], source[{"auto":true}]}]`

time:
2017-02-09T16:46:39Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainRequest.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterAllocationExplainAction.java
comments:
Cluster allocation explain to never return empty response body (#23054)

Empty response bodies should only be sent for HEAD requests, otherwise we should always send back info about the exception that was thrown. Removed some manual exception handling in the REST action that should be rather bubbled up and handled by our rest action infra like every other rest action does.

time:
2017-02-09T16:00:25Z
class:
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpServerTransport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/Netty4Transport.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/channel/PrivilegedNioServerSocketChannel.java
modules/transport-netty4/src/main/java/org/elasticsearch/transport/netty4/channel/PrivilegedNioSocketChannel.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpClient.java
comments:
Isolated SocketPermissions to Netty (#23057)

Netty 4.1.8 wraps connect and accept operations in doPrivileged blocks.
This means that we not need to give permissions to the entire transport
module. Additionally this commit deletes the privileged socket channel
and privileged server socket chanel.

time:
2017-02-09T13:58:01Z
class:
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestClusterAllocationExplainAction.java
comments:
Remove redundant reads of human flag (#23074)

The human flag is centrally handled in RestChannel, no need to have Rest actions manually read it and set it to the builder

time:
2017-02-09T13:17:21Z
class:
core/src/test/java/org/elasticsearch/search/SearchHitTests.java
core/src/test/java/org/elasticsearch/search/SearchHitsTests.java
comments:
Tests: Renaming InternalSearchHitsTests to SearchHitsTests

The class under test changed its name from InternalSearchHit(s) to just
SearchHit(s), renaming the tests accordingly.

time:
2017-02-09T10:19:04Z
class:
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/InternalSampler.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/UnmappedSignificantTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/UnmappedTerms.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsSignificanceScoreIT.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestMultiSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestSearchTemplateAction.java
comments:
Add parameter to prefix aggs name with type in search responses (#22965)

This pull request adds a new parameter to the REST Search API named `typed_keys`. When set to true, the aggregation names in the search response will be prefixed with a prefix that reflects the internal type of the aggregation.

Here is a simple example:
```
GET /_search?typed_keys
{
    "aggs": {
        "tweets_per_user": {
            "terms": {
                "field": "user"
            }
        }
    },
    "size": 0
}
```

And the response:

```
{
    "aggs": {
        "sterms:tweets_per_user": {
            ...
        }
    }
}
```

This parameter is intended to make life easier for REST clients that could parse back the prefix and could detect the type of the aggregation to parse. It could also be implemented for suggesters.

time:
2017-02-09T08:30:13Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
comments:
Harden ops counting in AbstractSearchAsyncAction (#23045)

Today we account for too many response with an `IllegalStateException` in
`AbstractSearchAsyncAction` while this is something that should never happen
we should rather assert that we are always have less or equal the number of
expected ops when waiting for responses.

time:
2017-02-09T08:03:26Z
class:
core/src/main/java/org/elasticsearch/index/query/QueryParseContext.java
core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/ScriptScoreFunctionBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/heuristics/ScriptHeuristic.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/ScriptedMetricAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketscript/BucketScriptPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketselector/BucketSelectorPipelineAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSourceParserHelper.java
core/src/main/java/org/elasticsearch/search/builder/SearchSourceBuilder.java
core/src/main/java/org/elasticsearch/search/sort/ScriptSortBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionBuilder.java
comments:
Remove getDefaultScriptingLanguage from QueryParseContext (#23043)

The method is not needed anymore, was needed only when we supported setting a legacy default lang, which was removed with #21607

Relates to #21607

time:
2017-02-08T23:59:24Z
class:
core/src/main/java/org/elasticsearch/search/lookup/LeafDocLookup.java
comments:
Fix generics on LeadDocLookup (#23060)

All the warnings were upsetting me. This doesn't change behavior.

time:
2017-02-08T20:23:38Z
class:
comments:
[Docs] Fix consoleify search-template.asciidoc

It does not reproduce well, hopefully this will fix the failure on DELETE _search/template/<templatename>.
You don't need `// TEST[continued]` *and* `// TESTREPONSE`. I'm not sure what having both of them does, actually.
I'll look at this again tomorrow.
I followed the README.asciidoc from /docs project which indicates:
```
* `// TESTRESPONSE`: Matches this snippet against the body of the response of
  the last test. If the response is JSON then order is ignored. With
  `// TEST[continued]` you can make tests that contain multiple command snippets
  and multiple response snippets.
```

so I guess it works
Arg! those should be on multiple lines....
Wait, now I need to reread....
Ok. Now I know what I meant. I'll rewrite it to make sense.
I pushed e39b96f257214ebcef3286df472fa9727edb88c1.
I pushed 63ea6f7168326d1687705c87671857d29cb9a783, thanks Nik

time:
2017-02-08T19:41:17Z
class:
comments:
Add Content-Type to README.textile

Relates to #23001

time:
2017-02-08T18:30:39Z
class:
comments:
Docs: CONSOLEify native script docs

Relates #23001

time:
2017-02-08T18:03:12Z
class:
core/src/main/java/org/elasticsearch/search/suggest/Suggest.java
core/src/main/java/org/elasticsearch/search/suggest/term/TermSuggestion.java
core/src/test/java/org/elasticsearch/search/suggest/SuggestionOptionTests.java
core/src/test/java/org/elasticsearch/search/suggest/TermSuggestionOptionTests.java
comments:
Add xcontent parsing to suggestion options (#23018)

This adds parsing from xContent to Suggestion.Entry.Option and
Termsuggestion.Entry.Option.

time:
2017-02-08T17:44:36Z
class:
comments:
Upgrade to Netty 4.1.8 (#23055)

This commit upgrades the Netty dependency to version 4.1.8.Final.

time:
2017-02-08T16:55:50Z
class:
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/rest/RestController.java
core/src/main/java/org/elasticsearch/rest/RestRequest.java
core/src/test/java/org/elasticsearch/action/bulk/BulkRequestTests.java
core/src/test/java/org/elasticsearch/rest/RestControllerTests.java
comments:
Remove ldjson support and document ndjson for bulk/msearch (#23049)

This commit removes support for the `application/x-ldjson` Content-Type header as this was only used in the first draft
of the spec and had very little uptake. Additionally, the docs for bulk and msearch have been updated to specifically
call out ndjson and mention that the newline character may be preceded by a carriage return.

Finally, the bulk request handling of the carriage return has been improved to remove this character from the source.

Closes #23025

time:
2017-02-08T16:12:40Z
class:
comments:
Docs: Fix termvectors by removing example blocks with embedded CONSOLE tests

time:
2017-02-08T16:05:22Z
class:
comments:
[Docs] Consoleify multi-search and search-template docs (#23047)

Relates #23001

time:
2017-02-08T15:41:41Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
comments:
Fix line len

time:
2017-02-08T15:06:11Z
class:
comments:
Docs: CONSOLEify termvectors.asciidoc (#23046)

time:
2017-02-08T14:27:08Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
comments:
Fork off a search thread before sending back fetched responses

This is just a temporary fix until #23048 is fixed. FieldCollapsing
is executing blocking calls on a network thread which causes potential deadlocks
and trips assertions.

Relates to #23048

time:
2017-02-08T13:40:08Z
class:
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/search/TransportNoopSearchAction.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/ClientScrollableHitSource.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestCountAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestCountAction.java
core/src/main/java/org/elasticsearch/search/SearchHit.java
core/src/main/java/org/elasticsearch/search/SearchHitField.java
core/src/main/java/org/elasticsearch/search/SearchHits.java
core/src/main/java/org/elasticsearch/search/SearchSortValues.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHits.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregator.java
core/src/main/java/org/elasticsearch/search/collapse/ExpandCollapseSearchResponseListener.java
core/src/main/java/org/elasticsearch/search/fetch/FetchPhase.java
core/src/main/java/org/elasticsearch/search/fetch/FetchSearchResult.java
core/src/main/java/org/elasticsearch/search/fetch/FetchSubPhase.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/DocValueFieldsFetchSubPhase.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/ExplainFetchSubPhase.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/InnerHitsContext.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/InnerHitsFetchSubPhase.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/MatchedQueriesFetchSubPhase.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/ParentFieldSubFetchPhase.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/ScriptFieldsFetchSubPhase.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/HighlightPhase.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/PlainHighlighter.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/PostingsHighlighter.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/UnifiedHighlighter.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHitField.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHits.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchResponse.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestion.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TasksIT.java
core/src/test/java/org/elasticsearch/action/bulk/BulkProcessorRetryIT.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/AsyncBulkByScrollActionTests.java
core/src/test/java/org/elasticsearch/action/search/SearchPhaseControllerTests.java
core/src/test/java/org/elasticsearch/aliases/IndexAliasesIT.java
core/src/test/java/org/elasticsearch/broadcast/BroadcastActionsIT.java
core/src/test/java/org/elasticsearch/bwcompat/IpFieldBwCompatIT.java
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/bwcompat/RepositoryUpgradabilityIT.java
core/src/test/java/org/elasticsearch/bwcompat/RestoreBackwardsCompatIT.java
core/src/test/java/org/elasticsearch/cluster/MinimumMasterNodesIT.java
core/src/test/java/org/elasticsearch/cluster/allocation/FilteringAllocationIT.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/document/DocumentActionsIT.java
core/src/test/java/org/elasticsearch/index/IndexWithShadowReplicasIT.java
core/src/test/java/org/elasticsearch/index/mapper/CopyToMapperIntegrationIT.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalValuesMapperIntegrationIT.java
core/src/test/java/org/elasticsearch/index/mapper/GeoPointFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/MultiFieldsIntegrationIT.java
core/src/test/java/org/elasticsearch/index/mapper/TokenCountFieldMapperIntegrationIT.java
core/src/test/java/org/elasticsearch/index/query/CommonTermsQueryParserTests.java
core/src/test/java/org/elasticsearch/index/store/ExceptionRetryIT.java
core/src/test/java/org/elasticsearch/indexing/IndexActionIT.java
core/src/test/java/org/elasticsearch/indices/flush/FlushIT.java
core/src/test/java/org/elasticsearch/indices/mapping/UpdateMappingIntegrationIT.java
core/src/test/java/org/elasticsearch/indices/recovery/IndexRecoveryIT.java
core/src/test/java/org/elasticsearch/indices/template/SimpleIndexTemplateIT.java
core/src/test/java/org/elasticsearch/recovery/RecoveryWhileUnderLoadIT.java
core/src/test/java/org/elasticsearch/recovery/RelocationIT.java
core/src/test/java/org/elasticsearch/routing/AliasRoutingIT.java
core/src/test/java/org/elasticsearch/routing/PartitionedRoutingIT.java
core/src/test/java/org/elasticsearch/routing/SimpleRoutingIT.java
core/src/test/java/org/elasticsearch/script/IndexLookupIT.java
core/src/test/java/org/elasticsearch/script/ScriptFieldIT.java
core/src/test/java/org/elasticsearch/search/InternalSearchHitTests.java
core/src/test/java/org/elasticsearch/search/InternalSearchHitsTests.java
core/src/test/java/org/elasticsearch/search/NestedIdentityTests.java
core/src/test/java/org/elasticsearch/search/SearchSortValuesTests.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregationsIntegrationIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/ChildrenIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateHistogramIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/AbstractGeoTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/TopHitsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHitsTests.java
core/src/test/java/org/elasticsearch/search/basic/SearchWhileRelocatingIT.java
core/src/test/java/org/elasticsearch/search/basic/TransportTwoNodesSearchIT.java
core/src/test/java/org/elasticsearch/search/child/ChildQuerySearchIT.java
core/src/test/java/org/elasticsearch/search/fetch/FetchSubPhasePluginIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/FetchSourceSubPhaseTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/InnerHitsIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/MatchedQueriesIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java
core/src/test/java/org/elasticsearch/search/fields/SearchFieldsIT.java
core/src/test/java/org/elasticsearch/search/functionscore/DecayFunctionScoreIT.java
core/src/test/java/org/elasticsearch/search/functionscore/ExplainableScriptIT.java
core/src/test/java/org/elasticsearch/search/functionscore/FunctionScoreFieldValueIT.java
core/src/test/java/org/elasticsearch/search/functionscore/FunctionScoreIT.java
core/src/test/java/org/elasticsearch/search/functionscore/FunctionScorePluginIT.java
core/src/test/java/org/elasticsearch/search/functionscore/QueryRescorerIT.java
core/src/test/java/org/elasticsearch/search/functionscore/RandomScoreFunctionIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoBoundingBoxIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoPolygonIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoShapeQueryTests.java
core/src/test/java/org/elasticsearch/search/morelikethis/MoreLikeThisIT.java
core/src/test/java/org/elasticsearch/search/nested/SimpleNestedIT.java
core/src/test/java/org/elasticsearch/search/preference/SearchPreferenceIT.java
core/src/test/java/org/elasticsearch/search/profile/query/QueryProfilerIT.java
core/src/test/java/org/elasticsearch/search/query/ExistsIT.java
core/src/test/java/org/elasticsearch/search/query/MultiMatchQueryIT.java
core/src/test/java/org/elasticsearch/search/query/QueryStringIT.java
core/src/test/java/org/elasticsearch/search/query/SearchQueryIT.java
core/src/test/java/org/elasticsearch/search/query/SimpleQueryStringIT.java
core/src/test/java/org/elasticsearch/search/scriptfilter/ScriptQuerySearchIT.java
core/src/test/java/org/elasticsearch/search/scroll/DuelScrollIT.java
core/src/test/java/org/elasticsearch/search/scroll/SearchScrollIT.java
core/src/test/java/org/elasticsearch/search/scroll/SearchScrollWithFailingNodesIT.java
core/src/test/java/org/elasticsearch/search/searchafter/SearchAfterIT.java
core/src/test/java/org/elasticsearch/search/sort/FieldSortIT.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceIT.java
core/src/test/java/org/elasticsearch/search/sort/SimpleSortIT.java
core/src/test/java/org/elasticsearch/search/source/MetadataFetchingIT.java
core/src/test/java/org/elasticsearch/search/source/SourceFetchingIT.java
core/src/test/java/org/elasticsearch/search/suggest/CompletionSuggestSearchIT.java
core/src/test/java/org/elasticsearch/similarity/SimilarityIT.java
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/versioning/SimpleVersioningIT.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateIT.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolatorHighlightSubFetchPhase.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorQuerySearchIT.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/DeleteByQueryBasicTests.java
modules/repository-url/src/test/java/org/elasticsearch/repositories/url/URLSnapshotRestoreTests.java
plugins/repository-azure/src/test/java/org/elasticsearch/repositories/azure/AzureSnapshotRestoreTests.java
plugins/repository-hdfs/src/test/java/org/elasticsearch/repositories/hdfs/HdfsTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AbstractS3SnapshotRestoreTest.java
plugins/store-smb/src/test/java/org/elasticsearch/index/store/AbstractAzureFsTestCase.java
test/framework/src/main/java/org/elasticsearch/repositories/blobstore/ESBlobStoreRepositoryIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/hamcrest/ElasticsearchAssertions.java
comments:
Fold InternalSearchHits and friends into their interfaces (#23042)

We have a bunch of interfaces that have only a single implementation
for 6 years now. These interfaces are pretty useless from a SW development
perspective and only add unnecessary abstractions. They also require
lots of casting in many places where we expect that there is only one
concrete implementation. This change removes the interfaces, makes
all of the classes final and removes the duplicate `foo` `getFoo` accessors
in favor of `getFoo` from these classes.

time:
2017-02-08T11:52:18Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
comments:
Raise a phase failure if fetch phase gets rejected

time:
2017-02-08T11:49:06Z
class:
core/src/main/java/org/elasticsearch/discovery/zen/MasterFaultDetection.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/test/java/org/elasticsearch/discovery/ZenFaultDetectionTests.java
comments:
MasterFaultDetection can start after the initial cluster state has been processed and the NodeConnectionService connect to the new master (#23037)

After the first cluster state from a new master is processed, NodeConnectionService guarantees we connect to the new master. This removes the need to explicitly connect to the master in the MasterFaultDetection code making it simpler and bypasses the assertion triggered due to the blocking operation on the cluster state thread.

Relates to #22828

time:
2017-02-08T10:49:15Z
class:
comments:
SENSE -> CONSOLE

time:
2017-02-08T10:47:42Z
class:
comments:
CONSOLEify multi-termvectors docs

Relates #23001

time:
2017-02-08T09:11:51Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/search/aggregations/AggregationPhase.java
core/src/main/java/org/elasticsearch/search/query/QuerySearchResult.java
core/src/test/java/org/elasticsearch/action/search/SearchPhaseControllerTests.java
comments:
Separate reduce (aggs, suggest and profile) from merging fetched hits (#23017)

Today we carry on all search results including aggs, suggest and profile results
until we have successfully fetched all hits for the search request. This can potentially
hold on to a large amount of memory if there are heavy aggregations involved. With
this change aggs and profiles are entirely consumed an released for GC before the fetch
phase is executing. This is a first step towards reducing results on-the-fly if the number
of non-empty response are large.

time:
2017-02-08T09:00:55Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/shards/IndicesShardStoresResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/shards/TransportIndicesShardStoresAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java
core/src/main/java/org/elasticsearch/cluster/routing/IndexRoutingTable.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/TransportNodesListGatewayStartedShards.java
core/src/main/java/org/elasticsearch/index/shard/ShardStateMetaData.java
core/src/test/java/org/elasticsearch/action/admin/indices/shards/IndicesShardStoreRequestIT.java
core/src/test/java/org/elasticsearch/action/admin/indices/shards/IndicesShardStoreResponseTests.java
core/src/test/java/org/elasticsearch/gateway/PrimaryShardAllocatorTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/ShardPathTests.java
core/src/test/java/org/elasticsearch/index/store/CorruptedFileIT.java
core/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsIT.java
test/framework/src/main/java/org/elasticsearch/test/gateway/TestGatewayAllocator.java
comments:
Remove legacy primary shard allocation mode based on versions (#23016)

Elasticsearch v5.0.0 uses allocation IDs to safely allocate primary shards whereas prior versions of ES used a version-based mode instead. Elasticsearch v5 still has support for version-based primary shard allocation as it needs to be able to load 2.x shards. ES v6 can drop the legacy support.

time:
2017-02-08T06:50:26Z
class:
core/src/test/java/org/elasticsearch/cluster/NoMasterNodeIT.java
comments:
Increase time out tolerance in NoMasterNodeIT.

see https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+master+multijob-intake/746/console

time:
2017-02-08T02:31:51Z
class:
core/src/main/java/org/elasticsearch/index/mapper/TypeParsers.java
core/src/test/java/org/elasticsearch/action/admin/indices/template/BWCTemplateTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperTests.java
comments:
Disallow include_in_all for 6.0+ indices

Since `_all` is now deprecated and cannot be set for new indices, we should also
disallow any field that has the `include_in_all` parameter set.

Resolves #22923

time:
2017-02-08T02:06:28Z
class:
comments:
Docs: CONSOLEify transport docs (#23027)

This is related to #23001.

time:
2017-02-07T22:25:46Z
class:
comments:
Small typo fix in Windows service documentation

This commit removes a duplicate definite article in the Windows service
documentation.

Relates #23028

time:
2017-02-07T21:49:01Z
class:
comments:
Docs: CONSOLEify some more docs

These need to be CONSOLEified *now* because we're starting to
require Content-Type headers and they didn't have any.

* cluster/reroute: Marked as CONSOLE but skipped because the docs
build runs with a single node.
* docs/bulk: Marked as NOTCONSOLE because the snippets describe
either examples or `curl` commands. Fixed the `curl` command to
include the `Content-Type` header.
* query-dsl/terms-query: Marked as CONSOLE.
* search/request/rescore: Marked as CONSOLE. Fixed deprecated
syntax.

Relates #23001
Relates #18160

time:
2017-02-07T21:09:32Z
class:
comments:
Docs: CONSOLEify histogram aggregation docs

This adds the `COPY AS CURL` and `VIEW IN CONSOLE` links to the docs
and causes the snippets to be tested during Elasticsearch's build.

Relates to #18160

time:
2017-02-07T20:41:50Z
class:
core/src/main/java/org/elasticsearch/common/io/FileSystemUtils.java
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
modules/repository-url/src/main/java/org/elasticsearch/common/blobstore/url/URLBlobContainer.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/network/Ec2NameResolver.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/plugin/discovery/ec2/Ec2DiscoveryPlugin.java
comments:
Add methods requiring connect to forbidden apis (#22964)

This is related to #22116. This commit adds calls that require
SocketPermission connect to forbidden APIs.

The following calls are now forbidden:

- java.net.URL#openStream()
- java.net.URLConnection#connect()
- java.net.URLConnection#getInputStream()
- java.net.Socket#connect(java.net.SocketAddress)
- java.net.Socket#connect(java.net.SocketAddress, int)
- java.nio.channels.SocketChannel#open(java.net.SocketAddress)
- java.nio.channels.SocketChannel#connect(java.net.SocketAddress)

time:
2017-02-07T20:11:32Z
class:
core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java
core/src/main/java/org/elasticsearch/cluster/node/DiscoveryNode.java
core/src/main/java/org/elasticsearch/common/CheckedBiConsumer.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/transport/ConnectionProfile.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/main/java/org/elasticsearch/transport/Transport.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/CancellableTasksTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TaskManagerTestCase.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TransportTasksActionTests.java
core/src/test/java/org/elasticsearch/client/transport/FailAndRetryMockTransport.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientHeadersTests.java
core/src/test/java/org/elasticsearch/cluster/NodeConnectionsServiceTests.java
core/src/test/java/org/elasticsearch/discovery/ZenFaultDetectionTests.java
core/src/test/java/org/elasticsearch/discovery/zen/PublishClusterStateActionTests.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/transport/ConnectionProfileTests.java
core/src/test/java/org/elasticsearch/transport/TCPTransportTests.java
core/src/test/java/org/elasticsearch/transport/TransportActionProxyTests.java
core/src/test/java/org/elasticsearch/transport/TransportServiceHandshakeTests.java
modules/transport-netty4/src/test/java/org/elasticsearch/transport/netty4/Netty4ScheduledPingTests.java
test/framework/src/main/java/org/elasticsearch/test/ClusterServiceUtils.java
test/framework/src/main/java/org/elasticsearch/test/transport/CapturingTransport.java
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
test/framework/src/main/java/org/elasticsearch/transport/MockTcpTransport.java
test/framework/src/test/java/org/elasticsearch/transport/MockTcpTransportTests.java
comments:
TransportService.connectToNode should validate remote node ID (#22828)

 #22194 gave us the ability to open low level temporary connections to remote node based on their address. With this use case out of the way, actual full blown connections should validate the node on the other side, making sure we speak to who we think we speak to. This helps in case where multiple nodes are started on the same host and a quick node restart causes them to swap addresses, which in turn can cause confusion down the road.

time:
2017-02-07T19:18:54Z
class:
comments:
Docs: CONSOLEify sum aggregation docs

This adds the `COPY AS CURL` and `VIEW IN CONSOLE` buttons to the
docs and makes the build execute the snippets as part of `docs:check`.

Relates to #18160

time:
2017-02-07T19:15:09Z
class:
comments:
CONSOLify indices/analyze.asciidoc and search/field-stats.asciidoc

Relates #23001

time:
2017-02-07T18:50:07Z
class:
core/src/test/java/org/elasticsearch/common/io/FileSystemUtilsTests.java
comments:
Fix broken test in FileSystemUtilsTests

Commit ee84ce09d77acb59700cd27c43b17661105dfcad changed an exception
message without changing the corresponding test. This commit fixes the
related test.

time:
2017-02-07T18:48:27Z
class:
comments:
Docs: CONSOLEify the avg aggregation docs

This creates the `COPY AS CURL` and `VIEW IN CONSOLE` buttons and
makes the build test the examples.

Relates to #18160

time:
2017-02-07T17:42:27Z
class:
core/src/main/java/org/elasticsearch/common/io/FileSystemUtils.java
comments:
Allow openFileURLStream(URL) to open jars

This is related to #23020. There are some cases for where this method
might be called with a URL to a file inside a jar. This commit allows
this method to read URLs with a protocol of 'jar:/'.

time:
2017-02-07T17:34:41Z
class:
core/src/main/java/org/elasticsearch/common/settings/AbstractScopedSettings.java
core/src/main/java/org/elasticsearch/common/settings/AddStringKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/KeyStoreWrapper.java
core/src/main/java/org/elasticsearch/common/settings/ListKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/RemoveSettingKeyStoreCommand.java
core/src/main/java/org/elasticsearch/common/settings/SecureSetting.java
core/src/main/java/org/elasticsearch/common/settings/SecureSettings.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/test/java/org/elasticsearch/common/settings/RemoveSettingKeyStoreCommandTests.java
core/src/test/java/org/elasticsearch/common/settings/ScopedSettingsTests.java
core/src/test/java/org/elasticsearch/common/settings/SettingsTests.java
plugins/repository-s3/src/main/java/org/elasticsearch/plugin/repository/s3/S3RepositoryPlugin.java
test/framework/src/main/java/org/elasticsearch/common/settings/MockSecureSettings.java
comments:
Settings: Add secure settings validation on startup (#22894)

Secure settings from the elasticsearch keystore were not yet validated.
This changed improves support in Settings so that secure settings more
seamlessly blend in with normal settings, allowing the existing settings
validation to work. Note that the setting names are still not validated
(yet) when using the elasticsearc-keystore tool.

time:
2017-02-07T17:09:22Z
class:
comments:
Docs: Explain painless's method dispatch (#23021)

Painless uses Ruby-like method dispatch (reciever type, method name,
and arity) rather than Java-like (reciever type, method name, and
argument compile time types) or Groovy-like method dispatch (receiver
type, method name, and argument run time types). We do this for
mostly good reasons but we never documented it.

Relates to #22720

time:
2017-02-07T16:24:22Z
class:
core/src/main/java/org/elasticsearch/Build.java
core/src/main/java/org/elasticsearch/common/io/FileSystemUtils.java
core/src/main/java/org/elasticsearch/index/analysis/Analysis.java
core/src/test/java/org/elasticsearch/BuildTests.java
core/src/test/java/org/elasticsearch/common/io/FileSystemUtilsTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
plugins/discovery-gce/src/test/java/org/elasticsearch/discovery/gce/GceMockUtils.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/InstallPluginCommandTests.java
test/framework/src/main/java/org/elasticsearch/bootstrap/BootstrapForTesting.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ESClientYamlSuiteTestCase.java
comments:
Add FileSystemUtil method to read 'file:/' URLs (#23020)

As part of #22116 we are going to forbid usage of api
java.net.URL#openStream(). However in a number of places across the
we use this method to read files from the local filesystem. This commit
introduces a helper method openFileURLStream(URL url) to read files
from URLs. It does specific validation to only ensure that file:/
urls are read.

Additionlly, this commit removes unneeded method
FileSystemUtil.newBufferedReader(URL, Charset). This method used the
openStream () method which will soon be forbidden. Instead we use the
Files.newBufferedReader(Path, Charset).

time:
2017-02-07T14:20:06Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/XContentType.java
core/src/main/java/org/elasticsearch/rest/RestController.java
core/src/main/java/org/elasticsearch/rest/RestHandler.java
core/src/main/java/org/elasticsearch/rest/action/document/RestBulkAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/test/java/org/elasticsearch/action/bulk/BulkRequestTests.java
core/src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
core/src/test/java/org/elasticsearch/rest/RestControllerTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestMultiSearchTemplateAction.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequestTests.java
comments:
Add support for newline delimited JSON Content-Type (#22947)

This commit adds support for the newline delimited JSON Content-Type, which is how
the bulk, multi-search, and multi-search template APIs expect data to be formatted. The
`elasticsearch-js` client has also been using this content type for these types of requests.

Closes #22943

time:
2017-02-07T11:09:39Z
class:
comments:
Update normalizers.asciidoc

analyzers -> normalizers

time:
2017-02-07T08:59:24Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterService.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
comments:
Add a setting to disable remote cluster connections on a node (#23005)

Today either all nodes in the cluster connect to remote clusters of only nodes
that have remote clusters configured in their node config. To allow global remote
cluster configuration but restrict connections to a set of nodes in the cluster
this change adds a new setting `search.remote.connect` (defaults to `true`) to allow
to disable remote cluster connections on a per node basis.

time:
2017-02-06T21:44:56Z
class:
core/src/main/java/org/elasticsearch/index/fielddata/AtomicFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/IndexNumericFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/ScriptDocValues.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AtomicLongFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/SortedNumericDVIndexFieldData.java
core/src/main/java/org/elasticsearch/index/mapper/DateFieldMapper.java
core/src/main/java/org/elasticsearch/search/aggregations/support/values/ScriptDoubleValues.java
core/src/main/java/org/elasticsearch/search/aggregations/support/values/ScriptLongValues.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/DocValueFieldsFetchSubPhase.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/ScriptFieldsFetchSubPhase.java
core/src/test/java/org/elasticsearch/index/fielddata/ScriptDocValuesLongsTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DateScriptMocks.java
core/src/test/java/org/elasticsearch/search/fields/SearchFieldsIT.java
comments:
Make dates be ReadableDateTimes in scripts (#22948)

Instead of longs. If you want millis since epoch you can call doc.date_field.value.millis.

Relates to #22875

time:
2017-02-06T20:27:15Z
class:
comments:
[Docs] Remove ignore_malformed from Geo Query DSL docs

This commit removes the ignore_malformed parameter from the Geo Query DSL documentation.

time:
2017-02-06T20:17:21Z
class:
core/src/main/java/org/elasticsearch/index/mapper/GeoPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/LatLonPointFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoPolygonQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/DecayFunctionBuilder.java
core/src/main/java/org/elasticsearch/indices/IndicesModule.java
core/src/main/java/org/elasticsearch/search/suggest/completion/context/GeoContextMapping.java
core/src/test/java/org/elasticsearch/index/fielddata/AbstractFieldDataTestCase.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalMapper.java
core/src/test/java/org/elasticsearch/index/mapper/GeoPointFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/GeoPointFieldTypeTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/valuecount/ValueCountAggregatorTests.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderTests.java
modules/lang-expression/src/main/java/org/elasticsearch/script/expression/ExpressionScriptEngineService.java
comments:
Remove GeoPointFieldMapper abstraction

In order to support the evolving GeoPoint encodings in Lucene 5 and 6, ES 2.x and 5.x implements an abstraction layer to the GeoPointFieldMapper classes. As of 5.x the geo_point field mapper settled on using Lucene's more performant LatLonPoint field type and deprecated all other encodings. In 6.0 all encodings except LatLonPoint have been removed rendering this abstraction layer useless. This commit removes the abstraction layer and renames the LatLonPointFieldMapper back to GeoPointFieldMapper to mantain consistency with ES field naming.

time:
2017-02-06T19:05:40Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvg.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/avg/AvgAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/avg/InternalAvgTests.java
comments:
[Tests] Adding tests for AvgAggregator and InternalAvg (#23000)

time:
2017-02-06T17:39:59Z
class:
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
comments:
This commit changes the exception type thrown when trying to (#22921)

create a snapshot with a name that already exists in the repository.
Instead of throwing a SnapshotCreateException, which results in a
generic 500 status code, a duplicate snapshot name will throw a
InvalidSnapshotNameException, which will result in a 400 status code
(bad request).

time:
2017-02-06T17:18:21Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/InternalAggregations.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogram.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregatorTests.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/histogram/InternalHistogramTests.java
comments:
Add unit tests to histogram aggregations. (#22961)

time:
2017-02-06T17:17:34Z
class:
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/FastVectorHighlighter.java
comments:
Expose `search.highlight.term_vector_multi_value` as a node level setting (#22999)

This setting was missed in the great settings refactoring and should be exposed
via node level settings.

time:
2017-02-06T16:44:29Z
class:
test/framework/src/main/java/org/elasticsearch/test/transport/MockTransportService.java
test/framework/src/main/java/org/elasticsearch/transport/AbstractSimpleTransportTestCase.java
comments:
MockTransportService should physically disconnect when simulating it (#22977)

This is in order to trigger listeners for disconnect events, most importantly the NodeFaultDetection.  MockTransportService now does slightly a better job at mimicking real life failures: connecting to already connected node will be a noop (we don't detect any errors here in production either) and failing to send will cause the target node to be disconnected.

This is the cause of failure in https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+5.2+multijob-unix-compatibility/os=debian/72

time:
2017-02-06T16:10:03Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/search/SearchType.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchHelper.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchScrollAction.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/search/SearchService.java
core/src/main/java/org/elasticsearch/search/fetch/FetchSearchResult.java
core/src/main/java/org/elasticsearch/search/fetch/FetchSearchResultProvider.java
core/src/main/java/org/elasticsearch/search/fetch/QueryFetchSearchResult.java
core/src/main/java/org/elasticsearch/search/internal/ShardSearchTransportRequest.java
core/src/main/java/org/elasticsearch/search/query/QueryPhase.java
core/src/main/java/org/elasticsearch/search/query/QuerySearchResult.java
core/src/main/java/org/elasticsearch/search/query/QuerySearchResultProvider.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TasksIT.java
core/src/test/java/org/elasticsearch/action/search/SearchPhaseControllerTests.java
core/src/test/java/org/elasticsearch/search/SearchWithRejectionsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/DiversifiedSamplerIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SamplerIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsIT.java
core/src/test/java/org/elasticsearch/search/basic/TransportTwoNodesSearchIT.java
core/src/test/java/org/elasticsearch/search/scroll/DuelScrollIT.java
comments:
Remove QUERY_AND_FETCH search type (#22996)

`QUERY_AND_FETCH` has been treated as an internal optimization for 2 major
versions. This commit removes the search type and it's implementation details and
folds the optimization in the case of a single shard into the search controller such
that every search with a single shard (non DFS) will receive this optimization.

time:
2017-02-06T15:32:41Z
class:
core/src/main/java/org/elasticsearch/cluster/NodeConnectionsService.java
core/src/test/java/org/elasticsearch/cluster/NodeConnectionsServiceTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
test/framework/src/main/java/org/elasticsearch/test/ClusterServiceUtils.java
comments:
Connect to new nodes concurrently (#22984)

When a node receives a new cluster state from the master, it opens up connections to any new node in the cluster state. That has always been done serially on the cluster state thread but it has been a long standing TODO to do this concurrently, which is done by this PR.

This is spin off of #22828, where an extra handshake is done whenever connecting to a node, which may slow down connecting. Also, the handshake is done in a blocking fashion which triggers assertions w.r.t blocking requests on the cluster state thread. Instead of adding an exception, I opted to implement concurrent connections which both side steps the assertion and compensates for the extra handshake.

time:
2017-02-06T14:16:16Z
class:
core/src/main/java/org/elasticsearch/bootstrap/JNAKernel32Library.java
comments:
added comment

time:
2017-02-06T14:16:16Z
class:
core/src/main/java/org/elasticsearch/bootstrap/JNAKernel32Library.java
comments:
Change `org.elasticsearch.bootstrap.JNAKernel32Library$SizeT` constructor's modifier to public.
Otherwise `NativeMappedConverter` can't construct this class.

Closes #22991

time:
2017-02-06T11:30:42Z
class:
core/src/main/java/org/elasticsearch/Build.java
core/src/main/java/org/elasticsearch/action/main/MainResponse.java
core/src/test/java/org/elasticsearch/action/main/MainResponseTests.java
comments:
Add parsing from xContent to MainResponse (#22934)

Add parsing from xContent to MainResponse

time:
2017-02-06T10:40:39Z
class:
core/src/test/java/org/elasticsearch/indices/recovery/IndexPrimaryRelocationIT.java
comments:
Revert "Reduce log-level of IndexPrimaryRelocationIT to hunt Heisenbug"

This reverts commit d0fa6a9bd8f0133bf1283ca94c8c94ba225cac8b.

time:
2017-02-06T09:02:31Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
5.2.1 is now on Lucene 6.4.1 too.

time:
2017-02-06T08:28:43Z
class:
core/src/main/java/org/apache/lucene/queries/BlendedTermQuery.java
core/src/main/java/org/elasticsearch/Version.java
comments:
Upgrade to Lucene 6.4.1. (#22978)

time:
2017-02-06T07:32:10Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/sum/InternalSum.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/sum/SumAggregator.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/sum/InternalSumTests.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/sum/SumAggregatorTests.java
comments:
[TEST] Added unit tests for sum aggs.

Relates to #22278

time:
2017-02-05T14:56:45Z
class:
comments:
[TEST] fix typo in cross cluster search docs

time:
2017-02-04T20:23:41Z
class:
comments:
Add a preface title

time:
2017-02-04T20:21:46Z
class:
comments:
Defguide link should not use {branch}

time:
2017-02-04T13:54:26Z
class:
client/rest-high-level/src/main/java/org/elasticsearch/client/Request.java
client/rest-high-level/src/main/java/org/elasticsearch/client/RestHighLevelClient.java
client/rest-high-level/src/test/java/org/elasticsearch/client/CrudIT.java
client/rest-high-level/src/test/java/org/elasticsearch/client/ESRestHighLevelClientTestCase.java
client/rest-high-level/src/test/java/org/elasticsearch/client/PingAndInfoIT.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RequestTests.java
client/rest-high-level/src/test/java/org/elasticsearch/client/RestHighLevelClientTests.java
comments:
Add get/exists method to RestHighLevelClient (#22706)

This commit adds support for get and exists api to the high level Java Rest Client. It also adds the infrastructure for other methods to be added in the future.

time:
2017-02-04T11:05:03Z
class:
comments:
Replaced absolute URLs in docs with attributes

time:
2017-02-04T10:42:45Z
class:
comments:
Use Versions.asciidoc for groovy docs too

time:
2017-02-04T10:16:19Z
class:
comments:
Centralised doc versions in docs/Versions.asciidoc

time:
2017-02-04T02:33:53Z
class:
comments:
Build: Disable fedora for packaging tests (#22974)

Now that debian is disabled, we are seeing similar failures with fedora
not able to install java. This commit temporarily disables fedora until
it is once again stable.

time:
2017-02-04T01:10:04Z
class:
comments:
Remove note about future ES version for content-type on master

time:
2017-02-04T00:49:35Z
class:
comments:
[DOCS] Low Level REST Client should emphasize ContentType (#22940)

This adds a callout to note that the Low Level REST Client example sets the `ContentType` explicitly and that users should do the same.

time:
2017-02-03T21:39:46Z
class:
core/src/main/java/org/elasticsearch/action/support/broadcast/BroadcastResponse.java
core/src/main/java/org/elasticsearch/action/support/replication/ReplicationOperation.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportWriteAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestRefreshAction.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationOperationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/gateway/RecoveryFromGatewayIT.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
comments:
Change certain replica failures not to fail the replica shard

This changes the way that replica failures are handled such that not all
failures will cause the replica shard to be failed or marked as stale.

In some cases such as refresh operations, or global checkpoint syncs, it is
"okay" for the operation to fail without the shard being failed (because no data
is out of sync). In these cases, instead of failing the shard we should simply
fail the operation, and, in the event it is a user-facing operation, return a
5xx response code including the shard-specific failures.

This was accomplished by having two forms of the `Replicas` proxy, one that is
for non-write operations that does not fail the shard, and one that is for write
operations that will fail the shard when an operation fails.

Relates to #10708

time:
2017-02-03T21:38:47Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/AnalyzerCaster.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Locals.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/FunctionRefTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/FunctionTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/LambdaTests.java
comments:
Painless: Don't allow casting from void to def (#22969)

Painless can cast anything into the magic type `def` but it
really shouldn't try to cast **nothing** into `def`. That causes
the byte code generation library to freak out a little.

Closes #22908

time:
2017-02-03T21:28:27Z
class:
core/src/main/java/org/elasticsearch/index/query/QueryStringQueryBuilder.java
core/src/test/java/org/elasticsearch/index/query/QueryStringQueryBuilderTests.java
comments:
Fix name of `enable_position_increments` (#22895)

It was accidentally renamed `enabled_position_increment` in the cleanups
for 5.0. This adds `enable_position_increment` as a deprecated alias
so it will continue to work.

time:
2017-02-03T20:57:21Z
class:
comments:
Build: Temporarily remove debian 8 for packaging tests (#22967)

Debian 8 has been having issues with the openjdk package dependencies
being broken. This comment comments out debian-8 from the boxes which
packaging tests will run on CI.

time:
2017-02-03T18:00:49Z
class:
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RethrottleTests.java
comments:
Test: weaken assertion in fix sliced reindex test

This test was using initial count of slices instead of the count
of unfinished slices to pick the expected throttle. Unfortunely
due to race conditions the actual rethrottle count is between the
two. So we weaken the assertion from "the new throttle is exactly X"
to "the new throttle is between X and Y (inclusive)".

time:
2017-02-03T17:30:42Z
class:
comments:
[TEST] remove stored scripts rolling upgrade test as it doesn't apply to 6.0

time:
2017-02-03T16:52:48Z
class:
comments:
Prepare Vagrantfile tests for SLES12-SP2

SLES-12 SP2 has a system package available for
java-1_8_0-openjdk and thus we can deprecate the OpenSUSE additional
repo.

Also remove the `src rpm` repo which is not needed as we don't build
packages from source and complains about missing `media.2` directory.

Relates #22862

time:
2017-02-03T16:08:00Z
class:
core/src/main/java/org/apache/lucene/spatial/geopoint/search/XGeoPointDistanceRangeQuery.java
core/src/main/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/GeoPolygonQueryBuilder.java
core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java
core/src/test/java/org/elasticsearch/index/query/GeoBoundingBoxQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoDistanceQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/GeoPolygonQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/query/QueryDSLDocumentationTests.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderTests.java
comments:
Remove deprecated geo query parameters, and GeoPointDistanceRangeQuery

This commit removes the following queries and parameters (which were deprecated in 5.0):

* GeoPointDistanceRangeQuery
* coerce, and ignore_malformed for GeoBoundingBoxQuery, GeoDistanceQuery, GeoPolygonQuery, and GeoDistanceSort

time:
2017-02-03T15:49:12Z
class:
comments:
[DOCS] Add sloppy_arc and factor removal to 6.0 migration docs

time:
2017-02-03T15:39:56Z
class:
modules/repository-url/src/main/java/org/elasticsearch/common/blobstore/url/URLBlobContainer.java
plugins/repository-hdfs/src/main/java/org/elasticsearch/repositories/hdfs/HdfsBlobContainer.java
comments:
Remove connect SocketPermissions from core (#22797)

This is related to #22116. Core no longer needs `SocketPermission`
`connect`.

This permission is relegated to these modules/plugins:
- transport-netty4 module
- reindex module
- repository-url module
- discovery-azure-classic plugin
- discovery-ec2 plugin
- discovery-gce plugin
- repository-azure plugin
- repository-gcs plugin
- repository-hdfs plugin
- repository-s3 plugin

And for tests:
- mocksocket jar
- rest client
- httpcore-nio jar
- httpasyncclient jar

time:
2017-02-03T15:20:15Z
class:
comments:
Remove POTM file after merging with master branch

time:
2017-02-03T15:16:51Z
class:
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpRequest.java
comments:
Fixing compilation problem in Eclipse (#22956)

time:
2017-02-03T15:15:44Z
class:
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/ops/bulk/BulkBenchmarkTask.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/rest/RestClientBenchmark.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/transport/TransportClientBenchmark.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/RestNoopBulkAction.java
client/rest/src/main/java/org/elasticsearch/client/HttpAsyncResponseConsumerFactory.java
client/rest/src/main/java/org/elasticsearch/client/RestClient.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostIntegTests.java
core/src/main/java/org/apache/lucene/search/grouping/CollapseTopFieldDocs.java
core/src/main/java/org/apache/lucene/search/grouping/CollapsingDocValuesSource.java
core/src/main/java/org/apache/lucene/search/suggest/analyzing/XAnalyzingSuggester.java
core/src/main/java/org/elasticsearch/ExceptionsHelper.java
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/action/ListenableActionFuture.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/cancel/TransportCancelTasksAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/SnapshotIndexShardStage.java
core/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/Condition.java
core/src/main/java/org/elasticsearch/action/admin/indices/shards/TransportIndicesShardStoresAction.java
core/src/main/java/org/elasticsearch/action/bulk/BackoffPolicy.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequestHandler.java
core/src/main/java/org/elasticsearch/action/bulk/Retry.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/WorkingBulkByScrollTask.java
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/ParsedScrollId.java
core/src/main/java/org/elasticsearch/action/search/ScrollIdForNode.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/support/ActionFilter.java
core/src/main/java/org/elasticsearch/action/support/ActionFilterChain.java
core/src/main/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeAction.java
core/src/main/java/org/elasticsearch/action/support/master/info/TransportClusterInfoAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/tasks/TransportTasksAction.java
core/src/main/java/org/elasticsearch/action/termvectors/TermVectorsFields.java
core/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java
core/src/main/java/org/elasticsearch/bootstrap/ESPolicy.java
core/src/main/java/org/elasticsearch/bootstrap/JNAKernel32Library.java
core/src/main/java/org/elasticsearch/bootstrap/SystemCallFilter.java
core/src/main/java/org/elasticsearch/cli/Command.java
core/src/main/java/org/elasticsearch/client/ElasticsearchClient.java
core/src/main/java/org/elasticsearch/client/support/AbstractClient.java
core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java
core/src/main/java/org/elasticsearch/cluster/AbstractDiffable.java
core/src/main/java/org/elasticsearch/cluster/AbstractNamedDiffable.java
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateObserver.java
core/src/main/java/org/elasticsearch/cluster/DiffableUtils.java
core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/AliasOrIndex.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolver.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/common/bytes/BytesReferenceStreamInput.java
core/src/main/java/org/elasticsearch/common/cache/Cache.java
core/src/main/java/org/elasticsearch/common/collect/CopyOnWriteHashMap.java
core/src/main/java/org/elasticsearch/common/collect/Iterators.java
core/src/main/java/org/elasticsearch/common/geo/SpatialStrategy.java
core/src/main/java/org/elasticsearch/common/geo/builders/ShapeBuilder.java
core/src/main/java/org/elasticsearch/common/inject/ConstantFactory.java
core/src/main/java/org/elasticsearch/common/inject/DeferredLookups.java
core/src/main/java/org/elasticsearch/common/inject/EncounterImpl.java
core/src/main/java/org/elasticsearch/common/inject/ExposedKeyFactory.java
core/src/main/java/org/elasticsearch/common/inject/Initializer.java
core/src/main/java/org/elasticsearch/common/inject/InjectionRequestProcessor.java
core/src/main/java/org/elasticsearch/common/inject/InternalFactoryToProviderAdapter.java
core/src/main/java/org/elasticsearch/common/inject/Key.java
core/src/main/java/org/elasticsearch/common/inject/ProviderToInternalFactoryAdapter.java
core/src/main/java/org/elasticsearch/common/inject/SingleFieldInjector.java
core/src/main/java/org/elasticsearch/common/inject/SingleMethodInjector.java
core/src/main/java/org/elasticsearch/common/inject/assistedinject/AssistedConstructor.java
core/src/main/java/org/elasticsearch/common/inject/assistedinject/Parameter.java
core/src/main/java/org/elasticsearch/common/inject/assistedinject/ParameterListKey.java
core/src/main/java/org/elasticsearch/common/inject/internal/NullOutputException.java
core/src/main/java/org/elasticsearch/common/inject/matcher/AbstractMatcher.java
core/src/main/java/org/elasticsearch/common/inject/matcher/Matchers.java
core/src/main/java/org/elasticsearch/common/inject/name/NamedImpl.java
core/src/main/java/org/elasticsearch/common/io/stream/Writeable.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/FiltersFunctionScoreQuery.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/FunctionScoreQuery.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/ScriptScoreFunction.java
core/src/main/java/org/elasticsearch/common/lucene/uid/PerThreadIDAndVersionLookup.java
core/src/main/java/org/elasticsearch/common/recycler/Recyclers.java
core/src/main/java/org/elasticsearch/common/rounding/DateTimeUnit.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/util/BigByteArray.java
core/src/main/java/org/elasticsearch/common/util/BigDoubleArray.java
core/src/main/java/org/elasticsearch/common/util/BigFloatArray.java
core/src/main/java/org/elasticsearch/common/util/BigIntArray.java
core/src/main/java/org/elasticsearch/common/util/BigLongArray.java
core/src/main/java/org/elasticsearch/common/util/BigObjectArray.java
core/src/main/java/org/elasticsearch/common/util/CollectionUtils.java
core/src/main/java/org/elasticsearch/common/util/LongObjectPagedHashMap.java
core/src/main/java/org/elasticsearch/common/util/concurrent/EsExecutors.java
core/src/main/java/org/elasticsearch/common/util/concurrent/PrioritizedEsThreadPoolExecutor.java
core/src/main/java/org/elasticsearch/common/xcontent/ConstructingObjectParser.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/gateway/AsyncShardFetch.java
core/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java
core/src/main/java/org/elasticsearch/gateway/MetaDataStateFormat.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/ReplicaShardAllocator.java
core/src/main/java/org/elasticsearch/index/IndexModule.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/IndexWarmer.java
core/src/main/java/org/elasticsearch/index/SearchSlowLog.java
core/src/main/java/org/elasticsearch/index/analysis/CharMatcher.java
core/src/main/java/org/elasticsearch/index/cache/query/QueryCache.java
core/src/main/java/org/elasticsearch/index/engine/DeleteVersionValue.java
core/src/main/java/org/elasticsearch/index/engine/ElasticsearchConcurrentMergeScheduler.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/LiveVersionMap.java
core/src/main/java/org/elasticsearch/index/engine/VersionValue.java
core/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/IndexFieldDataCache.java
core/src/main/java/org/elasticsearch/index/fielddata/IndexNumericFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/SingletonSortedNumericDoubleValues.java
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/SinglePackedOrdinals.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractIndexGeoPointFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractIndexOrdinalsFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/ParentChildIndexFieldData.java
core/src/main/java/org/elasticsearch/index/mapper/AllFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/BinaryFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/CustomDocValuesField.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java
core/src/main/java/org/elasticsearch/index/mapper/DynamicTemplate.java
core/src/main/java/org/elasticsearch/index/mapper/FieldNamesFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/FieldTypeLookup.java
core/src/main/java/org/elasticsearch/index/mapper/IdFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IndexFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/KeywordFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/MappedFieldType.java
core/src/main/java/org/elasticsearch/index/mapper/ObjectMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ParentFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/RoutingFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/SeqNoFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TermBasedFieldType.java
core/src/main/java/org/elasticsearch/index/mapper/TypeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/UidFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/VersionFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/RegexpFlag.java
core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryParser.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringFlag.java
core/src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/DecayFunctionBuilder.java
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
core/src/main/java/org/elasticsearch/index/search/MultiMatchQuery.java
core/src/main/java/org/elasticsearch/index/shard/CommitPoint.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/LocalShardSnapshot.java
core/src/main/java/org/elasticsearch/index/shard/SnapshotStatus.java
core/src/main/java/org/elasticsearch/index/store/Store.java
core/src/main/java/org/elasticsearch/index/translog/Checkpoint.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/index/translog/TranslogSnapshot.java
core/src/main/java/org/elasticsearch/index/translog/TranslogWriter.java
core/src/main/java/org/elasticsearch/indices/IndexingMemoryController.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/flush/SyncedFlushService.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryState.java
core/src/main/java/org/elasticsearch/indices/store/IndicesStore.java
core/src/main/java/org/elasticsearch/ingest/IngestMetadata.java
core/src/main/java/org/elasticsearch/ingest/InternalTemplateService.java
core/src/main/java/org/elasticsearch/monitor/fs/FsService.java
core/src/main/java/org/elasticsearch/monitor/jvm/JvmGcMonitorService.java
core/src/main/java/org/elasticsearch/monitor/os/OsService.java
core/src/main/java/org/elasticsearch/monitor/process/ProcessService.java
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
core/src/main/java/org/elasticsearch/plugins/ProgressInputStream.java
core/src/main/java/org/elasticsearch/repositories/RepositoriesService.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/rest/BytesRestResponse.java
core/src/main/java/org/elasticsearch/rest/RestController.java
core/src/main/java/org/elasticsearch/rest/action/cat/AbstractCatAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTable.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/BestBucketsDeferringCollector.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/BestDocsDeferringCollector.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/MultiBucketsAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/adjacency/AdjacencyMatrixAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoGridAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/InternalGeoHashGrid.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedBytesHashSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedMapSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedNumericSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedOrdinalsSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantLongTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/AbstractStringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalOrder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/Terms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/support/IncludeExclude.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/HyperLogLogPlusPlus.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/InternalGeoBounds.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentilesMethod.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/AbstractInternalHDRPercentiles.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/AbstractInternalTDigestPercentiles.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ExtendedStats.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/BucketHelpers.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValueType.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSource.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/CustomQueryScorer.java
core/src/main/java/org/elasticsearch/search/profile/query/ProfileCollector.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggester.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/completion/context/ContextMappings.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/CandidateScorer.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionContext.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/StupidBackoffScorer.java
core/src/main/java/org/elasticsearch/search/suggest/term/TermSuggestionContext.java
core/src/main/java/org/elasticsearch/snapshots/RestoreService.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java
core/src/main/java/org/elasticsearch/tasks/TaskManager.java
core/src/main/java/org/elasticsearch/threadpool/ExecutorBuilder.java
core/src/main/java/org/elasticsearch/threadpool/FixedExecutorBuilder.java
core/src/main/java/org/elasticsearch/threadpool/ScalingExecutorBuilder.java
core/src/main/java/org/elasticsearch/transport/RequestHandlerRegistry.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/main/java/org/elasticsearch/transport/TransportInterceptor.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/main/java/org/elasticsearch/watcher/FileWatcher.java
core/src/test/java/org/apache/lucene/grouping/CollapsingTopDocsCollectorTests.java
core/src/test/java/org/elasticsearch/action/ActionModuleTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TestTaskPlugin.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TransportTasksActionTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/shards/IndicesShardStoreRequestIT.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionTookTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/AsyncBulkByScrollActionTests.java
core/src/test/java/org/elasticsearch/action/support/TransportActionFilterChainTests.java
core/src/test/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/BroadcastReplicationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationOperationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationActionTests.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapCheckTests.java
core/src/test/java/org/elasticsearch/bwcompat/RepositoryUpgradabilityIT.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientNodesServiceTests.java
core/src/test/java/org/elasticsearch/cluster/action/shard/ShardStateActionTests.java
core/src/test/java/org/elasticsearch/cluster/routing/DelayedAllocationServiceTests.java
core/src/test/java/org/elasticsearch/cluster/routing/RoutingServiceTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/BalanceConfigurationTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
core/src/test/java/org/elasticsearch/common/ChannelsTests.java
core/src/test/java/org/elasticsearch/common/UUIDTests.java
core/src/test/java/org/elasticsearch/common/cache/CacheTests.java
core/src/test/java/org/elasticsearch/common/io/stream/BytesStreamsTests.java
core/src/test/java/org/elasticsearch/common/io/stream/NamedWriteableRegistryTests.java
core/src/test/java/org/elasticsearch/common/io/stream/StreamTests.java
core/src/test/java/org/elasticsearch/common/network/NetworkModuleTests.java
core/src/test/java/org/elasticsearch/common/util/concurrent/RefCountedTests.java
core/src/test/java/org/elasticsearch/common/xcontent/ConstructingObjectParserTests.java
core/src/test/java/org/elasticsearch/discovery/BlockingClusterStatePublishResponseHandlerTests.java
core/src/test/java/org/elasticsearch/discovery/ZenFaultDetectionTests.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/gateway/AsyncShardFetchTests.java
core/src/test/java/org/elasticsearch/gateway/GatewayMetaStateTests.java
core/src/test/java/org/elasticsearch/gateway/MetaDataStateFormatTests.java
core/src/test/java/org/elasticsearch/gateway/PrimaryShardAllocatorTests.java
core/src/test/java/org/elasticsearch/gateway/ReplicaShardAllocatorTests.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalMapper.java
core/src/test/java/org/elasticsearch/index/mapper/FieldNamesFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/FieldTypeLookupTests.java
core/src/test/java/org/elasticsearch/index/query/MockRepeatAnalyzer.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryParserTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexSearcherWrapperTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/NewPathForShardTests.java
core/src/test/java/org/elasticsearch/index/shard/ShardPathTests.java
core/src/test/java/org/elasticsearch/index/snapshots/blobstore/SlicedInputStreamTests.java
core/src/test/java/org/elasticsearch/index/store/IndexStoreTests.java
core/src/test/java/org/elasticsearch/index/store/StoreTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
core/src/test/java/org/elasticsearch/indices/IndexingMemoryControllerTests.java
core/src/test/java/org/elasticsearch/indices/IndicesRequestCacheTests.java
core/src/test/java/org/elasticsearch/indices/recovery/IndexRecoveryIT.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySourceHandlerTests.java
core/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsIT.java
core/src/test/java/org/elasticsearch/ingest/PipelineExecutionServiceTests.java
comments:
Merge branch 'master' into fix/22077-ingest-attachment

# Conflicts:
#	plugins/ingest-attachment/src/test/resources/org/elasticsearch/ingest/attachment/test/tika-files.zip

time:
2017-02-03T15:11:16Z
class:
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
comments:
Merge remote-tracking branch 'origin/master'

time:
2017-02-03T15:08:51Z
class:
plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/TikaDocTests.java
comments:
Use PathUtils instead of Paths

time:
2017-02-03T15:08:27Z
class:
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
comments:
Reindex: do not log when can't clear old scroll (#22942)

Versions of Elasticsearch prior to 2.0 would return a scroll id
even with the last scroll response. They'd then automatically
clear the scroll because it is empty. When terminating reindex
will attempt to clear the last scroll it received, regardless of
the remote version. This quiets the warning when the scroll cannot
be cleared for versions before 2.0.

Closes #22937

time:
2017-02-03T15:02:30Z
class:
plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/TikaDocTests.java
comments:
Merge branch 'fix/22958-tika-files-zip'

time:
2017-02-03T14:46:44Z
class:
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/ops/bulk/BulkBenchmarkTask.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/rest/RestClientBenchmark.java
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/transport/TransportClientBenchmark.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/RestNoopBulkAction.java
client/rest/src/main/java/org/elasticsearch/client/HttpAsyncResponseConsumerFactory.java
client/rest/src/main/java/org/elasticsearch/client/RestClient.java
client/rest/src/test/java/org/elasticsearch/client/RestClientSingleHostIntegTests.java
core/src/main/java/org/apache/lucene/search/grouping/CollapseTopFieldDocs.java
core/src/main/java/org/apache/lucene/search/grouping/CollapsingDocValuesSource.java
core/src/main/java/org/apache/lucene/search/suggest/analyzing/XAnalyzingSuggester.java
core/src/main/java/org/elasticsearch/ExceptionsHelper.java
core/src/main/java/org/elasticsearch/action/ActionModule.java
core/src/main/java/org/elasticsearch/action/ListenableActionFuture.java
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/cancel/TransportCancelTasksAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/status/SnapshotIndexShardStage.java
core/src/main/java/org/elasticsearch/action/admin/indices/get/GetIndexRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/rollover/Condition.java
core/src/main/java/org/elasticsearch/action/admin/indices/shards/TransportIndicesShardStoresAction.java
core/src/main/java/org/elasticsearch/action/bulk/BackoffPolicy.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequestHandler.java
core/src/main/java/org/elasticsearch/action/bulk/Retry.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/WorkingBulkByScrollTask.java
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/ParsedScrollId.java
core/src/main/java/org/elasticsearch/action/search/ScrollIdForNode.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/main/java/org/elasticsearch/action/support/ActionFilter.java
core/src/main/java/org/elasticsearch/action/support/ActionFilterChain.java
core/src/main/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeAction.java
core/src/main/java/org/elasticsearch/action/support/master/info/TransportClusterInfoAction.java
core/src/main/java/org/elasticsearch/action/support/replication/TransportReplicationAction.java
core/src/main/java/org/elasticsearch/action/support/tasks/TransportTasksAction.java
core/src/main/java/org/elasticsearch/action/termvectors/TermVectorsFields.java
core/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java
core/src/main/java/org/elasticsearch/bootstrap/BootstrapChecks.java
core/src/main/java/org/elasticsearch/bootstrap/ESPolicy.java
core/src/main/java/org/elasticsearch/bootstrap/JNAKernel32Library.java
core/src/main/java/org/elasticsearch/bootstrap/SystemCallFilter.java
core/src/main/java/org/elasticsearch/cli/Command.java
core/src/main/java/org/elasticsearch/client/ElasticsearchClient.java
core/src/main/java/org/elasticsearch/client/support/AbstractClient.java
core/src/main/java/org/elasticsearch/client/transport/TransportClientNodesService.java
core/src/main/java/org/elasticsearch/cluster/AbstractDiffable.java
core/src/main/java/org/elasticsearch/cluster/AbstractNamedDiffable.java
core/src/main/java/org/elasticsearch/cluster/ClusterState.java
core/src/main/java/org/elasticsearch/cluster/ClusterStateObserver.java
core/src/main/java/org/elasticsearch/cluster/DiffableUtils.java
core/src/main/java/org/elasticsearch/cluster/action/shard/ShardStateAction.java
core/src/main/java/org/elasticsearch/cluster/metadata/AliasOrIndex.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexNameExpressionResolver.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java
core/src/main/java/org/elasticsearch/cluster/routing/RoutingTable.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/allocator/BalancedShardsAllocator.java
core/src/main/java/org/elasticsearch/cluster/service/ClusterService.java
core/src/main/java/org/elasticsearch/common/bytes/BytesReferenceStreamInput.java
core/src/main/java/org/elasticsearch/common/cache/Cache.java
core/src/main/java/org/elasticsearch/common/collect/CopyOnWriteHashMap.java
core/src/main/java/org/elasticsearch/common/collect/Iterators.java
core/src/main/java/org/elasticsearch/common/geo/SpatialStrategy.java
core/src/main/java/org/elasticsearch/common/geo/builders/ShapeBuilder.java
core/src/main/java/org/elasticsearch/common/inject/ConstantFactory.java
core/src/main/java/org/elasticsearch/common/inject/DeferredLookups.java
core/src/main/java/org/elasticsearch/common/inject/EncounterImpl.java
core/src/main/java/org/elasticsearch/common/inject/ExposedKeyFactory.java
core/src/main/java/org/elasticsearch/common/inject/Initializer.java
core/src/main/java/org/elasticsearch/common/inject/InjectionRequestProcessor.java
core/src/main/java/org/elasticsearch/common/inject/InternalFactoryToProviderAdapter.java
core/src/main/java/org/elasticsearch/common/inject/Key.java
core/src/main/java/org/elasticsearch/common/inject/ProviderToInternalFactoryAdapter.java
core/src/main/java/org/elasticsearch/common/inject/SingleFieldInjector.java
core/src/main/java/org/elasticsearch/common/inject/SingleMethodInjector.java
core/src/main/java/org/elasticsearch/common/inject/assistedinject/AssistedConstructor.java
core/src/main/java/org/elasticsearch/common/inject/assistedinject/Parameter.java
core/src/main/java/org/elasticsearch/common/inject/assistedinject/ParameterListKey.java
core/src/main/java/org/elasticsearch/common/inject/internal/NullOutputException.java
core/src/main/java/org/elasticsearch/common/inject/matcher/AbstractMatcher.java
core/src/main/java/org/elasticsearch/common/inject/matcher/Matchers.java
core/src/main/java/org/elasticsearch/common/inject/name/NamedImpl.java
core/src/main/java/org/elasticsearch/common/io/stream/Writeable.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/FiltersFunctionScoreQuery.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/FunctionScoreQuery.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/ScriptScoreFunction.java
core/src/main/java/org/elasticsearch/common/lucene/uid/PerThreadIDAndVersionLookup.java
core/src/main/java/org/elasticsearch/common/recycler/Recyclers.java
core/src/main/java/org/elasticsearch/common/rounding/DateTimeUnit.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/util/BigByteArray.java
core/src/main/java/org/elasticsearch/common/util/BigDoubleArray.java
core/src/main/java/org/elasticsearch/common/util/BigFloatArray.java
core/src/main/java/org/elasticsearch/common/util/BigIntArray.java
core/src/main/java/org/elasticsearch/common/util/BigLongArray.java
core/src/main/java/org/elasticsearch/common/util/BigObjectArray.java
core/src/main/java/org/elasticsearch/common/util/CollectionUtils.java
core/src/main/java/org/elasticsearch/common/util/LongObjectPagedHashMap.java
core/src/main/java/org/elasticsearch/common/util/concurrent/EsExecutors.java
core/src/main/java/org/elasticsearch/common/util/concurrent/PrioritizedEsThreadPoolExecutor.java
core/src/main/java/org/elasticsearch/common/xcontent/ConstructingObjectParser.java
core/src/main/java/org/elasticsearch/discovery/zen/ZenDiscovery.java
core/src/main/java/org/elasticsearch/gateway/AsyncShardFetch.java
core/src/main/java/org/elasticsearch/gateway/GatewayAllocator.java
core/src/main/java/org/elasticsearch/gateway/MetaDataStateFormat.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/main/java/org/elasticsearch/gateway/ReplicaShardAllocator.java
core/src/main/java/org/elasticsearch/index/IndexModule.java
core/src/main/java/org/elasticsearch/index/IndexService.java
core/src/main/java/org/elasticsearch/index/IndexWarmer.java
core/src/main/java/org/elasticsearch/index/SearchSlowLog.java
core/src/main/java/org/elasticsearch/index/analysis/CharMatcher.java
core/src/main/java/org/elasticsearch/index/cache/query/QueryCache.java
core/src/main/java/org/elasticsearch/index/engine/DeleteVersionValue.java
core/src/main/java/org/elasticsearch/index/engine/ElasticsearchConcurrentMergeScheduler.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/engine/LiveVersionMap.java
core/src/main/java/org/elasticsearch/index/engine/VersionValue.java
core/src/main/java/org/elasticsearch/index/fielddata/IndexFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/IndexFieldDataCache.java
core/src/main/java/org/elasticsearch/index/fielddata/IndexNumericFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/SingletonSortedNumericDoubleValues.java
core/src/main/java/org/elasticsearch/index/fielddata/ordinals/SinglePackedOrdinals.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractIndexGeoPointFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/AbstractIndexOrdinalsFieldData.java
core/src/main/java/org/elasticsearch/index/fielddata/plain/ParentChildIndexFieldData.java
core/src/main/java/org/elasticsearch/index/mapper/AllFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/BinaryFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/CustomDocValuesField.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java
core/src/main/java/org/elasticsearch/index/mapper/DynamicTemplate.java
core/src/main/java/org/elasticsearch/index/mapper/FieldNamesFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/FieldTypeLookup.java
core/src/main/java/org/elasticsearch/index/mapper/IdFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/IndexFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/KeywordFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/MappedFieldType.java
core/src/main/java/org/elasticsearch/index/mapper/ObjectMapper.java
core/src/main/java/org/elasticsearch/index/mapper/ParentFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/RoutingFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/SeqNoFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/TermBasedFieldType.java
core/src/main/java/org/elasticsearch/index/mapper/TypeFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/UidFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/VersionFieldMapper.java
core/src/main/java/org/elasticsearch/index/query/RegexpFlag.java
core/src/main/java/org/elasticsearch/index/query/ScriptQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryParser.java
core/src/main/java/org/elasticsearch/index/query/SimpleQueryStringFlag.java
core/src/main/java/org/elasticsearch/index/query/TermsQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/DecayFunctionBuilder.java
core/src/main/java/org/elasticsearch/index/search/MatchQuery.java
core/src/main/java/org/elasticsearch/index/search/MultiMatchQuery.java
core/src/main/java/org/elasticsearch/index/shard/CommitPoint.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/shard/LocalShardSnapshot.java
core/src/main/java/org/elasticsearch/index/shard/SnapshotStatus.java
core/src/main/java/org/elasticsearch/index/store/Store.java
core/src/main/java/org/elasticsearch/index/translog/Checkpoint.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/index/translog/TranslogSnapshot.java
core/src/main/java/org/elasticsearch/index/translog/TranslogWriter.java
core/src/main/java/org/elasticsearch/indices/IndexingMemoryController.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/main/java/org/elasticsearch/indices/flush/SyncedFlushService.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryState.java
core/src/main/java/org/elasticsearch/indices/store/IndicesStore.java
core/src/main/java/org/elasticsearch/ingest/IngestMetadata.java
core/src/main/java/org/elasticsearch/ingest/InternalTemplateService.java
core/src/main/java/org/elasticsearch/monitor/fs/FsService.java
core/src/main/java/org/elasticsearch/monitor/jvm/JvmGcMonitorService.java
core/src/main/java/org/elasticsearch/monitor/os/OsService.java
core/src/main/java/org/elasticsearch/monitor/process/ProcessService.java
core/src/main/java/org/elasticsearch/plugins/InstallPluginCommand.java
core/src/main/java/org/elasticsearch/plugins/ProgressInputStream.java
core/src/main/java/org/elasticsearch/repositories/RepositoriesService.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreRepository.java
core/src/main/java/org/elasticsearch/rest/BytesRestResponse.java
core/src/main/java/org/elasticsearch/rest/RestController.java
core/src/main/java/org/elasticsearch/rest/action/cat/AbstractCatAction.java
core/src/main/java/org/elasticsearch/rest/action/cat/RestTable.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/BestBucketsDeferringCollector.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/BestDocsDeferringCollector.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/MultiBucketsAggregation.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/adjacency/AdjacencyMatrixAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoGridAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/GeoHashGridAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/geogrid/InternalGeoHashGrid.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/DateHistogramAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/HistogramAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/NestedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/nested/ReverseNestedAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedBytesHashSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedMapSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedNumericSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/sampler/DiversifiedOrdinalsSamplerAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantLongTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/significant/SignificantTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/AbstractStringTermsAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/DoubleTerms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/InternalOrder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/Terms.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/terms/support/IncludeExclude.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/CardinalityAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/cardinality/HyperLogLogPlusPlus.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/geobounds/InternalGeoBounds.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/PercentilesMethod.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/hdr/AbstractInternalHDRPercentiles.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/percentiles/tdigest/AbstractInternalTDigestPercentiles.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/stats/extended/ExtendedStats.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/BucketHelpers.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValueType.java
core/src/main/java/org/elasticsearch/search/aggregations/support/ValuesSource.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/CustomQueryScorer.java
core/src/main/java/org/elasticsearch/search/profile/query/ProfileCollector.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggester.java
core/src/main/java/org/elasticsearch/search/suggest/completion/CompletionSuggestionBuilder.java
core/src/main/java/org/elasticsearch/search/suggest/completion/context/ContextMappings.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/CandidateScorer.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/PhraseSuggestionContext.java
core/src/main/java/org/elasticsearch/search/suggest/phrase/StupidBackoffScorer.java
core/src/main/java/org/elasticsearch/search/suggest/term/TermSuggestionContext.java
core/src/main/java/org/elasticsearch/snapshots/RestoreService.java
core/src/main/java/org/elasticsearch/snapshots/SnapshotsService.java
core/src/main/java/org/elasticsearch/tasks/TaskManager.java
core/src/main/java/org/elasticsearch/threadpool/ExecutorBuilder.java
core/src/main/java/org/elasticsearch/threadpool/FixedExecutorBuilder.java
core/src/main/java/org/elasticsearch/threadpool/ScalingExecutorBuilder.java
core/src/main/java/org/elasticsearch/transport/RequestHandlerRegistry.java
core/src/main/java/org/elasticsearch/transport/TcpTransport.java
core/src/main/java/org/elasticsearch/transport/TransportInterceptor.java
core/src/main/java/org/elasticsearch/transport/TransportService.java
core/src/main/java/org/elasticsearch/watcher/FileWatcher.java
core/src/test/java/org/apache/lucene/grouping/CollapsingTopDocsCollectorTests.java
core/src/test/java/org/elasticsearch/action/ActionModuleTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TestTaskPlugin.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TransportTasksActionTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/shards/IndicesShardStoreRequestIT.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionTookTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/AsyncBulkByScrollActionTests.java
core/src/test/java/org/elasticsearch/action/support/TransportActionFilterChainTests.java
core/src/test/java/org/elasticsearch/action/support/broadcast/node/TransportBroadcastByNodeActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/BroadcastReplicationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/ReplicationOperationTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportReplicationActionTests.java
core/src/test/java/org/elasticsearch/action/support/replication/TransportWriteActionTests.java
core/src/test/java/org/elasticsearch/action/support/single/instance/TransportInstanceSingleOperationActionTests.java
core/src/test/java/org/elasticsearch/bootstrap/BootstrapCheckTests.java
core/src/test/java/org/elasticsearch/bwcompat/RepositoryUpgradabilityIT.java
core/src/test/java/org/elasticsearch/client/transport/TransportClientNodesServiceTests.java
core/src/test/java/org/elasticsearch/cluster/action/shard/ShardStateActionTests.java
core/src/test/java/org/elasticsearch/cluster/routing/DelayedAllocationServiceTests.java
core/src/test/java/org/elasticsearch/cluster/routing/RoutingServiceTests.java
core/src/test/java/org/elasticsearch/cluster/routing/allocation/BalanceConfigurationTests.java
core/src/test/java/org/elasticsearch/cluster/service/ClusterServiceTests.java
core/src/test/java/org/elasticsearch/common/ChannelsTests.java
core/src/test/java/org/elasticsearch/common/UUIDTests.java
core/src/test/java/org/elasticsearch/common/cache/CacheTests.java
core/src/test/java/org/elasticsearch/common/io/stream/BytesStreamsTests.java
core/src/test/java/org/elasticsearch/common/io/stream/NamedWriteableRegistryTests.java
core/src/test/java/org/elasticsearch/common/io/stream/StreamTests.java
core/src/test/java/org/elasticsearch/common/network/NetworkModuleTests.java
core/src/test/java/org/elasticsearch/common/util/concurrent/RefCountedTests.java
core/src/test/java/org/elasticsearch/common/xcontent/ConstructingObjectParserTests.java
core/src/test/java/org/elasticsearch/discovery/BlockingClusterStatePublishResponseHandlerTests.java
core/src/test/java/org/elasticsearch/discovery/ZenFaultDetectionTests.java
core/src/test/java/org/elasticsearch/discovery/zen/UnicastZenPingTests.java
core/src/test/java/org/elasticsearch/gateway/AsyncShardFetchTests.java
core/src/test/java/org/elasticsearch/gateway/GatewayMetaStateTests.java
core/src/test/java/org/elasticsearch/gateway/MetaDataStateFormatTests.java
core/src/test/java/org/elasticsearch/gateway/PrimaryShardAllocatorTests.java
core/src/test/java/org/elasticsearch/gateway/ReplicaShardAllocatorTests.java
core/src/test/java/org/elasticsearch/index/IndexModuleTests.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/ExternalMapper.java
core/src/test/java/org/elasticsearch/index/mapper/FieldNamesFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/FieldTypeLookupTests.java
core/src/test/java/org/elasticsearch/index/query/MockRepeatAnalyzer.java
core/src/test/java/org/elasticsearch/index/query/SimpleQueryParserTests.java
core/src/test/java/org/elasticsearch/index/query/functionscore/FunctionScoreQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexSearcherWrapperTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/NewPathForShardTests.java
core/src/test/java/org/elasticsearch/index/shard/ShardPathTests.java
core/src/test/java/org/elasticsearch/index/snapshots/blobstore/SlicedInputStreamTests.java
core/src/test/java/org/elasticsearch/index/store/IndexStoreTests.java
core/src/test/java/org/elasticsearch/index/store/StoreTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
core/src/test/java/org/elasticsearch/indices/IndexingMemoryControllerTests.java
core/src/test/java/org/elasticsearch/indices/IndicesRequestCacheTests.java
core/src/test/java/org/elasticsearch/indices/recovery/IndexRecoveryIT.java
core/src/test/java/org/elasticsearch/indices/settings/UpdateSettingsIT.java
core/src/test/java/org/elasticsearch/ingest/PipelineExecutionServiceTests.java
core/src/test/java/org/elasticsearch/recovery/RelocationIT.java
comments:
Upgrade checkstyle to version 7.5

This commit upgrades the checkstyle configuration from version 5.9 to
version 7.5, the latest version as of today. The main enhancement
obtained via this upgrade is better detection of redundant modifiers.

Relates #22960

time:
2017-02-03T14:19:00Z
class:
plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/TikaDocTests.java
comments:
Replace tika-files.zip by a tika-files dir

Let's make our life easier when debugging/testing.
Also having a flat dir helps us to compare or "synchronize" more easily with Tika project files.

Closes #22958.

time:
2017-02-03T14:18:26Z
class:
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryWhileModifyingTests.java
comments:
Test: Make update-by-query test more resilient

`UpdateByQueryWhileModifyingTests#testUpdateWhileReindexing`
runs update-by-query and concurrently updates, asserting that
the update-by-query never reverts any changes made by the update.
It is a smoke test for concurrent updates.

Now, it expects to hit a certain number of version conflicts
during the updates. This is normal as it is racing the
update-by-query. We have a maximum number of failures we
expect (10) and I'd never seen us come close until
https://elasticsearch-ci.elastic.co/job/elastic+elasticsearch+5.x+multijob-unix-compatibility/os=sles/495/console

This bumps the max failures from 10 to 50 and improves
logging a bit. If we continue to see this failure then we have
some other issue.

Closes #22938

time:
2017-02-03T13:48:29Z
class:
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySourceHandlerTests.java
comments:
Fix compilation in RecoverySourceHandlerTests

This error arose after the signature of a method was changed.

time:
2017-02-03T13:11:57Z
class:
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySourceHandlerTests.java
qa/backwards-5.0/src/test/java/org/elasticsearch/backwards/IndexingIT.java
comments:
Avoid losing ops in file-based recovery

When a primary is relocated from an old node to a new node, it can have
ops in its translog that do not have a sequence number assigned. When a
file-based recovery is started, this can lead to skipping these ops when
replaying the translog due to a bug in the recovery logic. This commit
addresses this bug and adds a test in the BWC tests.

Relates #22945

time:
2017-02-03T12:16:17Z
class:
comments:
Update typo in date (#22955)

your example has yyy and it should be yyyy

time:
2017-02-03T12:03:52Z
class:
plugins/ingest-attachment/src/main/java/org/elasticsearch/ingest/attachment/TikaImpl.java
plugins/ingest-attachment/src/test/java/org/elasticsearch/ingest/attachment/AttachmentProcessorTests.java
comments:
Remove support for Visio and POTM files

Actually we never supported Visio files but we are failing hard (kill a node) when that kind of file is provided.
See https://github.com/elastic/elasticsearch/pull/22079#issuecomment-277035357

This commits excludes Visio parsing from Tika so it does not fail anymore but returns empty content instead.

As a side effect, it also removes support for POTM files.

Closes #22077.

time:
2017-02-03T09:18:01Z
class:
comments:
Fix asciidoc in stored fields

time:
2017-02-03T09:04:31Z
class:
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/TransportGetFieldMappingsIndexAction.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentFieldMappers.java
comments:
Consilify get-field-mapping docs (#22936)

This change also removes the reference to the difference bewteen full name and index name.
They are always the same since 2.x and `name` does not refer anymore to `author.name` automatically.
A simple pattern must be used instead.
Remove redundant code that checks the field name twice.

time:
2017-02-03T08:46:07Z
class:
core/src/test/java/org/elasticsearch/indices/recovery/IndexPrimaryRelocationIT.java
comments:
Reduce log-level of IndexPrimaryRelocationIT to hunt Heisenbug

time:
2017-02-03T07:40:08Z
class:
comments:
Merge pull request #22879 from johtani/fix_documentation_error_in_date_histogram

[Doc]Not support "M" time unit in offset param

time:
2017-02-03T06:58:19Z
class:
comments:
Build: Improve detection of older java versions (#22950)

This change switches to using jrunscript, instead of jjs, for detecting
version properties of java, which is available on java versions prior to 8.

closes #22898

time:
2017-02-03T04:52:46Z
class:
qa/smoke-test-http/src/test/java/org/elasticsearch/http/DetailedErrorsDisabledIT.java
comments:
Fix line length

time:
2017-02-03T04:05:43Z
class:
qa/smoke-test-http/src/test/java/org/elasticsearch/http/DetailedErrorsDisabledIT.java
comments:
Fix client test to not care about complete error response message

time:
2017-02-03T00:39:56Z
class:
core/src/main/java/org/elasticsearch/plugins/RemovePluginCommand.java
qa/evil-tests/src/test/java/org/elasticsearch/plugins/RemovePluginCommandTests.java
comments:
Handle missing plugin name in remove command

Today if a user invokes the remove plugin command without specifying the
name of a plugin to remove, we arrive at a null pointer exception. This
commit adds logic to cleanly handle this situation and provide clear
feedback to the user.

Relates #22930

time:
2017-02-02T22:52:33Z
class:
core/src/main/java/org/elasticsearch/index/mapper/RangeFieldMapper.java
core/src/test/java/org/elasticsearch/index/mapper/RangeFieldMapperTests.java
comments:
Fix NPE in RangeFieldMapper.doXContentBody

RangeFieldMapper.doXContentBody should only serialize format and locale when type is set to 'date_range'.

closes #22925

time:
2017-02-02T19:28:48Z
class:
core/src/main/java/org/elasticsearch/common/xcontent/XContentParser.java
comments:
Fix outdated example in javadoc

The code changed and the example in the javadoc didn't.

Closes #22932

time:
2017-02-02T19:21:53Z
class:
core/src/main/java/org/elasticsearch/action/bulk/TransportSingleItemBulkWriteAction.java
core/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java
comments:
Use bulk action interally for update action (#22915)

Currently, update action internally uses deprecated index and delete
transport actions. As of #21964, these tranport actions were deprecated
in favour of using single item bulk request. In this commit, update action
uses single item bulk action.

time:
2017-02-02T19:07:13Z
class:
client/benchmark/src/main/java/org/elasticsearch/client/benchmark/transport/TransportClientBenchmark.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/NoopBulkRequestBuilder.java
client/client-benchmark-noop-api-plugin/src/main/java/org/elasticsearch/plugin/noop/action/bulk/RestNoopBulkAction.java
core/src/main/java/org/elasticsearch/action/admin/cluster/repositories/put/PutRepositoryRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/repositories/put/PutRepositoryRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/settings/ClusterUpdateSettingsRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/settings/ClusterUpdateSettingsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/create/CreateSnapshotRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/create/CreateSnapshotRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/RestoreSnapshotRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/snapshots/restore/RestoreSnapshotRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/PutStoredScriptRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/PutStoredScriptRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/analyze/AnalyzeRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/GetFieldMappingsResponse.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/get/TransportGetFieldMappingsIndexAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/put/UpdateSettingsRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/put/UpdateSettingsRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequest.java
core/src/main/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestBuilder.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequest.java
core/src/main/java/org/elasticsearch/action/bulk/BulkRequestBuilder.java
core/src/main/java/org/elasticsearch/action/bulk/TransportShardBulkAction.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/ClientScrollableHitSource.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/ScrollableHitSource.java
core/src/main/java/org/elasticsearch/action/index/IndexRequest.java
core/src/main/java/org/elasticsearch/action/index/IndexRequestBuilder.java
core/src/main/java/org/elasticsearch/action/ingest/PutPipelineRequest.java
core/src/main/java/org/elasticsearch/action/ingest/PutPipelineRequestBuilder.java
core/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequest.java
core/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineRequestBuilder.java
core/src/main/java/org/elasticsearch/action/ingest/SimulatePipelineTransportAction.java
core/src/main/java/org/elasticsearch/action/termvectors/TermVectorsRequest.java
core/src/main/java/org/elasticsearch/action/update/TransportUpdateAction.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequest.java
core/src/main/java/org/elasticsearch/action/update/UpdateRequestBuilder.java
core/src/main/java/org/elasticsearch/client/ClusterAdminClient.java
core/src/main/java/org/elasticsearch/client/support/AbstractClient.java
core/src/main/java/org/elasticsearch/cluster/metadata/IndexTemplateMetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataCreateIndexService.java
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/main/java/org/elasticsearch/common/settings/loader/SettingsLoaderFactory.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentBuilder.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentGenerator.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentHelper.java
core/src/main/java/org/elasticsearch/common/xcontent/XContentType.java
core/src/main/java/org/elasticsearch/common/xcontent/json/JsonXContentGenerator.java
core/src/main/java/org/elasticsearch/http/HttpTransportSettings.java
core/src/main/java/org/elasticsearch/index/IndexingSlowLog.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapper.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentMapperParser.java
core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java
core/src/main/java/org/elasticsearch/index/mapper/MapperService.java
core/src/main/java/org/elasticsearch/index/mapper/ParsedDocument.java
core/src/main/java/org/elasticsearch/index/mapper/SourceFieldMapper.java
core/src/main/java/org/elasticsearch/index/mapper/SourceToParse.java
core/src/main/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilder.java
core/src/main/java/org/elasticsearch/index/shard/TranslogRecoveryPerformer.java
core/src/main/java/org/elasticsearch/index/termvectors/TermVectorsService.java
core/src/main/java/org/elasticsearch/ingest/PipelineConfiguration.java
core/src/main/java/org/elasticsearch/ingest/PipelineStore.java
core/src/main/java/org/elasticsearch/rest/AbstractRestChannel.java
core/src/main/java/org/elasticsearch/rest/BytesRestResponse.java
core/src/main/java/org/elasticsearch/rest/RestChannel.java
core/src/main/java/org/elasticsearch/rest/RestController.java
core/src/main/java/org/elasticsearch/rest/RestHandler.java
core/src/main/java/org/elasticsearch/rest/RestRequest.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestPutStoredScriptAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestCreateIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestPutIndexTemplateAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestPutMappingAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestBulkAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestGetSourceAction.java
core/src/main/java/org/elasticsearch/rest/action/document/RestIndexAction.java
core/src/main/java/org/elasticsearch/rest/action/ingest/RestPutPipelineAction.java
core/src/main/java/org/elasticsearch/rest/action/ingest/RestSimulatePipelineAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestClearScrollAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestMultiSearchAction.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchScrollAction.java
core/src/main/java/org/elasticsearch/script/ScriptMetaData.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/main/java/org/elasticsearch/script/StoredScriptSource.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/action/ListenerActionIT.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TasksIT.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/TransportTasksActionTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/reroute/ClusterRerouteRequestTests.java
core/src/test/java/org/elasticsearch/action/admin/cluster/storedscripts/PutStoredScriptRequestTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequestBuilderTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/create/CreateIndexRequestTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/create/ShrinkIndexIT.java
core/src/test/java/org/elasticsearch/action/admin/indices/mapping/get/GetFieldMappingsResponseTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/mapping/put/PutMappingRequestTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/template/BWCTemplateTests.java
core/src/test/java/org/elasticsearch/action/admin/indices/template/put/PutIndexTemplateRequestTests.java
core/src/test/java/org/elasticsearch/action/bulk/BulkIntegrationIT.java
core/src/test/java/org/elasticsearch/action/bulk/BulkProcessorClusterSettingsIT.java
core/src/test/java/org/elasticsearch/action/bulk/BulkProcessorIT.java
core/src/test/java/org/elasticsearch/action/bulk/BulkRequestModifierTests.java
core/src/test/java/org/elasticsearch/action/bulk/BulkRequestTests.java
core/src/test/java/org/elasticsearch/action/bulk/BulkWithUpdatesIT.java
core/src/test/java/org/elasticsearch/action/bulk/TransportBulkActionTookTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/AsyncBulkByScrollActionTests.java
core/src/test/java/org/elasticsearch/action/index/IndexRequestBuilderTests.java
core/src/test/java/org/elasticsearch/action/index/IndexRequestTests.java
core/src/test/java/org/elasticsearch/action/ingest/PutPipelineRequestTests.java
core/src/test/java/org/elasticsearch/action/ingest/SimulatePipelineRequestTests.java
core/src/test/java/org/elasticsearch/action/ingest/WriteableIngestDocumentTests.java
core/src/test/java/org/elasticsearch/action/search/MultiSearchRequestTests.java
core/src/test/java/org/elasticsearch/action/support/WaitActiveShardCountIT.java
core/src/test/java/org/elasticsearch/action/termvectors/TermVectorsUnitTests.java
core/src/test/java/org/elasticsearch/action/update/UpdateRequestTests.java
core/src/test/java/org/elasticsearch/aliases/IndexAliasesIT.java
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
core/src/test/java/org/elasticsearch/client/AbstractClientHeadersTestCase.java
core/src/test/java/org/elasticsearch/cluster/NoMasterNodeIT.java
core/src/test/java/org/elasticsearch/cluster/SimpleDataNodesIT.java
core/src/test/java/org/elasticsearch/common/settings/SettingsFilterTests.java
core/src/test/java/org/elasticsearch/common/settings/loader/JsonSettingsLoaderTests.java
core/src/test/java/org/elasticsearch/common/settings/loader/YamlSettingsLoaderTests.java
core/src/test/java/org/elasticsearch/common/xcontent/support/XContentMapValuesTests.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/document/DocumentActionsIT.java
core/src/test/java/org/elasticsearch/document/ShardInfoIT.java
core/src/test/java/org/elasticsearch/get/GetActionIT.java
core/src/test/java/org/elasticsearch/index/IndexRequestBuilderIT.java
core/src/test/java/org/elasticsearch/index/IndexServiceTests.java
core/src/test/java/org/elasticsearch/index/IndexingSlowLogTests.java
core/src/test/java/org/elasticsearch/index/WaitUntilRefreshIT.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/engine/ShadowEngineTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingDisabledTests.java
core/src/test/java/org/elasticsearch/index/mapper/DynamicMappingTests.java
core/src/test/java/org/elasticsearch/index/mapper/IdFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/MapperServiceTests.java
core/src/test/java/org/elasticsearch/index/mapper/MultiFieldTests.java
core/src/test/java/org/elasticsearch/index/mapper/ParentFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/RoutingFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/SourceFieldMapperTests.java
core/src/test/java/org/elasticsearch/index/mapper/UpdateMappingOnClusterIT.java
core/src/test/java/org/elasticsearch/index/query/MoreLikeThisQueryBuilderTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/replication/IndexLevelReplicationTests.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardIT.java
core/src/test/java/org/elasticsearch/index/shard/IndexShardTests.java
core/src/test/java/org/elasticsearch/index/shard/RefreshListenersTests.java
core/src/test/java/org/elasticsearch/index/translog/TranslogTests.java
core/src/test/java/org/elasticsearch/indices/DateMathIndexExpressionsIntegrationIT.java
core/src/test/java/org/elasticsearch/indices/IndexingMemoryControllerTests.java
core/src/test/java/org/elasticsearch/indices/analysis/AnalysisModuleTests.java
core/src/test/java/org/elasticsearch/indices/flush/FlushIT.java
core/src/test/java/org/elasticsearch/indices/flush/SyncedFlushSingleNodeTests.java
core/src/test/java/org/elasticsearch/indices/memory/breaker/CircuitBreakerServiceIT.java
core/src/test/java/org/elasticsearch/indices/recovery/IndexRecoveryIT.java
core/src/test/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetServiceTests.java
core/src/test/java/org/elasticsearch/indices/stats/IndexStatsIT.java
core/src/test/java/org/elasticsearch/indices/template/SimpleIndexTemplateIT.java
core/src/test/java/org/elasticsearch/ingest/IngestClientIT.java
core/src/test/java/org/elasticsearch/ingest/IngestMetadataTests.java
core/src/test/java/org/elasticsearch/ingest/IngestProcessorNotInstalledOnAllNodesIT.java
core/src/test/java/org/elasticsearch/ingest/PipelineConfigurationTests.java
core/src/test/java/org/elasticsearch/ingest/PipelineExecutionServiceTests.java
core/src/test/java/org/elasticsearch/ingest/PipelineStoreTests.java
core/src/test/java/org/elasticsearch/mget/SimpleMgetIT.java
core/src/test/java/org/elasticsearch/recovery/RelocationIT.java
core/src/test/java/org/elasticsearch/recovery/SimpleRecoveryIT.java
core/src/test/java/org/elasticsearch/rest/BytesRestResponseTests.java
core/src/test/java/org/elasticsearch/rest/RestControllerTests.java
core/src/test/java/org/elasticsearch/rest/RestRequestTests.java
core/src/test/java/org/elasticsearch/rest/action/admin/indices/RestAnalyzeActionTests.java
core/src/test/java/org/elasticsearch/rest/action/cat/RestTableTests.java
core/src/test/java/org/elasticsearch/routing/AliasRoutingIT.java
core/src/test/java/org/elasticsearch/routing/SimpleRoutingIT.java
core/src/test/java/org/elasticsearch/script/ScriptMetaDataTests.java
core/src/test/java/org/elasticsearch/script/ScriptServiceTests.java
core/src/test/java/org/elasticsearch/script/StoredScriptTests.java
core/src/test/java/org/elasticsearch/script/StoredScriptsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/ChildrenIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/NestedIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/SignificantTermsSignificanceScoreIT.java
core/src/test/java/org/elasticsearch/search/aggregations/bucket/TermsShardMinDocCountIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ScriptedMetricIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketScriptIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketSelectorIT.java
core/src/test/java/org/elasticsearch/search/builder/SearchSourceBuilderTests.java
core/src/test/java/org/elasticsearch/search/child/ChildQuerySearchIT.java
core/src/test/java/org/elasticsearch/search/child/ParentFieldLoadingIT.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/InnerHitsIT.java
core/src/test/java/org/elasticsearch/search/fields/SearchFieldsIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoFilterIT.java
core/src/test/java/org/elasticsearch/search/geo/GeoShapeQueryTests.java
core/src/test/java/org/elasticsearch/search/msearch/MultiSearchIT.java
core/src/test/java/org/elasticsearch/search/preference/SearchPreferenceIT.java
core/src/test/java/org/elasticsearch/search/query/QueryStringIT.java
core/src/test/java/org/elasticsearch/search/query/SearchQueryIT.java
core/src/test/java/org/elasticsearch/search/query/SimpleQueryStringIT.java
core/src/test/java/org/elasticsearch/search/scroll/RestClearScrollActionTests.java
core/src/test/java/org/elasticsearch/search/scroll/RestSearchScrollActionTests.java
core/src/test/java/org/elasticsearch/search/scroll/SearchScrollIT.java
core/src/test/java/org/elasticsearch/search/simple/SimpleSearchIT.java
core/src/test/java/org/elasticsearch/search/sort/FieldSortIT.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/snapshots/SnapshotRequestsTests.java
core/src/test/java/org/elasticsearch/test/search/aggregations/bucket/SharedSignificantTermsTestMethods.java
core/src/test/java/org/elasticsearch/threadpool/ThreadPoolSerializationTests.java
core/src/test/java/org/elasticsearch/update/UpdateIT.java
core/src/test/java/org/elasticsearch/update/UpdateNoopIT.java
distribution/integ-test-zip/src/test/java/org/elasticsearch/test/rest/CreatedLocationHeaderIT.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/StoredExpressionTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestPutSearchTemplateAction.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MultiSearchTemplateRequestTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/MustacheTests.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateIT.java
modules/percolator/src/main/java/org/elasticsearch/percolator/PercolateQueryBuilder.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolateQueryBuilderTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorFieldMapperTests.java
modules/percolator/src/test/java/org/elasticsearch/percolator/PercolatorQuerySearchIT.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuilders.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteResponseParsers.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/CancelTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RestReindexActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuildersTests.java
modules/transport-netty4/src/main/java/org/elasticsearch/http/netty4/Netty4HttpRequest.java
modules/transport-netty4/src/test/java/org/elasticsearch/http/netty4/Netty4HttpClient.java
plugins/mapper-size/src/test/java/org/elasticsearch/index/mapper/size/SizeMappingIT.java
plugins/mapper-size/src/test/java/org/elasticsearch/index/mapper/size/SizeMappingTests.java
plugins/repository-azure/src/test/java/org/elasticsearch/cloud/azure/storage/AzureStorageSettingsFilterTests.java
qa/backwards-5.0/src/test/java/org/elasticsearch/backwards/IndexingIT.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/DetailedErrorsDisabledIT.java
qa/smoke-test-http/src/test/java/org/elasticsearch/http/DetailedErrorsEnabledIT.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/main/java/org/elasticsearch/test/XContentTestUtils.java
test/framework/src/main/java/org/elasticsearch/test/rest/FakeRestChannel.java
test/framework/src/main/java/org/elasticsearch/test/rest/FakeRestRequest.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestClient.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestExecutionContext.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestResponse.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ClientYamlTestResponseException.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/ESClientYamlSuiteTestCase.java
comments:
Optionally require a valid content type for all rest requests with content (#22691)

This change adds a strict mode for xcontent parsing on the rest layer. The strict mode will be off by default for 5.x and in a separate commit will be enabled by default for 6.0. The strict mode, which can be enabled by setting `http.content_type.required: true` in 5.x, will require that all incoming rest requests have a valid and supported content type header before the request is dispatched. In the non-strict mode, the Content-Type header will be inspected and if it is not present or not valid, we will continue with auto detection of content like we have done previously.

The content type header is parsed to the matching XContentType value with the only exception being for plain text requests. This value is then passed on with the content bytes so that we can reduce the number of places where we need to auto-detect the content type.

As part of this, many transport requests and builders were updated to provide methods that
accepted the XContentType along with the bytes and the methods that would rely on auto-detection have been deprecated.

In the non-strict mode, deprecation warnings are issued whenever a request with body doesn't provide the Content-Type header.

See #19388

time:
2017-02-02T18:39:42Z
class:
core/src/main/java/org/elasticsearch/common/geo/GeoDistance.java
core/src/main/java/org/elasticsearch/common/geo/GeoUtils.java
core/src/main/java/org/elasticsearch/index/query/GeoDistanceQueryBuilder.java
core/src/main/java/org/elasticsearch/index/query/functionscore/DecayFunctionBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceAggregationBuilder.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/range/geodistance/GeoDistanceRangeAggregatorFactory.java
core/src/main/java/org/elasticsearch/search/sort/GeoDistanceSortBuilder.java
core/src/test/java/org/apache/lucene/util/SloppyMathTests.java
core/src/test/java/org/elasticsearch/common/geo/GeoDistanceTests.java
core/src/test/java/org/elasticsearch/index/query/GeoDistanceQueryBuilderTests.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderIT.java
core/src/test/java/org/elasticsearch/search/sort/GeoDistanceSortBuilderTests.java
comments:
Reduce GeoDistance insanity

GeoDistance query, sort, and scripts make use of a crazy GeoDistance enum for handling 4 different ways of computing geo distance: SLOPPY_ARC, ARC, FACTOR, and PLANE. Only two of these are necessary: ARC, PLANE. This commit removes SLOPPY_ARC, and FACTOR and cleans up the way Geo distance is computed.

time:
2017-02-02T17:19:53Z
class:
core/src/main/java/org/elasticsearch/cluster/Diff.java
core/src/main/java/org/elasticsearch/script/StoredScriptSource.java
core/src/test/java/org/elasticsearch/script/ScriptMetaDataTests.java
core/src/test/java/org/elasticsearch/snapshots/RepositoriesMetaDataSerializationTests.java
core/src/test/java/org/elasticsearch/snapshots/SnapshotsInProgressSerializationTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractDiffableSerializationTestCase.java
test/framework/src/main/java/org/elasticsearch/test/AbstractDiffableWireSerializationTestCase.java
test/framework/src/main/java/org/elasticsearch/test/AbstractSerializingTestCase.java
test/framework/src/main/java/org/elasticsearch/test/DiffableTestUtils.java
comments:
Expand AbstractSerializingTestCase and AbstractWireSerializingTestCase to test diff serialization

This commit adds two additional test cases that can be used to verify correct diff serialization in additional to binary and xcontent serialization.

time:
2017-02-02T17:18:20Z
class:
comments:
[TEST] fix introduced typo

time:
2017-02-02T16:46:24Z
class:
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuilders.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteRequestBuildersTests.java
comments:
Reindex: fix reindex-from-remote from <2.0 (#22931)

In 5.2 we stopped sending the source parameter if the user didn't
specify it. This was a mistake as versions before 2.0 look like
they don't always include the `_source`. This is because reindex
requests some metadata fields. Anyway, now we say `"_source": true`
if there isn't a `_source` configured in the reindex request.

Closes #22893

time:
2017-02-02T16:00:16Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/test/java/org/elasticsearch/ElasticsearchExceptionTests.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
Parse elasticsearch exception's root causes (#22924)

This commit change ElasticsearchException.failureFromXContent() method so that it now parses root causes which were ignored before, and adds them as suppressed exceptions of the returned exception.

time:
2017-02-02T15:15:03Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/Def.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/FunctionRefTests.java
comments:
Painless: Fix def invoked qualified method refs (#22918)

We were incorrectly resolving qualified method references at run
time when invoked on `def`. This lead to errors like
`The struct with name [org] has not been defined.` when attempting

```
doc.date.dates.stream().map(
  org.joda.time.ReadableDateTime::centuryOfEra
).collect(Collectors.toList())
```

time:
2017-02-02T14:56:38Z
class:
comments:
[TEST] upgrade backward compatibility version of rolling upgrade
tests to 5.3.0-SNAPSHOT

time:
2017-02-02T03:20:11Z
class:
comments:
Changes the rolling upgrade version test to test against
5.2.0 instead of 5.2.0-SNAPSHOT

time:
2017-02-02T02:57:07Z
class:
core/src/main/java/org/elasticsearch/index/fielddata/ScriptDocValues.java
core/src/main/java/org/elasticsearch/index/mapper/IpFieldMapper.java
core/src/test/java/org/elasticsearch/index/fielddata/ScriptDocValuesDatesTests.java
core/src/test/java/org/elasticsearch/index/fielddata/ScriptDocValuesGeoPointsTests.java
core/src/test/java/org/elasticsearch/index/fielddata/ScriptDocValuesLongsTests.java
comments:
Expose multi-valued dates to scripts and document painless's date functions (#22875)

Implemented by wrapping an array of reused `ModuleDateTime`s that
we grow when needed. The `ModuleDateTime`s are reused when we
move to the next document.

Also improves the error message returned when attempting to modify
the `ScriptdocValues`, removes a couple of allocations, and documents
that the date functions are available in Painless.

Relates to #22162

time:
2017-02-01T22:07:21Z
class:
comments:
Build: Add nicer error message for pre java 8 (#22911)

This commit adds clearer error message when trying to find the version of java, but
the jjs binary is not found.

closes #22898

time:
2017-02-01T19:14:39Z
class:
comments:
[TEST] temporarily disable the explain API rest test until
the 5.3.0-snapshot distribution is properly generated

time:
2017-02-01T17:47:36Z
class:
core/src/main/java/org/elasticsearch/Version.java
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
comments:
Fixes the Version constants for 5.2.0, 5.2.1, and 5.3.0 to
have the correct Lucene version (6.4.0)

time:
2017-02-01T16:03:20Z
class:
core/src/main/java/org/elasticsearch/index/mapper/DocumentParser.java
core/src/test/java/org/elasticsearch/index/mapper/DocumentParserTests.java
core/src/test/java/org/elasticsearch/indexing/IndexActionIT.java
comments:
Disallow introducing illegal object mappings (double '..')

This disallows object mappings that would accidentally create something like
`foo..bar`, which is then unparsable for the `bar` field as it does not know
what its parent is.

Resolves #22794

time:
2017-02-01T15:43:53Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
Removes premature addition of v5.4.0 constant

time:
2017-02-01T09:34:42Z
class:
core/src/test/java/org/elasticsearch/rest/BytesRestResponseTests.java
comments:
[TEST] Fix BytesRestResponseTests.testNoErrorFromXContent

time:
2017-02-01T09:31:26Z
class:
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainIT.java
comments:
remove await fix from testCannotAllocateStaleReplicaExplanation

time:
2017-02-01T09:30:42Z
class:
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainIT.java
comments:
fix testCannotAllocateStaleReplicaExplanation node management

The test tried to create a situation where a stale replica is the only shard available. It did so by stopping the node with the replica, indexing some, stopping the primary node, starting a new node. This is flawed because the newly started node may reuse the data path of the primary node and things go back to green. Instead we should make sure that the replica is on the path that will be selected when the new node is started (i.e., the path with the smaller ordinal)

time:
2017-02-01T09:11:17Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/rest/BytesRestResponse.java
core/src/test/java/org/elasticsearch/ElasticsearchExceptionTests.java
core/src/test/java/org/elasticsearch/rest/BytesRestResponseTests.java
comments:
Add parsing method to BytesRestResponse's error (#22873)

This commit adds a BytesRestResponse.errorFromXContent() method to parse the error returned by BytesRestResponse. It returns a ElasticsearchStatusException instance.

time:
2017-02-01T08:24:19Z
class:
comments:
Update search.asciidoc (#22865)

time:
2017-02-01T03:42:23Z
class:
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainIT.java
core/src/test/java/org/elasticsearch/bwcompat/OldIndexBackwardsCompatibilityIT.java
comments:
[TEST] adds AwaitsFix on two failing tests

time:
2017-02-01T01:11:01Z
class:
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainIT.java
comments:
[TEST] fix node allocation result check in explain API test

time:
2017-01-31T22:31:55Z
class:
core/src/main/java/org/elasticsearch/cluster/routing/allocation/AllocateUnassignedDecision.java
core/src/main/java/org/elasticsearch/cluster/routing/allocation/NodeAllocationResult.java
core/src/main/java/org/elasticsearch/gateway/PrimaryShardAllocator.java
core/src/test/java/org/elasticsearch/action/admin/cluster/allocation/ClusterAllocationExplainIT.java
comments:
Include stale replica shard info when explaining an unassigned primary (#22826)

Currently, if a previously allocated shard has no in-sync copy in the
cluster, but there is a stale replica copy, the explain API does not
include information about the stale replica copies in its output.  This
commit includes any shard copy information available (even for stale
copies) when explaining an unassigned primary shard that was previously
allocated in the cluster.

This situation can arise as follows: imagine an index with 1 primary and
1 replica and a cluster with 2 nodes.  If the node holding the replica
is shut down, and data continues to be indexed, only the primary will
have the latest data and the replica that has gone offline will be
marked as stale.  Now, suppose the node holding the primary is shut
down.  There are no copies of the shard data in the cluster.  Now, start
the first stopped node (holding the stale replica) back up.  The cluster
is red because there is no in-sync copy available.  Running the explain
API before would inform the user that there is no valid shard copy in
the cluster for that shard, but it would not provide any information
about the existence of the stale replica that exists on the restarted
node.  With this commit, the explain API provides information about all
the stale replica copies when explaining the unassigned primary.

time:
2017-01-31T22:12:02Z
class:
core/src/main/java/org/elasticsearch/Version.java
comments:
Adds v5.2.1 and v5.4.0 constants and bwc index for 5.2.0

time:
2017-01-31T21:40:56Z
class:
comments:
Add 5.2.0 to static versions used by vagrant

time:
2017-01-31T21:27:02Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/DeleteStoredScriptRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/DeleteStoredScriptRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/GetStoredScriptRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/GetStoredScriptResponse.java
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/PutStoredScriptRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/PutStoredScriptRequestBuilder.java
core/src/main/java/org/elasticsearch/action/admin/cluster/storedscripts/TransportPutStoredScriptAction.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractAsyncBulkByScrollAction.java
core/src/main/java/org/elasticsearch/client/support/AbstractClient.java
core/src/main/java/org/elasticsearch/index/query/QueryShardContext.java
core/src/main/java/org/elasticsearch/ingest/InternalTemplateService.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestDeleteStoredScriptAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestGetStoredScriptAction.java
core/src/main/java/org/elasticsearch/rest/action/admin/cluster/RestPutStoredScriptAction.java
core/src/main/java/org/elasticsearch/script/Script.java
core/src/main/java/org/elasticsearch/script/ScriptMetaData.java
core/src/main/java/org/elasticsearch/script/ScriptService.java
core/src/main/java/org/elasticsearch/script/StoredScriptSource.java
core/src/main/java/org/elasticsearch/search/aggregations/metrics/scripted/InternalScriptedMetric.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketscript/BucketScriptPipelineAggregator.java
core/src/main/java/org/elasticsearch/search/aggregations/pipeline/bucketselector/BucketSelectorPipelineAggregator.java
core/src/test/java/org/elasticsearch/index/query/InnerHitBuilderTests.java
core/src/test/java/org/elasticsearch/script/FileScriptTests.java
core/src/test/java/org/elasticsearch/script/NativeScriptTests.java
core/src/test/java/org/elasticsearch/script/ScriptContextTests.java
core/src/test/java/org/elasticsearch/script/ScriptMetaDataTests.java
core/src/test/java/org/elasticsearch/script/ScriptServiceTests.java
core/src/test/java/org/elasticsearch/script/ScriptTests.java
core/src/test/java/org/elasticsearch/script/StoredScriptTests.java
core/src/test/java/org/elasticsearch/script/StoredScriptsIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ScriptedMetricIT.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/ScriptedMetricTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketScriptIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketScriptTests.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketSelectorIT.java
core/src/test/java/org/elasticsearch/search/aggregations/pipeline/BucketSelectorTests.java
core/src/test/java/org/elasticsearch/search/sort/AbstractSortTestCase.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/ScriptProcessor.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/ScriptProcessorFactoryTests.java
modules/lang-expression/src/test/java/org/elasticsearch/script/expression/StoredExpressionTests.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestDeleteSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestGetSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/RestPutSearchTemplateAction.java
modules/lang-mustache/src/main/java/org/elasticsearch/script/mustache/TemplateQueryBuilder.java
modules/lang-mustache/src/test/java/org/elasticsearch/script/mustache/SearchTemplateIT.java
comments:
Change Namespace for Stored Script to Only Use Id (#22206)

Currently, stored scripts use a namespace of (lang, id) to be put, get, deleted, and executed. This is not necessary since the lang is stored with the stored script. A user should only have to specify an id to use a stored script. This change makes that possible while keeping backwards compatibility with the previous namespace of (lang, id). Anywhere the previous namespace is used will log deprecation warnings.

The new behavior is the following:

When a user specifies a stored script, that script will be stored under both the new namespace and old namespace.

Take for example script 'A' with lang 'L0' and data 'D0'. If we add script 'A' to the empty set, the scripts map will be ["A" -- D0, "A#L0" -- D0]. If a script 'A' with lang 'L1' and data 'D1' is then added, the scripts map will be ["A" -- D1, "A#L1" -- D1, "A#L0" -- D0].

When a user deletes a stored script, that script will be deleted from both the new namespace (if it exists) and the old namespace.

Take for example a scripts map with {"A" -- D1, "A#L1" -- D1, "A#L0" -- D0}. If a script is removed specified by an id 'A' and lang null then the scripts map will be {"A#L0" -- D0}. To remove the final script, the deprecated namespace must be used, so an id 'A' and lang 'L0' would need to be specified.

When a user gets/executes a stored script, if the new namespace is used then the script will be retrieved/executed using only 'id', and if the old namespace is used then the script will be retrieved/executed using 'id' and 'lang'

time:
2017-01-31T19:27:31Z
class:
core/src/main/java/org/elasticsearch/index/seqno/LocalCheckpointTracker.java
core/src/main/java/org/elasticsearch/index/seqno/SeqNoStats.java
core/src/main/java/org/elasticsearch/index/seqno/SequenceNumbersService.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoverySourceService.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/SharedFSRecoverySourceHandler.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java
core/src/test/java/org/elasticsearch/indices/recovery/EvilPeerRecoveryIT.java
core/src/test/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetServiceTests.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySourceHandlerTests.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
comments:
Seq Number based recovery should validate last lucene commit max seq# (#22851)

The seq# base recovery logic relies on rolling back lucene to remove any operations above the global checkpoint. This part of the plan is not implemented yet but have to have these guarantees. Instead we should make the seq# logic validate that the last commit point (and the only one we have) maintains the invariant and if not, fall back to file based recovery.

 This commit adds a test that creates situation where rollback is needed (primary failover with ops in flight) and fixes another issue that was surfaced by it - if a primary can't serve a seq# based recovery request and does a file copy, it still used the incoming `startSeqNo` as a filter.

 Relates to #22484 & #10708

time:
2017-01-31T18:44:09Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/settings/ClusterUpdateSettingsRequest.java
core/src/main/java/org/elasticsearch/action/admin/cluster/settings/TransportClusterUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/put/TransportUpdateSettingsAction.java
core/src/main/java/org/elasticsearch/action/admin/indices/settings/put/UpdateSettingsRequest.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaData.java
core/src/main/java/org/elasticsearch/cluster/metadata/MetaDataUpdateSettingsService.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/main/java/org/elasticsearch/rest/action/admin/indices/RestGetSettingsAction.java
core/src/test/java/org/elasticsearch/cluster/metadata/ToAndFromJsonMetaDataTests.java
core/src/test/java/org/elasticsearch/common/settings/ScopedSettingsTests.java
core/src/test/java/org/elasticsearch/common/settings/SettingsModuleTests.java
core/src/test/java/org/elasticsearch/common/settings/SettingsTests.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
core/src/test/java/org/elasticsearch/tribe/TribeServiceTests.java
test/framework/src/main/java/org/elasticsearch/test/ESIntegTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESSingleNodeTestCase.java
comments:
Internal: Convert empty and size checks of settings to not use getAsMap() (#22890)

With the new secure settings, methods like getAsMap() no longer work
correctly as a means of checking for empty settings, or the total size.
This change converts the existing uses of that method to use methods
directly on Settings. Note this does not update the implementations to
account for SecureSettings, as that will require a followup which
changes how secure settings work.

time:
2017-01-31T18:06:03Z
class:
core/src/main/java/org/apache/lucene/search/highlight/Snippet.java
core/src/main/java/org/apache/lucene/search/postingshighlight/CustomPassageFormatter.java
core/src/main/java/org/apache/lucene/search/postingshighlight/CustomPostingsHighlighter.java
core/src/main/java/org/apache/lucene/search/uhighlight/CustomPassageFormatter.java
core/src/main/java/org/apache/lucene/search/uhighlight/CustomUnifiedHighlighter.java
core/src/main/java/org/elasticsearch/common/lucene/all/AllTermQuery.java
core/src/main/java/org/elasticsearch/common/lucene/search/MultiPhrasePrefixQuery.java
core/src/main/java/org/elasticsearch/common/lucene/search/function/FiltersFunctionScoreQuery.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/PostingsHighlighter.java
core/src/main/java/org/elasticsearch/search/fetch/subphase/highlight/UnifiedHighlighter.java
core/src/test/java/org/apache/lucene/search/postingshighlight/CustomPassageFormatterTests.java
core/src/test/java/org/apache/lucene/search/postingshighlight/CustomPostingsHighlighterTests.java
core/src/test/java/org/apache/lucene/search/uhighlight/CustomPassageFormatterTests.java
core/src/test/java/org/apache/lucene/search/uhighlight/CustomUnifiedHighlighterTests.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/highlight/HighlighterSearchIT.java
comments:
Integrate UnifiedHighlighter (#21621)

* Integrate UnifiedHighlighter

This change integrates the Lucene highlighter called "unified" in the list of supported highlighters for ES.
This highlighter can extract offsets from either postings, term vectors, or via re-analyzing text.
The best strategy is picked automatically at query time and depends on the field and the query to highlight.

time:
2017-01-31T17:23:18Z
class:
comments:
Docs: Add a note about `<` and `>` in query_string

`<` and `>` can't be escaped at all in `query_string`. If we're not
going to fix that we should at least document it.

Relates to #21703

time:
2017-01-31T12:36:09Z
class:
comments:
Updated document as per code change. (#22878)

Updated document as per this change : https://github.com/elastic/elasticsearch/pull/15235

time:
2017-01-31T11:53:15Z
class:
comments:
Minor fix in Create Index desc (#22877)

time:
2017-01-31T11:51:37Z
class:
comments:
Fix incorrect heading for Whitespace Tokenizer (#22883)

time:
2017-01-31T10:27:06Z
class:
comments:
Build fix for broken docs build

time:
2017-01-31T09:45:25Z
class:
comments:
[DOCS] [TEST] enhancement - added CONSOLE scripts for sampler aggs (#22869)

Added missing CONSOLE scripts to documentation for sampler and diversified_sampler aggs.
Includes new StackOverflow index setup in build.gradle

Closes #22746

* Formatting tweaks

time:
2017-01-31T09:23:38Z
class:
comments:
[Doc]Not support "M" time unit in offset param

time:
2017-01-31T08:05:43Z
class:
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/blobstore/AzureBlobStore.java
plugins/repository-azure/src/main/java/org/elasticsearch/repositories/azure/AzureRepository.java
plugins/repository-azure/src/test/java/org/elasticsearch/cloud/azure/AbstractAzureRepositoryServiceIntegTestCase.java
plugins/repository-azure/src/test/java/org/elasticsearch/repositories/azure/AzureBlobStoreTests.java
plugins/repository-azure/src/test/java/org/elasticsearch/repositories/azure/AzureSnapshotRestoreServiceIntegTests.java
comments:
Merge branch 'pr/remove-azure-container-auto-creation'

# Conflicts:
#	docs/reference/migration/migrate_6_0/plugins.asciidoc

time:
2017-01-30T22:56:45Z
class:
comments:
Docs: Add setup section for the keystore tool and secure settings (#22838)

time:
2017-01-30T22:42:40Z
class:
core/src/main/java/org/elasticsearch/node/InternalSettingsPreparer.java
core/src/test/java/org/elasticsearch/node/internal/InternalSettingsPreparerTests.java
comments:
Settings: Fix settings reading to account for defaults (#22871)

In #22762, settings preparation during bootstrap was changed slightly to
account for SecureSettings, by starting with a fresh settings builder
after reading the initial configuration. However, this the defaults from
system properties were never re-read. This change fixes that bug (which
was never released).

closes #22861

time:
2017-01-30T22:34:59Z
class:
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/AwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/plugin/repository/s3/S3RepositoryPlugin.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/AwsS3ServiceImplTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AbstractS3SnapshotRestoreTest.java
comments:
S3 Repository: Remove region setting (#22853)

This change removes the ability to set region for s3 repositories.
Endpoint should be used instead if a custom s3 location needs to be
used.

closes #22758

time:
2017-01-30T18:28:55Z
class:
core/src/main/java/org/elasticsearch/index/query/InnerHitBuilder.java
core/src/test/java/org/elasticsearch/index/query/InnerHitBuilderTests.java
comments:
Ensure fixed serialization order of InnerHitBuilder (#22820)

Usually the order in which we serialize sets and maps of things doesn't matter,
but since InnerHitBuilder is part of SearchSourceBuilder, which is in turn used
as a cache key in its bytes serialization, we need to ensure the order of all
these fields when writing them to an output stream.

This adds tests and makes sure we iterate over the scriptField set and the
childInnerHits map in a fixed order.

Closes #22808

time:
2017-01-30T17:32:23Z
class:
core/src/main/java/org/elasticsearch/common/breaker/ChildMemoryCircuitBreaker.java
core/src/main/java/org/elasticsearch/common/breaker/MemoryCircuitBreaker.java
core/src/main/java/org/elasticsearch/indices/breaker/HierarchyCircuitBreakerService.java
core/src/test/java/org/elasticsearch/common/breaker/MemoryCircuitBreakerTests.java
core/src/test/java/org/elasticsearch/indices/memory/breaker/CircuitBreakerServiceIT.java
comments:
Merge branch 'pr/22693'

time:
2017-01-30T16:53:13Z
class:
comments:
Merge remote-tracking branch 'origin/master'

time:
2017-01-30T16:52:34Z
class:
comments:
Merge branch 'pr/fix-hdfs-settings'

time:
2017-01-30T12:57:28Z
class:
comments:
Fix link to keyword and numeric type

time:
2017-01-30T12:52:32Z
class:
comments:
Fix typo - mergins to margins (#22839)

time:
2017-01-30T10:56:40Z
class:
comments:
Fixed bad asciidoc

time:
2017-01-30T10:47:12Z
class:
comments:
Include field-collapsing docs in request-body search

time:
2017-01-30T10:47:08Z
class:
plugins/repository-azure/src/main/java/org/elasticsearch/cloud/azure/blobstore/AzureBlobStore.java
plugins/repository-azure/src/main/java/org/elasticsearch/repositories/azure/AzureRepository.java
plugins/repository-azure/src/test/java/org/elasticsearch/cloud/azure/AbstractAzureRepositoryServiceIntegTestCase.java
plugins/repository-azure/src/test/java/org/elasticsearch/repositories/azure/AzureBlobStoreTests.java
plugins/repository-azure/src/test/java/org/elasticsearch/repositories/azure/AzureSnapshotRestoreServiceIntegTests.java
comments:
Remove auto creation of container for azure repository

Follow up of #22857 where we deprecate automatic creation of azure containers.

BTW I found that the `AzureSnapshotRestoreServiceIntegTests` does not bring any value because it runs basically a Snapshot/Restore operation on local files which we already test in core.

So instead of trying to fix it to make it pass with this PR, I simply removed it.

time:
2017-01-30T10:08:49Z
class:
comments:
Document upcoming scoring changes. (#22806)

time:
2017-01-28T19:13:21Z
class:
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/blobstore/S3BlobStore.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/blobstore/S3BlobStoreContainerTests.java
comments:
S3 Repository: Remove bucket auto create (#22846)


closes #22761

time:
2017-01-28T16:54:13Z
class:
core/src/main/java/org/elasticsearch/common/breaker/ChildMemoryCircuitBreaker.java
core/src/main/java/org/elasticsearch/common/breaker/MemoryCircuitBreaker.java
core/src/main/java/org/elasticsearch/indices/breaker/HierarchyCircuitBreakerService.java
core/src/test/java/org/elasticsearch/common/breaker/MemoryCircuitBreakerTests.java
core/src/test/java/org/elasticsearch/indices/memory/breaker/CircuitBreakerServiceIT.java
comments:
Add used memory amount to CircuitBreakingException message (#22521)

time:
2017-01-28T01:54:11Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHits.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHitField.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHits.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHitsTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractWireSerializingTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/main/java/org/elasticsearch/test/NotEqualMessageBuilder.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/MatchAssertion.java
comments:
Add tests for reducing top hits (#22837)

Also adds many `equals` and `hashCode` implementations and moves
the failure printing in `MatchAssertion` into a common spot and
exposes it over `assertEqualsWithErrorMessageFromXContent` which
does an object equality test but then uses `toXContent` to print
the differences.

Relates to #22278

time:
2017-01-27T22:26:23Z
class:
core/src/test/java/org/elasticsearch/indices/recovery/EvilPeerRecoveryIT.java
comments:
await fix testRecoveryWaitsForOps

time:
2017-01-27T22:15:51Z
class:
core/src/test/java/org/elasticsearch/indices/recovery/IndexPrimaryRelocationIT.java
comments:
fix @TestLogging annotation

time:
2017-01-27T21:43:16Z
class:
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/EnvironmentCredentialsTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/SyspropCredentialsTests.java
comments:
S3 Repository: Remove env var and sysprop credentials support (#22842)

These are deprecated in 5.x. This commit removes support for them in 6.0.

time:
2017-01-27T21:31:44Z
class:
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
comments:
Don't convert source to UTF-8 it might not be valid UTF-8

time:
2017-01-27T21:09:18Z
class:
core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractAsyncBulkByScrollAction.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractBulkByScrollRequest.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractBulkByScrollRequestBuilder.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/AsyncDeleteByQueryAction.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollParallelizationHelper.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollResponse.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollTask.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/ClientScrollableHitSource.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/DeleteByQueryRequest.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/ParentBulkByScrollTask.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/ScrollableHitSource.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/SuccessfullyProcessed.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/WorkingBulkByScrollTask.java
core/src/main/java/org/elasticsearch/action/bulk/byscroll/package-info.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/AsyncBulkByScrollActionTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollParallelizationHelperTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollResponseTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollTaskStatusTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/BulkByScrollTaskTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/DeleteByQueryRequestTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/ParentBulkByScrollTaskTests.java
core/src/test/java/org/elasticsearch/action/bulk/byscroll/WorkingBulkByScrollTaskTests.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBaseReindexRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkByQueryRestHandler.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkIndexByScrollRequest.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/AbstractBulkIndexByScrollRequestBuilder.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/BulkIndexByScrollResponseContentListener.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/DeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/DeleteByQueryRequestBuilder.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexPlugin.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexRequest.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/ReindexRequestBuilder.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/RestDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportDeleteByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportReindexAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportRethrottleAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/TransportUpdateByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/UpdateByQueryAction.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/UpdateByQueryRequest.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/UpdateByQueryRequestBuilder.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteResponseParsers.java
modules/reindex/src/main/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSource.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/AbstractAsyncBulkByScrollActionScriptTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/BulkIndexByScrollResponseTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/CancelTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/DeleteByQueryConcurrentTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexBasicTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexFailureTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexMetadataTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexRequestTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexScriptTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexTestCase.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/ReindexVersioningTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RethrottleTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RetryTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/RoundTripTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/TransportRethrottleActionTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryMetadataTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryRequestTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryWhileModifyingTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/UpdateByQueryWithScriptTests.java
modules/reindex/src/test/java/org/elasticsearch/index/reindex/remote/RemoteScrollableHitSourceTests.java
test/framework/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractAsyncBulkByScrollActionMetadataTestCase.java
test/framework/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractAsyncBulkByScrollActionTestCase.java
test/framework/src/main/java/org/elasticsearch/action/bulk/byscroll/AbstractBulkByScrollRequestTestCase.java
test/framework/src/main/java/org/elasticsearch/action/bulk/byscroll/BulkIndexByScrollResponseMatcher.java
comments:
Move delete by query helpers into core (#22810)

This moves the building blocks for delete by query into core. This
should enabled two thigns:
1. Plugins other than reindex to implement "bulk by scroll" style
operations.
2. Plugins to directly call delete by query. Those plugins should
be careful to make sure that task cancellation still works, but
this should be possible.

Notes:
1. I've mostly just moved classes and moved around tests methods.
2. I haven't been super careful about cohesion between these core
classes and reindex. They are quite interconnected because I wanted
to make the change as mechanical as possible.

Closes #22616

time:
2017-01-27T21:01:44Z
class:
plugins/repository-hdfs/src/main/java/org/elasticsearch/repositories/hdfs/HdfsBlobContainer.java
plugins/repository-hdfs/src/main/java/org/elasticsearch/repositories/hdfs/HdfsBlobStore.java
plugins/repository-hdfs/src/main/java/org/elasticsearch/repositories/hdfs/HdfsRepository.java
plugins/repository-hdfs/src/test/java/org/elasticsearch/repositories/hdfs/HdfsBlobStoreContainerTests.java
comments:
Add doPrivilege blocks for socket connect ops in repository-hdfs (#22793)

This is related to #22116. The repository-hdfs plugin opens socket
connections. As SocketPermission is transitioned out of core, hdfs
will require connect permission. This pull request wraps operations
that require this permission in doPrivileged blocks.

time:
2017-01-27T18:42:45Z
class:
core/src/main/java/org/elasticsearch/bootstrap/Bootstrap.java
core/src/main/java/org/elasticsearch/common/settings/SecureSetting.java
core/src/main/java/org/elasticsearch/common/settings/SecureString.java
core/src/main/java/org/elasticsearch/common/settings/Setting.java
core/src/main/java/org/elasticsearch/common/settings/Settings.java
core/src/main/java/org/elasticsearch/node/InternalSettingsPreparer.java
core/src/test/java/org/elasticsearch/node/internal/InternalSettingsPreparerTests.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/AwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/cloud/aws/InternalAwsS3Service.java
plugins/repository-s3/src/main/java/org/elasticsearch/repositories/s3/S3Repository.java
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/AwsS3ServiceImplTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/EnvironmentCredentialsTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/SyspropCredentialsTests.java
plugins/repository-s3/src/test/java/org/elasticsearch/cloud/aws/TestAwsS3Service.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/AbstractS3SnapshotRestoreTest.java
plugins/repository-s3/src/test/java/org/elasticsearch/repositories/s3/S3RepositoryTests.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
comments:
S3 repository: Add named configurations (#22762)

* S3 repository: Add named configurations

This change implements named configurations for s3 repository as
proposed in #22520. The access/secret key secure settings which were
added in #22479 are reverted, and the only secure settings are those
with the new named configs. All other previously used settings for the
connection are deprecated.

closes #22520

time:
2017-01-27T18:21:11Z
class:
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/test/java/org/elasticsearch/discovery/DiscoveryWithServiceDisruptionsIT.java
core/src/test/java/org/elasticsearch/indices/recovery/EvilPeerRecoveryIT.java
core/src/test/java/org/elasticsearch/indices/recovery/IndexPrimaryRelocationIT.java
core/src/test/java/org/elasticsearch/recovery/RelocationIT.java
comments:
fix TestLogging instructions for the remove of single doc indexing actions + add some seq# related info

time:
2017-01-27T17:37:35Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHitsTests.java
comments:
Remove annotation

Not allowed.

time:
2017-01-27T17:34:10Z
class:
comments:
Build: Remove legacy migration script (#22834)

This migration script existed from moving plugins into the ES repo in
2.0. It is no longer needed (and contains eg maven commands), and if we
did need any part of it, it will still exist in git history.

time:
2017-01-27T17:32:17Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHits.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHit.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHitField.java
core/src/main/java/org/elasticsearch/search/internal/InternalSearchHits.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/tophits/InternalTopHitsTests.java
test/framework/src/main/java/org/elasticsearch/test/AbstractWireSerializingTestCase.java
test/framework/src/main/java/org/elasticsearch/test/ESTestCase.java
test/framework/src/main/java/org/elasticsearch/test/NotEqualMessageBuilder.java
test/framework/src/main/java/org/elasticsearch/test/rest/yaml/section/MatchAssertion.java
comments:
Add tests for reducing top hits

Also adds many `equals` and `hashCode` implementations and moves
the failure printing in `MatchAssertion` into a common spot and
exposes it over `assertEqualsWithErrorMessageFromXContent` which
does an object equality test but then uses `toXContent` to print
the differences.

Relates to #22278

time:
2017-01-27T16:50:28Z
class:
comments:
Update type-field.asciidoc

Wildcard type names are not supported

time:
2017-01-27T16:16:38Z
class:
core/src/main/java/org/elasticsearch/common/settings/IndexScopedSettings.java
core/src/main/java/org/elasticsearch/common/util/concurrent/AbstractRefCounted.java
core/src/main/java/org/elasticsearch/index/engine/Engine.java
core/src/main/java/org/elasticsearch/index/engine/InternalEngine.java
core/src/main/java/org/elasticsearch/index/seqno/GlobalCheckpointTracker.java
core/src/main/java/org/elasticsearch/index/seqno/LocalCheckpointTracker.java
core/src/main/java/org/elasticsearch/index/seqno/SeqNoStats.java
core/src/main/java/org/elasticsearch/index/seqno/SequenceNumbers.java
core/src/main/java/org/elasticsearch/index/seqno/SequenceNumbersService.java
core/src/main/java/org/elasticsearch/index/shard/IndexShard.java
core/src/main/java/org/elasticsearch/index/store/Store.java
core/src/main/java/org/elasticsearch/index/translog/Translog.java
core/src/main/java/org/elasticsearch/indices/cluster/IndicesClusterStateService.java
core/src/main/java/org/elasticsearch/indices/recovery/PeerRecoveryTargetService.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveriesCollection.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/RecoveryTarget.java
core/src/main/java/org/elasticsearch/indices/recovery/SharedFSRecoverySourceHandler.java
core/src/main/java/org/elasticsearch/indices/recovery/StartRecoveryRequest.java
core/src/test/java/org/elasticsearch/gateway/RecoveryFromGatewayIT.java
core/src/test/java/org/elasticsearch/index/engine/InternalEngineTests.java
core/src/test/java/org/elasticsearch/index/replication/ESIndexLevelReplicationTestCase.java
core/src/test/java/org/elasticsearch/index/replication/RecoveryDuringReplicationTests.java
core/src/test/java/org/elasticsearch/index/seqno/GlobalCheckpointTests.java
core/src/test/java/org/elasticsearch/index/seqno/LocalCheckpointTrackerTests.java
core/src/test/java/org/elasticsearch/indices/recovery/EvilPeerRecoveryIT.java
core/src/test/java/org/elasticsearch/indices/recovery/IndexPrimaryRelocationIT.java
core/src/test/java/org/elasticsearch/indices/recovery/RecoverySourceHandlerTests.java
core/src/test/java/org/elasticsearch/indices/recovery/StartRecoveryRequestTests.java
core/src/test/java/org/elasticsearch/recovery/RecoveriesCollectionTests.java
qa/backwards-5.0/src/test/java/org/elasticsearch/backwards/IndexingIT.java
test/framework/src/main/java/org/elasticsearch/index/shard/IndexShardTestCase.java
comments:
Introduce sequence-number-based recovery

This commit introduces sequence-number-based recovery. When a replica
has fallen out of sync, rather than performing a file-based recovery we
first attempt to replay operations since the last local checkpoint on
the replica. To do this, at the start of recovery the replica tells the
primary what its local checkpoint is. The primary will then wait for all
operations between that local checkpoint and the current maximum
sequence number to complete; this is to ensure that there are no gaps in
the operations that will be replayed from the primary to the
replica. This is a best-effort attempt as we currently have no
guarantees on the primary that these operations will be available; if we
are not able to replay all operations in the desired range, we just
fallback to file-based recovery. Later work will strengthen the
guarantees.

Relates #22484

time:
2017-01-27T14:53:41Z
class:
core/src/main/java/org/elasticsearch/action/search/AbstractSearchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchPhaseController.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchScrollQueryThenFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchTransportService.java
core/src/test/java/org/elasticsearch/action/RejectionActionIT.java
core/src/test/java/org/elasticsearch/action/search/SearchAsyncActionTests.java
comments:
First step towards separating individual search phases (#22802)

At this point AbstractSearchAsyncAction is just a base-class for the first phase of a search where we have multiple replicas
for each shardID. If one of them is not available we move to the next one. Yet, once we passed that first stage we have to work with
the shards we succeeded on the initial phase.
Unfortunately, subsequent phases are not fully detached from the initial phase since they are all non-static inner classes.
In future changes this will be changed to detach the inner classes to test them in isolation and to simplify their creation.
The AbstractSearchAsyncAction should be final and it should just get a factory for the next phase instead of requiring subclasses
etc.

time:
2017-01-27T13:03:02Z
class:
core/src/main/java/org/elasticsearch/action/admin/cluster/node/tasks/cancel/TransportCancelTasksAction.java
core/src/test/java/org/elasticsearch/action/admin/cluster/node/tasks/CancellableTasksTests.java
comments:
Fix hanging cancelling task with no children

Cancelling tasks with no cancellable children can cause the cancellation operation to hang. This commit fixes this issue.

time:
2017-01-27T09:12:58Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/test/java/org/elasticsearch/ElasticsearchExceptionTests.java
comments:
Add parsing method for ElasticsearchException.generateFailureXContent() (#22815)

This commit adds a ElasticsearchException.failureFromXContent() that can be used to parse the result of ElasticsearchException.generateFailureXContent().

time:
2017-01-26T19:08:30Z
class:
core/src/test/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorTests.java
comments:
Fix TophitsAggregatorTests

It needs a DirectoryReader so it has to be careful.

Closes #22818

time:
2017-01-26T18:40:49Z
class:
comments:
Remove unneeded checkstyle LineLength check suppression for more classes

time:
2017-01-26T18:15:29Z
class:
core/src/main/java/org/elasticsearch/common/network/NetworkModule.java
core/src/main/java/org/elasticsearch/common/xcontent/AbstractObjectParser.java
core/src/main/java/org/elasticsearch/common/xcontent/NamedXContentRegistry.java
core/src/main/java/org/elasticsearch/plugins/SearchPlugin.java
core/src/main/java/org/elasticsearch/repositories/blobstore/BlobStoreFormat.java
core/src/main/java/org/elasticsearch/repositories/blobstore/ChecksumBlobStoreFormat.java
core/src/main/java/org/elasticsearch/search/SearchExtBuilder.java
core/src/main/java/org/elasticsearch/search/SearchModule.java
core/src/main/java/org/elasticsearch/search/aggregations/bucket/histogram/ExtendedBounds.java
core/src/test/java/org/elasticsearch/common/xcontent/ConstructingObjectParserTests.java
core/src/test/java/org/elasticsearch/common/xcontent/ObjectParserTests.java
core/src/test/java/org/elasticsearch/search/AbstractSearchTestCase.java
core/src/test/java/org/elasticsearch/snapshots/DedicatedClusterSnapshotRestoreIT.java
comments:
Merge some equivalent interfaces (#22816)

Remove `FromXContent` and use `CheckedFunction` instead.
Remove `FromXContentWithContext` and use `ContentParser` instead.

time:
2017-01-26T16:43:59Z
class:
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryTests.java
comments:
Remove non needed import

time:
2017-01-26T16:37:53Z
class:
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2Service.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryTests.java
comments:
Merge branch 'pr/22566-ec2-meta-host'

time:
2017-01-26T16:33:26Z
class:
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryTests.java
comments:
use expectThrows instead of manually testing exception

time:
2017-01-26T16:20:27Z
class:
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryTests.java
comments:
Fix checkstyle and a test

time:
2017-01-26T16:10:37Z
class:
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2Service.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryTests.java
comments:
Update after review

time:
2017-01-26T16:10:37Z
class:
plugins/discovery-ec2/src/main/java/org/elasticsearch/cloud/aws/AwsEc2Service.java
plugins/discovery-ec2/src/main/java/org/elasticsearch/discovery/ec2/AwsEc2UnicastHostsProvider.java
plugins/discovery-ec2/src/test/java/org/elasticsearch/discovery/ec2/Ec2DiscoveryTests.java
comments:
Read ec2 discovery address from aws instance tags

This PR adds a new option for `host_type`: `tag:TAGNAME` where `TAGNAME` is the tag field you defined for your ec2 instance.

For example if you defined a tag `my-elasticsearch-host` in ec2 and set it to `myhostname1.mydomain.com`, then
setting `host_type: tag:my-elasticsearch-host` will tell Discovery Ec2 plugin to read the host name from the
`my-elasticsearch-host` tag. In this case, it will be resolved to `myhostname1.mydomain.com`.

Closes #22566.

time:
2017-01-26T15:45:29Z
class:
core/src/main/java/org/elasticsearch/indices/IndicesRequestCache.java
core/src/main/java/org/elasticsearch/indices/IndicesService.java
core/src/test/java/org/elasticsearch/indices/IndicesRequestCacheTests.java
comments:
Invalidate cached query results if query timed out (#22807)

Today we cache query results even if the query timed out. This is obviously
problematic since results are not complete. Yet, the decision if a query timed
out or not happens too late to simply not cache the result since if we'd just throw
an exception all currently waiting requests with the same request / cache key would
fail with the same exception without the option to access the result or to re-execute.
Instead, this change will allow the request to enter the cache but invalidates it immediately.
Concurrent request might not get executed and return the timed out result which is not absolutely
correct but very likely since identical requests will likely timeout as well. As a side-effect
we won't hammer the node with concurrent slow searches but rather only execute one of them
and return shortly cached result.

Closes #22789

time:
2017-01-26T15:43:22Z
class:
comments:
Add remaining generated painless API

This was generated by the generated added in
8a2d424d6839cfed0af44513b0f73b4f207b1b94 but not committed in that
change for review purposes.

time:
2017-01-26T15:39:19Z
class:
modules/lang-painless/src/main/java/org/elasticsearch/painless/Debug.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/Definition.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/PainlessExplainError.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/ScriptImpl.java
modules/lang-painless/src/main/java/org/elasticsearch/painless/api/Debug.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/DebugTests.java
modules/lang-painless/src/test/java/org/elasticsearch/painless/PainlessDocGenerator.java
comments:
Generate reference links for painless API (#22775)

Adds "Appending B. Painless API Reference", a reference of all classes
and methods available from Painless. Removes links to java packages
because they contain methods that we don't expose and don't contain
methods that we do expose (the ones in Augmentation). Instead this
generates a list of every class and every exposed method using the same
type information available to the
interpreter/compiler/whatever-we-call-it. From there you can jump to
the relevant docs.

Right now you build all the asciidoc files by running
```
gradle generatePainlessApi
```

These files are expected to be committed because we build the docs
without running `gradle`.

Also changes the output of `Debug.explain` so that it is easy to
search for the class in the generated reference documentation.

You can also run it in an IDE safely if you pass the path to the
directory in which to generate the docs as the first parameter. It'll
blow away the entire directory an recreate it from scratch so be careful.

And then you can build the docs by running something like:
```
../docs/build_docs.pl --out ../built_docs/ --doc docs/reference/index.asciidoc --open
```

That is, if you have checked out https://github.com/elastic/docs in
`../docs`. Wait a minute or two and your browser will pop open in with
all of Elasticsearch's reference documentation. If you go to
`http://localhost:8000/painless-api-reference.html` you can see this
list. Or you can get there by following the links to `Modules` and
`Scripting` and `Painless` and then clicking the link in the paragraphs
below titled `Appendix B. Painless API Reference`.

I like having these in asciidoc because we can deep link to them from the
rest of the guide with constructs like
`<<painless-api-reference-Object-hashCode-0>>` and
`<<painless-api-reference->>` and we get link checking. Then the only
brittle link maintenance bit is the link generation for javadoc. Which
sucks. But I think it is important that we link to the methods directly
so they are easy to find.

Relates to #22720

time:
2017-01-26T15:33:56Z
class:
core/src/test/java/org/elasticsearch/ElasticsearchExceptionTests.java
comments:
[TEST] Fix ElasticsearchExceptionTests

Some test failures can happen in ElasticsearchExceptionTests, this commit fixes them.

time:
2017-01-26T14:17:07Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/test/java/org/elasticsearch/ElasticsearchExceptionTests.java
core/src/test/java/org/elasticsearch/action/search/SearchPhaseExecutionExceptionTests.java
comments:
Add parsing method for ElasticsearchException.generateThrowableXContent() (#22783)

The output of the ElasticsearchException.generateThrowableXContent() method can be parsed back by the ElasticsearchException.fromXContent() method.

This commit adds unit tests in the style of the to-and-from-xcontent tests we already have for other parsing methods. It also relax the strict parsing of the ElasticsearchException.fromXContent() so that it does not throw an exception when custom metadata and headers are parsed, as long as they are either strings or arrays of strings. Every other type is ignored at parsing time.

time:
2017-01-26T12:58:26Z
class:
core/src/main/java/org/elasticsearch/action/search/RemoteClusterConnection.java
comments:
Improve connection closing in `RemoteClusterConnection` (#22804)

Some tests verify that all connection have been closed but due to the
async / concurrent nature of `RemoteClusterConnection` there are situations
where we notify listeners that trigger tests to finish before we actually
closed all connections. The race is very very small and has no impact on the
code correctness. This commit documents and improves the way we close
connections to ensure test won't fail with false positives.

Closes #22803

time:
2017-01-26T10:38:19Z
class:
comments:
Docs: Cluster allocation explain should be on one page

time:
2017-01-26T08:22:43Z
class:
comments:
repositories.hdfs.path can not be set

Reported at: https://discuss.elastic.co/t/combine-elasticsearch-5-1-1-and-repository-hdfs/69659

If you define as described [in our docs](https://www.elastic.co/guide/en/elasticsearch/plugins/current/repository-hdfs-config.html) the following `elasticsearch.yml` settings:

```yml
repositories:
  hdfs:
    uri: "hdfs://es-master:9000/" # optional - Hadoop file-system URI
    path: "some/path" # required - path with the file-system where data is stored/loaded
```

It fails at startup because we don't register the global setting `repositories.hdfs.path` in `HdfsPlugin`.

This PR removes that from our docs so people must provide those settings only when registering the repository with:

```
PUT _snapshot/my_hdfs_repository
{
  "type": "hdfs",
  "settings": {
    "uri": "hdfs://namenode:8020/",
    "path": "elasticsearch/respositories/my_hdfs_repository",
    "conf.dfs.client.read.shortcircuit": "true"
  }
}
```

Based on issue #22800.

Closes #22301

time:
2017-01-26T08:14:44Z
class:
core/src/main/java/org/elasticsearch/action/search/SearchDfsQueryAndFetchAsyncAction.java
core/src/main/java/org/elasticsearch/action/search/SearchType.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchAction.java
core/src/main/java/org/elasticsearch/action/search/TransportSearchHelper.java
core/src/main/java/org/elasticsearch/rest/action/search/RestSearchAction.java
core/src/main/java/org/elasticsearch/search/query/QueryPhase.java
core/src/main/java/org/elasticsearch/search/rescore/Rescorer.java
core/src/test/java/org/elasticsearch/action/IndicesRequestIT.java
core/src/test/java/org/elasticsearch/search/SearchWithRejectionsIT.java
core/src/test/java/org/elasticsearch/search/basic/TransportTwoNodesSearchIT.java
core/src/test/java/org/elasticsearch/search/scroll/DuelScrollIT.java
comments:
Remove DFS_QUERY_AND_FETCH as a search type (#22787)

This commit removes the search type `dfs_query_and_fetch` without a
replacement. We don't allow to use this type via REST since 2.x
but still keep it around for no particular reason. There we no users
complaining about the availability. This should now be removed from the
codebase. `query_and_fetch` is still used internally to safe a roundtrip
if there is only one shard but it can't be used via the rest interface.

time:
2017-01-25T23:09:25Z
class:
core/src/main/java/org/elasticsearch/common/settings/ClusterSettings.java
core/src/main/java/org/elasticsearch/repositories/RepositoriesModule.java
core/src/test/java/org/elasticsearch/bwcompat/RestoreBackwardsCompatIT.java
core/src/test/java/org/elasticsearch/snapshots/RepositoriesIT.java
core/src/test/java/org/elasticsearch/snapshots/SharedClusterSnapshotRestoreIT.java
modules/repository-url/src/main/java/org/elasticsearch/common/blobstore/url/URLBlobContainer.java
modules/repository-url/src/main/java/org/elasticsearch/common/blobstore/url/URLBlobStore.java
modules/repository-url/src/main/java/org/elasticsearch/plugin/repository/url/URLRepositoryPlugin.java
modules/repository-url/src/main/java/org/elasticsearch/repositories/url/URLRepository.java
modules/repository-url/src/test/java/org/elasticsearch/common/blobstore/url/URLBlobStoreTests.java
modules/repository-url/src/test/java/org/elasticsearch/repositories/url/RepositoryURLClientYamlTestSuiteIT.java
modules/repository-url/src/test/java/org/elasticsearch/repositories/url/URLRepositoryTests.java
modules/repository-url/src/test/java/org/elasticsearch/repositories/url/URLSnapshotRestoreTests.java
comments:
Add repository-url module and move URLRepository (#22752)

This is related to #22116. URLRepository requires SocketPermission
connect. This commit introduces a new module called "repository-url"
where URLRepository will reside. With the new module, permissions can
be removed from core.

time:
2017-01-25T23:09:07Z
class:
modules/ingest-common/src/main/java/org/elasticsearch/ingest/common/DateFormat.java
modules/ingest-common/src/test/java/org/elasticsearch/ingest/common/DateProcessorTests.java
comments:
fix date-processor to a new default year for every new pipeline execution. (#22601)

Beforehand, the DateProcessor constructs its joda pattern formatter during processor
construction. This led to newly ingested documents being defaulted to
the year that the pipeline was constructed, not that of processing.

Fixes #22547.

time:
2017-01-25T21:15:50Z
class:
core/src/main/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregator.java
core/src/test/java/org/elasticsearch/search/aggregations/AggregatorTestCase.java
core/src/test/java/org/elasticsearch/search/aggregations/metrics/tophits/TopHitsAggregatorTests.java
comments:
Add tests for top_hits aggregation (#22754)

Add unit tests for `TopHitsAggregator` and convert some snippets in
docs for `top_hits` aggregation to `// CONSOLE`.

Relates to #22278
Relates to #18160

time:
2017-01-25T16:15:24Z
class:
core/src/main/java/org/elasticsearch/search/fetch/subphase/ParentFieldSubFetchPhase.java
core/src/test/java/org/elasticsearch/search/fetch/subphase/ParentFieldSubFetchPhaseTests.java
comments:
Merge branch 'pr/22772'

time:
2017-01-25T16:08:17Z
class:
core/src/test/java/org/elasticsearch/search/fetch/subphase/ParentFieldSubFetchPhaseTests.java
comments:
[TEST] Added this for 93a28b0acfff5332e97616f53b5d52fe8b933306 submitted via #22772

time:
2017-01-25T15:52:38Z
class:
comments:
Merge branch 'pr/ingest-attachment-mime4j'

time:
2017-01-25T11:30:51Z
class:
core/src/main/java/org/elasticsearch/monitor/os/OsProbe.java
comments:
Fix typo in comment in OsProbe.java

This commit fixes a silly typo in a comment relating to cgroups in
OsProbe.java.

time:
2017-01-25T10:49:39Z
class:
comments:
Add new ruby search library to community clients doc (#22765)

* Add new Ruby search lib from Artsy.

* update ruby library reference following rename

time:
2017-01-25T10:37:15Z
class:
core/src/main/java/org/elasticsearch/index/query/RangeQueryBuilder.java
core/src/test/java/org/elasticsearch/index/query/RangeQueryBuilderTests.java
comments:
RangeQuery WITHIN case now normalises query (#22431)

Previous to his change when the range query was rewritten to an unbounded range (`[* TO *]`) it maintained the timezone and format for the query. This means that queries with different timezones and format which are rewritten to unbounded range queries actually end up as different entries in the search request cache.

This is inefficient and unnecessary so this change nulls the timezone and format in the rewritten query so that regardless of the timezone or format the rewritten query will be the same.

Although this does not fix #22412 (since it deals with the WITHIN case rather than the INTERSECTS case) it is born from the same arguments

time:
2017-01-25T10:00:50Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
core/src/main/java/org/elasticsearch/index/engine/EngineClosedException.java
core/src/test/java/org/elasticsearch/ExceptionSerializationTests.java
comments:
Remove EngineClosedException

All usage has been removed in https://github.com/elastic/elasticsearch/pull/22631, which is back ported to 5.x. This means 6.x will never get it on the wire and we can remove it

time:
2017-01-25T07:53:44Z
class:
comments:
Add test-outlook.msg and test-outlook2003.msg files

time:
2017-01-24T19:44:14Z
class:
comments:
Remove leftover build files and simplify ProgressLogger usage

These files should have been removed in an earlier commit. This commit also simplifies usage of ProgressLoggerWrapper by using the Groovy delegation instead of using explicit delegation.

time:
2017-01-24T19:40:17Z
class:
core/src/main/java/org/elasticsearch/ElasticsearchException.java
comments:
update version checks in ElasticsearchException serialization code

5.3.0 is the first version that contains the split from headers to metadata, updated the check to reflect that. It was previously after to be able to commit to master first, and only after that backport the change. Otherwise master tests would have failed until the change was backported.

time:
2017-01-24T19:04:11Z
class:
core/src/main/java/org/elasticsearch/action/bulk/BulkItemResponse.java
comments:
Fix BulkItemResponse serialization for 6.x <-> 5.3.x

Previously the behavior where the `OpType` byte was serialized was only in
master, but it was recently backported to 5.x, so the serialization version
checks need to be updated as well.


As a follow up 